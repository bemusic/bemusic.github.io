{"version":3,"file":"build/369-bc23dc308c5acd36c81f.js","mappings":"0JAIIA,EAAgC,IAAIC,IAAI,cACxCC,EAAgC,IAAID,IAAI,cACxCE,EAAgC,IAAIF,IAAI,cACxCG,EAAgC,IAAIH,IAAI,cACxCI,EAA0B,IAA4B,KACtDC,EAAqC,IAAgCN,GACrEO,EAAqC,IAAgCL,GACrEM,EAAqC,IAAgCL,GACrEM,EAAqC,IAAgCL;AAEzEC,EAAwBK,KAAK,CAACC,EAAOC,GAAI,+OAAiPN,EAAqC,iwDAAmwDC,EAAqC,uFAAyFC,EAAqC,2FAA6FC,EAAqC,8jCAAikC,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,8CAA8C,MAAQ,GAAG,SAAW,ivCAAivC,eAAiB,CAAC,suGAAsuG,WAAa,MAE7/P,K,2DCbIJ,E,MAA0B,GAA4B;AAE1DA,EAAwBK,KAAK,CAACC,EAAOC,GAAI,gcAAuc,GAAG,CAAC,QAAU,EAAE,QAAU,CAAC,4BAA4B,8BAA8B,MAAQ,GAAG,SAAW,yNAAyN,eAAiB,CAAC,8WAA8W,yuEAAyuE,WAAa,MAE16G,K;uICIIC,EAAU,CAAC;AAEfA,EAAQC,kBAAoB,IAC5BD,EAAQE,cAAgB,IAElBF,EAAQG,OAAS,SAAc,KAAM,QAE3CH,EAAQI,OAAS,IACjBJ,EAAQK,mBAAqB;AAEhB,IAAI,IAASL,GAKJ,KAAW,YAAiB;AALlD,I;ACiLA,SAASM,EAAkBC,EAASC,GAClC,MAAMC,EAASC,SAASC,cAAc;AAatC,OAZAF,EAAOG,iBACL,cACCC,IACCA,EAAEC,iBAAiB,IAErB,GAEFL,EAAOM,QAAWF,IAChBA,EAAEG,iBACFT,GAAS,EAEXE,EAAOD,UAAYA,EACZC,CACT,CAEA,MA9MO,MACLQ,aAAY,KAAEC,EAAI,QAAEC,EAAO,uBAAEC,EAAsB,MAAEC,IACnDC,KAAKC,MAAQL,EACbI,KAAKE,SAAWL;AAChB,MAAMM,EAAWN,EAAQM;AACzBH,KAAKI,SAAW,IAAIC,IAClBT,EAAKU,QAAQC,KAAKC,GAAW,CAC3BA,EACA,IAAI,IAAcA,EAAQL,OAG9BH,KAAKS,UAAY,CAAC,EAClBT,KAAKU,SAAWV,KAAKW,eAAe,CAClCb,yBACAC,QACAa,eAAgBhB,EAAKU,QAAQ,GAAG5B,QAAQmC,UACxCC,kBAAmBX,EAASW,oBAE9Bd,KAAKe,2BACLf,KAAKgB,0BACLhB,KAAKiB,kBAAmB,CAC1B,CAEAC,iBAAiBC,GACfnB,KAAKoB,UAAYD,CACnB,CAEAE,iBAAiBC,GACftB,KAAKuB,UAAYD,CACnB,CAEAE,QACExB,KAAKyB,UAAW,IAAIC,MAAOC;AAC3B,MAAMnB,EAASR,KAAKC,MAAMK,QAAQ,GAC5BsB,EAAWpB,EAAOqB,UAAUD,SAC5BE,EAAStB,EAAO9B,QAAQqD,gBAAkB,cAAgB;AAChE/B,KAAKS,UAAsB,WAAIqB,EAASF,EAASI,MACjDhC,KAAKS,UAAuB,YAAImB,EAASK,OACzCjC,KAAKkC,UAAY1B,EAAOqB,UAAUM,QACpC,CAEAC,UACEpC,KAAKE,SAASkC,SAChB,CAEAC,OAAOC,EAAUC,GACf,MAAMC,IAAQ,IAAId,MAAOC,UAAY3B,KAAKyB,UAAY,IAChDgB,EAAOzC,KAAK0C,SAASF,EAAMF,EAAUC;AAC3CvC,KAAK2C,oBAAoBH,EAAMF,EAAUC,GACzCvC,KAAKE,SAAS0C,OAAOC,OAAOC,OAAO,CAAC,EAAG9C,KAAKS,UAAWgC,IACvDzC,KAAK+C,kBAAkBT,GACvBtC,KAAKgD,+BAA+BV,EACtC,CAEAS,kBAAkBT,GACZtC,KAAKiD,SAAWjD,KAAKkD,eAAiBZ,GAAYtC,KAAKmD,eACzDnD,KAAKiD,OAAOG,OAAS,EACrBpD,KAAKiD,OAAOI,OACZrD,KAAKiD,OAAOK,UAAUC,IAAI,cAC1BvD,KAAKkD,eAAgB,EAEzB,CAEAF,+BAA+BV,GAC7B,GAAItC,KAAKC,MAAMvB,QAAQ8E,SAAU,CAG7BlB,GAFqC,gBAGpCtC,KAAKiB,mBAENjB,KAAKiB,kBAAmB,EACxBjB,KAAKyD,YAAYH,UAAUC,IAAI,Y,CAGrC,CAEAb,SAASF,EAAMF,EAAUC,GACvB,MAAME,EAAO,CAAC;AACdA,EAAe,SAAIzC,KAAKC,MAAMvB,QAAQ8E,SAAW,MAAQ,KACzDf,EAAQ,EAAID,EACZC,EAAe,SAAIH,EACnBG,EAAY,MAAIzC,KAAK0D,UAAUnB,GAC/BE,EAAgB,UAAIzC,KAAK2D,aAAarB;AACtC,IAAK,MAAO9B,EAAQoD,KAAkB5D,KAAKI,SAAU,CACnD,MAAMyD,EAActB,EAAU/B,OAAOA,GAC/BsD,EAAaF,EAAcvB,OAAOG,EAAMF,EAAUuB;AACxD,IAAK,MAAME,KAAOD,EAChBrB,EAAK,IAAIjC,EAAOwD,UAAUD,KAASD,EAAWC,E,CAGlD,OAAOtB,CACT,CAEAE,oBAAoBH,EAAMF,EAAUC,GAClC,MAAME,EAAOzC,KAAKS;KACMwD,IAApBxB,EAAc,SAAmBF,EAAU2B,UAC7CzB,EAAc,QAAID,QAEWyB,IAA3BxB,EAAqB,gBAAmBF,EAAU4B,iBACpD1B,EAAqB,eAAID,EAE7B,CAEAmB,aAAarB,GACX,OACE,EAAA8B,EAAA,GAAWC,KAAKC,IAAItE,KAAKkC,UAAWmC,KAAKE,IAAI,EAAGjC,KAChD,OACA,EAAA8B,EAAA,GAAWpE,KAAKkC,UAEpB,CAEAwB,UAAUnB,GACR,MAAMiC,EAAIjC,EAAUkC;AACpB,OAAOD,EAAI,GAAMH,KAAKK,IAAI,GAAKF,EAAI,IAAO,GAAK,GAAK,CACtD,CAEA7D,gBAAe,uBACbb,EAAsB,MACtBC,EAAK,eACLa,EAAc,kBACdE,IAEA,MAAM6D,EAAW,IAAE,oCAChBC,KAAK,uBAAwBhE,GAC7BgE,KAAK,2BAA4B9D,GACjC+D,OAAO,sDACPA,OAAO7E,KAAK8E;AAWf,OAVIhF,GACFiF,QAAQC,QAAQlF,GAAwBmF,MAAMC,GAC5CP,EAASQ,KAAK,kBAAkBN,OAAOK,KAGvCnF,IACFC,KAAKiD,OAASlD,EAAMqF,QACpBpF,KAAKmD,aAAepD,EAAMsF,OAC1B,IAAEtF,EAAMqF,SAASE,SAAS,0BAA0BC,SAASZ,IAExDA,EAAS,EAClB,CAEA5D,2BACE,MAAMyE,EAAepG,SAASC,cAAc;AAC5CmG,EAAatG,UAAY,sCACzBc,KAAKyF,QAAQC,YAAYF,GACzBA,EAAalC,UAAUC,IAAI;AAC3B,MAAMoC,EAAiB,CAACzG,EAAWD,KACjC,MAAME,EAASH,EAAkBC,EAASC;AAC1CsG,EAAaE,YAAYvG,EAAO;AAElCwG,EAAe,qCAAqC,IAAM3F,KAAKoB,cAC/DuE,EAAe,qCAAqC,IAAM3F,KAAKuB;AAE/D,MAAMqE,EAAaxG,SAASC,cAAc;AAC1CuG,EAAWC,YAAc,0CACzBD,EAAW1G,UAAY,4BACvBc,KAAKyD,YAAcmC,EACnBJ,EAAaE,YAAYE,EAC3B,CAEA5E,0BACE,IAAI,YAA8B,YAChC;AAEF,MAAMwE,EAAepG,SAASC,cAAc;AAC5CmG,EAAatG,UAAY,kDACzBc,KAAKyF,QAAQC,YAAYF;AACzB,MAGMrG,EAASH,GAHC,KACd,aAAoB,GAIpB;AAEFwG,EAAaE,YAAYvG,EAC3B,CAEIU,cACF,OAAOG,KAAKE,QACd,CAEI4E,WACF,OAAO9E,KAAKE,SAAS4E,IACvB,CAEIW,cACF,OAAOzF,KAAKU,QACd,E;ACvJF,IA7BO,MAILf,YACEmG,EACgBpH,GAAA,KAAAA,QAAAA,EAEhBsB,KAAKM,QAAU5B,EAAQ4B,QAAQC,KAAI,SAAUwF,EAAeC,GAK1D,OAJAD,EAAgBlD,OAAOC,OAAO,CAAC,EAAGiD,EAAe,CAC/CE,UAAWvH,EAAQwH,mBAAqB,IACxC1C,SAAU9E,EAAQ8E,WAEb,IAAI,IAAOsC,EAAWE,GAAQA,EAAQ,EAAGD,EAClD,GACF,CAGII,cACF,MAAMC,EAAM,IAAIC;AAChB,IAAK,MAAM7F,KAAUR,KAAKM,QACxB,IAAK,MAAMgG,KAAU9F,EAAOqB,UAAUsE,QACpCC,EAAI7C,IAAI+C;AAGZ,OAAOC,MAAMC,KAAKJ,EACpB,E;ACUF,IA5CO,MAYLzG,YAA4BC,GAAA,KAAAA,KAAAA,EAVrB,KAAA6E,cAAgB,EAEhB,KAAAN,gBAAiB,EAEjB,KAAAD,SAAU,EAEV,KAAAuC,UAAW,EAKhBzG,KAAKI,SAAW,IAAIC,IAClBT,EAAKU,QAAQC,KAAKC,GAAW,CAACA,EAAQ,IAAI,IAAYA,MAE1D,CAEA6B,OAAOC,EAAkBoE,EAAkBC,GACzC,IAAIF,GAAW;AACf,IAAK,MAAOjG,EAAQqD,KAAgB7D,KAAKI,SACvCyD,EAAYxB,OAAOC,EAAUoE,GACxB7C,EAAY4C,WAAUA,GAAW;AAGxCzG,KAAKyE,cAAgBkC,EAAMlC,cAC3BzE,KAAKmE,eAAiBwC,EAAMxC,eAC5BnE,KAAKkE,QAAUyC,EAAMzC,QACrBlE,KAAKyG,SAAWA,CAClB,CAEAjG,OAAOoG,GAEL,OADoB5G,KAAKI,SAASyG,IAAID,IAGpC,KACE,EACA,2DACAA,EAAE5C,OAGR,E;AC/BK,MAAM8C,UACH,KAGRnH,YAAYoH,GACVC,MAAM,CACJC,SAAWC,GAOjBC,eACEJ,EACAG,GAEA,MAAME,EAAmB,GACnBC,EAAeN,EAAMM;AAC3B,IAAKA,EACH,MAAM,IAAIC,MAAM;AAElB,GAAID,EAAaE,MAAMC,QAAQ,kBAAoB,EAAG,CACpD,MAAMC,EAAMJ,EACTK,QAAQ,iBACRC,MAAM,cACNC,QAAQC,GAAMA,IAAMA,EAAEC,WAAW,OAAM;AAC1C,GAAI,UAAoBL,GAAOA,EAAIM,QAAQ,SAAU,KAEnD,OADAb,EAAI,qDACG,OAAO,QAAyBO,EAAKP,G,MAEzC,GAAIG,EAAaW,MACtB,IAAK,MAAMC,KAAQ1B,MAAMC,KAAKa,EAAaW,aACnCE,EAASD;KAEZ,GAAIZ,EAAac,MACtB,IAAK,MAAMC,KAAQ7B,MAAMC,KAAKa,EAAac,OACzCE,EAAQD;AAGZ,OAAOhB;AAEPD,eAAee,EAASD,GACtB,MAAMK,EAAQL,EAAKM,kBAAoBN,EAAKM;AAC5C,GAAID,QACIE,EAAUF;IACX,CACL,MAAMF,EAAOH,EAAKQ,WAAaR,EAAKQ;AAChCL,GAAMC,EAAQD,E,CAEtB,CAEA,SAASI,EAAUF,EAAYxG,EAAS,IACtC,OAAIwG,EAAMI,OACDC,EAASL,EAAOxG,GACdwG,EAAMM,YACRC,EAAcP,EAAOxG,QADvB,CAGT,CAEAqF,eAAewB,EAASL,EAAYxG,EAAS,IAC3C,MAAMsG,QAAa,IAAIrD,SAAc,CAACC,EAAS8D,KAC7CR,EAAMF,KAAKpD,EAAS8D,EAAO;AAG7B,OADAT,EAAQD,EAAMtG,GACPsG,CACT,CAEAjB,eAAe0B,EAAcE,EAAUjH,EAAS,IAC9C,MAAMkH,EAAiB,GACjBC,EAASF,EAAIG,eACbC,EAAW,IACf,IAAIpE,SAAa,CAACC,EAAS8D,KACzBG,EAAOG,YAAYpE,EAAS8D,EAAO;AAEvC,OAAS,CACP,MAAMO,QAAgBF;AACtB,IAAKE,GAA8B,IAAnBA,EAAQC,OAAc;AACtCN,EAAQzK,QAAQgI,MAAMC,KAAK6C,G,CAE7B,IAAK,MAAMf,KAASU,QACZR,EAAUF,EAAOxG,EAASiH,EAAIQ,KAAO,IAE/C,CAEA,SAASlB,EAAQD,EAAYtG,EAAS,IAChCsG,IACF,OAActG,EAAQsG,EAAKmB,MAAOA,IAChCnC,EAAI7I,KAAK,CAAEgL,OAAMnB,QAAO,GAG9B,CACF,CAtFyBoB,CAAkBzC,EAAOG,IAEhD,EAGF,K;;ACbO,MAAMuC,EACX9J,YAA6B+J,GAAA,KAAAA,oBAAAA,EAE7B,KAAAC,eAAgB,EAChB,KAAAC,MAAsB,EAH6C,CAYnEC,QAAQC,GACN,OAAO9J,KAAK+J,aAAaD,EAC3B,CAEAvL,KAAKuL,GAIH,OAHI9J,KAAKgK,SACPhK,KAAK4J,MAAMrL,KAAKyB,KAAKgK,QAAQF,OAExB9J,KAAK+J,aAAaD,EAC3B,CAEA3C,YACE,MAAM8C,EAAOjK,KAAK4J,MAAMM;AACpBD,SACIjK,KAAK+J,aAAaE,EAE5B,CAEQ9C,mBAAmBgD,GACzB,GAAInK,KAAK2J,cAAe,MAAM,IAAIrC,MAAM;AACxC,IACEtH,KAAK2J,eAAgB,EAGjB3J,KAAKgK,gBACDjF,QAAQC,QAAQhF,KAAKgK,QAAQI,SAASC,YAC5CrK,KAAKgK,QAAQM,KAAKC;AAIpB,MAAMT,EACsB,mBAAnBK,EACHA,EAoBZ,SACEL,EACAJ,GAEA,OAAO,SAAqBc,EAAUF,GACpC,IAAID,EAA6B;AACjC,MAAMI,EAAgB,eAAmBX,EAAO,CAC9CY,yBAA2BC,IACzBN,EAAWM,CAAQ;AAIvB,OADAL,EAAK1H,OAAO,gBAAC8G,EAAmB,KAAEe,IAC3B,CACLtD,iBACE,IACE,aAAakD,G,SAEbC,EAAKC,S,CAET,EAEJ,CACF,CAzCYK,CAAWT,EAAgBnK,KAAK0J,qBAGhCtE,EAAUhG,SAASC,cAAc;AACvC+F,EAAQlG,UAAY,uBAChB,OAAJ,UAAI,IAAJ,qBAAkBkG;AAClB,MAAMyF,GAAY,OAAWzF,GACvBgF,EAAWN,EAAM1E,EAASyF;AAChC7K,KAAKgK,QAAU,CACbF,QACAM,WACAE,KAAMO,E,SAGR7K,KAAK2J,eAAgB,C,CAEzB,EA2BK,MAAMmB,GAAsB,IAAAC,oBAEjC9G,E;uIC/FEvF,EAAU,CAAC;AAEfA,EAAQC,kBAAoB,IAC5BD,EAAQE,cAAgB,IAElBF,EAAQG,OAAS,SAAc,KAAM,QAE3CH,EAAQI,OAAS,IACjBJ,EAAQK,mBAAqB;AAEhB,IAAI,IAASL,GAKJ,KAAW,YAAiB;AALlD,I;ACAA,OAAe,IAAAsM,aATD,EACV9L,YAAW+L,WAAUC,eACvBC,IAEA,uBAAKA,IAAKA,EAAKjM,UAAW,IAAE,QAASA,GAAYgM,YAAaA,GAC3DD,I;;ACfL,MAAMG,EAAmBhM,SAASiM,cAAc;AAEhD,IAAKD,EACH,MAAM,IAAI9D,MAAM;AAGX,MAAMuD,GAAY,OAAWO;AAEpC,K","sources":["file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/game-display.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Scene.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/game-display.scss?[contenthash]","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/game.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/dnd-resources.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/scene-manager/index.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Scene.scss?[contenthash]","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Scene.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/main-element.ts"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/runtime/api.js\";\nimport ___CSS_LOADER_GET_URL_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/runtime/getUrl.js\";\nvar ___CSS_LOADER_URL_IMPORT_0___ = new URL(\"./background/default.jpg\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_1___ = new URL(\"./touch-escape.png\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_2___ = new URL(\"./touch-replay.png\", import.meta.url);\nvar ___CSS_LOADER_URL_IMPORT_3___ = new URL(\"./touch-fullscreen.png\", import.meta.url);\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\nvar ___CSS_LOADER_URL_REPLACEMENT_0___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_0___);\nvar ___CSS_LOADER_URL_REPLACEMENT_1___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_1___);\nvar ___CSS_LOADER_URL_REPLACEMENT_2___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_2___);\nvar ___CSS_LOADER_URL_REPLACEMENT_3___ = ___CSS_LOADER_GET_URL_IMPORT___(___CSS_LOADER_URL_IMPORT_3___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".game-display {\\n  display: block;\\n  margin: 0 auto;\\n  overflow: hidden;\\n  position: relative;\\n}\\n.game-display--bg {\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  z-index: 10;\\n  background: url(\" + ___CSS_LOADER_URL_REPLACEMENT_0___ + \") center no-repeat;\\n  background-size: cover;\\n  animation: 1.5s game-display--bg-default;\\n  animation-fill-mode: both;\\n}\\n.game-display[data-info-panel-position=top] .game-display--bg {\\n  animation-name: game-display--bg-down;\\n}\\n.game-display--video-bg {\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  top: -48px;\\n  left: 0px;\\n  z-index: 11;\\n  opacity: 0;\\n  transition: 0.5s opacity;\\n  will-change: opacity;\\n}\\n.game-display--video-bg.is-playing {\\n  opacity: 1;\\n}\\n.game-display[data-panel-placement=left] .game-display--video-bg {\\n  transform: translateX(13.671875%) scale(0.87);\\n}\\n.game-display[data-panel-placement=right] .game-display--video-bg {\\n  transform: translateX(13.671875%) scale(0.87);\\n}\\n.game-display--bg img {\\n  width: 100%;\\n  height: 100%;\\n  display: block;\\n  object-fit: cover;\\n  animation: 1.2s game-display--bg-default;\\n  animation-fill-mode: both;\\n}\\n.game-display[data-info-panel-position=top] .game-display--bg img {\\n  animation-name: game-display--bg-down;\\n}\\n.game-display > canvas {\\n  position: relative;\\n  z-index: 100;\\n}\\n.game-display--touch-buttons {\\n  position: fixed;\\n  transform: translateZ(0);\\n  top: 0;\\n  opacity: 0;\\n  z-index: 110;\\n}\\n.game-display--touch-buttons.is-visible {\\n  opacity: 1;\\n}\\n.game-display--touch-buttons.is-left {\\n  left: 0;\\n}\\n.game-display--touch-buttons.is-right {\\n  right: 0;\\n}\\n.game-display--touch-escape-button, .game-display--touch-replay-button, .game-display--touch-fullscreen-button {\\n  position: absolute;\\n  top: 12px;\\n  margin: 0;\\n  padding: 0;\\n  border: 0;\\n  width: 32px;\\n  height: 32px;\\n  background: transparent center center no-repeat;\\n  background-size: 32px 32px;\\n  cursor: pointer;\\n}\\n.game-display--touch-escape-button {\\n  background-image: url(\" + ___CSS_LOADER_URL_REPLACEMENT_1___ + \");\\n  left: 12px;\\n}\\n.game-display--touch-replay-button {\\n  background-image: url(\" + ___CSS_LOADER_URL_REPLACEMENT_2___ + \");\\n  left: 56px;\\n}\\n.game-display--touch-fullscreen-button {\\n  background-image: url(\" + ___CSS_LOADER_URL_REPLACEMENT_3___ + \");\\n  right: 12px;\\n}\\n:root:fullscreen .game-display--touch-fullscreen-button {\\n  display: none;\\n}\\n.game-display--escape-hint {\\n  position: absolute;\\n  left: 12px;\\n  top: 56px;\\n  display: none;\\n  background: #b61a44;\\n  padding: 8px 12px;\\n  color: white;\\n  white-space: nowrap;\\n  border-radius: 8px;\\n  font-weight: bold;\\n  font-size: 1rem;\\n  pointer-events: none;\\n}\\n.game-display--escape-hint.is-shown {\\n  display: block;\\n}\\n.game-display--escape-hint::after {\\n  content: \\\"\\\";\\n  display: block;\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n  top: -8px;\\n  left: 16px;\\n  margin-left: -8px;\\n  border-width: 0 8px 8px 8px;\\n  border-style: solid;\\n  border-color: transparent;\\n  border-bottom-color: #b61a44;\\n}\\n\\n@keyframes game-display--bg-default {\\n  from {\\n    transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    transform: translate(0, -35px);\\n    opacity: 1;\\n  }\\n}\\n@keyframes game-display--bg-down {\\n  from {\\n    transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    transform: translate(0, 35px);\\n    opacity: 1;\\n  }\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./game/display/game-display.scss\"],\"names\":[],\"mappings\":\"AAAA;EACE,cAAA;EACA,cAAA;EACA,gBAAA;EACA,kBAAA;AACF;AACE;EACE,WAAA;EACA,YAAA;EACA,kBAAA;EACA,MAAA;EACA,OAAA;EACA,WAAA;EACA,oEAAA;EACA,sBAAA;EACA,wCAAA;EACA,yBAAA;AACJ;AACE;EACE,qCAAA;AACJ;AAEE;EACE,WAAA;EACA,YAAA;EACA,kBAAA;EACA,UAAA;EACA,SAAA;EACA,WAAA;EACA,UAAA;EACA,wBAAA;EACA,oBAAA;AAAJ;AACI;EACE,UAAA;AACN;AAEE;EACE,6CAAA;AAAJ;AAEE;EACE,6CAAA;AAAJ;AAGE;EACE,WAAA;EACA,YAAA;EACA,cAAA;EACA,iBAAA;EACA,wCAAA;EACA,yBAAA;AADJ;AAGE;EACE,qCAAA;AADJ;AAIE;EACE,kBAAA;EACA,YAAA;AAFJ;AAKE;EACE,eAAA;EACA,wBAAA;EACA,MAAA;EACA,UAAA;EACA,YAAA;AAHJ;AAKE;EACE,UAAA;AAHJ;AAKE;EACE,OAAA;AAHJ;AAKE;EACE,QAAA;AAHJ;AAKE;EAGE,kBAAA;EACA,SAAA;EACA,SAAA;EACA,UAAA;EACA,SAAA;EACA,WAAA;EACA,YAAA;EACA,+CAAA;EACA,0BAAA;EACA,eAAA;AALJ;AAOE;EACE,yDAAA;EACA,UAAA;AALJ;AAOE;EACE,yDAAA;EACA,UAAA;AALJ;AAOE;EACE,yDAAA;EACA,WAAA;AALJ;AAMI;EACE,aAAA;AAJN;AAOE;EACE,kBAAA;EACA,UAAA;EACA,SAAA;EACA,aAAA;EACA,mBAAA;EACA,iBAAA;EACA,YAAA;EACA,mBAAA;EACA,kBAAA;EACA,iBAAA;EACA,eAAA;EACA,oBAAA;AALJ;AAMI;EACE,cAAA;AAJN;AAMI;EACE,WAAA;EACA,cAAA;EACA,kBAAA;EACA,QAAA;EACA,SAAA;EACA,SAAA;EACA,UAAA;EACA,iBAAA;EACA,2BAAA;EACA,mBAAA;EACA,yBAAA;EACA,4BAAA;AAJN;;AASA;EACE;IACE,0BAAA;IACA,UAAA;EANF;EAQA;IACE,8BAAA;IACA,UAAA;EANF;AACF;AASA;EACE;IACE,0BAAA;IACA,UAAA;EAPF;EASA;IACE,6BAAA;IACA,UAAA;EAPF;AACF\",\"sourcesContent\":[\".game-display {\\n  display: block;\\n  margin: 0 auto;\\n  overflow: hidden;\\n  position: relative;\\n\\n  &--bg {\\n    width: 100%;\\n    height: 100%;\\n    position: absolute;\\n    top: 0;\\n    left: 0;\\n    z-index: 10;\\n    background: url(./background/default.jpg) center no-repeat;\\n    background-size: cover;\\n    animation: 1.5s game-display--bg-default;\\n    animation-fill-mode: both;\\n  }\\n  &[data-info-panel-position='top'] &--bg {\\n    animation-name: game-display--bg-down;\\n  }\\n\\n  &--video-bg {\\n    width: 100%;\\n    height: 100%;\\n    position: absolute;\\n    top: -48px;\\n    left: 0px;\\n    z-index: 11;\\n    opacity: 0;\\n    transition: 0.5s opacity;\\n    will-change: opacity;\\n    &.is-playing {\\n      opacity: 1;\\n    }\\n  }\\n  &[data-panel-placement='left'] &--video-bg {\\n    transform: translateX(13.671875%) scale(0.87);\\n  }\\n  &[data-panel-placement='right'] &--video-bg {\\n    transform: translateX(13.671875%) scale(0.87);\\n  }\\n\\n  &--bg img {\\n    width: 100%;\\n    height: 100%;\\n    display: block;\\n    object-fit: cover;\\n    animation: 1.2s game-display--bg-default;\\n    animation-fill-mode: both;\\n  }\\n  &[data-info-panel-position='top'] &--bg img {\\n    animation-name: game-display--bg-down;\\n  }\\n\\n  > canvas {\\n    position: relative;\\n    z-index: 100;\\n  }\\n\\n  &--touch-buttons {\\n    position: fixed;\\n    transform: translateZ(0);\\n    top: 0;\\n    opacity: 0;\\n    z-index: 110;\\n  }\\n  &--touch-buttons.is-visible {\\n    opacity: 1;\\n  }\\n  &--touch-buttons.is-left {\\n    left: 0;\\n  }\\n  &--touch-buttons.is-right {\\n    right: 0;\\n  }\\n  &--touch-escape-button,\\n  &--touch-replay-button,\\n  &--touch-fullscreen-button {\\n    position: absolute;\\n    top: 12px;\\n    margin: 0;\\n    padding: 0;\\n    border: 0;\\n    width: 32px;\\n    height: 32px;\\n    background: transparent center center no-repeat;\\n    background-size: 32px 32px;\\n    cursor: pointer;\\n  }\\n  &--touch-escape-button {\\n    background-image: url(./touch-escape.png);\\n    left: 12px;\\n  }\\n  &--touch-replay-button {\\n    background-image: url(./touch-replay.png);\\n    left: 56px;\\n  }\\n  &--touch-fullscreen-button {\\n    background-image: url(./touch-fullscreen.png);\\n    right: 12px;\\n    :root:fullscreen & {\\n      display: none;\\n    }\\n  }\\n  &--escape-hint {\\n    position: absolute;\\n    left: 12px;\\n    top: 56px;\\n    display: none;\\n    background: #b61a44;\\n    padding: 8px 12px;\\n    color: white;\\n    white-space: nowrap;\\n    border-radius: 8px;\\n    font-weight: bold;\\n    font-size: 1rem;\\n    pointer-events: none;\\n    &.is-shown {\\n      display: block;\\n    }\\n    &::after {\\n      content: '';\\n      display: block;\\n      position: absolute;\\n      width: 0;\\n      height: 0;\\n      top: -8px;\\n      left: 16px;\\n      margin-left: -8px;\\n      border-width: 0 8px 8px 8px;\\n      border-style: solid;\\n      border-color: transparent;\\n      border-bottom-color: #b61a44;\\n    }\\n  }\\n}\\n\\n@keyframes game-display--bg-default {\\n  from {\\n    transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    transform: translate(0, -35px);\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes game-display--bg-down {\\n  from {\\n    transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    transform: translate(0, 35px);\\n    opacity: 1;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".Scene {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  overflow: hidden;\\n  font-family: \\\"Source Sans Pro\\\", \\\"Segoe UI\\\", \\\"Helvetica Neue\\\", sans-serif;\\n}\\n.Scene > .SceneHeading {\\n  position: absolute;\\n  top: 20px;\\n  right: 0;\\n  left: 0;\\n}\\n@media (min-width: 720px) {\\n  .Scene > .SceneHeading {\\n    top: 2rem;\\n  }\\n}\\n.Scene > .SceneToolbar {\\n  position: absolute;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./ui/Scene.scss\",\"webpack://./ui/common.scss\"],\"names\":[],\"mappings\":\"AAEA;ECME,kBAAA;EACA,MAAA;EACA,QAAA;EACA,SAAA;EACA,OAAA;EDRA,gBAAA;EACA,wECDQ;ADIV;AAFE;EACE,kBAAA;EACA,SAAA;EACA,QAAA;EACA,OAAA;AAIJ;AAHI;EALF;IAMI,SAAA;EAMJ;AACF;AAJE;EACE,kBAAA;EACA,QAAA;EACA,SAAA;EACA,OAAA;AAMJ\",\"sourcesContent\":[\"@import './common.scss';\\n\\n.Scene {\\n  @include full-screen;\\n  overflow: hidden;\\n  font-family: $ui-font;\\n  > .SceneHeading {\\n    position: absolute;\\n    top: 20px;\\n    right: 0;\\n    left: 0;\\n    @media (min-width: 720px) {\\n      top: 2rem;\\n    }\\n  }\\n  > .SceneToolbar {\\n    position: absolute;\\n    right: 0;\\n    bottom: 0;\\n    left: 0;\\n  }\\n}\\n\",\"// The common library for user interface.\\n// This file must not emit any CSS code! It can only contain variable,\\n// mixin, or silent class declarations.\\n\\n$ui-font: 'Source Sans Pro', 'Segoe UI', 'Helvetica Neue', sans-serif;\\n$link-color: #039;\\n\\n@mixin full-screen {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n}\\n\\n@mixin full-screen-fixed {\\n  position: fixed;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n}\\n\\n@mixin centered {\\n  position: absolute;\\n  top: 50%;\\n  left: 50%;\\n  transform: translate(-50%, -50%);\\n}\\n\\n@mixin scrolling-y {\\n  overflow-x: hidden;\\n  overflow-y: auto;\\n  -webkit-overflow-scrolling: touch;\\n}\\n\\n@mixin scrolling-x {\\n  overflow-x: auto;\\n  overflow-y: hidden;\\n  -webkit-overflow-scrolling: touch;\\n}\\n\\n@mixin center-content {\\n  display: flex;\\n  justify-content: center;\\n  align-items: center;\\n}\\n\\n@mixin scene-background($url) {\\n  background: $url center no-repeat;\\n  background-size: cover;\\n}\\n\\n@mixin main-bg {\\n  @include scene-background(url(~bemuse/ui/images/bg/a.jpg));\\n}\\n\\n@mixin soft-shadow {\\n  box-shadow: 0 0.1vh 3vh rgba(#000, 0.1);\\n}\\n\\n@mixin button {\\n  font: inherit;\\n  background: #252423 linear-gradient(to bottom, #454443, #151413);\\n  border: 1px solid #555453;\\n  padding: 0.5ex 1.3ex;\\n  color: #fff;\\n  border-radius: 4px;\\n  box-shadow: 0 1px 3px rgba(#000, 0.5);\\n  &:hover {\\n    border-color: #656463;\\n  }\\n  &:focus {\\n    border-color: #8b8685;\\n    outline: 0;\\n  }\\n  &:active {\\n    background: #252423 linear-gradient(to top, #353433, #151413);\\n    border-color: #454443;\\n  }\\n}\\n\\n@mixin input {\\n  font: inherit;\\n  background: #252423 linear-gradient(to bottom, #151413, #292827);\\n  border: 1px solid #555453;\\n  padding: 0.5ex 1.3ex;\\n  color: #fff;\\n  border-radius: 4px;\\n  box-shadow: 0 1px 3px rgba(#000, 0.5);\\n  &:hover {\\n    border-color: #656463;\\n  }\\n  &:focus {\\n    border-color: #8b8685;\\n    outline: 0;\\n  }\\n  &:active {\\n    border-color: #454443;\\n  }\\n  &::selection {\\n    background: #8b8685;\\n    color: #8e8;\\n  }\\n}\\n\\n@mixin input-button-zindex($nominal) {\\n  position: relative;\\n  z-index: $nominal;\\n  &:hover {\\n    z-index: 30;\\n  }\\n  &:focus {\\n    z-index: 40;\\n  }\\n  &:active {\\n    z-index: 10;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","\n      import API from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.2_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.57.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./game-display.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.2_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.57.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./game-display.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import './game-display.scss'\n\nimport $ from 'jquery'\n\nimport PlayerDisplay from './player-display'\nimport formatTime from '../../utils/formatTime'\nimport { shouldDisableFullScreen } from 'bemuse/devtools/query-flags'\nimport screenfull from 'screenfull'\n\nexport class GameDisplay {\n  constructor({ game, context, backgroundImagePromise, video }) {\n    this._game = game\n    this._context = context\n    const skinData = context.skinData\n    this._players = new Map(\n      game.players.map((player) => [\n        player,\n        new PlayerDisplay(player, skinData),\n      ])\n    )\n    this._stateful = {}\n    this._wrapper = this._createWrapper({\n      backgroundImagePromise,\n      video,\n      panelPlacement: game.players[0].options.placement,\n      infoPanelPosition: skinData.infoPanelPosition,\n    })\n    this._createTouchEscapeButton()\n    this._createFullScreenButton()\n    this._escapeHintShown = false\n  }\n\n  setEscapeHandler(escapeHandler) {\n    this._onEscape = escapeHandler\n  }\n\n  setReplayHandler(replayHandler) {\n    this._onReplay = replayHandler\n  }\n\n  start() {\n    this._started = new Date().getTime()\n    const player = this._game.players[0]\n    const songInfo = player.notechart.songInfo\n    const prefix = player.options.autoplayEnabled ? '[AUTOPLAY] ' : ''\n    this._stateful['song_title'] = prefix + songInfo.title\n    this._stateful['song_artist'] = songInfo.artist\n    this._duration = player.notechart.duration\n  }\n\n  destroy() {\n    this._context.destroy()\n  }\n\n  update(gameTime, gameState) {\n    const time = (new Date().getTime() - this._started) / 1000\n    const data = this._getData(time, gameTime, gameState)\n    this._updateStatefulData(time, gameTime, gameState)\n    this._context.render(Object.assign({}, this._stateful, data))\n    this._synchronizeVideo(gameTime)\n    this._synchronizeTutorialEscapeHint(gameTime)\n  }\n\n  _synchronizeVideo(gameTime) {\n    if (this._video && !this._videoStarted && gameTime >= this._videoOffset) {\n      this._video.volume = 0\n      this._video.play()\n      this._video.classList.add('is-playing')\n      this._videoStarted = true\n    }\n  }\n\n  _synchronizeTutorialEscapeHint(gameTime) {\n    if (this._game.options.tutorial) {\n      const TUTORIAL_ESCAPE_HINT_SHOW_TIME = 101.123595506\n      if (\n        gameTime >= TUTORIAL_ESCAPE_HINT_SHOW_TIME &&\n        !this._escapeHintShown\n      ) {\n        this._escapeHintShown = true\n        this._escapeHint.classList.add('is-shown')\n      }\n    }\n  }\n\n  _getData(time, gameTime, gameState) {\n    const data = {}\n    data['tutorial'] = this._game.options.tutorial ? 'yes' : 'no'\n    data['t'] = time\n    data['gameTime'] = gameTime\n    data['ready'] = this._getReady(gameState)\n    data['song_time'] = this._getSongTime(gameTime)\n    for (const [player, playerDisplay] of this._players) {\n      const playerState = gameState.player(player)\n      const playerData = playerDisplay.update(time, gameTime, playerState)\n      for (const key in playerData) {\n        data[`p${player.number}_${key}`] = playerData[key]\n      }\n    }\n    return data\n  }\n\n  _updateStatefulData(time, gameTime, gameState) {\n    const data = this._stateful\n    if (data['started'] === undefined && gameState.started) {\n      data['started'] = time\n    }\n    if (data['gettingStarted'] === undefined && gameState.gettingStarted) {\n      data['gettingStarted'] = time\n    }\n  }\n\n  _getSongTime(gameTime) {\n    return (\n      formatTime(Math.min(this._duration, Math.max(0, gameTime))) +\n      ' / ' +\n      formatTime(this._duration)\n    )\n  }\n\n  _getReady(gameState) {\n    const f = gameState.readyFraction\n    return f > 0.5 ? Math.pow(1 - (f - 0.5) / 0.5, 2) : 0\n  }\n\n  _createWrapper({\n    backgroundImagePromise,\n    video,\n    panelPlacement,\n    infoPanelPosition,\n  }) {\n    const $wrapper = $('<div class=\"game-display\"></div>')\n      .attr('data-panel-placement', panelPlacement)\n      .attr('data-info-panel-position', infoPanelPosition)\n      .append('<div class=\"game-display--bg js-back-image\"></div>')\n      .append(this.view)\n    if (backgroundImagePromise) {\n      Promise.resolve(backgroundImagePromise).then((image) =>\n        $wrapper.find('.js-back-image').append(image)\n      )\n    }\n    if (video) {\n      this._video = video.element\n      this._videoOffset = video.offset\n      $(video.element).addClass('game-display--video-bg').appendTo($wrapper)\n    }\n    return $wrapper[0]\n  }\n\n  _createTouchEscapeButton() {\n    const touchButtons = document.createElement('div')\n    touchButtons.className = 'game-display--touch-buttons is-left'\n    this.wrapper.appendChild(touchButtons)\n    touchButtons.classList.add('is-visible')\n    const addTouchButton = (className, onClick) => {\n      const button = createTouchButton(onClick, className)\n      touchButtons.appendChild(button)\n    }\n    addTouchButton('game-display--touch-escape-button', () => this._onEscape())\n    addTouchButton('game-display--touch-replay-button', () => this._onReplay())\n\n    const escapeHint = document.createElement('div')\n    escapeHint.textContent = 'Click or press Esc to exit the tutorial'\n    escapeHint.className = 'game-display--escape-hint'\n    this._escapeHint = escapeHint\n    touchButtons.appendChild(escapeHint)\n  }\n\n  _createFullScreenButton() {\n    if (shouldDisableFullScreen() || !screenfull.enabled) {\n      return\n    }\n    const touchButtons = document.createElement('div')\n    touchButtons.className = 'game-display--touch-buttons is-visible is-right'\n    this.wrapper.appendChild(touchButtons)\n    const onClick = () => {\n      screenfull.request()\n    }\n    const button = createTouchButton(\n      onClick,\n      'game-display--touch-fullscreen-button'\n    )\n    touchButtons.appendChild(button)\n  }\n\n  get context() {\n    return this._context\n  }\n\n  get view() {\n    return this._context.view\n  }\n\n  get wrapper() {\n    return this._wrapper\n  }\n}\n\nfunction createTouchButton(onClick, className) {\n  const button = document.createElement('button')\n  button.addEventListener(\n    'touchstart',\n    (e) => {\n      e.stopPropagation()\n    },\n    true\n  )\n  button.onclick = (e) => {\n    e.preventDefault()\n    onClick()\n  }\n  button.className = className\n  return button\n}\n\nexport default GameDisplay\n","import Player, { PlayerOptionsInput } from './player'\nimport Notechart from 'bemuse-notechart'\n\nexport type GamePlayerOptionsInput = {\n  players: Omit<PlayerOptionsInput, 'autosound' | 'tutorial'>[]\n  audioInputLatency: number\n  tutorial: boolean\n  soundVolume: number\n}\n\n/**\n * The Game model holds the game's options and the player objects.\n * This class represents all the data needed to start a game.\n * However, it is immutable.  See `GameState` for mutable stuff.\n */\nexport class Game {\n  /** The Game's players */\n  public players: Player[]\n\n  constructor(\n    notecharts: Notechart[],\n    public readonly options: GamePlayerOptionsInput\n  ) {\n    this.players = options.players.map(function (playerOptions, index) {\n      playerOptions = Object.assign({}, playerOptions, {\n        autosound: options.audioInputLatency >= 0.01,\n        tutorial: options.tutorial,\n      })\n      return new Player(notecharts[index], index + 1, playerOptions)\n    })\n  }\n\n  /** A list of all sound samples used in game. Used for loading sounds. */\n  get samples() {\n    const set = new Set()\n    for (const player of this.players) {\n      for (const sample of player.notechart.samples) {\n        set.add(sample)\n      }\n    }\n    return Array.from(set)\n  }\n}\n\nexport default Game\n","import PlayerState from './player-state'\nimport Game from '../game'\nimport Player from '../player'\nimport GameInput from '../input'\nimport GameTimer from '../game-timer'\nimport invariant from 'invariant'\n\nexport class GameState {\n  /** See Timer#readyFraction. We need it here so that the display can read this information. */\n  public readyFraction = 0\n  /** True if the the player is getting started (i.e. holding down the start button for the first time), false otherwise. */\n  public gettingStarted = false\n  /** True if the game is started, false otherwise. */\n  public started = false\n  /** True if the game is finished, false otherwise. */\n  public finished = false\n\n  private _players: Map<Player, PlayerState>\n\n  constructor(public readonly game: Game) {\n    this._players = new Map(\n      game.players.map((player) => [player, new PlayerState(player)])\n    )\n  }\n\n  update(gameTime: number, input: GameInput, timer: GameTimer) {\n    let finished = true\n    for (const [player, playerState] of this._players) {\n      playerState.update(gameTime, input)\n      if (!playerState.finished) finished = false\n      void player\n    }\n    this.readyFraction = timer.readyFraction\n    this.gettingStarted = timer.gettingStarted\n    this.started = timer.started\n    this.finished = finished\n  }\n\n  player(p: Player) {\n    const playerState = this._players.get(p)\n    return (\n      playerState ||\n      invariant(\n        false,\n        'Invariant violation: No player state found for player %s',\n        p.number\n      )\n    )\n  }\n}\n\nexport default GameState\n","import {\n  ARCHIVE_REGEXP,\n  CustomSongResources,\n  downloadFileEntryFromURL,\n} from './custom-song-resources'\nimport { FileEntry, ICustomSongResources, LoggingFunction } from './types'\n\nimport { addUnprefixed } from './addUnprefixed'\n\n// TODO [#634]: Remove the `DndResources` class and have users of this class create a `CustomSongResources` directly.\n//\n// The original implementation of DndResources class has been extracted\n// into a CustomSongResources superclass in commit cc6a6e70586487ef476890f5a7911837186a7a32,\n// so that part of its logic can be re-used in other contexts, such as in commit ba9e15bab72fec17a144e40433cb3a4ffd31db5b.\n//\n// Now this `DndResources` class is really dumb and we want to prefer composition over inheritance.\n// This class should be removed.\nexport class DndResources\n  extends CustomSongResources\n  implements ICustomSongResources\n{\n  constructor(event: DragEvent) {\n    super({\n      getFiles: (log) => getFilesFromEvent(event, log),\n    })\n  }\n}\n\nexport default DndResources\n\nasync function getFilesFromEvent(\n  event: DragEvent,\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const dataTransfer = event.dataTransfer\n  if (!dataTransfer) {\n    throw new Error('Expect event.dataTransfer to be present')\n  }\n  if (dataTransfer.types.indexOf('text/uri-list') > -1) {\n    const url = dataTransfer\n      .getData('text/uri-list')\n      .split(/\\r\\n|\\r|\\n/)\n      .filter((t) => t && !t.startsWith('#'))[0]\n    if (ARCHIVE_REGEXP.test(url && url.replace(/[?#].*/, ''))) {\n      log('Link to archive file detected. Trying to download')\n      return [await downloadFileEntryFromURL(url, log)]\n    }\n  } else if (dataTransfer.items) {\n    for (const item of Array.from(dataTransfer.items)) {\n      await readItem(item)\n    }\n  } else if (dataTransfer.files) {\n    for (const file of Array.from(dataTransfer.files)) {\n      addFile(file)\n    }\n  }\n  return out\n\n  async function readItem(item: DataTransferItem) {\n    const entry = item.webkitGetAsEntry && item.webkitGetAsEntry()\n    if (entry) {\n      await readEntry(entry)\n    } else {\n      const file = item.getAsFile && item.getAsFile()\n      if (file) addFile(file)\n    }\n  }\n\n  function readEntry(entry: any, prefix = '') {\n    if (entry.isFile) {\n      return readFile(entry, prefix)\n    } else if (entry.isDirectory) {\n      return readDirectory(entry, prefix)\n    }\n  }\n\n  async function readFile(entry: any, prefix = '') {\n    const file = await new Promise<File>((resolve, reject) => {\n      entry.file(resolve, reject)\n    })\n    addFile(file, prefix)\n    return file\n  }\n\n  async function readDirectory(dir: any, prefix = '') {\n    const entries: any[] = []\n    const reader = dir.createReader()\n    const readMore = () =>\n      new Promise<any>((resolve, reject) => {\n        reader.readEntries(resolve, reject)\n      })\n    for (;;) {\n      const results = await readMore()\n      if (!results || results.length === 0) break\n      entries.push(...Array.from(results))\n    }\n    for (const entry of entries) {\n      await readEntry(entry, prefix + dir.name + '/')\n    }\n  }\n\n  function addFile(file: File, prefix = '') {\n    if (file) {\n      addUnprefixed(prefix, file.name, (name) => {\n        out.push({ name, file })\n      })\n    }\n  }\n}\n","import React, { ReactNode, createContext } from 'react'\nimport { Root, createRoot } from 'react-dom/client'\n\nimport MAIN from 'bemuse/utils/main-element'\n\nexport type TeardownCallback = () => PromiseLike<void> | void\n\nexport type ReactScene = (container: Element, root: Root) => ReactSceneInstance\n\nexport interface ReactSceneInstance {\n  teardown: TeardownCallback\n}\n\nexport type SceneContainer = (props: { children: ReactNode }) => JSX.Element\n\nexport class SceneManager {\n  constructor(private readonly ReactSceneContainer: SceneContainer) {}\n\n  transitioning = false\n  stack: ReactScene[] = []\n  current:\n    | {\n        scene: ReactScene\n        instance: ReactSceneInstance\n        root: Root\n      }\n    | undefined\n\n  display(scene: ReactScene | JSX.Element) {\n    return this.transitionTo(scene)\n  }\n\n  push(scene: ReactScene | JSX.Element) {\n    if (this.current) {\n      this.stack.push(this.current.scene)\n    }\n    return this.transitionTo(scene)\n  }\n\n  async pop() {\n    const last = this.stack.pop()\n    if (last) {\n      await this.transitionTo(last)\n    }\n  }\n\n  private async transitionTo(sceneOrElement: ReactScene | JSX.Element) {\n    if (this.transitioning) throw new Error('Scene is transitioning!')\n    try {\n      this.transitioning = true\n\n      // detach the previous scene\n      if (this.current) {\n        await Promise.resolve(this.current.instance.teardown())\n        this.current.root.unmount()\n      }\n\n      // coerce react elements\n      const scene =\n        typeof sceneOrElement === 'function'\n          ? sceneOrElement\n          : ReactScene(sceneOrElement, this.ReactSceneContainer)\n\n      // set up the next scene\n      const element = document.createElement('div')\n      element.className = 'scene-manager--scene'\n      MAIN?.appendChild(element)\n      const sceneRoot = createRoot(element)\n      const instance = scene(element, sceneRoot)\n      this.current = {\n        scene,\n        instance,\n        root: sceneRoot,\n      }\n    } finally {\n      this.transitioning = false\n    }\n  }\n}\n\nfunction ReactScene(\n  scene: JSX.Element,\n  ReactSceneContainer: SceneContainer\n): ReactScene {\n  return function instantiate(_element, root) {\n    let teardown: TeardownCallback = () => {}\n    const clonedElement = React.cloneElement(scene, {\n      registerTeardownCallback: (callback: TeardownCallback) => {\n        teardown = callback\n      },\n    })\n    root.render(<ReactSceneContainer>{clonedElement}</ReactSceneContainer>)\n    return {\n      async teardown() {\n        try {\n          return await teardown()\n        } finally {\n          root.unmount()\n        }\n      },\n    }\n  }\n}\n\nexport const SceneManagerContext = createContext<SceneManager>(\n  // `defaultValue` should be `undefined` because there is no way to create it.\n  undefined as unknown as SceneManager\n)\n","\n      import API from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.2_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.57.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./Scene.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.2_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.57.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./Scene.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import './Scene.scss'\n\nimport React, { DragEvent, ForwardedRef, forwardRef } from 'react'\n\nimport c from 'classnames'\n\nexport interface SceneProps {\n  className: string\n  children: ReactNode\n  onDragEnter?: (e: DragEvent<HTMLDivElement>) => void\n}\n\nconst Scene = (\n  { className, children, onDragEnter }: SceneProps,\n  ref: ForwardedRef<HTMLDivElement>\n) => (\n  <div ref={ref} className={c('Scene', className)} onDragEnter={onDragEnter}>\n    {children}\n  </div>\n)\n\nexport default forwardRef(Scene)\n","import { createRoot } from 'react-dom/client'\n\nconst sceneRootElement = document.querySelector('#scene-root')\n\nif (!sceneRootElement) {\n  throw new Error('The scene root element `#scene-root` not found')\n}\n\nexport const sceneRoot = createRoot(sceneRootElement)\n\nexport default sceneRootElement\n"],"names":["___CSS_LOADER_URL_IMPORT_0___","URL","___CSS_LOADER_URL_IMPORT_1___","___CSS_LOADER_URL_IMPORT_2___","___CSS_LOADER_URL_IMPORT_3___","___CSS_LOADER_EXPORT___","___CSS_LOADER_URL_REPLACEMENT_0___","___CSS_LOADER_URL_REPLACEMENT_1___","___CSS_LOADER_URL_REPLACEMENT_2___","___CSS_LOADER_URL_REPLACEMENT_3___","push","module","id","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","createTouchButton","onClick","className","button","document","createElement","addEventListener","e","stopPropagation","onclick","preventDefault","constructor","game","context","backgroundImagePromise","video","this","_game","_context","skinData","_players","Map","players","map","player","_stateful","_wrapper","_createWrapper","panelPlacement","placement","infoPanelPosition","_createTouchEscapeButton","_createFullScreenButton","_escapeHintShown","setEscapeHandler","escapeHandler","_onEscape","setReplayHandler","replayHandler","_onReplay","start","_started","Date","getTime","songInfo","notechart","prefix","autoplayEnabled","title","artist","_duration","duration","destroy","update","gameTime","gameState","time","data","_getData","_updateStatefulData","render","Object","assign","_synchronizeVideo","_synchronizeTutorialEscapeHint","_video","_videoStarted","_videoOffset","volume","play","classList","add","tutorial","_escapeHint","_getReady","_getSongTime","playerDisplay","playerState","playerData","key","number","undefined","started","gettingStarted","formatTime","Math","min","max","f","readyFraction","pow","$wrapper","attr","append","view","Promise","resolve","then","image","find","element","offset","addClass","appendTo","touchButtons","wrapper","appendChild","addTouchButton","escapeHint","textContent","notecharts","playerOptions","index","autosound","audioInputLatency","samples","set","Set","sample","Array","from","finished","input","timer","p","get","DndResources","event","super","getFiles","log","async","out","dataTransfer","Error","types","indexOf","url","getData","split","filter","t","startsWith","replace","items","item","readItem","files","file","addFile","entry","webkitGetAsEntry","readEntry","getAsFile","isFile","readFile","isDirectory","readDirectory","reject","dir","entries","reader","createReader","readMore","readEntries","results","length","name","getFilesFromEvent","SceneManager","ReactSceneContainer","transitioning","stack","display","scene","transitionTo","current","last","pop","sceneOrElement","instance","teardown","root","unmount","_element","clonedElement","registerTeardownCallback","callback","ReactScene","sceneRoot","SceneManagerContext","createContext","forwardRef","children","onDragEnter","ref","sceneRootElement","querySelector"],"sourceRoot":""}