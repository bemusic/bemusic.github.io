{"version":3,"file":"build/289-f61bc37649b970338534.js","mappings":"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","sources":["file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/baconjs@0.7.95/node_modules/baconjs/dist/Bacon.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/bytes@3.1.2/node_modules/bytes/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/delay@5.0.0/node_modules/delay/index.js"],"sourcesContent":["(function() {\nvar _slice = Array.prototype.slice;\nvar Bacon = {\n  toString: function () {\n    return \"Bacon\";\n  }\n};\n\nBacon.version = '0.7.95';\n\nvar Exception = (typeof global !== \"undefined\" && global !== null ? global : this).Error;\nvar nop = function () {};\nvar latter = function (_, x) {\n  return x;\n};\nvar former = function (x, _) {\n  return x;\n};\nvar cloneArray = function (xs) {\n  return xs.slice(0);\n};\nvar assert = function (message, condition) {\n  if (!condition) {\n    throw new Exception(message);\n  }\n};\nvar assertObservableIsProperty = function (x) {\n  if ((x != null ? x._isObservable : void 0) && !(x != null ? x._isProperty : void 0)) {\n    throw new Exception(\"Observable is not a Property : \" + x);\n  }\n};\nvar assertEventStream = function (event) {\n  if (!(event != null ? event._isEventStream : void 0)) {\n    throw new Exception(\"not an EventStream : \" + event);\n  }\n};\n\nvar assertObservable = function (event) {\n  if (!(event != null ? event._isObservable : void 0)) {\n    throw new Exception(\"not an Observable : \" + event);\n  }\n};\nvar assertFunction = function (f) {\n  return assert(\"not a function : \" + f, _.isFunction(f));\n};\nvar isArray = Array.isArray || function (xs) {\n  return xs instanceof Array;\n};\nvar isObservable = function (x) {\n  return x && x._isObservable;\n};\nvar assertArray = function (xs) {\n  if (!isArray(xs)) {\n    throw new Exception(\"not an array : \" + xs);\n  }\n};\nvar assertNoArguments = function (args) {\n  return assert(\"no arguments supported\", args.length === 0);\n};\nvar assertString = function (x) {\n  if (typeof x === \"string\") {\n    throw new Exception(\"not a string : \" + x);\n  }\n};\n\nvar extend = function (target) {\n  var length = arguments.length;\n  for (var i = 1; 1 < length ? i < length : i > length; 1 < length ? i++ : i--) {\n    for (var prop in arguments[i]) {\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n\nvar inherit = function (child, parent) {\n  var hasProp = ({}).hasOwnProperty;\n  var ctor = function () {};\n  ctor.prototype = parent.prototype;\n  child.prototype = new ctor();\n  for (var key in parent) {\n    if (hasProp.call(parent, key)) {\n      child[key] = parent[key];\n    }\n  }\n  return child;\n};\n\nvar symbol = function (key) {\n  if (typeof Symbol !== \"undefined\" && Symbol[key]) {\n    return Symbol[key];\n  } else if (typeof Symbol !== \"undefined\" && typeof Symbol[\"for\"] === \"function\") {\n    return Symbol[key] = Symbol[\"for\"](key);\n  } else {\n    return \"@@\" + key;\n  }\n};\n\nvar _ = {\n  indexOf: (function () {\n    if (Array.prototype.indexOf) {\n      return function (xs, x) {\n        return xs.indexOf(x);\n      };\n    } else {\n      return function (xs, x) {\n        for (var i = 0, y; i < xs.length; i++) {\n          y = xs[i];\n          if (x === y) {\n            return i;\n          }\n        }\n        return -1;\n      };\n    }\n  })(),\n  indexWhere: function (xs, f) {\n    for (var i = 0, y; i < xs.length; i++) {\n      y = xs[i];\n      if (f(y)) {\n        return i;\n      }\n    }\n    return -1;\n  },\n  head: function (xs) {\n    return xs[0];\n  },\n  always: function (x) {\n    return function () {\n      return x;\n    };\n  },\n  negate: function (f) {\n    return function (x) {\n      return !f(x);\n    };\n  },\n  empty: function (xs) {\n    return xs.length === 0;\n  },\n  tail: function (xs) {\n    return xs.slice(1, xs.length);\n  },\n  filter: function (f, xs) {\n    var filtered = [];\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        filtered.push(x);\n      }\n    }\n    return filtered;\n  },\n  map: function (f, xs) {\n    return (function () {\n      var result = [];\n      for (var i = 0, x; i < xs.length; i++) {\n        x = xs[i];\n        result.push(f(x));\n      }\n      return result;\n    })();\n  },\n  each: function (xs, f) {\n    for (var key in xs) {\n      if (Object.prototype.hasOwnProperty.call(xs, key)) {\n        var value = xs[key];\n        f(key, value);\n      }\n    }\n  },\n  toArray: function (xs) {\n    return isArray(xs) ? xs : [xs];\n  },\n  contains: function (xs, x) {\n    return _.indexOf(xs, x) !== -1;\n  },\n  id: function (x) {\n    return x;\n  },\n  last: function (xs) {\n    return xs[xs.length - 1];\n  },\n  all: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (!f(x)) {\n        return false;\n      }\n    }\n    return true;\n  },\n  any: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        return true;\n      }\n    }\n    return false;\n  },\n  without: function (x, xs) {\n    return _.filter(function (y) {\n      return y !== x;\n    }, xs);\n  },\n  remove: function (x, xs) {\n    var i = _.indexOf(xs, x);\n    if (i >= 0) {\n      return xs.splice(i, 1);\n    }\n  },\n  fold: function (xs, seed, f) {\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      seed = f(seed, x);\n    }\n    return seed;\n  },\n  flatMap: function (f, xs) {\n    return _.fold(xs, [], function (ys, x) {\n      return ys.concat(f(x));\n    });\n  },\n  cached: function (f) {\n    var value = None;\n    return function () {\n      if (typeof value !== \"undefined\" && value !== null ? value._isNone : undefined) {\n        value = f();\n        f = undefined;\n      }\n      return value;\n    };\n  },\n  bind: function (fn, me) {\n    return function () {\n      return fn.apply(me, arguments);\n    };\n  },\n  isFunction: function (f) {\n    return typeof f === \"function\";\n  },\n  toString: function (obj) {\n    var internals, key, value;\n    var hasProp = ({}).hasOwnProperty;\n    try {\n      recursionDepth++;\n      if (obj == null) {\n        return \"undefined\";\n      } else if (_.isFunction(obj)) {\n        return \"function\";\n      } else if (isArray(obj)) {\n        if (recursionDepth > 5) {\n          return \"[..]\";\n        }\n        return \"[\" + _.map(_.toString, obj).toString() + \"]\";\n      } else if ((obj != null ? obj.toString : void 0) != null && obj.toString !== Object.prototype.toString) {\n        return obj.toString();\n      } else if (typeof obj === \"object\") {\n        if (recursionDepth > 5) {\n          return \"{..}\";\n        }\n        internals = (function () {\n          var results = [];\n          for (key in obj) {\n            if (!hasProp.call(obj, key)) continue;\n            value = (function () {\n              var error;\n              try {\n                return obj[key];\n              } catch (error) {\n                return error;\n              }\n            })();\n            results.push(_.toString(key) + \":\" + _.toString(value));\n          }\n          return results;\n        })();\n        return \"{\" + internals + \"}\";\n      } else {\n        return obj;\n      }\n    } finally {\n      recursionDepth--;\n    }\n  }\n};\n\nvar recursionDepth = 0;\n\nBacon._ = _;\n\nvar UpdateBarrier = Bacon.UpdateBarrier = (function () {\n  var rootEvent;\n  var waiterObs = [];\n  var waiters = {};\n  var aftersStack = [];\n  var aftersStackHeight = 0;\n  var flushed = {};\n\n  function ensureStackHeight(h) {\n    if (h <= aftersStackHeight) return;\n    if (!aftersStack[h - 1]) {\n      aftersStack[h - 1] = [[], 0];\n    }\n    aftersStackHeight = h;\n  }\n\n  var afterTransaction = function (obs, f) {\n    if (rootEvent || aftersStack.length) {\n      ensureStackHeight(1);\n      var stackIndexForThisObs = 0;\n      while (stackIndexForThisObs < aftersStackHeight - 1) {\n        if (containsObs(obs, aftersStack[stackIndexForThisObs][0])) {\n          break;\n        }\n        stackIndexForThisObs++;\n      }\n      var listFromStack = aftersStack[stackIndexForThisObs][0];\n      listFromStack.push([obs, f]);\n      if (!rootEvent) {\n        processAfters();\n      }\n    } else {\n        return f();\n      }\n  };\n\n  function containsObs(obs, aftersList) {\n    for (var i = 0; i < aftersList.length; i++) {\n      if (aftersList[i][0].id == obs.id) return true;\n    }\n    return false;\n  }\n\n  function processAfters() {\n    var stackSizeAtStart = aftersStackHeight;\n    if (!stackSizeAtStart) return;\n    while (aftersStackHeight >= stackSizeAtStart) {\n      var topOfStack = aftersStack[aftersStackHeight - 1];\n      if (!topOfStack) throw new Error(\"Unexpected stack top: \" + topOfStack);\n      var topAfters = topOfStack[0];\n      var index = topOfStack[1];\n\n      if (index < topAfters.length) {\n        var _topAfters$index = topAfters[index];\n        var obs = _topAfters$index[0];\n        var after = _topAfters$index[1];\n\n        topOfStack[1]++;\n        ensureStackHeight(aftersStackHeight + 1);\n        var callSuccess = false;\n        try {\n          after();\n          callSuccess = true;\n          while (aftersStackHeight > stackSizeAtStart && aftersStack[aftersStackHeight - 1][0].length == 0) {\n            aftersStackHeight--;\n          }\n        } finally {\n          if (!callSuccess) {\n            aftersStack = [];\n            aftersStackHeight = 0;\n          }\n        }\n      } else {\n          topOfStack[0] = [];\n          topOfStack[1] = 0;\n          break;\n        }\n    }\n  }\n\n  var whenDoneWith = function (obs, f) {\n    if (rootEvent) {\n      var obsWaiters = waiters[obs.id];\n      if (!(typeof obsWaiters !== \"undefined\" && obsWaiters !== null)) {\n        obsWaiters = waiters[obs.id] = [f];\n        return waiterObs.push(obs);\n      } else {\n        return obsWaiters.push(f);\n      }\n    } else {\n      return f();\n    }\n  };\n\n  var flush = function () {\n    while (waiterObs.length > 0) {\n      flushWaiters(0, true);\n    }\n    flushed = {};\n  };\n\n  var flushWaiters = function (index, deps) {\n    var obs = waiterObs[index];\n    var obsId = obs.id;\n    var obsWaiters = waiters[obsId];\n    waiterObs.splice(index, 1);\n    delete waiters[obsId];\n    if (deps && waiterObs.length > 0) {\n      flushDepsOf(obs);\n    }\n    for (var i = 0, f; i < obsWaiters.length; i++) {\n      f = obsWaiters[i];\n      f();\n    }\n  };\n\n  var flushDepsOf = function (obs) {\n    if (flushed[obs.id]) return;\n    var deps = obs.internalDeps();\n    for (var i = 0, dep; i < deps.length; i++) {\n      dep = deps[i];\n      flushDepsOf(dep);\n      if (waiters[dep.id]) {\n        var index = _.indexOf(waiterObs, dep);\n        flushWaiters(index, false);\n      }\n    }\n    flushed[obs.id] = true;\n  };\n\n  var inTransaction = function (event, context, f, args) {\n    if (rootEvent) {\n      return f.apply(context, args);\n    } else {\n      rootEvent = event;\n      try {\n        var result = f.apply(context, args);\n\n        flush();\n      } finally {\n        rootEvent = undefined;\n        processAfters();\n      }\n      return result;\n    }\n  };\n\n  var currentEventId = function () {\n    return rootEvent ? rootEvent.id : undefined;\n  };\n\n  var wrappedSubscribe = function (obs, sink) {\n    var unsubd = false;\n    var shouldUnsub = false;\n    var doUnsub = function () {\n      shouldUnsub = true;\n      return shouldUnsub;\n    };\n    var unsub = function () {\n      unsubd = true;\n      return doUnsub();\n    };\n    doUnsub = obs.dispatcher.subscribe(function (event) {\n      return afterTransaction(obs, function () {\n        if (!unsubd) {\n          var reply = sink(event);\n          if (reply === Bacon.noMore) {\n            return unsub();\n          }\n        }\n      });\n    });\n    if (shouldUnsub) {\n      doUnsub();\n    }\n    return unsub;\n  };\n\n  var hasWaiters = function () {\n    return waiterObs.length > 0;\n  };\n\n  return { whenDoneWith: whenDoneWith, hasWaiters: hasWaiters, inTransaction: inTransaction, currentEventId: currentEventId, wrappedSubscribe: wrappedSubscribe, afterTransaction: afterTransaction };\n})();\n\nfunction Source(obs, sync) {\n  var lazy = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n  this.obs = obs;\n  this.sync = sync;\n  this.lazy = lazy;\n  this.queue = [];\n}\n\nextend(Source.prototype, {\n  _isSource: true,\n\n  subscribe: function (sink) {\n    return this.obs.dispatcher.subscribe(sink);\n  },\n  toString: function () {\n    return this.obs.toString();\n  },\n  markEnded: function () {\n    this.ended = true;\n    return true;\n  },\n  consume: function () {\n    if (this.lazy) {\n      return { value: _.always(this.queue[0]) };\n    } else {\n      return this.queue[0];\n    }\n  },\n  push: function (x) {\n    this.queue = [x];\n    return [x];\n  },\n  mayHave: function () {\n    return true;\n  },\n  hasAtLeast: function () {\n    return this.queue.length;\n  },\n  flatten: true\n});\n\nfunction ConsumingSource() {\n  Source.apply(this, arguments);\n}\n\ninherit(ConsumingSource, Source);\nextend(ConsumingSource.prototype, {\n  consume: function () {\n    return this.queue.shift();\n  },\n  push: function (x) {\n    return this.queue.push(x);\n  },\n  mayHave: function (c) {\n    return !this.ended || this.queue.length >= c;\n  },\n  hasAtLeast: function (c) {\n    return this.queue.length >= c;\n  },\n  flatten: false\n});\n\nfunction BufferingSource(obs) {\n  Source.call(this, obs, true);\n}\n\ninherit(BufferingSource, Source);\nextend(BufferingSource.prototype, {\n  consume: function () {\n    var values = this.queue;\n    this.queue = [];\n    return {\n      value: function () {\n        return values;\n      }\n    };\n  },\n  push: function (x) {\n    return this.queue.push(x.value());\n  },\n  hasAtLeast: function () {\n    return true;\n  }\n});\n\nSource.isTrigger = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s.sync;\n  } else {\n    return s != null ? s._isEventStream : void 0;\n  }\n};\n\nSource.fromObservable = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s;\n  } else if (s != null ? s._isProperty : void 0) {\n    return new Source(s, false);\n  } else {\n    return new ConsumingSource(s, true);\n  }\n};\n\nfunction Desc(context, method, args) {\n  this.context = context;\n  this.method = method;\n  this.args = args;\n}\n\nextend(Desc.prototype, {\n  _isDesc: true,\n  deps: function () {\n    if (!this.cached) {\n      this.cached = findDeps([this.context].concat(this.args));\n    }\n    return this.cached;\n  },\n  toString: function () {\n    return _.toString(this.context) + \".\" + _.toString(this.method) + \"(\" + _.map(_.toString, this.args) + \")\";\n  }\n});\n\nvar describe = function (context, method) {\n  var ref = context || method;\n  if (ref && ref._isDesc) {\n    return context || method;\n  } else {\n    for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n\n    return new Desc(context, method, args);\n  }\n};\n\nvar withDesc = function (desc, obs) {\n  obs.desc = desc;\n  return obs;\n};\n\nvar findDeps = function (x) {\n  if (isArray(x)) {\n    return _.flatMap(findDeps, x);\n  } else if (isObservable(x)) {\n    return [x];\n  } else if (typeof x !== \"undefined\" && x !== null ? x._isSource : undefined) {\n    return [x.obs];\n  } else {\n    return [];\n  }\n};\n\nBacon.Desc = Desc;\nBacon.Desc.empty = new Bacon.Desc(\"\", \"\", []);\n\nvar withMethodCallSupport = function (wrapped) {\n  return function (f) {\n    for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    if (typeof f === \"object\" && args.length) {\n      var context = f;\n      var methodName = args[0];\n      f = function () {\n        return context[methodName].apply(context, arguments);\n      };\n      args = args.slice(1);\n    }\n    return wrapped.apply(undefined, [f].concat(args));\n  };\n};\n\nvar makeFunctionArgs = function (args) {\n  args = Array.prototype.slice.call(args);\n  return makeFunction_.apply(undefined, args);\n};\n\nvar partiallyApplied = function (f, applied) {\n  return function () {\n    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return f.apply(undefined, applied.concat(args));\n  };\n};\n\nvar toSimpleExtractor = function (args) {\n  return function (key) {\n    return function (value) {\n      if (!(typeof value !== \"undefined\" && value !== null)) {\n        return;\n      } else {\n        var fieldValue = value[key];\n        if (_.isFunction(fieldValue)) {\n          return fieldValue.apply(value, args);\n        } else {\n          return fieldValue;\n        }\n      }\n    };\n  };\n};\n\nvar toFieldExtractor = function (f, args) {\n  var parts = f.slice(1).split(\".\");\n  var partFuncs = _.map(toSimpleExtractor(args), parts);\n  return function (value) {\n    for (var i = 0, f; i < partFuncs.length; i++) {\n      f = partFuncs[i];\n      value = f(value);\n    }\n    return value;\n  };\n};\n\nvar isFieldKey = function (f) {\n  return typeof f === \"string\" && f.length > 1 && f.charAt(0) === \".\";\n};\n\nvar makeFunction_ = withMethodCallSupport(function (f) {\n  for (var _len4 = arguments.length, args = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n    args[_key4 - 1] = arguments[_key4];\n  }\n\n  if (_.isFunction(f)) {\n    if (args.length) {\n      return partiallyApplied(f, args);\n    } else {\n      return f;\n    }\n  } else if (isFieldKey(f)) {\n    return toFieldExtractor(f, args);\n  } else {\n    return _.always(f);\n  }\n});\n\nvar makeFunction = function (f, args) {\n  return makeFunction_.apply(undefined, [f].concat(args));\n};\n\nvar convertArgsToFunction = function (obs, f, args, method) {\n  if (typeof f !== \"undefined\" && f !== null ? f._isProperty : undefined) {\n    var sampled = f.sampledBy(obs, function (p, s) {\n      return [p, s];\n    });\n    return method.call(sampled, function (_ref) {\n      var p = _ref[0];\n      var s = _ref[1];\n      return p;\n    }).map(function (_ref2) {\n      var p = _ref2[0];\n      var s = _ref2[1];\n      return s;\n    });\n  } else {\n    f = makeFunction(f, args);\n    return method.call(obs, f);\n  }\n};\n\nvar toCombinator = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else if (isFieldKey(f)) {\n    var key = toFieldKey(f);\n    return function (left, right) {\n      return left[key](right);\n    };\n  } else {\n    throw new Exception(\"not a function or a field key: \" + f);\n  }\n};\n\nvar toFieldKey = function (f) {\n  return f.slice(1);\n};\n\nfunction Some(value) {\n  this.value = value;\n}\n\nextend(Some.prototype, {\n  _isSome: true,\n  getOrElse: function () {\n    return this.value;\n  },\n  get: function () {\n    return this.value;\n  },\n  filter: function (f) {\n    if (f(this.value)) {\n      return new Some(this.value);\n    } else {\n      return None;\n    }\n  },\n  map: function (f) {\n    return new Some(f(this.value));\n  },\n  forEach: function (f) {\n    return f(this.value);\n  },\n  isDefined: true,\n  toArray: function () {\n    return [this.value];\n  },\n  inspect: function () {\n    return \"Some(\" + this.value + \")\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n});\n\nvar None = {\n  _isNone: true,\n  getOrElse: function (value) {\n    return value;\n  },\n  filter: function () {\n    return None;\n  },\n  map: function () {\n    return None;\n  },\n  forEach: function () {},\n  isDefined: false,\n  toArray: function () {\n    return [];\n  },\n  inspect: function () {\n    return \"None\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n};\n\nvar toOption = function (v) {\n  if ((typeof v !== \"undefined\" && v !== null ? v._isSome : undefined) || (typeof v !== \"undefined\" && v !== null ? v._isNone : undefined)) {\n    return v;\n  } else {\n    return new Some(v);\n  }\n};\n\nBacon.noMore = \"<no-more>\";\nBacon.more = \"<more>\";\n\nvar eventIdCounter = 0;\n\nfunction Event() {\n  this.id = ++eventIdCounter;\n}\n\nEvent.prototype._isEvent = true;\nEvent.prototype.isEvent = function () {\n  return true;\n};\nEvent.prototype.isEnd = function () {\n  return false;\n};\nEvent.prototype.isInitial = function () {\n  return false;\n};\nEvent.prototype.isNext = function () {\n  return false;\n};\nEvent.prototype.isError = function () {\n  return false;\n};\nEvent.prototype.hasValue = function () {\n  return false;\n};\nEvent.prototype.filter = function () {\n  return true;\n};\nEvent.prototype.inspect = function () {\n  return this.toString();\n};\nEvent.prototype.log = function () {\n  return this.toString();\n};\n\nfunction Next(valueF, eager) {\n  if (!(this instanceof Next)) {\n    return new Next(valueF, eager);\n  }\n\n  Event.call(this);\n\n  if (!eager && _.isFunction(valueF) || (valueF != null ? valueF._isNext : void 0)) {\n    this.valueF = valueF;\n    this.valueInternal = void 0;\n  } else {\n    this.valueF = void 0;\n    this.valueInternal = valueF;\n  }\n}\n\ninherit(Next, Event);\n\nNext.prototype.isNext = function () {\n  return true;\n};\nNext.prototype.hasValue = function () {\n  return true;\n};\nNext.prototype.value = function () {\n  var ref;\n  if ((ref = this.valueF) != null ? ref._isNext : void 0) {\n    this.valueInternal = this.valueF.value();\n    this.valueF = void 0;\n  } else if (this.valueF) {\n    this.valueInternal = this.valueF();\n    this.valueF = void 0;\n  }\n  return this.valueInternal;\n};\n\nNext.prototype.fmap = function (f) {\n  var event, value;\n  if (this.valueInternal) {\n    value = this.valueInternal;\n    return this.apply(function () {\n      return f(value);\n    });\n  } else {\n    event = this;\n    return this.apply(function () {\n      return f(event.value());\n    });\n  }\n};\n\nNext.prototype.apply = function (value) {\n  return new Next(value);\n};\nNext.prototype.filter = function (f) {\n  return f(this.value());\n};\nNext.prototype.toString = function () {\n  return _.toString(this.value());\n};\nNext.prototype.log = function () {\n  return this.value();\n};\nNext.prototype._isNext = true;\n\nfunction Initial(valueF, eager) {\n  if (!(this instanceof Initial)) {\n    return new Initial(valueF, eager);\n  }\n  Next.call(this, valueF, eager);\n}\n\ninherit(Initial, Next);\nInitial.prototype._isInitial = true;\nInitial.prototype.isInitial = function () {\n  return true;\n};\nInitial.prototype.isNext = function () {\n  return false;\n};\nInitial.prototype.apply = function (value) {\n  return new Initial(value);\n};\nInitial.prototype.toNext = function () {\n  return new Next(this);\n};\n\nfunction End() {\n  if (!(this instanceof End)) {\n    return new End();\n  }\n  Event.call(this);\n}\n\ninherit(End, Event);\nEnd.prototype.isEnd = function () {\n  return true;\n};\nEnd.prototype.fmap = function () {\n  return this;\n};\nEnd.prototype.apply = function () {\n  return this;\n};\nEnd.prototype.toString = function () {\n  return \"<end>\";\n};\n\nfunction Error(error) {\n  if (!(this instanceof Error)) {\n    return new Error(error);\n  }\n  this.error = error;\n  Event.call(this);\n}\n\ninherit(Error, Event);\nError.prototype.isError = function () {\n  return true;\n};\nError.prototype.fmap = function () {\n  return this;\n};\nError.prototype.apply = function () {\n  return this;\n};\nError.prototype.toString = function () {\n  return \"<error> \" + _.toString(this.error);\n};\n\nBacon.Event = Event;\nBacon.Initial = Initial;\nBacon.Next = Next;\nBacon.End = End;\nBacon.Error = Error;\n\nvar initialEvent = function (value) {\n  return new Initial(value, true);\n};\nvar nextEvent = function (value) {\n  return new Next(value, true);\n};\nvar endEvent = function () {\n  return new End();\n};\nvar toEvent = function (x) {\n  if (x && x._isEvent) {\n    return x;\n  } else {\n    return nextEvent(x);\n  }\n};\n\nvar idCounter = 0;\nvar registerObs = function () {};\n\nfunction Observable(desc) {\n  this.desc = desc;\n  this.id = ++idCounter;\n  this.initialDesc = this.desc;\n}\n\nextend(Observable.prototype, {\n  _isObservable: true,\n\n  subscribe: function (sink) {\n    return UpdateBarrier.wrappedSubscribe(this, sink);\n  },\n\n  subscribeInternal: function (sink) {\n    return this.dispatcher.subscribe(sink);\n  },\n\n  onValue: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.hasValue()) {\n        return f(event.value());\n      }\n    });\n  },\n\n  onValues: function (f) {\n    return this.onValue(function (args) {\n      return f.apply(undefined, args);\n    });\n  },\n\n  onError: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isError()) {\n        return f(event.error);\n      }\n    });\n  },\n\n  onEnd: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isEnd()) {\n        return f();\n      }\n    });\n  },\n\n  name: function (name) {\n    this._name = name;\n    return this;\n  },\n\n  withDescription: function () {\n    this.desc = describe.apply(undefined, arguments);\n    return this;\n  },\n\n  toString: function () {\n    if (this._name) {\n      return this._name;\n    } else {\n      return this.desc.toString();\n    }\n  },\n\n  deps: function () {\n    return this.desc.deps();\n  },\n\n  internalDeps: function () {\n    return this.initialDesc.deps();\n  }\n});\n\nObservable.prototype.assign = Observable.prototype.onValue;\nObservable.prototype.forEach = Observable.prototype.onValue;\nObservable.prototype.inspect = Observable.prototype.toString;\n\nBacon.Observable = Observable;\n\nfunction CompositeUnsubscribe() {\n  var ss = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\n  this.unsubscribe = _.bind(this.unsubscribe, this);\n  this.unsubscribed = false;\n  this.subscriptions = [];\n  this.starting = [];\n  for (var i = 0, s; i < ss.length; i++) {\n    s = ss[i];\n    this.add(s);\n  }\n}\n\nextend(CompositeUnsubscribe.prototype, {\n  add: function (subscription) {\n    var _this2 = this;\n\n    if (this.unsubscribed) {\n      return;\n    }\n    var ended = false;\n    var unsub = nop;\n    this.starting.push(subscription);\n    var unsubMe = function () {\n      if (_this2.unsubscribed) {\n        return;\n      }\n      ended = true;\n      _this2.remove(unsub);\n      return _.remove(subscription, _this2.starting);\n    };\n    unsub = subscription(this.unsubscribe, unsubMe);\n    if (!(this.unsubscribed || ended)) {\n      this.subscriptions.push(unsub);\n    } else {\n      unsub();\n    }\n    _.remove(subscription, this.starting);\n    return unsub;\n  },\n\n  remove: function (unsub) {\n    if (this.unsubscribed) {\n      return;\n    }\n    if (_.remove(unsub, this.subscriptions) !== undefined) {\n      return unsub();\n    }\n  },\n\n  unsubscribe: function () {\n    if (this.unsubscribed) {\n      return;\n    }\n    this.unsubscribed = true;\n    var iterable = this.subscriptions;\n    for (var i = 0; i < iterable.length; i++) {\n      iterable[i]();\n    }\n    this.subscriptions = [];\n    this.starting = [];\n    return [];\n  },\n\n  count: function () {\n    if (this.unsubscribed) {\n      return 0;\n    }\n    return this.subscriptions.length + this.starting.length;\n  },\n\n  empty: function () {\n    return this.count() === 0;\n  }\n});\n\nBacon.CompositeUnsubscribe = CompositeUnsubscribe;\n\nfunction Dispatcher(_subscribe, _handleEvent) {\n  this._subscribe = _subscribe;\n  this._handleEvent = _handleEvent;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.handleEvent = _.bind(this.handleEvent, this);\n  this.pushing = false;\n  this.ended = false;\n  this.prevError = undefined;\n  this.unsubSrc = undefined;\n  this.subscriptions = [];\n  this.queue = [];\n}\n\nDispatcher.prototype.hasSubscribers = function () {\n  return this.subscriptions.length > 0;\n};\n\nDispatcher.prototype.removeSub = function (subscription) {\n  this.subscriptions = _.without(subscription, this.subscriptions);\n  return this.subscriptions;\n};\n\nDispatcher.prototype.push = function (event) {\n  if (event.isEnd()) {\n    this.ended = true;\n  }\n  return UpdateBarrier.inTransaction(event, this, this.pushIt, [event]);\n};\n\nDispatcher.prototype.pushToSubscriptions = function (event) {\n  try {\n    var tmp = this.subscriptions;\n    var len = tmp.length;\n    for (var i = 0; i < len; i++) {\n      var sub = tmp[i];\n      var reply = sub.sink(event);\n      if (reply === Bacon.noMore || event.isEnd()) {\n        this.removeSub(sub);\n      }\n    }\n    return true;\n  } catch (error) {\n    this.pushing = false;\n    this.queue = [];\n    throw error;\n  }\n};\n\nDispatcher.prototype.pushIt = function (event) {\n  if (!this.pushing) {\n    if (event === this.prevError) {\n      return;\n    }\n    if (event.isError()) {\n      this.prevError = event;\n    }\n    this.pushing = true;\n    this.pushToSubscriptions(event);\n    this.pushing = false;\n    while (this.queue.length) {\n      event = this.queue.shift();\n      this.push(event);\n    }\n    if (this.hasSubscribers()) {\n      return Bacon.more;\n    } else {\n      this.unsubscribeFromSource();\n      return Bacon.noMore;\n    }\n  } else {\n    this.queue.push(event);\n    return Bacon.more;\n  }\n};\n\nDispatcher.prototype.handleEvent = function (event) {\n  if (this._handleEvent) {\n    return this._handleEvent(event);\n  } else {\n    return this.push(event);\n  }\n};\n\nDispatcher.prototype.unsubscribeFromSource = function () {\n  if (this.unsubSrc) {\n    this.unsubSrc();\n  }\n  this.unsubSrc = undefined;\n};\n\nDispatcher.prototype.subscribe = function (sink) {\n  var subscription;\n  if (this.ended) {\n    sink(endEvent());\n    return nop;\n  } else {\n    assertFunction(sink);\n    subscription = {\n      sink: sink\n    };\n    this.subscriptions.push(subscription);\n    if (this.subscriptions.length === 1) {\n      this.unsubSrc = this._subscribe(this.handleEvent);\n      assertFunction(this.unsubSrc);\n    }\n    return (function (_this) {\n      return function () {\n        _this.removeSub(subscription);\n        if (!_this.hasSubscribers()) {\n          return _this.unsubscribeFromSource();\n        }\n      };\n    })(this);\n  }\n};\n\nBacon.Dispatcher = Dispatcher;\n\nfunction EventStream(desc, subscribe, handler) {\n  if (!(this instanceof EventStream)) {\n    return new EventStream(desc, subscribe, handler);\n  }\n  if (_.isFunction(desc)) {\n    handler = subscribe;\n    subscribe = desc;\n    desc = Desc.empty;\n  }\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new Dispatcher(subscribe, handler);\n  registerObs(this);\n}\n\ninherit(EventStream, Observable);\nextend(EventStream.prototype, {\n  _isEventStream: true,\n\n  toProperty: function (initValue_) {\n    var initValue = arguments.length === 0 ? None : toOption(function () {\n      return initValue_;\n    });\n    var disp = this.dispatcher;\n    var desc = new Bacon.Desc(this, \"toProperty\", [initValue_]);\n    return new Property(desc, function (sink) {\n      var initSent = false;\n      var subbed = false;\n      var unsub = nop;\n      var reply = Bacon.more;\n      var sendInit = function () {\n        if (!initSent) {\n          return initValue.forEach(function (value) {\n            initSent = true;\n            reply = sink(new Initial(value));\n            if (reply === Bacon.noMore) {\n              unsub();\n              unsub = nop;\n              return nop;\n            }\n          });\n        }\n      };\n\n      unsub = disp.subscribe(function (event) {\n        if (event.hasValue()) {\n          if (event.isInitial() && !subbed) {\n            initValue = new Some(function () {\n              return event.value();\n            });\n            return Bacon.more;\n          } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = true;\n            initValue = new Some(event);\n            return sink(event);\n          }\n        } else {\n          if (event.isEnd()) {\n            reply = sendInit();\n          }\n          if (reply !== Bacon.noMore) {\n            return sink(event);\n          }\n        }\n      });\n      subbed = true;\n      sendInit();\n      return unsub;\n    });\n  },\n\n  toEventStream: function () {\n    return this;\n  },\n\n  withHandler: function (handler) {\n    return new EventStream(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  }\n});\n\nBacon.EventStream = EventStream;\n\nBacon.never = function () {\n  return new EventStream(describe(Bacon, \"never\"), function (sink) {\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.when = function () {\n  if (arguments.length === 0) {\n    return Bacon.never();\n  }\n  var len = arguments.length;\n  var usage = \"when: expecting arguments in the form (Observable+,function)+\";\n\n  assert(usage, len % 2 === 0);\n  var sources = [];\n  var pats = [];\n  var i = 0;\n  var patterns = [];\n  while (i < len) {\n    patterns[i] = arguments[i];\n    patterns[i + 1] = arguments[i + 1];\n    var patSources = _.toArray(arguments[i]);\n    var f = constantToFunction(arguments[i + 1]);\n    var pat = { f: f, ixs: [] };\n    var triggerFound = false;\n    for (var j = 0, s; j < patSources.length; j++) {\n      s = patSources[j];\n      var index = _.indexOf(sources, s);\n      if (!triggerFound) {\n        triggerFound = Source.isTrigger(s);\n      }\n      if (index < 0) {\n        sources.push(s);\n        index = sources.length - 1;\n      }\n      for (var k = 0, ix; k < pat.ixs.length; k++) {\n        ix = pat.ixs[k];\n        if (ix.index === index) {\n          ix.count++;\n        }\n      }\n      pat.ixs.push({ index: index, count: 1 });\n    }\n\n    assert(\"At least one EventStream required\", triggerFound || !patSources.length);\n\n    if (patSources.length > 0) {\n      pats.push(pat);\n    }\n    i = i + 2;\n  }\n\n  if (!sources.length) {\n    return Bacon.never();\n  }\n\n  sources = _.map(Source.fromObservable, sources);\n  var needsBarrier = _.any(sources, function (s) {\n    return s.flatten;\n  }) && containsDuplicateDeps(_.map(function (s) {\n    return s.obs;\n  }, sources));\n\n  var desc = new Bacon.Desc(Bacon, \"when\", patterns);\n  var resultStream = new EventStream(desc, function (sink) {\n    var triggers = [];\n    var ends = false;\n    var match = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].hasAtLeast(i.count)) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var cannotSync = function (source) {\n      return !source.sync || source.ended;\n    };\n    var cannotMatch = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].mayHave(i.count)) {\n          return true;\n        }\n      }\n    };\n    var nonFlattened = function (trigger) {\n      return !trigger.source.flatten;\n    };\n    var part = function (source) {\n      return function (unsubAll) {\n        var flushLater = function () {\n          return UpdateBarrier.whenDoneWith(resultStream, flush);\n        };\n        var flushWhileTriggers = function () {\n          if (triggers.length > 0) {\n            var reply = Bacon.more;\n            var trigger = triggers.pop();\n            for (var i1 = 0, p; i1 < pats.length; i1++) {\n              p = pats[i1];\n              if (match(p)) {\n                var events = (function () {\n                  var result = [];\n                  for (var i2 = 0, i; i2 < p.ixs.length; i2++) {\n                    i = p.ixs[i2];\n                    result.push(sources[i.index].consume());\n                  }\n                  return result;\n                })();\n                reply = sink(trigger.e.apply(function () {\n                  var _p;\n\n                  var values = (function () {\n                    var result = [];\n                    for (var i2 = 0, event; i2 < events.length; i2++) {\n                      event = events[i2];\n                      result.push(event.value());\n                    }\n                    return result;\n                  })();\n\n                  return (_p = p).f.apply(_p, values);\n                }));\n                if (triggers.length) {\n                  triggers = _.filter(nonFlattened, triggers);\n                }\n                if (reply === Bacon.noMore) {\n                  return reply;\n                } else {\n                  return flushWhileTriggers();\n                }\n              }\n            }\n          } else {\n            return Bacon.more;\n          }\n        };\n        var flush = function () {\n          var reply = flushWhileTriggers();\n          if (ends) {\n            if (_.all(sources, cannotSync) || _.all(pats, cannotMatch)) {\n              reply = Bacon.noMore;\n              sink(endEvent());\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n\n          return reply;\n        };\n        return source.subscribe(function (e) {\n          if (e.isEnd()) {\n            ends = true;\n            source.markEnded();\n            flushLater();\n          } else if (e.isError()) {\n            var reply = sink(e);\n          } else {\n            source.push(e);\n            if (source.sync) {\n              triggers.push({ source: source, e: e });\n              if (needsBarrier || UpdateBarrier.hasWaiters()) {\n                flushLater();\n              } else {\n                flush();\n              }\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n          return reply || Bacon.more;\n        });\n      };\n    };\n\n    return new Bacon.CompositeUnsubscribe((function () {\n      var result = [];\n      for (var i1 = 0, s; i1 < sources.length; i1++) {\n        s = sources[i1];\n        result.push(part(s));\n      }\n      return result;\n    })()).unsubscribe;\n  });\n  return resultStream;\n};\n\nvar containsDuplicateDeps = function (observables) {\n  var state = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  var checkObservable = function (obs) {\n    if (_.contains(state, obs)) {\n      return true;\n    } else {\n      var deps = obs.internalDeps();\n      if (deps.length) {\n        state.push(obs);\n        return _.any(deps, checkObservable);\n      } else {\n        state.push(obs);\n        return false;\n      }\n    }\n  };\n\n  return _.any(observables, checkObservable);\n};\n\nvar constantToFunction = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else {\n    return _.always(f);\n  }\n};\n\nBacon.groupSimultaneous = function () {\n  for (var _len5 = arguments.length, streams = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n    streams[_key5] = arguments[_key5];\n  }\n\n  if (streams.length === 1 && isArray(streams[0])) {\n    streams = streams[0];\n  }\n  var sources = (function () {\n    var result = [];\n    for (var i = 0, s; i < streams.length; i++) {\n      s = streams[i];\n      result.push(new BufferingSource(s));\n    }\n    return result;\n  })();\n  return withDesc(new Bacon.Desc(Bacon, \"groupSimultaneous\", streams), Bacon.when(sources, function () {\n    for (var _len6 = arguments.length, xs = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n      xs[_key6] = arguments[_key6];\n    }\n\n    return xs;\n  }));\n};\n\nfunction PropertyDispatcher(property, subscribe, handleEvent) {\n  Dispatcher.call(this, subscribe, handleEvent);\n  this.property = property;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.current = None;\n  this.currentValueRootId = undefined;\n  this.propertyEnded = false;\n}\n\ninherit(PropertyDispatcher, Dispatcher);\nextend(PropertyDispatcher.prototype, {\n  push: function (event) {\n    if (event.isEnd()) {\n      this.propertyEnded = true;\n    }\n    if (event.hasValue()) {\n      this.current = new Some(event);\n      this.currentValueRootId = UpdateBarrier.currentEventId();\n    }\n    return Dispatcher.prototype.push.call(this, event);\n  },\n\n  maybeSubSource: function (sink, reply) {\n    if (reply === Bacon.noMore) {\n      return nop;\n    } else if (this.propertyEnded) {\n      sink(endEvent());\n      return nop;\n    } else {\n      return Dispatcher.prototype.subscribe.call(this, sink);\n    }\n  },\n\n  subscribe: function (sink) {\n    var _this3 = this;\n\n    var initSent = false;\n\n    var reply = Bacon.more;\n\n    if (this.current.isDefined && (this.hasSubscribers() || this.propertyEnded)) {\n      var dispatchingId = UpdateBarrier.currentEventId();\n      var valId = this.currentValueRootId;\n      if (!this.propertyEnded && valId && dispatchingId && dispatchingId !== valId) {\n        UpdateBarrier.whenDoneWith(this.property, function () {\n          if (_this3.currentValueRootId === valId) {\n            return sink(initialEvent(_this3.current.get().value()));\n          }\n        });\n\n        return this.maybeSubSource(sink, reply);\n      } else {\n        UpdateBarrier.inTransaction(undefined, this, function () {\n          reply = sink(initialEvent(this.current.get().value()));\n          return reply;\n        }, []);\n        return this.maybeSubSource(sink, reply);\n      }\n    } else {\n      return this.maybeSubSource(sink, reply);\n    }\n  }\n});\n\nfunction Property(desc, subscribe, handler) {\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new PropertyDispatcher(this, subscribe, handler);\n  registerObs(this);\n}\n\ninherit(Property, Observable);\nextend(Property.prototype, {\n  _isProperty: true,\n\n  changes: function () {\n    var _this4 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"changes\", []), function (sink) {\n      return _this4.dispatcher.subscribe(function (event) {\n        if (!event.isInitial()) {\n          return sink(event);\n        }\n      });\n    });\n  },\n\n  withHandler: function (handler) {\n    return new Property(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  },\n\n  toProperty: function () {\n    assertNoArguments(arguments);\n    return this;\n  },\n\n  toEventStream: function () {\n    var _this5 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"toEventStream\", []), function (sink) {\n      return _this5.dispatcher.subscribe(function (event) {\n        if (event.isInitial()) {\n          event = event.toNext();\n        }\n        return sink(event);\n      });\n    });\n  }\n});\n\nBacon.Property = Property;\n\nBacon.constant = function (value) {\n  return new Property(new Bacon.Desc(Bacon, \"constant\", [value]), function (sink) {\n    sink(initialEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.fromBinder = function (binder) {\n  var eventTransformer = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromBinder\", [binder, eventTransformer]);\n  return new EventStream(desc, function (sink) {\n    var unbound = false;\n    var shouldUnbind = false;\n    var unbind = function () {\n      if (!unbound) {\n        if (typeof unbinder !== \"undefined\" && unbinder !== null) {\n          unbinder();\n          return unbound = true;\n        } else {\n          return shouldUnbind = true;\n        }\n      }\n    };\n    var unbinder = binder(function () {\n      var ref;\n\n      for (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n        args[_key7] = arguments[_key7];\n      }\n\n      var value = eventTransformer.apply(this, args);\n      if (!(isArray(value) && ((ref = _.last(value)) != null ? ref._isEvent : undefined))) {\n        value = [value];\n      }\n      var reply = Bacon.more;\n      for (var i = 0, event; i < value.length; i++) {\n        event = value[i];\n        reply = sink(event = toEvent(event));\n        if (reply === Bacon.noMore || event.isEnd()) {\n          unbind();\n          return reply;\n        }\n      }\n      return reply;\n    });\n    if (shouldUnbind) {\n      unbind();\n    }\n    return unbind;\n  });\n};\n\nBacon.Observable.prototype.map = function (p) {\n  for (var _len8 = arguments.length, args = Array(_len8 > 1 ? _len8 - 1 : 0), _key8 = 1; _key8 < _len8; _key8++) {\n    args[_key8 - 1] = arguments[_key8];\n  }\n\n  return convertArgsToFunction(this, p, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n      return this.push(event.fmap(f));\n    }));\n  });\n};\n\nvar argumentsToObservables = function (args) {\n  if (isArray(args[0])) {\n    return args[0];\n  } else {\n    return Array.prototype.slice.call(args);\n  }\n};\n\nvar argumentsToObservablesAndFunction = function (args) {\n  if (_.isFunction(args[0])) {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 1)), args[0]];\n  } else {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 0, args.length - 1)), _.last(args)];\n  }\n};\n\nBacon.combineAsArray = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    var sources = [];\n    for (var i = 0; i < streams.length; i++) {\n      var stream = isObservable(streams[i]) ? streams[i] : Bacon.constant(streams[i]);\n      sources.push(new Source(stream, true));\n    }\n    return withDesc(new Bacon.Desc(Bacon, \"combineAsArray\", streams), Bacon.when(sources, function () {\n      for (var _len9 = arguments.length, xs = Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n        xs[_key9] = arguments[_key9];\n      }\n\n      return xs;\n    }).toProperty());\n  } else {\n    return Bacon.constant([]);\n  }\n};\n\nBacon.onValues = function () {\n  return Bacon.combineAsArray(Array.prototype.slice.call(arguments, 0, arguments.length - 1)).onValues(arguments[arguments.length - 1]);\n};\n\nBacon.combineWith = function () {\n  var _argumentsToObservablesAndFunction = argumentsToObservablesAndFunction(arguments);\n\n  var streams = _argumentsToObservablesAndFunction[0];\n  var f = _argumentsToObservablesAndFunction[1];\n\n  var desc = new Bacon.Desc(Bacon, \"combineWith\", [f].concat(streams));\n  return withDesc(desc, Bacon.combineAsArray(streams).map(function (values) {\n    return f.apply(undefined, values);\n  }));\n};\n\nBacon.Observable.prototype.combine = function (other, f) {\n  var combinator = toCombinator(f);\n  var desc = new Bacon.Desc(this, \"combine\", [other, f]);\n  return withDesc(desc, Bacon.combineAsArray(this, other).map(function (values) {\n    return combinator(values[0], values[1]);\n  }));\n};\n\nBacon.Observable.prototype.withStateMachine = function (initState, f) {\n  var state = initState;\n  var desc = new Bacon.Desc(this, \"withStateMachine\", [initState, f]);\n  return withDesc(desc, this.withHandler(function (event) {\n    var fromF = f(state, event);\n    var newState = fromF[0];\n    var outputs = fromF[1];\n\n    state = newState;\n    var reply = Bacon.more;\n    for (var i = 0, output; i < outputs.length; i++) {\n      output = outputs[i];\n      reply = this.push(output);\n      if (reply === Bacon.noMore) {\n        return reply;\n      }\n    }\n    return reply;\n  }));\n};\n\nvar equals = function (a, b) {\n  return a === b;\n};\n\nvar isNone = function (object) {\n  return typeof object !== \"undefined\" && object !== null ? object._isNone : false;\n};\n\nBacon.Observable.prototype.skipDuplicates = function () {\n  var isEqual = arguments.length <= 0 || arguments[0] === undefined ? equals : arguments[0];\n\n  var desc = new Bacon.Desc(this, \"skipDuplicates\", []);\n  return withDesc(desc, this.withStateMachine(None, function (prev, event) {\n    if (!event.hasValue()) {\n      return [prev, [event]];\n    } else if (event.isInitial() || isNone(prev) || !isEqual(prev.get(), event.value())) {\n      return [new Some(event.value()), [event]];\n    } else {\n      return [prev, []];\n    }\n  }));\n};\n\nBacon.Observable.prototype.awaiting = function (other) {\n  var desc = new Bacon.Desc(this, \"awaiting\", [other]);\n  return withDesc(desc, Bacon.groupSimultaneous(this, other).map(function (values) {\n    return values[1].length === 0;\n  }).toProperty(false).skipDuplicates());\n};\n\nBacon.Observable.prototype.not = function () {\n  return withDesc(new Bacon.Desc(this, \"not\", []), this.map(function (x) {\n    return !x;\n  }));\n};\n\nBacon.Property.prototype.and = function (other) {\n  return withDesc(new Bacon.Desc(this, \"and\", [other]), this.combine(other, function (x, y) {\n    return x && y;\n  }));\n};\n\nBacon.Property.prototype.or = function (other) {\n  return withDesc(new Bacon.Desc(this, \"or\", [other]), this.combine(other, function (x, y) {\n    return x || y;\n  }));\n};\n\nBacon.scheduler = {\n  setTimeout: function (f, d) {\n    return setTimeout(f, d);\n  },\n  setInterval: function (f, i) {\n    return setInterval(f, i);\n  },\n  clearInterval: function (id) {\n    return clearInterval(id);\n  },\n  clearTimeout: function (id) {\n    return clearTimeout(id);\n  },\n  now: function () {\n    return new Date().getTime();\n  }\n};\n\nBacon.EventStream.prototype.bufferWithTime = function (delay) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithTime\", [delay]), this.bufferWithTimeOrCount(delay, Number.MAX_VALUE));\n};\n\nBacon.EventStream.prototype.bufferWithCount = function (count) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithCount\", [count]), this.bufferWithTimeOrCount(undefined, count));\n};\n\nBacon.EventStream.prototype.bufferWithTimeOrCount = function (delay, count) {\n  var flushOrSchedule = function (buffer) {\n    if (buffer.values.length === count) {\n      return buffer.flush();\n    } else if (delay !== undefined) {\n      return buffer.schedule();\n    }\n  };\n  var desc = new Bacon.Desc(this, \"bufferWithTimeOrCount\", [delay, count]);\n  return withDesc(desc, this.buffer(delay, flushOrSchedule, flushOrSchedule));\n};\n\nBacon.EventStream.prototype.buffer = function (delay) {\n  var onInput = arguments.length <= 1 || arguments[1] === undefined ? nop : arguments[1];\n  var onFlush = arguments.length <= 2 || arguments[2] === undefined ? nop : arguments[2];\n\n  var buffer = {\n    scheduled: null,\n    end: undefined,\n    values: [],\n    flush: function () {\n      if (this.scheduled) {\n        Bacon.scheduler.clearTimeout(this.scheduled);\n        this.scheduled = null;\n      }\n      if (this.values.length > 0) {\n        var valuesToPush = this.values;\n        this.values = [];\n        var reply = this.push(nextEvent(valuesToPush));\n        if (this.end != null) {\n          return this.push(this.end);\n        } else if (reply !== Bacon.noMore) {\n          return onFlush(this);\n        }\n      } else {\n        if (this.end != null) {\n          return this.push(this.end);\n        }\n      }\n    },\n    schedule: function () {\n      var _this6 = this;\n\n      if (!this.scheduled) {\n        return this.scheduled = delay(function () {\n          return _this6.flush();\n        });\n      }\n    }\n  };\n  var reply = Bacon.more;\n  if (!_.isFunction(delay)) {\n    var delayMs = delay;\n    delay = function (f) {\n      return Bacon.scheduler.setTimeout(f, delayMs);\n    };\n  }\n  return withDesc(new Bacon.Desc(this, \"buffer\", []), this.withHandler(function (event) {\n    var _this7 = this;\n\n    buffer.push = function (event) {\n      return _this7.push(event);\n    };\n    if (event.isError()) {\n      reply = this.push(event);\n    } else if (event.isEnd()) {\n      buffer.end = event;\n      if (!buffer.scheduled) {\n        buffer.flush();\n      }\n    } else {\n      buffer.values.push(event.value());\n\n      onInput(buffer);\n    }\n    return reply;\n  }));\n};\n\nBacon.Observable.prototype.filter = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len10 = arguments.length, args = Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n    args[_key10 - 1] = arguments[_key10];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"filter\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.once = function (value) {\n  return new EventStream(new Desc(Bacon, \"once\", [value]), function (sink) {\n    sink(toEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.EventStream.prototype.concat = function (right) {\n  var left = this;\n  return new EventStream(new Bacon.Desc(left, \"concat\", [right]), function (sink) {\n    var unsubRight = nop;\n    var unsubLeft = left.dispatcher.subscribe(function (e) {\n      if (e.isEnd()) {\n        unsubRight = right.toEventStream().dispatcher.subscribe(sink);\n        return unsubRight;\n      } else {\n        return sink(e);\n      }\n    });\n    return function () {\n      return unsubLeft(), unsubRight();\n    };\n  });\n};\n\nBacon.Property.prototype.concat = function (right) {\n  return addPropertyInitValueToStream(this, this.changes().concat(right));\n};\n\nBacon.concatAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"concatAll\", streams), _.fold(_.tail(streams), _.head(streams).toEventStream(), function (a, b) {\n      return a.concat(b);\n    }));\n  } else {\n    return Bacon.never();\n  }\n};\n\nvar addPropertyInitValueToStream = function (property, stream) {\n  var justInitValue = new EventStream(describe(property, \"justInitValue\"), function (sink) {\n    var value = undefined;\n    var unsub = property.dispatcher.subscribe(function (event) {\n      if (!event.isEnd()) {\n        value = event;\n      }\n      return Bacon.noMore;\n    });\n    UpdateBarrier.whenDoneWith(justInitValue, function () {\n      if (typeof value !== \"undefined\" && value !== null) {\n        sink(value);\n      }\n      return sink(endEvent());\n    });\n    return unsub;\n  });\n  return justInitValue.concat(stream).toProperty();\n};\n\nBacon.Observable.prototype.flatMap = function () {\n  return flatMap_(this, makeSpawner(arguments));\n};\n\nBacon.Observable.prototype.flatMapFirst = function () {\n  return flatMap_(this, makeSpawner(arguments), true);\n};\n\nvar makeSpawner = function (args) {\n  if (args.length === 1 && isObservable(args[0])) {\n    return _.always(args[0]);\n  } else {\n    return makeFunctionArgs(args);\n  }\n};\n\nvar makeObservable = function (x) {\n  if (isObservable(x)) {\n    return x;\n  } else {\n    return Bacon.once(x);\n  }\n};\n\nvar flatMap_ = function (root, f, firstOnly, limit) {\n  var rootDep = [root];\n  var childDeps = [];\n  var desc = new Bacon.Desc(root, \"flatMap\" + (firstOnly ? \"First\" : \"\"), [f]);\n  var result = new EventStream(desc, function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var queue = [];\n    var spawn = function (event) {\n      var child = makeObservable(f(event.value()));\n      childDeps.push(child);\n      return composite.add(function (unsubAll, unsubMe) {\n        return child.dispatcher.subscribe(function (event) {\n          if (event.isEnd()) {\n            _.remove(child, childDeps);\n            checkQueue();\n            checkEnd(unsubMe);\n            return Bacon.noMore;\n          } else {\n            if (typeof event !== \"undefined\" && event !== null ? event._isInitial : undefined) {\n              event = event.toNext();\n            }\n            var reply = sink(event);\n            if (reply === Bacon.noMore) {\n              unsubAll();\n            }\n            return reply;\n          }\n        });\n      });\n    };\n    var checkQueue = function () {\n      var event = queue.shift();\n      if (event) {\n        return spawn(event);\n      }\n    };\n    var checkEnd = function (unsub) {\n      unsub();\n      if (composite.empty()) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (__, unsubRoot) {\n      return root.dispatcher.subscribe(function (event) {\n        if (event.isEnd()) {\n          return checkEnd(unsubRoot);\n        } else if (event.isError()) {\n          return sink(event);\n        } else if (firstOnly && composite.count() > 1) {\n          return Bacon.more;\n        } else {\n          if (composite.unsubscribed) {\n            return Bacon.noMore;\n          }\n          if (limit && composite.count() > limit) {\n            return queue.push(event);\n          } else {\n            return spawn(event);\n          }\n        }\n      });\n    });\n    return composite.unsubscribe;\n  });\n  result.internalDeps = function () {\n    if (childDeps.length) {\n      return rootDep.concat(childDeps);\n    } else {\n      return rootDep;\n    }\n  };\n  return result;\n};\n\nBacon.Observable.prototype.flatMapWithConcurrencyLimit = function (limit) {\n  for (var _len11 = arguments.length, args = Array(_len11 > 1 ? _len11 - 1 : 0), _key11 = 1; _key11 < _len11; _key11++) {\n    args[_key11 - 1] = arguments[_key11];\n  }\n\n  var desc = new Bacon.Desc(this, \"flatMapWithConcurrencyLimit\", [limit].concat(args));\n  return withDesc(desc, flatMap_(this, makeSpawner(args), false, limit));\n};\n\nBacon.Observable.prototype.flatMapConcat = function () {\n  var desc = new Bacon.Desc(this, \"flatMapConcat\", Array.prototype.slice.call(arguments, 0));\n  return withDesc(desc, this.flatMapWithConcurrencyLimit.apply(this, [1].concat(_slice.call(arguments))));\n};\n\nBacon.later = function (delay, value) {\n  return withDesc(new Bacon.Desc(Bacon, \"later\", [delay, value]), Bacon.fromBinder(function (sink) {\n    var sender = function () {\n      return sink([value, endEvent()]);\n    };\n    var id = Bacon.scheduler.setTimeout(sender, delay);\n    return function () {\n      return Bacon.scheduler.clearTimeout(id);\n    };\n  }));\n};\n\nBacon.Observable.prototype.bufferingThrottle = function (minimumInterval) {\n  var desc = new Bacon.Desc(this, \"bufferingThrottle\", [minimumInterval]);\n  return withDesc(desc, this.flatMapConcat(function (x) {\n    return Bacon.once(x).concat(Bacon.later(minimumInterval).filter(false));\n  }));\n};\n\nBacon.Property.prototype.bufferingThrottle = function () {\n  return Bacon.Observable.prototype.bufferingThrottle.apply(this, arguments).toProperty();\n};\n\nfunction Bus() {\n  if (!(this instanceof Bus)) {\n    return new Bus();\n  }\n\n  this.unsubAll = _.bind(this.unsubAll, this);\n  this.subscribeAll = _.bind(this.subscribeAll, this);\n  this.guardedSink = _.bind(this.guardedSink, this);\n\n  this.sink = undefined;\n  this.subscriptions = [];\n  this.ended = false;\n  EventStream.call(this, new Bacon.Desc(Bacon, \"Bus\", []), this.subscribeAll);\n}\n\ninherit(Bus, EventStream);\nextend(Bus.prototype, {\n  unsubAll: function () {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (typeof sub.unsub === \"function\") {\n        sub.unsub();\n      }\n    }\n  },\n\n  subscribeAll: function (newSink) {\n    if (this.ended) {\n      newSink(endEvent());\n    } else {\n      this.sink = newSink;\n      var iterable = cloneArray(this.subscriptions);\n      for (var i = 0, subscription; i < iterable.length; i++) {\n        subscription = iterable[i];\n        this.subscribeInput(subscription);\n      }\n    }\n    return this.unsubAll;\n  },\n\n  guardedSink: function (input) {\n    var _this8 = this;\n\n    return function (event) {\n      if (event.isEnd()) {\n        _this8.unsubscribeInput(input);\n        return Bacon.noMore;\n      } else {\n        return _this8.sink(event);\n      }\n    };\n  },\n\n  subscribeInput: function (subscription) {\n    subscription.unsub = subscription.input.dispatcher.subscribe(this.guardedSink(subscription.input));\n    return subscription.unsub;\n  },\n\n  unsubscribeInput: function (input) {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (sub.input === input) {\n        if (typeof sub.unsub === \"function\") {\n          sub.unsub();\n        }\n        this.subscriptions.splice(i, 1);\n        return;\n      }\n    }\n  },\n\n  plug: function (input) {\n    var _this9 = this;\n\n    assertObservable(input);\n    if (this.ended) {\n      return;\n    }\n    var sub = { input: input };\n    this.subscriptions.push(sub);\n    if (typeof this.sink !== \"undefined\") {\n      this.subscribeInput(sub);\n    }\n    return function () {\n      return _this9.unsubscribeInput(input);\n    };\n  },\n\n  end: function () {\n    this.ended = true;\n    this.unsubAll();\n    if (typeof this.sink === \"function\") {\n      return this.sink(endEvent());\n    }\n  },\n\n  push: function (value) {\n    if (!this.ended && typeof this.sink === \"function\") {\n      var rootPush = !this.pushing;\n      if (!rootPush) {\n        if (!this.pushQueue) this.pushQueue = [];\n        this.pushQueue.push(value);\n\n        return;\n      }\n      this.pushing = true;\n      try {\n        return this.sink(nextEvent(value));\n      } finally {\n        if (rootPush && this.pushQueue) {\n          var i = 0;\n          while (i < this.pushQueue.length) {\n            var value = this.pushQueue[i];\n            this.sink(nextEvent(value));\n            i++;\n          }\n          this.pushQueue = null;\n        }\n        this.pushing = false;\n      }\n    }\n  },\n\n  error: function (error) {\n    if (typeof this.sink === \"function\") {\n      return this.sink(new Error(error));\n    }\n  }\n});\n\nBacon.Bus = Bus;\n\nvar liftCallback = function (desc, wrapped) {\n  return withMethodCallSupport(function (f) {\n    var stream = partiallyApplied(wrapped, [function (values, callback) {\n      return f.apply(undefined, values.concat([callback]));\n    }]);\n\n    for (var _len12 = arguments.length, args = Array(_len12 > 1 ? _len12 - 1 : 0), _key12 = 1; _key12 < _len12; _key12++) {\n      args[_key12 - 1] = arguments[_key12];\n    }\n\n    return withDesc(new Bacon.Desc(Bacon, desc, [f].concat(args)), Bacon.combineAsArray(args).flatMap(stream));\n  });\n};\n\nBacon.fromCallback = liftCallback(\"fromCallback\", function (f) {\n  for (var _len13 = arguments.length, args = Array(_len13 > 1 ? _len13 - 1 : 0), _key13 = 1; _key13 < _len13; _key13++) {\n    args[_key13 - 1] = arguments[_key13];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (value) {\n    return [value, endEvent()];\n  });\n});\n\nBacon.fromNodeCallback = liftCallback(\"fromNodeCallback\", function (f) {\n  for (var _len14 = arguments.length, args = Array(_len14 > 1 ? _len14 - 1 : 0), _key14 = 1; _key14 < _len14; _key14++) {\n    args[_key14 - 1] = arguments[_key14];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (error, value) {\n    if (error) {\n      return [new Error(error), endEvent()];\n    }\n    return [value, endEvent()];\n  });\n});\n\nBacon.combineTemplate = function (template) {\n  function current(ctxStack) {\n    return ctxStack[ctxStack.length - 1];\n  }\n  function setValue(ctxStack, key, value) {\n    current(ctxStack)[key] = value;\n    return value;\n  }\n  function applyStreamValue(key, index) {\n    return function (ctxStack, values) {\n      setValue(ctxStack, key, values[index]);\n    };\n  }\n  function constantValue(key, value) {\n    return function (ctxStack) {\n      setValue(ctxStack, key, value);\n    };\n  }\n\n  function mkContext(template) {\n    return isArray(template) ? [] : {};\n  }\n\n  function pushContext(key, value) {\n    return function (ctxStack) {\n      var newContext = mkContext(value);\n      setValue(ctxStack, key, newContext);\n      ctxStack.push(newContext);\n    };\n  }\n\n  function containsObservables(value) {\n    if (isObservable(value)) {\n      return true;\n    } else if (value && (value.constructor == Object || value.constructor == Array)) {\n      for (var key in value) {\n        if (Object.prototype.hasOwnProperty.call(value, key)) {\n          var child = value[key];\n          if (containsObservables(child)) return true;\n        }\n      }\n    }\n  }\n\n  function compile(key, value) {\n    if (isObservable(value)) {\n      streams.push(value);\n      funcs.push(applyStreamValue(key, streams.length - 1));\n    } else if (containsObservables(value)) {\n      var popContext = function (ctxStack) {\n        ctxStack.pop();\n      };\n      funcs.push(pushContext(key, value));\n      compileTemplate(value);\n      funcs.push(popContext);\n    } else {\n      funcs.push(constantValue(key, value));\n    }\n  }\n\n  function combinator(values) {\n    var rootContext = mkContext(template);\n    var ctxStack = [rootContext];\n    for (var i = 0, f; i < funcs.length; i++) {\n      f = funcs[i];\n      f(ctxStack, values);\n    }\n    return rootContext;\n  }\n\n  function compileTemplate(template) {\n    _.each(template, compile);\n  }\n\n  var funcs = [];\n  var streams = [];\n\n  var resultProperty = containsObservables(template) ? (compileTemplate(template), Bacon.combineAsArray(streams).map(combinator)) : Bacon.constant(template);\n\n  return withDesc(new Bacon.Desc(Bacon, \"combineTemplate\", [template]), resultProperty);\n};\n\nBacon.Observable.prototype.mapEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      this.push(nextEvent(f(event)));\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.skipErrors = function () {\n  return withDesc(new Bacon.Desc(this, \"skipErrors\", []), this.withHandler(function (event) {\n    if (event.isError()) {\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.takeUntil = function (stopper) {\n  var endMarker = {};\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), Bacon.groupSimultaneous(this.mapEnd(endMarker), stopper.skipErrors()).withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      var _event$value = event.value();\n\n      var data = _event$value[0];\n      var stopper = _event$value[1];\n\n      if (stopper.length) {\n        return this.push(endEvent());\n      } else {\n        var reply = Bacon.more;\n        for (var i = 0, value; i < data.length; i++) {\n          value = data[i];\n          if (value === endMarker) {\n            reply = this.push(endEvent());\n          } else {\n            reply = this.push(nextEvent(value));\n          }\n        }\n        return reply;\n      }\n    }\n  }));\n};\n\nBacon.Property.prototype.takeUntil = function (stopper) {\n  var changes = this.changes().takeUntil(stopper);\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), addPropertyInitValueToStream(this, changes));\n};\n\nBacon.Observable.prototype.flatMapLatest = function () {\n  var f = makeSpawner(arguments);\n  var stream = this.toEventStream();\n  return withDesc(new Bacon.Desc(this, \"flatMapLatest\", [f]), stream.flatMap(function (value) {\n    return makeObservable(f(value)).takeUntil(stream);\n  }));\n};\n\nBacon.Property.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, addPropertyInitValueToStream(this, f(this.changes())));\n};\n\nBacon.EventStream.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, f(this));\n};\n\nBacon.Observable.prototype.delay = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"delay\", [delay]), function (changes) {\n    return changes.flatMap(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounce = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounce\", [delay]), function (changes) {\n    return changes.flatMapLatest(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounceImmediate = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounceImmediate\", [delay]), function (changes) {\n    return changes.flatMapFirst(function (value) {\n      return Bacon.once(value).concat(Bacon.later(delay).filter(false));\n    });\n  });\n};\n\nBacon.Observable.prototype.decode = function (cases) {\n  return withDesc(new Bacon.Desc(this, \"decode\", [cases]), this.combine(Bacon.combineTemplate(cases), function (key, values) {\n    return values[key];\n  }));\n};\n\nBacon.Observable.prototype.scan = function (seed, f) {\n  var _this10 = this;\n\n  var resultProperty;\n  f = toCombinator(f);\n  var acc = toOption(seed);\n  var initHandled = false;\n  var subscribe = function (sink) {\n    var initSent = false;\n    var unsub = nop;\n    var reply = Bacon.more;\n    var sendInit = function () {\n      if (!initSent) {\n        return acc.forEach(function (value) {\n          initSent = initHandled = true;\n          reply = sink(new Initial(function () {\n            return value;\n          }));\n          if (reply === Bacon.noMore) {\n            unsub();\n            unsub = nop;\n            return unsub;\n          }\n        });\n      }\n    };\n    unsub = _this10.dispatcher.subscribe(function (event) {\n      if (event.hasValue()) {\n        if (initHandled && event.isInitial()) {\n          return Bacon.more;\n        } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = initHandled = true;\n            var prev = acc.getOrElse(undefined);\n            var next = f(prev, event.value());\n\n            acc = new Some(next);\n            return sink(event.apply(function () {\n              return next;\n            }));\n          }\n      } else {\n        if (event.isEnd()) {\n          reply = sendInit();\n        }\n        if (reply !== Bacon.noMore) {\n          return sink(event);\n        }\n      }\n    });\n    UpdateBarrier.whenDoneWith(resultProperty, sendInit);\n    return unsub;\n  };\n  resultProperty = new Property(new Bacon.Desc(this, \"scan\", [seed, f]), subscribe);\n  return resultProperty;\n};\n\nBacon.Observable.prototype.diff = function (start, f) {\n  f = toCombinator(f);\n  return withDesc(new Bacon.Desc(this, \"diff\", [start, f]), this.scan([start], function (prevTuple, next) {\n    return [next, f(prevTuple[0], next)];\n  }).filter(function (tuple) {\n    return tuple.length === 2;\n  }).map(function (tuple) {\n    return tuple[1];\n  }));\n};\n\nBacon.Observable.prototype.doAction = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doAction\", [f]), this.withHandler(function (event) {\n    if (event.hasValue()) {\n      f(event.value());\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      f();\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      f(event.error);\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doLog = function () {\n  for (var _len15 = arguments.length, args = Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n    args[_key15] = arguments[_key15];\n  }\n\n  return withDesc(new Bacon.Desc(this, \"doLog\", args), this.withHandler(function (event) {\n    if (typeof console !== \"undefined\" && console !== null && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.endOnError = function (f) {\n  if (!(typeof f !== \"undefined\" && f !== null)) {\n    f = true;\n  }\n\n  for (var _len16 = arguments.length, args = Array(_len16 > 1 ? _len16 - 1 : 0), _key16 = 1; _key16 < _len16; _key16++) {\n    args[_key16 - 1] = arguments[_key16];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"endOnError\", []), this.withHandler(function (event) {\n      if (event.isError() && f(event.error)) {\n        this.push(event);\n        return this.push(endEvent());\n      } else {\n        return this.push(event);\n      }\n    }));\n  });\n};\n\nObservable.prototype.errors = function () {\n  return withDesc(new Bacon.Desc(this, \"errors\", []), this.filter(function () {\n    return false;\n  }));\n};\n\nBacon.Observable.prototype.take = function (count) {\n  if (count <= 0) {\n    return Bacon.never();\n  }\n  return withDesc(new Bacon.Desc(this, \"take\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      count--;\n      if (count > 0) {\n        return this.push(event);\n      } else {\n        if (count === 0) {\n          this.push(event);\n        }\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }\n  }));\n};\n\nBacon.Observable.prototype.first = function () {\n  return withDesc(new Bacon.Desc(this, \"first\", []), this.take(1));\n};\n\nBacon.Observable.prototype.mapError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      return this.push(nextEvent(f(event.error)));\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.flatMapError = function (fn) {\n  var desc = new Bacon.Desc(this, \"flatMapError\", [fn]);\n  return withDesc(desc, this.mapError(function (err) {\n    return new Error(err);\n  }).flatMap(function (x) {\n    if (x instanceof Error) {\n      return fn(x.error);\n    } else {\n      return Bacon.once(x);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.flatScan = function (seed, f) {\n  var current = seed;\n  return this.flatMapConcat(function (next) {\n    return makeObservable(f(current, next)).doAction(function (updated) {\n      return current = updated;\n    });\n  }).toProperty(seed);\n};\n\nBacon.EventStream.prototype.sampledBy = function (sampler, combinator) {\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), this.toProperty().sampledBy(sampler, combinator));\n};\n\nBacon.Property.prototype.sampledBy = function (sampler, combinator) {\n  var lazy = false;\n  if (typeof combinator !== \"undefined\" && combinator !== null) {\n    combinator = toCombinator(combinator);\n  } else {\n    lazy = true;\n    combinator = function (f) {\n      return f.value();\n    };\n  }\n  var thisSource = new Source(this, false, lazy);\n  var samplerSource = new Source(sampler, true, lazy);\n  var stream = Bacon.when([thisSource, samplerSource], combinator);\n  var result = sampler._isProperty ? stream.toProperty() : stream;\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), result);\n};\n\nBacon.Property.prototype.sample = function (interval) {\n  return withDesc(new Bacon.Desc(this, \"sample\", [interval]), this.sampledBy(Bacon.interval(interval, {})));\n};\n\nBacon.Observable.prototype.map = function (p) {\n  if (p && p._isProperty) {\n    return p.sampledBy(this, former);\n  } else {\n    for (var _len17 = arguments.length, args = Array(_len17 > 1 ? _len17 - 1 : 0), _key17 = 1; _key17 < _len17; _key17++) {\n      args[_key17 - 1] = arguments[_key17];\n    }\n\n    return convertArgsToFunction(this, p, args, function (f) {\n      return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n        return this.push(event.fmap(f));\n      }));\n    });\n  }\n};\n\nBacon.Observable.prototype.fold = function (seed, f) {\n  return withDesc(new Bacon.Desc(this, \"fold\", [seed, f]), this.scan(seed, f).sampledBy(this.filter(false).mapEnd().toProperty()));\n};\n\nObservable.prototype.reduce = Observable.prototype.fold;\n\nvar eventMethods = [[\"addEventListener\", \"removeEventListener\"], [\"addListener\", \"removeListener\"], [\"on\", \"off\"], [\"bind\", \"unbind\"]];\n\nvar findHandlerMethods = function (target) {\n  var pair;\n  for (var i = 0; i < eventMethods.length; i++) {\n    pair = eventMethods[i];\n    var methodPair = [target[pair[0]], target[pair[1]]];\n    if (methodPair[0] && methodPair[1]) {\n      return methodPair;\n    }\n  }\n  for (var j = 0; j < eventMethods.length; j++) {\n    pair = eventMethods[j];\n    var addListener = target[pair[0]];\n    if (addListener) {\n      return [addListener, function () {}];\n    }\n  }\n  throw new Error(\"No suitable event methods in \" + target);\n};\n\nBacon.fromEventTarget = function (target, eventName, eventTransformer) {\n  var _findHandlerMethods = findHandlerMethods(target);\n\n  var sub = _findHandlerMethods[0];\n  var unsub = _findHandlerMethods[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromEvent\", [target, eventName]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    sub.call(target, eventName, handler);\n    return function () {\n      return unsub.call(target, eventName, handler);\n    };\n  }, eventTransformer));\n};\n\nBacon.fromEvent = Bacon.fromEventTarget;\n\nBacon.fromPoll = function (delay, poll) {\n  var desc = new Bacon.Desc(Bacon, \"fromPoll\", [delay, poll]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    var id = Bacon.scheduler.setInterval(handler, delay);\n    return function () {\n      return Bacon.scheduler.clearInterval(id);\n    };\n  }, poll));\n};\n\nfunction valueAndEnd(value) {\n  return [value, endEvent()];\n}\n\nBacon.fromPromise = function (promise, abort) {\n  var eventTransformer = arguments.length <= 2 || arguments[2] === undefined ? valueAndEnd : arguments[2];\n\n  return withDesc(new Bacon.Desc(Bacon, \"fromPromise\", [promise]), Bacon.fromBinder(function (handler) {\n    var bound = promise.then(handler, function (e) {\n      return handler(new Error(e));\n    });\n    if (bound && typeof bound.done === \"function\") {\n      bound.done();\n    }\n\n    if (abort) {\n      return function () {\n        if (typeof promise.abort === \"function\") {\n          return promise.abort();\n        }\n      };\n    } else {\n      return function () {};\n    }\n  }, eventTransformer));\n};\n\nBacon.Observable.prototype.groupBy = function (keyF) {\n  var limitF = arguments.length <= 1 || arguments[1] === undefined ? Bacon._.id : arguments[1];\n\n  var streams = {};\n  var src = this;\n  return src.filter(function (x) {\n    return !streams[keyF(x)];\n  }).map(function (x) {\n    var key = keyF(x);\n    var similar = src.filter(function (x) {\n      return keyF(x) === key;\n    });\n    var data = Bacon.once(x).concat(similar);\n    var limited = limitF(data, x).withHandler(function (event) {\n      this.push(event);\n      if (event.isEnd()) {\n        return delete streams[key];\n      }\n    });\n    streams[key] = limited;\n    return limited;\n  });\n};\n\nBacon.fromArray = function (values) {\n  assertArray(values);\n  if (!values.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"fromArray\", values), Bacon.never());\n  } else {\n    var i = 0;\n    var stream = new EventStream(new Bacon.Desc(Bacon, \"fromArray\", [values]), function (sink) {\n      var unsubd = false;\n      var reply = Bacon.more;\n      var pushing = false;\n      var pushNeeded = false;\n      function push() {\n        pushNeeded = true;\n        if (pushing) {\n          return;\n        }\n        pushing = true;\n        while (pushNeeded) {\n          pushNeeded = false;\n          if (reply !== Bacon.noMore && !unsubd) {\n            var value = values[i++];\n            reply = sink(toEvent(value));\n            if (reply !== Bacon.noMore) {\n              if (i === values.length) {\n                sink(endEvent());\n              } else {\n                UpdateBarrier.afterTransaction(stream, push);\n              }\n            }\n          }\n        }\n        pushing = false;\n        return pushing;\n      };\n\n      push();\n      return function () {\n        unsubd = true;\n        return unsubd;\n      };\n    });\n    return stream;\n  }\n};\n\nBacon.EventStream.prototype.holdWhen = function (valve) {\n  var onHold = false;\n  var bufferedValues = [];\n  var src = this;\n  var srcIsEnded = false;\n  return new EventStream(new Bacon.Desc(this, \"holdWhen\", [valve]), function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var subscribed = false;\n    var endIfBothEnded = function (unsub) {\n      if (typeof unsub === \"function\") {\n        unsub();\n      }\n      if (composite.empty() && subscribed) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (unsubAll, unsubMe) {\n      return valve.subscribeInternal(function (event) {\n        if (event.hasValue()) {\n          onHold = event.value();\n          if (!onHold) {\n            var toSend = bufferedValues;\n            bufferedValues = [];\n            return (function () {\n              var result = [];\n              for (var i = 0, value; i < toSend.length; i++) {\n                value = toSend[i];\n                result.push(sink(nextEvent(value)));\n              }\n              if (srcIsEnded) {\n                result.push(sink(endEvent()));\n                unsubMe();\n              }\n              return result;\n            })();\n          }\n        } else if (event.isEnd()) {\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    composite.add(function (unsubAll, unsubMe) {\n      return src.subscribeInternal(function (event) {\n        if (onHold && event.hasValue()) {\n          return bufferedValues.push(event.value());\n        } else if (event.isEnd() && bufferedValues.length) {\n          srcIsEnded = true;\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    subscribed = true;\n    endIfBothEnded();\n    return composite.unsubscribe;\n  });\n};\n\nBacon.interval = function (delay) {\n  var value = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  return withDesc(new Bacon.Desc(Bacon, \"interval\", [delay, value]), Bacon.fromPoll(delay, function () {\n    return nextEvent(value);\n  }));\n};\n\nBacon.$ = {};\nBacon.$.asEventStream = function (eventName, selector, eventTransformer) {\n  var _this11 = this;\n\n  if (_.isFunction(selector)) {\n    eventTransformer = selector;\n    selector = undefined;\n  }\n\n  return withDesc(new Bacon.Desc(this.selector || this, \"asEventStream\", [eventName]), Bacon.fromBinder(function (handler) {\n    _this11.on(eventName, selector, handler);\n    return function () {\n      return _this11.off(eventName, selector, handler);\n    };\n  }, eventTransformer));\n};\n\nif (typeof jQuery !== \"undefined\" && jQuery) {\n  jQuery.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nif (typeof Zepto !== \"undefined\" && Zepto) {\n  Zepto.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nBacon.Observable.prototype.last = function () {\n  var lastEvent;\n\n  return withDesc(new Bacon.Desc(this, \"last\", []), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      if (lastEvent) {\n        this.push(lastEvent);\n      }\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      lastEvent = event;\n    }\n  }));\n};\n\nBacon.Observable.prototype.log = function () {\n  for (var _len18 = arguments.length, args = Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n    args[_key18] = arguments[_key18];\n  }\n\n  this.subscribe(function (event) {\n    if (typeof console !== \"undefined\" && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n  });\n  return this;\n};\n\nBacon.EventStream.prototype.merge = function (right) {\n  assertEventStream(right);\n  var left = this;\n  return withDesc(new Bacon.Desc(left, \"merge\", [right]), Bacon.mergeAll(this, right));\n};\n\nBacon.mergeAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return new EventStream(new Bacon.Desc(Bacon, \"mergeAll\", streams), function (sink) {\n      var ends = 0;\n      var smartSink = function (obs) {\n        return function (unsubBoth) {\n          return obs.dispatcher.subscribe(function (event) {\n            if (event.isEnd()) {\n              ends++;\n              if (ends === streams.length) {\n                return sink(endEvent());\n              } else {\n                return Bacon.more;\n              }\n            } else {\n              var reply = sink(event);\n              if (reply === Bacon.noMore) {\n                unsubBoth();\n              }\n              return reply;\n            }\n          });\n        };\n      };\n      var sinks = _.map(smartSink, streams);\n      return new Bacon.CompositeUnsubscribe(sinks).unsubscribe;\n    });\n  } else {\n    return Bacon.never();\n  }\n};\n\nBacon.repeatedly = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"repeatedly\", [delay, values]), Bacon.fromPoll(delay, function () {\n    return values[index++ % values.length];\n  }));\n};\n\nBacon.repeat = function (generator) {\n  var index = 0;\n  return Bacon.fromBinder(function (sink) {\n    var flag = false;\n    var reply = Bacon.more;\n    var unsub = function () {};\n    function handleEvent(event) {\n      if (event.isEnd()) {\n        if (!flag) {\n          return flag = true;\n        } else {\n          return subscribeNext();\n        }\n      } else {\n        return reply = sink(event);\n      }\n    };\n    function subscribeNext() {\n      var next;\n      flag = true;\n      while (flag && reply !== Bacon.noMore) {\n        next = generator(index++);\n        flag = false;\n        if (next) {\n          unsub = next.subscribeInternal(handleEvent);\n        } else {\n          sink(endEvent());\n        }\n      }\n      return flag = true;\n    };\n    subscribeNext();\n    return function () {\n      return unsub();\n    };\n  });\n};\n\nBacon.retry = function (options) {\n  if (!_.isFunction(options.source)) {\n    throw new Exception(\"'source' option has to be a function\");\n  }\n  var source = options.source;\n  var retries = options.retries || 0;\n  var retriesDone = 0;\n  var delay = options.delay || function () {\n    return 0;\n  };\n  var isRetryable = options.isRetryable || function () {\n    return true;\n  };\n  var finished = false;\n  var error = null;\n\n  return withDesc(new Bacon.Desc(Bacon, \"retry\", [options]), Bacon.repeat(function (count) {\n    function valueStream() {\n      return source(count).endOnError().withHandler(function (event) {\n        if (event.isError()) {\n          error = event;\n          if (!(isRetryable(error.error) && (retries === 0 || retriesDone < retries))) {\n            finished = true;\n            return this.push(event);\n          }\n        } else {\n          if (event.hasValue()) {\n            error = null;\n            finished = true;\n          }\n          return this.push(event);\n        }\n      });\n    }\n\n    if (finished) {\n      return null;\n    } else if (error) {\n      var context = {\n        error: error.error,\n        retriesDone: retriesDone\n      };\n      var pause = Bacon.later(delay(context)).filter(false);\n      retriesDone++;\n      return pause.concat(Bacon.once().flatMap(valueStream));\n    } else {\n      return valueStream();\n    }\n  }));\n};\n\nBacon.sequentially = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"sequentially\", [delay, values]), Bacon.fromPoll(delay, function () {\n    var value = values[index++];\n    if (index < values.length) {\n      return value;\n    } else if (index === values.length) {\n      return [value, endEvent()];\n    } else {\n      return endEvent();\n    }\n  }));\n};\n\nBacon.Observable.prototype.skip = function (count) {\n  return withDesc(new Bacon.Desc(this, \"skip\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else if (count > 0) {\n      count--;\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.skipUntil = function (starter) {\n  var started = starter.take(1).map(true).toProperty(false);\n  return withDesc(new Bacon.Desc(this, \"skipUntil\", [starter]), this.filter(started));\n};\n\nBacon.EventStream.prototype.skipWhile = function (f) {\n  assertObservableIsProperty(f);\n  var ok = false;\n\n  for (var _len19 = arguments.length, args = Array(_len19 > 1 ? _len19 - 1 : 0), _key19 = 1; _key19 < _len19; _key19++) {\n    args[_key19 - 1] = arguments[_key19];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"skipWhile\", [f]), this.withHandler(function (event) {\n      if (ok || !event.hasValue() || !f(event.value())) {\n        if (event.hasValue()) {\n          ok = true;\n        }\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.slidingWindow = function (n) {\n  var minValues = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n  return withDesc(new Bacon.Desc(this, \"slidingWindow\", [n, minValues]), this.scan([], function (window, value) {\n    return window.concat([value]).slice(-n);\n  }).filter(function (values) {\n    return values.length >= minValues;\n  }));\n};\n\nvar spies = [];\nvar registerObs = function (obs) {\n  if (spies.length) {\n    if (!registerObs.running) {\n      try {\n        registerObs.running = true;\n        spies.forEach(function (spy) {\n          spy(obs);\n        });\n      } finally {\n        delete registerObs.running;\n      }\n    }\n  }\n};\n\nBacon.spy = function (spy) {\n  return spies.push(spy);\n};\n\nBacon.Property.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), this.scan(seed, function (prev, next) {\n    return next;\n  }));\n};\n\nBacon.EventStream.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), Bacon.once(seed).concat(this));\n};\n\nBacon.Observable.prototype.takeWhile = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len20 = arguments.length, args = Array(_len20 > 1 ? _len20 - 1 : 0), _key20 = 1; _key20 < _len20; _key20++) {\n    args[_key20 - 1] = arguments[_key20];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"takeWhile\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.throttle = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"throttle\", [delay]), function (changes) {\n    return changes.bufferWithTime(delay).map(function (values) {\n      return values[values.length - 1];\n    });\n  });\n};\n\nObservable.prototype.firstToPromise = function (PromiseCtr) {\n  var _this12 = this;\n\n  if (typeof PromiseCtr !== \"function\") {\n    if (typeof Promise === \"function\") {\n      PromiseCtr = Promise;\n    } else {\n      throw new Exception(\"There isn't default Promise, use shim or parameter\");\n    }\n  }\n\n  return new PromiseCtr(function (resolve, reject) {\n    return _this12.subscribe(function (event) {\n      if (event.hasValue()) {\n        resolve(event.value());\n      }\n      if (event.isError()) {\n        reject(event.error);\n      }\n\n      return Bacon.noMore;\n    });\n  });\n};\n\nObservable.prototype.toPromise = function (PromiseCtr) {\n  return this.last().firstToPromise(PromiseCtr);\n};\n\nBacon[\"try\"] = function (f) {\n  return function (value) {\n    try {\n      return Bacon.once(f(value));\n    } catch (e) {\n      return new Bacon.Error(e);\n    }\n  };\n};\n\nBacon.update = function (initial) {\n  function lateBindFirst(f) {\n    return function () {\n      for (var _len22 = arguments.length, args = Array(_len22), _key22 = 0; _key22 < _len22; _key22++) {\n        args[_key22] = arguments[_key22];\n      }\n\n      return function (i) {\n        return f.apply(undefined, [i].concat(args));\n      };\n    };\n  }\n\n  for (var _len21 = arguments.length, patterns = Array(_len21 > 1 ? _len21 - 1 : 0), _key21 = 1; _key21 < _len21; _key21++) {\n    patterns[_key21 - 1] = arguments[_key21];\n  }\n\n  var i = patterns.length - 1;\n  while (i > 0) {\n    if (!(patterns[i] instanceof Function)) {\n      patterns[i] = _.always(patterns[i]);\n    }\n    patterns[i] = lateBindFirst(patterns[i]);\n    i = i - 2;\n  }\n  return withDesc(new Bacon.Desc(Bacon, \"update\", [initial].concat(patterns)), Bacon.when.apply(Bacon, patterns).scan(initial, function (x, f) {\n    return f(x);\n  }));\n};\n\nBacon.zipAsArray = function () {\n  for (var _len23 = arguments.length, args = Array(_len23), _key23 = 0; _key23 < _len23; _key23++) {\n    args[_key23] = arguments[_key23];\n  }\n\n  var streams = argumentsToObservables(args);\n  return withDesc(new Bacon.Desc(Bacon, \"zipAsArray\", streams), Bacon.zipWith(streams, function () {\n    for (var _len24 = arguments.length, xs = Array(_len24), _key24 = 0; _key24 < _len24; _key24++) {\n      xs[_key24] = arguments[_key24];\n    }\n\n    return xs;\n  }));\n};\n\nBacon.zipWith = function () {\n  for (var _len25 = arguments.length, args = Array(_len25), _key25 = 0; _key25 < _len25; _key25++) {\n    args[_key25] = arguments[_key25];\n  }\n\n  var observablesAndFunction = argumentsToObservablesAndFunction(args);\n  var streams = observablesAndFunction[0];\n  var f = observablesAndFunction[1];\n\n  streams = _.map(function (s) {\n    return s.toEventStream();\n  }, streams);\n  return withDesc(new Bacon.Desc(Bacon, \"zipWith\", [f].concat(streams)), Bacon.when(streams, f));\n};\n\nBacon.Observable.prototype.zip = function (other, f) {\n  return withDesc(new Bacon.Desc(this, \"zip\", [other]), Bacon.zipWith([this, other], f || Array));\n};\n\nfunction ESObservable(observable) {\n  this.observable = observable;\n}\n\nESObservable.prototype.subscribe = function (observerOrOnNext, onError, onComplete) {\n  var observer = typeof observerOrOnNext === 'function' ? { next: observerOrOnNext, error: onError, complete: onComplete } : observerOrOnNext;\n  var subscription = {\n    closed: false,\n    unsubscribe: function () {\n      subscription.closed = true;\n      cancel();\n    }\n  };\n\n  var cancel = this.observable.subscribe(function (event) {\n    if (event.isError()) {\n      if (observer.error) observer.error(event.error);\n      subscription.unsubscribe();\n    } else if (event.isEnd()) {\n      subscription.closed = true;\n      if (observer.complete) observer.complete();\n    } else if (observer.next) {\n      observer.next(event.value());\n    }\n  });\n  return subscription;\n};\n\nESObservable.prototype[symbol('observable')] = function () {\n  return this;\n};\n\nBacon.Observable.prototype.toESObservable = function () {\n  return new ESObservable(this);\n};\n\nBacon.Observable.prototype[symbol('observable')] = Bacon.Observable.prototype.toESObservable;\n\nBacon.fromESObservable = function (_observable) {\n  var observable;\n  if (_observable[symbol(\"observable\")]) {\n    observable = _observable[symbol(\"observable\")]();\n  } else {\n    observable = _observable;\n  }\n\n  var desc = new Bacon.Desc(Bacon, \"fromESObservable\", [observable]);\n  return new Bacon.EventStream(desc, function (sink) {\n    var cancel = observable.subscribe({\n      error: function () {\n        sink(new Bacon.Error());\n        sink(new Bacon.End());\n      },\n      next: function (value) {\n        sink(new Bacon.Next(value, true));\n      },\n      complete: function () {\n        sink(new Bacon.End());\n      }\n    });\n\n    if (cancel.unsubscribe) {\n      return function () {\n        cancel.unsubscribe();\n      };\n    } else {\n      return cancel;\n    }\n  });\n};\n\nif (typeof define !== \"undefined\" && define !== null && define.amd != null) {\n  define([], function () {\n    return Bacon;\n  });\n  if (typeof this !== \"undefined\" && this !== null) {\n    this.Bacon = Bacon;\n  }\n} else if (typeof module !== \"undefined\" && module !== null && module.exports != null) {\n  module.exports = Bacon;\n  Bacon.Bacon = Bacon;\n} else {\n    this.Bacon = Bacon;\n  }\n}).call(this);\n","/*!\n * bytes\n * Copyright(c) 2012-2014 TJ Holowaychuk\n * Copyright(c) 2015 Jed Watson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = bytes;\nmodule.exports.format = format;\nmodule.exports.parse = parse;\n\n/**\n * Module variables.\n * @private\n */\n\nvar formatThousandsRegExp = /\\B(?=(\\d{3})+(?!\\d))/g;\n\nvar formatDecimalsRegExp = /(?:\\.0*|(\\.[^0]+)0+)$/;\n\nvar map = {\n  b:  1,\n  kb: 1 << 10,\n  mb: 1 << 20,\n  gb: 1 << 30,\n  tb: Math.pow(1024, 4),\n  pb: Math.pow(1024, 5),\n};\n\nvar parseRegExp = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb|pb)$/i;\n\n/**\n * Convert the given value in bytes into a string or parse to string to an integer in bytes.\n *\n * @param {string|number} value\n * @param {{\n *  case: [string],\n *  decimalPlaces: [number]\n *  fixedDecimals: [boolean]\n *  thousandsSeparator: [string]\n *  unitSeparator: [string]\n *  }} [options] bytes options.\n *\n * @returns {string|number|null}\n */\n\nfunction bytes(value, options) {\n  if (typeof value === 'string') {\n    return parse(value);\n  }\n\n  if (typeof value === 'number') {\n    return format(value, options);\n  }\n\n  return null;\n}\n\n/**\n * Format the given value in bytes into a string.\n *\n * If the value is negative, it is kept as such. If it is a float,\n * it is rounded.\n *\n * @param {number} value\n * @param {object} [options]\n * @param {number} [options.decimalPlaces=2]\n * @param {number} [options.fixedDecimals=false]\n * @param {string} [options.thousandsSeparator=]\n * @param {string} [options.unit=]\n * @param {string} [options.unitSeparator=]\n *\n * @returns {string|null}\n * @public\n */\n\nfunction format(value, options) {\n  if (!Number.isFinite(value)) {\n    return null;\n  }\n\n  var mag = Math.abs(value);\n  var thousandsSeparator = (options && options.thousandsSeparator) || '';\n  var unitSeparator = (options && options.unitSeparator) || '';\n  var decimalPlaces = (options && options.decimalPlaces !== undefined) ? options.decimalPlaces : 2;\n  var fixedDecimals = Boolean(options && options.fixedDecimals);\n  var unit = (options && options.unit) || '';\n\n  if (!unit || !map[unit.toLowerCase()]) {\n    if (mag >= map.pb) {\n      unit = 'PB';\n    } else if (mag >= map.tb) {\n      unit = 'TB';\n    } else if (mag >= map.gb) {\n      unit = 'GB';\n    } else if (mag >= map.mb) {\n      unit = 'MB';\n    } else if (mag >= map.kb) {\n      unit = 'KB';\n    } else {\n      unit = 'B';\n    }\n  }\n\n  var val = value / map[unit.toLowerCase()];\n  var str = val.toFixed(decimalPlaces);\n\n  if (!fixedDecimals) {\n    str = str.replace(formatDecimalsRegExp, '$1');\n  }\n\n  if (thousandsSeparator) {\n    str = str.split('.').map(function (s, i) {\n      return i === 0\n        ? s.replace(formatThousandsRegExp, thousandsSeparator)\n        : s\n    }).join('.');\n  }\n\n  return str + unitSeparator + unit;\n}\n\n/**\n * Parse the string value into an integer in bytes.\n *\n * If no unit is given, it is assumed the value is in bytes.\n *\n * @param {number|string} val\n *\n * @returns {number|null}\n * @public\n */\n\nfunction parse(val) {\n  if (typeof val === 'number' && !isNaN(val)) {\n    return val;\n  }\n\n  if (typeof val !== 'string') {\n    return null;\n  }\n\n  // Test if the string passed is valid\n  var results = parseRegExp.exec(val);\n  var floatValue;\n  var unit = 'b';\n\n  if (!results) {\n    // Nothing could be extracted from the given string\n    floatValue = parseInt(val, 10);\n    unit = 'b'\n  } else {\n    // Retrieve the value and the unit\n    floatValue = parseFloat(results[1]);\n    unit = results[4].toLowerCase();\n  }\n\n  if (isNaN(floatValue)) {\n    return null;\n  }\n\n  return Math.floor(map[unit] * floatValue);\n}\n","'use strict';\n\n// From https://github.com/sindresorhus/random-int/blob/c37741b56f76b9160b0b63dae4e9c64875128146/index.js#L13-L15\nconst randomInteger = (minimum, maximum) => Math.floor((Math.random() * (maximum - minimum + 1)) + minimum);\n\nconst createAbortError = () => {\n\tconst error = new Error('Delay aborted');\n\terror.name = 'AbortError';\n\treturn error;\n};\n\nconst createDelay = ({clearTimeout: defaultClear, setTimeout: set, willResolve}) => (ms, {value, signal} = {}) => {\n\tif (signal && signal.aborted) {\n\t\treturn Promise.reject(createAbortError());\n\t}\n\n\tlet timeoutId;\n\tlet settle;\n\tlet rejectFn;\n\tconst clear = defaultClear || clearTimeout;\n\n\tconst signalListener = () => {\n\t\tclear(timeoutId);\n\t\trejectFn(createAbortError());\n\t};\n\n\tconst cleanup = () => {\n\t\tif (signal) {\n\t\t\tsignal.removeEventListener('abort', signalListener);\n\t\t}\n\t};\n\n\tconst delayPromise = new Promise((resolve, reject) => {\n\t\tsettle = () => {\n\t\t\tcleanup();\n\t\t\tif (willResolve) {\n\t\t\t\tresolve(value);\n\t\t\t} else {\n\t\t\t\treject(value);\n\t\t\t}\n\t\t};\n\n\t\trejectFn = reject;\n\t\ttimeoutId = (set || setTimeout)(settle, ms);\n\t});\n\n\tif (signal) {\n\t\tsignal.addEventListener('abort', signalListener, {once: true});\n\t}\n\n\tdelayPromise.clear = () => {\n\t\tclear(timeoutId);\n\t\ttimeoutId = null;\n\t\tsettle();\n\t};\n\n\treturn delayPromise;\n};\n\nconst createWithTimers = clearAndSet => {\n\tconst delay = createDelay({...clearAndSet, willResolve: true});\n\tdelay.reject = createDelay({...clearAndSet, willResolve: false});\n\tdelay.range = (minimum, maximum, options) => delay(randomInteger(minimum, maximum), options);\n\treturn delay;\n};\n\nconst delay = createWithTimers();\ndelay.createWithTimers = createWithTimers;\n\nmodule.exports = delay;\n// TODO: Remove this for the next major release\nmodule.exports.default = delay;\n"],"names":["_slice","Array","prototype","slice","Bacon","toString","Exception","g","this","Error","nop","former","x","_","assert","message","condition","assertObservableIsProperty","_isObservable","_isProperty","assertFunction","f","isFunction","isArray","xs","isObservable","assertNoArguments","args","length","extend","target","arguments","i","prop","inherit","child","parent","hasProp","hasOwnProperty","ctor","key","call","symbol","Symbol","indexOf","indexWhere","head","always","negate","empty","tail","filter","filtered","push","map","result","each","Object","toArray","contains","id","last","all","undefined","any","without","y","remove","splice","fold","seed","flatMap","ys","concat","cached","value","None","_isNone","bind","fn","me","apply","obj","recursionDepth","results","error","UpdateBarrier","rootEvent","waiterObs","waiters","aftersStack","aftersStackHeight","flushed","ensureStackHeight","h","afterTransaction","obs","stackIndexForThisObs","containsObs","processAfters","aftersList","stackSizeAtStart","topOfStack","topAfters","index","_topAfters$index","after","callSuccess","flushWaiters","deps","obsId","obsWaiters","flushDepsOf","dep","internalDeps","whenDoneWith","hasWaiters","inTransaction","event","context","flush","currentEventId","wrappedSubscribe","sink","unsubd","shouldUnsub","doUnsub","unsub","dispatcher","subscribe","noMore","Source","sync","lazy","queue","ConsumingSource","BufferingSource","Desc","method","_isSource","markEnded","ended","consume","mayHave","hasAtLeast","flatten","shift","c","values","isTrigger","s","_isEventStream","fromObservable","_isDesc","findDeps","describe","ref","_len","_key","withDesc","desc","withMethodCallSupport","wrapped","_len2","_key2","methodName","makeFunctionArgs","makeFunction_","partiallyApplied","applied","_len3","_key3","toFieldExtractor","parts","split","partFuncs","fieldValue","toSimpleExtractor","isFieldKey","charAt","_len4","_key4","makeFunction","convertArgsToFunction","sampled","sampledBy","p","_ref","_ref2","toCombinator","toFieldKey","left","right","Some","_isSome","getOrElse","get","forEach","isDefined","inspect","toOption","v","more","eventIdCounter","Event","Next","valueF","eager","_isNext","valueInternal","Initial","End","_isEvent","isEvent","isEnd","isInitial","isNext","isError","hasValue","log","fmap","_isInitial","toNext","initialEvent","nextEvent","endEvent","toEvent","idCounter","registerObs","Observable","initialDesc","CompositeUnsubscribe","ss","unsubscribe","unsubscribed","subscriptions","starting","add","Dispatcher","_subscribe","_handleEvent","handleEvent","pushing","prevError","unsubSrc","EventStream","handler","subscribeInternal","onValue","onValues","onError","onEnd","name","_name","withDescription","assign","subscription","_this2","iterable","count","hasSubscribers","removeSub","pushIt","pushToSubscriptions","tmp","len","sub","unsubscribeFromSource","_this","toProperty","initValue_","initValue","disp","Property","initSent","subbed","reply","sendInit","toEventStream","withHandler","never","when","usage","sources","pats","patterns","patSources","constantToFunction","pat","ixs","triggerFound","j","ix","k","needsBarrier","containsDuplicateDeps","resultStream","triggers","ends","match","i1","cannotSync","source","cannotMatch","nonFlattened","trigger","part","unsubAll","flushLater","flushWhileTriggers","pop","events","i2","e","_p","observables","state","checkObservable","PropertyDispatcher","property","current","currentValueRootId","propertyEnded","groupSimultaneous","_len5","streams","_key5","_len6","_key6","maybeSubSource","_this3","dispatchingId","valId","changes","_this4","_this5","constant","fromBinder","binder","eventTransformer","unbound","shouldUnbind","unbind","unbinder","_len7","_key7","_len8","_key8","argumentsToObservables","argumentsToObservablesAndFunction","combineAsArray","stream","_len9","_key9","combineWith","_argumentsToObservablesAndFunction","combine","other","combinator","withStateMachine","initState","fromF","newState","outputs","output","equals","a","b","isNone","object","skipDuplicates","isEqual","prev","awaiting","not","and","or","scheduler","setTimeout","d","setInterval","clearInterval","clearTimeout","now","Date","getTime","bufferWithTime","delay","bufferWithTimeOrCount","Number","MAX_VALUE","bufferWithCount","flushOrSchedule","buffer","schedule","onInput","onFlush","scheduled","end","valuesToPush","_this6","delayMs","_this7","_len10","_key10","once","unsubRight","unsubLeft","addPropertyInitValueToStream","concatAll","justInitValue","flatMap_","makeSpawner","flatMapFirst","makeObservable","root","firstOnly","limit","rootDep","childDeps","composite","spawn","unsubMe","checkQueue","checkEnd","__","unsubRoot","Bus","subscribeAll","guardedSink","flatMapWithConcurrencyLimit","_len11","_key11","flatMapConcat","later","bufferingThrottle","minimumInterval","newSink","subscribeInput","input","_this8","unsubscribeInput","plug","_this9","assertObservable","rootPush","pushQueue","liftCallback","callback","_len12","_key12","fromCallback","_len13","_key13","fromNodeCallback","_len14","_key14","combineTemplate","template","setValue","ctxStack","mkContext","containsObservables","constructor","compile","funcs","applyStreamValue","newContext","pushContext","compileTemplate","constantValue","resultProperty","rootContext","mapEnd","skipErrors","takeUntil","stopper","endMarker","_event$value","data","flatMapLatest","delayChanges","debounce","debounceImmediate","decode","cases","scan","_this10","acc","initHandled","next","diff","start","prevTuple","tuple","doAction","doEnd","doError","doLog","_len15","_key15","console","endOnError","_len16","_key16","errors","take","first","mapError","flatMapError","err","flatScan","updated","sampler","thisSource","samplerSource","sample","interval","_len17","_key17","reduce","eventMethods","valueAndEnd","fromEventTarget","eventName","_findHandlerMethods","pair","methodPair","addListener","findHandlerMethods","fromEvent","fromPoll","poll","fromPromise","promise","abort","bound","then","done","groupBy","keyF","limitF","src","similar","limited","fromArray","assertArray","pushNeeded","holdWhen","valve","onHold","bufferedValues","srcIsEnded","subscribed","endIfBothEnded","toSend","$","asEventStream","selector","_this11","on","off","jQuery","Zepto","lastEvent","_len18","_key18","merge","assertEventStream","mergeAll","sinks","unsubBoth","repeatedly","repeat","generator","flag","subscribeNext","retry","options","retries","retriesDone","isRetryable","finished","valueStream","pause","sequentially","skip","skipUntil","starter","started","skipWhile","ok","_len19","_key19","slidingWindow","n","minValues","window","spies","running","spy","ESObservable","observable","startWith","takeWhile","_len20","_key20","throttle","firstToPromise","PromiseCtr","_this12","Promise","resolve","reject","toPromise","update","initial","lateBindFirst","_len22","_key22","_len21","_key21","Function","zipAsArray","_len23","_key23","zipWith","_len24","_key24","_len25","_key25","observablesAndFunction","zip","observerOrOnNext","onComplete","observer","complete","closed","cancel","toESObservable","fromESObservable","_observable","module","exports","parse","format","formatThousandsRegExp","formatDecimalsRegExp","kb","mb","gb","tb","Math","pow","pb","parseRegExp","isFinite","mag","abs","thousandsSeparator","unitSeparator","decimalPlaces","fixedDecimals","Boolean","unit","toLowerCase","str","toFixed","replace","join","val","isNaN","floatValue","exec","parseFloat","parseInt","floor","createAbortError","createDelay","defaultClear","set","willResolve","ms","signal","aborted","timeoutId","settle","rejectFn","clear","signalListener","delayPromise","removeEventListener","addEventListener","createWithTimers","clearAndSet","range","minimum","maximum","random","randomInteger"],"sourceRoot":""}