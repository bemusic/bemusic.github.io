(this.webpackJsonp=this.webpackJsonp||[]).push([[11],{100:function(t,e,n){"use strict";e.a=function(t){return{as:e=>new Promise((function(n,r){let a=new FileReader;switch(a.onload=function(){n(a.result)},a.onerror=function(){r(new Error("Unable to read from Blob"))},e){case"arraybuffer":a.readAsArrayBuffer(t);break;case"text":a.readAsText(t)}}))}}},1069:function(t,e,n){t.exports=n.p+"build/354b30433269481d2f132496a0d13f64.ogg"},1070:function(t,e,n){t.exports=n.p+"build/38fbcad5f2b14ca6ffc359446f7ec455.ogg"},1162:function(t,e,n){"use strict";n.d(e,"a",(function(){return c}));var r=n(26),a=n.n(r),o=n(29),s=n.n(o),i=n(721);i.d();class c extends a.a.Component{componentDidMount(){i.b(),i.e(this.props.url),addEventListener("message",this.handleMessage)}componentWillUnmount(){i.a(),removeEventListener("message",this.handleMessage)}componentWillReceiveProps(t){i.e(t.url)}render(){return null}handleMessage({data:t}){"calibration-started"===t.type?i.a():"calibration-closed"===t.type&&i.b()}}c.propTypes={url:s.a.string}},1163:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(742),a=function(t,e,n,r){return new(n||(n=Promise))((function(a,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((r=r.apply(t,e||[])).next())}))};function o(t,e){return a(this,void 0,void 0,(function*(){if(!t)return null;if(t.tutorial)return null;const{baseResources:n}=Object(r.a)(t,e);return(yield n.file(t.preview_url||"_bemuse_preview.mp3")).resolveUrl()}))}},118:function(t,e,n){"use strict";n.d(e,"a",(function(){return i}));var r=n(119),a=n(50),o=function(t,e,n,r){return new(n||(n=Promise))((function(a,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((r=r.apply(t,e||[])).next())}))};class s{constructor(t){this.url=t}read(t){return Object(r.a)(this.url).as("arraybuffer",t)}resolveUrl(){return o(this,void 0,void 0,(function*(){return Promise.resolve(this.url)}))}get name(){return Object(a.basename)(this.url)}}class i{constructor(t){this.base=t}file(t){return o(this,void 0,void 0,(function*(){const e=t.split("/").map(t=>encodeURIComponent(t)).join("/");return new s(new URL(e,this.base).href)}))}}e.b=s},119:function(t,e,n){"use strict";var r=n(78),a=function(t,e,n,r){return new(n||(n=Promise))((function(a,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((r=r.apply(t,e||[])).next())}))};e.a=function(t,{getRetryDelay:e=(()=>1e3+4e3*Math.random())}={}){return{as(n,o){return a(this,void 0,void 0,(function*(){let a=!1;for(let s=1;;s++)try{return yield new Promise((e,s)=>{var i=new XMLHttpRequest;i.open("GET",t,!0),i.responseType=n,i.onload=()=>{200==+i.status?e(i.response):(403!=+i.status&&404!=+i.status||(a=!0),s(new Error(`Unable to download ${t}: HTTP ${i.status}`)))},i.onerror=()=>s(new Error("Unable to download "+t)),o&&(o.formatter=r.a,i.onprogress=t=>o.report(t.loaded,t.total)),i.send(null)})}catch(n){if(console.error(`Unable to download ${t} [attempt ${s}]`,n),s>=3||a)throw n;const r=e();yield new Promise(t=>setTimeout(t,r))}}))}}}},125:function(t,e,n){"use strict";var r=n(188);e.a=r.a},137:function(t,e,n){"use strict";e.a=document.querySelector("#scene-root")},188:function(t,e,n){"use strict";n.d(e,"a",(function(){return a}));var r=n(189);class a{constructor(){this.current=void 0,this.total=void 0,this._observable=new r.a}report(t,e,n){this.current=t,this.total=e,this.extra=n,this._observable.notify()}watch(t){return t(this),this._observable.watch(()=>t(this))}get progress(){return this.total&&void 0!==this.current&&null!==this.current?this.current/this.total:null}toString(){return void 0!==this.formatter?this.formatter(this):null!==this.progress?this.current+" / "+this.total:""}}},189:function(t,e,n){"use strict";var r=n(190);e.a=class{constructor(t){this._callbacks=new r.a,this._value=t}get value(){return this._value}set value(t){this._value=t,this.notify(t)}notify(t){this._callbacks.call(t)}watch(t){return void 0!==this._value&&t(this._value),this._callbacks.add(t)}}},190:function(t,e,n){"use strict";e.a=class{constructor(t){if(this._callbacks={},this._nextId=1,"function"==typeof t)this.add(t);else if("object"==typeof t&&t&&t.length)for(var e=0;e<t.length;e++)this.add(t[e])}call(...t){var e=this._callbacks;for(var n in e)e[n](...t)}add(t){var e=this._nextId++;return this._callbacks[e]=t,()=>delete this._callbacks[e]}}},1949:function(t,e,n){"use strict";n.r(e),n.d(e,"main",(function(){return R}));var r=n(721),a=n(137),o=n(26),s=n.n(o),i=n(66),c=n(642),u=n(2),l=n(356),d=n(34),f=n.n(d),h=n(1162),p=n(29),m=n.n(p),b=n(357),v=n(682),y=n(643),g=n(1163),w=function(t,e,n,r){return new(n||(n=Promise))((function(a,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((r=r.apply(t,e||[])).next())}))};const E={ingame:t=>Object(v.a)(Object(y.a)(t)),added:t=>[{title:"Sorted by added date",songs:f.a.reverse(f.a.sortBy(t,_))}]},_=t=>t.added||(t.initial?"0000-00-00":"9999-99-99");function k(t){const e=function(t){const e=[],n=(t,...n)=>e.push({keys:n,message:t});t.unreleased&&n("Not released","unreleased"),t.readme||n("No README file found","README.md"),t.replaygain||n("No replay gain","replaygain"),t.artist_url||n("No artist URL","artist_url"),t.added||t.initial||n("No added date","added"),t.song_url||t.youtube_url||t.long_url||n("No song/YouTube/long URL","song_url","long_url","youtube_url"),t.bms_url||t.exclusive||n("No download URL","bms_url"),t.bmssearch_id||t.exclusive||n("No BMS search ID","bmssearch_id"),t.charts.filter(t=>"5K"===t.keys).length||n("No 5-key charts","5key");for(const e of Object(b.a)(t.charts))e.info.subtitles.length||n("Missing subtitle","chart_names "+e.file);return e}(t);return e.length?s.a.createElement("div",null,e.map((t,e)=>s.a.createElement("div",{key:e},t.keys.map(t=>s.a.createElement("code",{key:t,style:{fontFamily:"Ubuntu Mono",marginRight:"2",padding:3,fontSize:"0.8em",background:"#755"}},t)),t.message))):null}class x extends s.a.Component{constructor(t){super(t),this.state={sort:this.props.initialSort||Object.keys(E)[0],previewUrl:null,previewEnabled:!1}}renderTable(){return s.a.createElement("table",{style:{borderSpacing:4}},s.a.createElement("thead",null,s.a.createElement("tr",null,s.a.createElement("th",{colSpan:4},this.renderSorter()," Â· ",this.renderPreview())),s.a.createElement("tr",null,s.a.createElement("th",null,"id"),s.a.createElement("th",null,"song"),s.a.createElement("th",null,"warnings"))),s.a.createElement("tbody",null,this.renderRows()))}renderSorter(){const t=[];for(const e of Object.keys(E))t.push(s.a.createElement("button",{key:e,onClick:()=>{this.setState({sort:e})}},e));return s.a.createElement("span",null,s.a.createElement("strong",null,"Sort by:")," ",t)}renderPreview(){const t=s.a.createElement("button",{onClick:()=>{this.setState(t=>({previewEnabled:!t.previewEnabled}))}},this.state.previewEnabled?"disable":"enable");return s.a.createElement("span",null,s.a.createElement("strong",null,"Music preview:")," ",t,this.state.previewEnabled&&s.a.createElement(h.a,{url:this.state.previewUrl}))}renderRows(){const t=E[this.state.sort](this.props.data.songs),e=[];for(const r of t){e.push(s.a.createElement("tr",{key:r.title},s.a.createElement("th",{colSpan:4},r.title)));for(const t of r.songs)e.push(s.a.createElement("tr",{key:t.id},s.a.createElement("td",null,s.a.createElement("strong",{onClick:()=>{prompt("",`vim '${t.id}/README.md'`)}},s.a.createElement("code",{style:{fontFamily:"Ubuntu Mono"}},t.id)),s.a.createElement("br",null),s.a.createElement("span",{style:{color:"#8b8685"}},t.added)),s.a.createElement("td",{style:{textAlign:"center",background:"#353433"}},s.a.createElement("span",{style:{color:"#8b8685"},onClick:()=>w(this,void 0,void 0,(function*(){const e=yield Object(g.a)(t,this.props.url);this.setState({previewUrl:e})}))},t.genre),s.a.createElement("br",null),s.a.createElement("strong",{onClick:()=>{console.log(t),alert(n(138).inspect(t))}},t.title),s.a.createElement("br",null),t.artist),s.a.createElement("td",null,k(t))))}return e}renderMessage(t){return s.a.createElement("div",{style:{textAlign:"center"}},t)}render(){if(!this.props.data)return this.renderMessage("No data");try{return this.renderTable()}catch(t){return this.renderMessage("Error: "+t)}}}x.propTypes={data:m.a.object,url:m.a.string,initialSort:m.a.string};var j=x;class S extends s.a.Component{constructor(t){super(t),this.state={url:u.a.server||l.a,status:"Loading"}}componentDidMount(){Object(l.c)(this.state.url).then(t=>{this.setState({status:"Load completed",data:t})}).catch(t=>{this.setState({status:"Load error: "+t})})}render(){return s.a.createElement("div",null,s.a.createElement("header",{style:{textAlign:"center"}},s.a.createElement("h1",null,"Bemuse collection viewer"),s.a.createElement("div",null,this.state.url,s.a.createElement("br",null),this.state.status)),s.a.createElement("div",{style:{padding:20}},s.a.createElement(j,{data:this.state.data&&Object(c.a)(this.state.data),url:this.state.url,initialSort:u.a.sort})))}}var O=S;function R(){r.d(),Object(i.render)(s.a.createElement(O,null),a.a)}},243:function(t,e,n){"use strict";e.a=function(t){return"7K"===t.keys||"5K"===t.keys}},356:function(t,e,n){"use strict";(function(t){n.d(e,"a",(function(){return a})),n.d(e,"c",(function(){return o})),n.d(e,"b",(function(){return s}));var r=function(t,e,n,r){return new(n||(n=Promise))((function(a,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((r=r.apply(t,e||[])).next())}))};const a="https://music4.bemuse.ninja/server";function o(e,{fetch:n=t.fetch}={}){return r(this,void 0,void 0,(function*(){const t=s(e),r=yield n(t).then(t=>t.json());if(Array.isArray(r.songs))return r;if(Array.isArray(r.charts)){const e=t.replace(/[^/]*$/,"");return{songs:[Object.assign(Object.assign({},r),{id:"song",path:e})]}}throw new Error(`Invalid server file at ${t}: Does not contain "songs" array.`)}))}function s(t){return t.endsWith("/bemuse-song.json")?t:t.replace(/\/(?:index\.json)?$/,"")+"/index.json"}}).call(this,n(30))},357:function(t,e,n){"use strict";var r=n(34),a=n.n(r),o=n(243);e.a=function(t){return a()(t).filter(o.a).orderBy([t=>t.info.difficulty>=5?1:0,t=>t.keys,t=>t.info.level]).value()}},562:function(t,e){},564:function(t,e){},596:function(t,e){},597:function(t,e){},642:function(t,e,n){"use strict";var r=n(104),a=n.n(r);const o=a()({songs:a.a.map((function(t){t.chart_names&&(t=a()({charts:a.a.map(e=>{const n=t.chart_names[e.file];return n?a()({info:{subtitles:t=>[...t,n]}},e):e})},t));return t}))});e.a=o},643:function(t,e,n){"use strict";var r=n(34),a=n.n(r),o=n(243);e.a=function(t){return a.a.orderBy(t,[t=>a()(t.charts).filter(o.a).filter(t=>t.info.difficulty<5).filter(t=>t.info.level>0).map(t=>t.info.level).min(),t=>t.bpm,t=>t.title.toLowerCase()])}},648:function(t,e,n){"use strict";var r=n(125),a=n(97),o=n(100),s=n(34),i=n.n(s),c=n(209),u=n.n(c),l=n(118),d=function(t,e,n,r){return new(n||(n=Promise))((function(a,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((r=r.apply(t,e||[])).next())}))};class f{constructor(t,e,n){this.resources=t,this.ref=e,this.name=n}read(t){return a.a(t,this.resources.getBlob(this.ref).then(t=>Object(o.a)(t).as("arraybuffer")))}resolveUrl(){return d(this,void 0,void 0,(function*(){const t=yield this.resources.getBlob(this.ref);return URL.createObjectURL(t)}))}}class h{constructor(t,e){this.resources=t,this._basePromise=t.base.file(e.path)}load(){return this._promise||(this._promise=this.resources.loadPayload(this._basePromise))}}function p(t){return d(this,void 0,void 0,(function*(){if("BEMUSEPACK"!==(yield Object(o.a)(t.slice(0,10)).as("text")))throw new Error("Invalid magic number");const e=yield Object(o.a)(t.slice(10,14)).as("arraybuffer");let n=new Uint8Array(e);const r=n[0]+(n[1]<<8)+(n[2]<<16)+(n[3]<<24);return t.slice(14+r)}))}e.a=class{constructor(t,e={}){this.progress={all:new r.a,current:new r.a},this._getMetadata=i.a.once(()=>d(this,void 0,void 0,(function*(){const t=yield this._base.file(this._metadataFilename),e=yield t.read(),n=yield new Blob([e]).text();return JSON.parse(n)}))),this._getRefs=i.a.once(()=>d(this,void 0,void 0,(function*(){return(yield this._getMetadata()).refs.map(t=>new h(this,t))}))),this._getFileMap=i.a.once(()=>d(this,void 0,void 0,(function*(){const t=yield this._getMetadata();let e=new Map;for(let n of t.files)e.set(n.name.toLowerCase(),n);return e}))),"string"==typeof t&&(t=new l.a(new URL(t,location.href)));const n="string"==typeof e.fallback?new l.a(new URL(e.fallback,location.href)):e.fallback;this._base=t,this._fallback=n,this._fallbackPattern=e.fallbackPattern,this._metadataFilename=e.metadataFilename||"metadata.json";let o=a.d(this.progress.current);this.loadPayload=a.e(this.progress.all,u()(2,t=>t.then(t=>t.read((()=>{let t=new r.a;return o.add(t),t})())).then(t=>new Blob([t])).then(p)))}get base(){return this._base}file(t){return d(this,void 0,void 0,(function*(){let e=(yield this._getFileMap()).get(t.toLowerCase());if(e)return new f(this,e.ref,e.name);if(this._fallback&&this._fallbackPattern&&this._fallbackPattern.test(t))return this._fallback.file(t);throw new Error("Unable to find: "+t)}))}getBlob([t,e,n]){return d(this,void 0,void 0,(function*(){const r=(yield this._getRefs())[t];return(yield r.load()).slice(e,n)}))}}},682:function(t,e,n){"use strict";var r=n(34),a=n.n(r),o=n(560);const s=a.a.once(()=>{const t=new Date(Date.now()+324e5).toISOString().split("T")[0];return a.a.memoize(e=>{const n=Object(o.createHash)("md5");return n.update(e),n.update(t),n.digest("hex")})});class i{constructor(t,{enabled:e=!0}={}){if(!e)return void(this.ids=new Set);const n=a.a.sortBy(t.filter(t=>!t.custom&&!t.tutorial),t=>s()(t.id));this.ids=new Set(n.slice(0,3).map(t=>t.id))}isSongOfTheDay(t){return this.ids.has(t)}}const c=[{title:"Custom Song",criteria:t=>t.custom},{title:"Tutorial",criteria:t=>t.tutorial},{title:"Unreleased",criteria:t=>t.unreleased},{title:"Recently Added Songs",criteria:t=>t.added&&Date.now()-Date.parse(t.added)<5184e6,sort:t=>t.added,reverse:!0},{title:"Random Songs of the Day",criteria:(t,e)=>e.songOfTheDay.isSongOfTheDay(t.id)},{title:"â",criteria:()=>!0}];e.a=function(t,{songOfTheDayEnabled:e=!1}={}){const n={songOfTheDay:new i(t,{enabled:e})};let r=c.map(t=>({input:t,output:{title:t.title,songs:[]}}));for(let e of t)for(let{input:t,output:a}of r)if(t.criteria(e,n)){a.songs.push(e);break}for(let{input:t,output:e}of r)t.sort?e.songs=a.a.orderBy(e.songs,[t.sort],[t.reverse?"desc":"asc"]):t.reverse&&e.songs.reverse();return a()(r).map("output").filter(t=>t.songs.length>0).value()}},693:function(t,e,n){"use strict";n.d(e,"a",(function(){return o}));var r=n(118),a=function(t,e,n,r){return new(n||(n=Promise))((function(a,o){function s(t){try{c(r.next(t))}catch(t){o(t)}}function i(t){try{c(r.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?a(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,i)}c((r=r.apply(t,e||[])).next())}))};function o(t,e){if(e.includes("://"))return[new r.a(new URL(e)),e.split("/").slice(-1)[0]];const n=e.split("/");let a=t;for(;n.length>1;){const t=n.shift();a=new s(a,t)}return[a,n[0]]}class s{constructor(t,e){this.base=t,this.dirName=e}file(t){return a(this,void 0,void 0,(function*(){return this.base.file(`${this.dirName}/${t}`)}))}}},721:function(t,e,n){"use strict";n.d(e,"d",(function(){return o})),n.d(e,"b",(function(){return s})),n.d(e,"a",(function(){return i})),n.d(e,"c",(function(){return c})),n.d(e,"e",(function(){return u}));let r=null;function a(){return r||(r=function(){let t=!1,e=null,r=!1,a=!1;const o={},s=new Audio(n(1069));s.preload="auto",s.loop=!0,s.oncanplaythrough=()=>{r=!0,u()},s.load();const i=document.createElement("audio");i.src=n(1070),i.volume=.5,i.load();const c=l(s,.5,t=>{0===t&&a&&(a=!1,s.pause())});function u(){if(!t){a&&(c.fadeTo(0,100),a=!1,s.pause());for(const t of Object.keys(o)){o[t].destroy()}return}let n=null;for(const t of Object.keys(o)){const r=o[t];t===e?r.loaded&&(r.play(),n=r):r.stop()}if(n)c.fadeTo(0,1);else if(c.fadeTo(.4,.5),r&&!a){a=!0;try{s.play()}catch(t){console.warn("Cannot play background music")}}}return{enable(){t||(t=!0,u())},disable(){t&&(t=!1,u())},go(){if(t){i.currentTime=0;try{i.play()}catch(t){console.warn("Cannot play go sound.")}}},preview(t){e!==t&&(e=t,t&&!o[t]&&(o[t]=function(t){const e=document.createElement("audio");e.src=t;let n=!1;const r=l(e,1,n=>{0===n&&(e.pause(),delete o[t],u())}),a={loaded:!1,play(){if(!n)try{e.play(),n=!0}catch(t){console.warn("Cannot play",e.src)}r.fadeTo(1,2)},stop(){r.fadeTo(0,4)},destroy(){e.pause(),delete o[t],u()}};return e.oncanplaythrough=()=>{a.loaded=!0,u()},e.onended=()=>{delete o[t],u()},e.load(),a}(t)),u())}}}())}function o(){a()}function s(){return a().enable()}function i(){return a().disable()}function c(){return a().go()}function u(t){return a().preview(t)}function l(t,e,n){let r,a=0,o=0,s=!1;function i(){return(Date.now()-r)/1e3}function c(){return a>e?Math.min(a,e+i()*o):a<e?Math.max(a,e-i()*o):a}function u(){s=!1;const e=c();t.volume=e,e===a?n&&n(a):s||(s=!0,requestAnimationFrame(u))}return t.volume=e,{fadeTo(t,n){a===t&&n===o||(e=c(),a=t,o=n,r=Date.now(),u())}}}},742:function(t,e,n){"use strict";n.d(e,"a",(function(){return s}));var r=n(648),a=n(693),o=n(118);function s(t,e){const n=t.resources||new o.a(new URL(t.path.replace(/\/?$/,"/"),e.replace(/\/?$/,"/")));return{baseResources:n,assetResources:function(t,e){if(null===e)return t;void 0===e&&(e="assets/metadata.json");const[n,o]=Object(a.a)(t,e);return new r.a(n,{metadataFilename:o,fallback:t,fallbackPattern:/\.(?:png|jpg|webm|mp4|m4v)/})}(n,t.bemusepack_url)}}},78:function(t,e,n){"use strict";n.d(e,"a",(function(){return s})),n.d(e,"c",(function(){return i})),n.d(e,"b",(function(){return c}));var r=n(363),a=n.n(r);let o=t=>e=>null!==e.progress?t(e):"",s=o(t=>a()(t.current)+" / "+a()(t.total)),i=o(t=>(t.current/t.total*100).toFixed(1)+"%"),c=o(t=>t.extra+"")},97:function(t,e,n){"use strict";n.d(e,"c",(function(){return a})),n.d(e,"a",(function(){return o})),n.d(e,"e",(function(){return s})),n.d(e,"b",(function(){return i})),n.d(e,"d",(function(){return c}));var r=n(78);function a(t,e){if(!e)return()=>{};let n=0;return e.report(0,t),r=>e.report(++n,t,r)}function o(t,e){return t?Promise.resolve(e).tap(e=>{!function(t){return t&&t.byteLength}(e)?t.report(1,1):(t.formatter=r.a,t.report(e.byteLength,e.byteLength))}):e}function s(t,e){let n=0,r=0;return function(...a){return t.report(n,++r),Promise.resolve(e.apply(this,a)).tap(()=>t.report(++n,r))}}function i(t,e){return t.watch(()=>e.report(t.current,t.total,t.extra))}function c(t){let e,n=[],r=null;function a(){e&&t.report(e.current,e.total,e.extra),n.length>0&&(!e||e.progress>=1)&&function(t){if(e===t)return;r&&(r(),r=null);e=t,e&&(r=e.watch(a))}(n.shift())}return{add(t){n.push(t),a()}}}}}]);
//# sourceMappingURL=music-002a36fdde0e28a39560.js.map