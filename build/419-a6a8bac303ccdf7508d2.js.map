{"version":3,"file":"build/419-a6a8bac303ccdf7508d2.js","mappings":"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","sources":["file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/BemuseTestMode.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss?[contenthash]","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/benchmark.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/query-flags.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/Gauge.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/note-area.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/player-display.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/touch3d.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/control.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/judgments.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/player.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/player-state.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/player-stats.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/logger/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/midi.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/axis-logic.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/Progress.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/formatters.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/utils.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/addUnprefixed.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/resource-logging.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/unarchiver.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/custom-song-resources.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/url.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/callbacks.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/download.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/formatTime.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/now.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/observable.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/read-blob.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/index.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/BMSNotechartLoader.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/types.js"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".BenchmarkPanel {\\n  background: #449;\\n  border: 2px solid #66e;\\n  padding: 4px;\\n}\\n.BenchmarkPanel table {\\n  font-size: 10px;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./devtools/ui/BenchmarkPanel.scss\"],\"names\":[],\"mappings\":\"AAEA;EACE,gBAAA;EACA,sBAAA;EACA,YAAA;AADF;AAEE;EACE,eAAA;AAAJ\",\"sourcesContent\":[\"@import '~bemuse/ui/common';\\n\\n.BenchmarkPanel {\\n  background: #449;\\n  border: 2px solid #66e;\\n  padding: 4px;\\n  table {\\n    font-size: 10px;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","let _enabled = false\n\nlet _lifecycleHandler = {\n  /** @returns {Promise<void>} */\n  pauseAt(t) {\n    throw new Error('Cannot pause: No lifecycle handler registered!')\n  },\n  /** @returns {void} */\n  unpause() {\n    throw new Error('Cannot unpause: No lifecycle handler registered!')\n  },\n  /** @returns {number} */\n  getScore() {\n    throw new Error('Cannot get score: No lifecycle handler registered!')\n  },\n}\n\n/**\n * Activates the test mode. In this mode,\n *\n * - An overlay will be displayed indicating the test mode.\n * - The following APIs will be available to facilitate automated testing:\n *     - `BemuseTestMode.pauseAt(t)` will make the game pause at time `t`.\n *     - `BemuseTestMode.unpause()` will unpause the game.\n * - Score submission is disabled.\n *\n * Note: Once test mode is activated, it cannot be deactivated for the rest of the game session.\n */\nexport function enableTestMode() {\n  if (!_enabled) {\n    _enabled = true\n    console.log('[Bemuse test mode enabled]')\n    const overlay = document.createElement('div')\n    overlay.setAttribute(\n      'style',\n      `\n        position: fixed;\n        top: 20px;\n        left: 20px;\n        font: 20px Comic Sans MS, sans-serif;\n        z-index: 99999;\n        background: rgba(0,0,0,0.5);\n        color: #0f0;\n        border: 2px solid #0f0;\n        padding: 4px;\n        pointer-events: none;\n      `\n    )\n    overlay.innerHTML = `\n      <strong>Test mode:</strong>\n      Bemuse is being controlled by automated test software.\n    `\n    document.body.appendChild(overlay)\n  }\n}\n\n/**\n * Registers a pause handler.\n * This allows the `pauseAt` and `unpause` APIs to be used.\n *\n * @param {typeof _lifecycleHandler} handler\n */\nexport function setGameLifecycleHandler(handler) {\n  console.log('[Bemuse test mode] A pause handler has been registered.')\n  _lifecycleHandler = handler\n}\n\n/**\n * Returns `true` if test mode is enabled, `false` otherwise.\n */\nexport function isTestModeEnabled() {\n  return !!_enabled\n}\n\n/**\n * Will schedule the game to pause at time `t`.\n *\n * @param {number} t The song time to pause in seconds\n * @returns {Promise<void>} A promise that will be resolved when the time is reached and game is paused.\n */\nexport function pauseAt(t) {\n  return _lifecycleHandler.pauseAt(t)\n}\n\n/**\n * Unpauses the game.\n */\nexport function unpause() {\n  return _lifecycleHandler.unpause()\n}\n\n/**\n * Returns the current score.\n */\nexport function getScore() {\n  return _lifecycleHandler.getScore()\n}\n","\n      import API from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./BenchmarkPanel.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./BenchmarkPanel.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import './BenchmarkPanel.scss'\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default class BenchmarkPanel extends React.Component {\n  static propTypes = {\n    bench: PropTypes.object,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      show: false,\n      text: 'wow',\n    }\n  }\n\n  render() {\n    return (\n      <div\n        className='BenchmarkPanel'\n        onClick={this.handleInteraction}\n        onTouchStart={this.handleInteraction}\n      >\n        {this.state.show ? (\n          <article>\n            <b>Benchmark Stats</b>\n            <br />\n            {this.renderTable()}\n          </article>\n        ) : (\n          'Show Benchmark Stats'\n        )}\n      </div>\n    )\n  }\n\n  componentDidMount() {\n    setInterval(() => this.forceUpdate(), 1000)\n  }\n\n  renderTable = () => {\n    const stats = this.props.bench.stats\n    return (\n      <table>\n        <tbody>\n          {Object.keys(stats).map((key) => {\n            const stat = stats[key]\n            return (\n              <tr>\n                <td>\n                  <strong>{key}</strong>\n                </td>\n                <td align='right'>{'' + stat}</td>\n              </tr>\n            )\n          })}\n        </tbody>\n      </table>\n    )\n  }\n\n  handleInteraction = (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    this.setState({ show: !this.state.show })\n  }\n}\n","import now from 'bemuse/utils/now'\nimport { shouldEnableBenchmark } from './query-flags'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport BenchmarkPanel from './ui/BenchmarkPanel'\n\nfunction Stat() {\n  let sum = 0\n  let count = 0\n  let average = 0\n  const hist = []\n  let lastSec = 0\n  let secAvg = 0\n  return {\n    push: function (delta) {\n      const t = now()\n      sum += delta\n      count += 1\n      average = sum / count\n      lastSec += delta\n      hist.push({ delta, time: t })\n      while (hist[0] && hist[0].time < t - 1000) {\n        lastSec -= hist.shift().delta\n      }\n      secAvg = lastSec / hist.length\n    },\n    toString() {\n      return format(average) + ' / ' + format(secAvg)\n    },\n  }\n}\n\nfunction format(x) {\n  return x.toFixed(2) + 'ms'\n}\n\nfunction Benchmarker() {\n  const stats = {}\n  const bench = {\n    enabled: true,\n    stats,\n    wrap(title, f) {\n      return function () {\n        const start = now()\n        try {\n          return f.apply(this, arguments)\n        } finally {\n          const finish = now()\n          const stat = stats[title] || (stats[title] = new Stat(title))\n          stat.push(finish - start)\n        }\n      }\n    },\n    benchmark(title, obj, name) {\n      obj[name] = this.wrap(title, obj[name])\n    },\n    toString() {\n      const lines = []\n      Object.keys(stats).forEach(function (key) {\n        lines.push('- ' + key + ': ' + stats[key])\n      })\n      return lines.join('\\n')\n    },\n  }\n  const div = document.createElement('div')\n  div.setAttribute('style', 'position:fixed;top:10px;right:10px;z-index:99999')\n  document.body.appendChild(div)\n  ReactDOM.render(<BenchmarkPanel bench={bench} />, div)\n  return bench\n}\n\nfunction FakeBenchmarker() {\n  return {\n    enabled: false,\n    wrap: (title, f) => f,\n  }\n}\n\nexport default window.BEMUSE_BENCHMARK = shouldEnableBenchmark()\n  ? new Benchmarker()\n  : new FakeBenchmarker()\n","import query from 'bemuse/utils/query'\n\nexport function shouldShowOptions() {\n  return query.BEMUSE_SHOW_OPTIONS === '1'\n}\n\nexport function shouldEnableBenchmark() {\n  return query.BEMUSE_BENCHMARK === '1'\n}\n\nexport function shouldDisableFullScreen() {\n  return query.BEMUSE_NO_FULLSCREEN === '1'\n}\n\nexport function shouldShowAbout() {\n  return query.BEMUSE_SHOW_ABOUT === '1'\n}\n\nexport function shouldShowModeSelect() {\n  return query.BEMUSE_SHOW_MODE_SELECT === '1'\n}\n\nexport function isTitleDisplayMode() {\n  return query.BEMUSE_TITLE_DISPLAY === '1'\n}\n","export function getGauge(gaugeType) {\n  if (gaugeType === 'hope') {\n    return hopeGauge()\n  }\n  return nullGauge()\n}\n\nfunction nullGauge() {\n  return {\n    update() {},\n    shouldDisplay() {\n      return false\n    },\n    getPrimary() {\n      return 0\n    },\n    getSecondary() {\n      return 0\n    },\n    getExtra() {\n      return 0\n    },\n  }\n}\n\nfunction hopeGauge() {\n  let primary\n  let secondary\n  let extra\n  return {\n    update(playerState) {\n      const stats = playerState.stats\n      const progress = stats.numJudgments / stats.totalCombo\n      const getHope = (min, max1, max2) => {\n        const max = max1 + (max2 - max1) * progress\n        const maxPossibleScore = stats.maxPossibleScore\n        return Math.max(0, (maxPossibleScore - min) / (max - min))\n      }\n      const hopeS = getHope(500000, 555555, 510000) * 0.5\n      primary = Math.min(1, hopeS)\n      extra = Math.max(0, Math.min(1, hopeS - 1))\n      if (hopeS > 0) {\n        secondary = 0\n      } else {\n        const hopeA = getHope(450000, 500000, 500000)\n        secondary = hopeA\n      }\n    },\n    shouldDisplay() {\n      return primary > 0 || secondary > 0\n    },\n    getPrimary() {\n      return primary\n    },\n    getSecondary() {\n      return secondary\n    },\n    getExtra() {\n      return extra\n    },\n  }\n}\n","import _ from 'lodash'\n\nexport class NoteArea {\n  constructor(notes, barLines) {\n    this._notes = _.sortBy(notes, position)\n    this._barLines = _(barLines).map('position').sortBy().value()\n  }\n\n  getVisibleNotes(lower, upper, headroom) {\n    const out = []\n    const notes = this._notes\n    if (!headroom) headroom = 0\n    for (let i = 0; i < notes.length; i++) {\n      const note = notes[i]\n      const visible = note.end\n        ? !(note.position > upper || note.end.position < lower - headroom)\n        : !(note.position > upper || note.position < lower - headroom)\n      if (visible) {\n        const entity = { note: note }\n        if (!note.end) {\n          entity.y = y(lower, upper, note.position)\n        } else {\n          const head = y(lower, upper, note.position)\n          const tail = y(lower, upper, note.end.position)\n          entity.y = Math.min(head, tail)\n          entity.height = Math.abs(head - tail)\n        }\n        out.push(entity)\n      }\n    }\n    return out\n  }\n\n  getVisibleBarLines(lower, upper, headroom) {\n    if (!headroom) headroom = 0\n    return this._barLines\n      .filter((pos) => lower - headroom <= pos && pos <= upper)\n      .map((pos) => ({ id: pos, y: y(lower, upper, pos) }))\n  }\n}\n\nexport default NoteArea\n\nfunction y(lower, upper, pos) {\n  return 1 - (pos - lower) / (upper - lower)\n}\n\nfunction position(event) {\n  return event.position\n}\n","import * as touch3d from './touch3d'\nimport NoteArea from './note-area'\nimport { MISSED, breaksCombo } from '../judgments'\nimport { getGauge } from './Gauge'\n\nexport class PlayerDisplay {\n  constructor(player, skinData) {\n    this._currentSpeed = 1\n    this._player = player\n    this._noteArea = new NoteArea(\n      player.notechart.notes,\n      player.notechart.barLines\n    )\n    this._stateful = {}\n    this._defaultData = {\n      placement: player.options.placement,\n      scratch: player.options.scratch,\n      key_mode: player.notechart.getKeyMode(player.options.scratch),\n      lane_lift: Math.max(0, -player.options.laneCover),\n      lane_press: Math.max(0, player.options.laneCover),\n    }\n    this._gauge = getGauge(player.options.gauge)\n    this._touch3dMode = skinData.displayMode === 'touch3d'\n  }\n\n  update(time, gameTime, playerState) {\n    const touch3dMode = this._touch3dMode\n    const player = this._player\n    const noteArea = this._noteArea\n    const stateful = this._stateful\n    const beat = player.notechart.secondsToBeat(gameTime)\n    const position = player.notechart.beatToPosition(beat)\n    const spacing = player.notechart.spacingAtBeat(beat)\n    const data = Object.assign({}, this._defaultData)\n    const push = (key, value) => (data[key] || (data[key] = [])).push(value)\n    const gauge = this._gauge\n\n    this._currentSpeed += (playerState.speed - this._currentSpeed) / 3\n    const speed = this._currentSpeed * spacing\n\n    updateBeat()\n    updateVisibleNotes()\n    updateBarLines()\n    updateInput()\n    updateJudgment()\n    updateGauge()\n    updateExplode()\n\n    data['speed'] = playerState.speed.toFixed(1) + 'x'\n    data['stat_1'] = getCount(1)\n    data['stat_2'] = getCount(2)\n    data['stat_3'] = getCount(3)\n    data['stat_4'] = getCount(4)\n    data['stat_missed'] = getCount(MISSED)\n    data['stat_acc'] = getAccuracy()\n    const bpm = player.notechart.bpmAtBeat(beat)\n    data['bpm'] = bpm < 1 ? '' : Math.round(bpm) % 10000 || ''\n\n    Object.assign(data, stateful)\n    return data\n\n    function updateBeat() {\n      data.beat = beat\n    }\n\n    function getCount(judgment) {\n      return playerState.stats.counts && playerState.stats.counts[judgment]\n    }\n\n    function getAccuracy() {\n      return ((playerState.stats.currentAccuracy || 0) * 100).toFixed(2) + '%'\n    }\n\n    function updateVisibleNotes() {\n      const entities = noteArea.getVisibleNotes(position, getUpperBound(), 1)\n      if (touch3dMode) {\n        const putNote = (id, noteY, column, scale = 1) => {\n          const row = touch3d.getRow(noteY - 0.01)\n          const columnIndex = +column || -1\n          const areaWidth = touch3d.PLAY_AREA_WIDTH\n          const xOffset =\n            row.projection * areaWidth * ((2 * (columnIndex - 0.5)) / 7 - 1)\n          const desiredWidth = (row.projection * scale * areaWidth * 2) / 7\n          push(`note3d_${column}`, {\n            key: id,\n            y: row.y,\n            x: xOffset + 1280 / 2,\n            width: desiredWidth,\n          })\n        }\n        const longNoteStep = 3 / 128\n        for (const entity of entities) {\n          const note = entity.note\n          const column = note.column\n          if (entity.height) {\n            let c = 0\n            const start = entity.y + entity.height\n            for (\n              let i =\n                start -\n                Math.max(\n                  0,\n                  Math.floor((start - 1) / longNoteStep) * longNoteStep\n                );\n              i >= 0 && i >= entity.y;\n              i -= longNoteStep\n            ) {\n              putNote(note.id + 'x' + c++, i, column, 0.8)\n            }\n            putNote(note.id, entity.y + entity.height, column)\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              putNote(note.id, entity.y, column)\n            }\n          }\n        }\n      } else {\n        for (const entity of entities) {\n          const note = entity.note\n          const column = note.column\n          if (entity.height) {\n            const judgment = playerState.getNoteJudgment(note)\n            const status = playerState.getNoteStatus(note)\n            push(`longnote_${column}`, {\n              key: note.id,\n              y: entity.y,\n              height: entity.height,\n              active: judgment !== 0 && judgment !== MISSED,\n              missed: status === 'judged' && judgment === MISSED,\n            })\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              push(`note_${column}`, {\n                key: note.id,\n                y: entity.y,\n              })\n            }\n          }\n        }\n      }\n    }\n\n    function updateBarLines() {\n      const entities = noteArea.getVisibleBarLines(position, getUpperBound(), 1)\n      for (const entity of entities) {\n        if (touch3dMode) {\n          const row = touch3d.getRow(entity.y - 0.01)\n          push('barlines3d', {\n            key: entity.id,\n            y: row.y,\n            x: row.projection * -touch3d.PLAY_AREA_WIDTH + 1280 / 2,\n            width: row.projection * touch3d.PLAY_AREA_WIDTH * 2,\n          })\n        } else {\n          push('barlines', { key: entity.id, y: entity.y })\n        }\n      }\n    }\n\n    function updateInput() {\n      const input = playerState.input\n      for (const column of player.columns) {\n        const control = input.get(column)\n        data[`${column}_active`] = control.value !== 0 ? 1 : 0\n        if (control.changed) {\n          if (control.value !== 0) {\n            stateful[`${column}_down`] = time\n          } else {\n            stateful[`${column}_up`] = time\n          }\n        }\n      }\n    }\n\n    function updateJudgment() {\n      const notifications = playerState.notifications.judgments\n      const notification = notifications[notifications.length - 1]\n      if (notification) {\n        const name =\n          notification.judgment === -1 ? 'missed' : `${notification.judgment}`\n        stateful[`judge_${name}`] = time\n        const deviationMode =\n          notification.judgment === -1 || notification.judgment === 1\n            ? 'none'\n            : notification.delta > 0\n            ? 'late'\n            : notification.delta < 0\n            ? 'early'\n            : 'none'\n        stateful[`judge_deviation_${deviationMode}`] = time\n        stateful['combo'] = notification.combo\n      }\n      data['score'] = playerState.stats.score\n    }\n\n    function updateGauge() {\n      gauge.update(playerState)\n      if (gauge.shouldDisplay()) {\n        if (!stateful['gauge_enter']) stateful['gauge_enter'] = time\n      } else {\n        if (stateful['gauge_enter']) {\n          if (!stateful['gauge_exit']) stateful['gauge_exit'] = time\n        }\n      }\n      data['gauge_primary'] = gauge.getPrimary()\n      data['gauge_secondary'] = gauge.getSecondary()\n      data['gauge_extra'] = gauge.getExtra()\n    }\n\n    function updateExplode() {\n      const notifications = playerState.notifications.judgments\n      for (let i = 0; i < notifications.length; i++) {\n        const notification = notifications[i]\n        if (!breaksCombo(notification.judgment)) {\n          stateful[`${notification.column}_explode`] = time\n        }\n      }\n    }\n\n    function getUpperBound() {\n      return position + 5 / speed\n    }\n  }\n}\n\nexport default PlayerDisplay\n","// Touch3D mode -- inspired by Thapster.\n// Notes are arranged on a 3D arc that moves towards the screen.\n// Example: https://twitter.com/bemusegame/status/950505986409709569\n\n/** Parameters to the algorithm. These values are obtained by trial-and-error. */\nconst config = {\n  /** Centre point of the arc (X-coordinate) */\n  cx: 1024,\n  /** Centre point of the arc (Y-coordinate) */\n  cy: -975,\n  /** Radius of the arc */\n  r: 1024,\n  /** Beginning angle of the arc */\n  t0: 3.922,\n  /** Ending angle of the arc */\n  t1: 4.555,\n  /**\n   * Perspective value (field of view).\n   * Camera is placed at (p, 0, 0), facing towards (0, 0, 0).\n   * See: https://developer.mozilla.org/en-US/docs/Web/CSS/perspective\n   */\n  p: 960,\n  /** Width of the play area */\n  w: 60,\n}\n\n/**\n * Given the display position (0 representing top and 1 representing bottom),\n * calculates the onscreen position to display it.\n *\n * Screen size is hardcoded as 1280x720.\n *\n * @param position The display position (0 representing top and 1 representing bottom)\n * @return An object with\n *   - `y` A number represeting the onscreen position to display the note.\n *   - `projection` The projected scale. If an object is closer to the screen,\n *     it will appear bigger. This value represents that scale.\n */\nexport function getRow(position) {\n  const excess = Math.max(0, position - 1)\n  if (position < 0) position = 0\n  if (position > 1) position = 1\n  const theta = config.t0 + (config.t1 - config.t0) * position\n  const pointX = config.cx + Math.cos(theta) * config.r\n  const pointY = config.cy - Math.sin(theta) * config.r\n  const projection = config.p / (config.p - pointX)\n  const screenY = pointY * projection + 720 / 2\n  return { y: screenY + excess * 2048, projection }\n}\n\n/**\n * The world width of the play area.\n * Multiply this with the projection number to get the onscreen width.\n */\nexport const PLAY_AREA_WIDTH = config.w\n\n/**\n * Finds the touched column based on screen coordinate.\n *\n * @param {number} x The x onscreen coordinate (0~1280)\n * @param {number} y The y onscreen coordinate (0~1280)\n * @return Column name ('1'~'7') or `null` if no column should be triggered.\n */\nexport function getTouchedColumn(x, y) {\n  let min = 0.75\n  let max = 1\n  let mid\n  let row\n  for (let i = 0; i < 8; i++) {\n    mid = (min + max) / 2\n    row = getRow(mid)\n    if (row.y > y) {\n      max = mid\n    } else {\n      min = mid\n    }\n  }\n  if (mid < 0.8) return null\n  const x0 = 1280 / 2 + row.projection * -config.w\n  const x1 = 1280 / 2 + row.projection * config.w\n  let pos = Math.floor(((x - x0) / (x1 - x0)) * 7)\n  if (pos >= -1 && pos <= 7) {\n    if (pos < 0) pos = 0\n    if (pos > 6) pos = 6\n    return String(pos + 1)\n  }\n  return null\n}\n","export class Control {\n  public value = 0\n  public changed = false\n  get justPressed() {\n    return this.changed && this.value\n  }\n}\n\nexport default Control\n","import Control from './control'\nimport _ from 'lodash'\nimport bench from 'bemuse/devtools/benchmark'\n\ntype GameInputPluginInternalInstance = {\n  get(): [string, number][]\n  destroy(): void\n}\n\ninterface IGameInputPlugin {\n  name: string\n  get(): { [key: string]: number }\n  destroy?(): void\n}\n\nexport class GameInput {\n  private _controls = new Map<string, Control>()\n  private _plugins: GameInputPluginInternalInstance[] = []\n  update() {\n    const changes = new Map()\n    for (const [name, control] of this._controls) {\n      void name\n      control.changed = false\n    }\n    for (const plugin of this._plugins) {\n      for (const [name, value] of plugin.get()) {\n        changes.set(name, value)\n      }\n    }\n    for (const [name, value] of changes) {\n      const control = this.get(name)!\n      if (control.value !== value) {\n        control.changed = true\n        control.value = value\n      }\n    }\n  }\n\n  destroy() {\n    for (const plugin of this._plugins) {\n      plugin.destroy()\n    }\n  }\n\n  get(controlName: string) {\n    if (!this._controls.has(controlName)) {\n      this._controls.set(controlName, new Control())\n    }\n    return this._controls.get(controlName)!\n  }\n\n  use(plugin: IGameInputPlugin) {\n    const state: { [key: string]: number } = {}\n    const name = 'input:' + plugin.name\n    this._plugins.push({\n      get: bench.wrap(name, function () {\n        const out = plugin.get()\n        const diff = []\n        for (const key of _.union(_.keys(out), _.keys(state))) {\n          const last = +state[key] || 0\n          const current = +out[key] || 0\n          if (last !== current) diff.push([key, current])\n          state[key] = current\n        }\n        return diff\n      }),\n      destroy() {\n        if (typeof plugin.destroy === 'function') {\n          return plugin.destroy()\n        } else {\n          return true\n        }\n      },\n    })\n  }\n}\n\nexport default GameInput\n","import _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nexport enum Judgment {\n  Missed = -1,\n  Unjudged = 0,\n  Meticulous = 1,\n  Precise = 2,\n  Good = 3,\n  Offbeat = 4,\n}\n\nexport type JudgedJudgment = Exclude<Judgment, Judgment.Unjudged>\n\nexport const UNJUDGED = Judgment.Unjudged\nexport const MISSED = Judgment.Missed\n\nexport type Timegate = {\n  value: Judgment\n  timegate: number\n  endTimegate: number\n}\nexport type Timegates = Timegate[]\n\n// #region judgment timegate\nconst NORMAL_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.02, endTimegate: 0.04 },\n  { value: 2, timegate: 0.05, endTimegate: 0.1 },\n  { value: 3, timegate: 0.1, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV5_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.021, endTimegate: 0.042 },\n  { value: 2, timegate: 0.06, endTimegate: 0.12 },\n  { value: 3, timegate: 0.12, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV4_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.022, endTimegate: 0.044 },\n  { value: 2, timegate: 0.07, endTimegate: 0.14 },\n  { value: 3, timegate: 0.14, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV3_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.023, endTimegate: 0.046 },\n  { value: 2, timegate: 0.08, endTimegate: 0.16 },\n  { value: 3, timegate: 0.16, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst ABSOLUTE_BEGINNER_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.024, endTimegate: 0.048 },\n  { value: 2, timegate: 0.1, endTimegate: 0.18 },\n  { value: 3, timegate: 0.18, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\n// #endregion\n\nexport interface IJudge {\n  getTimegates(gameTime: number | null, noteTime: number | null): Timegates\n}\n\nclass FixedTimegatesJudge implements IJudge {\n  constructor(private timegates: Timegates) {}\n  getTimegates(_gameTime: number | null, _noteTime: number | null) {\n    return this.timegates\n  }\n}\n\nclass TutorialJudge implements IJudge {\n  getTimegates(_gameTime: number | null, noteTime: number | null) {\n    if (!noteTime || noteTime < 100) {\n      return ABSOLUTE_BEGINNER_TIMEGATES\n    } else {\n      return NORMAL_TIMEGATES\n    }\n  }\n}\n\nconst NORMAL_JUDGE = new FixedTimegatesJudge(NORMAL_TIMEGATES)\n\nexport function getJudgeForNotechart(\n  notechart: Notechart,\n  { tutorial = false }\n): IJudge {\n  const info = notechart.songInfo\n  const insane = info.difficulty >= 5\n  if (tutorial) {\n    return new TutorialJudge()\n  }\n  if (insane) {\n    return NORMAL_JUDGE\n  }\n  if (info.level === 1 || info.level === 2) {\n    return new FixedTimegatesJudge(ABSOLUTE_BEGINNER_TIMEGATES)\n  }\n  if (info.level === 3) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV3_TIMEGATES)\n  }\n  if (info.level === 4) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV4_TIMEGATES)\n  }\n  if (info.level === 5) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV5_TIMEGATES)\n  }\n  return NORMAL_JUDGE\n}\n\n/**\n * Takes a gameTime and noteTime and returns the appropriate judgment.\n *\n *  1 - METICULOUS\n *  2 - PRECISE\n *  3 - GOOD\n *  4 - OFFBEAT\n *  0 - (not judge)\n * -1 - MISSED\n */\nexport function judgeTimeWith(f: (timegate: Timegate) => number) {\n  return function judgeTimeWithF(\n    gameTime: number,\n    noteTime: number,\n    judge: IJudge = NORMAL_JUDGE\n  ): Judgment {\n    const timegates = judge.getTimegates(gameTime, noteTime)\n    const delta = Math.abs(gameTime - noteTime)\n    for (let i = 0; i < timegates.length; i++) {\n      if (delta < f(timegates[i])) return timegates[i].value\n    }\n    return gameTime < noteTime ? UNJUDGED : MISSED\n  }\n}\n\nexport const judgeTime = judgeTimeWith((t) => t.timegate)\nexport const judgeEndTime = judgeTimeWith((t) => t.endTimegate)\n\nexport function timegate(judgment: Judgment, judge = NORMAL_JUDGE) {\n  return _.find(judge.getTimegates(null, null), { value: judgment })!.timegate\n}\n\nexport function isBad(judgment: Judgment) {\n  return judgment >= 4\n}\n\nexport function breaksCombo(judgment: Judgment) {\n  return judgment === MISSED || isBad(judgment)\n}\n\n// #region judgment weight\nexport function weight(judgment: Judgment) {\n  if (judgment === 1) return 100\n  if (judgment === 2) return 80\n  if (judgment === 3) return 50\n  return 0\n}\n// #endregion\n","import Notechart from 'bemuse-notechart'\nimport { PlayerOptions } from 'bemuse-notechart/lib/types'\n\nexport type PlayerControlKeys =\n  | '1'\n  | '2'\n  | '3'\n  | '4'\n  | '5'\n  | '6'\n  | '7'\n  | 'SC'\n  | 'SC2'\n\nexport type PlayerOptionsPlacement = 'left' | 'center' | 'right' | '3d'\n\nexport type PlayerOptionsScratch = 'left' | 'right' | 'off'\n\nexport type PlayerOptionsGauge = 'off' | 'hope'\n\ntype PlayerOptionsInputMapping = {\n  keyboard: { [control in PlayerControlKeys]: string }\n  continuous: boolean\n  sensitivity: number\n}\n\ntype PlayerOptionsInternal = {\n  autoplayEnabled: boolean\n  autosound: boolean\n  speed: number\n  placement: PlayerOptionsPlacement\n  scratch: PlayerOptionsScratch\n  laneCover: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial: boolean\n}\n\nexport type PlayerOptionsInput = PlayerOptions & {\n  autoplayEnabled?: boolean\n  autosound?: boolean\n  speed: number\n  placement?: PlayerOptionsPlacement\n  laneCover?: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial?: boolean\n}\n\n/** The object representing the player's information, notechart and options. */\nexport class Player {\n  public readonly options: PlayerOptionsInternal\n  constructor(\n    public readonly notechart: Notechart,\n    public readonly number: number,\n    options: PlayerOptionsInput\n  ) {\n    this.options = {\n      autoplayEnabled: !!options.autoplayEnabled,\n      autosound: !!options.autosound,\n      speed: +options.speed,\n      placement: options.placement || 'center',\n      scratch: options.scratch || 'left',\n      input: options.input,\n      laneCover: +(options.laneCover || 0),\n      gauge: options.gauge,\n      tutorial: !!options.tutorial,\n    }\n  }\n\n  // An array of column names for this Notechart.\n  get columns() {\n    return this.notechart.columns\n  }\n}\n\nexport default Player\n","import _ from 'lodash'\n\nimport PlayerStats from './player-stats'\nimport {\n  MISSED,\n  getJudgeForNotechart,\n  isBad,\n  judgeEndTime,\n  judgeTime,\n  IJudge,\n  Judgment,\n  JudgedJudgment,\n} from '../judgments'\nimport Player from '../player'\nimport { GameNote } from 'bemuse-notechart/lib/types'\nimport GameInput from '../input'\nimport Control from '../input/control'\nimport invariant from 'invariant'\n\ntype NoteResult = {\n  judgment: Judgment\n  status: NoteStatus\n  delta: number\n}\n\nenum NoteStatus {\n  /** For long notes -- when the player is holding the note but not yet release it. */\n  Active = 'active',\n  /** This not is not yet judged. */\n  Unjudged = 'unjudged',\n  /** This note is fully-judged. */\n  Judged = 'judged',\n}\n\ntype Notifications = {\n  sounds: (\n    | { type: 'hit'; note: GameNote; judgment: Judgment }\n    | { type: 'free'; note: GameNote }\n    | { type: 'break'; note: GameNote }\n  )[]\n  judgments: {}[]\n}\n\nfunction initializeNotifications(): Notifications {\n  return { sounds: [], judgments: [] }\n}\n\n// The PlayerState class holds a single player's state, including the stats\n// (score, current combo, maximum combo).\nexport class PlayerState {\n  /** The PlayerStats object. */\n  public stats: PlayerStats\n\n  /** The notifications from the previous update. */\n  public notifications = initializeNotifications()\n  /** The current note scrolling speed. */\n  public speed: number\n  /** `true` if finished playing, `false` otherwise. */\n  public finished = false\n  /** `true` if score is invalid due to autoplay being activated. `false` otherwise. */\n  public tainted = false\n  public input: Map<string, Control> = new Map()\n\n  private _columns: string[]\n  private _noteBufferByColumn: _.Dictionary<NoteBuffer>\n  private _noteResult: Map<GameNote, NoteResult>\n  private _duration: number\n  private _judge: IJudge\n  private _gameTime = 0\n  private _rawInput?: GameInput\n  private _pinching: null | { start: number; speed: number } = null\n\n  constructor(public readonly player: Player) {\n    this._columns = player.columns\n    this._noteBufferByColumn = _(player.notechart.notes)\n      .sortBy((n) => n.time)\n      .groupBy((n) => n.column)\n      .mapValues(noteBuffer(this))\n      .value()\n    this._noteResult = new Map()\n    this._duration = player.notechart.duration\n    this._judge = getJudgeForNotechart(player.notechart, {\n      tutorial: player.options.tutorial,\n    })\n    this.stats = new PlayerStats(player.notechart)\n    this.speed = player.options.speed\n  }\n\n  /**\n   * Updates the state. Judge the notes and emit notifications.\n   */\n  update(gameTime: number, input: GameInput) {\n    this._gameTime = gameTime\n    this._rawInput = input\n    this.notifications = initializeNotifications()\n    this._updateInputColumnMap()\n    this._judgeNotes()\n    this._updateSpeed()\n    if (gameTime > this._duration + 3) this.finished = true\n  }\n\n  getNoteStatus(note: GameNote): NoteStatus {\n    const result = this._noteResult.get(note)\n    if (!result) return NoteStatus.Unjudged\n    return result.status\n  }\n\n  getNoteJudgment(note: GameNote) {\n    const result = this._noteResult.get(note)\n    if (!result) return Judgment.Unjudged\n    return result.judgment\n  }\n\n  getPlayerInput(control: string) {\n    return this._rawInput!.get(`p${this.player.number}_${control}`)!\n  }\n\n  _updateInputColumnMap() {\n    this.input = new Map(\n      this._columns.map((column) => [column, this.getPlayerInput(column)])\n    )\n  }\n\n  _judgeNotes() {\n    for (const column of this._columns) {\n      const buffer = this._noteBufferByColumn[column]\n      if (buffer) {\n        const control = this.input.get(column)!\n        this._judgeColumn(buffer, control, column)\n        buffer.update()\n      }\n    }\n  }\n\n  _updateSpeed() {\n    if (this.getPlayerInput('speedup').justPressed) {\n      this._modifySpeed(+1)\n    }\n    if (this.getPlayerInput('speeddown').justPressed) {\n      this._modifySpeed(-1)\n    }\n    const pinch = this.getPlayerInput('pinch').value\n    if (pinch && !this._pinching) {\n      this._pinching = { start: pinch, speed: this.speed }\n    } else if (!pinch) {\n      this._pinching = null\n    }\n    if (pinch && this._pinching) {\n      const pinching = this._pinching\n      const speed = (pinching.speed * pinch) / pinching.start\n      this.speed = Math.max(0.2, Math.round(speed * 10) / 10)\n    }\n  }\n\n  _modifySpeed(direction: 1 | -1) {\n    const amount = this._rawInput!.get('select').value\n      ? 0.1\n      : this.speed < 0.5\n      ? 0.3\n      : 0.5\n    this.speed += direction * amount\n    if (this.speed < 0.2) this.speed = 0.2\n  }\n\n  _shouldAutoplay() {\n    return this.player.options.autoplayEnabled || isAutoplayEnabled()\n  }\n\n  _judgeColumn(buffer: NoteBuffer, control: Control, column: string) {\n    let judgedNote\n    let judgment\n    const notes = buffer.notes\n    let autoPlayed = false\n    for (let i = buffer.startIndex; i < notes.length; i++) {\n      const note = notes[i]\n      if (this._shouldJudge(note, control, buffer)) {\n        const shouldBreak = this.getNoteStatus(note) !== 'active'\n        judgedNote = note\n        judgment = this._judgeNote(note)\n        if (this._shouldAutoplay()) {\n          autoPlayed = true\n        }\n        if (shouldBreak) break\n      }\n    }\n    if (control.justPressed || autoPlayed) {\n      if (judgedNote && judgment != null) {\n        this.notifications.sounds!.push({\n          note: judgedNote,\n          type: 'hit',\n          judgment: judgment,\n        })\n      } else {\n        const freestyleNote = this._getFreestyleNote(notes)\n        if (freestyleNote) {\n          const shouldPlayFreestyleNote =\n            this.player.options.placement !== '3d' ||\n            !this._isSandwiched(column)\n          if (shouldPlayFreestyleNote) {\n            this.notifications.sounds!.push({\n              note: freestyleNote,\n              type: 'free',\n            })\n          }\n        }\n      }\n    }\n  }\n\n  _getClosestNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => Math.abs(this._gameTime - note.time))\n  }\n\n  _getFreestyleNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => {\n      const distance = Math.abs(this._gameTime - note.time)\n      const penalty = this._gameTime < note.time - 1 ? 1000000 : 0\n      return distance + penalty\n    })\n  }\n\n  _isSandwiched(column: string) {\n    const mapping: { [col: string]: string[] } = {\n      '2': ['1', '3'],\n      '3': ['2', '4'],\n      '4': ['3', '5'],\n      '5': ['4', '6'],\n      '6': ['5', '7'],\n    }\n    if (!mapping[column]) return false\n    return mapping[column].every((adjacentColumn) => {\n      const buffer = this._noteBufferByColumn[adjacentColumn]\n      if (!buffer) return false\n      return buffer.notes.some(\n        (note) => Math.abs(this._gameTime - note.time) < 0.1\n      )\n    })\n  }\n\n  _shouldJudge(note: GameNote, control: Control, buffer: NoteBuffer) {\n    const status = this.getNoteStatus(note)\n    if (status === 'unjudged') {\n      if (this._shouldAutoplay() && this._gameTime >= note.time) {\n        this.tainted = true\n        return true\n      }\n      const judgment = judgeTime(this._gameTime, note.time, this._judge)\n      const missed = judgment === MISSED\n      let hit = judgment > 0 && control.changed && control.value\n      if (isBad(judgment) && this._getClosestNote(buffer.notes) !== note) {\n        hit = false\n      }\n      return missed || hit\n    } else if (status === 'active') {\n      const noteEnd = note.end || invariant(false, 'note.end must exist')\n      if (this._shouldAutoplay() && this._gameTime >= noteEnd.time) {\n        this.tainted = true\n        return true\n      }\n      const judgment = judgeEndTime(this._gameTime, noteEnd.time, this._judge)\n      const missed = judgment === MISSED\n      const lifted = control.changed\n      const scratch = note.column === 'SC'\n      const passed = this._gameTime >= noteEnd.time\n      return missed || lifted || (scratch && passed)\n    } else {\n      return false\n    }\n  }\n\n  _judgeNote(note: GameNote) {\n    let delta = this._gameTime - note.time\n    let judgment = judgeTime(this._gameTime, note.time, this._judge)\n    let result = this._noteResult.get(note)\n    const isDown = !result || result.status === 'unjudged'\n    const isUp = result && result.status === 'active'\n    if (this._shouldAutoplay() && judgment >= 1) {\n      judgment = 1\n    }\n    if (note.end) {\n      if (isDown) {\n        const status =\n          judgment === MISSED ? NoteStatus.Judged : NoteStatus.Active\n        if (judgment === MISSED) {\n          // judge missed long note twice\n          this._setJudgment(judgment, delta, note.column)\n        }\n        result = { status, judgment, delta }\n      } else if (isUp) {\n        const scratch = note.column === 'SC'\n        delta = this._gameTime - note.end.time\n        judgment =\n          judgeEndTime(this._gameTime, note.end.time, this._judge) || MISSED\n        if (scratch && delta > 0) judgment = 1\n        result = { status: NoteStatus.Judged, judgment, delta }\n      }\n    } else {\n      result = { status: NoteStatus.Judged, judgment, delta }\n    }\n    if (judgment === MISSED) {\n      this.notifications.sounds.push({ note, type: 'break' })\n    }\n    if (isDown && judgment !== MISSED) {\n      this.stats.handleDelta(delta)\n    }\n    if (!result) {\n      throw new Error('Invariant violation: result must not be undefined')\n    }\n    if (!judgment) {\n      throw new Error(\n        'Invariant violation: note should be judged by this point'\n      )\n    }\n    this._noteResult.set(note, result)\n    this._setJudgment(judgment, delta, note.column)\n    return judgment\n  }\n\n  _setJudgment(judgment: JudgedJudgment, delta: number, column: string) {\n    this.stats.handleJudgment(judgment)\n    const info = { judgment, combo: this.stats.combo, delta, column }\n    this.notifications.judgments.push(info)\n  }\n}\n\ntype NoteBuffer = {\n  notes: GameNote[]\n  startIndex: number\n  update: () => void\n}\n\nfunction isAutoplayEnabled() {\n  return !!(window as any).BEMUSE_AUTOPLAY\n}\n\nfunction noteBuffer(state: PlayerState) {\n  return function bufferNotes(notes: GameNote[]): NoteBuffer {\n    let startIndex = 0\n    return {\n      notes,\n      get startIndex() {\n        return startIndex\n      },\n      update() {\n        while (\n          startIndex < notes.length &&\n          state.getNoteStatus(notes[startIndex]) === 'judged'\n        ) {\n          startIndex += 1\n        }\n      },\n    }\n  }\n}\n\nexport default PlayerState\n","import * as Judgments from '../judgments'\n\nimport _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nconst getAccuracyScore = (accuracy: number) => Math.floor(accuracy * 500000)\nconst getComboScore = (sum: number, total: number) =>\n  Math.floor((sum * 55555) / total)\n\nexport class PlayerStats {\n  public totalCombo: number\n  public totalNotes: number\n  public combo: number\n  public maxCombo: number\n  public rawSumJudgmentWeight: number\n  public rawTotalComboScore: number\n  public rawSumComboScore: number\n  public counts: { [k in Judgments.JudgedJudgment]: number }\n  public numJudgments: number\n  public poor: boolean\n  public deltas: number[]\n\n  private _remainingMaxPossibleRawComboScore: number\n  private _log: { character: string; count: number }[]\n\n  constructor(notechart: Notechart) {\n    this.totalCombo = _(notechart.notes)\n      .map((note) => notechart.info(note)!.combos)\n      .sum()\n    this.totalNotes = notechart.notes.length\n    this.combo = 0\n    this.maxCombo = 0\n    this.rawSumJudgmentWeight = 0\n    this.rawTotalComboScore = this._calculateRawTotalComboScore(this.totalCombo)\n    this._remainingMaxPossibleRawComboScore = this.rawTotalComboScore\n    this.rawSumComboScore = 0\n    this.counts = { [Judgments.MISSED]: 0, '1': 0, '2': 0, '3': 0, '4': 0 }\n    this.numJudgments = 0\n    this.poor = false\n    this._log = []\n    this.deltas = []\n  }\n\n  get score() {\n    // #region score\n    return this.accuracyScore + this.comboScore\n    // #endregion\n  }\n\n  get accuracyScore() {\n    return getAccuracyScore(this.accuracy)\n  }\n\n  get comboScore() {\n    return getComboScore(this.rawSumComboScore, this.rawTotalComboScore)\n  }\n\n  get maxPossibleScore() {\n    return this.maxPossibleAccuracyScore + this.maxPossibleComboScore\n  }\n\n  get maxPossibleAccuracyScore() {\n    const remainingJudgments = this.totalCombo - this.numJudgments\n    const maxPossibleRawWeight =\n      this.rawSumJudgmentWeight + Judgments.weight(1) * remainingJudgments\n    const maxPossibleAccuracy =\n      maxPossibleRawWeight / (Judgments.weight(1) * this.totalCombo)\n    return getAccuracyScore(maxPossibleAccuracy)\n  }\n\n  get maxPossibleComboScore() {\n    const maxPossibleRawComboScore =\n      this.rawSumComboScore + this._remainingMaxPossibleRawComboScore\n    return getComboScore(maxPossibleRawComboScore, this.rawTotalComboScore)\n  }\n\n  get accuracy() {\n    return this.rawSumJudgmentWeight / (Judgments.weight(1) * this.totalCombo)\n  }\n\n  get currentAccuracy() {\n    return (\n      this.rawSumJudgmentWeight / (Judgments.weight(1) * this.numJudgments || 1)\n    )\n  }\n\n  get log() {\n    return this._log\n      .map(({ character, count }) => `${count > 1 ? count : ''}${character}`)\n      .join('')\n  }\n\n  handleJudgment(judgment: Judgments.JudgedJudgment) {\n    this.counts[judgment] += 1\n    this.numJudgments += 1\n    if (Judgments.breaksCombo(judgment)) {\n      const remainingJudgments = this.totalCombo - this.numJudgments\n      this.combo = 0\n      this.poor = true\n      this._remainingMaxPossibleRawComboScore =\n        this._calculateRawTotalComboScore(remainingJudgments)\n    } else {\n      this.combo += 1\n      const rawComboScore = this._calculateRawComboScore(this.combo)\n      this.rawSumComboScore += rawComboScore\n      this._remainingMaxPossibleRawComboScore -= rawComboScore\n      this.poor = false\n    }\n    this.rawSumJudgmentWeight += Judgments.weight(judgment)\n    if (this.combo > this.maxCombo) {\n      this.maxCombo = this.combo\n    }\n    this._recordLog(judgment)\n  }\n\n  handleDelta(delta: number) {\n    this.deltas.push(delta)\n  }\n\n  private _calculateRawTotalComboScore(total: number) {\n    let sum = 0\n    for (let i = 1; i <= total; i++) {\n      sum += this._calculateRawComboScore(i)\n    }\n    return sum\n  }\n\n  private _calculateRawComboScore(i: number) {\n    // #region combo\n    if (i === 0) return 0\n    if (i < 23) return 1\n    if (i < 51) return 2\n    if (i < 92) return 3\n    if (i < 161) return 4\n    return 5\n    // #endregion\n  }\n\n  private _recordLog(judgment: Judgments.JudgedJudgment) {\n    const character = this._getLogCharacter(judgment)\n    if (character) {\n      if (\n        this._log.length === 0 ||\n        this._log[this._log.length - 1].character !== character\n      ) {\n        this._log.push({ character, count: 1 })\n      } else {\n        this._log[this._log.length - 1].count += 1\n      }\n    }\n  }\n\n  private _getLogCharacter(judgment: Judgments.JudgedJudgment) {\n    switch (judgment) {\n      case 1:\n        return 'A'\n      case 2:\n        return 'B'\n      case 3:\n        return 'C'\n      case 4:\n        return 'D'\n      case Judgments.MISSED:\n        return 'M'\n    }\n  }\n}\n\nexport default PlayerStats\n","export function forModule(moduleName: string) {\n  return {\n    info: bindLogger(moduleName, 'info'),\n    warn: bindLogger(moduleName, 'warn'),\n    error: bindLogger(moduleName, 'error'),\n  }\n}\n\nfunction bindLogger(moduleName: string, level: 'info' | 'warn' | 'error') {\n  return (...args: any[]) => {\n    console.log(\n      `[${new Date().toJSON()}] [${moduleName}] [${level}] ${require('util').format(\n        ...args\n      )}`\n    )\n  }\n}\n","import Bacon from 'baconjs'\n\nfunction observeMidiAccess(access) {\n  return Bacon.fromBinder((sink) => {\n    for (const port of access.inputs.values()) {\n      sink(new Bacon.Next(port))\n    }\n    for (const port of access.outputs.values()) {\n      sink(new Bacon.Next(port))\n    }\n    access.onstatechange = (e) => {\n      sink(new Bacon.Next(e.port))\n    }\n  })\n}\n\nfunction requestMIDIAccess() {\n  if (!navigator.requestMIDIAccess) {\n    return Promise.reject(new Error('MIDI is not supported'))\n  }\n  return navigator.requestMIDIAccess()\n}\n\nexport function getMidi() {\n  return Bacon.fromPromise(requestMIDIAccess())\n    .flatMap(observeMidiAccess)\n    .flatMapError((e) => (console.warn('MIDI Error:', e.stack), Bacon.never()))\n    .flatMap(messageForPort)\n    .doLog('messageforport')\n}\n\nfunction messageForPort(port) {\n  if (port.type !== 'input') return Bacon.never()\n  return Bacon.fromEvent(port, 'midimessage')\n}\n\nexport default getMidi\n","export class AxisLogic {\n  private stop = 1\n  private charge = 0\n  private previous: false | number = false\n  private active = false\n  private positive = false\n\n  public update(axis: number, threshold: number = 3) {\n    if (this.previous === false) {\n      this.previous = axis\n      return 0\n    }\n\n    if (this.previous !== axis) {\n      let delta = axis - this.previous\n      if (delta > 1) {\n        delta -= 2 + 0.005\n      } else if (delta < -1) {\n        delta += 2 + 0.005\n      }\n\n      const immediateOutput = delta > 0\n\n      if (this.active && this.positive !== immediateOutput) {\n        this.positive = immediateOutput\n        this.active = false\n        this.charge = 0\n      } else if (!this.active) {\n        if (this.charge === 0 || this.stop <= threshold) {\n          this.charge += Math.ceil(Math.abs(delta) / 0.01)\n        }\n\n        if (this.charge >= 2) {\n          this.active = true\n          this.positive = immediateOutput\n        }\n      }\n\n      this.stop = 0\n      this.previous = axis\n    }\n\n    if (this.stop > threshold * 2) {\n      this.active = false\n      this.charge = 0\n      this.stop = 0\n    }\n\n    this.stop += 1\n\n    return this.active ? (this.positive ? 1 : -1) : 0\n  }\n}\n","import keycode from 'keycode'\nimport _ from 'lodash'\nimport Bacon from 'baconjs'\nimport getMidi from './midi'\nimport { AxisLogic } from './axis-logic'\n\n// Public: OmniInput is a poll-based class that handles the key-pressed state of\n// multiple inputs.\n//\n// Each call to `update()` returns a mapping of active inputs. This object may\n// be reused and mutated by OmniInput for performance reasons, and thus the\n// caller SHOULD NOT hold on to or mutate it.\n//\n// ## Keys\n//\n// The key is a string that identifies some key on each input.\n// It follows the following convention:\n//\n// - `65` A keyboard keycode.\n// - `gamepad.0.button.3` A gamepad button.\n// - `gamepad.0.axis.3.positive` A gamepad axis (positive value).\n// - `gamepad.0.axis.3.negative` A gamepad axis (negative value).\n// - `midi.[id].[channel].note.[note]` A MIDI note.\n// - `midi.[id].[channel].sustain` Sustain pedal.\n// - `midi.[id].[channel].mod` Modulation level.\n// - `midi.[id].[channel].pitch.up` Pitch bend (up).\n// - `midi.[id].[channel].pitch.down` Pitch bend (down).\n//\nexport class OmniInput {\n  constructor(win = window, options = {}) {\n    const midi = (options.getMidi || getMidi)()\n    this._window = win\n    this._exclusive = !!options.exclusive\n    this._continuousAxis = !!options.continuous\n    this.setGamepadSensitivity(options.sensitivity || 3)\n\n    this._disposables = [\n      listen(win, 'keydown', (e) => this._handleKeyDown(e)),\n      listen(win, 'keyup', (e) => this._handleKeyUp(e)),\n      midi.onValue((e) => this._handleMIDIMessage(e)),\n    ]\n    this._status = {}\n    this._axis = {}\n  }\n\n  _handleKeyDown(e) {\n    this._status[`${e.which}`] = true\n    if (this._exclusive) e.preventDefault()\n  }\n\n  _handleKeyUp(e) {\n    this._status[`${e.which}`] = false\n  }\n\n  _handleMIDIMessage(e) {\n    if (!e || !e.data) return\n    const data = e.data\n    const prefix = `midi.${e.target.id}.${e.data[0] & 0x0f}`\n    const handleNote = (state) => {\n      this._status[`${prefix}.note.${data[1]}`] = state\n    }\n    if ((data[0] & 0xf0) === 0x80) {\n      // NoteOff\n      handleNote(false)\n    } else if ((data[0] & 0xf0) === 0x90) {\n      // NoteOn\n      if (data[2] > 0x0) {\n        // NoteOn (really)\n        handleNote(true)\n      } else {\n        // NoteOff disguised as NoteOn\n        handleNote(false)\n      }\n    } else if ((data[0] & 0xf0) === 0xb0) {\n      // CC\n      if (data[1] === 0x40) {\n        // Sustain\n        this._status[`${prefix}.sustain`] = data[2] >= 64\n      } else if (data[1] === 0x01) {\n        // Modulation\n        this._status[`${prefix}.mod`] = data[2] >= 16\n      }\n    } else if ((data[0] & 0xf0) === 0xe0) {\n      // Pitch Bend\n      const bend = data[1] | (data[2] << 7)\n      this._status[`${prefix}.pitch.up`] = bend >= 0x2100\n      this._status[`${prefix}.pitch.down`] = bend < 0x1f00\n    }\n  }\n\n  _updateGamepads() {\n    const nav = this._window.navigator\n    const gamepads = nav.getGamepads\n      ? nav.getGamepads()\n      : nav.webkitGetGamepads\n      ? nav.webkitGetGamepads()\n      : []\n    if (!gamepads) return\n    for (let i = 0; i < gamepads.length; i++) {\n      const gamepad = gamepads[i]\n      if (gamepad) {\n        this._updateGamepad(gamepad)\n      }\n    }\n  }\n\n  _updateGamepad(gamepad) {\n    const prefix = `gamepad.${gamepad.index}`\n    for (let i = 0; i < gamepad.buttons.length; i++) {\n      const button = gamepad.buttons[i]\n      this._status[`${prefix}.button.${i}`] = button && button.value >= 0.5\n    }\n    for (let i = 0; i < gamepad.axes.length; i++) {\n      const axisName = `${prefix}.axis.${i}`\n      let axis = gamepad.axes[i]\n\n      if (this._continuousAxis) {\n        if (this._axis[axisName] == null) {\n          this._axis[axisName] = new AxisLogic()\n        }\n        axis = this._axis[axisName].update(axis)\n      }\n\n      this._status[`${axisName}.positive`] = axis >= this._deadzone\n      this._status[`${axisName}.negative`] = axis <= -this._deadzone\n    }\n  }\n\n  update() {\n    this._updateGamepads()\n    return this._status\n  }\n\n  setGamepadSensitivity(sensitivity) {\n    this._sensitivity = sensitivity\n    this._deadzone = (9 - this._sensitivity) * 0.05\n    if (this._deadzone < 0.01) this._deadzone = 0.01\n    this._analogThreshold = 18 - this._sensitivity * 2\n  }\n\n  setGamepadContinuousAxisEnabled(enabled) {\n    this._continuousAxis = enabled\n  }\n\n  dispose() {\n    for (const dispose of this._disposables) {\n      dispose()\n    }\n  }\n}\n\n// Public: Returns a Bacon EventStream of keys pressed.\n//\nexport function key(input = new OmniInput(), win = window) {\n  return _keyForUpdate(\n    Bacon.fromBinder((sink) => {\n      const handle = win.setInterval(() => {\n        sink(new Bacon.Next(input.update()))\n      }, 16)\n      return () => win.clearInterval(handle)\n    })\n  )\n}\n\nexport function _keyForUpdate(update) {\n  return update\n    .map((update) => Object.keys(update).filter((key) => update[key]))\n    .diff([], (previous, current) => _.difference(current, previous))\n    .flatMap((array) => Bacon.fromArray(array))\n}\n\nexport default OmniInput\n\nconst knownMidiIds = {}\n\nexport function getName(key) {\n  if (+key) {\n    return _.capitalize(keycode(+key))\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.axis\\.(\\d+)\\.(\\w+)/)\n    if (match) {\n      return `Joy${match[1]} Axis${match[2]} (${\n        match[3] === 'positive' ? '+' : '-'\n      })`\n    }\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.button\\.(\\d+)/)\n    if (match) {\n      return `Joy${match[1]} Btn${match[2]}`\n    }\n  }\n  {\n    const match = key.match(/^midi\\.(.+)\\.(\\d+)\\.(.+)$/)\n    if (match) {\n      const rest = match[3].split('.')\n      const id = match[1]\n      const midiDeviceNumber =\n        knownMidiIds[id] ||\n        (knownMidiIds[id] = Object.keys(knownMidiIds).length + 1)\n      const prefix = `MIDI${midiDeviceNumber} Ch${+match[2] + 1}`\n      if (rest[0] === 'note') {\n        const midiNote = +rest[1]\n        const lookup = [\n          'C',\n          'C#',\n          'D',\n          'D#',\n          'E',\n          'F',\n          'F#',\n          'G',\n          'G#',\n          'A',\n          'A#',\n          'B',\n        ]\n        const noteName = lookup[midiNote % 12]\n        const octave = Math.floor(midiNote / 12) - 1\n        return `${prefix} ${noteName}${octave}`\n      }\n      if (rest[0] === 'pitch') {\n        return `${prefix} Pitch${rest[1] === 'up' ? '+' : '-'}`\n      }\n      if (rest[0] === 'sustain') return 'Sustain'\n      if (rest[0] === 'mod') return 'Mod'\n    }\n  }\n  return `${String(key).replace(/\\./g, ' ')}?`\n}\n\nfunction listen(subject, eventName, listener) {\n  subject.addEventListener(eventName, listener)\n  return function dispose() {\n    subject.removeEventListener(eventName, listener)\n  }\n}\n","import Observable from 'bemuse/utils/observable'\n\ninterface IProgressFormatter {\n  (progress: Progress): string\n}\n\n/**\n * The Progress class represents the progress of an asynchronous operation.\n * It is inspired by C#'s IProgress interface.\n *\n * See: http://blogs.msdn.com/b/dotnet/archive/2012/06/06/async-in-4-5-enabling-progress-and-cancellation-in-async-apis.aspx\n */\nexport class Progress {\n  /** The current progress (out of `Progress#total`). */\n  public current: number | undefined = undefined\n  /** Total progress value */\n  public total: number | undefined = undefined\n  /** Some arbitrary information associated with this Progress. */\n  public extra: any\n  /**\n   * The formatter of this progress. This formatter will be used to compute\n   * the text representation of this progress (`Progress#toString`).\n   */\n  public formatter?: IProgressFormatter\n  private _observable = new Observable<void>()\n  /**\n   * Updates the progress.\n   */\n  report(current: number, total: number, extra?: any) {\n    this.current = current\n    this.total = total\n    this.extra = extra\n    this._observable.notify()\n  }\n\n  /**\n   * Attaches a progress listener function to this progress.\n   * The function `f` will be called immediately and synchronously upon watching,\n   * and will be called when the progress value is updated.\n   * @param f\n   * @returns a function that, when called, unsubscribes this listener.\n   */\n  watch(f: (progress: Progress) => void) {\n    f(this)\n    return this._observable.watch(() => f(this))\n  }\n\n  /**\n   * The current progress as a fraction (out of 1).\n   */\n  get progress() {\n    if (this.total && this.current !== undefined && this.current !== null) {\n      return this.current / this.total\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * Returns a string representation of this progress instance.\n   * This method is used for displaying the progress as a text.\n   */\n  toString() {\n    if (this.formatter !== undefined) {\n      return this.formatter(this)\n    } else if (this.progress !== null) {\n      return this.current + ' / ' + this.total\n    } else {\n      return ''\n    }\n  }\n}\n","import bytes from 'bytes'\n\nconst wrap = (f) => (progress) => progress.progress !== null ? f(progress) : ''\n\n// Formats the `Progress` as bytes (e.g. 1.23mb of 1.31mb).\nexport const BYTES_FORMATTER = wrap(\n  (progress) => bytes(progress.current) + ' / ' + bytes(progress.total)\n)\n\n// Formats the `Progress` as percentage.\nexport const PERCENTAGE_FORMATTER = wrap(\n  (progress) => ((progress.current / progress.total) * 100).toFixed(1) + '%'\n)\n\n// Formats the `Progress` simply by using the value of `Progress#extra`.\nexport const EXTRA_FORMATTER = wrap((progress) => progress.extra + '')\n","// !! avoid external dependencies since this is used in boot script!\n\nimport { Progress } from './Progress'\nexport default Progress\n","import { BYTES_FORMATTER } from 'bemuse/progress/formatters'\nimport { Progress } from './Progress'\n\n/**\n * Returns a callback that, when called,\n * update the progress with increasing `current` value,\n * out of a fixed `total`.\n */\nexport function fixed(total: number, progress: Progress) {\n  if (!progress) return () => {}\n  let loaded = 0\n  progress.report(0, total)\n  return (extra: any) => progress.report(++loaded, total, extra)\n}\n\n/**\n * Updates the progress with the result of an atomic operation.\n */\nexport async function atomic<T>(\n  progress: Progress,\n  promise: PromiseLike<T>\n): Promise<T> {\n  if (!progress) return promise\n  const data = await Promise.resolve(promise)\n  if (hasByteLength(data)) {\n    progress.formatter = BYTES_FORMATTER\n    progress.report(data.byteLength, data.byteLength)\n  } else {\n    progress.report(1, 1)\n  }\n  return data\n}\nfunction hasByteLength(data: any): data is { byteLength: number } {\n  return data && data.byteLength\n}\n\n/**\n * Wraps an async function that may be called multiple times.\n * Each call adds to the total, and each async resolution adds to current.\n */\nexport function wrapPromise<A extends any[], R>(\n  progress: Progress,\n  f: (...args: A) => PromiseLike<R>\n): (...args: A) => PromiseLike<R> {\n  let current = 0\n  let total = 0\n  return async function (this: any, ...args: A) {\n    progress.report(current, ++total)\n    const ret = await f.apply(this, args)\n    progress.report(++current, total)\n    return ret\n  }\n}\n\nexport function bind(from: Progress, to: Progress) {\n  return from.watch(() => to.report(from.current!, from.total!, from.extra))\n}\n\n/**\n * Updates the `target` with progress data from multiple sources.\n */\nexport function simultaneous(target: Progress) {\n  const queue: Progress[] = []\n  let current: Progress | undefined\n  let unsubscribe: (() => void) | null = null\n  function update() {\n    if (current) {\n      target.report(current.current!, current.total!, current.extra)\n    }\n    if (queue.length > 0 && (!current || current.progress! >= 1)) {\n      bind(queue.shift()!)\n    }\n  }\n  function bind(progress: Progress) {\n    if (current === progress) {\n      return\n    }\n    if (unsubscribe) {\n      unsubscribe()\n      unsubscribe = null\n    }\n    current = progress\n    if (current) {\n      unsubscribe = current.watch(update)\n    }\n  }\n  return {\n    add(progress: Progress) {\n      queue.push(progress)\n      update()\n    },\n  }\n}\n","export function addUnprefixed(\n  prefix: string,\n  name: string,\n  callback: (path: string) => void\n) {\n  if (name.match(/\\.(?:bms|bme|bml|bmson)/i)) {\n    callback(name)\n    return\n  }\n  const parts = (prefix + name).split('/')\n  for (let i = 0; i < parts.length; i++) {\n    callback(parts.slice(i).join('/'))\n  }\n}\n","import { LoggingFunction } from './types'\n\nexport default class ResourceLogging {\n  private buffer: string[] | null = []\n  private loggingFunction: LoggingFunction = (text) => {\n    if (this.buffer) this.buffer.push(text)\n  }\n\n  public log: LoggingFunction = (text) => {\n    this.loggingFunction(text)\n  }\n\n  setLoggingFunction = (fn: LoggingFunction) => {\n    this.loggingFunction = fn\n    if (this.buffer) {\n      this.buffer.forEach((text) => fn(text))\n      this.buffer = null\n    }\n  }\n}\n","import { Archive } from 'libarchive.js/main.js'\nimport { addUnprefixed } from './addUnprefixed'\nimport { FileEntry } from './types'\n\nArchive.init({\n  workerUrl: '/vendor/libarchive.js-1.3.0/dist/worker-bundle.js',\n})\n\nexport async function unarchive(file: File): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const archive = await Archive.open(file)\n  const extracted = await archive.extractFiles()\n  const traverse = (tree: any, prefix = '') => {\n    for (const key of Object.keys(tree)) {\n      if (tree[key] instanceof File) {\n        addUnprefixed(prefix, key, (name) => {\n          out.push({ name, file: tree[key] })\n        })\n      } else if (tree[key] && typeof tree[key] === 'object') {\n        traverse(tree[key], prefix + key + '/')\n      }\n    }\n  }\n  traverse(extracted)\n  return out\n}\n","import * as ProgressUtils from 'bemuse/progress/utils'\nimport {\n  FileEntry,\n  LoggingFunction,\n  IResource,\n  ICustomSongResources,\n} from './types'\nimport ResourceLogging from './resource-logging'\nimport { unarchive } from './unarchiver'\nimport readBlob from 'bemuse/utils/read-blob'\nimport Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\n\nexport const ARCHIVE_REGEXP = /\\.(?:zip|rar|7z|tar(?:\\.(?:gz|bz2))?)/i\n\n// http://nekokan.dyndns.info/tool/DropboxReplacer/index.html\nconst DROPBOX_REGEXP =\n  /https?:\\/\\/(?:(?:www|dl)\\.dropbox\\.com|dl\\.dropboxusercontent\\.com)\\/(sh?)\\/([^?]*)(.*)?$/\n\n/**\n * A resource provider for custom songs.\n * It may retrieve the files from, e.g., a drag and drop event or an `?archive` flag.\n */\nexport interface CustomResourceProvider {\n  getFiles(loggingFunction: LoggingFunction): PromiseLike<FileEntry[]>\n}\n\n/**\n * An IResources for songs provided by a CustomResourceProvider.\n */\nexport class CustomSongResources implements ICustomSongResources {\n  private _logging = new ResourceLogging()\n  private _files: PromiseLike<FileEntry[]>\n  public setLoggingFunction = this._logging.setLoggingFunction\n\n  constructor(provider: CustomResourceProvider) {\n    this._files = Promise.resolve(provider.getFiles(this._logging.log)).then(\n      (files) => unarchiveIfNeeded(files, this._logging.log)\n    )\n  }\n\n  file(name: string) {\n    return this._files.then(function (files) {\n      for (const file of files) {\n        if (file.name.toLowerCase() === name.toLowerCase()) {\n          return new FileResource(file.file)\n        }\n      }\n      throw new Error('unable to find ' + name)\n    })\n  }\n\n  get fileList(): Promise<string[]> {\n    return Promise.resolve(this._files).then((a) => a.map((f) => f.name))\n  }\n}\n\nexport class FileResource implements IResource {\n  constructor(private _file: File) {}\n  read(progress: Progress) {\n    return ProgressUtils.atomic(\n      progress,\n      readBlob(this._file).as('arraybuffer')\n    )\n  }\n\n  resolveUrl() {\n    return Promise.resolve(URL.createObjectURL(this._file))\n  }\n\n  get name() {\n    return this._file.name\n  }\n}\n\n/**\n * If only 1 FileEntry is present and it is an archive file, extract it.\n */\nexport async function unarchiveIfNeeded(\n  files: FileEntry[],\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  if (files.length !== 1) return files\n  const fileEntry = files[0]\n  if (!fileEntry.name.match(ARCHIVE_REGEXP)) {\n    return files\n  }\n  log('Archive file detected! Now unarchiving')\n  return unarchive(fileEntry.file)\n}\n\n/**\n * Downloads a URL as a FileEntry.\n */\nexport async function downloadFileEntryFromURL(\n  url: string,\n  log: LoggingFunction\n): Promise<FileEntry> {\n  const name = url\n    .replace(/[?#].*/, '')\n    .split('/')\n    .pop()!\n\n  // Try Dropbox URL replacement\n  const match = url.match(DROPBOX_REGEXP)\n  if (match) {\n    url = `https://dl.dropboxusercontent.com/${match[1]}/${match[2]}`\n  }\n\n  const progress = new Progress()\n  let lastTime = 0\n  progress.watch(() => {\n    if (Date.now() < lastTime + 5e3) return\n    log(`Downloading: ${progress}`)\n    lastTime = Date.now()\n  })\n  const blob = await download(url).as('blob', progress)\n  return { name, file: blob }\n}\n","import Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\nimport { basename } from 'path'\nimport { IResource, IResources } from './types'\n\nexport class URLResource implements IResource {\n  constructor(private url: string) {}\n  read(progress: Progress) {\n    return download(this.url).as('arraybuffer', progress)\n  }\n\n  async resolveUrl() {\n    return Promise.resolve(this.url)\n  }\n\n  get name() {\n    return basename(this.url)\n  }\n}\n\nexport class URLResources implements IResources {\n  constructor(public base: URL) {}\n  async file(name: string): Promise<IResource> {\n    const path = name\n      .split('/')\n      .map((part) => encodeURIComponent(part))\n      .join('/')\n    return new URLResource(new URL(path, this.base).href)\n  }\n}\n\nexport default URLResource\n","// !! avoid external dependencies since this is used in boot script!\n\ntype CallbackEffect<T extends any[]> = (...args: T) => void\n\n/**\n * A utility class to hold a collection of callbacks.\n */\nexport class Callbacks<T extends any[]> {\n  private _callbacks: { [id: number]: CallbackEffect<T> } = {}\n  private _nextId = 1\n  constructor(init?: CallbackEffect<T>[] | CallbackEffect<T>) {\n    if (typeof init === 'function') {\n      this.add(init)\n    } else if (typeof init === 'object' && init && init.length) {\n      for (let i = 0; i < init.length; i++) this.add(init[i])\n    }\n  }\n\n  /**\n   * Calls all the callbacks.\n   */\n  call(...args: T) {\n    const callbacks = this._callbacks\n    for (const id in callbacks) {\n      callbacks[id](...args)\n    }\n  }\n\n  /**\n   * Adds a `callback` Function to this Callbacks collection.\n   * Returns a function that, when invoked, removes the inserted `callback` from the collection.\n   */\n  add(callback: CallbackEffect<T>) {\n    const id = this._nextId++\n    this._callbacks[id] = callback\n    return () => delete this._callbacks[id]\n  }\n}\n\nexport default Callbacks\n","import delay from 'delay'\nimport { BYTES_FORMATTER } from 'bemuse/progress/formatters'\n\n// Downloads the file from the URL.\n// The download will not actually be started unless the ``as()`` method\n// is called.\n//\n// .. js:function:: as(type)\n//\n//    Initiates the download as ``type``. The ``type`` is a string such as\n//    \"arraybuffer\" or \"blob\".\nexport function download(\n  url,\n  { getRetryDelay = () => 1000 + Math.random() * 4000 } = {}\n) {\n  return {\n    async as(type, progress) {\n      let shouldGiveUp = false\n      for (let i = 1; ; i++) {\n        try {\n          return await attempt()\n        } catch (error) {\n          console.error(`Unable to download ${url} [attempt ${i}]`, error)\n          if (i >= 3 || shouldGiveUp) throw error\n          const waitMs = getRetryDelay()\n          await delay(waitMs)\n        }\n      }\n      function attempt() {\n        return new Promise((resolve, reject) => {\n          const xh = new XMLHttpRequest()\n          xh.open('GET', url, true)\n          xh.responseType = type\n          xh.onload = () => {\n            if (+xh.status === 200) {\n              resolve(xh.response)\n            } else {\n              if (+xh.status === 403 || +xh.status === 404) {\n                shouldGiveUp = true\n              }\n              reject(new Error(`Unable to download ${url}: HTTP ${xh.status}`))\n            }\n          }\n          xh.onerror = () => reject(new Error(`Unable to download ${url}`))\n          if (progress) {\n            progress.formatter = BYTES_FORMATTER\n            xh.onprogress = (e) => progress.report(e.loaded, e.total)\n          }\n          xh.send(null)\n        })\n      }\n    },\n  }\n}\n\nexport default download\n","export function formatTime(seconds) {\n  const s = Math.floor(seconds % 60)\n  return Math.floor(seconds / 60) + ':' + (s < 10 ? '0' : '') + s\n}\n\nexport default formatTime\n","// :doc:\n//\n// High-accuracy timer, optionally synchronized globally.\n\nimport sync from 'timesynchro'\nconst Log = BemuseLogger.forModule('timesynchro')\n\nlet now\nlet offset = 0\n\nif (window.performance && typeof window.performance.now === 'function') {\n  now = () => window.performance.now()\n} else {\n  now = () => Date.now()\n}\n\nnow.synchronize = function (server) {\n  sync(server, onFinish, onResult)\n  function onResult(result) {\n    // result + Date.now() = real time = now() + offset\n    // result + Date.now() = now() + offset\n    // offset = result + Date.now() - now()\n    offset = result + Date.now() - now()\n  }\n  function onFinish(err, result) {\n    if (err) {\n      Log.error('Cannot synchronize time: ' + err)\n    } else {\n      onResult(result)\n      Log.info('Synchronized time with global server! Offset = ' + offset)\n    }\n  }\n}\n\nnow.synchronized = function () {\n  const o = offset\n  return () => now() + o\n}\n\nexport { now }\nexport default now\n","// !! avoid external dependencies since this is used in boot script!\n\nimport Callbacks from 'bemuse/utils/callbacks'\n\nexport class Observable<T> {\n  private _callbacks = new Callbacks<[T]>()\n  private _value?: T\n  constructor(value?: T) {\n    this._value = value\n  }\n\n  get value() {\n    return this._value\n  }\n\n  set value(value) {\n    this._value = value\n    this.notify(value!)\n  }\n\n  notify(value: T) {\n    this._callbacks.call(value)\n  }\n\n  watch(f: (value: T) => void) {\n    if (this._value !== undefined) f(this._value)\n    return this._callbacks.add(f)\n  }\n}\n\nexport default Observable\n","export default readBlob\n\n// Reads the blob as a specified type. The blob will not actually be read\n// unless the ``as()`` method is called.\n//\n// .. js:function:: as(type)\n//\n//    Starts reading the blob as ``type``. The ``type`` is a String such as\n//    \"arraybuffer\" or \"text\".\nexport function readBlob(blob) {\n  return {\n    as(type) {\n      return new Promise(function (resolve, reject) {\n        const reader = new FileReader()\n        reader.onload = function () {\n          resolve(reader.result)\n        }\n        reader.onerror = function () {\n          reject(new Error('Unable to read from Blob'))\n        }\n        switch (type) {\n          case 'arraybuffer':\n            reader.readAsArrayBuffer(blob)\n            break\n          case 'text':\n            reader.readAsText(blob)\n            break\n        }\n      })\n    },\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notechart = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar invariant_1 = __importDefault(require(\"invariant\"));\n__exportStar(require(\"./types\"), exports);\n/**\n * A notechart holds every info about a single player's note chart that the\n * game will ever need.\n */\nvar Notechart = /** @class */ (function () {\n    function Notechart(data, playerOptions) {\n        if (playerOptions === void 0) { playerOptions = {}; }\n        var _this = this;\n        var bmsNotes = data.notes, timing = data.timing, keysounds = data.keysounds, songInfo = data.songInfo, positioning = data.positioning, spacing = data.spacing, barLines = data.barLines, images = data.images, expertJudgmentWindow = data.expertJudgmentWindow, _a = data.landmineNotes, landmineNotes = _a === void 0 ? [] : _a;\n        (0, invariant_1.default)(bmsNotes, 'Expected \"data.notes\"');\n        (0, invariant_1.default)(timing, 'Expected \"data.timing\"');\n        (0, invariant_1.default)(keysounds, 'Expected \"data.keysounds\"');\n        (0, invariant_1.default)(songInfo, 'Expected \"data.songInfo\"');\n        (0, invariant_1.default)(positioning, 'Expected \"data.positioning\"');\n        (0, invariant_1.default)(spacing, 'Expected \"data.spacing\"');\n        (0, invariant_1.default)(barLines, 'Expected \"data.barLines\"');\n        this.expertJudgmentWindow = expertJudgmentWindow;\n        bmsNotes = this._preTransform(bmsNotes, playerOptions);\n        this._timing = timing;\n        this._positioning = positioning;\n        this._spacing = spacing;\n        this._keysounds = keysounds;\n        this._duration = 0;\n        this._notes = this._generatePlayableNotesFromBMS(bmsNotes);\n        this._landmines = this._generatePlayableNotesFromBMS(landmineNotes);\n        this._autos = this._generateAutoKeysoundEventsFromBMS(bmsNotes);\n        this._barLines = this._generateBarLineEvents(barLines);\n        this._samples = this._generateKeysoundFiles(keysounds);\n        this._infos = new Map(this._notes.map(function (note) { return [note, _this._getNoteInfo(note)]; }));\n        this._songInfo = songInfo;\n        this._images = images;\n    }\n    Object.defineProperty(Notechart.prototype, \"notes\", {\n        /**\n         * An Array of note events.\n         */\n        get: function () {\n            return this._notes;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"landmines\", {\n        /**\n         * An Array of landmines events.\n         */\n        get: function () {\n            return this._landmines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"autos\", {\n        /**\n         * An Array of auto-keysound events.\n         */\n        get: function () {\n            return this._autos;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"samples\", {\n        /**\n         * An Array of all the sample files to use.\n         */\n        get: function () {\n            return this._samples;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"keysounds\", {\n        /**\n         * An Object containing the mapping from keysound ID to keysound filename.\n         */\n        get: function () {\n            return this._keysounds.all();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"barLines\", {\n        /**\n         * An Object representing the bar line events.\n         */\n        get: function () {\n            return this._barLines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"columns\", {\n        /**\n         * An Array of all column names in this notechart.\n         */\n        get: function () {\n            return ['SC', '1', '2', '3', '4', '5', '6', '7'];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"duration\", {\n        /**\n         * Notechart's duration (time of last event)\n         */\n        get: function () {\n            return this._duration;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"songInfo\", {\n        /**\n         * Notechart's song info\n         */\n        get: function () {\n            return this._songInfo;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"eyecatchImage\", {\n        /**\n         * Eyecatch image\n         */\n        get: function () {\n            return (this._images && this._images.eyecatch) || 'eyecatch_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"backgroundImage\", {\n        /**\n         * Background image\n         */\n        get: function () {\n            return (this._images && this._images.background) || 'back_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the characteristic of the note as an Object.\n     */\n    Notechart.prototype.info = function (note) {\n        return this._infos.get(note);\n    };\n    /**\n     * Converts the beat number to in-song position (seconds)\n     */\n    Notechart.prototype.beatToSeconds = function (beat) {\n        return this._timing.beatToSeconds(beat);\n    };\n    /**\n     * Converts the beat number to in-game position.\n     */\n    Notechart.prototype.beatToPosition = function (beat) {\n        return this._positioning.position(beat);\n    };\n    /**\n     * Converts measure number to beat.\n     */\n    Notechart.prototype.measureToBeat = function (measure) {\n        return (this._barLines[measure] || this._barLines[this._barLines.length - 1]).beat;\n    };\n    /**\n     * Converts the in-song position to beat number.\n     */\n    Notechart.prototype.secondsToBeat = function (seconds) {\n        return this._timing.secondsToBeat(seconds);\n    };\n    /**\n     * Converts the in-song position to in-game position.\n     */\n    Notechart.prototype.secondsToPosition = function (seconds) {\n        return this.beatToPosition(this.secondsToBeat(seconds));\n    };\n    /**\n     * Finds BPM at the specified beat.\n     */\n    Notechart.prototype.bpmAtBeat = function (beat) {\n        return this._timing.bpmAtBeat(beat);\n    };\n    /**\n     * Finds the scrolling speed at the specified beat.\n     */\n    Notechart.prototype.scrollSpeedAtBeat = function (beat) {\n        return this._positioning.speed(beat);\n    };\n    /**\n     * Calculates the note spacing factor at the specified beat.\n     */\n    Notechart.prototype.spacingAtBeat = function (beat) {\n        return this._spacing.factor(beat);\n    };\n    /**\n     * Gets the keyMode from scratch\n     * @param scratch\n     * @returns {string}\n     */\n    Notechart.prototype.getKeyMode = function (scratch) {\n        var e_1, _a;\n        var usedColumns = {};\n        try {\n            for (var _b = __values(this.notes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var note = _c.value;\n                usedColumns[note.column] = true;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        if (scratch === 'off' && !usedColumns['1'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'left' && !usedColumns['6'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'right' && !usedColumns['1'] && !usedColumns['2'])\n            return '5K';\n        return '7K';\n    };\n    Notechart.prototype._preTransform = function (bmsNotes, playerOptions) {\n        var chain = lodash_1.default.chain(bmsNotes);\n        var keys = getKeys(bmsNotes);\n        if (playerOptions.scratch === 'off') {\n            chain = chain.map(function (note) {\n                if (note.column && note.column === 'SC') {\n                    return Object.assign({}, note, { column: null });\n                }\n                else {\n                    return note;\n                }\n            });\n        }\n        if (keys === '5K') {\n            var columnsToShift_1 = ['1', '2', '3', '4', '5', '6', '7'];\n            var shiftNote = function (amount) { return function (note) {\n                if (note.column) {\n                    var index = columnsToShift_1.indexOf(note.column);\n                    if (index > -1) {\n                        var newIndex = index + amount;\n                        (0, invariant_1.default)(newIndex < columnsToShift_1.length, 'Weird. Columns must not shift beyond available column');\n                        var newColumn = columnsToShift_1[newIndex];\n                        return Object.assign({}, note, { column: newColumn });\n                    }\n                }\n                return note;\n            }; };\n            if (playerOptions.scratch === 'off') {\n                chain = chain.map(shiftNote(1));\n            }\n            else if (playerOptions.scratch === 'right') {\n                chain = chain.map(shiftNote(2));\n            }\n        }\n        return chain.value();\n    };\n    Notechart.prototype._generatePlayableNotesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            _this._updateDuration(spec);\n            if (note.endBeat !== undefined) {\n                spec.end = _this._generateEvent(note.endBeat);\n                _this._updateDuration(spec.end);\n            }\n            else {\n                spec.end = undefined;\n            }\n            return spec;\n        });\n    };\n    Notechart.prototype._generateLandminesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            _this._updateDuration(spec);\n            return spec;\n        });\n    };\n    Notechart.prototype._updateDuration = function (event) {\n        if (event.time > this._duration)\n            this._duration = event.time;\n    };\n    Notechart.prototype._generateAutoKeysoundEventsFromBMS = function (bmsNotes) {\n        var _this = this;\n        return bmsNotes\n            .filter(function (note) { return !note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            return spec;\n        });\n    };\n    Notechart.prototype._generateKeysoundFiles = function (keysounds) {\n        var e_2, _a, e_3, _b;\n        var set = new Set();\n        try {\n            for (var _c = __values([this.notes, this.autos]), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var array = _d.value;\n                try {\n                    for (var array_1 = (e_3 = void 0, __values(array)), array_1_1 = array_1.next(); !array_1_1.done; array_1_1 = array_1.next()) {\n                        var event_ = array_1_1.value;\n                        var file = keysounds.get(event_.keysound);\n                        if (file)\n                            set.add(file);\n                    }\n                }\n                catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                finally {\n                    try {\n                        if (array_1_1 && !array_1_1.done && (_b = array_1.return)) _b.call(array_1);\n                    }\n                    finally { if (e_3) throw e_3.error; }\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return Array.from(set);\n    };\n    Notechart.prototype._generateBarLineEvents = function (beats) {\n        var _this = this;\n        return beats.map(function (beat) { return _this._generateEvent(beat); });\n    };\n    Notechart.prototype._generateEvent = function (beat) {\n        return {\n            beat: beat,\n            time: this.beatToSeconds(beat),\n            position: this.beatToPosition(beat),\n        };\n    };\n    Notechart.prototype._getNoteInfo = function (note) {\n        return { combos: note.end ? 2 : 1 };\n    };\n    return Notechart;\n}());\nexports.Notechart = Notechart;\nexports.default = Notechart;\nfunction getKeys(bmsNotes) {\n    var e_4, _a;\n    try {\n        for (var bmsNotes_1 = __values(bmsNotes), bmsNotes_1_1 = bmsNotes_1.next(); !bmsNotes_1_1.done; bmsNotes_1_1 = bmsNotes_1.next()) {\n            var note = bmsNotes_1_1.value;\n            if (note.column === '6' || note.column === '7') {\n                return '7K';\n            }\n        }\n    }\n    catch (e_4_1) { e_4 = { error: e_4_1 }; }\n    finally {\n        try {\n            if (bmsNotes_1_1 && !bmsNotes_1_1.done && (_a = bmsNotes_1.return)) _a.call(bmsNotes_1);\n        }\n        finally { if (e_4) throw e_4.error; }\n    }\n    return '5K';\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fromBMSChart = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar __1 = __importDefault(require(\"../\"));\n// Returns a new Notechart from a BMSChart.\nfunction fromBMSChart(bms, playerOptions) {\n    var notes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1,\n    }).all();\n    var landmineNotes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP_LANDMINE\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1_LANDMINE,\n    }).all();\n    var timing = BMS.Timing.fromBMSChart(bms);\n    var keysounds = BMS.Keysounds.fromBMSChart(bms);\n    var songInfo = BMS.SongInfo.fromBMSChart(bms);\n    var positioning = BMS.Positioning.fromBMSChart(bms);\n    var spacing = BMS.Spacing.fromBMSChart(bms);\n    var data = {\n        notes: notes,\n        landmineNotes: landmineNotes,\n        timing: timing,\n        keysounds: keysounds,\n        songInfo: songInfo,\n        positioning: positioning,\n        spacing: spacing,\n        barLines: generateBarLinesFromBMS(notes, bms),\n        expertJudgmentWindow: getJudgmentWindowFromBMS(bms),\n    };\n    return new __1.default(data, playerOptions);\n}\nexports.fromBMSChart = fromBMSChart;\nfunction getJudgmentWindowFromBMS(bms) {\n    // http://hitkey.nekokan.dyndns.info/diary1501.php\n    var rank = +bms.headers.get('rank') || 2;\n    if (rank === 0)\n        return [8, 24]; // Very Hard\n    if (rank === 1)\n        return [15, 30]; // Hard\n    if (rank === 3)\n        return [21, 60]; // Easy\n    return [18, 40]; // Normal\n}\nfunction generateBarLinesFromBMS(bmsNotes, bms) {\n    var max = lodash_1.default.max(bmsNotes.map(function (note) { return note.endBeat || note.beat; })) || 0;\n    var barLines = [0];\n    var currentBeat = 0;\n    var currentMeasure = 0;\n    do {\n        currentBeat += bms.timeSignatures.getBeats(currentMeasure);\n        currentMeasure += 1;\n        barLines.push(currentBeat);\n    } while (currentBeat <= max);\n    return barLines;\n}\n//# sourceMappingURL=BMSNotechartLoader.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map"],"names":["___CSS_LOADER_EXPORT___","push","module","id","_enabled","_lifecycleHandler","pauseAt","t","Error","unpause","getScore","enableTestMode","console","log","overlay","document","createElement","setAttribute","innerHTML","body","appendChild","setGameLifecycleHandler","handler","isTestModeEnabled","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","constructor","props","super","renderTable","stats","this","bench","Object","keys","map","key","stat","align","handleInteraction","e","preventDefault","stopPropagation","setState","show","state","text","render","className","onClick","onTouchStart","componentDidMount","setInterval","forceUpdate","Stat","sum","count","average","hist","lastSec","secAvg","delta","now","time","shift","length","toString","format","x","toFixed","propTypes","window","BEMUSE_BENCHMARK","enabled","wrap","title","f","start","apply","arguments","finish","benchmark","obj","name","lines","forEach","join","div","shouldShowOptions","shouldEnableBenchmark","shouldDisableFullScreen","shouldShowAbout","shouldShowModeSelect","isTitleDisplayMode","getGauge","gaugeType","primary","secondary","extra","update","playerState","progress","numJudgments","totalCombo","getHope","min","max1","max2","max","maxPossibleScore","Math","hopeS","hopeA","shouldDisplay","getPrimary","getSecondary","getExtra","hopeGauge","y","lower","upper","pos","position","event","notes","barLines","_notes","_barLines","sortBy","value","getVisibleNotes","headroom","out","i","note","end","entity","head","tail","height","abs","getVisibleBarLines","filter","player","skinData","_currentSpeed","_player","_noteArea","notechart","_stateful","_defaultData","placement","scratch","key_mode","getKeyMode","lane_lift","laneCover","lane_press","_gauge","gauge","_touch3dMode","displayMode","gameTime","touch3dMode","noteArea","stateful","beat","secondsToBeat","beatToPosition","spacing","spacingAtBeat","data","assign","speed","entities","getUpperBound","putNote","noteY","column","scale","row","columnIndex","areaWidth","xOffset","projection","desiredWidth","width","longNoteStep","c","floor","getNoteStatus","judgment","getNoteJudgment","status","active","missed","updateVisibleNotes","updateBarLines","input","columns","control","get","changed","updateInput","notifications","judgments","notification","deviationMode","combo","score","updateJudgment","updateGauge","updateExplode","getCount","currentAccuracy","bpm","bpmAtBeat","round","counts","config","getRow","excess","theta","pointX","cos","pointY","sin","PLAY_AREA_WIDTH","getTouchedColumn","mid","x0","x1","String","justPressed","_controls","Map","_plugins","changes","plugin","set","destroy","controlName","has","use","diff","last","current","Judgment","UNJUDGED","Unjudged","MISSED","Missed","NORMAL_TIMEGATES","timegate","endTimegate","TRANSITIONAL_BEGINNER_LV5_TIMEGATES","TRANSITIONAL_BEGINNER_LV4_TIMEGATES","TRANSITIONAL_BEGINNER_LV3_TIMEGATES","ABSOLUTE_BEGINNER_TIMEGATES","FixedTimegatesJudge","timegates","getTimegates","_gameTime","_noteTime","TutorialJudge","noteTime","NORMAL_JUDGE","getJudgeForNotechart","tutorial","info","songInfo","insane","difficulty","level","judgeTimeWith","judge","judgeTime","judgeEndTime","isBad","breaksCombo","weight","number","autoplayEnabled","autosound","NoteStatus","sounds","finished","tainted","_pinching","_columns","_noteBufferByColumn","n","groupBy","mapValues","startIndex","_noteResult","_duration","duration","_judge","_rawInput","_updateInputColumnMap","_judgeNotes","_updateSpeed","result","getPlayerInput","buffer","_judgeColumn","_modifySpeed","pinch","pinching","direction","amount","_shouldAutoplay","BEMUSE_AUTOPLAY","judgedNote","autoPlayed","_shouldJudge","shouldBreak","_judgeNote","type","freestyleNote","_getFreestyleNote","_isSandwiched","_getClosestNote","mapping","every","adjacentColumn","some","hit","noteEnd","lifted","passed","isDown","isUp","Judged","Active","_setJudgment","handleDelta","handleJudgment","getAccuracyScore","accuracy","getComboScore","total","combos","totalNotes","maxCombo","rawSumJudgmentWeight","rawTotalComboScore","_calculateRawTotalComboScore","_remainingMaxPossibleRawComboScore","rawSumComboScore","poor","_log","deltas","accuracyScore","comboScore","maxPossibleAccuracyScore","maxPossibleComboScore","remainingJudgments","maxPossibleAccuracy","maxPossibleRawComboScore","character","rawComboScore","_calculateRawComboScore","_recordLog","_getLogCharacter","forModule","moduleName","bindLogger","warn","error","args","Date","toJSON","observeMidiAccess","access","sink","port","inputs","values","outputs","onstatechange","navigator","requestMIDIAccess","Promise","reject","flatMap","flatMapError","stack","doLog","AxisLogic","stop","charge","previous","positive","axis","threshold","immediateOutput","ceil","OmniInput","win","_window","_exclusive","exclusive","_continuousAxis","continuous","setGamepadSensitivity","sensitivity","_disposables","listen","_handleKeyDown","_handleKeyUp","onValue","_handleMIDIMessage","_status","_axis","which","prefix","target","handleNote","bend","_updateGamepads","nav","gamepads","getGamepads","webkitGetGamepads","gamepad","_updateGamepad","index","buttons","button","axes","axisName","_deadzone","_sensitivity","_analogThreshold","setGamepadContinuousAxisEnabled","dispose","handle","clearInterval","array","knownMidiIds","getName","match","rest","split","midiNote","replace","subject","eventName","listener","addEventListener","removeEventListener","Progress","undefined","_observable","report","notify","watch","formatter","BYTES_FORMATTER","PERCENTAGE_FORMATTER","EXTRA_FORMATTER","fixed","loaded","async","atomic","promise","resolve","byteLength","hasByteLength","wrapPromise","ret","bind","from","to","simultaneous","queue","unsubscribe","add","addUnprefixed","callback","parts","slice","ResourceLogging","loggingFunction","setLoggingFunction","fn","workerUrl","ARCHIVE_REGEXP","DROPBOX_REGEXP","CustomSongResources","provider","_logging","_files","getFiles","then","files","fileEntry","file","archive","extracted","extractFiles","traverse","tree","File","unarchive","unarchiveIfNeeded","toLowerCase","FileResource","fileList","a","_file","read","as","resolveUrl","URL","createObjectURL","downloadFileEntryFromURL","url","pop","lastTime","download","URLResource","basename","URLResources","base","path","part","encodeURIComponent","href","init","_callbacks","_nextId","call","callbacks","getRetryDelay","random","shouldGiveUp","xh","XMLHttpRequest","open","responseType","onload","response","onerror","onprogress","send","waitMs","seconds","s","Log","offset","performance","synchronize","server","onResult","err","synchronized","o","_value","blob","reader","FileReader","readAsArrayBuffer","readAsText","__createBinding","create","m","k","k2","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","defineProperty","__exportStar","exports","p","prototype","hasOwnProperty","__values","Symbol","iterator","next","done","TypeError","__importDefault","mod","Notechart","lodash_1","invariant_1","playerOptions","_this","bmsNotes","timing","keysounds","positioning","images","expertJudgmentWindow","_a","landmineNotes","default","_preTransform","_timing","_positioning","_spacing","_keysounds","_generatePlayableNotesFromBMS","_landmines","_autos","_generateAutoKeysoundEventsFromBMS","_generateBarLineEvents","_samples","_generateKeysoundFiles","_infos","_getNoteInfo","_songInfo","_images","all","eyecatch","background","beatToSeconds","measureToBeat","measure","secondsToPosition","scrollSpeedAtBeat","factor","e_1","usedColumns","_b","_c","e_1_1","return","chain","e_4","bmsNotes_1","bmsNotes_1_1","e_4_1","getKeys","columnsToShift_1","shiftNote","indexOf","newIndex","newColumn","nextId","spec","_generateEvent","keysound","keysoundStart","keysoundEnd","_updateDuration","endBeat","_generateLandminesFromBMS","e_2","e_3","Set","autos","_d","array_1","array_1_1","event_","e_3_1","e_2_1","Array","beats","__setModuleDefault","v","__importStar","fromBMSChart","BMS","__1","getJudgmentWindowFromBMS","bms","rank","headers","generateBarLinesFromBMS","currentBeat","currentMeasure","timeSignatures","getBeats","Notes","double","CHANNEL_MAPPING","IIDX_DP","IIDX_P1","IIDX_DP_LANDMINE","IIDX_P1_LANDMINE","Timing","Keysounds","SongInfo","Positioning","Spacing"],"sourceRoot":""}