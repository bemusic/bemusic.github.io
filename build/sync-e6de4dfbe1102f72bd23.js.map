{"version":3,"sources":["file:///home/circleci/bemuse/src/utils/read-blob.js","file:///home/circleci/bemuse/src/sampling-master/index.js","file:///home/circleci/bemuse/src/utils/download.js","file:///home/circleci/bemuse/src/audio-context/index.js","file:///home/circleci/bemuse/node_modules/once/once.js","file:///home/circleci/bemuse/node_modules/wrappy/wrappy.js","file:///home/circleci/bemuse/src/auto-synchro/music/data/bgm.m4a","file:///home/circleci/bemuse/src/auto-synchro/music/data/bgm.ogg","file:///home/circleci/bemuse/src/auto-synchro/music/data/intro.m4a","file:///home/circleci/bemuse/src/auto-synchro/music/data/intro.ogg","file:///home/circleci/bemuse/src/auto-synchro/music/data/kick.m4a","file:///home/circleci/bemuse/src/auto-synchro/music/data/kick.ogg","file:///home/circleci/bemuse/src/auto-synchro/music/data/snare.m4a","file:///home/circleci/bemuse/src/auto-synchro/music/data/snare.ogg","file:///home/circleci/bemuse/src/auto-synchro/ui/ExperimentScene.scss?88bf","file:///home/circleci/bemuse/src/auto-synchro/ui/ExperimentScene.scss","file:///home/circleci/bemuse/src/auto-synchro/music/index.js","file:///home/circleci/bemuse/src/auto-synchro/ui/ExperimentScene.jsx","file:///home/circleci/bemuse/src/auto-synchro/index.js","file:///home/circleci/bemuse/node_modules/audio-context/index.js","file:///home/circleci/bemuse/node_modules/bytes/index.js","file:///home/circleci/bemuse/node_modules/classnames/index.js","file:///home/circleci/bemuse/node_modules/co/index.js","file:///home/circleci/bemuse/src/progress/formatters.js","file:///home/circleci/bemuse/src/flux/index.js"],"names":["__webpack_exports__","blob","as","type","Promise","resolve","reject","reader","FileReader","onload","result","onerror","Error","readAsArrayBuffer","readAsText","__webpack_require__","d","FADE_LENGTH","canPlay","unmuteAudio","bemuse_audio_context__WEBPACK_IMPORTED_MODULE_0__","bemuse_utils_read_blob__WEBPACK_IMPORTED_MODULE_1__","dummyAudioTag","document","createElement","canPlayType","SoundGroup","[object Object]","samplingMaster","volume","this","_master","_gain","audioContext","createGain","gain","value","connect","destination","disconnect","Sample","audioBuffer","_buffer","delay","options","PlayInstance","buffer","context","source","createBufferSource","onended","stop","node","group","_source","TEST_node","startTime","Math","max","currentTime","startOffset","start","fadeIn","fadeOutAt","setValueAtTime","undefined","end","duration","linearRampToValueAtTime","_startPlaying","_stoppedPlaying","onstop","playbackRate","random","pow","ctx","osc","createOscillator","frequency","resume","e","console","error","_audioContext","_samples","_groups","_instances","Set","_destination","_destroyed","sample","destroy","instance","blobOrArrayBuffer","_coerceToArrayBuffer","then","arrayBuffer","_decodeAudio","blobOrArrayBufferOrAudioBuffer","numberOfChannels","decode","push","ArrayBuffer","Object","decodeAudioData","add","delete","bemuse_progress_formatters__WEBPACK_IMPORTED_MODULE_0__","url","progress","xh","XMLHttpRequest","open","responseType","status","response","formatter","onprogress","report","loaded","total","send","audio_context__WEBPACK_IMPORTED_MODULE_0__","audio_context__WEBPACK_IMPORTED_MODULE_0___default","n","latencyHint","wrappy","once","fn","f","called","apply","arguments","onceStrict","onceError","name","module","exports","strict","proto","defineProperty","Function","prototype","configurable","cb","TypeError","keys","forEach","k","wrapper","args","Array","length","i","ret","p","content","hmr","transform","insertInto","locals","audioExt","once_default","sampling_master","ASSET_URLS","bgm.m4a","bgm.ogg","intro.m4a","intro.ogg","kick.m4a","kick.ogg","snare.m4a","snare.ogg","load","co_default","master","audio_context","samples","lodash_default","a","fromPairs","all","map","download","buf","sampleObj","callbacks","unmute","time","AudioTime","filter","createBiquadFilter","Q","state","part2","sequence","bpm","beat","nowBeat","floor","beatTime","beatSequencer","kick","play","begin","bgm","intro","ok","snare","setInterval","t","nearestBeat","round","nearestBeatTime","music","leadTime","_context","_start","_startTime","ExperimentScene_ExperimentScene","react_default","Component","renderContents","props","loading","started","listening","renderCollection","renderMessage","renderReady","className","onClick","onStart","text","finished","x","easeOut","min","numSamples","style","WebkitTransform","latency","classnames_default","is-finished","propTypes","prop_types_default","bool","func","number","main","bootContext","setStatus","state口","Bacon_default","Bus","state川","scan","change","assign","ConnectedExperimentScene","flux","scene","postMessage","addEventListener","data","window","opener","react_dom_default","render","jquery_default","appendTo","remote","sort","b","count","sum","getLatency","tap","getSample","setTimeout","which","preventDefault","touches","cache","OfflineContext","OfflineAudioContext","webkitOfflineAudioContext","Context","AudioContext","webkitAudioContext","sampleRate","offline","channels","err","parse","format","formatThousandsRegExp","formatDecimalsRegExp","kb","mb","gb","tb","parseRegExp","Number","isFinite","mag","abs","thousandsSeparator","unitSeparator","decimalPlaces","fixedDecimals","Boolean","unit","toLowerCase","str","toFixed","replace","val","isNaN","floatValue","results","exec","parseFloat","parseInt","__WEBPACK_AMD_DEFINE_RESULT__","hasOwn","hasOwnProperty","classNames","classes","arg","argType","isArray","inner","key","call","join","default","slice","co","gen","next","onFulfilled","res","onRejected","throw","done","toPromise","isPromise","String","obj","constructor","displayName","isGenerator","isGeneratorFunction","isObject","promises","promise","defer","wrap","createPromise","__generatorFunction__","BYTES_FORMATTER","PERCENTAGE_FORMATTER","EXTRA_FORMATTER","bytes__WEBPACK_IMPORTED_MODULE_0__","bytes__WEBPACK_IMPORTED_MODULE_0___default","current","extra","baconjs__WEBPACK_IMPORTED_MODULE_0__","baconjs__WEBPACK_IMPORTED_MODULE_0___default","react__WEBPACK_IMPORTED_MODULE_1__","react__WEBPACK_IMPORTED_MODULE_1___default","toProperty","store","Property","EventStream","combineTemplate","props川","propsProperty","initialValue","super","handleValue","_mounted","setState","_unsubscribe","onValue","initialUnsubscribe"],"mappings":"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","file":"build/sync-e6de4dfbe1102f72bd23.js","sourcesContent":["export default readBlob\n\n// Reads the blob as a specified type. The blob will not actually be read\n// unless the ``as()`` method is called.\n//\n// .. js:function:: as(type)\n//\n//    Starts reading the blob as ``type``. The ``type`` is a String such as\n//    \"arraybuffer\" or \"text\".\nexport function readBlob(blob) {\n  return {\n    as(type) {\n      return new Promise(function(resolve, reject) {\n        let reader = new FileReader()\n        reader.onload = function() {\n          resolve(reader.result)\n        }\n        reader.onerror = function() {\n          reject(new Error('Unable to read from Blob'))\n        }\n        switch (type) {\n          case 'arraybuffer':\n            reader.readAsArrayBuffer(blob)\n            break\n          case 'text':\n            reader.readAsText(blob)\n            break\n        }\n      })\n    },\n  }\n}\n","import defaultAudioContext from 'bemuse/audio-context'\nimport readBlob from 'bemuse/utils/read-blob'\n\nexport const FADE_LENGTH = 0.001\n\nlet dummyAudioTag = document.createElement('audio')\n\n// Checks whether an audio format is supported.\nexport function canPlay(type) {\n  return dummyAudioTag.canPlayType(type) === 'probably'\n}\n\n// The sampling master is a wrapper class around Web Audio API\n// that takes care of:\n//\n// - Decoding audio from an ArrayBuffer or Blob (resulting in a \"Sample\").\n// - Playing the `Sample` and managing its lifecycle.\nexport class SamplingMaster {\n  constructor(audioContext) {\n    this._audioContext = audioContext || defaultAudioContext\n    this._samples = []\n    this._groups = []\n    this._instances = new Set()\n    this._destination = this._audioContext.destination\n  }\n\n  // Connects a dummy node to the audio, thereby unmuting the audio system on\n  // iOS devices (which keeps the audio muted until a user interacts with the\n  // page).\n  unmute() {\n    unmuteAudio(this._audioContext)\n  }\n\n  // The underlying AudioContext.\n  get audioContext() {\n    return this._audioContext\n  }\n\n  // The audio destination.\n  get destination() {\n    return this._destination\n  }\n\n  // Destroys this SamplingMaster, make it unusable.\n  destroy() {\n    if (this._destroyed) return\n    this._destroyed = true\n    for (let sample of this._samples) sample.destroy()\n    for (let instance of this._instances) instance.destroy()\n    this._samples = null\n    this._instances = null\n  }\n\n  // Decodes the audio data from a Blob or an ArrayBuffer.\n  // Returns an AudioBuffer which can be re-used in other sampling masters.\n  decode(blobOrArrayBuffer) {\n    return this._coerceToArrayBuffer(blobOrArrayBuffer).then(arrayBuffer =>\n      this._decodeAudio(arrayBuffer)\n    )\n  }\n\n  // Creates a `Sample` from a Blob or an ArrayBuffer or an AudioBuffer.\n  sample(blobOrArrayBufferOrAudioBuffer) {\n    const audioBufferPromise = (() => {\n      if (blobOrArrayBufferOrAudioBuffer.numberOfChannels) {\n        return Promise.resolve(blobOrArrayBufferOrAudioBuffer)\n      } else {\n        return this.decode(blobOrArrayBufferOrAudioBuffer)\n      }\n    })()\n    return audioBufferPromise.then(audioBuffer => {\n      if (this._destroyed) throw new Error('SamplingMaster already destroyed!')\n      var sample = new Sample(this, audioBuffer)\n      this._samples.push(sample)\n      return sample\n    })\n  }\n\n  group(options) {\n    const group = new SoundGroup(this, options)\n    this._groups.push(group)\n    return group\n  }\n\n  _coerceToArrayBuffer(blobOrArrayBuffer) {\n    if (blobOrArrayBuffer instanceof ArrayBuffer) {\n      return Promise.resolve(blobOrArrayBuffer)\n    } else {\n      return readBlob(blobOrArrayBuffer).as('arraybuffer')\n    }\n  }\n\n  _decodeAudio(arrayBuffer) {\n    return new Promise((resolve, reject) => {\n      this.audioContext.decodeAudioData(\n        arrayBuffer,\n        function decodeAudioDataSuccess(audioBuffer) {\n          resolve(audioBuffer)\n        },\n        function decodeAudioDataFailure(e) {\n          reject(new Error('Unable to decode audio: ' + e))\n        }\n      )\n    })\n  }\n\n  _startPlaying(instance) {\n    this._instances.add(instance)\n  }\n\n  _stoppedPlaying(instance) {\n    this._instances.delete(instance)\n  }\n}\n\n// Sound group\nclass SoundGroup {\n  constructor(samplingMaster, { volume } = {}) {\n    this._master = samplingMaster\n    this._gain = this._master.audioContext.createGain()\n    if (volume != null) this._gain.gain.value = volume\n    this._gain.connect(this._master.destination)\n  }\n\n  get destination() {\n    return this._gain\n  }\n\n  destroy() {\n    this._gain.disconnect()\n    this._gain = null\n  }\n}\n\n// The Sample is created by and belongs to the `SamplingMaster`.\n//\n// You don't invoke this constructor directly; it is invoked by\n// `SamplingMaster#create`.\nclass Sample {\n  constructor(samplingMaster, audioBuffer) {\n    this._master = samplingMaster\n    this._buffer = audioBuffer\n  }\n\n  // Plays the sample and returns the new PlayInstance.\n  play(delay, options) {\n    return new PlayInstance(this._master, this._buffer, delay, options)\n  }\n\n  // Destroys this sample, thereby making it unusable.\n  destroy() {\n    this._master = null\n    this._buffer = null\n  }\n}\n\n// When a `Sample` is played, a PlayInstance is created.\n// A PlayInstance may not be reused; after the sound finishes playing,\n// you have to invoke `Sample#play` again.\n//\n// You don't invoke this constructor directly; it is invoked by `Sample#play`.\nclass PlayInstance {\n  constructor(samplingMaster, buffer, delay, options = {}) {\n    delay = delay || 0\n    this._master = samplingMaster\n\n    // Connect all the stuff...\n    let context = samplingMaster.audioContext\n    let source = context.createBufferSource()\n    source.buffer = buffer\n    source.onended = () => this.stop()\n    let gain = context.createGain()\n    source.connect(gain)\n    let destination =\n      options.node ||\n      (options.group && options.group.destination) ||\n      samplingMaster.destination\n    gain.connect(destination)\n    this._source = source\n    this._gain = this.TEST_node = gain\n\n    // Start the sound.\n    let startTime = !delay ? 0 : Math.max(0, context.currentTime + delay)\n    let startOffset = options.start || 0\n    let fadeIn = startOffset > 0\n    let fadeOutAt = false\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, 0)\n    }\n    if (options.end !== undefined) {\n      let duration = Math.max(options.end - startOffset, 0)\n      source.start(startTime, startOffset, duration + FADE_LENGTH)\n      fadeOutAt = context.currentTime + delay + duration\n    } else {\n      source.start(startTime, startOffset)\n    }\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, context.currentTime + delay)\n      gain.gain.linearRampToValueAtTime(\n        1,\n        context.currentTime + delay + FADE_LENGTH\n      )\n    }\n    if (fadeOutAt !== false) {\n      gain.gain.setValueAtTime(1, fadeOutAt)\n      gain.gain.linearRampToValueAtTime(0, fadeOutAt + FADE_LENGTH)\n    }\n    this._master._startPlaying(this)\n  }\n\n  // Stops the sample and disconnects the underlying Web Audio nodes.\n  stop() {\n    if (!this._source) return\n    this._source.stop(0)\n    this._source.disconnect()\n    this._gain.disconnect()\n    this._source = null\n    this._gain = null\n    this._master._stoppedPlaying(this)\n    if (this.onstop) this.onstop()\n  }\n\n  // Makes this PlayInstance sound off-pitch, as a result of badly hitting\n  // a note.\n  bad() {\n    if (!this._source) return\n    this._source.playbackRate.value =\n      Math.random() < 0.5 ? Math.pow(2, 1 / 24) : Math.pow(2, -1 / 24)\n  }\n\n  // Destroys this PlayInstance.\n  destroy() {\n    this.stop()\n  }\n}\n\nexport default SamplingMaster\n\n/**\n * Enables Web Audio on iOS. By default, on iOS, audio is disabled.\n * This function must be called before audio will start working. It must be\n * called as a response to some user interaction (e.g. touchstart).\n *\n * Also, there’s now Chrome autoplay policy taking effect.\n * https://developers.google.com/web/updates/2017/09/autoplay-policy-changes\n *\n * @param {AudioContext} ctx The AudioContext to be unmuted.\n */\nexport function unmuteAudio(ctx = defaultAudioContext) {\n  // Perform some strange magic to unmute the audio on iOS devices.\n  // This code doesn’t make sense at all, you know.\n  let gain = ctx.createGain()\n  let osc = ctx.createOscillator()\n  osc.frequency.value = 440\n  osc.start(ctx.currentTime + 0.1)\n  osc.stop(ctx.currentTime + 0.1)\n  gain.connect(ctx.destination)\n  gain.disconnect()\n\n  try {\n    ctx.resume()\n  } catch (e) {\n    console.error('[sampling-master] Cannot resume AudioContext', e)\n  }\n}\n","import { BYTES_FORMATTER } from 'bemuse/progress/formatters'\n\n// Downloads the file from the URL.\n// The download will not actually be started unless the ``as()`` method\n// is called.\n//\n// .. js:function:: as(type)\n//\n//    Initiates the download as ``type``. The ``type`` is a string such as\n//    \"arraybuffer\" or \"blob\".\nexport function download(url) {\n  return {\n    as(type, progress) {\n      return new Promise((resolve, reject) => {\n        var xh = new XMLHttpRequest()\n        xh.open('GET', url, true)\n        xh.responseType = type\n        xh.onload = () => {\n          if (+xh.status === 200) {\n            resolve(xh.response)\n          } else {\n            reject(new Error(`Unable to download ${url}: HTTP ${xh.status}`))\n          }\n        }\n        xh.onerror = () => reject(new Error(`Unable to download ${url}`))\n        if (progress) {\n          progress.formatter = BYTES_FORMATTER\n          xh.onprogress = e => progress.report(e.loaded, e.total)\n        }\n        xh.send(null)\n      })\n    },\n  }\n}\n\nexport default download\n","import createAudioContext from 'audio-context'\n\nexport default createAudioContext({\n  latencyHint: 'interaction',\n})\n","var wrappy = require('wrappy')\nmodule.exports = wrappy(once)\nmodule.exports.strict = wrappy(onceStrict)\n\nonce.proto = once(function () {\n  Object.defineProperty(Function.prototype, 'once', {\n    value: function () {\n      return once(this)\n    },\n    configurable: true\n  })\n\n  Object.defineProperty(Function.prototype, 'onceStrict', {\n    value: function () {\n      return onceStrict(this)\n    },\n    configurable: true\n  })\n})\n\nfunction once (fn) {\n  var f = function () {\n    if (f.called) return f.value\n    f.called = true\n    return f.value = fn.apply(this, arguments)\n  }\n  f.called = false\n  return f\n}\n\nfunction onceStrict (fn) {\n  var f = function () {\n    if (f.called)\n      throw new Error(f.onceError)\n    f.called = true\n    return f.value = fn.apply(this, arguments)\n  }\n  var name = fn.name || 'Function wrapped with `once`'\n  f.onceError = name + \" shouldn't be called more than once\"\n  f.called = false\n  return f\n}\n","// Returns a wrapper function that returns a wrapped callback\n// The wrapper function should do some stuff, and return a\n// presumably different callback function.\n// This makes sure that own properties are retained, so that\n// decorations and such are not lost along the way.\nmodule.exports = wrappy\nfunction wrappy (fn, cb) {\n  if (fn && cb) return wrappy(fn)(cb)\n\n  if (typeof fn !== 'function')\n    throw new TypeError('need wrapper function')\n\n  Object.keys(fn).forEach(function (k) {\n    wrapper[k] = fn[k]\n  })\n\n  return wrapper\n\n  function wrapper() {\n    var args = new Array(arguments.length)\n    for (var i = 0; i < args.length; i++) {\n      args[i] = arguments[i]\n    }\n    var ret = fn.apply(this, args)\n    var cb = args[args.length-1]\n    if (typeof ret === 'function' && ret !== cb) {\n      Object.keys(cb).forEach(function (k) {\n        ret[k] = cb[k]\n      })\n    }\n    return ret\n  }\n}\n","module.exports = __webpack_public_path__ + \"build/d616933dc6ba90ddc42fa528e59c2ac6.m4a\";","module.exports = __webpack_public_path__ + \"build/c3e8436ef4e3bcc1fbc987075279be07.ogg\";","module.exports = __webpack_public_path__ + \"build/150932874bb885bde51d3ea93c06396e.m4a\";","module.exports = __webpack_public_path__ + \"build/aaeef09f2847a09d179f45cfe118d7e7.ogg\";","module.exports = __webpack_public_path__ + \"build/5e75d0b50cbcd08edf7ea8f313ec0bf0.m4a\";","module.exports = __webpack_public_path__ + \"build/c1df64d6d6f13f3a38362aea7cc70a3f.ogg\";","module.exports = __webpack_public_path__ + \"build/e6c66bfd20535c717896d71e1e5ac6f6.m4a\";","module.exports = __webpack_public_path__ + \"build/e733dbfbb80f232b5704be73413ff476.ogg\";","\nvar content = require(\"!!../../../node_modules/css-loader/index.js??ref--9-1!../../../node_modules/postcss-loader/src/index.js??postcss!../../../node_modules/sass-loader/lib/loader.js??ref--9-3!./ExperimentScene.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../node_modules/css-loader/index.js??ref--9-1!../../../node_modules/postcss-loader/src/index.js??postcss!../../../node_modules/sass-loader/lib/loader.js??ref--9-3!./ExperimentScene.scss\", function() {\n\t\tvar newContent = require(\"!!../../../node_modules/css-loader/index.js??ref--9-1!../../../node_modules/postcss-loader/src/index.js??postcss!../../../node_modules/sass-loader/lib/loader.js??ref--9-3!./ExperimentScene.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.ExperimentScene {\\n  display: flex;\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  align-items: center;\\n  justify-content: center;\\n}\\n\\n.ExperimentSceneのbutton {\\n  font: inherit;\\n  background: #252423 linear-gradient(to bottom, #454443, #151413);\\n  border: 1px solid #555453;\\n  padding: 0.5ex 1.3ex;\\n  color: #fff;\\n  border-radius: 4px;\\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\\n  font-size: 18px;\\n}\\n\\n.ExperimentSceneのbutton:hover {\\n  border-color: #656463;\\n}\\n\\n.ExperimentSceneのbutton:focus {\\n  border-color: #8b8685;\\n  outline: 0;\\n}\\n\\n.ExperimentSceneのbutton:active {\\n  background: #252423 linear-gradient(to top, #353433, #151413);\\n  border-color: #454443;\\n}\\n\\n.ExperimentSceneのmessage {\\n  text-align: center;\\n  font-size: 16px;\\n}\\n\\n.ExperimentSceneのprogress {\\n  width: 100px;\\n  margin: 1em auto;\\n  border: 1px solid #8b8685;\\n  padding: 1px;\\n}\\n\\n.ExperimentSceneのprogressBar {\\n  height: 5px;\\n  background: #8b8685;\\n  transition: 0.5s -webkit-transform linear;\\n  transition: 0.5s transform linear;\\n  transition: 0.5s transform linear, 0.5s -webkit-transform linear;\\n  -webkit-transform-origin: left;\\n          transform-origin: left;\\n}\\n\\n.ExperimentScene.is-finished .ExperimentSceneのwrapper {\\n  -webkit-animation: 3.243243243s experiment-scene--auto-synchro linear infinite;\\n          animation: 3.243243243s experiment-scene--auto-synchro linear infinite;\\n}\\n\\n.ExperimentScene.is-finished .ExperimentSceneのwrapperInner {\\n  -webkit-animation: 3s experiment-scene--spin linear infinite;\\n          animation: 3s experiment-scene--spin linear infinite;\\n  -webkit-animation-delay: 13.378378377s;\\n          animation-delay: 13.378378377s;\\n}\\n\\n@-webkit-keyframes experiment-scene--auto-synchro {\\n  0.00% {\\n    -webkit-transform: scale(1);\\n            transform: scale(1);\\n  }\\n  11.88% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  13.13% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  24.38% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  25.63% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  36.88% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  38.13% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  49.38% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  50.63% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  61.88% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  63.13% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  74.38% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  75.63% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  86.88% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  88.13% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  100.00% {\\n    -webkit-transform: scale(1);\\n            transform: scale(1);\\n  }\\n}\\n\\n@keyframes experiment-scene--auto-synchro {\\n  0.00% {\\n    -webkit-transform: scale(1);\\n            transform: scale(1);\\n  }\\n  11.88% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  13.13% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  24.38% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  25.63% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  36.88% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  38.13% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  49.38% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  50.63% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  61.88% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  63.13% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  74.38% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  75.63% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  86.88% {\\n    -webkit-transform: scale(0.95);\\n            transform: scale(0.95);\\n  }\\n  88.13% {\\n    -webkit-transform: scale(1.05);\\n            transform: scale(1.05);\\n  }\\n  100.00% {\\n    -webkit-transform: scale(1);\\n            transform: scale(1);\\n  }\\n}\\n\\n@-webkit-keyframes experiment-scene--spin {\\n  0% {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg);\\n  }\\n  4% {\\n    -webkit-transform: rotate(1.99deg);\\n            transform: rotate(1.99deg);\\n  }\\n  8% {\\n    -webkit-transform: rotate(3.85deg);\\n            transform: rotate(3.85deg);\\n  }\\n  12% {\\n    -webkit-transform: rotate(5.48deg);\\n            transform: rotate(5.48deg);\\n  }\\n  16% {\\n    -webkit-transform: rotate(6.75deg);\\n            transform: rotate(6.75deg);\\n  }\\n  20% {\\n    -webkit-transform: rotate(7.61deg);\\n            transform: rotate(7.61deg);\\n  }\\n  24% {\\n    -webkit-transform: rotate(7.98deg);\\n            transform: rotate(7.98deg);\\n  }\\n  28% {\\n    -webkit-transform: rotate(7.86deg);\\n            transform: rotate(7.86deg);\\n  }\\n  32% {\\n    -webkit-transform: rotate(7.24deg);\\n            transform: rotate(7.24deg);\\n  }\\n  36% {\\n    -webkit-transform: rotate(6.16deg);\\n            transform: rotate(6.16deg);\\n  }\\n  40% {\\n    -webkit-transform: rotate(4.7deg);\\n            transform: rotate(4.7deg);\\n  }\\n  44% {\\n    -webkit-transform: rotate(2.94deg);\\n            transform: rotate(2.94deg);\\n  }\\n  48% {\\n    -webkit-transform: rotate(1deg);\\n            transform: rotate(1deg);\\n  }\\n  52% {\\n    -webkit-transform: rotate(-1deg);\\n            transform: rotate(-1deg);\\n  }\\n  56% {\\n    -webkit-transform: rotate(-2.94deg);\\n            transform: rotate(-2.94deg);\\n  }\\n  60% {\\n    -webkit-transform: rotate(-4.7deg);\\n            transform: rotate(-4.7deg);\\n  }\\n  64% {\\n    -webkit-transform: rotate(-6.16deg);\\n            transform: rotate(-6.16deg);\\n  }\\n  68% {\\n    -webkit-transform: rotate(-7.24deg);\\n            transform: rotate(-7.24deg);\\n  }\\n  72% {\\n    -webkit-transform: rotate(-7.86deg);\\n            transform: rotate(-7.86deg);\\n  }\\n  76% {\\n    -webkit-transform: rotate(-7.98deg);\\n            transform: rotate(-7.98deg);\\n  }\\n  80% {\\n    -webkit-transform: rotate(-7.61deg);\\n            transform: rotate(-7.61deg);\\n  }\\n  84% {\\n    -webkit-transform: rotate(-6.75deg);\\n            transform: rotate(-6.75deg);\\n  }\\n  88% {\\n    -webkit-transform: rotate(-5.48deg);\\n            transform: rotate(-5.48deg);\\n  }\\n  92% {\\n    -webkit-transform: rotate(-3.85deg);\\n            transform: rotate(-3.85deg);\\n  }\\n  96% {\\n    -webkit-transform: rotate(-1.99deg);\\n            transform: rotate(-1.99deg);\\n  }\\n  100% {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg);\\n  }\\n}\\n\\n@keyframes experiment-scene--spin {\\n  0% {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg);\\n  }\\n  4% {\\n    -webkit-transform: rotate(1.99deg);\\n            transform: rotate(1.99deg);\\n  }\\n  8% {\\n    -webkit-transform: rotate(3.85deg);\\n            transform: rotate(3.85deg);\\n  }\\n  12% {\\n    -webkit-transform: rotate(5.48deg);\\n            transform: rotate(5.48deg);\\n  }\\n  16% {\\n    -webkit-transform: rotate(6.75deg);\\n            transform: rotate(6.75deg);\\n  }\\n  20% {\\n    -webkit-transform: rotate(7.61deg);\\n            transform: rotate(7.61deg);\\n  }\\n  24% {\\n    -webkit-transform: rotate(7.98deg);\\n            transform: rotate(7.98deg);\\n  }\\n  28% {\\n    -webkit-transform: rotate(7.86deg);\\n            transform: rotate(7.86deg);\\n  }\\n  32% {\\n    -webkit-transform: rotate(7.24deg);\\n            transform: rotate(7.24deg);\\n  }\\n  36% {\\n    -webkit-transform: rotate(6.16deg);\\n            transform: rotate(6.16deg);\\n  }\\n  40% {\\n    -webkit-transform: rotate(4.7deg);\\n            transform: rotate(4.7deg);\\n  }\\n  44% {\\n    -webkit-transform: rotate(2.94deg);\\n            transform: rotate(2.94deg);\\n  }\\n  48% {\\n    -webkit-transform: rotate(1deg);\\n            transform: rotate(1deg);\\n  }\\n  52% {\\n    -webkit-transform: rotate(-1deg);\\n            transform: rotate(-1deg);\\n  }\\n  56% {\\n    -webkit-transform: rotate(-2.94deg);\\n            transform: rotate(-2.94deg);\\n  }\\n  60% {\\n    -webkit-transform: rotate(-4.7deg);\\n            transform: rotate(-4.7deg);\\n  }\\n  64% {\\n    -webkit-transform: rotate(-6.16deg);\\n            transform: rotate(-6.16deg);\\n  }\\n  68% {\\n    -webkit-transform: rotate(-7.24deg);\\n            transform: rotate(-7.24deg);\\n  }\\n  72% {\\n    -webkit-transform: rotate(-7.86deg);\\n            transform: rotate(-7.86deg);\\n  }\\n  76% {\\n    -webkit-transform: rotate(-7.98deg);\\n            transform: rotate(-7.98deg);\\n  }\\n  80% {\\n    -webkit-transform: rotate(-7.61deg);\\n            transform: rotate(-7.61deg);\\n  }\\n  84% {\\n    -webkit-transform: rotate(-6.75deg);\\n            transform: rotate(-6.75deg);\\n  }\\n  88% {\\n    -webkit-transform: rotate(-5.48deg);\\n            transform: rotate(-5.48deg);\\n  }\\n  92% {\\n    -webkit-transform: rotate(-3.85deg);\\n            transform: rotate(-3.85deg);\\n  }\\n  96% {\\n    -webkit-transform: rotate(-1.99deg);\\n            transform: rotate(-1.99deg);\\n  }\\n  100% {\\n    -webkit-transform: rotate(0deg);\\n            transform: rotate(0deg);\\n  }\\n}\\n\", \"\"]);\n\n// exports\n","import _ from 'lodash'\nimport co from 'co'\nimport context from 'bemuse/audio-context'\nimport download from 'bemuse/utils/download'\nimport once from 'once'\nimport SamplingMaster, { canPlay } from 'bemuse/sampling-master'\n\n/**\n * The audio format to use (.ogg or .m4a)\n */\nlet audioExt = once(() =>\n  canPlay('audio/ogg; codecs=\"vorbis\"') ? '.ogg' : '.m4a'\n)\n\n/**\n * The asset URL of these files...\n */\nlet ASSET_URLS = {\n  'bgm.m4a': require('./data/bgm.m4a'),\n  'bgm.ogg': require('./data/bgm.ogg'),\n  'intro.m4a': require('./data/intro.m4a'),\n  'intro.ogg': require('./data/intro.ogg'),\n  'kick.m4a': require('./data/kick.m4a'),\n  'kick.ogg': require('./data/kick.ogg'),\n  'snare.m4a': require('./data/snare.m4a'),\n  'snare.ogg': require('./data/snare.ogg'),\n}\n\n/**\n * Loads the files and create a music instance.\n */\nexport function load() {\n  return co(function*() {\n    let master = new SamplingMaster(context)\n    let sample = name =>\n      download(ASSET_URLS[`${name}${audioExt()}`])\n        .as('arraybuffer')\n        .then(buf => master.sample(buf))\n    let samples = _.fromPairs(\n      yield Promise.all(\n        ['bgm', 'intro', 'kick', 'snare'].map(name =>\n          sample(name).then(sampleObj => [name, sampleObj])\n        )\n      )\n    )\n    return music(master, samples)\n  })\n}\n\n/**\n * Takes the sample and sequences a music\n */\nfunction music(master, samples) {\n  return function play(callbacks) {\n    master.unmute()\n\n    let BPM = 148\n    let time = new AudioTime(context, -1)\n\n    let filter = context.createBiquadFilter()\n    filter.type = 'lowpass'\n    filter.frequency.value = 0\n    filter.Q.value = 10\n    filter.connect(context.destination)\n\n    let state = { part2: null }\n\n    let sequence = beatSequencer(BPM, (beat, delay) => {\n      if (beat % 8 !== 7) {\n        samples.kick.play(delay)\n      }\n      if (state.part2 !== null) {\n        beat -= state.part2.begin\n        if (beat % 128 === 0) {\n          samples.bgm.play(delay)\n        }\n      } else {\n        if (beat % 32 === 0) {\n          samples.intro.play(delay, { node: filter })\n        }\n        if (beat % 32 === 31) {\n          if (state.ok === true) {\n            samples.snare.play(delay)\n            state.part2 = { begin: beat + 1 }\n            callbacks.a()\n          }\n        }\n      }\n    })\n\n    setInterval(() => sequence(time.t), 33)\n\n    return {\n      ok() {\n        state.ok = true\n      },\n      progress(p) {\n        filter.frequency.value = 20000 * p * p * p\n      },\n      getSample() {\n        let nearestBeat = Math.round((time.t * BPM) / 60)\n        let nearestBeatTime = (nearestBeat * 60) / BPM\n        return [nearestBeat, time.t - nearestBeatTime]\n      },\n    }\n  }\n}\n\nfunction beatSequencer(bpm, f) {\n  let beat = -1\n  return time => {\n    let nowBeat = Math.floor(((time + 0.1) * bpm) / 60)\n    while (beat < nowBeat) {\n      beat += 1\n      let beatTime = (beat * 60) / bpm\n      f(beat, beatTime - time)\n    }\n  }\n}\n\nclass AudioTime {\n  constructor(audioContext, leadTime) {\n    this._context = audioContext\n    this._start = audioContext.currentTime\n    this._startTime = leadTime\n  }\n  get t() {\n    return this._context.currentTime - this._start + this._startTime\n  }\n}\n","import './ExperimentScene.scss'\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport c from 'classnames'\n\nexport default class ExperimentScene extends React.Component {\n  static propTypes = {\n    finished: PropTypes.bool,\n    loading: PropTypes.bool,\n    started: PropTypes.bool,\n    listening: PropTypes.bool,\n    onStart: PropTypes.func,\n    numSamples: PropTypes.number,\n    latency: PropTypes.number,\n  }\n\n  render() {\n    return (\n      <div\n        className={c('ExperimentScene', { 'is-finished': this.props.finished })}\n      >\n        <div className='ExperimentSceneのwrapper'>\n          <div className='ExperimentSceneのwrapperInner'>\n            {this.renderContents()}\n          </div>\n        </div>\n      </div>\n    )\n  }\n\n  renderContents = () => {\n    if (this.props.loading) {\n      return null\n    } else if (!this.props.started) {\n      return this.renderReady()\n    } else if (!this.props.listening) {\n      return this.renderMessage('Please listen to the beats…')\n    } else {\n      return this.renderCollection()\n    }\n  }\n\n  renderReady = () => {\n    return (\n      <div className='ExperimentSceneのready'>\n        <button\n          className='ExperimentSceneのbutton'\n          onClick={this.props.onStart}\n        >\n          Start Calibration\n        </button>\n      </div>\n    )\n  }\n\n  renderMessage = text => {\n    return <div className='ExperimentSceneのmessage'>{text}</div>\n  }\n\n  renderCollection = () => {\n    let scale = this.props.finished\n      ? 1\n      : easeOut(Math.min(1, this.props.numSamples / 84))\n    let transform = 'scaleX(' + scale + ')'\n    let style = {\n      transform: transform,\n      WebkitTransform: transform,\n    }\n    return (\n      <div className='ExperimentSceneのcollection'>\n        {this.renderMessage(\n          this.props.finished\n            ? 'Your latency is ' +\n                this.props.latency +\n                'ms. Please close this window.'\n            : 'Please press the space bar when you hear the kick drum.'\n        )}\n        <div className='ExperimentSceneのprogress'>\n          <div className='ExperimentSceneのprogressBar' style={style} />\n        </div>\n      </div>\n    )\n  }\n}\n\nfunction easeOut(x) {\n  return 1 - Math.pow(1 - x, 2)\n}\n","import * as Music from './music'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport ExperimentScene from './ui/ExperimentScene.jsx'\nimport $ from 'jquery'\nimport _ from 'lodash'\nimport Bacon from 'baconjs'\nimport { connect } from 'bemuse/flux'\n\nexport function main(bootContext) {\n  bootContext.setStatus('Loading song')\n  const state口 = new Bacon.Bus()\n\n  const state川 = state口.scan(\n    {\n      loading: true,\n      started: false,\n      finished: false,\n      listening: false,\n      numSamples: 0,\n      latency: 0,\n    },\n    (state, change) => _.assign({}, state, change)\n  )\n\n  const ConnectedExperimentScene = connect(state川)(ExperimentScene)\n\n  const scene = React.createElement(ConnectedExperimentScene, {\n    onStart: () => {\n      play()\n      postMessage({ type: 'calibration-started' })\n      addEventListener('beforeunload', () => {\n        postMessage({ type: 'calibration-closed' })\n      })\n    },\n  })\n\n  ReactDOM.render(scene, $('<div></div>').appendTo('body')[0])\n\n  let play\n\n  function postMessage(data) {\n    if (window.opener) {\n      window.opener.postMessage(data, '*')\n    }\n  }\n\n  function getLatency(samples) {\n    let data = samples.map(d => d[1])\n    data.sort((a, b) => a - b)\n    let count = 0\n    let sum = 0\n    let start = Math.floor((data.length * 1) / 7)\n    for (let i = start; i < (data.length * 6) / 7; i++) {\n      count += 1\n      sum += data[i]\n    }\n    return Math.round((sum / count) * 1000)\n  }\n\n  return Music.load().then(music => {\n    let bound = 56\n    let samples = []\n    state口.push({ loading: false })\n    play = () => {\n      state口.push({ started: true })\n      let remote = music({\n        a() {\n          let latency = Math.max(0, getLatency(samples))\n          state口.push({ finished: true, latency })\n          postMessage({ latency: latency })\n        },\n      })\n      let tap = () => {\n        samples.push(remote.getSample())\n        remote.progress(Math.min(1, samples.length / bound))\n        if (samples.length >= bound) remote.ok()\n        state口.push({ numSamples: samples.length })\n      }\n      setTimeout(() => {\n        state口.push({ listening: true })\n        window.addEventListener('keydown', e => {\n          if (e.which !== 32) return\n          e.preventDefault()\n          tap()\n        })\n        window.addEventListener('touchstart', e => {\n          if (e.touches.length !== 1) return\n          e.preventDefault()\n          tap()\n        })\n      }, 6675)\n    }\n  })\n}\n","'use strict'\r\n\r\nvar cache = {}\r\n\r\nmodule.exports = function getContext (options) {\r\n\tif (typeof window === 'undefined') return null\r\n\t\r\n\tvar OfflineContext = window.OfflineAudioContext || window.webkitOfflineAudioContext\r\n\tvar Context = window.AudioContext || window.webkitAudioContext\r\n\t\r\n\tif (!Context) return null\r\n\r\n\tif (typeof options === 'number') {\r\n\t\toptions = {sampleRate: options}\r\n\t}\r\n\r\n\tvar sampleRate = options && options.sampleRate\r\n\r\n\r\n\tif (options && options.offline) {\r\n\t\tif (!OfflineContext) return null\r\n\r\n\t\treturn new OfflineContext(options.channels || 2, options.length, sampleRate || 44100)\r\n\t}\r\n\r\n\r\n\t//cache by sampleRate, rather strong guess\r\n\tvar ctx = cache[sampleRate]\r\n\r\n\tif (ctx) return ctx\r\n\r\n\t//several versions of firefox have issues with the\r\n\t//constructor argument\r\n\t//see: https://bugzilla.mozilla.org/show_bug.cgi?id=1361475\r\n\ttry {\r\n\t\tctx = new Context(options)\r\n\t}\r\n\tcatch (err) {\r\n\t\tctx = new Context()\r\n\t}\r\n\tcache[ctx.sampleRate] = cache[sampleRate] = ctx\r\n\r\n\treturn ctx\r\n}\r\n","/*!\n * bytes\n * Copyright(c) 2012-2014 TJ Holowaychuk\n * Copyright(c) 2015 Jed Watson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = bytes;\nmodule.exports.format = format;\nmodule.exports.parse = parse;\n\n/**\n * Module variables.\n * @private\n */\n\nvar formatThousandsRegExp = /\\B(?=(\\d{3})+(?!\\d))/g;\n\nvar formatDecimalsRegExp = /(?:\\.0*|(\\.[^0]+)0+)$/;\n\nvar map = {\n  b:  1,\n  kb: 1 << 10,\n  mb: 1 << 20,\n  gb: 1 << 30,\n  tb: ((1 << 30) * 1024)\n};\n\nvar parseRegExp = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb)$/i;\n\n/**\n * Convert the given value in bytes into a string or parse to string to an integer in bytes.\n *\n * @param {string|number} value\n * @param {{\n *  case: [string],\n *  decimalPlaces: [number]\n *  fixedDecimals: [boolean]\n *  thousandsSeparator: [string]\n *  unitSeparator: [string]\n *  }} [options] bytes options.\n *\n * @returns {string|number|null}\n */\n\nfunction bytes(value, options) {\n  if (typeof value === 'string') {\n    return parse(value);\n  }\n\n  if (typeof value === 'number') {\n    return format(value, options);\n  }\n\n  return null;\n}\n\n/**\n * Format the given value in bytes into a string.\n *\n * If the value is negative, it is kept as such. If it is a float,\n * it is rounded.\n *\n * @param {number} value\n * @param {object} [options]\n * @param {number} [options.decimalPlaces=2]\n * @param {number} [options.fixedDecimals=false]\n * @param {string} [options.thousandsSeparator=]\n * @param {string} [options.unit=]\n * @param {string} [options.unitSeparator=]\n *\n * @returns {string|null}\n * @public\n */\n\nfunction format(value, options) {\n  if (!Number.isFinite(value)) {\n    return null;\n  }\n\n  var mag = Math.abs(value);\n  var thousandsSeparator = (options && options.thousandsSeparator) || '';\n  var unitSeparator = (options && options.unitSeparator) || '';\n  var decimalPlaces = (options && options.decimalPlaces !== undefined) ? options.decimalPlaces : 2;\n  var fixedDecimals = Boolean(options && options.fixedDecimals);\n  var unit = (options && options.unit) || '';\n\n  if (!unit || !map[unit.toLowerCase()]) {\n    if (mag >= map.tb) {\n      unit = 'TB';\n    } else if (mag >= map.gb) {\n      unit = 'GB';\n    } else if (mag >= map.mb) {\n      unit = 'MB';\n    } else if (mag >= map.kb) {\n      unit = 'KB';\n    } else {\n      unit = 'B';\n    }\n  }\n\n  var val = value / map[unit.toLowerCase()];\n  var str = val.toFixed(decimalPlaces);\n\n  if (!fixedDecimals) {\n    str = str.replace(formatDecimalsRegExp, '$1');\n  }\n\n  if (thousandsSeparator) {\n    str = str.replace(formatThousandsRegExp, thousandsSeparator);\n  }\n\n  return str + unitSeparator + unit;\n}\n\n/**\n * Parse the string value into an integer in bytes.\n *\n * If no unit is given, it is assumed the value is in bytes.\n *\n * @param {number|string} val\n *\n * @returns {number|null}\n * @public\n */\n\nfunction parse(val) {\n  if (typeof val === 'number' && !isNaN(val)) {\n    return val;\n  }\n\n  if (typeof val !== 'string') {\n    return null;\n  }\n\n  // Test if the string passed is valid\n  var results = parseRegExp.exec(val);\n  var floatValue;\n  var unit = 'b';\n\n  if (!results) {\n    // Nothing could be extracted from the given string\n    floatValue = parseInt(val, 10);\n    unit = 'b'\n  } else {\n    // Retrieve the value and the unit\n    floatValue = parseFloat(results[1]);\n    unit = results[4].toLowerCase();\n  }\n\n  return Math.floor(map[unit] * floatValue);\n}\n","/*!\n  Copyright (c) 2017 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames () {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg) && arg.length) {\n\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\tif (inner) {\n\t\t\t\t\tclasses.push(inner);\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","\n/**\n * slice() reference.\n */\n\nvar slice = Array.prototype.slice;\n\n/**\n * Expose `co`.\n */\n\nmodule.exports = co['default'] = co.co = co;\n\n/**\n * Wrap the given generator `fn` into a\n * function that returns a promise.\n * This is a separate function so that\n * every `co()` call doesn't create a new,\n * unnecessary closure.\n *\n * @param {GeneratorFunction} fn\n * @return {Function}\n * @api public\n */\n\nco.wrap = function (fn) {\n  createPromise.__generatorFunction__ = fn;\n  return createPromise;\n  function createPromise() {\n    return co.call(this, fn.apply(this, arguments));\n  }\n};\n\n/**\n * Execute the generator function or a generator\n * and return a promise.\n *\n * @param {Function} fn\n * @return {Promise}\n * @api public\n */\n\nfunction co(gen) {\n  var ctx = this;\n  var args = slice.call(arguments, 1)\n\n  // we wrap everything in a promise to avoid promise chaining,\n  // which leads to memory leak errors.\n  // see https://github.com/tj/co/issues/180\n  return new Promise(function(resolve, reject) {\n    if (typeof gen === 'function') gen = gen.apply(ctx, args);\n    if (!gen || typeof gen.next !== 'function') return resolve(gen);\n\n    onFulfilled();\n\n    /**\n     * @param {Mixed} res\n     * @return {Promise}\n     * @api private\n     */\n\n    function onFulfilled(res) {\n      var ret;\n      try {\n        ret = gen.next(res);\n      } catch (e) {\n        return reject(e);\n      }\n      next(ret);\n    }\n\n    /**\n     * @param {Error} err\n     * @return {Promise}\n     * @api private\n     */\n\n    function onRejected(err) {\n      var ret;\n      try {\n        ret = gen.throw(err);\n      } catch (e) {\n        return reject(e);\n      }\n      next(ret);\n    }\n\n    /**\n     * Get the next value in the generator,\n     * return a promise.\n     *\n     * @param {Object} ret\n     * @return {Promise}\n     * @api private\n     */\n\n    function next(ret) {\n      if (ret.done) return resolve(ret.value);\n      var value = toPromise.call(ctx, ret.value);\n      if (value && isPromise(value)) return value.then(onFulfilled, onRejected);\n      return onRejected(new TypeError('You may only yield a function, promise, generator, array, or object, '\n        + 'but the following object was passed: \"' + String(ret.value) + '\"'));\n    }\n  });\n}\n\n/**\n * Convert a `yield`ed value into a promise.\n *\n * @param {Mixed} obj\n * @return {Promise}\n * @api private\n */\n\nfunction toPromise(obj) {\n  if (!obj) return obj;\n  if (isPromise(obj)) return obj;\n  if (isGeneratorFunction(obj) || isGenerator(obj)) return co.call(this, obj);\n  if ('function' == typeof obj) return thunkToPromise.call(this, obj);\n  if (Array.isArray(obj)) return arrayToPromise.call(this, obj);\n  if (isObject(obj)) return objectToPromise.call(this, obj);\n  return obj;\n}\n\n/**\n * Convert a thunk to a promise.\n *\n * @param {Function}\n * @return {Promise}\n * @api private\n */\n\nfunction thunkToPromise(fn) {\n  var ctx = this;\n  return new Promise(function (resolve, reject) {\n    fn.call(ctx, function (err, res) {\n      if (err) return reject(err);\n      if (arguments.length > 2) res = slice.call(arguments, 1);\n      resolve(res);\n    });\n  });\n}\n\n/**\n * Convert an array of \"yieldables\" to a promise.\n * Uses `Promise.all()` internally.\n *\n * @param {Array} obj\n * @return {Promise}\n * @api private\n */\n\nfunction arrayToPromise(obj) {\n  return Promise.all(obj.map(toPromise, this));\n}\n\n/**\n * Convert an object of \"yieldables\" to a promise.\n * Uses `Promise.all()` internally.\n *\n * @param {Object} obj\n * @return {Promise}\n * @api private\n */\n\nfunction objectToPromise(obj){\n  var results = new obj.constructor();\n  var keys = Object.keys(obj);\n  var promises = [];\n  for (var i = 0; i < keys.length; i++) {\n    var key = keys[i];\n    var promise = toPromise.call(this, obj[key]);\n    if (promise && isPromise(promise)) defer(promise, key);\n    else results[key] = obj[key];\n  }\n  return Promise.all(promises).then(function () {\n    return results;\n  });\n\n  function defer(promise, key) {\n    // predefine the key in the result\n    results[key] = undefined;\n    promises.push(promise.then(function (res) {\n      results[key] = res;\n    }));\n  }\n}\n\n/**\n * Check if `obj` is a promise.\n *\n * @param {Object} obj\n * @return {Boolean}\n * @api private\n */\n\nfunction isPromise(obj) {\n  return 'function' == typeof obj.then;\n}\n\n/**\n * Check if `obj` is a generator.\n *\n * @param {Mixed} obj\n * @return {Boolean}\n * @api private\n */\n\nfunction isGenerator(obj) {\n  return 'function' == typeof obj.next && 'function' == typeof obj.throw;\n}\n\n/**\n * Check if `obj` is a generator function.\n *\n * @param {Mixed} obj\n * @return {Boolean}\n * @api private\n */\nfunction isGeneratorFunction(obj) {\n  var constructor = obj.constructor;\n  if (!constructor) return false;\n  if ('GeneratorFunction' === constructor.name || 'GeneratorFunction' === constructor.displayName) return true;\n  return isGenerator(constructor.prototype);\n}\n\n/**\n * Check for plain object.\n *\n * @param {Mixed} val\n * @return {Boolean}\n * @api private\n */\n\nfunction isObject(val) {\n  return Object == val.constructor;\n}\n","import bytes from 'bytes'\n\nlet wrap = f => progress => (progress.progress !== null ? f(progress) : '')\n\n// Formats the `Progress` as bytes (e.g. 1.23mb of 1.31mb).\nexport let BYTES_FORMATTER = wrap(\n  progress => bytes(progress.current) + ' / ' + bytes(progress.total)\n)\n\n// Formats the `Progress` as percentage.\nexport let PERCENTAGE_FORMATTER = wrap(\n  progress => ((progress.current / progress.total) * 100).toFixed(1) + '%'\n)\n\n// Formats the `Progress` simply by using the value of `Progress#extra`.\nexport let EXTRA_FORMATTER = wrap(progress => progress.extra + '')\n","import Bacon from 'baconjs'\nimport React from 'react'\n\nexport { Bacon }\n\nlet lock = false\n\nexport function Action(transform = x => x) {\n  var bus = new Bacon.Bus()\n  var action = function() {\n    if (lock) {\n      throw new Error(\n        'An action should not fire another action! (' + lock.stack + ')'\n      )\n    }\n    try {\n      let payload = transform.apply(null, arguments)\n      lock = new Error('Previous lock:')\n      bus.push(payload)\n    } finally {\n      lock = false\n    }\n  }\n  action.bus = bus\n  action.debug = function(prefix) {\n    bus.map(value => [prefix, value]).log()\n    return action\n  }\n  return action\n}\n\nexport function Store(store, options = {}) {\n  let lazy = !!options.lazy\n  store = toProperty(store)\n  store.get = () => {\n    let data\n    let unsubscribe = store.onValue(_data => (data = _data))\n    setTimeout(unsubscribe)\n    return data\n  }\n  if (!lazy) {\n    store.onValue(() => {})\n  }\n  return store\n}\n\nfunction toProperty(store) {\n  if (store instanceof Bacon.Property) {\n    return store\n  } else if (store instanceof Bacon.EventStream) {\n    throw new Error('Please convert Bacon.EventStream to Bacon.Property first.')\n  } else if (store && typeof store === 'object') {\n    return Bacon.combineTemplate(store)\n  } else {\n    throw new Error('Expected a Bacon.Property or a template.')\n  }\n}\n\nexport const connect = props川 => Component => {\n  let propsProperty = toProperty(props川)\n  return class extends React.Component {\n    constructor(props) {\n      super(props)\n      this._unsubscribe = propsProperty.onValue(this.handleValue)\n      let initialValue\n      const initialUnsubscribe = propsProperty.onValue(\n        value => (initialValue = value)\n      )\n      initialUnsubscribe()\n      this.state = { value: initialValue }\n    }\n\n    componentWillUnmount() {\n      this._mounted = false\n      if (this._unsubscribe) this._unsubscribe()\n    }\n\n    componentDidMount() {\n      this._mounted = true\n    }\n\n    handleValue = value => {\n      if (this._mounted) this.setState({ value })\n    }\n\n    render() {\n      return <Component {...this.state.value || {}} {...this.props} />\n    }\n  }\n}\n"],"sourceRoot":""}