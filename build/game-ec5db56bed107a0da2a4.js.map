{"version":3,"sources":["file:///home/circleci/bemuse/bemuse/src/utils/download.js","file:///home/circleci/bemuse/bemuse/src/progress/index.ts","file:///home/circleci/bemuse/packages/bms/lib/util/match.js","file:///home/circleci/bemuse/packages/bms/lib/bms/headers.js","file:///home/circleci/bemuse/packages/bms/lib/bms/objects.js","file:///home/circleci/bemuse/packages/bms/lib/time-signatures/index.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/timers-browserify@2.0.12/node_modules/timers-browserify/main.js","file:///home/circleci/bemuse/bemuse/src/devtools/query-flags.js","file:///home/circleci/bemuse/bemuse/src/game/audio/index.js","file:///home/circleci/bemuse/bemuse/src/game/clock.js","file:///home/circleci/bemuse/bemuse/src/game/game-timer.js","file:///home/circleci/bemuse/bemuse/src/game/input/dual-input.ts","file:///home/circleci/bemuse/bemuse/src/game/input/omni-input-plugin.js","file:///home/circleci/bemuse/bemuse/src/game/game-controller.js","file:///home/circleci/bemuse/bemuse/src/game/loaders/loadImage.js","file:///home/circleci/bemuse/bemuse/src/game/loaders/game-loader.ts","file:///home/circleci/bemuse/bemuse/src/game/loaders/multitasker.js","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneSongInfo.jsx","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneProgressBar.jsx","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneProgress.jsx","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingScene.jsx","file:///home/circleci/bemuse/bemuse/src/utils/now.js","file:///home/circleci/bemuse/bemuse/src/progress/Progress.ts","file:///home/circleci/bemuse/bemuse/src/utils/observable.ts","file:///home/circleci/bemuse/bemuse/src/utils/callbacks.ts","file:///home/circleci/bemuse/bemuse/src/audio-context/index.js","file:///home/circleci/bemuse/bemuse/src/ui/Scene.jsx","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/bytes@3.1.2/node_modules/bytes/index.js","file:///home/circleci/bemuse/bemuse/src/sampling-master/index.js","file:///home/circleci/bemuse/bemuse/src/resources/addUnprefixed.ts","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/url@0.11.0/node_modules/url/url.js","file:///home/circleci/bemuse/bemuse/src/resources/resource-logging.ts","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/libarchive.js@1.3.0/node_modules/libarchive.js/src/compressed-file.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/libarchive.js@1.3.0/node_modules/libarchive.js/src/libarchive.js","file:///home/circleci/bemuse/bemuse/src/resources/unarchiver.ts","file:///home/circleci/bemuse/bemuse/src/resources/custom-song-resources.ts","file:///home/circleci/bemuse/bemuse/src/sampling-master/ogg.ts","file:///home/circleci/bemuse/packages/bemuse-notechart/lib/index.js","file:///home/circleci/bemuse/bemuse/src/game/display/touch3d.js","file:///home/circleci/bemuse/bemuse/src/game/ui/GameShellScene.scss?eb61","file:///home/circleci/bemuse/bemuse/src/game/ui/GameShellScene.scss","file:///home/circleci/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.jsx","file:///home/circleci/bemuse/bemuse/src/devtools/benchmark.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/setimmediate@1.0.5/node_modules/setimmediate/setImmediate.js","file:///home/circleci/bemuse/bemuse/src/scene-manager/index.js","file:///home/circleci/bemuse/bemuse/src/game/ui/GameShellScene.jsx","file:///home/circleci/bemuse/bemuse/src/game/index.js","file:///home/circleci/bemuse/packages/bms/lib/reader/index.web.js","file:///home/circleci/bemuse/packages/bms/lib/reader/getReaderOptionsFromFilename.js","file:///home/circleci/bemuse/packages/bms/lib/compiler/index.js","file:///home/circleci/bemuse/packages/bms/lib/reader/types.js","file:///home/circleci/bemuse/packages/bms/lib/speedcore/segment.js","file:///home/circleci/bemuse/packages/bms/lib/notes/index.js","file:///home/circleci/bemuse/packages/bms/lib/notes/note.js","file:///home/circleci/bemuse/packages/bms/lib/notes/channels.js","file:///home/circleci/bemuse/packages/bms/lib/timing/index.js","file:///home/circleci/bemuse/packages/bms/lib/song-info/index.js","file:///home/circleci/bemuse/packages/bms/lib/keysounds/index.js","file:///home/circleci/bemuse/packages/bms/lib/positioning/index.js","file:///home/circleci/bemuse/packages/bms/lib/spacing/index.js","file:///home/circleci/bemuse/bemuse/src/devtools/BemuseTestMode.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/webpack@4.46.0/node_modules/webpack/buildin/amd-define.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/webpack@4.46.0/node_modules/webpack/buildin/amd-options.js","file:///home/circleci/bemuse/packages/bemuse-notechart/lib/loader/BMSNotechartLoader.js","file:///home/circleci/bemuse/packages/bemuse-notechart/lib/types.js","file:///home/circleci/bemuse/bemuse/src/logger/index.ts","file:///home/circleci/bemuse/packages/bmson/lib/legacy.js","file:///home/circleci/bemuse/packages/bmson/lib/utils.js","file:///home/circleci/bemuse/bemuse/src/game/player.ts","file:///home/circleci/bemuse/bemuse/src/game/state/player-stats.ts","file:///home/circleci/bemuse/bemuse/src/game/display/note-area.js","file:///home/circleci/bemuse/bemuse/src/game/display/Gauge.js","file:///home/circleci/bemuse/bemuse/src/utils/formatTime.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/punycode@1.4.1/node_modules/punycode/punycode.js","file:///home/circleci/bemuse/bemuse/src/omni-input/midi.js","file:///home/circleci/bemuse/bemuse/src/omni-input/axis-logic.ts","file:///home/circleci/bemuse/bemuse/src/omni-input/index.js","file:///home/circleci/bemuse/bemuse/src/game/input/control.ts","file:///home/circleci/bemuse/bemuse/src/game/input/index.ts","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/timesynchro@1.0.1/node_modules/timesynchro/client.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/timesynchro@1.0.1/node_modules/timesynchro/timesync.js","file:///home/circleci/bemuse/packages/bms/lib/bms/chart.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/path-browserify@0.0.1/node_modules/path-browserify/index.js","file:///home/circleci/bemuse/bemuse/src/resources/bemuse-package.ts","file:///home/circleci/bemuse/bemuse/src/keysound-cache/index.js","file:///home/circleci/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss?b96a","file:///home/circleci/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss","file:///home/circleci/bemuse/bemuse/src/game/state/player-state.ts","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/keycode@2.2.1/node_modules/keycode/index.js","file:///home/circleci/bemuse/bemuse/src/game/display/player-display.js","file:///home/circleci/bemuse/bemuse/src/resources/dnd-resources.ts","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/classnames@2.3.2/node_modules/classnames/index.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/url@0.11.0/node_modules/url/util.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/querystring-es3@0.2.1/node_modules/querystring-es3/index.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/querystring-es3@0.2.1/node_modules/querystring-es3/decode.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/querystring-es3@0.2.1/node_modules/querystring-es3/encode.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/bluebird@3.7.2/node_modules/bluebird/js/browser/bluebird.js","file:///home/circleci/bemuse/bemuse/src/resources/resolveRelativeResource.ts","file:///home/circleci/bemuse/bemuse/src/keysound-cache/createKeysoundCache.js","file:///home/circleci/bemuse/bemuse/src/game/audio/wave-factory.js","file:///home/circleci/bemuse/bemuse/src/ui/Scene.scss?2d8a","file:///home/circleci/bemuse/bemuse/src/ui/Scene.scss","file:///home/circleci/bemuse/packages/bemuse-notechart/lib/loader/index.js","file:///home/circleci/bemuse/packages/bemuse-notechart/lib/loader/BmsonNotechartLoader.js","file:///home/circleci/bemuse/packages/bmson/lib/index.js","file:///home/circleci/bemuse/packages/bmson/lib/types.js","file:///home/circleci/bemuse/bemuse/src/game/game.ts","file:///home/circleci/bemuse/bemuse/src/game/audio/player-audio.js","file:///home/circleci/bemuse/packages/bms/lib/speedcore/index.js","file:///home/circleci/bemuse/bemuse/src/game/state/index.ts","file:///home/circleci/bemuse/bemuse/src/game/input/touch-plugin.js","file:///home/circleci/bemuse/bemuse/src/game/display/index.js","file:///home/circleci/bemuse/bemuse/src/game/display/game-display.scss?e7b9","file:///home/circleci/bemuse/bemuse/src/game/display/game-display.scss","file:///home/circleci/bemuse/bemuse/src/game/display/background/default.jpg","file:///home/circleci/bemuse/bemuse/src/game/display/touch-escape.png","file:///home/circleci/bemuse/bemuse/src/game/display/touch-replay.png","file:///home/circleci/bemuse/bemuse/src/game/display/touch-fullscreen.png","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/screenfull@3.3.3/node_modules/screenfull/dist/screenfull.js","file:///home/circleci/bemuse/bemuse/src/game/loaders/samples-loader.js","file:///home/circleci/bemuse/bemuse/src/game/judgments.ts","file:///home/circleci/bemuse/bemuse/src/progress/formatters.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/baconjs@0.7.95/node_modules/baconjs/dist/Bacon.js","file:///home/circleci/bemuse/bemuse/src/utils/read-blob.js","file:///home/circleci/bemuse/packages/bms/lib/util/lodash.js","file:///home/circleci/bemuse/bemuse/src/progress/utils.ts","file:///home/circleci/bemuse/packages/bms/lib/index.js","file:///home/circleci/bemuse/bemuse/src/ui/images/bg/a.jpg","file:///home/circleci/bemuse/bemuse/src/utils/main-element.js","file:///home/circleci/bemuse/bemuse/src/game/game-scene.js","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingScene.scss?81fc","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingScene.scss","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneSongInfo.scss?9b68","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneSongInfo.scss","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneProgress.scss?614d","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneProgress.scss","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneProgressBar.scss?92ac","file:///home/circleci/bemuse/bemuse/src/game/ui/LoadingSceneProgressBar.scss","file:///home/circleci/bemuse/bemuse/src/resources/url.ts"],"names":["url","getRetryDelay","Math","random","async","type","progress","shouldGiveUp","i","Promise","resolve","reject","xh","XMLHttpRequest","open","responseType","onload","status","response","Error","onerror","formatter","onprogress","e","report","loaded","total","send","error","console","waitMs","setTimeout","Object","defineProperty","exports","value","match","text","matched","when","pattern","callback","this","else","BMSHeaders","_data","_dataAll","prototype","each","get","name","toLowerCase","getAll","set","key","push","BMSObjects","_objects","add","object","channel","length","test","measure","fraction","all","slice","allSorted","list","sort","a","b","TimeSignatures","_values","getBeats","measureToBeat","sum","self","window","apply","Function","Timeout","id","clearFn","_id","_clearFn","call","scope","arguments","clearTimeout","setInterval","clearInterval","timeout","close","unref","ref","enroll","item","msecs","_idleTimeoutId","_idleTimeout","unenroll","_unrefActive","active","_onTimeout","setImmediate","global","clearImmediate","shouldShowOptions","BEMUSE_SHOW_OPTIONS","shouldEnableBenchmark","BEMUSE_BENCHMARK","shouldDisableFullScreen","BEMUSE_NO_FULLSCREEN","shouldShowAbout","BEMUSE_SHOW_ABOUT","shouldShowModeSelect","BEMUSE_SHOW_MODE_SELECT","isTitleDisplayMode","BEMUSE_TITLE_DISPLAY","constructor","game","samples","master","volume","options","soundVolume","_master","_context","audioContext","_players","Map","players","map","player","destroy","unmute","context","update","t","state","playerAudio","audio","_offset","_sum","realTime","now","delta","currentTime","shift","time","clock","input","_clock","_input","_now","synchronized","_lastRecordedTimeSinceStart","startTime","_pauseAtTimerValue","Infinity","_unpausedTimeSinceStart","_unpausedTimerValue","readyFraction","gettingStarted","started","_checkStartGame","_calculateTime","_getWait","ceil","pow","timeSinceStart","projectedTimerValue","min","pauseAt","timerValueToPause","DualInput","last","output","combine","exclusive","continuous","sensitivity","kbm","keyboard","scratch","isBtn8Free","values","indexOf","isBtn9Free","data","result","p1_1","p1_2","p1_3","p1_4","p1_5","p1_6","p1_7","p1_SC","p1_speedup","p1_speeddown","start","select","dispose","display","_audioInputLatency","audioInputLatency","_game","_display","_audio","_timer","_state","_promise","_resolvePromise","setEscapeHandler","_quitGame","setReplayHandler","_replayGame","initializeBenchmark","initializeTestModeHooks","promise","latestGameTime","_latestGameTime","_handleEscape","use","stopped","frame","_update","requestAnimationFrame","_endGameLoop","onKeyDown","keyCode","preventDefault","stopPropagation","addEventListener","finally","removeEventListener","done","finished","replay","A","enabled","benchmark","_instance","_renderer","BemuseTestMode","interval","unpause","getScore","stats","score","assets","filename","file","then","asset","read","arrayBuffer","Blob","blob","URL","createObjectURL","src","image","Image","load","spec","bms","songId","tasks","running","taskList","task","dependencies","f","run","deps","concat","getTaskStatuses","progressText","toString","bar","taskToWatch","watch","Scintillator","getSkinUrl","displayMode","skin","Context","touchEventTarget","current","loader","arraybuffer","notechart","eyecatchImageUrl","base","resolveRelativeResource","eyecatchImage","backImageUrl","backgroundImage","audioLoadProgress","audioDecodeProgress","videoUrl","includes","resolveUrl","video","document","createElement","canPlayType","onProgress","buffered","duration","end","finish","onCanPlayThrough","onError","n","element","offset","videoOffset","warn","preload","backgroundImagePromise","receiveSongId","loadFiles","Component","render","song","props","className","genre","title","subtitles","artist","subartists","propTypes","shape","string","arrayOf","difficulty","number","level","isRequired","style","width","oneOfType","renderItem","round","extra","componentDidMount","_unsubscribe","forceUpdate","componentWillUnmount","Scene","eyecatchImagePromise","findDOMNode","refs","eyecatch","appendChild","registerTeardownCallback","scene","classList","delay","func","Log","BemuseLogger","forModule","performance","Date","synchronize","server","onResult","err","info","o","Progress","undefined","_observable","notify","_callbacks","_value","init","_nextId","args","callbacks","AudioContext","latencyHint","onDragEnter","children","node","module","parse","format","formatThousandsRegExp","formatDecimalsRegExp","kb","mb","gb","tb","pb","parseRegExp","Number","isFinite","mag","abs","thousandsSeparator","unitSeparator","decimalPlaces","fixedDecimals","Boolean","unit","str","toFixed","replace","split","s","join","val","isNaN","floatValue","results","exec","parseFloat","parseInt","floor","FADE_LENGTH","dummyAudioTag","needsVorbisDecoder","SoundGroup","samplingMaster","_gain","createGain","gain","connect","destination","disconnect","Sample","audioBuffer","_buffer","play","PlayInstance","buffer","source","createBufferSource","onended","stop","group","_source","TEST_node","max","startOffset","fadeIn","fadeOutAt","setValueAtTime","linearRampToValueAtTime","_startPlaying","_stoppedPlaying","onstop","bad","playbackRate","unmuteAudio","ctx","osc","createOscillator","frequency","resume","resumeContext","catch","_audioContext","_samples","_groups","_instances","Set","_destination","_destroyed","sample","instance","decode","blobOrArrayBuffer","_coerceToArrayBuffer","_decodeAudio","blobOrArrayBufferOrAudioBuffer","numberOfChannels","ArrayBuffer","as","byteLength","view","Uint8Array","decodeAudioData","delete","addUnprefixed","prefix","parts","punycode","util","Url","protocol","slashes","auth","host","port","hostname","hash","search","query","pathname","path","href","urlParse","relative","resolveObject","obj","isString","protocolPattern","portPattern","simplePathPattern","unwise","autoEscape","nonHostChars","hostEndingChars","hostnamePartPattern","hostnamePartStart","unsafeProtocol","hostlessProtocol","slashedProtocol","querystring","parseQueryString","slashesDenoteHost","isObject","u","TypeError","queryIndex","splitter","uSplit","rest","trim","simplePath","substr","proto","lowerProto","atSign","hostEnd","hec","lastIndexOf","decodeURIComponent","parseHost","ipv6Hostname","hostparts","l","part","newpart","j","k","charCodeAt","validParts","notHost","bit","unshift","toASCII","p","h","ae","esc","encodeURIComponent","escape","qm","keys","stringify","charAt","rel","tkeys","tk","tkey","rkeys","rk","rkey","v","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","pop","isNullOrUndefined","authInHost","isNull","hasTrailingSlash","up","splice","isAbsolute","ResourceLogging","loggingFunction","log","setLoggingFunction","fn","forEach","CompressedFile","size","archiveRef","_name","_size","_path","_archiveRef","extract","extractSingleFile","static","_options","workerUrl","_worker","Worker","_workerMsg","bind","_content","_processed","_file","_postMessage","msg","hasEncryptedData","usePassword","archivePassword","passphrase","getFilesObject","entry","target","prop","_getProp","fileName","_cloneContent","getFilesArray","_objectToArray","File","fileData","extractFiles","extractCallback","terminate","files","cur","prev","postMessage","_msgHandler","ARCHIVE_REGEXP","DROPBOX_REGEXP","provider","_logging","_files","getFiles","fileEntry","out","archive","extracted","traverse","tree","unarchive","unarchiveIfNeeded","fileList","downloadFileEntryFromURL","lastTime","download","decoderPromise","limit","decodeOGG","stbvorbis","ns","default","eval","buffers","sampleRate","totalLength","eof","decodedChunks","createBuffer","channels","Array","fill","_","ch","ChannelDataWriter","getChannelData","chunk","audioSamples","channelIndex","write","doDecodeOGG","__createBinding","create","m","k2","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","__exportStar","hasOwnProperty","__values","Symbol","iterator","next","__importDefault","mod","Notechart","lodash_1","invariant_1","playerOptions","_this","bmsNotes","notes","timing","keysounds","songInfo","positioning","spacing","barLines","images","expertJudgmentWindow","_a","landmineNotes","_preTransform","_timing","_positioning","_spacing","_keysounds","_duration","_notes","_generatePlayableNotesFromBMS","_landmines","_autos","_generateAutoKeysoundEventsFromBMS","_barLines","_generateBarLineEvents","_generateKeysoundFiles","_infos","note","_getNoteInfo","_songInfo","_images","background","beatToSeconds","beat","beatToPosition","position","secondsToBeat","seconds","secondsToPosition","bpmAtBeat","scrollSpeedAtBeat","speed","spacingAtBeat","factor","getKeyMode","e_1","usedColumns","_b","_c","column","e_1_1","return","chain","e_4","bmsNotes_1","bmsNotes_1_1","e_4_1","getKeys","assign","columnsToShift_1","shiftNote","amount","index","newIndex","newColumn","nextId","filter","_generateEvent","keysound","keysoundStart","keysoundEnd","_updateDuration","endBeat","_generateLandminesFromBMS","event","e_2","e_3","autos","_d","array","array_1","array_1_1","event_","e_3_1","e_2_1","from","beats","combos","config","getRow","excess","theta","pointX","cos","pointY","sin","projection","y","PLAY_AREA_WIDTH","getTouchedColumn","x","mid","row","x0","x1","pos","String","content","transform","locals","super","renderTable","bench","stat","align","handleInteraction","setState","show","onClick","onTouchStart","Stat","count","average","hist","lastSec","secAvg","wrap","lines","div","setAttribute","body","registerImmediate","html","messagePrefix","onGlobalMessage","nextHandle","tasksByHandle","currentlyRunningATask","doc","attachTo","getPrototypeOf","process","handle","nextTick","runIfPresent","importScripts","postMessageIsAsynchronous","oldOnMessage","onmessage","canUsePostMessage","MessageChannel","port1","port2","documentElement","script","onreadystatechange","removeChild","attachEvent","_transitioning","_stack","_transitionTo","previousScene","currentScene","getNextScene","currentSceneInstance","teardown","parentNode","detach","currentElement","ReactScene","ReactSceneContainer","container","clonedElement","cloneElement","elementToDisplay","try","unmountComponentAtNode","handleDrop","nativeEvent","resources","resource","code","handleItemClick","onSelect","handleClear","selectedResource","any","submit","bindOption","binder","handleDragOver","dropzone","handleSelectFile","onDragOver","onDrop","onSubmit","disabled","onChange","placement","checked","main","loadSpec","latency","autoplay","SC","SC2","displayShell","assetsUrl","metadata","getSong","LoadingScene","controller","getReaderOptionsFromFilename","readAsync","chardet","_i","charset","forceEncoding","detect","reader","FileReader","readAsText","getReaderOptionsFromFilename_1","compile","match_1","chart_1","matchers","if","endif","timeSignature","header","dtx","chart","BMSChart","rng","matcher","randomStack","skipStack","headerSentences","channelSentences","controlSentences","skippedSentences","malformedSentences","warnings","line","eachLine","lineNumber","flow","skipped","timeSignatures","items","objects","handleChannelSentence","headers","message","Segment","data_structure_1","dx","__setModuleDefault","__importStar","Notes","note_1","ChannelMapping","Note","fromBMSChart","mapping","CHANNEL_MAPPING","IIDX_P1","BMSNoteBuilder","build","_chart","_mapping","_activeLN","_lastNote","_lnObj","_channelMapping","_handle","_handleNormalNote","toUpperCase","_handleLongNote","_normalizeChannel","_getBeat","_getColumn","maybe","IIDX_DP_LANDMINE","IIDX_P1_LANDMINE","IIDX_DP","D1","D2","D3","D4","D5","D8","D9","D6","E1","E2","E3","E4","E5","E8","E9","E6","Timing","speedcore_1","precedence","bpm","initialBPM","actions","segments","inclusive","action","stopBeats","_speedcore","Speedcore","_eventBeats","uniq","segmentAtX","getEventBeats","SongInfo","extractSubtitle","Keysounds","_map","Positioning","previous","Spacing","_enabled","_lifecycleHandler","enableTestMode","overlay","innerHTML","setGameLifecycleHandler","handler","isTestModeEnabled","__webpack_amd_options__","BMS","__1","getJudgmentWindowFromBMS","rank","generateBarLinesFromBMS","currentBeat","currentMeasure","double","moduleName","bindLogger","toJSON","__read","r","ar","__spreadArray","to","pack","_slicesForNotesAndTiming","beatForLoc","timingInfoForBmson","barLinesForBmson","utils","bmson","sortBy","initBPM","bpmNotes","stopNotes","slicesForNotesAndTiming","beatForPulse","restart","notes_1","notes_1_1","c","lastAdded","soundTime","mustAdd","_e","has","autoplayEnabled","autosound","laneCover","gauge","tutorial","columns","getAccuracyScore","accuracy","getComboScore","totalCombo","totalNotes","combo","maxCombo","rawSumJudgmentWeight","rawTotalComboScore","_calculateRawTotalComboScore","_remainingMaxPossibleRawComboScore","rawSumComboScore","counts","numJudgments","poor","_log","deltas","accuracyScore","comboScore","maxPossibleScore","maxPossibleAccuracyScore","maxPossibleComboScore","remainingJudgments","maxPossibleAccuracy","maxPossibleRawComboScore","currentAccuracy","character","handleJudgment","judgment","rawComboScore","_calculateRawComboScore","_recordLog","handleDelta","_getLogCharacter","lower","upper","getVisibleNotes","headroom","entity","head","tail","height","getVisibleBarLines","getGauge","gaugeType","primary","secondary","playerState","getHope","max1","max2","hopeS","hopeA","shouldDisplay","getPrimary","getSecondary","getExtra","hopeGauge","root","nodeType","freeGlobal","maxInt","regexPunycode","regexNonASCII","regexSeparators","errors","stringFromCharCode","fromCharCode","RangeError","mapDomain","ucs2decode","counter","ucs2encode","digitToBasic","digit","flag","adapt","numPoints","firstTime","baseMinusTMin","basic","oldi","w","baseMinusT","codePoint","inputLength","bias","encode","handledCPCount","basicLength","q","currentValue","handledCPCountPlusOne","qMinusT","observeMidiAccess","access","fromBinder","sink","inputs","Next","outputs","onstatechange","never","fromEvent","fromPromise","navigator","requestMIDIAccess","flatMap","flatMapError","stack","doLog","AxisLogic","charge","positive","axis","threshold","immediateOutput","win","_window","_exclusive","_continuousAxis","setGamepadSensitivity","_disposables","listen","_handleKeyDown","_handleKeyUp","onValue","_handleMIDIMessage","_status","_axis","which","handleNote","bend","_updateGamepads","nav","gamepads","getGamepads","webkitGetGamepads","gamepad","_updateGamepad","buttons","button","axes","axisName","_deadzone","_sensitivity","_analogThreshold","setGamepadContinuousAxisEnabled","diff","difference","fromArray","knownMidiIds","getName","capitalize","midiNote","subject","eventName","listener","changed","justPressed","_controls","_plugins","changes","control","plugin","controlName","union","timesync","callback2","ws","WebSocket","clocks","emit","getTime","fields","convert","onclose","t1","t2","t3","t4","hp","headers_1","objects_1","time_signatures_1","normalizeArray","allowAboveRoot","xs","res","resolvedPath","resolvedAbsolute","cwd","normalize","trailingSlash","paths","arr","fromParts","toParts","samePartsLength","outputParts","sep","delimiter","dirname","hasRoot","matchedSlash","basename","ext","extname","startDot","startPart","preDotState","len","BemusePackageFileResource","getBlob","Ref","_basePromise","loadPayload","getPayload","metadataLength","_getMetadata","once","_base","_metadataFilename","JSON","_getRefs","_getFileMap","location","fallback","_fallback","_fallbackPattern","fallbackPattern","metadataFilename","simultaneous","resourcePromise","nextProgress","NoteStatus","notifications","sounds","judgments","tainted","_gameTime","_pinching","_columns","_noteBufferByColumn","groupBy","mapValues","startIndex","getNoteStatus","_noteResult","_judge","gameTime","_rawInput","_updateInputColumnMap","_judgeNotes","_updateSpeed","Unjudged","getNoteJudgment","getPlayerInput","_judgeColumn","_modifySpeed","pinch","pinching","direction","_shouldAutoplay","BEMUSE_AUTOPLAY","judgedNote","autoPlayed","_shouldJudge","shouldBreak","_judgeNote","freestyleNote","_getFreestyleNote","_isSandwiched","_getClosestNote","minBy","every","adjacentColumn","some","missed","hit","noteEnd","lifted","passed","isDown","isUp","Judged","Active","_setJudgment","searchInput","hasKeyCode","charCode","names","foundNamedKey","codes","aliases","isEventKey","nameOrCode","alias","skinData","_currentSpeed","_player","_noteArea","_stateful","_defaultData","key_mode","lane_lift","lane_press","_gauge","_touch3dMode","touch3dMode","noteArea","stateful","entities","getUpperBound","putNote","noteY","scale","columnIndex","areaWidth","xOffset","desiredWidth","longNoteStep","updateVisibleNotes","updateBarLines","updateInput","notification","deviationMode","updateJudgment","updateGauge","updateExplode","getCount","DndResources","dataTransfer","types","getData","startsWith","readItem","addFile","webkitGetAsEntry","readEntry","getAsFile","isFile","readFile","isDirectory","readDirectory","tap","dir","entries","createReader","readMore","readEntries","getFilesFromEvent","hasOwn","classNames","classes","arg","argType","isArray","inner","qs","eq","regexp","maxKeys","kstr","vstr","idx","stringifyPrimitive","objectKeys","ks","define","_dereq_","SomePromiseArray","_SomePromiseArray","promises","ret","setHowMany","setUnwrap","firstLineError","schedule","Queue","Async","_customScheduler","_isTickUsed","_lateQueue","_normalQueue","_haveDrainedQueues","drainQueues","_drainQueues","_schedule","_drainQueue","queue","_drainQueueStep","_settlePromises","receiver","setScheduler","hasCustomScheduler","haveItemsQueued","fatalError","isNode","stderr","exit","throwLater","invokeLater","_queueTick","invoke","settlePromises","_pushOne","_reset","INTERNAL","tryConvertToPromise","debug","calledBind","rejectThis","_reject","targetRejected","promiseRejectionQueued","bindingPromise","_then","bindingResolved","thisArg","_bitField","_resolveCallback","bindingRejected","_propagateFrom","propagateFromFunction","_boundValue","boundValueFunction","maybePromise","_target","_setBoundTo","_setOnCancel","_boundTo","_isBound","old","bluebird","noConflict","cr","callerCache","getterCache","canEvaluate","caller","methodName","classString","ensureMethod","namedGetter","indexedGetter","isIdentifier","propertyName","getter","maybeGetter","getGetter","PromiseArray","apiRejection","tryCatch","errorObj","_async","cancel","cancellation","_warn","child","_isCancellable","_cancelBy","_isFollowing","_followee","_cancelBranched","parent","_cancellationParent","_setWillBeCancelled","_branchHasCancelled","_branchesRemainingToCancel","_enoughBranchesHaveCancelled","canceller","_invokeOnCancel","_cancel","_setCancelled","_cancelPromises","_length","_unsetOnCancel","_onCancelField","isPending","_isCancelled","isCancellable","isCancelled","_doInvokeOnCancel","onCancelCallback","internalOnly","_attachExtraTrace","_resultCancelled","_onCancel","_invokeInternalOnCancel","NEXT_FILTER","instances","cb","boundTo","predicateLoop","matchesPredicate","longStackTraces","contextStack","_trace","CapturedTrace","peekContext","lastIndex","_promiseCreated","_pushContext","_popContext","_peekContext","trace","deactivateLongStackTraces","activateLongStackTraces","Promise_pushContext","Promise_popContext","Promise_PeekContext","Promise_peekContext","Promise_promiseCreated","enableAsyncHooks","disableAsyncHooks","unhandledRejectionHandled","possiblyUnhandledRejection","printWarning","deferUnhandledRejectionCheck","Warning","es5","canAttachTrace","bluebirdFramePattern","nodeFramePattern","parseLinePattern","stackFramePattern","formatStack","indentStackFrames","debugging","env","wForgottenReturn","unhandledRejectionCheck","_notifyUnhandledRejection","unhandledRejectionClear","suppressUnhandledRejections","_ensurePossibleRejectionHandled","_setRejectionIsUnhandled","_notifyUnhandledRejectionIsHandled","fireRejectionEvent","_setReturnedNonUndefined","_returnedNonUndefined","_isRejectionUnhandled","reason","_settledValue","_setUnhandledRejectionIsNotified","_unsetUnhandledRejectionIsNotified","_isUnhandledRejectionNotified","_unsetRejectionIsUnhandled","shouldUseOwnTrace","onPossiblyUnhandledRejection","_getContext","contextBind","onUnhandledRejectionHandled","disableLongStackTraces","longStackTracesIsSupported","Promise_captureStackTrace","_captureStackTrace","Promise_attachExtraTrace","Promise_dereferenceTrace","_dereferenceTrace","longStackTracesCaptureStackTrace","longStackTracesAttachExtraTrace","longStackTracesDereferenceTrace","hasLongStackTraces","legacyHandlers","unhandledrejection","before","onunhandledrejection","after","rejectionhandled","onrejectionhandled","fireDomEvent","dispatch","legacy","dispatchEvent","CustomEvent","domEvent","detail","cancelable","Event","createEvent","initCustomEvent","fireGlobalEvent","method","generatePromiseLifecycleEventObject","eventToObjectGenerator","promiseCreated","promiseFulfilled","promiseRejected","promiseResolved","promiseCancelled","promiseChained","warning","unhandledRejection","rejectionHandled","activeFireEvent","globalEventFired","domEventFired","defaultFireEvent","cancellationExecute","executor","onCancel","_attachCancellationCallback","cancellationAttachCancellationCallback","previousOnCancel","cancellationOnCancel","cancellationSetOnCancel","cancellationClearCancellationData","cancellationPropagateFrom","flags","branchesRemainingToCancel","opts","warningsOption","_clearCancellationData","_execute","monitoring","_fireEvent","nodeSupportsAsyncResource","asyncHooks","isFulfilled","ignoreSelf","_parent","attachExtraTrace","__stackCleaned__","parsed","parseStackAndMessage","notEnumerableProp","formatAndLogError","cleanStack","isTraceLine","isInternalFrame","shouldIgnore","stackFramesAsArray","isSoft","localHandler","localEventFired","formatNonError","maxChars","snip","captureStackTrace","parseLineInfoRegex","parseLineInfo","matches","_promisesCreated","uncycle","inherits","nodes","stackToIndex","cycleEdgeNode","currentChildLength","stacks","currentLastIndex","currentLastLine","commonRootMeetPoint","removeCommonRoots","removeDuplicateOrEmptyJumps","reconstructStack","v8stackFramePattern","v8stackFormatter","stackTraceLimit","ignoreUntil","hasStackAfterThrow","isTTY","color","checkForgottenReturns","returnValue","handlerLine","creatorLine","traceLines","lineMatches","firstUserLine","setBounds","lastLineError","firstFileName","lastFileName","firstStackLines","lastStackLines","firstIndex","deprecated","replacement","returner","thrower","thenReturn","thenThrow","catchThrow","_reason","caught","catchReturn","PromiseReduce","reduce","PromiseAll","promiseAllThis","mapSeries","_TypeError","_RangeError","Objectfreeze","freeze","subError","nameProperty","defaultMessage","SubError","CancellationError","TimeoutError","AggregateError","methods","OperationalError","cause","indent","errorTypes","RejectionError","isES5","getDescriptor","getOwnPropertyNames","propertyIsWritable","descriptor","ObjectKeys","PromiseMap","catchFilter","PassThroughHandlerContext","called","cancelPromise","FinallyHandlerCancelReaction","finallyHandler","checkCancel","succeed","fail","reasonOrValue","isFinallyHandler","isRejected","_passThrough","success","lastly","tapCatch","handlerOrPredicate","catchInstances","Proxyable","yieldHandlers","PromiseSpawn","generatorFunction","yieldHandler","internal","_finallyPromise","_generatorFunction","_receiver","_generator","_yieldHandlers","_yieldedPromise","_cancellationPhase","_isResolved","_cleanup","_fulfill","_promiseCancelled","coroutine","returnSentinel","_continue","_promiseFulfilled","_promiseRejected","_run","_rejectCallback","traceParent","promiseFromYieldHandler","bitField","_proxy","PromiseSpawn$","generator","spawn","addYieldHandler","spread","MappingPromiseArray","_filter","constructor$","_callback","_preservedValues","_limit","_inFlight","_queue","_asyncInit","concurrency","_init$","_init","preservedValues","_totalResolved","_resolve","booleans","_resolveFromSyncValue","attempt","maybeWrapAsError","rErrorKey","wrapAsOperationalError","isUntypedError","markAsOriginatingFromRejection","multiArgs","wrapped","spreadAdapter","nodeback","successAdapter","errorAdapter","newReason","asCallback","nodeify","adapter","makeSelfResolutionError","reflectHandler","PromiseInspection","UNDEFINED_BINDING","setReflectHandler","getDomain","domain","getContextDomain","AsyncResource","getContextAsyncHooks","getContext","APPLY","createContext","nodebackForPromise","check","_fulfillmentHandler0","_rejectionHandler0","_promise0","_receiver0","_resolveFromExecutor","deferResolve","deferReject","fillTypes","reflect","didFulfill","didReject","_setIsFinal","fulfillmentValue","rejectionReason","originatesFromRejection","getNewLibraryCopy","is","fromNode","fromCallback","_isFateSealed","_setAsyncGuaranteed","cast","_setFulfilled","fulfilled","rejected","internalData","haveInternalData","settler","_settlePromiseCtx","_settlePromiseLateCancellationObserver","_addCallbacks","_setLength","_setRejected","_setFollowing","_isFinal","_unsetCancelled","_setNoAsyncGuarantee","_receiverAt","_promiseAt","_fulfillmentHandlerAt","_rejectionHandlerAt","_migrateCallback0","follower","fulfill","_migrateCallbackAt","proxyable","shouldBind","_setFollowee","synchronous","ignoreNonErrorWarnings","ensureErrorObject","hasStack","_settlePromiseFromHandler","_settlePromise","isPromise","asyncGuaranteed","_settlePromise0","_clearCallbackDataAtIndex","_fulfillPromises","_rejectPromises","toStringTag","defer","pending","version","toFastProperties","resolveValueIfEmpty","asArray","_iterate","_resolveEmptyArray","toResolutionValue","getActualLength","shouldCopyValues","isResolved","THIS","withAppended","defaultPromisified","__isPromisified__","noCopyPropsPattern","RegExp","defaultFilter","propsFilter","isPromisified","hasPromisified","suffix","getDataPropertyOrDefault","promisifiableMethods","suffixRegexp","inheritedDataKeys","passesDefaultFilter","keyWithoutAsyncSuffix","checkValid","makeNodePromisified","makeNodePromisifiedEval","__","defaultThis","promisified","promisifyAll","promisifier","promisifiedKey","promisify","copyDescriptors","isClass","Es6Map","mapToEntries","extractEntry","PropertiesPromiseArray","isMap","_isMap","castValue","entriesToMap","keyOffset","capacity","_capacity","_front","_willBeOverCapacity","_checkCapacity","wrapMask","front","_resizeTo","oldCapacity","srcIndex","dst","dstIndex","arrayMove","race","ReductionPromiseArray","initialValue","_each","_fn","_initialValue","_currentCancellable","_eachValues","completed","valueOrReason","gotAccum","accum","_gotAccum","gotValue","_eachComplete","sender","_resultCancelled$","toggleScheduled","div2","NativePromise","getNativePromise","MutationObserver","GlobalSetImmediate","ProcessNextTick","isRecentNode","nativePromise","standalone","cordova","attributes","toggle","observe","SettledPromiseArray","_promiseResolved","inspection","_settledValueField","settle","allSettled","CANCELLATION","_howMany","_unwrap","_initialized","howMany","isArrayResolved","_canPossiblyFulfill","_getRangeError","_addFulfilled","_fulfilled","_addRejected","_checkOutcome","_rejected","__isCancelled","hasProp","doGetThen","getThen","isAnyBluebirdPromise","doThenable","HandleWrapper","afterValue","ms","successClear","failureClear","handleWrapper","afterTimeout","NULL","thenable","_isDisposable","_getDisposer","_setDisposable","castPreservingDisposable","tryDispose","Disposer","FunctionDisposer","maybeUnwrapDisposer","isDisposer","ResourceList","doDispose","_unsetDisposable","d","using","spreadArgs","disposer","reflectedResources","resultPromise","inspections","_disposer","tryCatchTarget","globalObject","tryCatcher","Child","Parent","T","isPrimitive","maybeError","safeToString","appendee","defaultValue","excludedPrototypes","isExcludedProto","visitedKeys","enumeration","thisAssignmentPattern","hasMethods","hasMethodsOtherThanConstructor","hasThisAssignmentAndStaticMethods","FakeConstructor","ic","foo","rident","filledRange","isError","ignore","ArrayFrom","itResult","it","hasEnvVariables","runInAsyncScope","versions","supportsAsync","P","resolveRelativeResources","dirName","DirectoryResources","_lastSongId","nextSongId","clear","isEmpty","isCached","soundName","cache","_exclusiveInstances","_group","playAuto","_play","playNote","playFree","_stopOldExclusiveSound","__awaiter","_arguments","step","__generator","g","label","sent","trys","ops","verb","op","NotechartLoader","BMSNotechartLoader","BmsonNotechartLoader","bluebird_1","coerceToBuffer","bufferOrArrayBuffer","Buffer","isBuffer","loadBmson","loadBMS","readerOptions","compileResult","Reader","Compiler","getExpertJudgmentWindowForBmson","judgeRank","judge_rank","songInfoForBmson","musicalScoreForBmson","stuff","eyecatch_image","back_image","keysForBmson","hasScratch","beatForPulseForBmson","init_bpm","bpm_events","stop_events","soundChannelsForBmson","sound_channels","soundChannel","bmsonInfo","chart_name","subtitle","getSubtitles","timingForBmson","nextKeysoundNumber","soundChannels","soundChannels_1","soundChannels_1_1","name_1","soundChannelNotes","sortedNotes","keysoundNumber","keysoundId","padStart","slices","sortedNotes_1","sortedNotes_1_1","getColumn","notesDataAndKeysoundsDataForBmsonAndTiming","legacy_1","resolution","soundChannels_2","soundChannels_2_1","e_5","e_6","hasKeys","hasSecondPlayer","hasDeluxeKeys","soundChannels_3","soundChannels_3_1","notes_2","notes_2_1","e_6_1","e_5_1","notecharts","autoplayer","waveFactory","_waveFactory","_played","_autosound","_playAutokeysounds","_playAutosounds","_handleSoundNotifications","auto","autosounds","_hitNote","soundNotifications","_breakNote","segment_1","_segments","_reached","targetFn","segment","_segmentAt","X","segmentAtT","timer","BUTTONS","StatsRecorder","BEMUSE_TOUCH_STATS","record","localStorage","scratchStartY","scratchY","getInput","getScratch","_expand","getBounds","contains","getButton","bounds","getPinch","pinchThreshold","statsRecorder","lane","rectangle","newRect","clone","createTouchButton","onclick","_wrapper","_createWrapper","panelPlacement","infoPanelPosition","_createTouchEscapeButton","_createFullScreenButton","_escapeHintShown","escapeHandler","_onEscape","replayHandler","_onReplay","_started","gameState","_getData","_updateStatefulData","_synchronizeVideo","_synchronizeTutorialEscapeHint","_video","_videoStarted","_videoOffset","_escapeHint","_getReady","_getSongTime","playerDisplay","playerData","$wrapper","attr","append","find","addClass","appendTo","touchButtons","wrapper","addTouchButton","escapeHint","textContent","request","isCommonjs","keyboardAllowed","Element","fnMap","eventNameMap","change","fullscreenchange","fullscreenerror","screenfull","elem","requestFullscreen","userAgent","ALLOW_KEYBOARD_INPUT","exitFullscreen","isFullscreen","onchange","on","off","raw","defineProperties","fullscreenElement","fullscreenEnabled","keysoundCache","_assets","_keysoundCache","loadProgress","decodeProgress","ondecode","_loadSample","fromPairs","_getFile","_decode","Judgment","UNJUDGED","MISSED","Missed","NORMAL_TIMEGATES","timegate","endTimegate","TRANSITIONAL_BEGINNER_LV5_TIMEGATES","TRANSITIONAL_BEGINNER_LV4_TIMEGATES","TRANSITIONAL_BEGINNER_LV3_TIMEGATES","ABSOLUTE_BEGINNER_TIMEGATES","FixedTimegatesJudge","timegates","getTimegates","_noteTime","TutorialJudge","noteTime","NORMAL_JUDGE","getJudgeForNotechart","insane","judgeTimeWith","judge","judgeTime","judgeEndTime","isBad","breaksCombo","weight","BYTES_FORMATTER","PERCENTAGE_FORMATTER","EXTRA_FORMATTER","_slice","Bacon","Exception","nop","former","assert","condition","assertObservableIsProperty","_isObservable","_isProperty","assertFunction","isFunction","isObservable","assertNoArguments","extend","inherit","ctor","symbol","indexWhere","always","negate","empty","filtered","toArray","without","remove","fold","seed","ys","cached","None","_isNone","me","recursionDepth","UpdateBarrier","rootEvent","waiterObs","waiters","aftersStack","aftersStackHeight","flushed","ensureStackHeight","afterTransaction","obs","stackIndexForThisObs","containsObs","processAfters","aftersList","stackSizeAtStart","topOfStack","topAfters","_topAfters$index","callSuccess","flushWaiters","obsId","obsWaiters","flushDepsOf","dep","internalDeps","whenDoneWith","hasWaiters","inTransaction","flush","currentEventId","wrappedSubscribe","unsubd","shouldUnsub","doUnsub","unsub","dispatcher","subscribe","noMore","Source","sync","lazy","ConsumingSource","BufferingSource","Desc","_isSource","markEnded","ended","consume","mayHave","hasAtLeast","flatten","isTrigger","_isEventStream","fromObservable","_isDesc","findDeps","describe","_len","_key","withDesc","withMethodCallSupport","_len2","_key2","makeFunctionArgs","makeFunction_","partiallyApplied","applied","_len3","_key3","toFieldExtractor","partFuncs","fieldValue","toSimpleExtractor","isFieldKey","_len4","_key4","makeFunction","convertArgsToFunction","sampled","sampledBy","_ref","_ref2","toCombinator","toFieldKey","left","right","Some","_isSome","getOrElse","isDefined","inspect","toOption","more","eventIdCounter","valueF","eager","_isNext","valueInternal","Initial","End","_isEvent","isEvent","isEnd","isInitial","isNext","hasValue","fmap","_isInitial","toNext","initialEvent","nextEvent","endEvent","toEvent","idCounter","registerObs","Observable","initialDesc","CompositeUnsubscribe","ss","unsubscribe","unsubscribed","subscriptions","starting","Dispatcher","_subscribe","_handleEvent","handleEvent","pushing","prevError","unsubSrc","EventStream","subscribeInternal","onValues","onEnd","withDescription","subscription","_this2","iterable","hasSubscribers","removeSub","pushIt","pushToSubscriptions","tmp","sub","unsubscribeFromSource","toProperty","initValue_","initValue","disp","Property","initSent","subbed","reply","sendInit","toEventStream","withHandler","usage","sources","pats","patterns","patSources","constantToFunction","pat","ixs","triggerFound","ix","needsBarrier","containsDuplicateDeps","resultStream","triggers","ends","i1","cannotSync","cannotMatch","nonFlattened","trigger","unsubAll","flushLater","flushWhileTriggers","events","i2","_p","observables","checkObservable","PropertyDispatcher","property","currentValueRootId","propertyEnded","groupSimultaneous","_len5","streams","_key5","_len6","_key6","maybeSubSource","_this3","dispatchingId","valId","_this4","_this5","constant","eventTransformer","unbound","shouldUnbind","unbind","unbinder","_len7","_key7","_len8","_key8","argumentsToObservables","argumentsToObservablesAndFunction","combineAsArray","stream","_len9","_key9","combineWith","_argumentsToObservablesAndFunction","other","combinator","withStateMachine","initState","fromF","newState","equals","isNone","skipDuplicates","isEqual","awaiting","not","and","or","scheduler","bufferWithTime","bufferWithTimeOrCount","MAX_VALUE","bufferWithCount","flushOrSchedule","onInput","onFlush","scheduled","valuesToPush","_this6","delayMs","_this7","_len10","_key10","unsubRight","unsubLeft","addPropertyInitValueToStream","concatAll","justInitValue","flatMap_","makeSpawner","flatMapFirst","makeObservable","firstOnly","rootDep","childDeps","composite","unsubMe","checkQueue","checkEnd","unsubRoot","Bus","subscribeAll","guardedSink","flatMapWithConcurrencyLimit","_len11","_key11","flatMapConcat","later","bufferingThrottle","minimumInterval","newSink","subscribeInput","_this8","unsubscribeInput","plug","_this9","assertObservable","rootPush","pushQueue","liftCallback","_len12","_key12","_len13","_key13","fromNodeCallback","_len14","_key14","combineTemplate","template","setValue","ctxStack","mkContext","containsObservables","funcs","applyStreamValue","newContext","pushContext","compileTemplate","constantValue","resultProperty","rootContext","mapEnd","skipErrors","takeUntil","stopper","endMarker","_event$value","flatMapLatest","delayChanges","debounce","debounceImmediate","cases","scan","_this10","acc","initHandled","prevTuple","tuple","doAction","doEnd","doError","_len15","_key15","endOnError","_len16","_key16","take","first","mapError","flatScan","updated","sampler","thisSource","samplerSource","_len17","_key17","eventMethods","valueAndEnd","fromEventTarget","_findHandlerMethods","pair","methodPair","addListener","findHandlerMethods","fromPoll","poll","abort","bound","keyF","limitF","similar","limited","assertArray","pushNeeded","holdWhen","valve","onHold","bufferedValues","srcIsEnded","subscribed","endIfBothEnded","toSend","$","asEventStream","selector","_this11","jQuery","Zepto","lastEvent","_len18","_key18","merge","assertEventStream","mergeAll","sinks","unsubBoth","repeatedly","repeat","subscribeNext","retry","retries","retriesDone","isRetryable","valueStream","pause","sequentially","skip","skipUntil","starter","skipWhile","ok","_len19","_key19","slidingWindow","minValues","spies","spy","ESObservable","observable","startWith","takeWhile","_len20","_key20","throttle","firstToPromise","PromiseCtr","_this12","toPromise","initial","lateBindFirst","_len22","_key22","_len21","_key21","zipAsArray","_len23","_key23","zipWith","_len24","_key24","_len25","_key25","observablesAndFunction","zip","observerOrOnNext","onComplete","observer","complete","closed","toESObservable","fromESObservable","readAsArrayBuffer","lodash_uniq_1","lodash_map_1","lodash_values_1","lodash_assign_1","fixed","atomic","hasByteLength","wrapPromise","querySelector","GameScene","disableContextMenu","resize","innerWidth","innerHeight","yOffset","marginTop","showCanvas","URLResource","URLResources"],"mappings":"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","file":"build/game-ec5db56bed107a0da2a4.js","sourcesContent":["import { BYTES_FORMATTER } from 'bemuse/progress/formatters'\n\n// Downloads the file from the URL.\n// The download will not actually be started unless the ``as()`` method\n// is called.\n//\n// .. js:function:: as(type)\n//\n//    Initiates the download as ``type``. The ``type`` is a string such as\n//    \"arraybuffer\" or \"blob\".\nexport function download(\n  url,\n  { getRetryDelay = () => 1000 + Math.random() * 4000 } = {}\n) {\n  return {\n    async as(type, progress) {\n      let shouldGiveUp = false\n      for (let i = 1; ; i++) {\n        try {\n          return await attempt()\n        } catch (error) {\n          console.error(`Unable to download ${url} [attempt ${i}]`, error)\n          if (i >= 3 || shouldGiveUp) throw error\n          const waitMs = getRetryDelay()\n          await new Promise((resolve) => setTimeout(resolve, waitMs))\n        }\n      }\n      function attempt() {\n        return new Promise((resolve, reject) => {\n          var xh = new XMLHttpRequest()\n          xh.open('GET', url, true)\n          xh.responseType = type\n          xh.onload = () => {\n            if (+xh.status === 200) {\n              resolve(xh.response)\n            } else {\n              if (+xh.status === 403 || +xh.status === 404) {\n                shouldGiveUp = true\n              }\n              reject(new Error(`Unable to download ${url}: HTTP ${xh.status}`))\n            }\n          }\n          xh.onerror = () => reject(new Error(`Unable to download ${url}`))\n          if (progress) {\n            progress.formatter = BYTES_FORMATTER\n            xh.onprogress = (e) => progress.report(e.loaded, e.total)\n          }\n          xh.send(null)\n        })\n      }\n    },\n  }\n}\n\nexport default download\n","// !! avoid external dependencies since this is used in boot script!\n\nimport { Progress } from './Progress'\nexport default Progress\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.match = void 0;\nfunction match(text) {\n    var matched = false;\n    return {\n        when: function (pattern, callback) {\n            if (matched)\n                return this;\n            var match = text.match(pattern);\n            if (match) {\n                matched = true;\n                callback(match);\n            }\n            return this;\n        },\n        else: function (callback) {\n            if (matched)\n                return this;\n            callback();\n        },\n    };\n}\nexports.match = match;\n//# sourceMappingURL=match.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSHeaders = void 0;\n/**\n * A BMSHeader holds the header information in a BMS file, such as\n * `#TITLE`, `#ARTIST`, or `#BPM`.\n *\n * You get retrieve a header using the `get()` method:\n *\n * ```js\n * chart.headers.get('title')\n * ```\n *\n * For some header fields that may contain multiple values, such as `#SUBTITLE`,\n * you can get them all using `getAll()`:\n *\n * ```js\n * chart.headers.getAll()\n * ```\n */\nvar BMSHeaders = /** @class */ (function () {\n    function BMSHeaders() {\n        this._data = {};\n        this._dataAll = {};\n    }\n    /**\n     * Iterates through each header field using a callback function.\n     * @param callback will be called for each header field\n     */\n    BMSHeaders.prototype.each = function (callback) {\n        for (var i in this._data) {\n            callback(i, this._data[i]);\n        }\n    };\n    /**\n     * Retrieves the header fields latest value.\n     * @param name fields name\n     * @return the fields latest value\n     */\n    BMSHeaders.prototype.get = function (name) {\n        return this._data[name.toLowerCase()];\n    };\n    /**\n     * Retrieves the header fields values.\n     * This is useful when a header field is specified multiple times.\n     * @param name fields name\n     */\n    BMSHeaders.prototype.getAll = function (name) {\n        return this._dataAll[name.toLowerCase()];\n    };\n    /**\n     * Sets the header fields value.\n     * @param name fields name\n     * @param value fields value\n     */\n    BMSHeaders.prototype.set = function (name, value) {\n        var key = name.toLowerCase();\n        this._data[key] = value;\n        (this._dataAll[key] || (this._dataAll[key] = [])).push(value);\n    };\n    return BMSHeaders;\n}());\nexports.BMSHeaders = BMSHeaders;\n//# sourceMappingURL=headers.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSObjects = void 0;\n/**\n * BMSObjects holds a collection of objects inside a BMS notechart.\n */\nvar BMSObjects = /** @class */ (function () {\n    function BMSObjects() {\n        this._objects = [];\n    }\n    /**\n     * Adds a new object to this collection.\n     * If an object already exists on the same channel and position,\n     * the object is replaced (except for autokeysound tracks).\n     * @param object the object to add\n     */\n    BMSObjects.prototype.add = function (object) {\n        if (object.channel !== '01') {\n            for (var i = 0; i < this._objects.length; i++) {\n                var test = this._objects[i];\n                if (test.channel === object.channel &&\n                    test.measure === object.measure &&\n                    test.fraction === object.fraction) {\n                    this._objects[i] = object;\n                    return;\n                }\n            }\n        }\n        this._objects.push(object);\n    };\n    /**\n     * Returns an array of all objects.\n     */\n    BMSObjects.prototype.all = function () {\n        return this._objects.slice();\n    };\n    /**\n     * Returns a sorted array of all objects.\n     */\n    BMSObjects.prototype.allSorted = function () {\n        var list = this.all();\n        list.sort(function (a, b) {\n            return a.measure + a.fraction - (b.measure + b.fraction);\n        });\n        return list;\n    };\n    return BMSObjects;\n}());\nexports.BMSObjects = BMSObjects;\n//# sourceMappingURL=objects.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TimeSignatures = void 0;\n/**\n * A TimeSignatures is a collection of time signature values\n * index by measure number.\n *\n * The measure number starts from 0.\n * By default, each measure has a measure size of 1\n * (which represents the common 4/4 time signature)\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #00102:0.75\n * #00103:1.25\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can access the {TimeSignatures} object:\n *\n * ```js\n * var timeSignatures = bmsChart.timeSignatures\n * ```\n *\n * Note that you can also use the constructor\n * to create a {TimeSignatures} from scratch.\n *\n * One of the most useful use case of this class\n * is to convert the measure and fraction into beat number.\n *\n * ```js\n * timeSignatures.measureToBeat(0, 0.000) // =>  0.0\n * timeSignatures.measureToBeat(0, 0.500) // =>  2.0\n * timeSignatures.measureToBeat(1, 0.000) // =>  4.0\n * timeSignatures.measureToBeat(1, 0.500) // =>  5.5\n * timeSignatures.measureToBeat(2, 0.000) // =>  7.0\n * timeSignatures.measureToBeat(2, 0.500) // =>  9.5\n * timeSignatures.measureToBeat(3, 0.000) // => 12.0\n * ```\n */\nvar TimeSignatures = /** @class */ (function () {\n    function TimeSignatures() {\n        this._values = {};\n    }\n    /**\n     * Sets the size of a specified measure.\n     * @param measure the measure number, starting from 0\n     * @param value the measure size.\n     *  For example, a size of 1.0 represents a common 4/4 time signature,\n     *  whereas a size of 0.75 represents the 3/4 or 6/8 time signature.\n     */\n    TimeSignatures.prototype.set = function (measure, value) {\n        this._values[measure] = value;\n    };\n    /**\n     * Retrieves the size of a specified measure.\n     * @param measure representing the measure number.\n     * @returns the size of the measure.\n     *  By default, a measure has a size of 1.\n     */\n    TimeSignatures.prototype.get = function (measure) {\n        return this._values[measure] || 1;\n    };\n    /**\n     * Retrieves the number of beats in a specified measure.\n     *\n     * Since one beat is equivalent to a quarter note in 4/4 time signature,\n     * this is equivalent to `(timeSignatures.get(measure) * 4)`.\n     * @param measure representing the measure number.\n     * @returns the size of the measure in beats.\n     */\n    TimeSignatures.prototype.getBeats = function (measure) {\n        return this.get(measure) * 4;\n    };\n    /**\n     * Converts a measure number and a fraction inside that measure\n     * into the beat number.\n     *\n     * @param measure the measure number.\n     * @param fraction the fraction of a measure,\n     * @returns the number of beats since measure 0.\n     */\n    TimeSignatures.prototype.measureToBeat = function (measure, fraction) {\n        var sum = 0;\n        for (var i = 0; i < measure; i++)\n            sum += this.getBeats(i);\n        return sum + this.getBeats(measure) * fraction;\n    };\n    return TimeSignatures;\n}());\nexports.TimeSignatures = TimeSignatures;\n//# sourceMappingURL=index.js.map","var scope = (typeof global !== \"undefined\" && global) ||\n            (typeof self !== \"undefined\" && self) ||\n            window;\nvar apply = Function.prototype.apply;\n\n// DOM APIs, for completeness\n\nexports.setTimeout = function() {\n  return new Timeout(apply.call(setTimeout, scope, arguments), clearTimeout);\n};\nexports.setInterval = function() {\n  return new Timeout(apply.call(setInterval, scope, arguments), clearInterval);\n};\nexports.clearTimeout =\nexports.clearInterval = function(timeout) {\n  if (timeout) {\n    timeout.close();\n  }\n};\n\nfunction Timeout(id, clearFn) {\n  this._id = id;\n  this._clearFn = clearFn;\n}\nTimeout.prototype.unref = Timeout.prototype.ref = function() {};\nTimeout.prototype.close = function() {\n  this._clearFn.call(scope, this._id);\n};\n\n// Does not start the time, just sets up the members needed.\nexports.enroll = function(item, msecs) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = msecs;\n};\n\nexports.unenroll = function(item) {\n  clearTimeout(item._idleTimeoutId);\n  item._idleTimeout = -1;\n};\n\nexports._unrefActive = exports.active = function(item) {\n  clearTimeout(item._idleTimeoutId);\n\n  var msecs = item._idleTimeout;\n  if (msecs >= 0) {\n    item._idleTimeoutId = setTimeout(function onTimeout() {\n      if (item._onTimeout)\n        item._onTimeout();\n    }, msecs);\n  }\n};\n\n// setimmediate attaches itself to the global object\nrequire(\"setimmediate\");\n// On some exotic environments, it's not clear which object `setimmediate` was\n// able to install onto.  Search each possibility in the same order as the\n// `setimmediate` library.\nexports.setImmediate = (typeof self !== \"undefined\" && self.setImmediate) ||\n                       (typeof global !== \"undefined\" && global.setImmediate) ||\n                       (this && this.setImmediate);\nexports.clearImmediate = (typeof self !== \"undefined\" && self.clearImmediate) ||\n                         (typeof global !== \"undefined\" && global.clearImmediate) ||\n                         (this && this.clearImmediate);\n","import query from 'bemuse/utils/query'\n\nexport function shouldShowOptions() {\n  return query.BEMUSE_SHOW_OPTIONS === '1'\n}\n\nexport function shouldEnableBenchmark() {\n  return query.BEMUSE_BENCHMARK === '1'\n}\n\nexport function shouldDisableFullScreen() {\n  return query.BEMUSE_NO_FULLSCREEN === '1'\n}\n\nexport function shouldShowAbout() {\n  return query.BEMUSE_SHOW_ABOUT === '1'\n}\n\nexport function shouldShowModeSelect() {\n  return query.BEMUSE_SHOW_MODE_SELECT === '1'\n}\n\nexport function isTitleDisplayMode() {\n  return query.BEMUSE_TITLE_DISPLAY === '1'\n}\n","import PlayerAudio from './player-audio'\n\nexport class GameAudio {\n  constructor({ game, samples, master }) {\n    const volume = game.options.soundVolume\n    this._master = master\n    this._context = master.audioContext\n    this._players = new Map(\n      game.players.map((player) => [\n        player,\n        new PlayerAudio({ player, samples, master, volume }),\n      ])\n    )\n  }\n  destroy() {\n    this._master.destroy()\n  }\n  unmute() {\n    this._master.unmute()\n  }\n  get context() {\n    return this._context\n  }\n  update(t, state) {\n    for (let [player, playerAudio] of this._players) {\n      playerAudio.update(t, state.player(player))\n    }\n  }\n}\n\nexport default GameAudio\n","import now from 'bemuse/utils/now'\n\n// The game clock provides a high-accuracy time source for the game.\n//\n// We want our timing to be based on audio. If the audio lags, the time\n// clock should lag with the audio as well, in order to keep the game\n// time in sync with the background audio.\n//\n// But there is a problem on some browsers (Android):\n// ``AudioContext.currentTime`` is not precise. Therefore, we take the\n// average of the offset between system time (which is more precise)\n// and the audio time to compute a high-precision-and-accuracy time.\n//\nexport class Clock {\n  constructor(audio) {\n    audio.unmute() // kick start the currentTime of audio context\n\n    this._context = audio.context\n    this._offset = []\n    this._sum = 0\n    this.update()\n  }\n\n  // Updates the clock. This method should be called every frame.\n  update() {\n    let realTime = now() / 1000\n    let delta = realTime - this._context.currentTime\n    this._offset.push(delta)\n    this._sum += delta\n    while (this._offset.length > 60) {\n      this._sum -= this._offset.shift()\n    }\n\n    // The clock's time value, in seconds.\n    this.time = realTime - this._sum / this._offset.length\n  }\n}\n\nexport default Clock\n","import now from 'bemuse/utils/now'\n\n// The game timer keeps track of song progression in-game.\n// This class should be tied to the AudioContext.\n//\nexport class GameTimer {\n  constructor(clock, input) {\n    this._clock = clock\n    this._input = input\n    this._now = now.synchronized()\n    this._lastRecordedTimeSinceStart = 0\n    this.startTime = null\n    this._pauseAtTimerValue = Infinity\n    this._unpausedTimeSinceStart = 0\n    this._unpausedTimerValue = 0\n    this.readyFraction = 0\n    this.gettingStarted = false\n  }\n\n  // True if the game is started, false otherwise.\n  get started() {\n    return this.startTime !== null\n  }\n\n  // Updates the timer. This method should be called once in the game loop.\n  update() {\n    this._checkStartGame()\n    // The time, in seconds, since the start of the game.\n    this.time = this._calculateTime()\n  }\n\n  _checkStartGame() {\n    if (this.started) return\n    if (this._input.get('start').value) {\n      this.gettingStarted = true\n    }\n    if (this.gettingStarted && !this._input.get('start').value) {\n      this.startTime = this._clock.time + this._getWait()\n    }\n    if (!this.started) {\n      // The number in range 0...1 representing the progression in this second.\n      // When player presses the \"Start\" button, the game will wait for the\n      // next second before actually starting the game.\n      // Since the clock is synchronized globally, if player presses start\n      // in the same second, the game will start at the same time.\n      //\n      this.readyFraction = 1 - this._getWait()\n    }\n  }\n  _getWait() {\n    let t = this._now() / 1000\n    return Math.ceil(t) - t\n  }\n\n  _calculateTime() {\n    // When initializing the game, we suspend the timer at -0.333 seconds.\n    // Then, when the player starts the game, we slowly accelerate such that\n    // after 1 second, the timer approaches 0 seconds at normal speed.\n    // This is accomplished using some magic formula ;).\n    //\n    var delta = this.startTime === null ? 0 : this._clock.time - this.startTime\n    if (delta < 0) delta = 0\n    if (delta < 1) {\n      return (Math.pow(delta, 6) - 1) / 6 - 1 / 30\n    } else {\n      const timeSinceStart = delta - 31 / 30\n      this._lastRecordedTimeSinceStart = timeSinceStart\n      const projectedTimerValue =\n        this._unpausedTimerValue +\n        (timeSinceStart - this._unpausedTimeSinceStart)\n      return Math.min(projectedTimerValue, this._pauseAtTimerValue)\n    }\n  }\n  pauseAt(timerValueToPause) {\n    if (\n      this._unpausedTimerValue +\n        (this._lastRecordedTimeSinceStart - this._unpausedTimeSinceStart) >=\n      this._pauseAtTimerValue\n    ) {\n      this._unpausedTimerValue = this._pauseAtTimerValue\n      this._unpausedTimeSinceStart = this._lastRecordedTimeSinceStart\n    }\n    this._pauseAtTimerValue = timerValueToPause\n  }\n}\n\nexport default GameTimer\n","export class DualInput {\n  /*\n    A helper class for mapping two boolean inputs to a single integer output.\n    This provide robust and responsive output when quickly firing two inputs alternatively.\n  */\n\n  // input states -1: up, 0: off, 1: down, 2: hold\n  private input = [0, 0]\n  private last = 0\n  private output = 0\n\n  public combine(...input: [boolean, boolean]) {\n    for (let i = 0; i < 2; ++i) {\n      if (input[i] && this.input[i] <= 0) {\n        this.input[i] = 1\n        this.last = i\n      } else if (!input[i] && this.input[i] > 0) {\n        this.input[i] = -1\n      } else if (this.input[i] % 2 !== 0) {\n        this.input[i] += 1\n      }\n    }\n\n    if (this.input[0] === 1 || this.input[1] === 1) {\n      this.output = this.last === 0 ? 1 : -1\n    }\n\n    if (this.input[this.last] <= 0) {\n      this.output = 0\n    }\n\n    return this.output\n  }\n}\n","import { OmniInput } from 'bemuse/omni-input'\nimport { DualInput } from './dual-input'\n\nfunction OmniInputPlugin(game) {\n  const input = new OmniInput(window, {\n    exclusive: true,\n    continuous: game.players[0].options.input.continuous,\n    sensitivity: game.players[0].options.input.sensitivity,\n  })\n  let kbm = game.players[0].options.input.keyboard\n  const scratch = new DualInput()\n\n  // Don't use Btn8 or Btn9 if they are binded\n  // TODO: make start and select button bindable\n  const isBtn8Free = Object.values(kbm).indexOf('gamepad.0.button.8') < 0\n  const isBtn9Free = Object.values(kbm).indexOf('gamepad.0.button.9') < 0\n\n  return {\n    name: 'GameKBPlugin',\n    get() {\n      const data = input.update()\n\n      const result = {\n        p1_1: data[kbm['1'] || '83'],\n        p1_2: data[kbm['2'] || '68'],\n        p1_3: data[kbm['3'] || '70'],\n        p1_4: data[kbm['4'] || '32'],\n        p1_5: data[kbm['5'] || '74'],\n        p1_6: data[kbm['6'] || '75'],\n        p1_7: data[kbm['7'] || '76'],\n        p1_SC: scratch.combine(\n          data[kbm['SC'] || '65'],\n          data[kbm['SC2'] || '16']\n        ),\n        p1_speedup: data[38],\n        p1_speeddown: data[40],\n        start: data[13] || (isBtn9Free && data['gamepad.0.button.9']),\n        select: data[18] || (isBtn8Free && data['gamepad.0.button.8']),\n      }\n      if (result['start'] || result['select']) {\n        if (\n          result['p1_1'] ||\n          result['p1_3'] ||\n          result['p1_5'] ||\n          result['p1_7']\n        ) {\n          result['p1_speeddown'] = true\n        }\n        if (result['p1_2'] || result['p1_4'] || result['p1_6']) {\n          result['p1_speedup'] = true\n        }\n      }\n      return result\n    },\n    destroy() {\n      input.dispose()\n    },\n  }\n}\n\nexport default OmniInputPlugin\n","import bench from 'bemuse/devtools/benchmark'\n\nimport Clock from './clock'\nimport GameInput from './input'\nimport GameState from './state'\nimport GameTimer from './game-timer'\nimport OmniInputPlugin from './input/omni-input-plugin'\nimport TouchPlugin from './input/touch-plugin'\nimport * as BemuseTestMode from 'bemuse/devtools/BemuseTestMode'\n\n// The GameController takes care of communications between each game\n// component, and takes care of the Game loop.\nexport class GameController {\n  constructor({ game, display, audio }) {\n    this._audioInputLatency = game.options.audioInputLatency\n    this._game = game\n    this._display = display\n    this._audio = audio\n    this._clock = new Clock(this._audio)\n    this._input = new GameInput()\n    this._timer = new GameTimer(this._clock, this._input)\n    this._state = new GameState(game)\n    this._promise = new Promise((resolve) => (this._resolvePromise = resolve))\n    this._display.setEscapeHandler(() => this._quitGame())\n    this._display.setReplayHandler(() => this._replayGame())\n    this.initializeBenchmark()\n    this.initializeTestModeHooks()\n  }\n  get game() {\n    return this._game\n  }\n  get display() {\n    return this._display\n  }\n  get audio() {\n    return this._audio\n  }\n  get promise() {\n    return this._promise\n  }\n  get state() {\n    return this._state\n  }\n  get latestGameTime() {\n    return this._latestGameTime\n  }\n\n  // Initializes the game components and kickstarts the game loop.\n  start() {\n    this._handleEscape()\n    this._display.start()\n    this._input.use(new OmniInputPlugin(this._game))\n    this._input.use(new TouchPlugin(this._display.context))\n    let stopped = false\n    let frame = () => {\n      if (stopped) return\n      this._update()\n      requestAnimationFrame(frame)\n    }\n    requestAnimationFrame(frame)\n    this._endGameLoop = () => (stopped = true)\n  }\n\n  // Exits the game when escape is pressed.\n  _handleEscape() {\n    let onKeyDown = (e) => {\n      const ESCAPE_KEY = 27\n      const F1_KEY = 112\n      if (e.keyCode === ESCAPE_KEY) {\n        e.preventDefault()\n        e.stopPropagation()\n        this._quitGame()\n      } else if (e.keyCode === F1_KEY) {\n        e.preventDefault()\n        e.stopPropagation()\n        this._replayGame()\n      }\n    }\n    window.addEventListener('keydown', onKeyDown, true)\n    this._promise\n      .finally(function () {\n        window.removeEventListener('keydown', onKeyDown, true)\n      })\n      .done()\n  }\n\n  _quitGame() {\n    this._resolvePromise({ finished: false, replay: false })\n  }\n  _replayGame() {\n    this._resolvePromise({ finished: false, replay: true })\n  }\n\n  // Destroy the game.\n  destroy() {\n    this._endGameLoop()\n    this._audio.destroy()\n    this._input.destroy()\n    this._display.destroy()\n  }\n\n  _update() {\n    // >> game/loop\n    //\n    // Turn-Based Update Cycle\n    // -----------------------\n    // At each iteration of the game loop, each game component takes turn and\n    // update itself.  Each game component involved in this game loop should\n    // have a ``update(...)`` method, which takes care of updating itself.\n    // This is the only time the component will be mutable.\n    //\n    // Outside of the ``update`` method, a component should behave like an\n    // immutable object.  This allows us to have some sense of immutability\n    // without having to create new objects. See `the case for immutability`_.\n    //\n    // .. _the case for immutability: https://github.com/facebook/immutable-js/blob/d8d189ae7ea8965fee2ecc7320ebdc55e83eb6a1/README.md#the-case-for-immutability\n    //\n    // At each cycle, the following happens:\n    //\n    // - the Clock is updated to get the high-accuracy time\n    // - the Timer is updated to get the in-game time\n    // - the Input is updated to get button presses\n    // - the State is updated to react to button presses -- judging notes and\n    //   updating scores\n    // - the Audio is updated to emit sound based on the updated state\n    // - the Display is updated to render the game display based on the updated\n    //   state\n    //\n    this._clock.update()\n    this._input.update()\n    this._timer.update()\n    let t = this._timer.time\n    let A = this._audioInputLatency\n    this._latestGameTime = t\n    this._state.update(t - A, this._input, this._timer)\n    this._audio.update(t, this._state)\n    this._display.update(t - A, this._state)\n    if (this._state.finished && this._resolvePromise) {\n      this._resolvePromise({ finished: true })\n      this._resolvePromise = null\n    }\n  }\n\n  initializeBenchmark() {\n    if (!bench.enabled) return\n    bench.benchmark('update', this, '_update')\n    bench.benchmark('input_update', this._input, 'update')\n    bench.benchmark('state_update', this._state, 'update')\n    bench.benchmark('audio_update', this._audio, 'update')\n    bench.benchmark('display_update', this._display, 'update')\n    bench.benchmark('display_compute', this._display, '_getData')\n    bench.benchmark('display_push', this._display._context._instance, 'push')\n    bench.benchmark(\n      'display_render',\n      this._display._context._renderer,\n      'render'\n    )\n  }\n  initializeTestModeHooks() {\n    if (!BemuseTestMode.isTestModeEnabled()) return\n    BemuseTestMode.setGameLifecycleHandler({\n      pauseAt: (t) => {\n        this._timer.pauseAt(t)\n        return new Promise((resolve) => {\n          const interval = setInterval(() => {\n            if (this._timer.time >= t) {\n              clearInterval(interval)\n              resolve()\n            }\n          })\n        })\n      },\n      unpause: () => {\n        this._timer.pauseAt(Infinity)\n      },\n      getScore: () => {\n        const state = this._state\n        const playerState = state.player(state.game.players[0])\n        return playerState.stats.score\n      },\n    })\n  }\n}\n\nexport default GameController\n","export function loadImage(assets, filename) {\n  return assets\n    .file(filename)\n    .then((asset) => asset.read())\n    .then((arrayBuffer) => new Blob([arrayBuffer]))\n    .then((blob) => URL.createObjectURL(blob))\n    .then(\n      (src) =>\n        new Promise((resolve, reject) => {\n          const image = new Image()\n          image.onload = () => resolve(image)\n          image.onerror = reject\n          image.src = src\n        })\n    )\n}\n\nexport default loadImage\n","import NotechartLoader from 'bemuse-notechart/lib/loader'\nimport Progress from 'bemuse/progress'\nimport { atomic } from 'bemuse/progress/utils'\nimport SamplingMaster from 'bemuse/sampling-master'\nimport keysoundCache from 'bemuse/keysound-cache'\n\nimport * as Multitasker from './multitasker'\nimport Game, { GamePlayerOptionsInput } from '../game'\nimport GameAudio from '../audio'\nimport GameController from '../game-controller'\nimport GameDisplay from '../display'\nimport SamplesLoader from './samples-loader'\nimport loadImage from './loadImage'\nimport Notechart from 'bemuse-notechart'\nimport { IResources } from 'bemuse/resources/types'\nimport { resolveRelativeResources } from 'bemuse/resources/resolveRelativeResource'\n\ntype Tasks = {\n  Scintillator: TODO\n  Skin: TODO\n  SkinContext: TODO\n  Notechart: Notechart\n  EyecatchImage: HTMLImageElement\n  BackgroundImage: HTMLImageElement\n  SamplingMaster: SamplingMaster\n  Video: { element: HTMLVideoElement; offset: number } | null\n  Game: Game\n  GameDisplay: GameDisplay\n  Samples: TODO\n  GameAudio: GameAudio\n  GameController: GameController\n}\n\ntype Assets = IResources & {\n  progress?: {\n    current?: Progress\n    all?: Progress\n  }\n}\n\nexport type LoadSpec = {\n  assets: Assets\n  bms: TODO\n  songId: string\n  displayMode?: 'touch3d' | 'normal'\n  backImageUrl?: string\n  eyecatchImageUrl?: string\n  videoUrl?: string\n  videoOffset?: number\n  options: GamePlayerOptionsInput\n}\n\nexport function load(spec: LoadSpec) {\n  const assets = spec.assets\n  const bms = spec.bms\n  const songId = spec.songId\n\n  return Multitasker.start<Tasks, GameController>(function (task, run) {\n    task('Scintillator', 'Loading game engine', [], function (progress) {\n      return atomic(\n        progress,\n        import(/* webpackChunkName: 'gameEngine' */ 'bemuse/scintillator')\n      )\n    })\n\n    task(\n      'Skin',\n      'Loading skin',\n      ['Scintillator'],\n      function (Scintillator, progress) {\n        return Scintillator.load(\n          Scintillator.getSkinUrl({\n            displayMode: spec.displayMode,\n          }),\n          progress\n        )\n      }\n    )\n\n    task(\n      'SkinContext',\n      null,\n      ['Scintillator', 'Skin'],\n      function (Scintillator, skin) {\n        return new Scintillator.Context(skin, { touchEventTarget: window })\n      }\n    )\n\n    if (assets.progress) {\n      if (assets.progress.current) {\n        task.bar('Loading package', assets.progress.current)\n      }\n      if (assets.progress.all) {\n        task.bar('Loading song packages', assets.progress.all)\n      }\n    }\n\n    task('Notechart', 'Loading ' + spec.bms.name, [], async (progress) => {\n      let loader = new NotechartLoader()\n      let arraybuffer = await bms.read(progress)\n      return loader.load(arraybuffer, spec.bms, spec.options.players[0])\n    })\n\n    task('EyecatchImage', null, ['Notechart'], function (notechart) {\n      if (spec.eyecatchImageUrl) {\n        const [base, filename] = resolveRelativeResources(\n          assets,\n          spec.eyecatchImageUrl\n        )\n        return loadImage(base, filename)\n      }\n      return loadImage(assets, notechart.eyecatchImage)\n    })\n\n    task('BackgroundImage', null, ['Notechart'], function (notechart) {\n      if (spec.backImageUrl) {\n        const [base, filename] = resolveRelativeResources(\n          assets,\n          spec.backImageUrl\n        )\n        return loadImage(base, filename)\n      }\n      return loadImage(assets, notechart.backgroundImage)\n    })\n\n    let audioLoadProgress = new Progress()\n    let audioDecodeProgress = new Progress()\n\n    task.bar('Loading audio', audioLoadProgress)\n    task.bar('Decoding audio', audioDecodeProgress)\n\n    task('SamplingMaster', null, [], async () => {\n      return new SamplingMaster()\n    })\n\n    task(\n      'Video',\n      spec.videoUrl ? 'Loading video' : null,\n      ['Notechart'],\n      async function (notechart, progress) {\n        if (!spec.videoUrl) return Promise.resolve(null)\n        let videoUrl = spec.videoUrl\n        if (!videoUrl.includes('://')) {\n          // This is a relative URL, we need to load from assets.\n          const [base, filename] = resolveRelativeResources(assets, videoUrl)\n          const file = await base.file(filename)\n          videoUrl = await file.resolveUrl()\n        }\n        return new Promise((resolve, reject) => {\n          const video = document.createElement('video')\n          if (!video.canPlayType('video/webm')) return resolve(null)\n          video.src = videoUrl\n          video.preload = 'auto'\n          video.addEventListener('progress', onProgress, true)\n          video.addEventListener('canplaythrough', onCanPlayThrough, true)\n          video.addEventListener('error', onError, true)\n          video.addEventListener('abort', onError, true)\n          video.load()\n\n          function onProgress() {\n            if (video.buffered && video.buffered.length && video.duration) {\n              progress.report(\n                video.buffered.end(0) - video.buffered.start(0),\n                video.duration\n              )\n            }\n          }\n          function finish() {\n            video.removeEventListener('progress', onProgress, true)\n            video.removeEventListener('canplaythrough', onCanPlayThrough, true)\n            video.removeEventListener('error', onError, true)\n            video.removeEventListener('abort', onError, true)\n          }\n          function onCanPlayThrough() {\n            finish()\n            const n = video.duration || 100\n            progress.report(n, n)\n            resolve({ element: video, offset: spec.videoOffset! })\n          }\n          function onError() {\n            finish()\n            console.warn('Cannot load video... Just skip it!')\n            resolve(null)\n          }\n        })\n      }\n    )\n\n    task('Game', null, ['Notechart'], async (notechart) => {\n      return new Game([notechart], spec.options)\n    })\n\n    task(\n      'GameDisplay',\n      null,\n      ['Game', 'SkinContext', 'Video'],\n      async (game, context, video) => {\n        return new GameDisplay({\n          game,\n          context,\n          backgroundImagePromise: run('BackgroundImage'),\n          video,\n        })\n      }\n    )\n\n    task('Samples', null, ['SamplingMaster', 'Game'], function (master, game) {\n      keysoundCache.receiveSongId(songId)\n      const samplesLoader = new SamplesLoader(assets, master)\n      return samplesLoader.loadFiles(\n        game.samples,\n        audioLoadProgress,\n        audioDecodeProgress\n      )\n    })\n\n    task(\n      'GameAudio',\n      null,\n      ['Game', 'Samples', 'SamplingMaster'],\n      async (game, samples, master) => {\n        return new GameAudio({ game, samples, master })\n      }\n    )\n\n    task(\n      'GameController',\n      null,\n      ['Game', 'GameDisplay', 'GameAudio'],\n      async (game, display, audio) => {\n        return new GameController({ game, display, audio })\n      }\n    )\n\n    return run('GameController')\n  })\n}\n","import Observable from 'bemuse/utils/observable'\nimport Progress from 'bemuse/progress'\nimport { throttle } from 'lodash'\n\nexport function start(callback) {\n  let tasks = {}\n  let running = {}\n  let taskList = []\n\n  function task(name, text, dependencies, f) {\n    let progress = new Progress()\n    if (text) taskList.push({ text, progress })\n    tasks[name] = function () {\n      return Promise.all(dependencies.map(run)).then((deps) =>\n        f(...deps.concat([progress]))\n      )\n    }\n  }\n\n  function bar(text, progress) {\n    taskList.push({ text, progress })\n  }\n\n  task.bar = bar\n\n  function run(name) {\n    return running[name] || (running[name] = tasks[name]())\n  }\n\n  function getTaskStatuses() {\n    return taskList.map((t) => {\n      return {\n        text: t.text,\n        progress: t.progress.progress,\n        progressText: t.progress.toString(),\n      }\n    })\n  }\n\n  let promise = callback(task, run)\n  let status = new Observable(getTaskStatuses())\n  let update = throttle(function updateTaskStatuses() {\n    status.value = getTaskStatuses()\n  }, 16)\n\n  for (let taskToWatch of taskList) {\n    taskToWatch.progress.watch(update)\n  }\n\n  return { tasks: status, promise: promise, get: run }\n}\n","import './LoadingSceneSongInfo.scss'\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { isTitleDisplayMode } from 'bemuse/devtools/query-flags'\n\nexport default class LoadingSceneSongInfo extends React.Component {\n  static propTypes = {\n    song: PropTypes.shape({\n      title: PropTypes.string,\n      artist: PropTypes.string,\n      genre: PropTypes.string,\n      subtitles: PropTypes.arrayOf(PropTypes.string),\n      subartists: PropTypes.arrayOf(PropTypes.string),\n      difficulty: PropTypes.number,\n      level: PropTypes.number,\n    }).isRequired,\n  }\n\n  render() {\n    const song = this.props.song\n    return (\n      <div className='LoadingSceneSongInfo'>\n        <div className='LoadingSceneSongInfogenre'>{song.genre}</div>\n        <div className='LoadingSceneSongInfotitle'>{song.title}</div>\n        {!isTitleDisplayMode()\n          ? song.subtitles.map((text) => (\n              <div key={text} className='LoadingSceneSongInfosubtitle'>\n                {text}\n              </div>\n            ))\n          : null}\n        <div className='LoadingSceneSongInfoartist'>{song.artist}</div>\n        {song.subartists.map((text) => (\n          <div key={text} className='LoadingSceneSongInfosubartist'>\n            {text}\n          </div>\n        ))}\n      </div>\n    )\n  }\n}\n","import './LoadingSceneProgressBar.scss'\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default class LoadingSceneProgressBar extends React.Component {\n  static propTypes = {\n    width: PropTypes.oneOfType([PropTypes.string, PropTypes.number]).isRequired,\n  }\n\n  render() {\n    return (\n      <div className='LoadingSceneProgressBar'>\n        <div\n          className='LoadingSceneProgressBarbar'\n          style={{ width: this.props.width }}\n        />\n      </div>\n    )\n  }\n}\n","import './LoadingSceneProgress.scss'\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport LoadingSceneProgressBar from './LoadingSceneProgressBar.jsx'\n\nexport default class LoadingSceneProgress extends React.Component {\n  static propTypes = {\n    tasks: PropTypes.object,\n  }\n\n  render() {\n    return (\n      <div className='LoadingSceneProgress'>\n        {this.props.tasks.value.map((task) => this.renderItem(task))}\n      </div>\n    )\n  }\n\n  renderItem = ({ text, progressText, progress }) => {\n    let width = Math.round(progress * 100 || 0).toString() + '%'\n    let extra = progressText ? ` (${progressText})` : ''\n    return (\n      <div key={text} className='LoadingSceneProgressitem'>\n        <LoadingSceneProgressBar width={width} />\n        {text}\n        <span className='LoadingSceneProgressextra'>{extra}</span>\n      </div>\n    )\n  }\n\n  componentDidMount() {\n    this._unsubscribe = this.props.tasks.watch(() => this.forceUpdate())\n  }\n\n  componentWillUnmount() {\n    this._unsubscribe()\n  }\n}\n","import './LoadingScene.scss'\n\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport PropTypes from 'prop-types'\nimport Scene from 'bemuse/ui/Scene.jsx'\n\nimport LoadingSceneSongInfo from './LoadingSceneSongInfo.jsx'\nimport LoadingSceneProgress from './LoadingSceneProgress.jsx'\n\nexport default class LoadingScene extends React.Component {\n  static propTypes = {\n    song: PropTypes.shape({\n      title: PropTypes.string,\n      artist: PropTypes.string,\n      genre: PropTypes.string,\n      subtitles: PropTypes.arrayOf(PropTypes.string),\n      subartists: PropTypes.arrayOf(PropTypes.string),\n      difficulty: PropTypes.number,\n      level: PropTypes.number,\n    }),\n    tasks: PropTypes.object,\n    eyecatchImagePromise: PropTypes.object,\n    registerTeardownCallback: PropTypes.func,\n  }\n\n  render() {\n    return (\n      <Scene className='LoadingScene' ref='scene'>\n        <div className='LoadingSceneimage' ref='eyecatch' />\n        <div className='LoadingSceneinfo'>\n          <LoadingSceneSongInfo song={this.props.song} />\n        </div>\n        <LoadingSceneProgress tasks={this.props.tasks} />\n        <div className='LoadingSceneflash' />\n        <div className='LoadingScenecover' />\n      </Scene>\n    )\n  }\n\n  componentDidMount() {\n    if (this.props.eyecatchImagePromise) {\n      this.props.eyecatchImagePromise.then((image) => {\n        ReactDOM.findDOMNode(this.refs.eyecatch).appendChild(image)\n      })\n    }\n    this.props.registerTeardownCallback(() => {\n      ReactDOM.findDOMNode(this.refs.scene).classList.add('is-exiting')\n      return Promise.delay(500)\n    })\n  }\n}\n","// :doc:\n//\n// High-accuracy timer, optionally synchronized globally.\n\nimport sync from 'timesynchro'\nconst Log = BemuseLogger.forModule('timesynchro')\n\nlet now\nlet offset = 0\n\nif (window.performance && typeof window.performance.now === 'function') {\n  now = () => window.performance.now()\n} else {\n  now = () => Date.now()\n}\n\nnow.synchronize = function (server) {\n  sync(server, onFinish, onResult)\n  function onResult(result) {\n    // result + Date.now() = real time = now() + offset\n    // result + Date.now() = now() + offset\n    // offset = result + Date.now() - now()\n    offset = result + Date.now() - now()\n  }\n  function onFinish(err, result) {\n    if (err) {\n      Log.error('Cannot synchronize time: ' + err)\n    } else {\n      onResult(result)\n      Log.info('Synchronized time with global server! Offset = ' + offset)\n    }\n  }\n}\n\nnow.synchronized = function () {\n  let o = offset\n  return () => now() + o\n}\n\nexport { now }\nexport default now\n","import Observable from 'bemuse/utils/observable'\n\ninterface IProgressFormatter {\n  (progress: Progress): string\n}\n\n/**\n * The Progress class represents the progress of an asynchronous operation.\n * It is inspired by C#'s IProgress interface.\n *\n * See: http://blogs.msdn.com/b/dotnet/archive/2012/06/06/async-in-4-5-enabling-progress-and-cancellation-in-async-apis.aspx\n */\nexport class Progress {\n  /** The current progress (out of `Progress#total`). */\n  public current: number | undefined = undefined\n  /** Total progress value */\n  public total: number | undefined = undefined\n  /** Some arbitrary information associated with this Progress. */\n  public extra: any\n  /**\n   * The formatter of this progress. This formatter will be used to compute\n   * the text representation of this progress (`Progress#toString`).\n   */\n  public formatter?: IProgressFormatter\n  private _observable = new Observable<void>()\n  /**\n   * Updates the progress.\n   */\n  report(current: number, total: number, extra?: any) {\n    this.current = current\n    this.total = total\n    this.extra = extra\n    this._observable.notify()\n  }\n  /**\n   * Attaches a progress listener function to this progress.\n   * The function `f` will be called immediately and synchronously upon watching,\n   * and will be called when the progress value is updated.\n   * @param f\n   * @returns a function that, when called, unsubscribes this listener.\n   */\n  watch(f: (progress: Progress) => void) {\n    f(this)\n    return this._observable.watch(() => f(this))\n  }\n  /**\n   * The current progress as a fraction (out of 1).\n   */\n  get progress() {\n    if (this.total && this.current !== undefined && this.current !== null) {\n      return this.current / this.total\n    } else {\n      return null\n    }\n  }\n  /**\n   * Returns a string representation of this progress instance.\n   * This method is used for displaying the progress as a text.\n   */\n  toString() {\n    if (this.formatter !== undefined) {\n      return this.formatter(this)\n    } else if (this.progress !== null) {\n      return this.current + ' / ' + this.total\n    } else {\n      return ''\n    }\n  }\n}\n","// !! avoid external dependencies since this is used in boot script!\n\nimport Callbacks from 'bemuse/utils/callbacks'\n\nexport class Observable<T> {\n  private _callbacks = new Callbacks<[T]>()\n  private _value?: T\n  constructor(value?: T) {\n    this._value = value\n  }\n  get value() {\n    return this._value\n  }\n  set value(value) {\n    this._value = value\n    this.notify(value!)\n  }\n  notify(value: T) {\n    this._callbacks.call(value)\n  }\n  watch(f: (value: T) => void) {\n    if (this._value !== undefined) f(this._value)\n    return this._callbacks.add(f)\n  }\n}\n\nexport default Observable\n","// !! avoid external dependencies since this is used in boot script!\n\ntype CallbackEffect<T extends any[]> = (...args: T) => void\n\n/**\n * A utility class to hold a collection of callbacks.\n */\nexport class Callbacks<T extends any[]> {\n  private _callbacks: { [id: number]: CallbackEffect<T> } = {}\n  private _nextId = 1\n  constructor(init?: CallbackEffect<T>[] | CallbackEffect<T>) {\n    if (typeof init === 'function') {\n      this.add(init)\n    } else if (typeof init === 'object' && init && init.length) {\n      for (var i = 0; i < init.length; i++) this.add(init[i])\n    }\n  }\n\n  /**\n   * Calls all the callbacks.\n   */\n  call(...args: T) {\n    var callbacks = this._callbacks\n    for (var id in callbacks) {\n      callbacks[id](...args)\n    }\n  }\n\n  /**\n   * Adds a `callback` Function to this Callbacks collection.\n   * Returns a function that, when invoked, removes the inserted `callback` from the collection.\n   */\n  add(callback: CallbackEffect<T>) {\n    var id = this._nextId++\n    this._callbacks[id] = callback\n    return () => delete this._callbacks[id]\n  }\n}\n\nexport default Callbacks\n","export default new AudioContext({\n  latencyHint: 'interactive',\n})\n","import './Scene.scss'\n\nimport c from 'classnames'\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default class Scene extends React.Component {\n  static propTypes = {\n    className: PropTypes.string,\n    children: PropTypes.node,\n    onDragEnter: PropTypes.func,\n  }\n\n  render() {\n    return (\n      <div\n        className={c('Scene', this.props.className)}\n        onDragEnter={this.props.onDragEnter}\n      >\n        {this.props.children}\n      </div>\n    )\n  }\n}\n","/*!\n * bytes\n * Copyright(c) 2012-2014 TJ Holowaychuk\n * Copyright(c) 2015 Jed Watson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = bytes;\nmodule.exports.format = format;\nmodule.exports.parse = parse;\n\n/**\n * Module variables.\n * @private\n */\n\nvar formatThousandsRegExp = /\\B(?=(\\d{3})+(?!\\d))/g;\n\nvar formatDecimalsRegExp = /(?:\\.0*|(\\.[^0]+)0+)$/;\n\nvar map = {\n  b:  1,\n  kb: 1 << 10,\n  mb: 1 << 20,\n  gb: 1 << 30,\n  tb: Math.pow(1024, 4),\n  pb: Math.pow(1024, 5),\n};\n\nvar parseRegExp = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb|pb)$/i;\n\n/**\n * Convert the given value in bytes into a string or parse to string to an integer in bytes.\n *\n * @param {string|number} value\n * @param {{\n *  case: [string],\n *  decimalPlaces: [number]\n *  fixedDecimals: [boolean]\n *  thousandsSeparator: [string]\n *  unitSeparator: [string]\n *  }} [options] bytes options.\n *\n * @returns {string|number|null}\n */\n\nfunction bytes(value, options) {\n  if (typeof value === 'string') {\n    return parse(value);\n  }\n\n  if (typeof value === 'number') {\n    return format(value, options);\n  }\n\n  return null;\n}\n\n/**\n * Format the given value in bytes into a string.\n *\n * If the value is negative, it is kept as such. If it is a float,\n * it is rounded.\n *\n * @param {number} value\n * @param {object} [options]\n * @param {number} [options.decimalPlaces=2]\n * @param {number} [options.fixedDecimals=false]\n * @param {string} [options.thousandsSeparator=]\n * @param {string} [options.unit=]\n * @param {string} [options.unitSeparator=]\n *\n * @returns {string|null}\n * @public\n */\n\nfunction format(value, options) {\n  if (!Number.isFinite(value)) {\n    return null;\n  }\n\n  var mag = Math.abs(value);\n  var thousandsSeparator = (options && options.thousandsSeparator) || '';\n  var unitSeparator = (options && options.unitSeparator) || '';\n  var decimalPlaces = (options && options.decimalPlaces !== undefined) ? options.decimalPlaces : 2;\n  var fixedDecimals = Boolean(options && options.fixedDecimals);\n  var unit = (options && options.unit) || '';\n\n  if (!unit || !map[unit.toLowerCase()]) {\n    if (mag >= map.pb) {\n      unit = 'PB';\n    } else if (mag >= map.tb) {\n      unit = 'TB';\n    } else if (mag >= map.gb) {\n      unit = 'GB';\n    } else if (mag >= map.mb) {\n      unit = 'MB';\n    } else if (mag >= map.kb) {\n      unit = 'KB';\n    } else {\n      unit = 'B';\n    }\n  }\n\n  var val = value / map[unit.toLowerCase()];\n  var str = val.toFixed(decimalPlaces);\n\n  if (!fixedDecimals) {\n    str = str.replace(formatDecimalsRegExp, '$1');\n  }\n\n  if (thousandsSeparator) {\n    str = str.split('.').map(function (s, i) {\n      return i === 0\n        ? s.replace(formatThousandsRegExp, thousandsSeparator)\n        : s\n    }).join('.');\n  }\n\n  return str + unitSeparator + unit;\n}\n\n/**\n * Parse the string value into an integer in bytes.\n *\n * If no unit is given, it is assumed the value is in bytes.\n *\n * @param {number|string} val\n *\n * @returns {number|null}\n * @public\n */\n\nfunction parse(val) {\n  if (typeof val === 'number' && !isNaN(val)) {\n    return val;\n  }\n\n  if (typeof val !== 'string') {\n    return null;\n  }\n\n  // Test if the string passed is valid\n  var results = parseRegExp.exec(val);\n  var floatValue;\n  var unit = 'b';\n\n  if (!results) {\n    // Nothing could be extracted from the given string\n    floatValue = parseInt(val, 10);\n    unit = 'b'\n  } else {\n    // Retrieve the value and the unit\n    floatValue = parseFloat(results[1]);\n    unit = results[4].toLowerCase();\n  }\n\n  if (isNaN(floatValue)) {\n    return null;\n  }\n\n  return Math.floor(map[unit] * floatValue);\n}\n","import defaultAudioContext from 'bemuse/audio-context'\nimport readBlob from 'bemuse/utils/read-blob'\nimport { decodeOGG } from './ogg'\n\nexport const FADE_LENGTH = 0.001\n\nlet dummyAudioTag = document.createElement('audio')\n// Checks whether an audio format is supported.\nexport function canPlay(type) {\n  // We have a Vorbis audio decoder!\n  if (type === 'audio/ogg; codecs=\"vorbis\"') return true\n  return dummyAudioTag.canPlayType(type) === 'probably'\n}\n\nconst needsVorbisDecoder = !dummyAudioTag.canPlayType(\n  'audio/ogg; codecs=\"vorbis\"'\n)\n\n// The sampling master is a wrapper class around Web Audio API\n// that takes care of:\n//\n// - Decoding audio from an ArrayBuffer or Blob (resulting in a \"Sample\").\n// - Playing the `Sample` and managing its lifecycle.\nexport class SamplingMaster {\n  constructor(audioContext) {\n    this._audioContext = audioContext || defaultAudioContext\n    this._samples = []\n    this._groups = []\n    this._instances = new Set()\n    this._destination = this._audioContext.destination\n  }\n\n  // Connects a dummy node to the audio, thereby unmuting the audio system on\n  // iOS devices (which keeps the audio muted until a user interacts with the\n  // page).\n  unmute() {\n    unmuteAudio(this._audioContext)\n  }\n\n  // The underlying AudioContext.\n  get audioContext() {\n    return this._audioContext\n  }\n\n  // The audio destination.\n  get destination() {\n    return this._destination\n  }\n\n  // The current time\n  // See: https://webaudio.github.io/web-audio-api/#dom-baseaudiocontext-currenttime\n  get currentTime() {\n    return this._audioContext.currentTime\n  }\n\n  // Destroys this SamplingMaster, make it unusable.\n  destroy() {\n    if (this._destroyed) return\n    this._destroyed = true\n    for (let sample of this._samples) sample.destroy()\n    for (let instance of this._instances) instance.destroy()\n    this._samples = null\n    this._instances = null\n  }\n\n  // Decodes the audio data from a Blob or an ArrayBuffer.\n  // Returns an AudioBuffer which can be re-used in other sampling masters.\n  decode(blobOrArrayBuffer) {\n    return this._coerceToArrayBuffer(blobOrArrayBuffer).then((arrayBuffer) =>\n      this._decodeAudio(arrayBuffer)\n    )\n  }\n\n  // Creates a `Sample` from a Blob or an ArrayBuffer or an AudioBuffer.\n  sample(blobOrArrayBufferOrAudioBuffer) {\n    const audioBufferPromise = (() => {\n      if (blobOrArrayBufferOrAudioBuffer.numberOfChannels) {\n        return Promise.resolve(blobOrArrayBufferOrAudioBuffer)\n      } else {\n        return this.decode(blobOrArrayBufferOrAudioBuffer)\n      }\n    })()\n    return audioBufferPromise.then((audioBuffer) => {\n      if (this._destroyed) throw new Error('SamplingMaster already destroyed!')\n      var sample = new Sample(this, audioBuffer)\n      this._samples.push(sample)\n      return sample\n    })\n  }\n\n  group(options) {\n    const group = new SoundGroup(this, options)\n    this._groups.push(group)\n    return group\n  }\n\n  _coerceToArrayBuffer(blobOrArrayBuffer) {\n    if (blobOrArrayBuffer instanceof ArrayBuffer) {\n      return Promise.resolve(blobOrArrayBuffer)\n    } else {\n      return readBlob(blobOrArrayBuffer).as('arraybuffer')\n    }\n  }\n\n  _decodeAudio(arrayBuffer) {\n    return new Promise((resolve, reject) => {\n      if (needsVorbisDecoder && arrayBuffer.byteLength > 4) {\n        const view = new Uint8Array(arrayBuffer, 0, 4)\n        if (\n          view[0] === 0x4f &&\n          view[1] === 0x67 &&\n          view[2] === 0x67 &&\n          view[3] === 0x53\n        ) {\n          return resolve(decodeOGG(this.audioContext, arrayBuffer))\n        }\n      }\n      this.audioContext.decodeAudioData(\n        arrayBuffer,\n        function decodeAudioDataSuccess(audioBuffer) {\n          resolve(audioBuffer)\n        },\n        function decodeAudioDataFailure(e) {\n          reject(new Error('Unable to decode audio: ' + e))\n        }\n      )\n    })\n  }\n\n  _startPlaying(instance) {\n    this._instances.add(instance)\n  }\n\n  _stoppedPlaying(instance) {\n    this._instances.delete(instance)\n  }\n}\n\n// Sound group\nexport class SoundGroup {\n  constructor(samplingMaster, { volume } = {}) {\n    this._master = samplingMaster\n    this._gain = this._master.audioContext.createGain()\n    if (volume != null) this._gain.gain.value = volume\n    this._gain.connect(this._master.destination)\n  }\n\n  get destination() {\n    return this._gain\n  }\n\n  destroy() {\n    this._gain.disconnect()\n    this._gain = null\n  }\n}\n\n// The Sample is created by and belongs to the `SamplingMaster`.\n//\n// You don't invoke this constructor directly; it is invoked by\n// `SamplingMaster#create`.\nexport class Sample {\n  constructor(samplingMaster, /** @type {AudioBuffer} */ audioBuffer) {\n    this._master = samplingMaster\n    this._buffer = audioBuffer\n  }\n\n  // Plays the sample and returns the new PlayInstance.\n  play(delay, options) {\n    return new PlayInstance(this._master, this._buffer, delay, options)\n  }\n\n  // Destroys this sample, thereby making it unusable.\n  destroy() {\n    this._master = null\n    this._buffer = null\n  }\n\n  get duration() {\n    return this._buffer.duration\n  }\n}\n\n// When a `Sample` is played, a PlayInstance is created.\n// A PlayInstance may not be reused; after the sound finishes playing,\n// you have to invoke `Sample#play` again.\n//\n// You don't invoke this constructor directly; it is invoked by `Sample#play`.\nexport class PlayInstance {\n  constructor(samplingMaster, buffer, delay, options = {}) {\n    delay = delay || 0\n    this._master = samplingMaster\n\n    // Connect all the stuff...\n    let context = samplingMaster.audioContext\n    let source = context.createBufferSource()\n    source.buffer = buffer\n    source.onended = () => this.stop()\n    let gain = context.createGain()\n    source.connect(gain)\n    let destination =\n      options.node ||\n      (options.group && options.group.destination) ||\n      samplingMaster.destination\n    gain.connect(destination)\n    this._source = source\n    this._gain = this.TEST_node = gain\n\n    // Start the sound.\n    let startTime = !delay ? 0 : Math.max(0, context.currentTime + delay)\n    let startOffset = options.start || 0\n    let fadeIn = startOffset > 0\n    let fadeOutAt = false\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, 0)\n    }\n    if (options.end !== undefined) {\n      let duration = Math.max(options.end - startOffset, 0)\n      source.start(startTime, startOffset, duration + FADE_LENGTH)\n      fadeOutAt = context.currentTime + delay + duration\n    } else {\n      source.start(startTime, startOffset)\n    }\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, context.currentTime + delay)\n      gain.gain.linearRampToValueAtTime(\n        1,\n        context.currentTime + delay + FADE_LENGTH\n      )\n    }\n    if (fadeOutAt !== false) {\n      gain.gain.setValueAtTime(1, fadeOutAt)\n      gain.gain.linearRampToValueAtTime(0, fadeOutAt + FADE_LENGTH)\n    }\n    this._master._startPlaying(this)\n  }\n\n  // Stops the sample and disconnects the underlying Web Audio nodes.\n  stop() {\n    if (!this._source) return\n    this._source.stop(0)\n    this._source.disconnect()\n    this._gain.disconnect()\n    this._source = null\n    this._gain = null\n    this._master._stoppedPlaying(this)\n    if (this.onstop) this.onstop()\n  }\n\n  // Makes this PlayInstance sound off-pitch, as a result of badly hitting\n  // a note.\n  bad() {\n    if (!this._source) return\n    this._source.playbackRate.value =\n      Math.random() < 0.5 ? Math.pow(2, 1 / 24) : Math.pow(2, -1 / 24)\n  }\n\n  // Destroys this PlayInstance.\n  destroy() {\n    this.stop()\n  }\n}\n\nexport default SamplingMaster\n\n/**\n * Enables Web Audio on iOS. By default, on iOS, audio is disabled.\n * This function must be called before audio will start working. It must be\n * called as a response to some user interaction (e.g. touchstart).\n *\n * Also, theres now Chrome autoplay policy taking effect.\n * https://developers.google.com/web/updates/2017/09/autoplay-policy-changes\n *\n * @param {AudioContext} ctx The AudioContext to be unmuted.\n */\nexport function unmuteAudio(ctx = defaultAudioContext) {\n  // Perform some strange magic to unmute the audio on iOS devices.\n  // This code doesnt make sense at all, you know.\n  let gain = ctx.createGain()\n  let osc = ctx.createOscillator()\n  osc.frequency.value = 440\n  osc.start(ctx.currentTime + 0.1)\n  osc.stop(ctx.currentTime + 0.1)\n  gain.connect(ctx.destination)\n  gain.disconnect()\n\n  resumeContext(ctx).catch((e) => {\n    console.error('[sampling-master] Cannot resume AudioContext', e)\n  })\n}\n\nasync function resumeContext(ctx) {\n  return ctx.resume()\n}\n","export function addUnprefixed(\n  prefix: string,\n  name: string,\n  callback: (path: string) => void\n) {\n  if (name.match(/\\.(?:bms|bme|bml|bmson)/i)) {\n    callback(name)\n    return\n  }\n  const parts = (prefix + name).split('/')\n  for (let i = 0; i < parts.length; i++) {\n    callback(parts.slice(i).join('/'))\n  }\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n","import { LoggingFunction } from './types'\n\nexport default class ResourceLogging {\n  private buffer: string[] | null = []\n  private loggingFunction: LoggingFunction = (text) => {\n    if (this.buffer) this.buffer.push(text)\n  }\n  public log: LoggingFunction = (text) => {\n    this.loggingFunction(text)\n  }\n  setLoggingFunction = (fn: LoggingFunction) => {\n    this.loggingFunction = fn\n    if (this.buffer) {\n      this.buffer.forEach((text) => fn(text))\n      this.buffer = null\n    }\n  }\n}\n","\r\n/**\r\n * Represents compressed file before extraction\r\n */\r\nexport class CompressedFile{\r\n\r\n    constructor(name,size,path,archiveRef){\r\n        this._name = name;\r\n        this._size = size;\r\n        this._path = path;\r\n        this._archiveRef = archiveRef;\r\n    }\r\n\r\n    /**\r\n     * file name\r\n     */\r\n    get name(){\r\n        return this._name;\r\n    }\r\n    /**\r\n     * file size\r\n     */\r\n    get size(){\r\n        return this._size;\r\n    }\r\n\r\n    /**\r\n     * Extract file from archive\r\n     * @returns {Promise<File>} extracted file\r\n     */\r\n    extract(){\r\n        return this._archiveRef.extractSingleFile(this._path);\r\n    }\r\n\r\n}","import { CompressedFile } from \"./compressed-file.js\";\r\n\r\n\r\nexport class Archive{\r\n\r\n    /**\r\n     * Initialize libarchivejs\r\n     * @param {Object} options \r\n     */\r\n    static init(options = {}){\r\n        Archive._options = {\r\n            workerUrl: '../dist/worker-bundle.js',\r\n            ...options\r\n        };\r\n        return Archive._options;\r\n    }\r\n\r\n    /**\r\n     * Creates new archive instance from browser native File object\r\n     * @param {File} file\r\n     * @param {object} options\r\n     * @returns {Archive}\r\n     */\r\n    static open(file, options = null){\r\n        options =   options || \r\n                    Archive._options || \r\n                    Archive.init() && console.warn('Automatically initializing using options: ', Archive._options);\r\n        const arch = new Archive(file,options);\r\n        return arch.open();\r\n    }\r\n\r\n    /**\r\n     * Create new archive\r\n     * @param {File} file \r\n     * @param {Object} options \r\n     */\r\n    constructor(file,options){\r\n        this._worker = new Worker(options.workerUrl);\r\n        this._worker.addEventListener('message', this._workerMsg.bind(this));\r\n        this._callbacks = [];\r\n        this._content = {};\r\n        this._processed = 0;\r\n        this._file = file;\r\n    }\r\n\r\n    /**\r\n     * Prepares file for reading\r\n     * @returns {Promise<Archive>} archive instance\r\n     */\r\n    async open(){\r\n        await this._postMessage({type: 'HELLO'},(resolve,reject,msg) => {\r\n            if( msg.type === 'READY' ){\r\n                resolve();\r\n            }\r\n        });\r\n        return await this._postMessage({type: 'OPEN', file: this._file}, (resolve,reject,msg) => {\r\n            if(msg.type === 'OPENED'){\r\n                resolve(this);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * detect if archive has encrypted data\r\n     * @returns {boolean|null} null if could not be determined\r\n     */\r\n    hasEncryptedData(){\r\n        return this._postMessage({type: 'CHECK_ENCRYPTION'}, \r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'ENCRYPTION_STATUS' ){\r\n                    resolve(msg.status);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set password to be used when reading archive\r\n     */\r\n    usePassword(archivePassword){\r\n        return this._postMessage({type: 'SET_PASSPHRASE', passphrase: archivePassword},\r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'PASSPHRASE_STATUS' ){\r\n                    resolve(msg.status);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns object containing directory structure and file information \r\n     * @returns {Promise<object>}\r\n     */\r\n    getFilesObject(){\r\n        if( this._processed > 0 ){\r\n            return Promise.resolve().then( () => this._content );\r\n        }\r\n        return this._postMessage({type: 'LIST_FILES'}, (resolve,reject,msg) => {\r\n            if( msg.type === 'ENTRY' ){\r\n                const entry = msg.entry;\r\n                const [ target, prop ] = this._getProp(this._content,entry.path);\r\n                if( entry.type === 'FILE' ){\r\n                    target[prop] = new CompressedFile(entry.fileName,entry.size,entry.path,this);                    \r\n                }\r\n                return true;\r\n            }else if( msg.type === 'END' ){\r\n                this._processed = 1;\r\n                resolve(this._cloneContent(this._content));\r\n            }\r\n        });\r\n    }\r\n\r\n    getFilesArray(){\r\n        return this.getFilesObject().then( (obj) => {\r\n            return this._objectToArray(obj);\r\n        });\r\n    }\r\n\r\n    extractSingleFile(target){\r\n        return this._postMessage({type: 'EXTRACT_SINGLE_FILE', target: target}, \r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'FILE' ){\r\n                    const file = new File([msg.entry.fileData], msg.entry.fileName, {\r\n                        type: 'application/octet-stream'\r\n                    });\r\n                    resolve(file);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns object containing directory structure and extracted File objects \r\n     * @param {Function} extractCallback\r\n     * \r\n     */\r\n    extractFiles(extractCallback){\r\n        if( this._processed > 1 ){\r\n            return Promise.resolve().then( () => this._content );\r\n        }\r\n        return this._postMessage({type: 'EXTRACT_FILES'}, (resolve,reject,msg) => {\r\n            if( msg.type === 'ENTRY' ){\r\n                const [ target, prop ] = this._getProp(this._content,msg.entry.path);\r\n                if( msg.entry.type === 'FILE' ){\r\n                    target[prop] = new File([msg.entry.fileData], msg.entry.fileName, {\r\n                        type: 'application/octet-stream'\r\n                    });\r\n                    if (extractCallback !== undefined) {\r\n                        setTimeout(extractCallback.bind(null,{\r\n                            file: target[prop],\r\n                            path: msg.entry.path,\r\n                        }));\r\n                    }\r\n                }\r\n                return true;\r\n            }else if( msg.type === 'END' ){\r\n                this._processed = 2;\r\n                this._worker.terminate();\r\n                resolve(this._cloneContent(this._content));\r\n            }\r\n        });\r\n    }\r\n\r\n    _cloneContent(obj){\r\n        if( obj instanceof File || obj instanceof CompressedFile || obj === null ) return obj;\r\n        const o = {};\r\n        for( const prop of Object.keys(obj) ){\r\n            o[prop] = this._cloneContent(obj[prop]);\r\n        }\r\n        return o;\r\n    }\r\n\r\n    _objectToArray(obj,path = ''){\r\n        const files = [];\r\n        for( const key of Object.keys(obj) ){\r\n            if( obj[key] instanceof File || obj[key] instanceof CompressedFile || obj[key] === null ){\r\n                files.push({\r\n                    file: obj[key] || key,\r\n                    path: path\r\n                });\r\n            }else{\r\n                files.push( ...this._objectToArray(obj[key],`${path}${key}/`) );\r\n            }\r\n        }\r\n        return files;\r\n    }\r\n\r\n    _getProp(obj,path){\r\n        const parts = path.split('/');\r\n        if( parts[parts.length -1] === '' ) parts.pop();\r\n        let cur = obj, prev = null;\r\n        for( const part of parts ){\r\n            cur[part] = cur[part] || {};\r\n            prev = cur;\r\n            cur = cur[part];\r\n        }\r\n        return [ prev, parts[parts.length-1] ];\r\n    }\r\n\r\n    _postMessage(msg,callback){\r\n        this._worker.postMessage(msg);\r\n        return new Promise((resolve,reject) => {\r\n            this._callbacks.push( this._msgHandler.bind(this,callback,resolve,reject) );\r\n        });\r\n    }\r\n\r\n    _msgHandler(callback,resolve,reject,msg){\r\n        if( msg.type === 'BUSY' ){\r\n            reject('worker is busy');\r\n        }else if( msg.type === 'ERROR' ){\r\n            reject(msg.error);\r\n        }else{\r\n            return callback(resolve,reject,msg);\r\n        }\r\n    }\r\n\r\n    _workerMsg({data: msg}){\r\n        const callback = this._callbacks[this._callbacks.length -1];\r\n        const next = callback(msg);\r\n        if( !next ){\r\n            this._callbacks.pop();\r\n        }\r\n    }\r\n\r\n}","import { Archive } from 'libarchive.js/main.js'\nimport { addUnprefixed } from './addUnprefixed'\nimport { FileEntry } from './types'\n\nArchive.init({\n  workerUrl: '/vendor/libarchive.js-1.3.0/dist/worker-bundle.js',\n})\n\nexport async function unarchive(file: File): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const archive = await Archive.open(file)\n  const extracted = await archive.extractFiles()\n  const traverse = (tree: any, prefix = '') => {\n    for (const key of Object.keys(tree)) {\n      if (tree[key] instanceof File) {\n        addUnprefixed(prefix, key, (name) => {\n          out.push({ name, file: tree[key] })\n        })\n      } else if (tree[key] && typeof tree[key] === 'object') {\n        traverse(tree[key], prefix + key + '/')\n      }\n    }\n  }\n  traverse(extracted)\n  return out\n}\n","import * as ProgressUtils from 'bemuse/progress/utils'\nimport {\n  FileEntry,\n  LoggingFunction,\n  IResource,\n  ICustomSongResources,\n} from './types'\nimport ResourceLogging from './resource-logging'\nimport { unarchive } from './unarchiver'\nimport readBlob from 'bemuse/utils/read-blob'\nimport Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\n\nexport const ARCHIVE_REGEXP = /\\.(?:zip|rar|7z|tar(?:\\.(?:gz|bz2))?)/i\n\n// http://nekokan.dyndns.info/tool/DropboxReplacer/index.html\nconst DROPBOX_REGEXP =\n  /https?:\\/\\/(?:(?:www|dl)\\.dropbox\\.com|dl\\.dropboxusercontent\\.com)\\/(sh?)\\/([^?]*)(.*)?$/\n\n/**\n * A resource provider for custom songs.\n * It may retrieve the files from, e.g., a drag and drop event or an `?archive` flag.\n */\nexport interface CustomResourceProvider {\n  getFiles(loggingFunction: LoggingFunction): PromiseLike<FileEntry[]>\n}\n\n/**\n * An IResources for songs provided by a CustomResourceProvider.\n */\nexport class CustomSongResources implements ICustomSongResources {\n  private _logging = new ResourceLogging()\n  private _files: PromiseLike<FileEntry[]>\n  public setLoggingFunction = this._logging.setLoggingFunction\n\n  constructor(provider: CustomResourceProvider) {\n    this._files = Promise.resolve(provider.getFiles(this._logging.log)).then(\n      (files) => unarchiveIfNeeded(files, this._logging.log)\n    )\n  }\n  file(name: string) {\n    return this._files.then(function (files) {\n      for (let file of files) {\n        if (file.name.toLowerCase() === name.toLowerCase()) {\n          return new FileResource(file.file)\n        }\n      }\n      throw new Error('unable to find ' + name)\n    })\n  }\n  get fileList(): Promise<string[]> {\n    return Promise.resolve(this._files).then((a) => a.map((f) => f.name))\n  }\n}\n\nexport class FileResource implements IResource {\n  constructor(private _file: File) {}\n  read(progress: Progress) {\n    return ProgressUtils.atomic(\n      progress,\n      readBlob(this._file).as('arraybuffer')\n    )\n  }\n  resolveUrl() {\n    return Promise.resolve(URL.createObjectURL(this._file))\n  }\n  get name() {\n    return this._file.name\n  }\n}\n\n/**\n * If only 1 FileEntry is present and it is an archive file, extract it.\n */\nexport async function unarchiveIfNeeded(\n  files: FileEntry[],\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  if (files.length !== 1) return files\n  const fileEntry = files[0]\n  if (!fileEntry.name.match(ARCHIVE_REGEXP)) {\n    return files\n  }\n  log('Archive file detected! Now unarchiving')\n  return unarchive(fileEntry.file)\n}\n\n/**\n * Downloads a URL as a FileEntry.\n */\nexport async function downloadFileEntryFromURL(\n  url: string,\n  log: LoggingFunction\n): Promise<FileEntry> {\n  const name = url\n    .replace(/[?#].*/, '')\n    .split('/')\n    .pop()!\n\n  // Try Dropbox URL replacement\n  const match = url.match(DROPBOX_REGEXP)\n  if (match) {\n    url = `https://dl.dropboxusercontent.com/${match[1]}/${match[2]}`\n  }\n\n  const progress = new Progress()\n  let lastTime = 0\n  progress.watch(() => {\n    if (Date.now() < lastTime + 5e3) return\n    log(`Downloading: ${progress}`)\n    lastTime = Date.now()\n  })\n  const blob = await download(url).as('blob', progress)\n  return { name, file: blob }\n}\n","import throat from 'throat'\n\ntype OGGDecodeEvent = {\n  data?: Float32Array[]\n  sampleRate: number\n  error?: any\n  eof?: boolean\n}\n\ntype OGGDecoder = {\n  decode(arrayBuffer: ArrayBuffer, callback: (e: OGGDecodeEvent) => void): void\n}\n\nlet decoderPromise: Promise<OGGDecoder>\n\nconst limit = throat(1)\n\nfunction getDecoder() {\n  if (!decoderPromise) {\n    decoderPromise = import(\n      // @ts-ignore\n      /* webpackChunkName: 'stbvorbis' */ 'raw-loader!./vendor/stbvorbis/stbvorbis-e6da5fe-NDEBUG.js'\n    )\n      .then((ns) => ns.default)\n      .then((src) => {\n        // eslint-disable-next-line no-eval\n        return (0, eval)(src + ';stbvorbis')\n      })\n  }\n  return decoderPromise\n}\n\n/**\n * Decodes an OGG file using stbvorbis.js.\n */\nexport async function decodeOGG(\n  audioContext: AudioContext,\n  arrayBuffer: ArrayBuffer\n) {\n  const stbvorbis = await getDecoder()\n  return limit(() => doDecodeOGG(stbvorbis, audioContext, arrayBuffer))\n}\n\nfunction doDecodeOGG(\n  stbvorbis: OGGDecoder,\n  audioContext: AudioContext,\n  arrayBuffer: ArrayBuffer\n) {\n  return new Promise<AudioBuffer>((resolve, reject) => {\n    const buffers: Float32Array[][] = []\n    let totalLength = 0\n    let sampleRate: number\n    stbvorbis.decode(arrayBuffer, function (e) {\n      if (e.data) {\n        sampleRate = e.sampleRate\n        buffers.push(e.data)\n        totalLength += e.data[0].length\n      }\n      if (e.error) {\n        const error =\n          e.error instanceof Error ? e.error : `stbvorbis.js Error: ${e.error}`\n        reject(error)\n      }\n      if (e.eof) {\n        resolve(createBuffer(audioContext, buffers, totalLength, sampleRate))\n      }\n    })\n  })\n}\n\nasync function createBuffer(\n  audioContext: AudioContext,\n  decodedChunks: Float32Array[][],\n  length: number,\n  sampleRate: number\n) {\n  if (!length) throw new Error(`stbvorbis.js Error: No length`)\n  if (!sampleRate) throw new Error(`stbvorbis.js Error: No sample rate`)\n  const numberOfChannels = decodedChunks[0].length\n  const audioBuffer = audioContext.createBuffer(\n    numberOfChannels,\n    length,\n    sampleRate\n  )\n  const channels: ChannelDataWriter[] = Array(audioBuffer.numberOfChannels)\n    .fill(null)\n    .map((_, ch) => new ChannelDataWriter(audioBuffer.getChannelData(ch)))\n  for (const chunk of decodedChunks) {\n    chunk.forEach((audioSamples, channelIndex) => {\n      channels[channelIndex].write(audioSamples)\n    })\n  }\n  return audioBuffer\n}\n\nclass ChannelDataWriter {\n  private offset = 0\n  constructor(private data: Float32Array) {}\n  write(audioSamples: Float32Array) {\n    // iOS Safari does not support `buf.copyToChannel(a, ch, track[ch])`, so we had to copy audio data sample-by-sample.\n    const { offset, data } = this\n    for (var i = 0; i < audioSamples.length; i++) {\n      data[i + offset] = audioSamples[i]\n    }\n    this.offset += audioSamples.length\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notechart = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar invariant_1 = __importDefault(require(\"invariant\"));\n__exportStar(require(\"./types\"), exports);\n/**\n * A notechart holds every info about a single player's note chart that the\n * game will ever need.\n */\nvar Notechart = /** @class */ (function () {\n    function Notechart(data, playerOptions) {\n        if (playerOptions === void 0) { playerOptions = {}; }\n        var _this = this;\n        var bmsNotes = data.notes, timing = data.timing, keysounds = data.keysounds, songInfo = data.songInfo, positioning = data.positioning, spacing = data.spacing, barLines = data.barLines, images = data.images, expertJudgmentWindow = data.expertJudgmentWindow, _a = data.landmineNotes, landmineNotes = _a === void 0 ? [] : _a;\n        (0, invariant_1.default)(bmsNotes, 'Expected \"data.notes\"');\n        (0, invariant_1.default)(timing, 'Expected \"data.timing\"');\n        (0, invariant_1.default)(keysounds, 'Expected \"data.keysounds\"');\n        (0, invariant_1.default)(songInfo, 'Expected \"data.songInfo\"');\n        (0, invariant_1.default)(positioning, 'Expected \"data.positioning\"');\n        (0, invariant_1.default)(spacing, 'Expected \"data.spacing\"');\n        (0, invariant_1.default)(barLines, 'Expected \"data.barLines\"');\n        this.expertJudgmentWindow = expertJudgmentWindow;\n        bmsNotes = this._preTransform(bmsNotes, playerOptions);\n        this._timing = timing;\n        this._positioning = positioning;\n        this._spacing = spacing;\n        this._keysounds = keysounds;\n        this._duration = 0;\n        this._notes = this._generatePlayableNotesFromBMS(bmsNotes);\n        this._landmines = this._generatePlayableNotesFromBMS(landmineNotes);\n        this._autos = this._generateAutoKeysoundEventsFromBMS(bmsNotes);\n        this._barLines = this._generateBarLineEvents(barLines);\n        this._samples = this._generateKeysoundFiles(keysounds);\n        this._infos = new Map(this._notes.map(function (note) { return [note, _this._getNoteInfo(note)]; }));\n        this._songInfo = songInfo;\n        this._images = images;\n    }\n    Object.defineProperty(Notechart.prototype, \"notes\", {\n        /**\n         * An Array of note events.\n         */\n        get: function () {\n            return this._notes;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"landmines\", {\n        /**\n         * An Array of landmines events.\n         */\n        get: function () {\n            return this._landmines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"autos\", {\n        /**\n         * An Array of auto-keysound events.\n         */\n        get: function () {\n            return this._autos;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"samples\", {\n        /**\n         * An Array of all the sample files to use.\n         */\n        get: function () {\n            return this._samples;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"keysounds\", {\n        /**\n         * An Object containing the mapping from keysound ID to keysound filename.\n         */\n        get: function () {\n            return this._keysounds.all();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"barLines\", {\n        /**\n         * An Object representing the bar line events.\n         */\n        get: function () {\n            return this._barLines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"columns\", {\n        /**\n         * An Array of all column names in this notechart.\n         */\n        get: function () {\n            return ['SC', '1', '2', '3', '4', '5', '6', '7'];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"duration\", {\n        /**\n         * Notechart's duration (time of last event)\n         */\n        get: function () {\n            return this._duration;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"songInfo\", {\n        /**\n         * Notechart's song info\n         */\n        get: function () {\n            return this._songInfo;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"eyecatchImage\", {\n        /**\n         * Eyecatch image\n         */\n        get: function () {\n            return (this._images && this._images.eyecatch) || 'eyecatch_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"backgroundImage\", {\n        /**\n         * Background image\n         */\n        get: function () {\n            return (this._images && this._images.background) || 'back_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the characteristic of the note as an Object.\n     */\n    Notechart.prototype.info = function (note) {\n        return this._infos.get(note);\n    };\n    /**\n     * Converts the beat number to in-song position (seconds)\n     */\n    Notechart.prototype.beatToSeconds = function (beat) {\n        return this._timing.beatToSeconds(beat);\n    };\n    /**\n     * Converts the beat number to in-game position.\n     */\n    Notechart.prototype.beatToPosition = function (beat) {\n        return this._positioning.position(beat);\n    };\n    /**\n     * Converts measure number to beat.\n     */\n    Notechart.prototype.measureToBeat = function (measure) {\n        return (this._barLines[measure] || this._barLines[this._barLines.length - 1]).beat;\n    };\n    /**\n     * Converts the in-song position to beat number.\n     */\n    Notechart.prototype.secondsToBeat = function (seconds) {\n        return this._timing.secondsToBeat(seconds);\n    };\n    /**\n     * Converts the in-song position to in-game position.\n     */\n    Notechart.prototype.secondsToPosition = function (seconds) {\n        return this.beatToPosition(this.secondsToBeat(seconds));\n    };\n    /**\n     * Finds BPM at the specified beat.\n     */\n    Notechart.prototype.bpmAtBeat = function (beat) {\n        return this._timing.bpmAtBeat(beat);\n    };\n    /**\n     * Finds the scrolling speed at the specified beat.\n     */\n    Notechart.prototype.scrollSpeedAtBeat = function (beat) {\n        return this._positioning.speed(beat);\n    };\n    /**\n     * Calculates the note spacing factor at the specified beat.\n     */\n    Notechart.prototype.spacingAtBeat = function (beat) {\n        return this._spacing.factor(beat);\n    };\n    /**\n     * Gets the keyMode from scratch\n     * @param scratch\n     * @returns {string}\n     */\n    Notechart.prototype.getKeyMode = function (scratch) {\n        var e_1, _a;\n        var usedColumns = {};\n        try {\n            for (var _b = __values(this.notes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var note = _c.value;\n                usedColumns[note.column] = true;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        if (scratch === 'off' && !usedColumns['1'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'left' && !usedColumns['6'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'right' && !usedColumns['1'] && !usedColumns['2'])\n            return '5K';\n        return '7K';\n    };\n    Notechart.prototype._preTransform = function (bmsNotes, playerOptions) {\n        var chain = lodash_1.default.chain(bmsNotes);\n        var keys = getKeys(bmsNotes);\n        if (playerOptions.scratch === 'off') {\n            chain = chain.map(function (note) {\n                if (note.column && note.column === 'SC') {\n                    return Object.assign({}, note, { column: null });\n                }\n                else {\n                    return note;\n                }\n            });\n        }\n        if (keys === '5K') {\n            var columnsToShift_1 = ['1', '2', '3', '4', '5', '6', '7'];\n            var shiftNote = function (amount) { return function (note) {\n                if (note.column) {\n                    var index = columnsToShift_1.indexOf(note.column);\n                    if (index > -1) {\n                        var newIndex = index + amount;\n                        (0, invariant_1.default)(newIndex < columnsToShift_1.length, 'Weird. Columns must not shift beyond available column');\n                        var newColumn = columnsToShift_1[newIndex];\n                        return Object.assign({}, note, { column: newColumn });\n                    }\n                }\n                return note;\n            }; };\n            if (playerOptions.scratch === 'off') {\n                chain = chain.map(shiftNote(1));\n            }\n            else if (playerOptions.scratch === 'right') {\n                chain = chain.map(shiftNote(2));\n            }\n        }\n        return chain.value();\n    };\n    Notechart.prototype._generatePlayableNotesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            _this._updateDuration(spec);\n            if (note.endBeat !== undefined) {\n                spec.end = _this._generateEvent(note.endBeat);\n                _this._updateDuration(spec.end);\n            }\n            else {\n                spec.end = undefined;\n            }\n            return spec;\n        });\n    };\n    Notechart.prototype._generateLandminesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            _this._updateDuration(spec);\n            return spec;\n        });\n    };\n    Notechart.prototype._updateDuration = function (event) {\n        if (event.time > this._duration)\n            this._duration = event.time;\n    };\n    Notechart.prototype._generateAutoKeysoundEventsFromBMS = function (bmsNotes) {\n        var _this = this;\n        return bmsNotes\n            .filter(function (note) { return !note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            return spec;\n        });\n    };\n    Notechart.prototype._generateKeysoundFiles = function (keysounds) {\n        var e_2, _a, e_3, _b;\n        var set = new Set();\n        try {\n            for (var _c = __values([this.notes, this.autos]), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var array = _d.value;\n                try {\n                    for (var array_1 = (e_3 = void 0, __values(array)), array_1_1 = array_1.next(); !array_1_1.done; array_1_1 = array_1.next()) {\n                        var event_ = array_1_1.value;\n                        var file = keysounds.get(event_.keysound);\n                        if (file)\n                            set.add(file);\n                    }\n                }\n                catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                finally {\n                    try {\n                        if (array_1_1 && !array_1_1.done && (_b = array_1.return)) _b.call(array_1);\n                    }\n                    finally { if (e_3) throw e_3.error; }\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return Array.from(set);\n    };\n    Notechart.prototype._generateBarLineEvents = function (beats) {\n        var _this = this;\n        return beats.map(function (beat) { return _this._generateEvent(beat); });\n    };\n    Notechart.prototype._generateEvent = function (beat) {\n        return {\n            beat: beat,\n            time: this.beatToSeconds(beat),\n            position: this.beatToPosition(beat),\n        };\n    };\n    Notechart.prototype._getNoteInfo = function (note) {\n        return { combos: note.end ? 2 : 1 };\n    };\n    return Notechart;\n}());\nexports.Notechart = Notechart;\nexports.default = Notechart;\nfunction getKeys(bmsNotes) {\n    var e_4, _a;\n    try {\n        for (var bmsNotes_1 = __values(bmsNotes), bmsNotes_1_1 = bmsNotes_1.next(); !bmsNotes_1_1.done; bmsNotes_1_1 = bmsNotes_1.next()) {\n            var note = bmsNotes_1_1.value;\n            if (note.column === '6' || note.column === '7') {\n                return '7K';\n            }\n        }\n    }\n    catch (e_4_1) { e_4 = { error: e_4_1 }; }\n    finally {\n        try {\n            if (bmsNotes_1_1 && !bmsNotes_1_1.done && (_a = bmsNotes_1.return)) _a.call(bmsNotes_1);\n        }\n        finally { if (e_4) throw e_4.error; }\n    }\n    return '5K';\n}\n//# sourceMappingURL=index.js.map","// Touch3D mode -- inspired by Thapster.\n// Notes are arranged on a 3D arc that moves towards the screen.\n// Example: https://twitter.com/bemusegame/status/950505986409709569\n\n/** Parameters to the algorithm. These values are obtained by trial-and-error. */\nconst config = {\n  /** Centre point of the arc (X-coordinate) */\n  cx: 1024,\n  /** Centre point of the arc (Y-coordinate) */\n  cy: -975,\n  /** Radius of the arc */\n  r: 1024,\n  /** Beginning angle of the arc */\n  t0: 3.922,\n  /** Ending angle of the arc */\n  t1: 4.555,\n  /**\n   * Perspective value (field of view).\n   * Camera is placed at (p, 0, 0), facing towards (0, 0, 0).\n   * See: https://developer.mozilla.org/en-US/docs/Web/CSS/perspective\n   */\n  p: 960,\n  /** Width of the play area */\n  w: 60,\n}\n\n/**\n * Given the display position (0 representing top and 1 representing bottom),\n * calculates the onscreen position to display it.\n *\n * Screen size is hardcoded as 1280x720.\n *\n * @param position The display position (0 representing top and 1 representing bottom)\n * @return An object with\n *   - `y` A number represeting the onscreen position to display the note.\n *   - `projection` The projected scale. If an object is closer to the screen,\n *     it will appear bigger. This value represents that scale.\n */\nexport function getRow(position) {\n  let excess = Math.max(0, position - 1)\n  if (position < 0) position = 0\n  if (position > 1) position = 1\n  let theta = config.t0 + (config.t1 - config.t0) * position\n  let pointX = config.cx + Math.cos(theta) * config.r\n  let pointY = config.cy - Math.sin(theta) * config.r\n  let projection = config.p / (config.p - pointX)\n  let screenY = pointY * projection + 720 / 2\n  return { y: screenY + excess * 2048, projection }\n}\n\n/**\n * The world width of the play area.\n * Multiply this with the projection number to get the onscreen width.\n */\nexport const PLAY_AREA_WIDTH = config.w\n\n/**\n * Finds the touched column based on screen coordinate.\n *\n * @param {number} x The x onscreen coordinate (0~1280)\n * @param {number} y The y onscreen coordinate (0~1280)\n * @return Column name ('1'~'7') or `null` if no column should be triggered.\n */\nexport function getTouchedColumn(x, y) {\n  let min = 0.75\n  let max = 1\n  let mid\n  let row\n  for (let i = 0; i < 8; i++) {\n    mid = (min + max) / 2\n    row = getRow(mid)\n    if (row.y > y) {\n      max = mid\n    } else {\n      min = mid\n    }\n  }\n  if (mid < 0.8) return null\n  let x0 = 1280 / 2 + row.projection * -config.w\n  let x1 = 1280 / 2 + row.projection * config.w\n  let pos = Math.floor(((x - x0) / (x1 - x0)) * 7)\n  if (pos >= -1 && pos <= 7) {\n    if (pos < 0) pos = 0\n    if (pos > 6) pos = 6\n    return String(pos + 1)\n  }\n  return null\n}\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./GameShellScene.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./GameShellScene.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./GameShellScene.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".GameShellScene {\\n  margin: 20px auto;\\n  background: #353433;\\n  border: 1px solid #555453;\\n  padding: 15px;\\n  max-width: 720px;\\n}\\n.GameShellScene .drop-zone {\\n  border: 2px dashed #555453;\\n  padding: 5px;\\n}\\n.GameShellScene .drop-zone a.is-active {\\n  font-weight: bold;\\n}\\n.GameShellScene .drop-zone-hint {\\n  padding: 10px;\\n  text-align: center;\\n  color: #8b8685;\\n}\\n.GameShellScene form > div {\\n  margin-bottom: 1em;\\n}\\n.GameShellScene form > div.text .label {\\n  display: block;\\n  color: #8b8685;\\n  font-weight: bold;\\n  font-size: 0.8em;\\n  margin: 0;\\n  margin-bottom: 0.5ex;\\n}\\n.GameShellScene form > div.text input {\\n  font: inherit;\\n  display: block;\\n  width: 100%;\\n  box-sizing: border-box;\\n  border: 1px inset #555453;\\n  background: #252423;\\n  color: #bfb;\\n}\\n.GameShellScene form > div.text input:disabled {\\n  opacity: 0.2;\\n}\\n.GameShellScene form > div.checkbox input {\\n  margin-right: 1ex;\\n}\\n.GameShellScene form > div.radio > h3 {\\n  display: block;\\n  color: #8b8685;\\n  font-weight: bold;\\n  font-size: 0.8em;\\n  margin: 0;\\n  margin-bottom: 0.5ex;\\n}\\n.GameShellScene form > div.radio > label {\\n  display: block;\\n}\\n.GameShellScene form > div.radio input {\\n  margin-right: 1ex;\\n}\\n.GameShellScene button {\\n  background: #8b8685;\\n  border: 1px outset #aba6a5;\\n  font: inherit;\\n  font-size: 1.5em;\\n  color: #e9e8e7;\\n  display: block;\\n  width: 100%;\\n  box-sizing: border-box;\\n}\\n.GameShellScene a {\\n  color: #fed;\\n}\", \"\"]);\n\n// exports\n","import './BenchmarkPanel.scss'\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default class BenchmarkPanel extends React.Component {\n  static propTypes = {\n    bench: PropTypes.object,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      show: false,\n      text: 'wow',\n    }\n  }\n\n  render() {\n    return (\n      <div\n        className='BenchmarkPanel'\n        onClick={this.handleInteraction}\n        onTouchStart={this.handleInteraction}\n      >\n        {this.state.show ? (\n          <article>\n            <b>Benchmark Stats</b>\n            <br />\n            {this.renderTable()}\n          </article>\n        ) : (\n          'Show Benchmark Stats'\n        )}\n      </div>\n    )\n  }\n\n  componentDidMount() {\n    setInterval(() => this.forceUpdate(), 1000)\n  }\n\n  renderTable = () => {\n    let stats = this.props.bench.stats\n    return (\n      <table>\n        <tbody>\n          {Object.keys(stats).map((key) => {\n            let stat = stats[key]\n            return (\n              <tr>\n                <td>\n                  <strong>{key}</strong>\n                </td>\n                <td align='right'>{'' + stat}</td>\n              </tr>\n            )\n          })}\n        </tbody>\n      </table>\n    )\n  }\n\n  handleInteraction = (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    this.setState({ show: !this.state.show })\n  }\n}\n","import now from 'bemuse/utils/now'\nimport { shouldEnableBenchmark } from './query-flags'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport BenchmarkPanel from './ui/BenchmarkPanel'\n\nfunction Stat() {\n  let sum = 0\n  let count = 0\n  let average = 0\n  let hist = []\n  let lastSec = 0\n  let secAvg = 0\n  return {\n    push: function (delta) {\n      let t = now()\n      sum += delta\n      count += 1\n      average = sum / count\n      lastSec += delta\n      hist.push({ delta, time: t })\n      while (hist[0] && hist[0].time < t - 1000) {\n        lastSec -= hist.shift().delta\n      }\n      secAvg = lastSec / hist.length\n    },\n    toString() {\n      return format(average) + ' / ' + format(secAvg)\n    },\n  }\n}\n\nfunction format(x) {\n  return x.toFixed(2) + 'ms'\n}\n\nfunction Benchmarker() {\n  var stats = {}\n  let bench = {\n    enabled: true,\n    stats,\n    wrap(title, f) {\n      return function () {\n        try {\n          var start = now()\n          return f.apply(this, arguments)\n        } finally {\n          var finish = now()\n          var stat = stats[title] || (stats[title] = new Stat(title))\n          stat.push(finish - start)\n        }\n      }\n    },\n    benchmark(title, obj, name) {\n      obj[name] = this.wrap(title, obj[name])\n    },\n    toString() {\n      var lines = []\n      Object.keys(stats).forEach(function (key) {\n        lines.push('- ' + key + ': ' + stats[key])\n      })\n      return lines.join('\\n')\n    },\n  }\n  let div = document.createElement('div')\n  div.setAttribute('style', 'position:fixed;top:10px;right:10px;z-index:99999')\n  document.body.appendChild(div)\n  ReactDOM.render(<BenchmarkPanel bench={bench} />, div)\n  return bench\n}\n\nfunction FakeBenchmarker() {\n  return {\n    enabled: false,\n    wrap: (title, f) => f,\n  }\n}\n\nexport default window.BEMUSE_BENCHMARK = shouldEnableBenchmark()\n  ? new Benchmarker()\n  : new FakeBenchmarker()\n","(function (global, undefined) {\n    \"use strict\";\n\n    if (global.setImmediate) {\n        return;\n    }\n\n    var nextHandle = 1; // Spec says greater than zero\n    var tasksByHandle = {};\n    var currentlyRunningATask = false;\n    var doc = global.document;\n    var registerImmediate;\n\n    function setImmediate(callback) {\n      // Callback can either be a function or a string\n      if (typeof callback !== \"function\") {\n        callback = new Function(\"\" + callback);\n      }\n      // Copy function arguments\n      var args = new Array(arguments.length - 1);\n      for (var i = 0; i < args.length; i++) {\n          args[i] = arguments[i + 1];\n      }\n      // Store and register the task\n      var task = { callback: callback, args: args };\n      tasksByHandle[nextHandle] = task;\n      registerImmediate(nextHandle);\n      return nextHandle++;\n    }\n\n    function clearImmediate(handle) {\n        delete tasksByHandle[handle];\n    }\n\n    function run(task) {\n        var callback = task.callback;\n        var args = task.args;\n        switch (args.length) {\n        case 0:\n            callback();\n            break;\n        case 1:\n            callback(args[0]);\n            break;\n        case 2:\n            callback(args[0], args[1]);\n            break;\n        case 3:\n            callback(args[0], args[1], args[2]);\n            break;\n        default:\n            callback.apply(undefined, args);\n            break;\n        }\n    }\n\n    function runIfPresent(handle) {\n        // From the spec: \"Wait until any invocations of this algorithm started before this one have completed.\"\n        // So if we're currently running a task, we'll need to delay this invocation.\n        if (currentlyRunningATask) {\n            // Delay by doing a setTimeout. setImmediate was tried instead, but in Firefox 7 it generated a\n            // \"too much recursion\" error.\n            setTimeout(runIfPresent, 0, handle);\n        } else {\n            var task = tasksByHandle[handle];\n            if (task) {\n                currentlyRunningATask = true;\n                try {\n                    run(task);\n                } finally {\n                    clearImmediate(handle);\n                    currentlyRunningATask = false;\n                }\n            }\n        }\n    }\n\n    function installNextTickImplementation() {\n        registerImmediate = function(handle) {\n            process.nextTick(function () { runIfPresent(handle); });\n        };\n    }\n\n    function canUsePostMessage() {\n        // The test against `importScripts` prevents this implementation from being installed inside a web worker,\n        // where `global.postMessage` means something completely different and can't be used for this purpose.\n        if (global.postMessage && !global.importScripts) {\n            var postMessageIsAsynchronous = true;\n            var oldOnMessage = global.onmessage;\n            global.onmessage = function() {\n                postMessageIsAsynchronous = false;\n            };\n            global.postMessage(\"\", \"*\");\n            global.onmessage = oldOnMessage;\n            return postMessageIsAsynchronous;\n        }\n    }\n\n    function installPostMessageImplementation() {\n        // Installs an event handler on `global` for the `message` event: see\n        // * https://developer.mozilla.org/en/DOM/window.postMessage\n        // * http://www.whatwg.org/specs/web-apps/current-work/multipage/comms.html#crossDocumentMessages\n\n        var messagePrefix = \"setImmediate$\" + Math.random() + \"$\";\n        var onGlobalMessage = function(event) {\n            if (event.source === global &&\n                typeof event.data === \"string\" &&\n                event.data.indexOf(messagePrefix) === 0) {\n                runIfPresent(+event.data.slice(messagePrefix.length));\n            }\n        };\n\n        if (global.addEventListener) {\n            global.addEventListener(\"message\", onGlobalMessage, false);\n        } else {\n            global.attachEvent(\"onmessage\", onGlobalMessage);\n        }\n\n        registerImmediate = function(handle) {\n            global.postMessage(messagePrefix + handle, \"*\");\n        };\n    }\n\n    function installMessageChannelImplementation() {\n        var channel = new MessageChannel();\n        channel.port1.onmessage = function(event) {\n            var handle = event.data;\n            runIfPresent(handle);\n        };\n\n        registerImmediate = function(handle) {\n            channel.port2.postMessage(handle);\n        };\n    }\n\n    function installReadyStateChangeImplementation() {\n        var html = doc.documentElement;\n        registerImmediate = function(handle) {\n            // Create a <script> element; its readystatechange event will be fired asynchronously once it is inserted\n            // into the document. Do so, thus queuing up the task. Remember to clean up once it's been called.\n            var script = doc.createElement(\"script\");\n            script.onreadystatechange = function () {\n                runIfPresent(handle);\n                script.onreadystatechange = null;\n                html.removeChild(script);\n                script = null;\n            };\n            html.appendChild(script);\n        };\n    }\n\n    function installSetTimeoutImplementation() {\n        registerImmediate = function(handle) {\n            setTimeout(runIfPresent, 0, handle);\n        };\n    }\n\n    // If supported, we should attach to the prototype of global, since that is where setTimeout et al. live.\n    var attachTo = Object.getPrototypeOf && Object.getPrototypeOf(global);\n    attachTo = attachTo && attachTo.setTimeout ? attachTo : global;\n\n    // Don't get fooled by e.g. browserify environments.\n    if ({}.toString.call(global.process) === \"[object process]\") {\n        // For Node.js before 0.9\n        installNextTickImplementation();\n\n    } else if (canUsePostMessage()) {\n        // For non-IE10 modern browsers\n        installPostMessageImplementation();\n\n    } else if (global.MessageChannel) {\n        // For web workers, where supported\n        installMessageChannelImplementation();\n\n    } else if (doc && \"onreadystatechange\" in doc.createElement(\"script\")) {\n        // For IE 68\n        installReadyStateChangeImplementation();\n\n    } else {\n        // For older browsers\n        installSetTimeoutImplementation();\n    }\n\n    attachTo.setImmediate = setImmediate;\n    attachTo.clearImmediate = clearImmediate;\n}(typeof self === \"undefined\" ? typeof global === \"undefined\" ? this : global : self));\n","import React from 'react'\nimport ReactDOM from 'react-dom'\nimport MAIN from 'bemuse/utils/main-element'\n\n// The SceneManager takes care of managing the scenes in this game.\n// Only a single scene may be displayed at any given time, but a scene may\n// contain any number of UI elements.\n//\n// A scene is a React component that renders a ``<Scene>``::\n//\n//    export default React.createClass({\n//      render() {\n//        return <Scene>contents</Scene>\n//      }\n//    })\n//\n// Behind the scene, are using some advanced techniques which requires\n// the scene class to be declared using ``React.createClass`` (not by extending\n// ``React.Component``)\n//\n// To use the SceneManager, get the instance and use it::\n//\n//    import SCENE_MANAGER from 'bemuse/scene-manager'\n//    import TitleScene from './TitleScene'\n//    SCENE_MANAGER.display(<TitleScene />)\n//\n// Non-React Scene\n//   You can also use a scene that is not React-based. Define your scene\n//   as a function that accepts an HTMLElement and returns an object with a\n//   ``teardown()`` method.\n//\nexport class SceneManager {\n  constructor() {\n    this._transitioning = false\n    this._stack = []\n  }\n\n  // Displays the scene and returns a promise that resolves when the old\n  // scene finishes exiting.\n  display(scene) {\n    return this._transitionTo(() => {\n      return scene\n    })\n  }\n\n  // Displays the scene, while remembering the previous scene.\n  push(scene) {\n    let previousScene = this.currentScene\n    return this._transitionTo(() => {\n      this._stack.push(previousScene)\n      return scene\n    })\n  }\n\n  // Displays the previous scene.\n  pop() {\n    return this._transitionTo(() => {\n      return this._stack.pop()\n    })\n  }\n\n  async _transitionTo(getNextScene) {\n    if (this._transitioning) throw new Error('Scene is transitioning!')\n    try {\n      this._transitioning = true\n\n      // detach the previous scene\n      if (this.currentSceneInstance) {\n        await Promise.resolve(this.currentSceneInstance.teardown())\n        detach(this.currentElement)\n      }\n\n      // obtain the next scene\n      let scene = getNextScene()\n\n      // coerce react elements\n      if (typeof scene !== 'function') {\n        scene = new ReactScene(scene, this.ReactSceneContainer)\n      }\n\n      // set up the next scene\n      var element = document.createElement('div')\n      element.className = 'scene-manager--scene'\n      MAIN.appendChild(element)\n      this.currentElement = element\n      this.currentScene = scene\n      this.currentSceneInstance = scene(element)\n    } finally {\n      this._transitioning = false\n    }\n  }\n}\n\nfunction detach(element) {\n  if (element && element.parentNode === MAIN) {\n    MAIN.removeChild(element)\n  }\n}\n\n// The shared SceneManager instance.\nexport let instance = new SceneManager()\n\nexport default instance\n\nfunction ReactScene(element, ReactSceneContainer) {\n  return function instantiate(container) {\n    let teardown = () => {}\n    const clonedElement = React.cloneElement(element, {\n      scene: element,\n      registerTeardownCallback: (callback) => {\n        teardown = callback\n      },\n    })\n    const elementToDisplay = ReactSceneContainer ? (\n      <ReactSceneContainer>{clonedElement}</ReactSceneContainer>\n    ) : (\n      clonedElement\n    )\n    ReactDOM.render(elementToDisplay, container)\n    return {\n      teardown() {\n        return Promise.try(() => {\n          return teardown()\n        }).finally(() => {\n          ReactDOM.unmountComponentAtNode(container)\n        })\n      },\n    }\n  }\n}\n","import './GameShellScene.scss'\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport DndResources from 'bemuse/resources/dnd-resources'\nimport c from 'classnames'\n\nclass CustomChartSelector extends React.Component {\n  static propTypes = {\n    selectedResource: PropTypes.any,\n    onSelect: PropTypes.func,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      files: [],\n    }\n  }\n\n  render() {\n    let files = this.state.files\n    return (\n      <div className='drop-zone'>\n        {files.length ? (\n          <ul>\n            {files.map((file) => (\n              <li>\n                <a\n                  href='javascript://'\n                  onClick={this.handleItemClick}\n                  className={c({\n                    'is-active': file.resource === this.props.selectedResource,\n                  })}\n                >\n                  {file.name}\n                </a>\n              </li>\n            ))}\n            {this.props.selectedResource ? (\n              <li>\n                <a href='javascript://' onClick={this.handleClear}>\n                  Clear\n                </a>\n              </li>\n            ) : null}\n          </ul>\n        ) : (\n          <div className='drop-zone-hint'>\n            Drop BMS folder here\n            <br />\n            (only works on Google Chrome)\n          </div>\n        )}\n      </div>\n    )\n  }\n\n  handleDrop = (e) => {\n    e.preventDefault()\n    let event = e.nativeEvent\n    let resources = new DndResources(event)\n    resources.fileList\n      .then((list) => {\n        return list.filter((filename) => /\\.(bms|bme|bml)$/i.test(filename))\n      })\n      .map((name) =>\n        resources.file(name).then((resource) => ({ name, resource }))\n      )\n      .then((bms) => {\n        this.setState({ files: bms, resources: resources })\n      })\n      .catch((err) => {\n        if (err.constructor.name === 'FileError') {\n          throw new Error('File Error code ' + e.code)\n        } else {\n          throw err\n        }\n      })\n      .done()\n  }\n\n  handleItemClick = (file) => {\n    return () => {\n      this.props.onSelect(this.state.resources, file.resource)\n    }\n  }\n\n  handleClear = () => {\n    this.props.onSelect(null, null)\n  }\n}\n\nexport default class GameShellScene extends React.Component {\n  static propTypes = {\n    options: PropTypes.object,\n    play: PropTypes.func,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      options: this.props.options,\n    }\n  }\n\n  render() {\n    let options = this.state.options\n    return (\n      <div\n        className='GameShellScene'\n        onDragOver={this.handleDragOver}\n        onDrop={this.handleDrop}\n      >\n        <h1>Bemuse Game Shell</h1>\n        <p>This tool is intended for developers testing the game.</p>\n        <form onSubmit={this.submit}>\n          <div className='text'>\n            <label>\n              <span className='label'>BMS URL:</span>\n              <input\n                type='text'\n                disabled={options.resource}\n                onChange={this.bindOption((o, v) => (o.url = v))}\n                value={options.url}\n              />\n            </label>\n          </div>\n          <div className='text'>\n            <label>\n              <span className='label'>-or- Drop BMS folder here</span>\n              <CustomChartSelector\n                ref='dropzone'\n                selectedResource={options.resource}\n                onSelect={this.handleSelectFile}\n              />\n            </label>\n          </div>\n          <div className='text'>\n            <label>\n              <span className='label'>Audio-Input Latency</span>\n              <input\n                type='text'\n                onChange={this.bindOption(\n                  (o, v) => (o.game.audioInputLatency = v)\n                )}\n                value={options.game.audioInputLatency}\n              />\n            </label>\n          </div>\n          <div className='text'>\n            <label>\n              <span className='label'>HI-SPEED:</span>\n              <input\n                type='text'\n                onChange={this.bindOption((o, v) => (o.players[0].speed = v))}\n                value={options.players[0].speed}\n              />\n            </label>\n          </div>\n          <div className='radio'>\n            <h3>Placement</h3>\n            {['left', 'center', 'right'].map((placement) => (\n              <label>\n                <input\n                  type='radio'\n                  value={placement}\n                  onChange={this.bindOption(\n                    (o, v) => (o.players[0].placement = v)\n                  )}\n                  checked={options.players[0].placement === placement}\n                />\n                <span className='label'>{placement}</span>\n              </label>\n            ))}\n          </div>\n          <button type='submit'>Play</button>\n        </form>\n      </div>\n    )\n  }\n\n  submit = (e) => {\n    e.preventDefault()\n    this.props.play(this.state.options)\n  }\n\n  bindOption = (binder) => {\n    return (event) => {\n      binder(this.state.options, event.target.value)\n      this.forceUpdate()\n    }\n  }\n\n  handleDragOver = (e) => {\n    e.preventDefault()\n  }\n\n  handleDrop = (e) => {\n    e.preventDefault()\n    this.refs.dropzone.handleDrop(e)\n  }\n\n  handleSelectFile = (resources, resource) => {\n    this.setState({\n      options: Object.assign(this.state.options, { resources, resource }),\n    })\n    this.forceUpdate()\n  }\n}\n","import BemusePackageResources from 'bemuse/resources/bemuse-package'\nimport React from 'react'\nimport SCENE_MANAGER from 'bemuse/scene-manager'\nimport URLResource from 'bemuse/resources/url'\nimport audioContext from 'bemuse/audio-context'\nimport query from 'bemuse/utils/query'\nimport { resolveUrl } from 'url'\nimport { unmuteAudio } from 'bemuse/sampling-master'\n\nimport * as GameLoader from './loaders/game-loader'\nimport GameScene from './game-scene'\nimport GameShellScene from './ui/GameShellScene.jsx'\nimport LoadingScene from './ui/LoadingScene.jsx'\n\nexport async function main() {\n  // iOS\n  window.addEventListener('touchstart', function unmute() {\n    unmuteAudio(audioContext)\n    window.removeEventListener('touchstart', unmute)\n  })\n\n  let displayShell = function (options) {\n    return new Promise(function (resolve) {\n      let scene = React.createElement(GameShellScene, {\n        options: options,\n        play: function (data) {\n          resolve(data)\n        },\n      })\n      SCENE_MANAGER.display(scene).done()\n    })\n  }\n\n  let getSong = async function () {\n    let kbm = (query.keyboard || '').split(',').map((x) => +x)\n    let options = {\n      url: query.bms || '/music/[snack]dddd/dddd_sph.bme',\n      game: {\n        audioInputLatency: +query.latency || 0,\n      },\n      players: [\n        {\n          speed: +query.speed || 3,\n          autoplay: !!query.autoplay,\n          placement: 'center',\n          scratch: query.scratch || 'left',\n          input: {\n            keyboard: {\n              1: kbm[0] || 83,\n              2: kbm[1] || 68,\n              3: kbm[2] || 70,\n              4: kbm[3] || 32,\n              5: kbm[4] || 74,\n              6: kbm[5] || 75,\n              7: kbm[6] || 76,\n              SC: kbm[7] || 65,\n              SC2: kbm[8] || 16,\n            },\n          },\n        },\n      ],\n    }\n    options = await displayShell(options)\n    let url = options.url\n    let assetsUrl = resolveUrl(url, 'assets/')\n    let metadata = {\n      title: 'Loading',\n      subtitles: [],\n      artist: '',\n      genre: '',\n      subartists: [],\n    }\n    return {\n      bms: options.resource || new URLResource(url),\n      assets: options.resources || new BemusePackageResources(assetsUrl),\n      metadata: metadata,\n      options: Object.assign({}, options.game, { players: options.players }),\n    }\n  }\n\n  let loadSpec = await getSong()\n  let { tasks, promise } = GameLoader.load(loadSpec)\n  await SCENE_MANAGER.display(\n    React.createElement(LoadingScene, {\n      tasks: tasks,\n      song: loadSpec.metadata,\n    })\n  )\n  let controller = await promise\n  await SCENE_MANAGER.display(new GameScene(controller.display))\n  controller.start()\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getReaderOptionsFromFilename = exports.readAsync = exports.read = void 0;\nvar chardet = require(\"bemuse-chardet/bemuse-chardet\");\nfunction read(buffer) {\n    throw new Error('Synchronous read unsupported in browser!');\n}\nexports.read = read;\nfunction readAsync() {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n    }\n    var buffer = args[0];\n    var options = args[1];\n    var callback = args[2];\n    if (callback) {\n        options = args[1];\n        callback = args[2];\n    }\n    else {\n        options = null;\n        callback = args[1];\n    }\n    var charset = (options && options.forceEncoding) || chardet.detect(buffer);\n    var reader = new FileReader();\n    reader.onload = function () {\n        callback(null, reader.result);\n    };\n    reader.onerror = function () {\n        callback(new Error('cannot read it'));\n    };\n    reader.readAsText(new Blob([buffer]), charset);\n}\nexports.readAsync = readAsync;\nvar getReaderOptionsFromFilename_1 = require(\"./getReaderOptionsFromFilename\");\nObject.defineProperty(exports, \"getReaderOptionsFromFilename\", { enumerable: true, get: function () { return getReaderOptionsFromFilename_1.getReaderOptionsFromFilename; } });\n//# sourceMappingURL=index.web.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getReaderOptionsFromFilename = void 0;\n/**\n * Given the filename, returns the reader options.\n * @param {string} filename\n */\nfunction getReaderOptionsFromFilename(filename) {\n    var forceEncoding;\n    if (filename.match(/\\.sjis\\.\\w+$/i)) {\n        forceEncoding = 'Shift-JIS';\n    }\n    if (filename.match(/\\.euc_kr\\.\\w+$/i)) {\n        forceEncoding = 'EUC-KR';\n    }\n    if (filename.match(/\\.utf8\\.\\w+$/i)) {\n        forceEncoding = 'UTF-8';\n    }\n    return { forceEncoding: forceEncoding };\n}\nexports.getReaderOptionsFromFilename = getReaderOptionsFromFilename;\n//# sourceMappingURL=getReaderOptionsFromFilename.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.compile = void 0;\n// Public: A module that takes a string representing the BMS notechart,\n// parses it, and compiles into a {BMSChart}.\n/* module */\nvar match_1 = require(\"../util/match\");\nvar chart_1 = require(\"../bms/chart\");\nvar matchers = {\n    bms: {\n        random: /^#RANDOM\\s+(\\d+)$/i,\n        if: /^#IF\\s+(\\d+)$/i,\n        endif: /^#ENDIF$/i,\n        timeSignature: /^#(\\d\\d\\d)02:(\\S*)$/,\n        channel: /^#(?:EXT\\s+#)?(\\d\\d\\d)(\\S\\S):(\\S*)$/,\n        header: /^#(\\w+)(?:\\s+(\\S.*))?$/,\n    },\n    dtx: {\n        random: /^#RANDOM\\s+(\\d+)$/i,\n        if: /^#IF\\s+(\\d+)$/i,\n        endif: /^#ENDIF$/i,\n        timeSignature: /^#(\\d\\d\\d)02:\\s*(\\S*)$/,\n        channel: /^#(?:EXT\\s+#)?(\\d\\d\\d)(\\S\\S):\\s*(\\S*)$/,\n        header: /^#(\\w+):(?:\\s+(\\S.*))?$/,\n    },\n};\n/**\n * Reads the string representing the BMS notechart, parses it,\n * and compiles into a {BMSChart}.\n * @param text the BMS notechart\n * @param options additional parser options\n */\nfunction compile(text, options) {\n    options = options || {};\n    var chart = new chart_1.BMSChart();\n    var rng = options.rng ||\n        function (max) {\n            return 1 + Math.floor(Math.random() * max);\n        };\n    var matcher = (options.format && matchers[options.format]) || matchers.bms;\n    var randomStack = [];\n    var skipStack = [false];\n    var result = {\n        headerSentences: 0,\n        channelSentences: 0,\n        controlSentences: 0,\n        skippedSentences: 0,\n        malformedSentences: 0,\n        /**\n         * The resulting chart\n         */\n        chart: chart,\n        /**\n         * Warnings found during compilation\n         */\n        warnings: [],\n    };\n    eachLine(text, function (text, lineNumber) {\n        var flow = true;\n        if (text.charAt(0) !== '#')\n            return;\n        (0, match_1.match)(text)\n            .when(matcher.random, function (m) {\n            result.controlSentences += 1;\n            randomStack.push(rng(+m[1]));\n        })\n            .when(matcher.if, function (m) {\n            result.controlSentences += 1;\n            skipStack.push(randomStack[randomStack.length - 1] !== +m[1]);\n        })\n            .when(matcher.endif, function (m) {\n            result.controlSentences += 1;\n            skipStack.pop();\n        })\n            .else(function () {\n            flow = false;\n        });\n        if (flow)\n            return;\n        var skipped = skipStack[skipStack.length - 1];\n        (0, match_1.match)(text)\n            .when(matcher.timeSignature, function (m) {\n            result.channelSentences += 1;\n            if (!skipped)\n                chart.timeSignatures.set(+m[1], +m[2]);\n        })\n            .when(matcher.channel, function (m) {\n            result.channelSentences += 1;\n            if (!skipped)\n                handleChannelSentence(+m[1], m[2], m[3], lineNumber);\n        })\n            .when(matcher.header, function (m) {\n            result.headerSentences += 1;\n            if (!skipped)\n                chart.headers.set(m[1], m[2]);\n        })\n            .else(function () {\n            warn(lineNumber, 'Invalid command');\n        });\n    });\n    return result;\n    function handleChannelSentence(measure, channel, string, lineNumber) {\n        var items = Math.floor(string.length / 2);\n        if (items === 0)\n            return;\n        for (var i = 0; i < items; i++) {\n            var value = string.substr(i * 2, 2);\n            var fraction = i / items;\n            if (value === '00')\n                continue;\n            chart.objects.add({\n                measure: measure,\n                fraction: fraction,\n                value: value,\n                channel: channel,\n                lineNumber: lineNumber,\n            });\n        }\n    }\n    function warn(lineNumber, message) {\n        result.warnings.push({\n            lineNumber: lineNumber,\n            message: message,\n        });\n    }\n}\nexports.compile = compile;\nfunction eachLine(text, callback) {\n    text\n        .split(/\\r\\n|\\r|\\n/)\n        .map(function (line) {\n        return line.trim();\n    })\n        .forEach(function (line, index) {\n        callback(line, index + 1);\n    });\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Segment = void 0;\nvar data_structure_1 = __importDefault(require(\"data-structure\"));\nexports.Segment = (0, data_structure_1.default)({\n    t: 'number',\n    x: 'number',\n    dx: 'number',\n});\n//# sourceMappingURL=segment.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notes = void 0;\nvar note_1 = require(\"./note\");\nvar invariant_1 = __importDefault(require(\"invariant\"));\nvar ChannelMapping = __importStar(require(\"./channels\"));\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A Notes holds the {Note} objects in the game.\n * A note object may or may not be playable.\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #00111:AA\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {Notes} using `fromBMSChart()`:\n *\n * ```js\n * var notes = Notes.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can get all notes using `.all()` method\n *\n * ```js\n * notes.all()\n * ```\n */\nvar Notes = /** @class */ (function () {\n    /**\n     * @param {BMSNote[]} notes An array of Note objects\n     */\n    function Notes(notes) {\n        notes.forEach(note_1.Note);\n        this._notes = notes;\n    }\n    /**\n     * Returns the number of notes in this object,\n     * counting both playable and non-playable notes.\n     */\n    Notes.prototype.count = function () {\n        return this._notes.length;\n    };\n    /**\n     * Returns an Array of all notes.\n     */\n    Notes.prototype.all = function () {\n        return this._notes.slice();\n    };\n    /**\n     * Creates a Notes object from a BMSChart.\n     * @param chart the chart to process\n     * @param options options\n     */\n    Notes.fromBMSChart = function (chart, options) {\n        void chart_1.BMSChart;\n        options = options || {};\n        var mapping = options.mapping || Notes.CHANNEL_MAPPING.IIDX_P1;\n        var builder = new BMSNoteBuilder(chart, { mapping: mapping });\n        return builder.build();\n    };\n    Notes.CHANNEL_MAPPING = ChannelMapping;\n    return Notes;\n}());\nexports.Notes = Notes;\nvar BMSNoteBuilder = /** @class */ (function () {\n    function BMSNoteBuilder(chart, options) {\n        this._chart = chart;\n        (0, invariant_1.default)(options.mapping, 'Expected options.mapping');\n        (0, invariant_1.default)(typeof options.mapping === 'object', 'options.mapping must be object');\n        this._mapping = options.mapping;\n        this._notes = [];\n        this._activeLN = {};\n        this._lastNote = {};\n        this._lnObj = (this._chart.headers.get('lnobj') || '').toLowerCase();\n        this._channelMapping = this._mapping;\n        this._objects = this._chart.objects.allSorted();\n    }\n    BMSNoteBuilder.prototype.build = function () {\n        var _this = this;\n        this._objects.forEach(function (object) {\n            _this._handle(object);\n        });\n        return new Notes(this._notes);\n    };\n    BMSNoteBuilder.prototype._handle = function (object) {\n        if (object.channel === '01') {\n            this._handleNormalNote(object);\n        }\n        else {\n            switch (object.channel.charAt(0).toUpperCase()) {\n                case '1':\n                case '2':\n                case 'D':\n                case 'E':\n                    this._handleNormalNote(object);\n                    break;\n                case '5':\n                case '6':\n                    this._handleLongNote(object);\n                    break;\n            }\n        }\n    };\n    BMSNoteBuilder.prototype._handleNormalNote = function (object) {\n        var channel = this._normalizeChannel(object.channel);\n        var beat = this._getBeat(object);\n        if (object.value.toLowerCase() === this._lnObj) {\n            if (this._lastNote[channel]) {\n                this._lastNote[channel].endBeat = beat;\n            }\n        }\n        else {\n            var note = {\n                beat: beat,\n                endBeat: undefined,\n                keysound: object.value,\n                column: this._getColumn(channel),\n            };\n            this._lastNote[channel] = note;\n            this._notes.push(note);\n        }\n    };\n    BMSNoteBuilder.prototype._handleLongNote = function (object) {\n        var channel = this._normalizeChannel(object.channel);\n        var beat = this._getBeat(object);\n        if (this._activeLN[channel]) {\n            var note = this._activeLN[channel];\n            note.endBeat = beat;\n            this._notes.push(note);\n            delete this._activeLN[channel];\n        }\n        else {\n            this._activeLN[channel] = {\n                beat: beat,\n                keysound: object.value,\n                column: this._getColumn(channel),\n            };\n        }\n    };\n    BMSNoteBuilder.prototype._getBeat = function (object) {\n        return this._chart.measureToBeat(object.measure, object.fraction);\n    };\n    BMSNoteBuilder.prototype._getColumn = function (channel) {\n        return this._channelMapping[channel];\n    };\n    BMSNoteBuilder.prototype._normalizeChannel = function (channel) {\n        return channel.replace(/^5/, '1').replace(/^6/, '2');\n    };\n    return BMSNoteBuilder;\n}());\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Note = void 0;\nvar data_structure_1 = __importDefault(require(\"data-structure\"));\nexports.Note = (0, data_structure_1.default)({\n    beat: 'number',\n    endBeat: data_structure_1.default.maybe('number'),\n    column: data_structure_1.default.maybe('string'),\n    keysound: 'string',\n});\n//# sourceMappingURL=note.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.IIDX_DP_LANDMINE = exports.IIDX_P1_LANDMINE = exports.IIDX_DP = exports.IIDX_P1 = void 0;\nexports.IIDX_P1 = {\n    '11': '1',\n    '12': '2',\n    '13': '3',\n    '14': '4',\n    '15': '5',\n    '18': '6',\n    '19': '7',\n    '16': 'SC',\n};\nexports.IIDX_DP = {\n    '11': '1',\n    '12': '2',\n    '13': '3',\n    '14': '4',\n    '15': '5',\n    '18': '6',\n    '19': '7',\n    '16': 'SC',\n    '21': '8',\n    '22': '9',\n    '23': '10',\n    '24': '11',\n    '25': '12',\n    '28': '13',\n    '29': '14',\n    '26': 'SC2',\n};\nexports.IIDX_P1_LANDMINE = {\n    D1: '1',\n    D2: '2',\n    D3: '3',\n    D4: '4',\n    D5: '5',\n    D8: '6',\n    D9: '7',\n    D6: 'SC',\n};\nexports.IIDX_DP_LANDMINE = {\n    D1: '1',\n    D2: '2',\n    D3: '3',\n    D4: '4',\n    D5: '5',\n    D8: '6',\n    D9: '7',\n    D6: 'SC',\n    E1: '8',\n    E2: '9',\n    E3: '10',\n    E4: '11',\n    E5: '12',\n    E8: '13',\n    E9: '14',\n    E6: 'SC2',\n};\n//# sourceMappingURL=channels.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Timing = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\nvar precedence = { bpm: 1, stop: 2 };\n/**\n * A Timing represents the timing information of a musical score.\n * A Timing object provides facilities to synchronize between\n * metric time (seconds) and musical time (beats).\n *\n * A Timing are created from a series of actions:\n *\n * - BPM changes.\n * - STOP action.\n */\nvar Timing = /** @class */ (function () {\n    /**\n     * Constructs a Timing with an initial BPM and specified actions.\n     *\n     * Generally, you would use `Timing.fromBMSChart` to create an instance\n     * from a BMSChart, but the constructor may also be used in other situations\n     * unrelated to the BMS file format. (e.g. bmson package)\n     */\n    function Timing(initialBPM, actions) {\n        var state = { bpm: initialBPM, beat: 0, seconds: 0 };\n        var segments = [];\n        segments.push({\n            t: 0,\n            x: 0,\n            dx: state.bpm / 60,\n            bpm: state.bpm,\n            inclusive: true,\n        });\n        actions = actions.slice();\n        actions.sort(function (a, b) {\n            return a.beat - b.beat || precedence[a.type] - precedence[b.type];\n        });\n        actions.forEach(function (action) {\n            var beat = action.beat;\n            var seconds = state.seconds + ((beat - state.beat) * 60) / state.bpm;\n            switch (action.type) {\n                case 'bpm':\n                    state.bpm = action.bpm;\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: state.bpm / 60,\n                        bpm: state.bpm,\n                        inclusive: true,\n                    });\n                    break;\n                case 'stop':\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: 0,\n                        bpm: state.bpm,\n                        inclusive: true,\n                    });\n                    seconds += ((action.stopBeats || 0) * 60) / state.bpm;\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: state.bpm / 60,\n                        bpm: state.bpm,\n                        inclusive: false,\n                    });\n                    break;\n                default:\n                    throw new Error('Unrecognized segment object!');\n            }\n            state.beat = beat;\n            state.seconds = seconds;\n        });\n        this._speedcore = new speedcore_1.Speedcore(segments);\n        this._eventBeats = (0, lodash_1.uniq)((0, lodash_1.map)(actions, function (action) { return action.beat; }));\n    }\n    /**\n     * Convert the given beat into seconds.\n     * @param {number} beat\n     */\n    Timing.prototype.beatToSeconds = function (beat) {\n        return this._speedcore.t(beat);\n    };\n    /**\n     * Convert the given second into beats.\n     * @param {number} seconds\n     */\n    Timing.prototype.secondsToBeat = function (seconds) {\n        return this._speedcore.x(seconds);\n    };\n    /**\n     * Returns the BPM at the specified beat.\n     * @param {number} beat\n     */\n    Timing.prototype.bpmAtBeat = function (beat) {\n        return this._speedcore.segmentAtX(beat).bpm;\n    };\n    /**\n     * Returns an array representing the beats where there are events.\n     */\n    Timing.prototype.getEventBeats = function () {\n        return this._eventBeats;\n    };\n    /**\n     * Creates a Timing instance from a BMSChart.\n     * @param {BMSChart} chart\n     */\n    Timing.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var actions = [];\n        chart.objects.all().forEach(function (object) {\n            var bpm;\n            var beat = chart.measureToBeat(object.measure, object.fraction);\n            if (object.channel === '03') {\n                bpm = parseInt(object.value, 16);\n                actions.push({ type: 'bpm', beat: beat, bpm: bpm });\n            }\n            else if (object.channel === '08') {\n                bpm = +chart.headers.get('bpm' + object.value);\n                if (!isNaN(bpm))\n                    actions.push({ type: 'bpm', beat: beat, bpm: bpm });\n            }\n            else if (object.channel === '09') {\n                var stopBeats = +chart.headers.get('stop' + object.value) / 48;\n                actions.push({ type: 'stop', beat: beat, stopBeats: stopBeats });\n            }\n        });\n        return new Timing(+chart.headers.get('bpm') || 60, actions);\n    };\n    return Timing;\n}());\nexports.Timing = Timing;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SongInfo = void 0;\nvar match_1 = require(\"../util/match\");\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A SongInfo represents the song info, such as title, artist, genre.\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #TITLE Exargon [HYPER]\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {SongInfo} using `fromBMSChart()`:\n *\n * ```js\n * var info = SongInfo.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can query the song information by accessing its properties.\n *\n * ```js\n * info.title     // => 'Exargon'\n * info.subtitles // => ['HYPER']\n * ```\n */\nvar SongInfo = /** @class */ (function () {\n    /**\n     * Constructs a SongInfo with given data\n     * @param info the properties to set on this new instance\n     */\n    function SongInfo(info) {\n        /** the song title */\n        this.title = 'NO TITLE';\n        /** the song artist */\n        this.artist = 'NO ARTIST';\n        /** the song genre */\n        this.genre = 'NO GENRE';\n        /**\n         * the song's subtitles, one line per element.\n         * The subtitle may be used to represent the difficulty name,\n         * such as NORMAL, HYPER, ANOTHER.\n         * @type {string[]}\n         */\n        this.subtitles = [];\n        /**\n         * the song's other artists, one artist per element.\n         * @type {string[]}\n         */\n        this.subartists = [];\n        /**\n         * the difficulty.\n         * Meaning of the number is same as BMS's [`#DIFFICULTY`](http:*hitkey.nekokan.dyndns.info/cmds.htm#DIFFICULTY) header.\n         *\n         * | difficulty | meaning  |\n         * | ----------:|:--------:|\n         * |          1 | BEGINNER |\n         * |          2 | NORMAL   |\n         * |          3 | HYPER    |\n         * |          4 | ANOTHER  |\n         * |          5 | INSANE   |\n         */\n        this.difficulty = 0;\n        /**\n         * the level of the song.\n         * When converted from a BMS chart, this is the value of `#PLAYLEVEL` header.\n         */\n        this.level = 0;\n        if (info)\n            (0, lodash_1.assign)(this, info);\n    }\n    /**\n     * Constructs a new {SongInfo} object from a {BMSChart}.\n     * @param chart A {BMSChart} to construct a {SongInfo} from\n     */\n    SongInfo.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var info = {};\n        var title = chart.headers.get('title');\n        var artist = chart.headers.get('artist');\n        var genre = chart.headers.get('genre');\n        var difficulty = +chart.headers.get('difficulty') || 0;\n        var level = +chart.headers.get('playlevel') || 0;\n        var subtitles = chart.headers.getAll('subtitle');\n        var subartists = chart.headers.getAll('subartist');\n        if (typeof title === 'string' && !subtitles) {\n            var extractSubtitle = function (m) {\n                title = m[1];\n                subtitles = [m[2]];\n            };\n            (0, match_1.match)(title)\n                .when(/^(.*\\S)\\s*-(.+?)-$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*(.+?)$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*\\((.+?)\\)$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*\\[(.+?)\\]$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*<(.+?)>$/, extractSubtitle);\n        }\n        if (title)\n            info.title = title;\n        if (artist)\n            info.artist = artist;\n        if (genre)\n            info.genre = genre;\n        if (subtitles)\n            info.subtitles = subtitles;\n        if (subartists)\n            info.subartists = subartists;\n        if (difficulty)\n            info.difficulty = difficulty;\n        if (level)\n            info.level = level;\n        return new SongInfo(info);\n    };\n    return SongInfo;\n}());\nexports.SongInfo = SongInfo;\n//# sourceMappingURL=index.js.map","\"use strict\";\n// Public: A module that exposes {Keysounds}\n/* module */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Keysounds = void 0;\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A simple mapping between keysounds ID and the file name.\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #WAVAA cat.wav\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {Keysounds} using `fromBMSChart()`:\n *\n * ```js\n * var keysounds = Keysounds.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can retrieve the filename using `.get()`:\n *\n * ```js\n * keysounds.get('aa') // => 'cat.wav'\n * ```\n */\nvar Keysounds = /** @class */ (function () {\n    function Keysounds(map) {\n        this._map = map;\n    }\n    /**\n     * Returns the keysound file at the specified ID.\n     * @param id the two-character keysound ID\n     * @returns the sound filename\n     */\n    Keysounds.prototype.get = function (id) {\n        return this._map[id.toLowerCase()];\n    };\n    /**\n     * Returns an array of unique filenames in this Keysounds object.\n     * @returns filenames array\n     */\n    Keysounds.prototype.files = function () {\n        return (0, lodash_1.uniq)((0, lodash_1.values)(this._map));\n    };\n    /**\n     * Returns a mapping from keysound ID to keysound filename.\n     *\n     * **Warning:** This method returns the internal data structure used\n     * in this Keysounds object. Do not mutate!\n     */\n    Keysounds.prototype.all = function () {\n        return this._map;\n    };\n    /**\n     * Constructs a new {Keysounds} object from a {BMSChart}.\n     * @param chart\n     */\n    Keysounds.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var map = {};\n        chart.headers.each(function (name, value) {\n            var match = name.match(/^wav(\\S\\S)$/i);\n            if (!match)\n                return;\n            map[match[1].toLowerCase()] = value;\n        });\n        return new Keysounds(map);\n    };\n    return Keysounds;\n}());\nexports.Keysounds = Keysounds;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Positioning = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A Positioning represents the relation between song beats and\n * display position, and provides a way to convert between them.\n *\n * In some rhythm games, the amount of scrolling per beat may be different.\n * StepManias `#SCROLL` segments is an example.\n */\nvar Positioning = /** @class */ (function () {\n    /**\n     * Constructs a Positioning from the given `segments`.\n     * @param segments\n     */\n    function Positioning(segments) {\n        this._speedcore = new speedcore_1.Speedcore(segments);\n    }\n    /**\n     * Returns the scrolling speed at specified beat.\n     * @param beat the beat number\n     */\n    Positioning.prototype.speed = function (beat) {\n        return this._speedcore.dx(beat);\n    };\n    /**\n     * Returns the total elapsed scrolling amount at specified beat.\n     * @param beat the beat number\n     */\n    Positioning.prototype.position = function (beat) {\n        return this._speedcore.x(beat);\n    };\n    /**\n     * Creates a {Positioning} object from the {BMSChart}.\n     * @param {BMSChart} chart A {BMSChart} to construct a {Positioning} from\n     */\n    Positioning.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var segments = [];\n        var x = 0;\n        segments.push({\n            t: 0,\n            x: x,\n            dx: 1,\n            inclusive: true,\n        });\n        chart.objects.allSorted().forEach(function (object) {\n            if (object.channel === 'SC') {\n                var beat = chart.measureToBeat(object.measure, object.fraction);\n                var dx = +chart.headers.get('scroll' + object.value);\n                if (isNaN(dx))\n                    return;\n                var previous = segments[segments.length - 1];\n                x += (beat - previous.t) * previous.dx;\n                if (beat === 0 && segments.length === 1) {\n                    segments[0].dx = dx;\n                }\n                else {\n                    segments.push({\n                        t: beat,\n                        x: x,\n                        dx: dx,\n                        inclusive: true,\n                    });\n                }\n            }\n        });\n        return new Positioning(segments);\n    };\n    return Positioning;\n}());\nexports.Positioning = Positioning;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Spacing = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * Public: A Spacing represents the relation between song beats and\n * notes spacing.\n *\n * In some rhythm games, such as Pump It Up!,\n * the speed (note spacing factor) may be adjusted by the notechart.\n * StepManias `#SPEED` segments is an example.\n */\nvar Spacing = /** @class */ (function () {\n    /**\n     * Constructs a Spacing from the given `segments`.\n     */\n    function Spacing(segments) {\n        if (segments.length > 0) {\n            this._speedcore = new speedcore_1.Speedcore(segments);\n        }\n    }\n    /**\n     * Returns the note spacing factor at the specified beat.\n     * @param beat the beat\n     */\n    Spacing.prototype.factor = function (beat) {\n        if (this._speedcore) {\n            return this._speedcore.x(beat);\n        }\n        else {\n            return 1;\n        }\n    };\n    /**\n     * Creates a {Spacing} object from the {BMSChart}.\n     *\n     * ## `#SPEED` and `#xxxSP`\n     *\n     * Speed is defined as keyframes. These keyframes will be linearly interpolated.\n     *\n     * ```\n     * #SPEED01 1.0\n     * #SPEED02 2.0\n     *\n     * #001SP:01010202\n     * ```\n     *\n     * In this example, the note spacing factor will gradually change\n     * from 1.0x at beat 1 to 2.0x at beat 2.\n     *\n     * Returns a {Spacing} object\n     *\n     * @param {BMSChart} chart the chart\n     */\n    Spacing.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var segments = [];\n        chart.objects.allSorted().forEach(function (object) {\n            if (object.channel === 'SP') {\n                var beat = chart.measureToBeat(object.measure, object.fraction);\n                var factor = +chart.headers.get('speed' + object.value);\n                if (isNaN(factor))\n                    return;\n                if (segments.length > 0) {\n                    var previous = segments[segments.length - 1];\n                    previous.dx = (factor - previous.x) / (beat - previous.t);\n                }\n                segments.push({\n                    t: beat,\n                    x: factor,\n                    dx: 0,\n                    inclusive: true,\n                });\n            }\n        });\n        if (segments.length > 0) {\n            segments.unshift({\n                t: 0,\n                x: segments[0].x,\n                dx: 0,\n                inclusive: true,\n            });\n        }\n        return new Spacing(segments);\n    };\n    return Spacing;\n}());\nexports.Spacing = Spacing;\n//# sourceMappingURL=index.js.map","let _enabled = false\n\nlet _lifecycleHandler = {\n  /** @returns {Promise<void>} */\n  pauseAt(t) {\n    throw new Error('Cannot pause: No lifecycle handler registered!')\n  },\n  /** @returns {void} */\n  unpause() {\n    throw new Error('Cannot unpause: No lifecycle handler registered!')\n  },\n  /** @returns {number} */\n  getScore() {\n    throw new Error('Cannot get score: No lifecycle handler registered!')\n  },\n}\n\n/**\n * Activates the test mode. In this mode,\n *\n * - An overlay will be displayed indicating the test mode.\n * - The following APIs will be available to facilitate automated testing:\n *     - `BemuseTestMode.pauseAt(t)` will make the game pause at time `t`.\n *     - `BemuseTestMode.unpause()` will unpause the game.\n * - Score submission is disabled.\n *\n * Note: Once test mode is activated, it cannot be deactivated for the rest of the game session.\n */\nexport function enableTestMode() {\n  if (!_enabled) {\n    _enabled = true\n    console.log('[Bemuse test mode enabled]')\n    const overlay = document.createElement('div')\n    overlay.setAttribute(\n      'style',\n      `\n        position: fixed;\n        top: 20px;\n        left: 20px;\n        font: 20px Comic Sans MS, sans-serif;\n        z-index: 99999;\n        background: rgba(0,0,0,0.5);\n        color: #0f0;\n        border: 2px solid #0f0;\n        padding: 4px;\n        pointer-events: none;\n      `\n    )\n    overlay.innerHTML = `\n      <strong>Test mode:</strong>\n      Bemuse is being controlled by automated test software.\n    `\n    document.body.appendChild(overlay)\n  }\n}\n\n/**\n * Registers a pause handler.\n * This allows the `pauseAt` and `unpause` APIs to be used.\n *\n * @param {typeof _lifecycleHandler} handler\n */\nexport function setGameLifecycleHandler(handler) {\n  console.log('[Bemuse test mode] A pause handler has been registered.')\n  _lifecycleHandler = handler\n}\n\n/**\n * Returns `true` if test mode is enabled, `false` otherwise.\n */\nexport function isTestModeEnabled() {\n  return !!_enabled\n}\n\n/**\n * Will schedule the game to pause at time `t`.\n *\n * @param {number} t The song time to pause in seconds\n * @returns {Promise<void>} A promise that will be resolved when the time is reached and game is paused.\n */\nexport function pauseAt(t) {\n  return _lifecycleHandler.pauseAt(t)\n}\n\n/**\n * Unpauses the game.\n */\nexport function unpause() {\n  return _lifecycleHandler.unpause()\n}\n\n/**\n * Returns the current score.\n */\nexport function getScore() {\n  return _lifecycleHandler.getScore()\n}\n","module.exports = function() {\n\tthrow new Error(\"define cannot be used indirect\");\n};\n","/* globals __webpack_amd_options__ */\nmodule.exports = __webpack_amd_options__;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fromBMSChart = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar __1 = __importDefault(require(\"../\"));\n// Returns a new Notechart from a BMSChart.\nfunction fromBMSChart(bms, playerOptions) {\n    var notes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1,\n    }).all();\n    var landmineNotes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP_LANDMINE\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1_LANDMINE,\n    }).all();\n    var timing = BMS.Timing.fromBMSChart(bms);\n    var keysounds = BMS.Keysounds.fromBMSChart(bms);\n    var songInfo = BMS.SongInfo.fromBMSChart(bms);\n    var positioning = BMS.Positioning.fromBMSChart(bms);\n    var spacing = BMS.Spacing.fromBMSChart(bms);\n    var data = {\n        notes: notes,\n        landmineNotes: landmineNotes,\n        timing: timing,\n        keysounds: keysounds,\n        songInfo: songInfo,\n        positioning: positioning,\n        spacing: spacing,\n        barLines: generateBarLinesFromBMS(notes, bms),\n        expertJudgmentWindow: getJudgmentWindowFromBMS(bms),\n    };\n    return new __1.default(data, playerOptions);\n}\nexports.fromBMSChart = fromBMSChart;\nfunction getJudgmentWindowFromBMS(bms) {\n    // http://hitkey.nekokan.dyndns.info/diary1501.php\n    var rank = +bms.headers.get('rank') || 2;\n    if (rank === 0)\n        return [8, 24]; // Very Hard\n    if (rank === 1)\n        return [15, 30]; // Hard\n    if (rank === 3)\n        return [21, 60]; // Easy\n    return [18, 40]; // Normal\n}\nfunction generateBarLinesFromBMS(bmsNotes, bms) {\n    var max = lodash_1.default.max(bmsNotes.map(function (note) { return note.endBeat || note.beat; })) || 0;\n    var barLines = [0];\n    var currentBeat = 0;\n    var currentMeasure = 0;\n    do {\n        currentBeat += bms.timeSignatures.getBeats(currentMeasure);\n        currentMeasure += 1;\n        barLines.push(currentBeat);\n    } while (currentBeat <= max);\n    return barLines;\n}\n//# sourceMappingURL=BMSNotechartLoader.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","export function forModule(moduleName: string) {\n  return {\n    info: bindLogger(moduleName, 'info'),\n    warn: bindLogger(moduleName, 'warn'),\n    error: bindLogger(moduleName, 'error'),\n  }\n}\n\nfunction bindLogger(moduleName: string, level: 'info' | 'warn' | 'error') {\n  return (...args: any[]) => {\n    console.log(\n      `[${new Date().toJSON()}] [${moduleName}] [${level}] ${require('util').format(\n        ...args\n      )}`\n    )\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports._slicesForNotesAndTiming = exports.beatForLoc = exports.timingInfoForBmson = exports.barLinesForBmson = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar utils = __importStar(require(\"./utils\"));\nfunction barLinesForBmson(bmson) {\n    var lines = bmson.lines;\n    return (0, lodash_1.default)(lines)\n        .map(function (_a) {\n        var y = _a.y;\n        return beatForLoc(y);\n    })\n        .sortBy()\n        .value();\n}\nexports.barLinesForBmson = barLinesForBmson;\nfunction timingInfoForBmson(bmson) {\n    return {\n        initialBPM: bmson.info.initBPM,\n        actions: __spreadArray(__spreadArray([], __read((bmson.bpmNotes || []).map(function (_a) {\n            var y = _a.y, v = _a.v;\n            return ({\n                type: 'bpm',\n                beat: beatForLoc(y),\n                bpm: v,\n            });\n        })), false), __read((bmson.stopNotes || []).map(function (_a) {\n            var y = _a.y, v = _a.v;\n            return ({\n                type: 'stop',\n                beat: beatForLoc(y),\n                stopBeats: beatForLoc(Math.floor(v)),\n            });\n        })), false),\n    };\n}\nexports.timingInfoForBmson = timingInfoForBmson;\nfunction beatForLoc(y) {\n    return y / 240;\n}\nexports.beatForLoc = beatForLoc;\nfunction slicesForNotesAndTiming(notes, timing) {\n    return utils.slicesForNotesAndTiming(notes, timing, {\n        beatForPulse: beatForLoc,\n    });\n}\nexports._slicesForNotesAndTiming = slicesForNotesAndTiming;\n//# sourceMappingURL=legacy.js.map","\"use strict\";\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.slicesForNotesAndTiming = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\n/**\n * Takes the notes for a certain `soundChannel` and returns instructions\n * on how to slice the keysound file, given the `y` position of a note.\n *\n * @param notes An {Array} of `notes` inside `bmson.soundChannel[i]`\n * @param timing The {BMS.Timing} object that corresponds to the bmson\n * @param options An {Object} of options with the following keys:\n *  * `beatForPulse` A {Function} used to resolve beat for a given pulse number\n * @returns an ES6 {Map} that maps `y` position of the note to an SoundSlice\n */\nfunction slicesForNotesAndTiming(notes, timing, options) {\n    var e_1, _a, e_2, _b;\n    var beatForPulse = options.beatForPulse;\n    var all = new Set();\n    var play = new Set();\n    var restart = new Set();\n    try {\n        for (var notes_1 = __values(notes), notes_1_1 = notes_1.next(); !notes_1_1.done; notes_1_1 = notes_1.next()) {\n            var _c = notes_1_1.value, x = _c.x, y = _c.y, c = _c.c;\n            all.add(y);\n            if (x) {\n                play.add(y);\n            }\n            if (!c) {\n                restart.add(y);\n            }\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (notes_1_1 && !notes_1_1.done && (_a = notes_1.return)) _a.call(notes_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    var result = new Map();\n    var soundTime = null;\n    var mustAdd = true;\n    var t;\n    var lastAdded;\n    try {\n        for (var _d = __values(lodash_1.default.sortBy(__spreadArray([], __read(all), false))), _e = _d.next(); !_e.done; _e = _d.next()) {\n            var y = _e.value;\n            var t = timing.beatToSeconds(beatForPulse(y));\n            if (soundTime === null || restart.has(y)) {\n                soundTime = 0;\n            }\n            else {\n                soundTime += t - t;\n            }\n            var shouldAdd = mustAdd || play.has(y) || restart.has(y);\n            if (shouldAdd) {\n                if (lastAdded && !restart.has(y)) {\n                    lastAdded.keysoundEnd = soundTime;\n                }\n                var obj = { keysoundStart: soundTime, keysoundEnd: undefined };\n                result.set(y, obj);\n                lastAdded = obj;\n            }\n            mustAdd = play.has(y);\n            t = t;\n        }\n    }\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\n    finally {\n        try {\n            if (_e && !_e.done && (_b = _d.return)) _b.call(_d);\n        }\n        finally { if (e_2) throw e_2.error; }\n    }\n    return result;\n}\nexports.slicesForNotesAndTiming = slicesForNotesAndTiming;\n//# sourceMappingURL=utils.js.map","import Notechart from 'bemuse-notechart'\nimport { PlayerOptions } from 'bemuse-notechart/lib/types'\n\nexport type PlayerControlKeys =\n  | '1'\n  | '2'\n  | '3'\n  | '4'\n  | '5'\n  | '6'\n  | '7'\n  | 'SC'\n  | 'SC2'\n\nexport type PlayerOptionsPlacement = 'left' | 'center' | 'right' | '3d'\n\nexport type PlayerOptionsScratch = 'left' | 'right' | 'off'\n\nexport type PlayerOptionsGauge = 'off' | 'hope'\n\ntype PlayerOptionsInputMapping = {\n  keyboard: { [control in PlayerControlKeys]: string }\n  continuous: boolean\n  sensitivity: number\n}\n\ntype PlayerOptionsInternal = {\n  autoplayEnabled: boolean\n  autosound: boolean\n  speed: number\n  placement: PlayerOptionsPlacement\n  scratch: PlayerOptionsScratch\n  laneCover: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial: boolean\n}\n\nexport type PlayerOptionsInput = PlayerOptions & {\n  autoplayEnabled?: boolean\n  autosound?: boolean\n  speed: number\n  placement?: PlayerOptionsPlacement\n  laneCover?: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial?: boolean\n}\n\n/** The object representing the player's information, notechart and options. */\nexport class Player {\n  public readonly options: PlayerOptionsInternal\n  constructor(\n    public readonly notechart: Notechart,\n    public readonly number: number,\n    options: PlayerOptionsInput\n  ) {\n    this.options = {\n      autoplayEnabled: !!options.autoplayEnabled,\n      autosound: !!options.autosound,\n      speed: +options.speed,\n      placement: options.placement || 'center',\n      scratch: options.scratch || 'left',\n      input: options.input,\n      laneCover: +(options.laneCover || 0),\n      gauge: options.gauge,\n      tutorial: !!options.tutorial,\n    }\n  }\n\n  // An array of column names for this Notechart.\n  get columns() {\n    return this.notechart.columns\n  }\n}\n\nexport default Player\n","import * as Judgments from '../judgments'\n\nimport _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nconst getAccuracyScore = (accuracy: number) => Math.floor(accuracy * 500000)\nconst getComboScore = (sum: number, total: number) =>\n  Math.floor((sum * 55555) / total)\n\nexport class PlayerStats {\n  public totalCombo: number\n  public totalNotes: number\n  public combo: number\n  public maxCombo: number\n  public rawSumJudgmentWeight: number\n  public rawTotalComboScore: number\n  public rawSumComboScore: number\n  public counts: { [k in Judgments.JudgedJudgment]: number }\n  public numJudgments: number\n  public poor: boolean\n  public deltas: number[]\n\n  private _remainingMaxPossibleRawComboScore: number\n  private _log: { character: string; count: number }[]\n\n  constructor(notechart: Notechart) {\n    this.totalCombo = _(notechart.notes)\n      .map((note) => notechart.info(note)!.combos)\n      .sum()\n    this.totalNotes = notechart.notes.length\n    this.combo = 0\n    this.maxCombo = 0\n    this.rawSumJudgmentWeight = 0\n    this.rawTotalComboScore = this._calculateRawTotalComboScore(this.totalCombo)\n    this._remainingMaxPossibleRawComboScore = this.rawTotalComboScore\n    this.rawSumComboScore = 0\n    this.counts = { [Judgments.MISSED]: 0, '1': 0, '2': 0, '3': 0, '4': 0 }\n    this.numJudgments = 0\n    this.poor = false\n    this._log = []\n    this.deltas = []\n  }\n  get score() {\n    // #region score\n    return this.accuracyScore + this.comboScore\n    // #endregion\n  }\n  get accuracyScore() {\n    return getAccuracyScore(this.accuracy)\n  }\n  get comboScore() {\n    return getComboScore(this.rawSumComboScore, this.rawTotalComboScore)\n  }\n  get maxPossibleScore() {\n    return this.maxPossibleAccuracyScore + this.maxPossibleComboScore\n  }\n  get maxPossibleAccuracyScore() {\n    const remainingJudgments = this.totalCombo - this.numJudgments\n    const maxPossibleRawWeight =\n      this.rawSumJudgmentWeight + Judgments.weight(1) * remainingJudgments\n    const maxPossibleAccuracy =\n      maxPossibleRawWeight / (Judgments.weight(1) * this.totalCombo)\n    return getAccuracyScore(maxPossibleAccuracy)\n  }\n  get maxPossibleComboScore() {\n    const maxPossibleRawComboScore =\n      this.rawSumComboScore + this._remainingMaxPossibleRawComboScore\n    return getComboScore(maxPossibleRawComboScore, this.rawTotalComboScore)\n  }\n  get accuracy() {\n    return this.rawSumJudgmentWeight / (Judgments.weight(1) * this.totalCombo)\n  }\n  get currentAccuracy() {\n    return (\n      this.rawSumJudgmentWeight / (Judgments.weight(1) * this.numJudgments || 1)\n    )\n  }\n  get log() {\n    return this._log\n      .map(({ character, count }) => `${count > 1 ? count : ''}${character}`)\n      .join('')\n  }\n  handleJudgment(judgment: Judgments.JudgedJudgment) {\n    this.counts[judgment] += 1\n    this.numJudgments += 1\n    if (Judgments.breaksCombo(judgment)) {\n      const remainingJudgments = this.totalCombo - this.numJudgments\n      this.combo = 0\n      this.poor = true\n      this._remainingMaxPossibleRawComboScore =\n        this._calculateRawTotalComboScore(remainingJudgments)\n    } else {\n      this.combo += 1\n      const rawComboScore = this._calculateRawComboScore(this.combo)\n      this.rawSumComboScore += rawComboScore\n      this._remainingMaxPossibleRawComboScore -= rawComboScore\n      this.poor = false\n    }\n    this.rawSumJudgmentWeight += Judgments.weight(judgment)\n    if (this.combo > this.maxCombo) {\n      this.maxCombo = this.combo\n    }\n    this._recordLog(judgment)\n  }\n  handleDelta(delta: number) {\n    this.deltas.push(delta)\n  }\n  private _calculateRawTotalComboScore(total: number) {\n    let sum = 0\n    for (let i = 1; i <= total; i++) {\n      sum += this._calculateRawComboScore(i)\n    }\n    return sum\n  }\n  private _calculateRawComboScore(i: number) {\n    // #region combo\n    if (i === 0) return 0\n    if (i < 23) return 1\n    if (i < 51) return 2\n    if (i < 92) return 3\n    if (i < 161) return 4\n    return 5\n    // #endregion\n  }\n  private _recordLog(judgment: Judgments.JudgedJudgment) {\n    let character = this._getLogCharacter(judgment)\n    if (character) {\n      if (\n        this._log.length === 0 ||\n        this._log[this._log.length - 1].character !== character\n      ) {\n        this._log.push({ character, count: 1 })\n      } else {\n        this._log[this._log.length - 1].count += 1\n      }\n    }\n  }\n  private _getLogCharacter(judgment: Judgments.JudgedJudgment) {\n    switch (judgment) {\n      case 1:\n        return 'A'\n      case 2:\n        return 'B'\n      case 3:\n        return 'C'\n      case 4:\n        return 'D'\n      case Judgments.MISSED:\n        return 'M'\n    }\n  }\n}\n\nexport default PlayerStats\n","import _ from 'lodash'\n\nexport class NoteArea {\n  constructor(notes, barLines) {\n    this._notes = _.sortBy(notes, position)\n    this._barLines = _(barLines).map('position').sortBy().value()\n  }\n  getVisibleNotes(lower, upper, headroom) {\n    let out = []\n    let notes = this._notes\n    if (!headroom) headroom = 0\n    for (let i = 0; i < notes.length; i++) {\n      let note = notes[i]\n      let visible = note.end\n        ? !(note.position > upper || note.end.position < lower - headroom)\n        : !(note.position > upper || note.position < lower - headroom)\n      if (visible) {\n        let entity = { note: note }\n        if (!note.end) {\n          entity.y = y(lower, upper, note.position)\n        } else {\n          let head = y(lower, upper, note.position)\n          let tail = y(lower, upper, note.end.position)\n          entity.y = Math.min(head, tail)\n          entity.height = Math.abs(head - tail)\n        }\n        out.push(entity)\n      }\n    }\n    return out\n  }\n  getVisibleBarLines(lower, upper, headroom) {\n    if (!headroom) headroom = 0\n    return this._barLines\n      .filter((pos) => lower - headroom <= pos && pos <= upper)\n      .map((pos) => ({ id: pos, y: y(lower, upper, pos) }))\n  }\n}\n\nexport default NoteArea\n\nfunction y(lower, upper, pos) {\n  return 1 - (pos - lower) / (upper - lower)\n}\n\nfunction position(event) {\n  return event.position\n}\n","export function getGauge(gaugeType) {\n  if (gaugeType === 'hope') {\n    return hopeGauge()\n  }\n  return nullGauge()\n}\n\nfunction nullGauge() {\n  return {\n    update() {},\n    shouldDisplay() {\n      return false\n    },\n    getPrimary() {\n      return 0\n    },\n    getSecondary() {\n      return 0\n    },\n    getExtra() {\n      return 0\n    },\n  }\n}\n\nfunction hopeGauge() {\n  let primary\n  let secondary\n  let extra\n  return {\n    update(playerState) {\n      const stats = playerState.stats\n      const progress = stats.numJudgments / stats.totalCombo\n      const getHope = (min, max1, max2) => {\n        const max = max1 + (max2 - max1) * progress\n        const maxPossibleScore = stats.maxPossibleScore\n        return Math.max(0, (maxPossibleScore - min) / (max - min))\n      }\n      const hopeS = getHope(500000, 555555, 510000) * 0.5\n      primary = Math.min(1, hopeS)\n      extra = Math.max(0, Math.min(1, hopeS - 1))\n      if (hopeS > 0) {\n        secondary = 0\n      } else {\n        const hopeA = getHope(450000, 500000, 500000)\n        secondary = hopeA\n      }\n    },\n    shouldDisplay() {\n      return primary > 0 || secondary > 0\n    },\n    getPrimary() {\n      return primary\n    },\n    getSecondary() {\n      return secondary\n    },\n    getExtra() {\n      return extra\n    },\n  }\n}\n","export function formatTime(seconds) {\n  let s = Math.floor(seconds % 60)\n  return Math.floor(seconds / 60) + ':' + (s < 10 ? '0' : '') + s\n}\n\nexport default formatTime\n","/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","import Bacon from 'baconjs'\n\nfunction observeMidiAccess(access) {\n  return Bacon.fromBinder((sink) => {\n    for (let port of access.inputs.values()) {\n      sink(new Bacon.Next(port))\n    }\n    for (let port of access.outputs.values()) {\n      sink(new Bacon.Next(port))\n    }\n    access.onstatechange = (e) => {\n      sink(new Bacon.Next(e.port))\n    }\n  })\n}\n\nfunction requestMIDIAccess() {\n  if (!navigator.requestMIDIAccess) {\n    return Promise.reject(new Error('MIDI is not supported'))\n  }\n  return navigator.requestMIDIAccess()\n}\n\nexport function getMidi() {\n  return Bacon.fromPromise(requestMIDIAccess())\n    .flatMap(observeMidiAccess)\n    .flatMapError((e) => (console.warn('MIDI Error:', e.stack), Bacon.never()))\n    .flatMap(messageForPort)\n    .doLog('messageforport')\n}\n\nfunction messageForPort(port) {\n  if (port.type !== 'input') return Bacon.never()\n  return Bacon.fromEvent(port, 'midimessage')\n}\n\nexport default getMidi\n","export class AxisLogic {\n  private stop = 1\n  private charge = 0\n  private previous: false | number = false\n  private active = false\n  private positive = false\n\n  public update(axis: number, threshold: number = 3) {\n    if (this.previous === false) {\n      this.previous = axis\n      return 0\n    }\n\n    if (this.previous !== axis) {\n      let delta = axis - this.previous\n      if (delta > 1) {\n        delta -= 2 + 0.005\n      } else if (delta < -1) {\n        delta += 2 + 0.005\n      }\n\n      let immediateOutput = delta > 0\n\n      if (this.active && this.positive !== immediateOutput) {\n        this.positive = immediateOutput\n        this.active = false\n        this.charge = 0\n      } else if (!this.active) {\n        if (this.charge === 0 || this.stop <= threshold) {\n          this.charge += Math.ceil(Math.abs(delta) / 0.01)\n        }\n\n        if (this.charge >= 2) {\n          this.active = true\n          this.positive = immediateOutput\n        }\n      }\n\n      this.stop = 0\n      this.previous = axis\n    }\n\n    if (this.stop > threshold * 2) {\n      this.active = false\n      this.charge = 0\n      this.stop = 0\n    }\n\n    this.stop += 1\n\n    return this.active ? (this.positive ? 1 : -1) : 0\n  }\n}\n","import keycode from 'keycode'\nimport _ from 'lodash'\nimport Bacon from 'baconjs'\nimport getMidi from './midi'\nimport { AxisLogic } from './axis-logic'\n\n// Public: OmniInput is a poll-based class that handles the key-pressed state of\n// multiple inputs.\n//\n// Each call to `update()` returns a mapping of active inputs. This object may\n// be reused and mutated by OmniInput for performance reasons, and thus the\n// caller SHOULD NOT hold on to or mutate it.\n//\n// ## Keys\n//\n// The key is a string that identifies some key on each input.\n// It follows the following convention:\n//\n// - `65` A keyboard keycode.\n// - `gamepad.0.button.3` A gamepad button.\n// - `gamepad.0.axis.3.positive` A gamepad axis (positive value).\n// - `gamepad.0.axis.3.negative` A gamepad axis (negative value).\n// - `midi.[id].[channel].note.[note]` A MIDI note.\n// - `midi.[id].[channel].sustain` Sustain pedal.\n// - `midi.[id].[channel].mod` Modulation level.\n// - `midi.[id].[channel].pitch.up` Pitch bend (up).\n// - `midi.[id].[channel].pitch.down` Pitch bend (down).\n//\nexport class OmniInput {\n  constructor(win = window, options = {}) {\n    const midi = (options.getMidi || getMidi)()\n    this._window = win\n    this._exclusive = !!options.exclusive\n    this._continuousAxis = !!options.continuous\n    this.setGamepadSensitivity(options.sensitivity || 3)\n\n    this._disposables = [\n      listen(win, 'keydown', (e) => this._handleKeyDown(e)),\n      listen(win, 'keyup', (e) => this._handleKeyUp(e)),\n      midi.onValue((e) => this._handleMIDIMessage(e)),\n    ]\n    this._status = {}\n    this._axis = {}\n  }\n  _handleKeyDown(e) {\n    this._status[`${e.which}`] = true\n    if (this._exclusive) e.preventDefault()\n  }\n  _handleKeyUp(e) {\n    this._status[`${e.which}`] = false\n  }\n  _handleMIDIMessage(e) {\n    if (!e || !e.data) return\n    const data = e.data\n    const prefix = `midi.${e.target.id}.${e.data[0] & 0x0f}`\n    const handleNote = (state) => {\n      this._status[`${prefix}.note.${data[1]}`] = state\n    }\n    if ((data[0] & 0xf0) === 0x80) {\n      // NoteOff\n      handleNote(false)\n    } else if ((data[0] & 0xf0) === 0x90) {\n      // NoteOn\n      if (data[2] > 0x0) {\n        // NoteOn (really)\n        handleNote(true)\n      } else {\n        // NoteOff disguised as NoteOn\n        handleNote(false)\n      }\n    } else if ((data[0] & 0xf0) === 0xb0) {\n      // CC\n      if (data[1] === 0x40) {\n        // Sustain\n        this._status[`${prefix}.sustain`] = data[2] >= 64\n      } else if (data[1] === 0x01) {\n        // Modulation\n        this._status[`${prefix}.mod`] = data[2] >= 16\n      }\n    } else if ((data[0] & 0xf0) === 0xe0) {\n      // Pitch Bend\n      const bend = data[1] | (data[2] << 7)\n      this._status[`${prefix}.pitch.up`] = bend >= 0x2100\n      this._status[`${prefix}.pitch.down`] = bend < 0x1f00\n    }\n  }\n  _updateGamepads() {\n    const nav = this._window.navigator\n    const gamepads = nav.getGamepads\n      ? nav.getGamepads()\n      : nav.webkitGetGamepads\n      ? nav.webkitGetGamepads()\n      : []\n    if (!gamepads) return\n    for (let i = 0; i < gamepads.length; i++) {\n      const gamepad = gamepads[i]\n      if (gamepad) {\n        this._updateGamepad(gamepad)\n      }\n    }\n  }\n  _updateGamepad(gamepad) {\n    const prefix = `gamepad.${gamepad.index}`\n    for (let i = 0; i < gamepad.buttons.length; i++) {\n      const button = gamepad.buttons[i]\n      this._status[`${prefix}.button.${i}`] = button && button.value >= 0.5\n    }\n    for (let i = 0; i < gamepad.axes.length; i++) {\n      const axisName = `${prefix}.axis.${i}`\n      let axis = gamepad.axes[i]\n\n      if (this._continuousAxis) {\n        if (this._axis[axisName] == null) {\n          this._axis[axisName] = new AxisLogic()\n        }\n        axis = this._axis[axisName].update(axis)\n      }\n\n      this._status[`${axisName}.positive`] = axis >= this._deadzone\n      this._status[`${axisName}.negative`] = axis <= -this._deadzone\n    }\n  }\n  update() {\n    this._updateGamepads()\n    return this._status\n  }\n\n  setGamepadSensitivity(sensitivity) {\n    this._sensitivity = sensitivity\n    this._deadzone = (9 - this._sensitivity) * 0.05\n    if (this._deadzone < 0.01) this._deadzone = 0.01\n    this._analogThreshold = 18 - this._sensitivity * 2\n  }\n\n  setGamepadContinuousAxisEnabled(enabled) {\n    this._continuousAxis = enabled\n  }\n\n  dispose() {\n    for (let dispose of this._disposables) {\n      dispose()\n    }\n  }\n}\n\n// Public: Returns a Bacon EventStream of keys pressed.\n//\nexport function key(input = new OmniInput(), win = window) {\n  return _keyForUpdate(\n    Bacon.fromBinder((sink) => {\n      const handle = win.setInterval(() => {\n        sink(new Bacon.Next(input.update()))\n      }, 16)\n      return () => win.clearInterval(handle)\n    })\n  )\n}\n\nexport function _keyForUpdate(update) {\n  return update\n    .map((update) => Object.keys(update).filter((key) => update[key]))\n    .diff([], (previous, current) => _.difference(current, previous))\n    .flatMap((array) => Bacon.fromArray(array))\n}\n\nexport default OmniInput\n\nconst knownMidiIds = {}\n\nexport function getName(key) {\n  if (+key) {\n    return _.capitalize(keycode(+key))\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.axis\\.(\\d+)\\.(\\w+)/)\n    if (match) {\n      return `Joy${match[1]} Axis${match[2]} (${\n        match[3] === 'positive' ? '+' : '-'\n      })`\n    }\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.button\\.(\\d+)/)\n    if (match) {\n      return `Joy${match[1]} Btn${match[2]}`\n    }\n  }\n  {\n    const match = key.match(/^midi\\.(.+)\\.(\\d+)\\.(.+)$/)\n    if (match) {\n      const rest = match[3].split('.')\n      const id = match[1]\n      const midiDeviceNumber =\n        knownMidiIds[id] ||\n        (knownMidiIds[id] = Object.keys(knownMidiIds).length + 1)\n      const prefix = `MIDI${midiDeviceNumber} Ch${+match[2] + 1}`\n      if (rest[0] === 'note') {\n        const midiNote = +rest[1]\n        const lookup = [\n          'C',\n          'C#',\n          'D',\n          'D#',\n          'E',\n          'F',\n          'F#',\n          'G',\n          'G#',\n          'A',\n          'A#',\n          'B',\n        ]\n        const noteName = lookup[midiNote % 12]\n        const octave = Math.floor(midiNote / 12) - 1\n        return `${prefix} ${noteName}${octave}`\n      }\n      if (rest[0] === 'pitch') {\n        return `${prefix} Pitch${rest[1] === 'up' ? '+' : '-'}`\n      }\n      if (rest[0] === 'sustain') return 'Sustain'\n      if (rest[0] === 'mod') return 'Mod'\n    }\n  }\n  return `${String(key).replace(/\\./g, ' ')}?`\n}\n\nfunction listen(subject, eventName, listener) {\n  subject.addEventListener(eventName, listener)\n  return function dispose() {\n    subject.removeEventListener(eventName, listener)\n  }\n}\n","export class Control {\n  public value = 0\n  public changed = false\n  get justPressed() {\n    return this.changed && this.value\n  }\n}\n\nexport default Control\n","import Control from './control'\nimport _ from 'lodash'\nimport bench from 'bemuse/devtools/benchmark'\n\ntype GameInputPluginInternalInstance = {\n  get(): [string, number][]\n  destroy(): void\n}\n\ninterface IGameInputPlugin {\n  name: string\n  get(): { [key: string]: number }\n  destroy?(): void\n}\n\nexport class GameInput {\n  private _controls = new Map<string, Control>()\n  private _plugins: GameInputPluginInternalInstance[] = []\n  update() {\n    let changes = new Map()\n    for (let [name, control] of this._controls) {\n      void name\n      control.changed = false\n    }\n    for (let plugin of this._plugins) {\n      for (let [name, value] of plugin.get()) {\n        changes.set(name, value)\n      }\n    }\n    for (let [name, value] of changes) {\n      let control = this.get(name)!\n      if (control.value !== value) {\n        control.changed = true\n        control.value = value\n      }\n    }\n  }\n  destroy() {\n    for (let plugin of this._plugins) {\n      plugin.destroy()\n    }\n  }\n  get(controlName: string) {\n    if (!this._controls.has(controlName)) {\n      this._controls.set(controlName, new Control())\n    }\n    return this._controls.get(controlName)!\n  }\n  use(plugin: IGameInputPlugin) {\n    let state: { [key: string]: number } = {}\n    let name = 'input:' + plugin.name\n    this._plugins.push({\n      get: bench.wrap(name, function () {\n        let out = plugin.get()\n        let diff = []\n        for (let key of _.union(_.keys(out), _.keys(state))) {\n          let last = +state[key] || 0\n          let current = +out[key] || 0\n          if (last !== current) diff.push([key, current])\n          state[key] = current\n        }\n        return diff\n      }),\n      destroy() {\n        if (typeof plugin.destroy === 'function') {\n          return plugin.destroy()\n        } else {\n          return true\n        }\n      },\n    })\n  }\n}\n\nexport default GameInput\n","\nvar timesync = require('./timesync')\nmodule.exports = sync\n\nfunction sync(url, callback, callback2) {\n  var ws = new WebSocket(url)\n  var clocks = []\n  ws.onmessage = function(e) {\n    if (e.data == 'k') {\n      emit()\n    }\n    if (e.data.indexOf(',') >= 0) {\n      process(e.data)\n      emit()\n    }\n  }\n  ws.onclose = function() {\n    if (clocks.length < 1) return callback(new Error('no offset received'))\n    return callback(null, timesync.offset(clocks))\n  }\n  function emit() {\n    try {\n      ws.send('' + new Date().getTime())\n    } catch (e) {\n      // do nuffink\n    }\n  }\n  function process(text) {\n    var fields = text.split(',')\n    var a = +fields[0]\n    var b = +fields[1]\n    var c = new Date().getTime()\n    if (a <= c) clocks.push(timesync.convert([a, b, b, c]))\n    if (clocks.length >= 8) {\n      if (callback2) callback2(timesync.offset(clocks))\n    }\n  }\n}\n","\nexports.convert = function convert(array) {\n  var t1 = array[0]\n  var t2 = array[1]\n  var t3 = array[2]\n  var t4 = array[3]\n  return {\n    offset: ((t2 - t1) + (t3 - t4)) / 2,\n    delay:  (t4 - t1) - (t3 - t2)\n  }\n}\n\nexports.offset = function offset(clocks) {\n  clocks = clocks.slice()\n  clocks.sort(function(a, b) {\n    return a.offset - b.offset\n  })\n  clocks = clocks.slice(1, clocks.length - 1)\n  clocks.sort(function(a, b) {\n    return a.delay - b.delay\n  })\n  var sum = 0, count = 0\n  var hp = Math.ceil(clocks.length / 8)\n  for (var i = 0; i < clocks.length; i++) {\n    if (clocks[i].delay > clocks[0].delay) hp--\n    if (hp === 0) break\n    sum += clocks[i].offset\n    count += 1\n  }\n  return sum / count\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSChart = void 0;\nvar headers_1 = require(\"./headers\");\nvar objects_1 = require(\"./objects\");\nvar time_signatures_1 = require(\"../time-signatures\");\n/**\n * A BMSChart holds information about a particular BMS notechart.\n * Note that a BMSChart does not contain any information about `#RANDOM`,\n * as they are already processed after compilation.\n *\n * There is not many useful things you can do with a BMSChart other than\n * accessing the header fields and objects inside it.\n *\n * To extract information from a BMSChart,\n * please look at the documentation of higher-level classes,\n * such as {Keysounds}, {Notes}, and {Timing}.\n */\nvar BMSChart = /** @class */ (function () {\n    function BMSChart() {\n        /**\n         * {BMSHeaders} representing the BMS-specific headers of this notechart\n         */\n        this.headers = new headers_1.BMSHeaders();\n        /**\n         * {BMSObjects} representing all objects of this notechart\n         */\n        this.objects = new objects_1.BMSObjects();\n        /**\n         * {TimeSignatures} representing the time signature information in this chart\n         */\n        this.timeSignatures = new time_signatures_1.TimeSignatures();\n    }\n    /**\n     * Public: Converts measure number and fraction into beat.\n     * A single beat is equivalent to a quarter note in common time signature.\n     *\n     * @param {number} measure representing the measure number, starting from 0\n     * @param {number} fraction representing the fraction inside that measure, from 0 to 1\n     */\n    BMSChart.prototype.measureToBeat = function (measure, fraction) {\n        return this.timeSignatures.measureToBeat(measure, fraction);\n    };\n    return BMSChart;\n}());\nexports.BMSChart = BMSChart;\n//# sourceMappingURL=chart.js.map","// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,\n// backported and transplited with Babel, with backwards-compat fixes\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  if (path.length === 0) return '.';\n  var code = path.charCodeAt(0);\n  var hasRoot = code === 47 /*/*/;\n  var end = -1;\n  var matchedSlash = true;\n  for (var i = path.length - 1; i >= 1; --i) {\n    code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) return hasRoot ? '/' : '.';\n  if (hasRoot && end === 1) {\n    // return '//';\n    // Backwards-compat fix:\n    return '/';\n  }\n  return path.slice(0, end);\n};\n\nfunction basename(path) {\n  if (typeof path !== 'string') path = path + '';\n\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  for (i = path.length - 1; i >= 0; --i) {\n    if (path.charCodeAt(i) === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // path component\n      matchedSlash = false;\n      end = i + 1;\n    }\n  }\n\n  if (end === -1) return '';\n  return path.slice(start, end);\n}\n\n// Uses a mixed approach for backwards-compatibility, as ext behavior changed\n// in new Node.js versions, so only basename() above is backported here\nexports.basename = function (path, ext) {\n  var f = basename(path);\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\nexports.extname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true;\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n  var preDotState = 0;\n  for (var i = path.length - 1; i >= 0; --i) {\n    var code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n    if (code === 46 /*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 ||\n      // We saw a non-dot character immediately before the dot\n      preDotState === 0 ||\n      // The (right-most) trimmed path component is exactly '..'\n      preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n  return path.slice(startDot, end);\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n","import Progress from 'bemuse/progress'\nimport * as ProgressUtils from 'bemuse/progress/utils'\nimport readBlob from 'bemuse/utils/read-blob'\nimport _ from 'lodash'\nimport throat from 'throat'\nimport { IResource, IResources } from './types'\nimport { URLResources } from './url'\n\ntype MetadataFileJSON = {\n  files: BemusePackFileEntry[]\n  refs: BemusePackRefEntry[]\n}\ntype BemusePackRefEntry = { path: string; hash: string }\ntype BemusePackFileEntry = { name: string; ref: BemusePackContentRef }\ntype BemusePackContentRef = [number, number, number]\n\nexport class BemusePackageResources implements IResources {\n  private _base: IResources\n  private _fallback: IResources | undefined\n  private _fallbackPattern: RegExp | undefined\n  private _metadataFilename: string\n  public loadPayload: (\n    resourcePromise: PromiseLike<IResource>\n  ) => PromiseLike<Blob>\n\n  public progress = {\n    all: new Progress(),\n    current: new Progress(),\n  }\n\n  constructor(\n    base: string | IResources,\n    options: {\n      metadataFilename?: string\n      fallback?: string | IResources\n      fallbackPattern?: RegExp\n    } = {}\n  ) {\n    if (typeof base === 'string') {\n      base = new URLResources(new URL(base, location.href))\n    }\n\n    const fallback =\n      typeof options.fallback === 'string'\n        ? new URLResources(new URL(options.fallback, location.href))\n        : options.fallback\n\n    this._base = base\n    this._fallback = fallback\n    this._fallbackPattern = options.fallbackPattern\n    this._metadataFilename = options.metadataFilename || 'metadata.json'\n\n    let simultaneous = ProgressUtils.simultaneous(this.progress.current)\n    let nextProgress = () => {\n      let progress = new Progress()\n      simultaneous.add(progress)\n      return progress\n    }\n    this.loadPayload = ProgressUtils.wrapPromise(\n      this.progress.all,\n      throat(2, (resourcePromise) =>\n        resourcePromise\n          .then((resource) => resource.read(nextProgress()))\n          .then((arrayBuffer) => new Blob([arrayBuffer]))\n          .then(getPayload)\n      )\n    )\n  }\n\n  private _getMetadata = _.once(async () => {\n    const file = await this._base.file(this._metadataFilename)\n    const data = await file.read()\n    const text = await new Blob([data]).text()\n    return JSON.parse(text) as MetadataFileJSON\n  })\n  private _getRefs = _.once(async () => {\n    const metadata = await this._getMetadata()\n    return metadata.refs.map((spec) => new Ref(this, spec))\n  })\n  private _getFileMap = _.once(async () => {\n    const metadata = await this._getMetadata()\n    let files = new Map<string, BemusePackFileEntry>()\n    for (let file of metadata.files) {\n      files.set(file.name.toLowerCase(), file)\n    }\n    return files\n  })\n\n  get base() {\n    return this._base\n  }\n  async file(name: string): Promise<IResource> {\n    const fileMap = await this._getFileMap()\n    let file = fileMap.get(name.toLowerCase())\n    if (file) {\n      return new BemusePackageFileResource(this, file.ref, file.name)\n    } else if (\n      this._fallback &&\n      this._fallbackPattern &&\n      this._fallbackPattern.test(name)\n    ) {\n      return this._fallback.file(name)\n    } else {\n      throw new Error('Unable to find: ' + name)\n    }\n  }\n  async getBlob([index, start, end]: [number, number, number]) {\n    const refs = await this._getRefs()\n    const ref = refs[index]\n    const payload = await ref.load()\n    return payload.slice(start, end)\n  }\n}\n\nclass BemusePackageFileResource implements IResource {\n  constructor(\n    private resources: BemusePackageResources,\n    private ref: BemusePackContentRef,\n    public readonly name: string\n  ) {}\n  read(progress: Progress): PromiseLike<ArrayBuffer> {\n    return ProgressUtils.atomic(\n      progress,\n      this.resources\n        .getBlob(this.ref)\n        .then((blob) => readBlob(blob).as('arraybuffer'))\n    )\n  }\n  async resolveUrl() {\n    const blob = await this.resources.getBlob(this.ref)\n    return URL.createObjectURL(blob)\n  }\n}\n\nclass Ref {\n  private _basePromise: PromiseLike<IResource>\n  private _promise: PromiseLike<Blob> | undefined\n  constructor(\n    private resources: BemusePackageResources,\n    spec: BemusePackRefEntry\n  ) {\n    this._basePromise = resources.base.file(spec.path)\n  }\n  load() {\n    return (\n      this._promise ||\n      (this._promise = this.resources.loadPayload(this._basePromise))\n    )\n  }\n}\n\nexport default BemusePackageResources\n\nasync function getPayload(blob: Blob) {\n  const magic = await readBlob(blob.slice(0, 10)).as('text')\n  if (magic !== 'BEMUSEPACK') {\n    throw new Error('Invalid magic number')\n  }\n  const buffer = await readBlob(blob.slice(10, 14)).as('arraybuffer')\n  let array = new Uint8Array(buffer)\n  let length = array[0] + (array[1] << 8) + (array[2] << 16) + (array[3] << 24)\n  const metadataLength = length\n  return blob.slice(14 + metadataLength)\n}\n","import createKeysoundCache from './createKeysoundCache'\n\nexport default createKeysoundCache()\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./BenchmarkPanel.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./BenchmarkPanel.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./BenchmarkPanel.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".BenchmarkPanel {\\n  background: #449;\\n  border: 2px solid #66e;\\n  padding: 4px;\\n}\\n.BenchmarkPanel table {\\n  font-size: 10px;\\n}\", \"\"]);\n\n// exports\n","import _ from 'lodash'\n\nimport PlayerStats from './player-stats'\nimport {\n  MISSED,\n  getJudgeForNotechart,\n  isBad,\n  judgeEndTime,\n  judgeTime,\n  IJudge,\n  Judgment,\n  JudgedJudgment,\n} from '../judgments'\nimport Player from '../player'\nimport { GameNote } from 'bemuse-notechart/lib/types'\nimport GameInput from '../input'\nimport Control from '../input/control'\nimport invariant from 'invariant'\n\ntype NoteResult = {\n  judgment: Judgment\n  status: NoteStatus\n  delta: number\n}\n\nenum NoteStatus {\n  /** For long notes -- when the player is holding the note but not yet release it. */\n  Active = 'active',\n  /** This not is not yet judged. */\n  Unjudged = 'unjudged',\n  /** This note is fully-judged. */\n  Judged = 'judged',\n}\n\ntype Notifications = {\n  sounds: (\n    | { type: 'hit'; note: GameNote; judgment: Judgment }\n    | { type: 'free'; note: GameNote }\n    | { type: 'break'; note: GameNote }\n  )[]\n  judgments: {}[]\n}\n\nfunction initializeNotifications(): Notifications {\n  return { sounds: [], judgments: [] }\n}\n\n// The PlayerState class holds a single player's state, including the stats\n// (score, current combo, maximum combo).\nexport class PlayerState {\n  /** The PlayerStats object. */\n  public stats: PlayerStats\n\n  /** The notifications from the previous update. */\n  public notifications = initializeNotifications()\n  /** The current note scrolling speed. */\n  public speed: number\n  /** `true` if finished playing, `false` otherwise. */\n  public finished = false\n  /** `true` if score is invalid due to autoplay being activated. `false` otherwise. */\n  public tainted = false\n  public input: Map<string, Control> = new Map()\n\n  private _columns: string[]\n  private _noteBufferByColumn: _.Dictionary<NoteBuffer>\n  private _noteResult: Map<GameNote, NoteResult>\n  private _duration: number\n  private _judge: IJudge\n  private _gameTime = 0\n  private _rawInput?: GameInput\n  private _pinching: null | { start: number; speed: number } = null\n\n  constructor(public readonly player: Player) {\n    this._columns = player.columns\n    this._noteBufferByColumn = _(player.notechart.notes)\n      .sortBy((n) => n.time)\n      .groupBy((n) => n.column)\n      .mapValues(noteBuffer(this))\n      .value()\n    this._noteResult = new Map()\n    this._duration = player.notechart.duration\n    this._judge = getJudgeForNotechart(player.notechart, {\n      tutorial: player.options.tutorial,\n    })\n    this.stats = new PlayerStats(player.notechart)\n    this.speed = player.options.speed\n  }\n\n  /**\n   * Updates the state. Judge the notes and emit notifications.\n   */\n  update(gameTime: number, input: GameInput) {\n    this._gameTime = gameTime\n    this._rawInput = input\n    this.notifications = initializeNotifications()\n    this._updateInputColumnMap()\n    this._judgeNotes()\n    this._updateSpeed()\n    if (gameTime > this._duration + 3) this.finished = true\n  }\n\n  getNoteStatus(note: GameNote): NoteStatus {\n    let result = this._noteResult.get(note)\n    if (!result) return NoteStatus.Unjudged\n    return result.status\n  }\n  getNoteJudgment(note: GameNote) {\n    let result = this._noteResult.get(note)\n    if (!result) return Judgment.Unjudged\n    return result.judgment\n  }\n  getPlayerInput(control: string) {\n    return this._rawInput!.get(`p${this.player.number}_${control}`)!\n  }\n  _updateInputColumnMap() {\n    this.input = new Map(\n      this._columns.map((column) => [column, this.getPlayerInput(column)])\n    )\n  }\n  _judgeNotes() {\n    for (let column of this._columns) {\n      let buffer = this._noteBufferByColumn[column]\n      if (buffer) {\n        let control = this.input.get(column)!\n        this._judgeColumn(buffer, control, column)\n        buffer.update()\n      }\n    }\n  }\n  _updateSpeed() {\n    if (this.getPlayerInput('speedup').justPressed) {\n      this._modifySpeed(+1)\n    }\n    if (this.getPlayerInput('speeddown').justPressed) {\n      this._modifySpeed(-1)\n    }\n    let pinch = this.getPlayerInput('pinch').value\n    if (pinch && !this._pinching) {\n      this._pinching = { start: pinch, speed: this.speed }\n    } else if (!pinch) {\n      this._pinching = null\n    }\n    if (pinch && this._pinching) {\n      let pinching = this._pinching\n      let speed = (pinching.speed * pinch) / pinching.start\n      this.speed = Math.max(0.2, Math.round(speed * 10) / 10)\n    }\n  }\n  _modifySpeed(direction: 1 | -1) {\n    let amount = this._rawInput!.get('select').value\n      ? 0.1\n      : this.speed < 0.5\n      ? 0.3\n      : 0.5\n    this.speed += direction * amount\n    if (this.speed < 0.2) this.speed = 0.2\n  }\n  _shouldAutoplay() {\n    return this.player.options.autoplayEnabled || isAutoplayEnabled()\n  }\n  _judgeColumn(buffer: NoteBuffer, control: Control, column: string) {\n    let judgedNote\n    let judgment\n    let notes = buffer.notes\n    let autoPlayed = false\n    for (let i = buffer.startIndex; i < notes.length; i++) {\n      let note = notes[i]\n      if (this._shouldJudge(note, control, buffer)) {\n        let shouldBreak = this.getNoteStatus(note) !== 'active'\n        judgedNote = note\n        judgment = this._judgeNote(note)\n        if (this._shouldAutoplay()) {\n          autoPlayed = true\n        }\n        if (shouldBreak) break\n      }\n    }\n    if (control.justPressed || autoPlayed) {\n      if (judgedNote && judgment != null) {\n        this.notifications.sounds!.push({\n          note: judgedNote,\n          type: 'hit',\n          judgment: judgment,\n        })\n      } else {\n        let freestyleNote = this._getFreestyleNote(notes)\n        if (freestyleNote) {\n          const shouldPlayFreestyleNote =\n            this.player.options.placement !== '3d' ||\n            !this._isSandwiched(column)\n          if (shouldPlayFreestyleNote) {\n            this.notifications.sounds!.push({\n              note: freestyleNote,\n              type: 'free',\n            })\n          }\n        }\n      }\n    }\n  }\n  _getClosestNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => Math.abs(this._gameTime - note.time))\n  }\n  _getFreestyleNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => {\n      let distance = Math.abs(this._gameTime - note.time)\n      let penalty = this._gameTime < note.time - 1 ? 1000000 : 0\n      return distance + penalty\n    })\n  }\n  _isSandwiched(column: string) {\n    const mapping: { [col: string]: string[] } = {\n      '2': ['1', '3'],\n      '3': ['2', '4'],\n      '4': ['3', '5'],\n      '5': ['4', '6'],\n      '6': ['5', '7'],\n    }\n    if (!mapping[column]) return false\n    return mapping[column].every((adjacentColumn) => {\n      const buffer = this._noteBufferByColumn[adjacentColumn]\n      if (!buffer) return false\n      return buffer.notes.some(\n        (note) => Math.abs(this._gameTime - note.time) < 0.1\n      )\n    })\n  }\n  _shouldJudge(note: GameNote, control: Control, buffer: NoteBuffer) {\n    let status = this.getNoteStatus(note)\n    if (status === 'unjudged') {\n      if (this._shouldAutoplay() && this._gameTime >= note.time) {\n        this.tainted = true\n        return true\n      }\n      let judgment = judgeTime(this._gameTime, note.time, this._judge)\n      let missed = judgment === MISSED\n      let hit = judgment > 0 && control.changed && control.value\n      if (isBad(judgment) && this._getClosestNote(buffer.notes) !== note) {\n        hit = false\n      }\n      return missed || hit\n    } else if (status === 'active') {\n      const noteEnd = note.end || invariant(false, 'note.end must exist')\n      if (this._shouldAutoplay() && this._gameTime >= noteEnd.time) {\n        this.tainted = true\n        return true\n      }\n      let judgment = judgeEndTime(this._gameTime, noteEnd.time, this._judge)\n      let missed = judgment === MISSED\n      let lifted = control.changed\n      let scratch = note.column === 'SC'\n      let passed = this._gameTime >= noteEnd.time\n      return missed || lifted || (scratch && passed)\n    } else {\n      return false\n    }\n  }\n  _judgeNote(note: GameNote) {\n    let delta = this._gameTime - note.time\n    let judgment = judgeTime(this._gameTime, note.time, this._judge)\n    let result = this._noteResult.get(note)\n    let isDown = !result || result.status === 'unjudged'\n    let isUp = result && result.status === 'active'\n    if (this._shouldAutoplay() && judgment >= 1) {\n      judgment = 1\n    }\n    if (note.end) {\n      if (isDown) {\n        let status = judgment === MISSED ? NoteStatus.Judged : NoteStatus.Active\n        if (judgment === MISSED) {\n          // judge missed long note twice\n          this._setJudgment(judgment, delta, note.column)\n        }\n        result = { status, judgment, delta }\n      } else if (isUp) {\n        let scratch = note.column === 'SC'\n        delta = this._gameTime - note.end.time\n        judgment =\n          judgeEndTime(this._gameTime, note.end.time, this._judge) || MISSED\n        if (scratch && delta > 0) judgment = 1\n        result = { status: NoteStatus.Judged, judgment, delta }\n      }\n    } else {\n      result = { status: NoteStatus.Judged, judgment, delta }\n    }\n    if (judgment === MISSED) {\n      this.notifications.sounds.push({ note, type: 'break' })\n    }\n    if (isDown && judgment !== MISSED) {\n      this.stats.handleDelta(delta)\n    }\n    if (!result) {\n      throw new Error('Invariant violation: result must not be undefined')\n    }\n    if (!judgment) {\n      throw new Error(\n        'Invariant violation: note should be judged by this point'\n      )\n    }\n    this._noteResult.set(note, result)\n    this._setJudgment(judgment, delta, note.column)\n    return judgment\n  }\n  _setJudgment(judgment: JudgedJudgment, delta: number, column: string) {\n    this.stats.handleJudgment(judgment)\n    let info = { judgment, combo: this.stats.combo, delta, column }\n    this.notifications.judgments.push(info)\n  }\n}\n\ntype NoteBuffer = {\n  notes: GameNote[]\n  startIndex: number\n  update: () => void\n}\n\nfunction isAutoplayEnabled() {\n  return !!(window as any).BEMUSE_AUTOPLAY\n}\n\nfunction noteBuffer(state: PlayerState) {\n  return function bufferNotes(notes: GameNote[]): NoteBuffer {\n    let startIndex = 0\n    return {\n      notes,\n      get startIndex() {\n        return startIndex\n      },\n      update() {\n        while (\n          startIndex < notes.length &&\n          state.getNoteStatus(notes[startIndex]) === 'judged'\n        ) {\n          startIndex += 1\n        }\n      },\n    }\n  }\n}\n\nexport default PlayerState\n","// Source: http://jsfiddle.net/vWx8V/\n// http://stackoverflow.com/questions/5603195/full-list-of-javascript-keycodes\n\n/**\n * Conenience method returns corresponding value for given keyName or keyCode.\n *\n * @param {Mixed} keyCode {Number} or keyName {String}\n * @return {Mixed}\n * @api public\n */\n\nfunction keyCode(searchInput) {\n  // Keyboard Events\n  if (searchInput && 'object' === typeof searchInput) {\n    var hasKeyCode = searchInput.which || searchInput.keyCode || searchInput.charCode\n    if (hasKeyCode) searchInput = hasKeyCode\n  }\n\n  // Numbers\n  if ('number' === typeof searchInput) return names[searchInput]\n\n  // Everything else (cast to string)\n  var search = String(searchInput)\n\n  // check codes\n  var foundNamedKey = codes[search.toLowerCase()]\n  if (foundNamedKey) return foundNamedKey\n\n  // check aliases\n  var foundNamedKey = aliases[search.toLowerCase()]\n  if (foundNamedKey) return foundNamedKey\n\n  // weird character?\n  if (search.length === 1) return search.charCodeAt(0)\n\n  return undefined\n}\n\n/**\n * Compares a keyboard event with a given keyCode or keyName.\n *\n * @param {Event} event Keyboard event that should be tested\n * @param {Mixed} keyCode {Number} or keyName {String}\n * @return {Boolean}\n * @api public\n */\nkeyCode.isEventKey = function isEventKey(event, nameOrCode) {\n  if (event && 'object' === typeof event) {\n    var keyCode = event.which || event.keyCode || event.charCode\n    if (keyCode === null || keyCode === undefined) { return false; }\n    if (typeof nameOrCode === 'string') {\n      // check codes\n      var foundNamedKey = codes[nameOrCode.toLowerCase()]\n      if (foundNamedKey) { return foundNamedKey === keyCode; }\n    \n      // check aliases\n      var foundNamedKey = aliases[nameOrCode.toLowerCase()]\n      if (foundNamedKey) { return foundNamedKey === keyCode; }\n    } else if (typeof nameOrCode === 'number') {\n      return nameOrCode === keyCode;\n    }\n    return false;\n  }\n}\n\nexports = module.exports = keyCode;\n\n/**\n * Get by name\n *\n *   exports.code['enter'] // => 13\n */\n\nvar codes = exports.code = exports.codes = {\n  'backspace': 8,\n  'tab': 9,\n  'enter': 13,\n  'shift': 16,\n  'ctrl': 17,\n  'alt': 18,\n  'pause/break': 19,\n  'caps lock': 20,\n  'esc': 27,\n  'space': 32,\n  'page up': 33,\n  'page down': 34,\n  'end': 35,\n  'home': 36,\n  'left': 37,\n  'up': 38,\n  'right': 39,\n  'down': 40,\n  'insert': 45,\n  'delete': 46,\n  'command': 91,\n  'left command': 91,\n  'right command': 93,\n  'numpad *': 106,\n  'numpad +': 107,\n  'numpad -': 109,\n  'numpad .': 110,\n  'numpad /': 111,\n  'num lock': 144,\n  'scroll lock': 145,\n  'my computer': 182,\n  'my calculator': 183,\n  ';': 186,\n  '=': 187,\n  ',': 188,\n  '-': 189,\n  '.': 190,\n  '/': 191,\n  '`': 192,\n  '[': 219,\n  '\\\\': 220,\n  ']': 221,\n  \"'\": 222\n}\n\n// Helper aliases\n\nvar aliases = exports.aliases = {\n  'windows': 91,\n  '': 16,\n  '': 18,\n  '': 17,\n  '': 91,\n  'ctl': 17,\n  'control': 17,\n  'option': 18,\n  'pause': 19,\n  'break': 19,\n  'caps': 20,\n  'return': 13,\n  'escape': 27,\n  'spc': 32,\n  'spacebar': 32,\n  'pgup': 33,\n  'pgdn': 34,\n  'ins': 45,\n  'del': 46,\n  'cmd': 91\n}\n\n/*!\n * Programatically add the following\n */\n\n// lower case chars\nfor (i = 97; i < 123; i++) codes[String.fromCharCode(i)] = i - 32\n\n// numbers\nfor (var i = 48; i < 58; i++) codes[i - 48] = i\n\n// function keys\nfor (i = 1; i < 13; i++) codes['f'+i] = i + 111\n\n// numpad keys\nfor (i = 0; i < 10; i++) codes['numpad '+i] = i + 96\n\n/**\n * Get by code\n *\n *   exports.name[13] // => 'Enter'\n */\n\nvar names = exports.names = exports.title = {} // title for backward compat\n\n// Create reverse mapping\nfor (i in codes) names[codes[i]] = i\n\n// Add aliases\nfor (var alias in aliases) {\n  codes[alias] = aliases[alias]\n}\n","import * as touch3d from './touch3d'\nimport NoteArea from './note-area'\nimport { MISSED, breaksCombo } from '../judgments'\nimport { getGauge } from './Gauge'\n\nexport class PlayerDisplay {\n  constructor(player, skinData) {\n    this._currentSpeed = 1\n    this._player = player\n    this._noteArea = new NoteArea(\n      player.notechart.notes,\n      player.notechart.barLines\n    )\n    this._stateful = {}\n    this._defaultData = {\n      placement: player.options.placement,\n      scratch: player.options.scratch,\n      key_mode: player.notechart.getKeyMode(player.options.scratch),\n      lane_lift: Math.max(0, -player.options.laneCover),\n      lane_press: Math.max(0, player.options.laneCover),\n    }\n    this._gauge = getGauge(player.options.gauge)\n    this._touch3dMode = skinData.displayMode === 'touch3d'\n  }\n  update(time, gameTime, playerState) {\n    const touch3dMode = this._touch3dMode\n    let player = this._player\n    let noteArea = this._noteArea\n    let stateful = this._stateful\n    let beat = player.notechart.secondsToBeat(gameTime)\n    let position = player.notechart.beatToPosition(beat)\n    let spacing = player.notechart.spacingAtBeat(beat)\n    let data = Object.assign({}, this._defaultData)\n    let push = (key, value) => (data[key] || (data[key] = [])).push(value)\n    let gauge = this._gauge\n\n    this._currentSpeed += (playerState.speed - this._currentSpeed) / 3\n    let speed = this._currentSpeed * spacing\n\n    updateBeat()\n    updateVisibleNotes()\n    updateBarLines()\n    updateInput()\n    updateJudgment()\n    updateGauge()\n    updateExplode()\n\n    data['speed'] = playerState.speed.toFixed(1) + 'x'\n    data['stat_1'] = getCount(1)\n    data['stat_2'] = getCount(2)\n    data['stat_3'] = getCount(3)\n    data['stat_4'] = getCount(4)\n    data['stat_missed'] = getCount(MISSED)\n    data['stat_acc'] = getAccuracy()\n    const bpm = player.notechart.bpmAtBeat(beat)\n    data['bpm'] = bpm < 1 ? '' : Math.round(bpm) % 10000 || ''\n\n    Object.assign(data, stateful)\n    return data\n\n    function updateBeat() {\n      data.beat = beat\n    }\n\n    function getCount(judgment) {\n      return playerState.stats.counts && playerState.stats.counts[judgment]\n    }\n\n    function getAccuracy() {\n      return ((playerState.stats.currentAccuracy || 0) * 100).toFixed(2) + '%'\n    }\n\n    function updateVisibleNotes() {\n      let entities = noteArea.getVisibleNotes(position, getUpperBound(), 1)\n      if (touch3dMode) {\n        const putNote = (id, noteY, column, scale = 1) => {\n          const row = touch3d.getRow(noteY - 0.01)\n          const columnIndex = +column || -1\n          const areaWidth = touch3d.PLAY_AREA_WIDTH\n          const xOffset =\n            row.projection * areaWidth * ((2 * (columnIndex - 0.5)) / 7 - 1)\n          const desiredWidth = (row.projection * scale * areaWidth * 2) / 7\n          push(`note3d_${column}`, {\n            key: id,\n            y: row.y,\n            x: xOffset + 1280 / 2,\n            width: desiredWidth,\n          })\n        }\n        let longNoteStep = 3 / 128\n        for (let entity of entities) {\n          let note = entity.note\n          let column = note.column\n          if (entity.height) {\n            let c = 0\n            let start = entity.y + entity.height\n            for (\n              let i =\n                start -\n                Math.max(\n                  0,\n                  Math.floor((start - 1) / longNoteStep) * longNoteStep\n                );\n              i >= 0 && i >= entity.y;\n              i -= longNoteStep\n            ) {\n              putNote(note.id + 'x' + c++, i, column, 0.8)\n            }\n            putNote(note.id, entity.y + entity.height, column)\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              putNote(note.id, entity.y, column)\n            }\n          }\n        }\n      } else {\n        for (let entity of entities) {\n          let note = entity.note\n          let column = note.column\n          if (entity.height) {\n            let judgment = playerState.getNoteJudgment(note)\n            let status = playerState.getNoteStatus(note)\n            push(`longnote_${column}`, {\n              key: note.id,\n              y: entity.y,\n              height: entity.height,\n              active: judgment !== 0 && judgment !== MISSED,\n              missed: status === 'judged' && judgment === MISSED,\n            })\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              push(`note_${column}`, {\n                key: note.id,\n                y: entity.y,\n              })\n            }\n          }\n        }\n      }\n    }\n\n    function updateBarLines() {\n      let entities = noteArea.getVisibleBarLines(position, getUpperBound(), 1)\n      for (let entity of entities) {\n        if (touch3dMode) {\n          const row = touch3d.getRow(entity.y - 0.01)\n          push('barlines3d', {\n            key: entity.id,\n            y: row.y,\n            x: row.projection * -touch3d.PLAY_AREA_WIDTH + 1280 / 2,\n            width: row.projection * touch3d.PLAY_AREA_WIDTH * 2,\n          })\n        } else {\n          push('barlines', { key: entity.id, y: entity.y })\n        }\n      }\n    }\n\n    function updateInput() {\n      let input = playerState.input\n      for (let column of player.columns) {\n        let control = input.get(column)\n        data[`${column}_active`] = control.value !== 0 ? 1 : 0\n        if (control.changed) {\n          if (control.value !== 0) {\n            stateful[`${column}_down`] = time\n          } else {\n            stateful[`${column}_up`] = time\n          }\n        }\n      }\n    }\n\n    function updateJudgment() {\n      let notifications = playerState.notifications.judgments\n      let notification = notifications[notifications.length - 1]\n      if (notification) {\n        let name =\n          notification.judgment === -1 ? 'missed' : `${notification.judgment}`\n        stateful[`judge_${name}`] = time\n        let deviationMode =\n          notification.judgment === -1 || notification.judgment === 1\n            ? 'none'\n            : notification.delta > 0\n            ? 'late'\n            : notification.delta < 0\n            ? 'early'\n            : 'none'\n        stateful[`judge_deviation_${deviationMode}`] = time\n        stateful['combo'] = notification.combo\n      }\n      data['score'] = playerState.stats.score\n    }\n\n    function updateGauge() {\n      gauge.update(playerState)\n      if (gauge.shouldDisplay()) {\n        if (!stateful['gauge_enter']) stateful['gauge_enter'] = time\n      } else {\n        if (stateful['gauge_enter']) {\n          if (!stateful['gauge_exit']) stateful['gauge_exit'] = time\n        }\n      }\n      data['gauge_primary'] = gauge.getPrimary()\n      data['gauge_secondary'] = gauge.getSecondary()\n      data['gauge_extra'] = gauge.getExtra()\n    }\n\n    function updateExplode() {\n      let notifications = playerState.notifications.judgments\n      for (let i = 0; i < notifications.length; i++) {\n        let notification = notifications[i]\n        if (!breaksCombo(notification.judgment)) {\n          stateful[`${notification.column}_explode`] = time\n        }\n      }\n    }\n\n    function getUpperBound() {\n      return position + 5 / speed\n    }\n  }\n}\n\nexport default PlayerDisplay\n","import { FileEntry, LoggingFunction, ICustomSongResources } from './types'\nimport {\n  CustomSongResources,\n  ARCHIVE_REGEXP,\n  downloadFileEntryFromURL,\n} from './custom-song-resources'\nimport { addUnprefixed } from './addUnprefixed'\n\n// TODO [#634]: Remove the `DndResources` class and have users of this class create a `CustomSongResources` directly.\n//\n// The original implementation of DndResources class has been extracted\n// into a CustomSongResources superclass in commit cc6a6e70586487ef476890f5a7911837186a7a32,\n// so that part of its logic can be re-used in other contexts, such as in commit ba9e15bab72fec17a144e40433cb3a4ffd31db5b.\n//\n// Now this `DndResources` class is really dumb and we want to prefer composition over inheritance.\n// This class should be removed.\nexport class DndResources\n  extends CustomSongResources\n  implements ICustomSongResources\n{\n  constructor(event: DragEvent) {\n    super({\n      getFiles: (log) => getFilesFromEvent(event, log),\n    })\n  }\n}\n\nexport default DndResources\n\nasync function getFilesFromEvent(\n  event: DragEvent,\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  let out: FileEntry[] = []\n  const dataTransfer = event.dataTransfer\n  if (!dataTransfer) {\n    throw new Error('Expect event.dataTransfer to be present')\n  }\n  if (dataTransfer.types.indexOf('text/uri-list') > -1) {\n    let url = dataTransfer\n      .getData('text/uri-list')\n      .split(/\\r\\n|\\r|\\n/)\n      .filter((t) => t && !t.startsWith('#'))[0]\n    if (ARCHIVE_REGEXP.test(url && url.replace(/[?#].*/, ''))) {\n      log('Link to archive file detected. Trying to download')\n      return [await downloadFileEntryFromURL(url, log)]\n    }\n  } else if (dataTransfer.items) {\n    for (let item of Array.from(dataTransfer.items)) {\n      await readItem(item)\n    }\n  } else if (dataTransfer.files) {\n    for (let file of Array.from(dataTransfer.files)) {\n      addFile(file)\n    }\n  }\n  return out\n\n  async function readItem(item: DataTransferItem) {\n    let entry = item.webkitGetAsEntry && item.webkitGetAsEntry()\n    if (entry) {\n      await readEntry(entry)\n    } else {\n      let file = item.getAsFile && item.getAsFile()\n      if (file) addFile(file)\n    }\n  }\n\n  function readEntry(entry: any, prefix = '') {\n    if (entry.isFile) {\n      return readFile(entry, prefix)\n    } else if (entry.isDirectory) {\n      return readDirectory(entry, prefix)\n    }\n  }\n\n  function readFile(entry: any, prefix = '') {\n    return new Promise<File>((resolve, reject) => {\n      entry.file(resolve, reject)\n    }).tap((file) => {\n      addFile(file, prefix)\n    })\n  }\n\n  async function readDirectory(dir: any, prefix = '') {\n    let entries: any[] = []\n    let reader = dir.createReader()\n    let readMore = () =>\n      new Promise<any>((resolve, reject) => {\n        reader.readEntries(resolve, reject)\n      })\n    for (;;) {\n      let results = await readMore()\n      if (!results || results.length === 0) break\n      entries.push(...Array.from(results))\n    }\n    for (let entry of entries) {\n      await readEntry(entry, prefix + dir.name + '/')\n    }\n  }\n\n  function addFile(file: File, prefix = '') {\n    if (file) {\n      addUnprefixed(prefix, file.name, (name) => {\n        out.push({ name, file })\n      })\n    }\n  }\n}\n","/*!\n\tCopyright (c) 2018 Jed Watson.\n\tLicensed under the MIT License (MIT), see\n\thttp://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\tvar nativeCodeString = '[native code]';\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString !== Object.prototype.toString && !arg.toString.toString().includes('[native code]')) {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","/* @preserve\n * The MIT License (MIT)\n * \n * Copyright (c) 2013-2018 Petka Antonov\n * \n * Permission is hereby granted, free of charge, to any person obtaining a copy\n * of this software and associated documentation files (the \"Software\"), to deal\n * in the Software without restriction, including without limitation the rights\n * to use, copy, modify, merge, publish, distribute, sublicense, and/or sell\n * copies of the Software, and to permit persons to whom the Software is\n * furnished to do so, subject to the following conditions:\n * \n * The above copyright notice and this permission notice shall be included in\n * all copies or substantial portions of the Software.\n * \n * THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR\n * IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,\n * FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.  IN NO EVENT SHALL THE\n * AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER\n * LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM,\n * OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN\n * THE SOFTWARE.\n * \n */\n/**\n * bluebird build version 3.7.2\n * Features enabled: core, race, call_get, generators, map, nodeify, promisify, props, reduce, settle, some, using, timers, filter, any, each\n*/\n!function(e){if(\"object\"==typeof exports&&\"undefined\"!=typeof module)module.exports=e();else if(\"function\"==typeof define&&define.amd)define([],e);else{var f;\"undefined\"!=typeof window?f=window:\"undefined\"!=typeof global?f=global:\"undefined\"!=typeof self&&(f=self),f.Promise=e()}}(function(){var define,module,exports;return (function e(t,n,r){function s(o,u){if(!n[o]){if(!t[o]){var a=typeof _dereq_==\"function\"&&_dereq_;if(!u&&a)return a(o,!0);if(i)return i(o,!0);var f=new Error(\"Cannot find module '\"+o+\"'\");throw f.code=\"MODULE_NOT_FOUND\",f}var l=n[o]={exports:{}};t[o][0].call(l.exports,function(e){var n=t[o][1][e];return s(n?n:e)},l,l.exports,e,t,n,r)}return n[o].exports}var i=typeof _dereq_==\"function\"&&_dereq_;for(var o=0;o<r.length;o++)s(r[o]);return s})({1:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar SomePromiseArray = Promise._SomePromiseArray;\nfunction any(promises) {\n    var ret = new SomePromiseArray(promises);\n    var promise = ret.promise();\n    ret.setHowMany(1);\n    ret.setUnwrap();\n    ret.init();\n    return promise;\n}\n\nPromise.any = function (promises) {\n    return any(promises);\n};\n\nPromise.prototype.any = function () {\n    return any(this);\n};\n\n};\n\n},{}],2:[function(_dereq_,module,exports){\n\"use strict\";\nvar firstLineError;\ntry {throw new Error(); } catch (e) {firstLineError = e;}\nvar schedule = _dereq_(\"./schedule\");\nvar Queue = _dereq_(\"./queue\");\n\nfunction Async() {\n    this._customScheduler = false;\n    this._isTickUsed = false;\n    this._lateQueue = new Queue(16);\n    this._normalQueue = new Queue(16);\n    this._haveDrainedQueues = false;\n    var self = this;\n    this.drainQueues = function () {\n        self._drainQueues();\n    };\n    this._schedule = schedule;\n}\n\nAsync.prototype.setScheduler = function(fn) {\n    var prev = this._schedule;\n    this._schedule = fn;\n    this._customScheduler = true;\n    return prev;\n};\n\nAsync.prototype.hasCustomScheduler = function() {\n    return this._customScheduler;\n};\n\nAsync.prototype.haveItemsQueued = function () {\n    return this._isTickUsed || this._haveDrainedQueues;\n};\n\n\nAsync.prototype.fatalError = function(e, isNode) {\n    if (isNode) {\n        process.stderr.write(\"Fatal \" + (e instanceof Error ? e.stack : e) +\n            \"\\n\");\n        process.exit(2);\n    } else {\n        this.throwLater(e);\n    }\n};\n\nAsync.prototype.throwLater = function(fn, arg) {\n    if (arguments.length === 1) {\n        arg = fn;\n        fn = function () { throw arg; };\n    }\n    if (typeof setTimeout !== \"undefined\") {\n        setTimeout(function() {\n            fn(arg);\n        }, 0);\n    } else try {\n        this._schedule(function() {\n            fn(arg);\n        });\n    } catch (e) {\n        throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n};\n\nfunction AsyncInvokeLater(fn, receiver, arg) {\n    this._lateQueue.push(fn, receiver, arg);\n    this._queueTick();\n}\n\nfunction AsyncInvoke(fn, receiver, arg) {\n    this._normalQueue.push(fn, receiver, arg);\n    this._queueTick();\n}\n\nfunction AsyncSettlePromises(promise) {\n    this._normalQueue._pushOne(promise);\n    this._queueTick();\n}\n\nAsync.prototype.invokeLater = AsyncInvokeLater;\nAsync.prototype.invoke = AsyncInvoke;\nAsync.prototype.settlePromises = AsyncSettlePromises;\n\n\nfunction _drainQueue(queue) {\n    while (queue.length() > 0) {\n        _drainQueueStep(queue);\n    }\n}\n\nfunction _drainQueueStep(queue) {\n    var fn = queue.shift();\n    if (typeof fn !== \"function\") {\n        fn._settlePromises();\n    } else {\n        var receiver = queue.shift();\n        var arg = queue.shift();\n        fn.call(receiver, arg);\n    }\n}\n\nAsync.prototype._drainQueues = function () {\n    _drainQueue(this._normalQueue);\n    this._reset();\n    this._haveDrainedQueues = true;\n    _drainQueue(this._lateQueue);\n};\n\nAsync.prototype._queueTick = function () {\n    if (!this._isTickUsed) {\n        this._isTickUsed = true;\n        this._schedule(this.drainQueues);\n    }\n};\n\nAsync.prototype._reset = function () {\n    this._isTickUsed = false;\n};\n\nmodule.exports = Async;\nmodule.exports.firstLineError = firstLineError;\n\n},{\"./queue\":26,\"./schedule\":29}],3:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise, debug) {\nvar calledBind = false;\nvar rejectThis = function(_, e) {\n    this._reject(e);\n};\n\nvar targetRejected = function(e, context) {\n    context.promiseRejectionQueued = true;\n    context.bindingPromise._then(rejectThis, rejectThis, null, this, e);\n};\n\nvar bindingResolved = function(thisArg, context) {\n    if (((this._bitField & 50397184) === 0)) {\n        this._resolveCallback(context.target);\n    }\n};\n\nvar bindingRejected = function(e, context) {\n    if (!context.promiseRejectionQueued) this._reject(e);\n};\n\nPromise.prototype.bind = function (thisArg) {\n    if (!calledBind) {\n        calledBind = true;\n        Promise.prototype._propagateFrom = debug.propagateFromFunction();\n        Promise.prototype._boundValue = debug.boundValueFunction();\n    }\n    var maybePromise = tryConvertToPromise(thisArg);\n    var ret = new Promise(INTERNAL);\n    ret._propagateFrom(this, 1);\n    var target = this._target();\n    ret._setBoundTo(maybePromise);\n    if (maybePromise instanceof Promise) {\n        var context = {\n            promiseRejectionQueued: false,\n            promise: ret,\n            target: target,\n            bindingPromise: maybePromise\n        };\n        target._then(INTERNAL, targetRejected, undefined, ret, context);\n        maybePromise._then(\n            bindingResolved, bindingRejected, undefined, ret, context);\n        ret._setOnCancel(maybePromise);\n    } else {\n        ret._resolveCallback(target);\n    }\n    return ret;\n};\n\nPromise.prototype._setBoundTo = function (obj) {\n    if (obj !== undefined) {\n        this._bitField = this._bitField | 2097152;\n        this._boundTo = obj;\n    } else {\n        this._bitField = this._bitField & (~2097152);\n    }\n};\n\nPromise.prototype._isBound = function () {\n    return (this._bitField & 2097152) === 2097152;\n};\n\nPromise.bind = function (thisArg, value) {\n    return Promise.resolve(value).bind(thisArg);\n};\n};\n\n},{}],4:[function(_dereq_,module,exports){\n\"use strict\";\nvar old;\nif (typeof Promise !== \"undefined\") old = Promise;\nfunction noConflict() {\n    try { if (Promise === bluebird) Promise = old; }\n    catch (e) {}\n    return bluebird;\n}\nvar bluebird = _dereq_(\"./promise\")();\nbluebird.noConflict = noConflict;\nmodule.exports = bluebird;\n\n},{\"./promise\":22}],5:[function(_dereq_,module,exports){\n\"use strict\";\nvar cr = Object.create;\nif (cr) {\n    var callerCache = cr(null);\n    var getterCache = cr(null);\n    callerCache[\" size\"] = getterCache[\" size\"] = 0;\n}\n\nmodule.exports = function(Promise) {\nvar util = _dereq_(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar isIdentifier = util.isIdentifier;\n\nvar getMethodCaller;\nvar getGetter;\nif (!true) {\nvar makeMethodCaller = function (methodName) {\n    return new Function(\"ensureMethod\", \"                                    \\n\\\n        return function(obj) {                                               \\n\\\n            'use strict'                                                     \\n\\\n            var len = this.length;                                           \\n\\\n            ensureMethod(obj, 'methodName');                                 \\n\\\n            switch(len) {                                                    \\n\\\n                case 1: return obj.methodName(this[0]);                      \\n\\\n                case 2: return obj.methodName(this[0], this[1]);             \\n\\\n                case 3: return obj.methodName(this[0], this[1], this[2]);    \\n\\\n                case 0: return obj.methodName();                             \\n\\\n                default:                                                     \\n\\\n                    return obj.methodName.apply(obj, this);                  \\n\\\n            }                                                                \\n\\\n        };                                                                   \\n\\\n        \".replace(/methodName/g, methodName))(ensureMethod);\n};\n\nvar makeGetter = function (propertyName) {\n    return new Function(\"obj\", \"                                             \\n\\\n        'use strict';                                                        \\n\\\n        return obj.propertyName;                                             \\n\\\n        \".replace(\"propertyName\", propertyName));\n};\n\nvar getCompiled = function(name, compiler, cache) {\n    var ret = cache[name];\n    if (typeof ret !== \"function\") {\n        if (!isIdentifier(name)) {\n            return null;\n        }\n        ret = compiler(name);\n        cache[name] = ret;\n        cache[\" size\"]++;\n        if (cache[\" size\"] > 512) {\n            var keys = Object.keys(cache);\n            for (var i = 0; i < 256; ++i) delete cache[keys[i]];\n            cache[\" size\"] = keys.length - 256;\n        }\n    }\n    return ret;\n};\n\ngetMethodCaller = function(name) {\n    return getCompiled(name, makeMethodCaller, callerCache);\n};\n\ngetGetter = function(name) {\n    return getCompiled(name, makeGetter, getterCache);\n};\n}\n\nfunction ensureMethod(obj, methodName) {\n    var fn;\n    if (obj != null) fn = obj[methodName];\n    if (typeof fn !== \"function\") {\n        var message = \"Object \" + util.classString(obj) + \" has no method '\" +\n            util.toString(methodName) + \"'\";\n        throw new Promise.TypeError(message);\n    }\n    return fn;\n}\n\nfunction caller(obj) {\n    var methodName = this.pop();\n    var fn = ensureMethod(obj, methodName);\n    return fn.apply(obj, this);\n}\nPromise.prototype.call = function (methodName) {\n    var args = [].slice.call(arguments, 1);;\n    if (!true) {\n        if (canEvaluate) {\n            var maybeCaller = getMethodCaller(methodName);\n            if (maybeCaller !== null) {\n                return this._then(\n                    maybeCaller, undefined, undefined, args, undefined);\n            }\n        }\n    }\n    args.push(methodName);\n    return this._then(caller, undefined, undefined, args, undefined);\n};\n\nfunction namedGetter(obj) {\n    return obj[this];\n}\nfunction indexedGetter(obj) {\n    var index = +this;\n    if (index < 0) index = Math.max(0, index + obj.length);\n    return obj[index];\n}\nPromise.prototype.get = function (propertyName) {\n    var isIndex = (typeof propertyName === \"number\");\n    var getter;\n    if (!isIndex) {\n        if (canEvaluate) {\n            var maybeGetter = getGetter(propertyName);\n            getter = maybeGetter !== null ? maybeGetter : namedGetter;\n        } else {\n            getter = namedGetter;\n        }\n    } else {\n        getter = indexedGetter;\n    }\n    return this._then(getter, undefined, undefined, propertyName, undefined);\n};\n};\n\n},{\"./util\":36}],6:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, PromiseArray, apiRejection, debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nPromise.prototype[\"break\"] = Promise.prototype.cancel = function() {\n    if (!debug.cancellation()) return this._warn(\"cancellation is disabled\");\n\n    var promise = this;\n    var child = promise;\n    while (promise._isCancellable()) {\n        if (!promise._cancelBy(child)) {\n            if (child._isFollowing()) {\n                child._followee().cancel();\n            } else {\n                child._cancelBranched();\n            }\n            break;\n        }\n\n        var parent = promise._cancellationParent;\n        if (parent == null || !parent._isCancellable()) {\n            if (promise._isFollowing()) {\n                promise._followee().cancel();\n            } else {\n                promise._cancelBranched();\n            }\n            break;\n        } else {\n            if (promise._isFollowing()) promise._followee().cancel();\n            promise._setWillBeCancelled();\n            child = promise;\n            promise = parent;\n        }\n    }\n};\n\nPromise.prototype._branchHasCancelled = function() {\n    this._branchesRemainingToCancel--;\n};\n\nPromise.prototype._enoughBranchesHaveCancelled = function() {\n    return this._branchesRemainingToCancel === undefined ||\n           this._branchesRemainingToCancel <= 0;\n};\n\nPromise.prototype._cancelBy = function(canceller) {\n    if (canceller === this) {\n        this._branchesRemainingToCancel = 0;\n        this._invokeOnCancel();\n        return true;\n    } else {\n        this._branchHasCancelled();\n        if (this._enoughBranchesHaveCancelled()) {\n            this._invokeOnCancel();\n            return true;\n        }\n    }\n    return false;\n};\n\nPromise.prototype._cancelBranched = function() {\n    if (this._enoughBranchesHaveCancelled()) {\n        this._cancel();\n    }\n};\n\nPromise.prototype._cancel = function() {\n    if (!this._isCancellable()) return;\n    this._setCancelled();\n    async.invoke(this._cancelPromises, this, undefined);\n};\n\nPromise.prototype._cancelPromises = function() {\n    if (this._length() > 0) this._settlePromises();\n};\n\nPromise.prototype._unsetOnCancel = function() {\n    this._onCancelField = undefined;\n};\n\nPromise.prototype._isCancellable = function() {\n    return this.isPending() && !this._isCancelled();\n};\n\nPromise.prototype.isCancellable = function() {\n    return this.isPending() && !this.isCancelled();\n};\n\nPromise.prototype._doInvokeOnCancel = function(onCancelCallback, internalOnly) {\n    if (util.isArray(onCancelCallback)) {\n        for (var i = 0; i < onCancelCallback.length; ++i) {\n            this._doInvokeOnCancel(onCancelCallback[i], internalOnly);\n        }\n    } else if (onCancelCallback !== undefined) {\n        if (typeof onCancelCallback === \"function\") {\n            if (!internalOnly) {\n                var e = tryCatch(onCancelCallback).call(this._boundValue());\n                if (e === errorObj) {\n                    this._attachExtraTrace(e.e);\n                    async.throwLater(e.e);\n                }\n            }\n        } else {\n            onCancelCallback._resultCancelled(this);\n        }\n    }\n};\n\nPromise.prototype._invokeOnCancel = function() {\n    var onCancelCallback = this._onCancel();\n    this._unsetOnCancel();\n    async.invoke(this._doInvokeOnCancel, this, onCancelCallback);\n};\n\nPromise.prototype._invokeInternalOnCancel = function() {\n    if (this._isCancellable()) {\n        this._doInvokeOnCancel(this._onCancel(), true);\n        this._unsetOnCancel();\n    }\n};\n\nPromise.prototype._resultCancelled = function() {\n    this.cancel();\n};\n\n};\n\n},{\"./util\":36}],7:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(NEXT_FILTER) {\nvar util = _dereq_(\"./util\");\nvar getKeys = _dereq_(\"./es5\").keys;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nfunction catchFilter(instances, cb, promise) {\n    return function(e) {\n        var boundTo = promise._boundValue();\n        predicateLoop: for (var i = 0; i < instances.length; ++i) {\n            var item = instances[i];\n\n            if (item === Error ||\n                (item != null && item.prototype instanceof Error)) {\n                if (e instanceof item) {\n                    return tryCatch(cb).call(boundTo, e);\n                }\n            } else if (typeof item === \"function\") {\n                var matchesPredicate = tryCatch(item).call(boundTo, e);\n                if (matchesPredicate === errorObj) {\n                    return matchesPredicate;\n                } else if (matchesPredicate) {\n                    return tryCatch(cb).call(boundTo, e);\n                }\n            } else if (util.isObject(e)) {\n                var keys = getKeys(item);\n                for (var j = 0; j < keys.length; ++j) {\n                    var key = keys[j];\n                    if (item[key] != e[key]) {\n                        continue predicateLoop;\n                    }\n                }\n                return tryCatch(cb).call(boundTo, e);\n            }\n        }\n        return NEXT_FILTER;\n    };\n}\n\nreturn catchFilter;\n};\n\n},{\"./es5\":13,\"./util\":36}],8:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar longStackTraces = false;\nvar contextStack = [];\n\nPromise.prototype._promiseCreated = function() {};\nPromise.prototype._pushContext = function() {};\nPromise.prototype._popContext = function() {return null;};\nPromise._peekContext = Promise.prototype._peekContext = function() {};\n\nfunction Context() {\n    this._trace = new Context.CapturedTrace(peekContext());\n}\nContext.prototype._pushContext = function () {\n    if (this._trace !== undefined) {\n        this._trace._promiseCreated = null;\n        contextStack.push(this._trace);\n    }\n};\n\nContext.prototype._popContext = function () {\n    if (this._trace !== undefined) {\n        var trace = contextStack.pop();\n        var ret = trace._promiseCreated;\n        trace._promiseCreated = null;\n        return ret;\n    }\n    return null;\n};\n\nfunction createContext() {\n    if (longStackTraces) return new Context();\n}\n\nfunction peekContext() {\n    var lastIndex = contextStack.length - 1;\n    if (lastIndex >= 0) {\n        return contextStack[lastIndex];\n    }\n    return undefined;\n}\nContext.CapturedTrace = null;\nContext.create = createContext;\nContext.deactivateLongStackTraces = function() {};\nContext.activateLongStackTraces = function() {\n    var Promise_pushContext = Promise.prototype._pushContext;\n    var Promise_popContext = Promise.prototype._popContext;\n    var Promise_PeekContext = Promise._peekContext;\n    var Promise_peekContext = Promise.prototype._peekContext;\n    var Promise_promiseCreated = Promise.prototype._promiseCreated;\n    Context.deactivateLongStackTraces = function() {\n        Promise.prototype._pushContext = Promise_pushContext;\n        Promise.prototype._popContext = Promise_popContext;\n        Promise._peekContext = Promise_PeekContext;\n        Promise.prototype._peekContext = Promise_peekContext;\n        Promise.prototype._promiseCreated = Promise_promiseCreated;\n        longStackTraces = false;\n    };\n    longStackTraces = true;\n    Promise.prototype._pushContext = Context.prototype._pushContext;\n    Promise.prototype._popContext = Context.prototype._popContext;\n    Promise._peekContext = Promise.prototype._peekContext = peekContext;\n    Promise.prototype._promiseCreated = function() {\n        var ctx = this._peekContext();\n        if (ctx && ctx._promiseCreated == null) ctx._promiseCreated = this;\n    };\n};\nreturn Context;\n};\n\n},{}],9:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, Context,\n    enableAsyncHooks, disableAsyncHooks) {\nvar async = Promise._async;\nvar Warning = _dereq_(\"./errors\").Warning;\nvar util = _dereq_(\"./util\");\nvar es5 = _dereq_(\"./es5\");\nvar canAttachTrace = util.canAttachTrace;\nvar unhandledRejectionHandled;\nvar possiblyUnhandledRejection;\nvar bluebirdFramePattern =\n    /[\\\\\\/]bluebird[\\\\\\/]js[\\\\\\/](release|debug|instrumented)/;\nvar nodeFramePattern = /\\((?:timers\\.js):\\d+:\\d+\\)/;\nvar parseLinePattern = /[\\/<\\(](.+?):(\\d+):(\\d+)\\)?\\s*$/;\nvar stackFramePattern = null;\nvar formatStack = null;\nvar indentStackFrames = false;\nvar printWarning;\nvar debugging = !!(util.env(\"BLUEBIRD_DEBUG\") != 0 &&\n                        (true ||\n                         util.env(\"BLUEBIRD_DEBUG\") ||\n                         util.env(\"NODE_ENV\") === \"development\"));\n\nvar warnings = !!(util.env(\"BLUEBIRD_WARNINGS\") != 0 &&\n    (debugging || util.env(\"BLUEBIRD_WARNINGS\")));\n\nvar longStackTraces = !!(util.env(\"BLUEBIRD_LONG_STACK_TRACES\") != 0 &&\n    (debugging || util.env(\"BLUEBIRD_LONG_STACK_TRACES\")));\n\nvar wForgottenReturn = util.env(\"BLUEBIRD_W_FORGOTTEN_RETURN\") != 0 &&\n    (warnings || !!util.env(\"BLUEBIRD_W_FORGOTTEN_RETURN\"));\n\nvar deferUnhandledRejectionCheck;\n(function() {\n    var promises = [];\n\n    function unhandledRejectionCheck() {\n        for (var i = 0; i < promises.length; ++i) {\n            promises[i]._notifyUnhandledRejection();\n        }\n        unhandledRejectionClear();\n    }\n\n    function unhandledRejectionClear() {\n        promises.length = 0;\n    }\n\n    deferUnhandledRejectionCheck = function(promise) {\n        promises.push(promise);\n        setTimeout(unhandledRejectionCheck, 1);\n    };\n\n    es5.defineProperty(Promise, \"_unhandledRejectionCheck\", {\n        value: unhandledRejectionCheck\n    });\n    es5.defineProperty(Promise, \"_unhandledRejectionClear\", {\n        value: unhandledRejectionClear\n    });\n})();\n\nPromise.prototype.suppressUnhandledRejections = function() {\n    var target = this._target();\n    target._bitField = ((target._bitField & (~1048576)) |\n                      524288);\n};\n\nPromise.prototype._ensurePossibleRejectionHandled = function () {\n    if ((this._bitField & 524288) !== 0) return;\n    this._setRejectionIsUnhandled();\n    deferUnhandledRejectionCheck(this);\n};\n\nPromise.prototype._notifyUnhandledRejectionIsHandled = function () {\n    fireRejectionEvent(\"rejectionHandled\",\n                                  unhandledRejectionHandled, undefined, this);\n};\n\nPromise.prototype._setReturnedNonUndefined = function() {\n    this._bitField = this._bitField | 268435456;\n};\n\nPromise.prototype._returnedNonUndefined = function() {\n    return (this._bitField & 268435456) !== 0;\n};\n\nPromise.prototype._notifyUnhandledRejection = function () {\n    if (this._isRejectionUnhandled()) {\n        var reason = this._settledValue();\n        this._setUnhandledRejectionIsNotified();\n        fireRejectionEvent(\"unhandledRejection\",\n                                      possiblyUnhandledRejection, reason, this);\n    }\n};\n\nPromise.prototype._setUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField | 262144;\n};\n\nPromise.prototype._unsetUnhandledRejectionIsNotified = function () {\n    this._bitField = this._bitField & (~262144);\n};\n\nPromise.prototype._isUnhandledRejectionNotified = function () {\n    return (this._bitField & 262144) > 0;\n};\n\nPromise.prototype._setRejectionIsUnhandled = function () {\n    this._bitField = this._bitField | 1048576;\n};\n\nPromise.prototype._unsetRejectionIsUnhandled = function () {\n    this._bitField = this._bitField & (~1048576);\n    if (this._isUnhandledRejectionNotified()) {\n        this._unsetUnhandledRejectionIsNotified();\n        this._notifyUnhandledRejectionIsHandled();\n    }\n};\n\nPromise.prototype._isRejectionUnhandled = function () {\n    return (this._bitField & 1048576) > 0;\n};\n\nPromise.prototype._warn = function(message, shouldUseOwnTrace, promise) {\n    return warn(message, shouldUseOwnTrace, promise || this);\n};\n\nPromise.onPossiblyUnhandledRejection = function (fn) {\n    var context = Promise._getContext();\n    possiblyUnhandledRejection = util.contextBind(context, fn);\n};\n\nPromise.onUnhandledRejectionHandled = function (fn) {\n    var context = Promise._getContext();\n    unhandledRejectionHandled = util.contextBind(context, fn);\n};\n\nvar disableLongStackTraces = function() {};\nPromise.longStackTraces = function () {\n    if (async.haveItemsQueued() && !config.longStackTraces) {\n        throw new Error(\"cannot enable long stack traces after promises have been created\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    if (!config.longStackTraces && longStackTracesIsSupported()) {\n        var Promise_captureStackTrace = Promise.prototype._captureStackTrace;\n        var Promise_attachExtraTrace = Promise.prototype._attachExtraTrace;\n        var Promise_dereferenceTrace = Promise.prototype._dereferenceTrace;\n        config.longStackTraces = true;\n        disableLongStackTraces = function() {\n            if (async.haveItemsQueued() && !config.longStackTraces) {\n                throw new Error(\"cannot enable long stack traces after promises have been created\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n            }\n            Promise.prototype._captureStackTrace = Promise_captureStackTrace;\n            Promise.prototype._attachExtraTrace = Promise_attachExtraTrace;\n            Promise.prototype._dereferenceTrace = Promise_dereferenceTrace;\n            Context.deactivateLongStackTraces();\n            config.longStackTraces = false;\n        };\n        Promise.prototype._captureStackTrace = longStackTracesCaptureStackTrace;\n        Promise.prototype._attachExtraTrace = longStackTracesAttachExtraTrace;\n        Promise.prototype._dereferenceTrace = longStackTracesDereferenceTrace;\n        Context.activateLongStackTraces();\n    }\n};\n\nPromise.hasLongStackTraces = function () {\n    return config.longStackTraces && longStackTracesIsSupported();\n};\n\n\nvar legacyHandlers = {\n    unhandledrejection: {\n        before: function() {\n            var ret = util.global.onunhandledrejection;\n            util.global.onunhandledrejection = null;\n            return ret;\n        },\n        after: function(fn) {\n            util.global.onunhandledrejection = fn;\n        }\n    },\n    rejectionhandled: {\n        before: function() {\n            var ret = util.global.onrejectionhandled;\n            util.global.onrejectionhandled = null;\n            return ret;\n        },\n        after: function(fn) {\n            util.global.onrejectionhandled = fn;\n        }\n    }\n};\n\nvar fireDomEvent = (function() {\n    var dispatch = function(legacy, e) {\n        if (legacy) {\n            var fn;\n            try {\n                fn = legacy.before();\n                return !util.global.dispatchEvent(e);\n            } finally {\n                legacy.after(fn);\n            }\n        } else {\n            return !util.global.dispatchEvent(e);\n        }\n    };\n    try {\n        if (typeof CustomEvent === \"function\") {\n            var event = new CustomEvent(\"CustomEvent\");\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                name = name.toLowerCase();\n                var eventData = {\n                    detail: event,\n                    cancelable: true\n                };\n                var domEvent = new CustomEvent(name, eventData);\n                es5.defineProperty(\n                    domEvent, \"promise\", {value: event.promise});\n                es5.defineProperty(\n                    domEvent, \"reason\", {value: event.reason});\n\n                return dispatch(legacyHandlers[name], domEvent);\n            };\n        } else if (typeof Event === \"function\") {\n            var event = new Event(\"CustomEvent\");\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                name = name.toLowerCase();\n                var domEvent = new Event(name, {\n                    cancelable: true\n                });\n                domEvent.detail = event;\n                es5.defineProperty(domEvent, \"promise\", {value: event.promise});\n                es5.defineProperty(domEvent, \"reason\", {value: event.reason});\n                return dispatch(legacyHandlers[name], domEvent);\n            };\n        } else {\n            var event = document.createEvent(\"CustomEvent\");\n            event.initCustomEvent(\"testingtheevent\", false, true, {});\n            util.global.dispatchEvent(event);\n            return function(name, event) {\n                name = name.toLowerCase();\n                var domEvent = document.createEvent(\"CustomEvent\");\n                domEvent.initCustomEvent(name, false, true,\n                    event);\n                return dispatch(legacyHandlers[name], domEvent);\n            };\n        }\n    } catch (e) {}\n    return function() {\n        return false;\n    };\n})();\n\nvar fireGlobalEvent = (function() {\n    if (util.isNode) {\n        return function() {\n            return process.emit.apply(process, arguments);\n        };\n    } else {\n        if (!util.global) {\n            return function() {\n                return false;\n            };\n        }\n        return function(name) {\n            var methodName = \"on\" + name.toLowerCase();\n            var method = util.global[methodName];\n            if (!method) return false;\n            method.apply(util.global, [].slice.call(arguments, 1));\n            return true;\n        };\n    }\n})();\n\nfunction generatePromiseLifecycleEventObject(name, promise) {\n    return {promise: promise};\n}\n\nvar eventToObjectGenerator = {\n    promiseCreated: generatePromiseLifecycleEventObject,\n    promiseFulfilled: generatePromiseLifecycleEventObject,\n    promiseRejected: generatePromiseLifecycleEventObject,\n    promiseResolved: generatePromiseLifecycleEventObject,\n    promiseCancelled: generatePromiseLifecycleEventObject,\n    promiseChained: function(name, promise, child) {\n        return {promise: promise, child: child};\n    },\n    warning: function(name, warning) {\n        return {warning: warning};\n    },\n    unhandledRejection: function (name, reason, promise) {\n        return {reason: reason, promise: promise};\n    },\n    rejectionHandled: generatePromiseLifecycleEventObject\n};\n\nvar activeFireEvent = function (name) {\n    var globalEventFired = false;\n    try {\n        globalEventFired = fireGlobalEvent.apply(null, arguments);\n    } catch (e) {\n        async.throwLater(e);\n        globalEventFired = true;\n    }\n\n    var domEventFired = false;\n    try {\n        domEventFired = fireDomEvent(name,\n                    eventToObjectGenerator[name].apply(null, arguments));\n    } catch (e) {\n        async.throwLater(e);\n        domEventFired = true;\n    }\n\n    return domEventFired || globalEventFired;\n};\n\nPromise.config = function(opts) {\n    opts = Object(opts);\n    if (\"longStackTraces\" in opts) {\n        if (opts.longStackTraces) {\n            Promise.longStackTraces();\n        } else if (!opts.longStackTraces && Promise.hasLongStackTraces()) {\n            disableLongStackTraces();\n        }\n    }\n    if (\"warnings\" in opts) {\n        var warningsOption = opts.warnings;\n        config.warnings = !!warningsOption;\n        wForgottenReturn = config.warnings;\n\n        if (util.isObject(warningsOption)) {\n            if (\"wForgottenReturn\" in warningsOption) {\n                wForgottenReturn = !!warningsOption.wForgottenReturn;\n            }\n        }\n    }\n    if (\"cancellation\" in opts && opts.cancellation && !config.cancellation) {\n        if (async.haveItemsQueued()) {\n            throw new Error(\n                \"cannot enable cancellation after promises are in use\");\n        }\n        Promise.prototype._clearCancellationData =\n            cancellationClearCancellationData;\n        Promise.prototype._propagateFrom = cancellationPropagateFrom;\n        Promise.prototype._onCancel = cancellationOnCancel;\n        Promise.prototype._setOnCancel = cancellationSetOnCancel;\n        Promise.prototype._attachCancellationCallback =\n            cancellationAttachCancellationCallback;\n        Promise.prototype._execute = cancellationExecute;\n        propagateFromFunction = cancellationPropagateFrom;\n        config.cancellation = true;\n    }\n    if (\"monitoring\" in opts) {\n        if (opts.monitoring && !config.monitoring) {\n            config.monitoring = true;\n            Promise.prototype._fireEvent = activeFireEvent;\n        } else if (!opts.monitoring && config.monitoring) {\n            config.monitoring = false;\n            Promise.prototype._fireEvent = defaultFireEvent;\n        }\n    }\n    if (\"asyncHooks\" in opts && util.nodeSupportsAsyncResource) {\n        var prev = config.asyncHooks;\n        var cur = !!opts.asyncHooks;\n        if (prev !== cur) {\n            config.asyncHooks = cur;\n            if (cur) {\n                enableAsyncHooks();\n            } else {\n                disableAsyncHooks();\n            }\n        }\n    }\n    return Promise;\n};\n\nfunction defaultFireEvent() { return false; }\n\nPromise.prototype._fireEvent = defaultFireEvent;\nPromise.prototype._execute = function(executor, resolve, reject) {\n    try {\n        executor(resolve, reject);\n    } catch (e) {\n        return e;\n    }\n};\nPromise.prototype._onCancel = function () {};\nPromise.prototype._setOnCancel = function (handler) { ; };\nPromise.prototype._attachCancellationCallback = function(onCancel) {\n    ;\n};\nPromise.prototype._captureStackTrace = function () {};\nPromise.prototype._attachExtraTrace = function () {};\nPromise.prototype._dereferenceTrace = function () {};\nPromise.prototype._clearCancellationData = function() {};\nPromise.prototype._propagateFrom = function (parent, flags) {\n    ;\n    ;\n};\n\nfunction cancellationExecute(executor, resolve, reject) {\n    var promise = this;\n    try {\n        executor(resolve, reject, function(onCancel) {\n            if (typeof onCancel !== \"function\") {\n                throw new TypeError(\"onCancel must be a function, got: \" +\n                                    util.toString(onCancel));\n            }\n            promise._attachCancellationCallback(onCancel);\n        });\n    } catch (e) {\n        return e;\n    }\n}\n\nfunction cancellationAttachCancellationCallback(onCancel) {\n    if (!this._isCancellable()) return this;\n\n    var previousOnCancel = this._onCancel();\n    if (previousOnCancel !== undefined) {\n        if (util.isArray(previousOnCancel)) {\n            previousOnCancel.push(onCancel);\n        } else {\n            this._setOnCancel([previousOnCancel, onCancel]);\n        }\n    } else {\n        this._setOnCancel(onCancel);\n    }\n}\n\nfunction cancellationOnCancel() {\n    return this._onCancelField;\n}\n\nfunction cancellationSetOnCancel(onCancel) {\n    this._onCancelField = onCancel;\n}\n\nfunction cancellationClearCancellationData() {\n    this._cancellationParent = undefined;\n    this._onCancelField = undefined;\n}\n\nfunction cancellationPropagateFrom(parent, flags) {\n    if ((flags & 1) !== 0) {\n        this._cancellationParent = parent;\n        var branchesRemainingToCancel = parent._branchesRemainingToCancel;\n        if (branchesRemainingToCancel === undefined) {\n            branchesRemainingToCancel = 0;\n        }\n        parent._branchesRemainingToCancel = branchesRemainingToCancel + 1;\n    }\n    if ((flags & 2) !== 0 && parent._isBound()) {\n        this._setBoundTo(parent._boundTo);\n    }\n}\n\nfunction bindingPropagateFrom(parent, flags) {\n    if ((flags & 2) !== 0 && parent._isBound()) {\n        this._setBoundTo(parent._boundTo);\n    }\n}\nvar propagateFromFunction = bindingPropagateFrom;\n\nfunction boundValueFunction() {\n    var ret = this._boundTo;\n    if (ret !== undefined) {\n        if (ret instanceof Promise) {\n            if (ret.isFulfilled()) {\n                return ret.value();\n            } else {\n                return undefined;\n            }\n        }\n    }\n    return ret;\n}\n\nfunction longStackTracesCaptureStackTrace() {\n    this._trace = new CapturedTrace(this._peekContext());\n}\n\nfunction longStackTracesAttachExtraTrace(error, ignoreSelf) {\n    if (canAttachTrace(error)) {\n        var trace = this._trace;\n        if (trace !== undefined) {\n            if (ignoreSelf) trace = trace._parent;\n        }\n        if (trace !== undefined) {\n            trace.attachExtraTrace(error);\n        } else if (!error.__stackCleaned__) {\n            var parsed = parseStackAndMessage(error);\n            util.notEnumerableProp(error, \"stack\",\n                parsed.message + \"\\n\" + parsed.stack.join(\"\\n\"));\n            util.notEnumerableProp(error, \"__stackCleaned__\", true);\n        }\n    }\n}\n\nfunction longStackTracesDereferenceTrace() {\n    this._trace = undefined;\n}\n\nfunction checkForgottenReturns(returnValue, promiseCreated, name, promise,\n                               parent) {\n    if (returnValue === undefined && promiseCreated !== null &&\n        wForgottenReturn) {\n        if (parent !== undefined && parent._returnedNonUndefined()) return;\n        if ((promise._bitField & 65535) === 0) return;\n\n        if (name) name = name + \" \";\n        var handlerLine = \"\";\n        var creatorLine = \"\";\n        if (promiseCreated._trace) {\n            var traceLines = promiseCreated._trace.stack.split(\"\\n\");\n            var stack = cleanStack(traceLines);\n            for (var i = stack.length - 1; i >= 0; --i) {\n                var line = stack[i];\n                if (!nodeFramePattern.test(line)) {\n                    var lineMatches = line.match(parseLinePattern);\n                    if (lineMatches) {\n                        handlerLine  = \"at \" + lineMatches[1] +\n                            \":\" + lineMatches[2] + \":\" + lineMatches[3] + \" \";\n                    }\n                    break;\n                }\n            }\n\n            if (stack.length > 0) {\n                var firstUserLine = stack[0];\n                for (var i = 0; i < traceLines.length; ++i) {\n\n                    if (traceLines[i] === firstUserLine) {\n                        if (i > 0) {\n                            creatorLine = \"\\n\" + traceLines[i - 1];\n                        }\n                        break;\n                    }\n                }\n\n            }\n        }\n        var msg = \"a promise was created in a \" + name +\n            \"handler \" + handlerLine + \"but was not returned from it, \" +\n            \"see http://goo.gl/rRqMUw\" +\n            creatorLine;\n        promise._warn(msg, true, promiseCreated);\n    }\n}\n\nfunction deprecated(name, replacement) {\n    var message = name +\n        \" is deprecated and will be removed in a future version.\";\n    if (replacement) message += \" Use \" + replacement + \" instead.\";\n    return warn(message);\n}\n\nfunction warn(message, shouldUseOwnTrace, promise) {\n    if (!config.warnings) return;\n    var warning = new Warning(message);\n    var ctx;\n    if (shouldUseOwnTrace) {\n        promise._attachExtraTrace(warning);\n    } else if (config.longStackTraces && (ctx = Promise._peekContext())) {\n        ctx.attachExtraTrace(warning);\n    } else {\n        var parsed = parseStackAndMessage(warning);\n        warning.stack = parsed.message + \"\\n\" + parsed.stack.join(\"\\n\");\n    }\n\n    if (!activeFireEvent(\"warning\", warning)) {\n        formatAndLogError(warning, \"\", true);\n    }\n}\n\nfunction reconstructStack(message, stacks) {\n    for (var i = 0; i < stacks.length - 1; ++i) {\n        stacks[i].push(\"From previous event:\");\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    if (i < stacks.length) {\n        stacks[i] = stacks[i].join(\"\\n\");\n    }\n    return message + \"\\n\" + stacks.join(\"\\n\");\n}\n\nfunction removeDuplicateOrEmptyJumps(stacks) {\n    for (var i = 0; i < stacks.length; ++i) {\n        if (stacks[i].length === 0 ||\n            ((i + 1 < stacks.length) && stacks[i][0] === stacks[i+1][0])) {\n            stacks.splice(i, 1);\n            i--;\n        }\n    }\n}\n\nfunction removeCommonRoots(stacks) {\n    var current = stacks[0];\n    for (var i = 1; i < stacks.length; ++i) {\n        var prev = stacks[i];\n        var currentLastIndex = current.length - 1;\n        var currentLastLine = current[currentLastIndex];\n        var commonRootMeetPoint = -1;\n\n        for (var j = prev.length - 1; j >= 0; --j) {\n            if (prev[j] === currentLastLine) {\n                commonRootMeetPoint = j;\n                break;\n            }\n        }\n\n        for (var j = commonRootMeetPoint; j >= 0; --j) {\n            var line = prev[j];\n            if (current[currentLastIndex] === line) {\n                current.pop();\n                currentLastIndex--;\n            } else {\n                break;\n            }\n        }\n        current = prev;\n    }\n}\n\nfunction cleanStack(stack) {\n    var ret = [];\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        var isTraceLine = \"    (No stack trace)\" === line ||\n            stackFramePattern.test(line);\n        var isInternalFrame = isTraceLine && shouldIgnore(line);\n        if (isTraceLine && !isInternalFrame) {\n            if (indentStackFrames && line.charAt(0) !== \" \") {\n                line = \"    \" + line;\n            }\n            ret.push(line);\n        }\n    }\n    return ret;\n}\n\nfunction stackFramesAsArray(error) {\n    var stack = error.stack.replace(/\\s+$/g, \"\").split(\"\\n\");\n    for (var i = 0; i < stack.length; ++i) {\n        var line = stack[i];\n        if (\"    (No stack trace)\" === line || stackFramePattern.test(line)) {\n            break;\n        }\n    }\n    if (i > 0 && error.name != \"SyntaxError\") {\n        stack = stack.slice(i);\n    }\n    return stack;\n}\n\nfunction parseStackAndMessage(error) {\n    var stack = error.stack;\n    var message = error.toString();\n    stack = typeof stack === \"string\" && stack.length > 0\n                ? stackFramesAsArray(error) : [\"    (No stack trace)\"];\n    return {\n        message: message,\n        stack: error.name == \"SyntaxError\" ? stack : cleanStack(stack)\n    };\n}\n\nfunction formatAndLogError(error, title, isSoft) {\n    if (typeof console !== \"undefined\") {\n        var message;\n        if (util.isObject(error)) {\n            var stack = error.stack;\n            message = title + formatStack(stack, error);\n        } else {\n            message = title + String(error);\n        }\n        if (typeof printWarning === \"function\") {\n            printWarning(message, isSoft);\n        } else if (typeof console.log === \"function\" ||\n            typeof console.log === \"object\") {\n            console.log(message);\n        }\n    }\n}\n\nfunction fireRejectionEvent(name, localHandler, reason, promise) {\n    var localEventFired = false;\n    try {\n        if (typeof localHandler === \"function\") {\n            localEventFired = true;\n            if (name === \"rejectionHandled\") {\n                localHandler(promise);\n            } else {\n                localHandler(reason, promise);\n            }\n        }\n    } catch (e) {\n        async.throwLater(e);\n    }\n\n    if (name === \"unhandledRejection\") {\n        if (!activeFireEvent(name, reason, promise) && !localEventFired) {\n            formatAndLogError(reason, \"Unhandled rejection \");\n        }\n    } else {\n        activeFireEvent(name, promise);\n    }\n}\n\nfunction formatNonError(obj) {\n    var str;\n    if (typeof obj === \"function\") {\n        str = \"[function \" +\n            (obj.name || \"anonymous\") +\n            \"]\";\n    } else {\n        str = obj && typeof obj.toString === \"function\"\n            ? obj.toString() : util.toString(obj);\n        var ruselessToString = /\\[object [a-zA-Z0-9$_]+\\]/;\n        if (ruselessToString.test(str)) {\n            try {\n                var newStr = JSON.stringify(obj);\n                str = newStr;\n            }\n            catch(e) {\n\n            }\n        }\n        if (str.length === 0) {\n            str = \"(empty array)\";\n        }\n    }\n    return (\"(<\" + snip(str) + \">, no stack trace)\");\n}\n\nfunction snip(str) {\n    var maxChars = 41;\n    if (str.length < maxChars) {\n        return str;\n    }\n    return str.substr(0, maxChars - 3) + \"...\";\n}\n\nfunction longStackTracesIsSupported() {\n    return typeof captureStackTrace === \"function\";\n}\n\nvar shouldIgnore = function() { return false; };\nvar parseLineInfoRegex = /[\\/<\\(]([^:\\/]+):(\\d+):(?:\\d+)\\)?\\s*$/;\nfunction parseLineInfo(line) {\n    var matches = line.match(parseLineInfoRegex);\n    if (matches) {\n        return {\n            fileName: matches[1],\n            line: parseInt(matches[2], 10)\n        };\n    }\n}\n\nfunction setBounds(firstLineError, lastLineError) {\n    if (!longStackTracesIsSupported()) return;\n    var firstStackLines = (firstLineError.stack || \"\").split(\"\\n\");\n    var lastStackLines = (lastLineError.stack || \"\").split(\"\\n\");\n    var firstIndex = -1;\n    var lastIndex = -1;\n    var firstFileName;\n    var lastFileName;\n    for (var i = 0; i < firstStackLines.length; ++i) {\n        var result = parseLineInfo(firstStackLines[i]);\n        if (result) {\n            firstFileName = result.fileName;\n            firstIndex = result.line;\n            break;\n        }\n    }\n    for (var i = 0; i < lastStackLines.length; ++i) {\n        var result = parseLineInfo(lastStackLines[i]);\n        if (result) {\n            lastFileName = result.fileName;\n            lastIndex = result.line;\n            break;\n        }\n    }\n    if (firstIndex < 0 || lastIndex < 0 || !firstFileName || !lastFileName ||\n        firstFileName !== lastFileName || firstIndex >= lastIndex) {\n        return;\n    }\n\n    shouldIgnore = function(line) {\n        if (bluebirdFramePattern.test(line)) return true;\n        var info = parseLineInfo(line);\n        if (info) {\n            if (info.fileName === firstFileName &&\n                (firstIndex <= info.line && info.line <= lastIndex)) {\n                return true;\n            }\n        }\n        return false;\n    };\n}\n\nfunction CapturedTrace(parent) {\n    this._parent = parent;\n    this._promisesCreated = 0;\n    var length = this._length = 1 + (parent === undefined ? 0 : parent._length);\n    captureStackTrace(this, CapturedTrace);\n    if (length > 32) this.uncycle();\n}\nutil.inherits(CapturedTrace, Error);\nContext.CapturedTrace = CapturedTrace;\n\nCapturedTrace.prototype.uncycle = function() {\n    var length = this._length;\n    if (length < 2) return;\n    var nodes = [];\n    var stackToIndex = {};\n\n    for (var i = 0, node = this; node !== undefined; ++i) {\n        nodes.push(node);\n        node = node._parent;\n    }\n    length = this._length = i;\n    for (var i = length - 1; i >= 0; --i) {\n        var stack = nodes[i].stack;\n        if (stackToIndex[stack] === undefined) {\n            stackToIndex[stack] = i;\n        }\n    }\n    for (var i = 0; i < length; ++i) {\n        var currentStack = nodes[i].stack;\n        var index = stackToIndex[currentStack];\n        if (index !== undefined && index !== i) {\n            if (index > 0) {\n                nodes[index - 1]._parent = undefined;\n                nodes[index - 1]._length = 1;\n            }\n            nodes[i]._parent = undefined;\n            nodes[i]._length = 1;\n            var cycleEdgeNode = i > 0 ? nodes[i - 1] : this;\n\n            if (index < length - 1) {\n                cycleEdgeNode._parent = nodes[index + 1];\n                cycleEdgeNode._parent.uncycle();\n                cycleEdgeNode._length =\n                    cycleEdgeNode._parent._length + 1;\n            } else {\n                cycleEdgeNode._parent = undefined;\n                cycleEdgeNode._length = 1;\n            }\n            var currentChildLength = cycleEdgeNode._length + 1;\n            for (var j = i - 2; j >= 0; --j) {\n                nodes[j]._length = currentChildLength;\n                currentChildLength++;\n            }\n            return;\n        }\n    }\n};\n\nCapturedTrace.prototype.attachExtraTrace = function(error) {\n    if (error.__stackCleaned__) return;\n    this.uncycle();\n    var parsed = parseStackAndMessage(error);\n    var message = parsed.message;\n    var stacks = [parsed.stack];\n\n    var trace = this;\n    while (trace !== undefined) {\n        stacks.push(cleanStack(trace.stack.split(\"\\n\")));\n        trace = trace._parent;\n    }\n    removeCommonRoots(stacks);\n    removeDuplicateOrEmptyJumps(stacks);\n    util.notEnumerableProp(error, \"stack\", reconstructStack(message, stacks));\n    util.notEnumerableProp(error, \"__stackCleaned__\", true);\n};\n\nvar captureStackTrace = (function stackDetection() {\n    var v8stackFramePattern = /^\\s*at\\s*/;\n    var v8stackFormatter = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if (error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    if (typeof Error.stackTraceLimit === \"number\" &&\n        typeof Error.captureStackTrace === \"function\") {\n        Error.stackTraceLimit += 6;\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        var captureStackTrace = Error.captureStackTrace;\n\n        shouldIgnore = function(line) {\n            return bluebirdFramePattern.test(line);\n        };\n        return function(receiver, ignoreUntil) {\n            Error.stackTraceLimit += 6;\n            captureStackTrace(receiver, ignoreUntil);\n            Error.stackTraceLimit -= 6;\n        };\n    }\n    var err = new Error();\n\n    if (typeof err.stack === \"string\" &&\n        err.stack.split(\"\\n\")[0].indexOf(\"stackDetection@\") >= 0) {\n        stackFramePattern = /@/;\n        formatStack = v8stackFormatter;\n        indentStackFrames = true;\n        return function captureStackTrace(o) {\n            o.stack = new Error().stack;\n        };\n    }\n\n    var hasStackAfterThrow;\n    try { throw new Error(); }\n    catch(e) {\n        hasStackAfterThrow = (\"stack\" in e);\n    }\n    if (!(\"stack\" in err) && hasStackAfterThrow &&\n        typeof Error.stackTraceLimit === \"number\") {\n        stackFramePattern = v8stackFramePattern;\n        formatStack = v8stackFormatter;\n        return function captureStackTrace(o) {\n            Error.stackTraceLimit += 6;\n            try { throw new Error(); }\n            catch(e) { o.stack = e.stack; }\n            Error.stackTraceLimit -= 6;\n        };\n    }\n\n    formatStack = function(stack, error) {\n        if (typeof stack === \"string\") return stack;\n\n        if ((typeof error === \"object\" ||\n            typeof error === \"function\") &&\n            error.name !== undefined &&\n            error.message !== undefined) {\n            return error.toString();\n        }\n        return formatNonError(error);\n    };\n\n    return null;\n\n})([]);\n\nif (typeof console !== \"undefined\" && typeof console.warn !== \"undefined\") {\n    printWarning = function (message) {\n        console.warn(message);\n    };\n    if (util.isNode && process.stderr.isTTY) {\n        printWarning = function(message, isSoft) {\n            var color = isSoft ? \"\\u001b[33m\" : \"\\u001b[31m\";\n            console.warn(color + message + \"\\u001b[0m\\n\");\n        };\n    } else if (!util.isNode && typeof (new Error().stack) === \"string\") {\n        printWarning = function(message, isSoft) {\n            console.warn(\"%c\" + message,\n                        isSoft ? \"color: darkorange\" : \"color: red\");\n        };\n    }\n}\n\nvar config = {\n    warnings: warnings,\n    longStackTraces: false,\n    cancellation: false,\n    monitoring: false,\n    asyncHooks: false\n};\n\nif (longStackTraces) Promise.longStackTraces();\n\nreturn {\n    asyncHooks: function() {\n        return config.asyncHooks;\n    },\n    longStackTraces: function() {\n        return config.longStackTraces;\n    },\n    warnings: function() {\n        return config.warnings;\n    },\n    cancellation: function() {\n        return config.cancellation;\n    },\n    monitoring: function() {\n        return config.monitoring;\n    },\n    propagateFromFunction: function() {\n        return propagateFromFunction;\n    },\n    boundValueFunction: function() {\n        return boundValueFunction;\n    },\n    checkForgottenReturns: checkForgottenReturns,\n    setBounds: setBounds,\n    warn: warn,\n    deprecated: deprecated,\n    CapturedTrace: CapturedTrace,\n    fireDomEvent: fireDomEvent,\n    fireGlobalEvent: fireGlobalEvent\n};\n};\n\n},{\"./errors\":12,\"./es5\":13,\"./util\":36}],10:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction returner() {\n    return this.value;\n}\nfunction thrower() {\n    throw this.reason;\n}\n\nPromise.prototype[\"return\"] =\nPromise.prototype.thenReturn = function (value) {\n    if (value instanceof Promise) value.suppressUnhandledRejections();\n    return this._then(\n        returner, undefined, undefined, {value: value}, undefined);\n};\n\nPromise.prototype[\"throw\"] =\nPromise.prototype.thenThrow = function (reason) {\n    return this._then(\n        thrower, undefined, undefined, {reason: reason}, undefined);\n};\n\nPromise.prototype.catchThrow = function (reason) {\n    if (arguments.length <= 1) {\n        return this._then(\n            undefined, thrower, undefined, {reason: reason}, undefined);\n    } else {\n        var _reason = arguments[1];\n        var handler = function() {throw _reason;};\n        return this.caught(reason, handler);\n    }\n};\n\nPromise.prototype.catchReturn = function (value) {\n    if (arguments.length <= 1) {\n        if (value instanceof Promise) value.suppressUnhandledRejections();\n        return this._then(\n            undefined, returner, undefined, {value: value}, undefined);\n    } else {\n        var _value = arguments[1];\n        if (_value instanceof Promise) _value.suppressUnhandledRejections();\n        var handler = function() {return _value;};\n        return this.caught(value, handler);\n    }\n};\n};\n\n},{}],11:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseReduce = Promise.reduce;\nvar PromiseAll = Promise.all;\n\nfunction promiseAllThis() {\n    return PromiseAll(this);\n}\n\nfunction PromiseMapSeries(promises, fn) {\n    return PromiseReduce(promises, fn, INTERNAL, INTERNAL);\n}\n\nPromise.prototype.each = function (fn) {\n    return PromiseReduce(this, fn, INTERNAL, 0)\n              ._then(promiseAllThis, undefined, undefined, this, undefined);\n};\n\nPromise.prototype.mapSeries = function (fn) {\n    return PromiseReduce(this, fn, INTERNAL, INTERNAL);\n};\n\nPromise.each = function (promises, fn) {\n    return PromiseReduce(promises, fn, INTERNAL, 0)\n              ._then(promiseAllThis, undefined, undefined, promises, undefined);\n};\n\nPromise.mapSeries = PromiseMapSeries;\n};\n\n\n},{}],12:[function(_dereq_,module,exports){\n\"use strict\";\nvar es5 = _dereq_(\"./es5\");\nvar Objectfreeze = es5.freeze;\nvar util = _dereq_(\"./util\");\nvar inherits = util.inherits;\nvar notEnumerableProp = util.notEnumerableProp;\n\nfunction subError(nameProperty, defaultMessage) {\n    function SubError(message) {\n        if (!(this instanceof SubError)) return new SubError(message);\n        notEnumerableProp(this, \"message\",\n            typeof message === \"string\" ? message : defaultMessage);\n        notEnumerableProp(this, \"name\", nameProperty);\n        if (Error.captureStackTrace) {\n            Error.captureStackTrace(this, this.constructor);\n        } else {\n            Error.call(this);\n        }\n    }\n    inherits(SubError, Error);\n    return SubError;\n}\n\nvar _TypeError, _RangeError;\nvar Warning = subError(\"Warning\", \"warning\");\nvar CancellationError = subError(\"CancellationError\", \"cancellation error\");\nvar TimeoutError = subError(\"TimeoutError\", \"timeout error\");\nvar AggregateError = subError(\"AggregateError\", \"aggregate error\");\ntry {\n    _TypeError = TypeError;\n    _RangeError = RangeError;\n} catch(e) {\n    _TypeError = subError(\"TypeError\", \"type error\");\n    _RangeError = subError(\"RangeError\", \"range error\");\n}\n\nvar methods = (\"join pop push shift unshift slice filter forEach some \" +\n    \"every map indexOf lastIndexOf reduce reduceRight sort reverse\").split(\" \");\n\nfor (var i = 0; i < methods.length; ++i) {\n    if (typeof Array.prototype[methods[i]] === \"function\") {\n        AggregateError.prototype[methods[i]] = Array.prototype[methods[i]];\n    }\n}\n\nes5.defineProperty(AggregateError.prototype, \"length\", {\n    value: 0,\n    configurable: false,\n    writable: true,\n    enumerable: true\n});\nAggregateError.prototype[\"isOperational\"] = true;\nvar level = 0;\nAggregateError.prototype.toString = function() {\n    var indent = Array(level * 4 + 1).join(\" \");\n    var ret = \"\\n\" + indent + \"AggregateError of:\" + \"\\n\";\n    level++;\n    indent = Array(level * 4 + 1).join(\" \");\n    for (var i = 0; i < this.length; ++i) {\n        var str = this[i] === this ? \"[Circular AggregateError]\" : this[i] + \"\";\n        var lines = str.split(\"\\n\");\n        for (var j = 0; j < lines.length; ++j) {\n            lines[j] = indent + lines[j];\n        }\n        str = lines.join(\"\\n\");\n        ret += str + \"\\n\";\n    }\n    level--;\n    return ret;\n};\n\nfunction OperationalError(message) {\n    if (!(this instanceof OperationalError))\n        return new OperationalError(message);\n    notEnumerableProp(this, \"name\", \"OperationalError\");\n    notEnumerableProp(this, \"message\", message);\n    this.cause = message;\n    this[\"isOperational\"] = true;\n\n    if (message instanceof Error) {\n        notEnumerableProp(this, \"message\", message.message);\n        notEnumerableProp(this, \"stack\", message.stack);\n    } else if (Error.captureStackTrace) {\n        Error.captureStackTrace(this, this.constructor);\n    }\n\n}\ninherits(OperationalError, Error);\n\nvar errorTypes = Error[\"__BluebirdErrorTypes__\"];\nif (!errorTypes) {\n    errorTypes = Objectfreeze({\n        CancellationError: CancellationError,\n        TimeoutError: TimeoutError,\n        OperationalError: OperationalError,\n        RejectionError: OperationalError,\n        AggregateError: AggregateError\n    });\n    es5.defineProperty(Error, \"__BluebirdErrorTypes__\", {\n        value: errorTypes,\n        writable: false,\n        enumerable: false,\n        configurable: false\n    });\n}\n\nmodule.exports = {\n    Error: Error,\n    TypeError: _TypeError,\n    RangeError: _RangeError,\n    CancellationError: errorTypes.CancellationError,\n    OperationalError: errorTypes.OperationalError,\n    TimeoutError: errorTypes.TimeoutError,\n    AggregateError: errorTypes.AggregateError,\n    Warning: Warning\n};\n\n},{\"./es5\":13,\"./util\":36}],13:[function(_dereq_,module,exports){\nvar isES5 = (function(){\n    \"use strict\";\n    return this === undefined;\n})();\n\nif (isES5) {\n    module.exports = {\n        freeze: Object.freeze,\n        defineProperty: Object.defineProperty,\n        getDescriptor: Object.getOwnPropertyDescriptor,\n        keys: Object.keys,\n        names: Object.getOwnPropertyNames,\n        getPrototypeOf: Object.getPrototypeOf,\n        isArray: Array.isArray,\n        isES5: isES5,\n        propertyIsWritable: function(obj, prop) {\n            var descriptor = Object.getOwnPropertyDescriptor(obj, prop);\n            return !!(!descriptor || descriptor.writable || descriptor.set);\n        }\n    };\n} else {\n    var has = {}.hasOwnProperty;\n    var str = {}.toString;\n    var proto = {}.constructor.prototype;\n\n    var ObjectKeys = function (o) {\n        var ret = [];\n        for (var key in o) {\n            if (has.call(o, key)) {\n                ret.push(key);\n            }\n        }\n        return ret;\n    };\n\n    var ObjectGetDescriptor = function(o, key) {\n        return {value: o[key]};\n    };\n\n    var ObjectDefineProperty = function (o, key, desc) {\n        o[key] = desc.value;\n        return o;\n    };\n\n    var ObjectFreeze = function (obj) {\n        return obj;\n    };\n\n    var ObjectGetPrototypeOf = function (obj) {\n        try {\n            return Object(obj).constructor.prototype;\n        }\n        catch (e) {\n            return proto;\n        }\n    };\n\n    var ArrayIsArray = function (obj) {\n        try {\n            return str.call(obj) === \"[object Array]\";\n        }\n        catch(e) {\n            return false;\n        }\n    };\n\n    module.exports = {\n        isArray: ArrayIsArray,\n        keys: ObjectKeys,\n        names: ObjectKeys,\n        defineProperty: ObjectDefineProperty,\n        getDescriptor: ObjectGetDescriptor,\n        freeze: ObjectFreeze,\n        getPrototypeOf: ObjectGetPrototypeOf,\n        isES5: isES5,\n        propertyIsWritable: function() {\n            return true;\n        }\n    };\n}\n\n},{}],14:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar PromiseMap = Promise.map;\n\nPromise.prototype.filter = function (fn, options) {\n    return PromiseMap(this, fn, options, INTERNAL);\n};\n\nPromise.filter = function (promises, fn, options) {\n    return PromiseMap(promises, fn, options, INTERNAL);\n};\n};\n\n},{}],15:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, tryConvertToPromise, NEXT_FILTER) {\nvar util = _dereq_(\"./util\");\nvar CancellationError = Promise.CancellationError;\nvar errorObj = util.errorObj;\nvar catchFilter = _dereq_(\"./catch_filter\")(NEXT_FILTER);\n\nfunction PassThroughHandlerContext(promise, type, handler) {\n    this.promise = promise;\n    this.type = type;\n    this.handler = handler;\n    this.called = false;\n    this.cancelPromise = null;\n}\n\nPassThroughHandlerContext.prototype.isFinallyHandler = function() {\n    return this.type === 0;\n};\n\nfunction FinallyHandlerCancelReaction(finallyHandler) {\n    this.finallyHandler = finallyHandler;\n}\n\nFinallyHandlerCancelReaction.prototype._resultCancelled = function() {\n    checkCancel(this.finallyHandler);\n};\n\nfunction checkCancel(ctx, reason) {\n    if (ctx.cancelPromise != null) {\n        if (arguments.length > 1) {\n            ctx.cancelPromise._reject(reason);\n        } else {\n            ctx.cancelPromise._cancel();\n        }\n        ctx.cancelPromise = null;\n        return true;\n    }\n    return false;\n}\n\nfunction succeed() {\n    return finallyHandler.call(this, this.promise._target()._settledValue());\n}\nfunction fail(reason) {\n    if (checkCancel(this, reason)) return;\n    errorObj.e = reason;\n    return errorObj;\n}\nfunction finallyHandler(reasonOrValue) {\n    var promise = this.promise;\n    var handler = this.handler;\n\n    if (!this.called) {\n        this.called = true;\n        var ret = this.isFinallyHandler()\n            ? handler.call(promise._boundValue())\n            : handler.call(promise._boundValue(), reasonOrValue);\n        if (ret === NEXT_FILTER) {\n            return ret;\n        } else if (ret !== undefined) {\n            promise._setReturnedNonUndefined();\n            var maybePromise = tryConvertToPromise(ret, promise);\n            if (maybePromise instanceof Promise) {\n                if (this.cancelPromise != null) {\n                    if (maybePromise._isCancelled()) {\n                        var reason =\n                            new CancellationError(\"late cancellation observer\");\n                        promise._attachExtraTrace(reason);\n                        errorObj.e = reason;\n                        return errorObj;\n                    } else if (maybePromise.isPending()) {\n                        maybePromise._attachCancellationCallback(\n                            new FinallyHandlerCancelReaction(this));\n                    }\n                }\n                return maybePromise._then(\n                    succeed, fail, undefined, this, undefined);\n            }\n        }\n    }\n\n    if (promise.isRejected()) {\n        checkCancel(this);\n        errorObj.e = reasonOrValue;\n        return errorObj;\n    } else {\n        checkCancel(this);\n        return reasonOrValue;\n    }\n}\n\nPromise.prototype._passThrough = function(handler, type, success, fail) {\n    if (typeof handler !== \"function\") return this.then();\n    return this._then(success,\n                      fail,\n                      undefined,\n                      new PassThroughHandlerContext(this, type, handler),\n                      undefined);\n};\n\nPromise.prototype.lastly =\nPromise.prototype[\"finally\"] = function (handler) {\n    return this._passThrough(handler,\n                             0,\n                             finallyHandler,\n                             finallyHandler);\n};\n\n\nPromise.prototype.tap = function (handler) {\n    return this._passThrough(handler, 1, finallyHandler);\n};\n\nPromise.prototype.tapCatch = function (handlerOrPredicate) {\n    var len = arguments.length;\n    if(len === 1) {\n        return this._passThrough(handlerOrPredicate,\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    } else {\n         var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (util.isObject(item)) {\n                catchInstances[j++] = item;\n            } else {\n                return Promise.reject(new TypeError(\n                    \"tapCatch statement predicate: \"\n                    + \"expecting an object but got \" + util.classString(item)\n                ));\n            }\n        }\n        catchInstances.length = j;\n        var handler = arguments[i];\n        return this._passThrough(catchFilter(catchInstances, handler, this),\n                                 1,\n                                 undefined,\n                                 finallyHandler);\n    }\n\n};\n\nreturn PassThroughHandlerContext;\n};\n\n},{\"./catch_filter\":7,\"./util\":36}],16:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          apiRejection,\n                          INTERNAL,\n                          tryConvertToPromise,\n                          Proxyable,\n                          debug) {\nvar errors = _dereq_(\"./errors\");\nvar TypeError = errors.TypeError;\nvar util = _dereq_(\"./util\");\nvar errorObj = util.errorObj;\nvar tryCatch = util.tryCatch;\nvar yieldHandlers = [];\n\nfunction promiseFromYieldHandler(value, yieldHandlers, traceParent) {\n    for (var i = 0; i < yieldHandlers.length; ++i) {\n        traceParent._pushContext();\n        var result = tryCatch(yieldHandlers[i])(value);\n        traceParent._popContext();\n        if (result === errorObj) {\n            traceParent._pushContext();\n            var ret = Promise.reject(errorObj.e);\n            traceParent._popContext();\n            return ret;\n        }\n        var maybePromise = tryConvertToPromise(result, traceParent);\n        if (maybePromise instanceof Promise) return maybePromise;\n    }\n    return null;\n}\n\nfunction PromiseSpawn(generatorFunction, receiver, yieldHandler, stack) {\n    if (debug.cancellation()) {\n        var internal = new Promise(INTERNAL);\n        var _finallyPromise = this._finallyPromise = new Promise(INTERNAL);\n        this._promise = internal.lastly(function() {\n            return _finallyPromise;\n        });\n        internal._captureStackTrace();\n        internal._setOnCancel(this);\n    } else {\n        var promise = this._promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n    }\n    this._stack = stack;\n    this._generatorFunction = generatorFunction;\n    this._receiver = receiver;\n    this._generator = undefined;\n    this._yieldHandlers = typeof yieldHandler === \"function\"\n        ? [yieldHandler].concat(yieldHandlers)\n        : yieldHandlers;\n    this._yieldedPromise = null;\n    this._cancellationPhase = false;\n}\nutil.inherits(PromiseSpawn, Proxyable);\n\nPromiseSpawn.prototype._isResolved = function() {\n    return this._promise === null;\n};\n\nPromiseSpawn.prototype._cleanup = function() {\n    this._promise = this._generator = null;\n    if (debug.cancellation() && this._finallyPromise !== null) {\n        this._finallyPromise._fulfill();\n        this._finallyPromise = null;\n    }\n};\n\nPromiseSpawn.prototype._promiseCancelled = function() {\n    if (this._isResolved()) return;\n    var implementsReturn = typeof this._generator[\"return\"] !== \"undefined\";\n\n    var result;\n    if (!implementsReturn) {\n        var reason = new Promise.CancellationError(\n            \"generator .return() sentinel\");\n        Promise.coroutine.returnSentinel = reason;\n        this._promise._attachExtraTrace(reason);\n        this._promise._pushContext();\n        result = tryCatch(this._generator[\"throw\"]).call(this._generator,\n                                                         reason);\n        this._promise._popContext();\n    } else {\n        this._promise._pushContext();\n        result = tryCatch(this._generator[\"return\"]).call(this._generator,\n                                                          undefined);\n        this._promise._popContext();\n    }\n    this._cancellationPhase = true;\n    this._yieldedPromise = null;\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._promiseFulfilled = function(value) {\n    this._yieldedPromise = null;\n    this._promise._pushContext();\n    var result = tryCatch(this._generator.next).call(this._generator, value);\n    this._promise._popContext();\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._promiseRejected = function(reason) {\n    this._yieldedPromise = null;\n    this._promise._attachExtraTrace(reason);\n    this._promise._pushContext();\n    var result = tryCatch(this._generator[\"throw\"])\n        .call(this._generator, reason);\n    this._promise._popContext();\n    this._continue(result);\n};\n\nPromiseSpawn.prototype._resultCancelled = function() {\n    if (this._yieldedPromise instanceof Promise) {\n        var promise = this._yieldedPromise;\n        this._yieldedPromise = null;\n        promise.cancel();\n    }\n};\n\nPromiseSpawn.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseSpawn.prototype._run = function () {\n    this._generator = this._generatorFunction.call(this._receiver);\n    this._receiver =\n        this._generatorFunction = undefined;\n    this._promiseFulfilled(undefined);\n};\n\nPromiseSpawn.prototype._continue = function (result) {\n    var promise = this._promise;\n    if (result === errorObj) {\n        this._cleanup();\n        if (this._cancellationPhase) {\n            return promise.cancel();\n        } else {\n            return promise._rejectCallback(result.e, false);\n        }\n    }\n\n    var value = result.value;\n    if (result.done === true) {\n        this._cleanup();\n        if (this._cancellationPhase) {\n            return promise.cancel();\n        } else {\n            return promise._resolveCallback(value);\n        }\n    } else {\n        var maybePromise = tryConvertToPromise(value, this._promise);\n        if (!(maybePromise instanceof Promise)) {\n            maybePromise =\n                promiseFromYieldHandler(maybePromise,\n                                        this._yieldHandlers,\n                                        this._promise);\n            if (maybePromise === null) {\n                this._promiseRejected(\n                    new TypeError(\n                        \"A value %s was yielded that could not be treated as a promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\\u000a\".replace(\"%s\", String(value)) +\n                        \"From coroutine:\\u000a\" +\n                        this._stack.split(\"\\n\").slice(1, -7).join(\"\\n\")\n                    )\n                );\n                return;\n            }\n        }\n        maybePromise = maybePromise._target();\n        var bitField = maybePromise._bitField;\n        ;\n        if (((bitField & 50397184) === 0)) {\n            this._yieldedPromise = maybePromise;\n            maybePromise._proxy(this, null);\n        } else if (((bitField & 33554432) !== 0)) {\n            Promise._async.invoke(\n                this._promiseFulfilled, this, maybePromise._value()\n            );\n        } else if (((bitField & 16777216) !== 0)) {\n            Promise._async.invoke(\n                this._promiseRejected, this, maybePromise._reason()\n            );\n        } else {\n            this._promiseCancelled();\n        }\n    }\n};\n\nPromise.coroutine = function (generatorFunction, options) {\n    if (typeof generatorFunction !== \"function\") {\n        throw new TypeError(\"generatorFunction must be a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var yieldHandler = Object(options).yieldHandler;\n    var PromiseSpawn$ = PromiseSpawn;\n    var stack = new Error().stack;\n    return function () {\n        var generator = generatorFunction.apply(this, arguments);\n        var spawn = new PromiseSpawn$(undefined, undefined, yieldHandler,\n                                      stack);\n        var ret = spawn.promise();\n        spawn._generator = generator;\n        spawn._promiseFulfilled(undefined);\n        return ret;\n    };\n};\n\nPromise.coroutine.addYieldHandler = function(fn) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    yieldHandlers.push(fn);\n};\n\nPromise.spawn = function (generatorFunction) {\n    debug.deprecated(\"Promise.spawn()\", \"Promise.coroutine()\");\n    if (typeof generatorFunction !== \"function\") {\n        return apiRejection(\"generatorFunction must be a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var spawn = new PromiseSpawn(generatorFunction, this);\n    var ret = spawn.promise();\n    spawn._run(Promise.spawn);\n    return ret;\n};\n};\n\n},{\"./errors\":12,\"./util\":36}],17:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, tryConvertToPromise, INTERNAL, async) {\nvar util = _dereq_(\"./util\");\nvar canEvaluate = util.canEvaluate;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar reject;\n\nif (!true) {\nif (canEvaluate) {\n    var thenCallback = function(i) {\n        return new Function(\"value\", \"holder\", \"                             \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = value;                                           \\n\\\n            holder.checkFulfillment(this);                                   \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var promiseSetter = function(i) {\n        return new Function(\"promise\", \"holder\", \"                           \\n\\\n            'use strict';                                                    \\n\\\n            holder.pIndex = promise;                                         \\n\\\n            \".replace(/Index/g, i));\n    };\n\n    var generateHolderClass = function(total) {\n        var props = new Array(total);\n        for (var i = 0; i < props.length; ++i) {\n            props[i] = \"this.p\" + (i+1);\n        }\n        var assignment = props.join(\" = \") + \" = null;\";\n        var cancellationCode= \"var promise;\\n\" + props.map(function(prop) {\n            return \"                                                         \\n\\\n                promise = \" + prop + \";                                      \\n\\\n                if (promise instanceof Promise) {                            \\n\\\n                    promise.cancel();                                        \\n\\\n                }                                                            \\n\\\n            \";\n        }).join(\"\\n\");\n        var passedArguments = props.join(\", \");\n        var name = \"Holder$\" + total;\n\n\n        var code = \"return function(tryCatch, errorObj, Promise, async) {    \\n\\\n            'use strict';                                                    \\n\\\n            function [TheName](fn) {                                         \\n\\\n                [TheProperties]                                              \\n\\\n                this.fn = fn;                                                \\n\\\n                this.asyncNeeded = true;                                     \\n\\\n                this.now = 0;                                                \\n\\\n            }                                                                \\n\\\n                                                                             \\n\\\n            [TheName].prototype._callFunction = function(promise) {          \\n\\\n                promise._pushContext();                                      \\n\\\n                var ret = tryCatch(this.fn)([ThePassedArguments]);           \\n\\\n                promise._popContext();                                       \\n\\\n                if (ret === errorObj) {                                      \\n\\\n                    promise._rejectCallback(ret.e, false);                   \\n\\\n                } else {                                                     \\n\\\n                    promise._resolveCallback(ret);                           \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype.checkFulfillment = function(promise) {       \\n\\\n                var now = ++this.now;                                        \\n\\\n                if (now === [TheTotal]) {                                    \\n\\\n                    if (this.asyncNeeded) {                                  \\n\\\n                        async.invoke(this._callFunction, this, promise);     \\n\\\n                    } else {                                                 \\n\\\n                        this._callFunction(promise);                         \\n\\\n                    }                                                        \\n\\\n                                                                             \\n\\\n                }                                                            \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            [TheName].prototype._resultCancelled = function() {              \\n\\\n                [CancellationCode]                                           \\n\\\n            };                                                               \\n\\\n                                                                             \\n\\\n            return [TheName];                                                \\n\\\n        }(tryCatch, errorObj, Promise, async);                               \\n\\\n        \";\n\n        code = code.replace(/\\[TheName\\]/g, name)\n            .replace(/\\[TheTotal\\]/g, total)\n            .replace(/\\[ThePassedArguments\\]/g, passedArguments)\n            .replace(/\\[TheProperties\\]/g, assignment)\n            .replace(/\\[CancellationCode\\]/g, cancellationCode);\n\n        return new Function(\"tryCatch\", \"errorObj\", \"Promise\", \"async\", code)\n                           (tryCatch, errorObj, Promise, async);\n    };\n\n    var holderClasses = [];\n    var thenCallbacks = [];\n    var promiseSetters = [];\n\n    for (var i = 0; i < 8; ++i) {\n        holderClasses.push(generateHolderClass(i + 1));\n        thenCallbacks.push(thenCallback(i + 1));\n        promiseSetters.push(promiseSetter(i + 1));\n    }\n\n    reject = function (reason) {\n        this._reject(reason);\n    };\n}}\n\nPromise.join = function () {\n    var last = arguments.length - 1;\n    var fn;\n    if (last > 0 && typeof arguments[last] === \"function\") {\n        fn = arguments[last];\n        if (!true) {\n            if (last <= 8 && canEvaluate) {\n                var ret = new Promise(INTERNAL);\n                ret._captureStackTrace();\n                var HolderClass = holderClasses[last - 1];\n                var holder = new HolderClass(fn);\n                var callbacks = thenCallbacks;\n\n                for (var i = 0; i < last; ++i) {\n                    var maybePromise = tryConvertToPromise(arguments[i], ret);\n                    if (maybePromise instanceof Promise) {\n                        maybePromise = maybePromise._target();\n                        var bitField = maybePromise._bitField;\n                        ;\n                        if (((bitField & 50397184) === 0)) {\n                            maybePromise._then(callbacks[i], reject,\n                                               undefined, ret, holder);\n                            promiseSetters[i](maybePromise, holder);\n                            holder.asyncNeeded = false;\n                        } else if (((bitField & 33554432) !== 0)) {\n                            callbacks[i].call(ret,\n                                              maybePromise._value(), holder);\n                        } else if (((bitField & 16777216) !== 0)) {\n                            ret._reject(maybePromise._reason());\n                        } else {\n                            ret._cancel();\n                        }\n                    } else {\n                        callbacks[i].call(ret, maybePromise, holder);\n                    }\n                }\n\n                if (!ret._isFateSealed()) {\n                    if (holder.asyncNeeded) {\n                        var context = Promise._getContext();\n                        holder.fn = util.contextBind(context, holder.fn);\n                    }\n                    ret._setAsyncGuaranteed();\n                    ret._setOnCancel(holder);\n                }\n                return ret;\n            }\n        }\n    }\n    var args = [].slice.call(arguments);;\n    if (fn) args.pop();\n    var ret = new PromiseArray(args).promise();\n    return fn !== undefined ? ret.spread(fn) : ret;\n};\n\n};\n\n},{\"./util\":36}],18:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\nvar async = Promise._async;\n\nfunction MappingPromiseArray(promises, fn, limit, _filter) {\n    this.constructor$(promises);\n    this._promise._captureStackTrace();\n    var context = Promise._getContext();\n    this._callback = util.contextBind(context, fn);\n    this._preservedValues = _filter === INTERNAL\n        ? new Array(this.length())\n        : null;\n    this._limit = limit;\n    this._inFlight = 0;\n    this._queue = [];\n    async.invoke(this._asyncInit, this, undefined);\n    if (util.isArray(promises)) {\n        for (var i = 0; i < promises.length; ++i) {\n            var maybePromise = promises[i];\n            if (maybePromise instanceof Promise) {\n                maybePromise.suppressUnhandledRejections();\n            }\n        }\n    }\n}\nutil.inherits(MappingPromiseArray, PromiseArray);\n\nMappingPromiseArray.prototype._asyncInit = function() {\n    this._init$(undefined, -2);\n};\n\nMappingPromiseArray.prototype._init = function () {};\n\nMappingPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var values = this._values;\n    var length = this.length();\n    var preservedValues = this._preservedValues;\n    var limit = this._limit;\n\n    if (index < 0) {\n        index = (index * -1) - 1;\n        values[index] = value;\n        if (limit >= 1) {\n            this._inFlight--;\n            this._drainQueue();\n            if (this._isResolved()) return true;\n        }\n    } else {\n        if (limit >= 1 && this._inFlight >= limit) {\n            values[index] = value;\n            this._queue.push(index);\n            return false;\n        }\n        if (preservedValues !== null) preservedValues[index] = value;\n\n        var promise = this._promise;\n        var callback = this._callback;\n        var receiver = promise._boundValue();\n        promise._pushContext();\n        var ret = tryCatch(callback).call(receiver, value, index, length);\n        var promiseCreated = promise._popContext();\n        debug.checkForgottenReturns(\n            ret,\n            promiseCreated,\n            preservedValues !== null ? \"Promise.filter\" : \"Promise.map\",\n            promise\n        );\n        if (ret === errorObj) {\n            this._reject(ret.e);\n            return true;\n        }\n\n        var maybePromise = tryConvertToPromise(ret, this._promise);\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            var bitField = maybePromise._bitField;\n            ;\n            if (((bitField & 50397184) === 0)) {\n                if (limit >= 1) this._inFlight++;\n                values[index] = maybePromise;\n                maybePromise._proxy(this, (index + 1) * -1);\n                return false;\n            } else if (((bitField & 33554432) !== 0)) {\n                ret = maybePromise._value();\n            } else if (((bitField & 16777216) !== 0)) {\n                this._reject(maybePromise._reason());\n                return true;\n            } else {\n                this._cancel();\n                return true;\n            }\n        }\n        values[index] = ret;\n    }\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= length) {\n        if (preservedValues !== null) {\n            this._filter(values, preservedValues);\n        } else {\n            this._resolve(values);\n        }\n        return true;\n    }\n    return false;\n};\n\nMappingPromiseArray.prototype._drainQueue = function () {\n    var queue = this._queue;\n    var limit = this._limit;\n    var values = this._values;\n    while (queue.length > 0 && this._inFlight < limit) {\n        if (this._isResolved()) return;\n        var index = queue.pop();\n        this._promiseFulfilled(values[index], index);\n    }\n};\n\nMappingPromiseArray.prototype._filter = function (booleans, values) {\n    var len = values.length;\n    var ret = new Array(len);\n    var j = 0;\n    for (var i = 0; i < len; ++i) {\n        if (booleans[i]) ret[j++] = values[i];\n    }\n    ret.length = j;\n    this._resolve(ret);\n};\n\nMappingPromiseArray.prototype.preservedValues = function () {\n    return this._preservedValues;\n};\n\nfunction map(promises, fn, options, _filter) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n\n    var limit = 0;\n    if (options !== undefined) {\n        if (typeof options === \"object\" && options !== null) {\n            if (typeof options.concurrency !== \"number\") {\n                return Promise.reject(\n                    new TypeError(\"'concurrency' must be a number but it is \" +\n                                    util.classString(options.concurrency)));\n            }\n            limit = options.concurrency;\n        } else {\n            return Promise.reject(new TypeError(\n                            \"options argument must be an object but it is \" +\n                             util.classString(options)));\n        }\n    }\n    limit = typeof limit === \"number\" &&\n        isFinite(limit) && limit >= 1 ? limit : 0;\n    return new MappingPromiseArray(promises, fn, limit, _filter).promise();\n}\n\nPromise.prototype.map = function (fn, options) {\n    return map(this, fn, options, null);\n};\n\nPromise.map = function (promises, fn, options, _filter) {\n    return map(promises, fn, options, _filter);\n};\n\n\n};\n\n},{\"./util\":36}],19:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, INTERNAL, tryConvertToPromise, apiRejection, debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\n\nPromise.method = function (fn) {\n    if (typeof fn !== \"function\") {\n        throw new Promise.TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    return function () {\n        var ret = new Promise(INTERNAL);\n        ret._captureStackTrace();\n        ret._pushContext();\n        var value = tryCatch(fn).apply(this, arguments);\n        var promiseCreated = ret._popContext();\n        debug.checkForgottenReturns(\n            value, promiseCreated, \"Promise.method\", ret);\n        ret._resolveFromSyncValue(value);\n        return ret;\n    };\n};\n\nPromise.attempt = Promise[\"try\"] = function (fn) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._pushContext();\n    var value;\n    if (arguments.length > 1) {\n        debug.deprecated(\"calling Promise.try with more than 1 argument\");\n        var arg = arguments[1];\n        var ctx = arguments[2];\n        value = util.isArray(arg) ? tryCatch(fn).apply(ctx, arg)\n                                  : tryCatch(fn).call(ctx, arg);\n    } else {\n        value = tryCatch(fn)();\n    }\n    var promiseCreated = ret._popContext();\n    debug.checkForgottenReturns(\n        value, promiseCreated, \"Promise.try\", ret);\n    ret._resolveFromSyncValue(value);\n    return ret;\n};\n\nPromise.prototype._resolveFromSyncValue = function (value) {\n    if (value === util.errorObj) {\n        this._rejectCallback(value.e, false);\n    } else {\n        this._resolveCallback(value, true);\n    }\n};\n};\n\n},{\"./util\":36}],20:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util\");\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar errors = _dereq_(\"./errors\");\nvar OperationalError = errors.OperationalError;\nvar es5 = _dereq_(\"./es5\");\n\nfunction isUntypedError(obj) {\n    return obj instanceof Error &&\n        es5.getPrototypeOf(obj) === Error.prototype;\n}\n\nvar rErrorKey = /^(?:name|message|stack|cause)$/;\nfunction wrapAsOperationalError(obj) {\n    var ret;\n    if (isUntypedError(obj)) {\n        ret = new OperationalError(obj);\n        ret.name = obj.name;\n        ret.message = obj.message;\n        ret.stack = obj.stack;\n        var keys = es5.keys(obj);\n        for (var i = 0; i < keys.length; ++i) {\n            var key = keys[i];\n            if (!rErrorKey.test(key)) {\n                ret[key] = obj[key];\n            }\n        }\n        return ret;\n    }\n    util.markAsOriginatingFromRejection(obj);\n    return obj;\n}\n\nfunction nodebackForPromise(promise, multiArgs) {\n    return function(err, value) {\n        if (promise === null) return;\n        if (err) {\n            var wrapped = wrapAsOperationalError(maybeWrapAsError(err));\n            promise._attachExtraTrace(wrapped);\n            promise._reject(wrapped);\n        } else if (!multiArgs) {\n            promise._fulfill(value);\n        } else {\n            var args = [].slice.call(arguments, 1);;\n            promise._fulfill(args);\n        }\n        promise = null;\n    };\n}\n\nmodule.exports = nodebackForPromise;\n\n},{\"./errors\":12,\"./es5\":13,\"./util\":36}],21:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nvar util = _dereq_(\"./util\");\nvar async = Promise._async;\nvar tryCatch = util.tryCatch;\nvar errorObj = util.errorObj;\n\nfunction spreadAdapter(val, nodeback) {\n    var promise = this;\n    if (!util.isArray(val)) return successAdapter.call(promise, val, nodeback);\n    var ret =\n        tryCatch(nodeback).apply(promise._boundValue(), [null].concat(val));\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nfunction successAdapter(val, nodeback) {\n    var promise = this;\n    var receiver = promise._boundValue();\n    var ret = val === undefined\n        ? tryCatch(nodeback).call(receiver, null)\n        : tryCatch(nodeback).call(receiver, null, val);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\nfunction errorAdapter(reason, nodeback) {\n    var promise = this;\n    if (!reason) {\n        var newReason = new Error(reason + \"\");\n        newReason.cause = reason;\n        reason = newReason;\n    }\n    var ret = tryCatch(nodeback).call(promise._boundValue(), reason);\n    if (ret === errorObj) {\n        async.throwLater(ret.e);\n    }\n}\n\nPromise.prototype.asCallback = Promise.prototype.nodeify = function (nodeback,\n                                                                     options) {\n    if (typeof nodeback == \"function\") {\n        var adapter = successAdapter;\n        if (options !== undefined && Object(options).spread) {\n            adapter = spreadAdapter;\n        }\n        this._then(\n            adapter,\n            errorAdapter,\n            undefined,\n            this,\n            nodeback\n        );\n    }\n    return this;\n};\n};\n\n},{\"./util\":36}],22:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function() {\nvar makeSelfResolutionError = function () {\n    return new TypeError(\"circular promise resolution chain\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n};\nvar reflectHandler = function() {\n    return new Promise.PromiseInspection(this._target());\n};\nvar apiRejection = function(msg) {\n    return Promise.reject(new TypeError(msg));\n};\nfunction Proxyable() {}\nvar UNDEFINED_BINDING = {};\nvar util = _dereq_(\"./util\");\nutil.setReflectHandler(reflectHandler);\n\nvar getDomain = function() {\n    var domain = process.domain;\n    if (domain === undefined) {\n        return null;\n    }\n    return domain;\n};\nvar getContextDefault = function() {\n    return null;\n};\nvar getContextDomain = function() {\n    return {\n        domain: getDomain(),\n        async: null\n    };\n};\nvar AsyncResource = util.isNode && util.nodeSupportsAsyncResource ?\n    _dereq_(\"async_hooks\").AsyncResource : null;\nvar getContextAsyncHooks = function() {\n    return {\n        domain: getDomain(),\n        async: new AsyncResource(\"Bluebird::Promise\")\n    };\n};\nvar getContext = util.isNode ? getContextDomain : getContextDefault;\nutil.notEnumerableProp(Promise, \"_getContext\", getContext);\nvar enableAsyncHooks = function() {\n    getContext = getContextAsyncHooks;\n    util.notEnumerableProp(Promise, \"_getContext\", getContextAsyncHooks);\n};\nvar disableAsyncHooks = function() {\n    getContext = getContextDomain;\n    util.notEnumerableProp(Promise, \"_getContext\", getContextDomain);\n};\n\nvar es5 = _dereq_(\"./es5\");\nvar Async = _dereq_(\"./async\");\nvar async = new Async();\nes5.defineProperty(Promise, \"_async\", {value: async});\nvar errors = _dereq_(\"./errors\");\nvar TypeError = Promise.TypeError = errors.TypeError;\nPromise.RangeError = errors.RangeError;\nvar CancellationError = Promise.CancellationError = errors.CancellationError;\nPromise.TimeoutError = errors.TimeoutError;\nPromise.OperationalError = errors.OperationalError;\nPromise.RejectionError = errors.OperationalError;\nPromise.AggregateError = errors.AggregateError;\nvar INTERNAL = function(){};\nvar APPLY = {};\nvar NEXT_FILTER = {};\nvar tryConvertToPromise = _dereq_(\"./thenables\")(Promise, INTERNAL);\nvar PromiseArray =\n    _dereq_(\"./promise_array\")(Promise, INTERNAL,\n                               tryConvertToPromise, apiRejection, Proxyable);\nvar Context = _dereq_(\"./context\")(Promise);\n /*jshint unused:false*/\nvar createContext = Context.create;\n\nvar debug = _dereq_(\"./debuggability\")(Promise, Context,\n    enableAsyncHooks, disableAsyncHooks);\nvar CapturedTrace = debug.CapturedTrace;\nvar PassThroughHandlerContext =\n    _dereq_(\"./finally\")(Promise, tryConvertToPromise, NEXT_FILTER);\nvar catchFilter = _dereq_(\"./catch_filter\")(NEXT_FILTER);\nvar nodebackForPromise = _dereq_(\"./nodeback\");\nvar errorObj = util.errorObj;\nvar tryCatch = util.tryCatch;\nfunction check(self, executor) {\n    if (self == null || self.constructor !== Promise) {\n        throw new TypeError(\"the promise constructor cannot be invoked directly\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    if (typeof executor !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(executor));\n    }\n\n}\n\nfunction Promise(executor) {\n    if (executor !== INTERNAL) {\n        check(this, executor);\n    }\n    this._bitField = 0;\n    this._fulfillmentHandler0 = undefined;\n    this._rejectionHandler0 = undefined;\n    this._promise0 = undefined;\n    this._receiver0 = undefined;\n    this._resolveFromExecutor(executor);\n    this._promiseCreated();\n    this._fireEvent(\"promiseCreated\", this);\n}\n\nPromise.prototype.toString = function () {\n    return \"[object Promise]\";\n};\n\nPromise.prototype.caught = Promise.prototype[\"catch\"] = function (fn) {\n    var len = arguments.length;\n    if (len > 1) {\n        var catchInstances = new Array(len - 1),\n            j = 0, i;\n        for (i = 0; i < len - 1; ++i) {\n            var item = arguments[i];\n            if (util.isObject(item)) {\n                catchInstances[j++] = item;\n            } else {\n                return apiRejection(\"Catch statement predicate: \" +\n                    \"expecting an object but got \" + util.classString(item));\n            }\n        }\n        catchInstances.length = j;\n        fn = arguments[i];\n\n        if (typeof fn !== \"function\") {\n            throw new TypeError(\"The last argument to .catch() \" +\n                \"must be a function, got \" + util.toString(fn));\n        }\n        return this.then(undefined, catchFilter(catchInstances, fn, this));\n    }\n    return this.then(undefined, fn);\n};\n\nPromise.prototype.reflect = function () {\n    return this._then(reflectHandler,\n        reflectHandler, undefined, this, undefined);\n};\n\nPromise.prototype.then = function (didFulfill, didReject) {\n    if (debug.warnings() && arguments.length > 0 &&\n        typeof didFulfill !== \"function\" &&\n        typeof didReject !== \"function\") {\n        var msg = \".then() only accepts functions but was passed: \" +\n                util.classString(didFulfill);\n        if (arguments.length > 1) {\n            msg += \", \" + util.classString(didReject);\n        }\n        this._warn(msg);\n    }\n    return this._then(didFulfill, didReject, undefined, undefined, undefined);\n};\n\nPromise.prototype.done = function (didFulfill, didReject) {\n    var promise =\n        this._then(didFulfill, didReject, undefined, undefined, undefined);\n    promise._setIsFinal();\n};\n\nPromise.prototype.spread = function (fn) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    return this.all()._then(fn, undefined, undefined, APPLY, undefined);\n};\n\nPromise.prototype.toJSON = function () {\n    var ret = {\n        isFulfilled: false,\n        isRejected: false,\n        fulfillmentValue: undefined,\n        rejectionReason: undefined\n    };\n    if (this.isFulfilled()) {\n        ret.fulfillmentValue = this.value();\n        ret.isFulfilled = true;\n    } else if (this.isRejected()) {\n        ret.rejectionReason = this.reason();\n        ret.isRejected = true;\n    }\n    return ret;\n};\n\nPromise.prototype.all = function () {\n    if (arguments.length > 0) {\n        this._warn(\".all() was passed arguments but it does not take any\");\n    }\n    return new PromiseArray(this).promise();\n};\n\nPromise.prototype.error = function (fn) {\n    return this.caught(util.originatesFromRejection, fn);\n};\n\nPromise.getNewLibraryCopy = module.exports;\n\nPromise.is = function (val) {\n    return val instanceof Promise;\n};\n\nPromise.fromNode = Promise.fromCallback = function(fn) {\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    var multiArgs = arguments.length > 1 ? !!Object(arguments[1]).multiArgs\n                                         : false;\n    var result = tryCatch(fn)(nodebackForPromise(ret, multiArgs));\n    if (result === errorObj) {\n        ret._rejectCallback(result.e, true);\n    }\n    if (!ret._isFateSealed()) ret._setAsyncGuaranteed();\n    return ret;\n};\n\nPromise.all = function (promises) {\n    return new PromiseArray(promises).promise();\n};\n\nPromise.cast = function (obj) {\n    var ret = tryConvertToPromise(obj);\n    if (!(ret instanceof Promise)) {\n        ret = new Promise(INTERNAL);\n        ret._captureStackTrace();\n        ret._setFulfilled();\n        ret._rejectionHandler0 = obj;\n    }\n    return ret;\n};\n\nPromise.resolve = Promise.fulfilled = Promise.cast;\n\nPromise.reject = Promise.rejected = function (reason) {\n    var ret = new Promise(INTERNAL);\n    ret._captureStackTrace();\n    ret._rejectCallback(reason, true);\n    return ret;\n};\n\nPromise.setScheduler = function(fn) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    return async.setScheduler(fn);\n};\n\nPromise.prototype._then = function (\n    didFulfill,\n    didReject,\n    _,    receiver,\n    internalData\n) {\n    var haveInternalData = internalData !== undefined;\n    var promise = haveInternalData ? internalData : new Promise(INTERNAL);\n    var target = this._target();\n    var bitField = target._bitField;\n\n    if (!haveInternalData) {\n        promise._propagateFrom(this, 3);\n        promise._captureStackTrace();\n        if (receiver === undefined &&\n            ((this._bitField & 2097152) !== 0)) {\n            if (!((bitField & 50397184) === 0)) {\n                receiver = this._boundValue();\n            } else {\n                receiver = target === this ? undefined : this._boundTo;\n            }\n        }\n        this._fireEvent(\"promiseChained\", this, promise);\n    }\n\n    var context = getContext();\n    if (!((bitField & 50397184) === 0)) {\n        var handler, value, settler = target._settlePromiseCtx;\n        if (((bitField & 33554432) !== 0)) {\n            value = target._rejectionHandler0;\n            handler = didFulfill;\n        } else if (((bitField & 16777216) !== 0)) {\n            value = target._fulfillmentHandler0;\n            handler = didReject;\n            target._unsetRejectionIsUnhandled();\n        } else {\n            settler = target._settlePromiseLateCancellationObserver;\n            value = new CancellationError(\"late cancellation observer\");\n            target._attachExtraTrace(value);\n            handler = didReject;\n        }\n\n        async.invoke(settler, target, {\n            handler: util.contextBind(context, handler),\n            promise: promise,\n            receiver: receiver,\n            value: value\n        });\n    } else {\n        target._addCallbacks(didFulfill, didReject, promise,\n                receiver, context);\n    }\n\n    return promise;\n};\n\nPromise.prototype._length = function () {\n    return this._bitField & 65535;\n};\n\nPromise.prototype._isFateSealed = function () {\n    return (this._bitField & 117506048) !== 0;\n};\n\nPromise.prototype._isFollowing = function () {\n    return (this._bitField & 67108864) === 67108864;\n};\n\nPromise.prototype._setLength = function (len) {\n    this._bitField = (this._bitField & -65536) |\n        (len & 65535);\n};\n\nPromise.prototype._setFulfilled = function () {\n    this._bitField = this._bitField | 33554432;\n    this._fireEvent(\"promiseFulfilled\", this);\n};\n\nPromise.prototype._setRejected = function () {\n    this._bitField = this._bitField | 16777216;\n    this._fireEvent(\"promiseRejected\", this);\n};\n\nPromise.prototype._setFollowing = function () {\n    this._bitField = this._bitField | 67108864;\n    this._fireEvent(\"promiseResolved\", this);\n};\n\nPromise.prototype._setIsFinal = function () {\n    this._bitField = this._bitField | 4194304;\n};\n\nPromise.prototype._isFinal = function () {\n    return (this._bitField & 4194304) > 0;\n};\n\nPromise.prototype._unsetCancelled = function() {\n    this._bitField = this._bitField & (~65536);\n};\n\nPromise.prototype._setCancelled = function() {\n    this._bitField = this._bitField | 65536;\n    this._fireEvent(\"promiseCancelled\", this);\n};\n\nPromise.prototype._setWillBeCancelled = function() {\n    this._bitField = this._bitField | 8388608;\n};\n\nPromise.prototype._setAsyncGuaranteed = function() {\n    if (async.hasCustomScheduler()) return;\n    var bitField = this._bitField;\n    this._bitField = bitField |\n        (((bitField & 536870912) >> 2) ^\n        134217728);\n};\n\nPromise.prototype._setNoAsyncGuarantee = function() {\n    this._bitField = (this._bitField | 536870912) &\n        (~134217728);\n};\n\nPromise.prototype._receiverAt = function (index) {\n    var ret = index === 0 ? this._receiver0 : this[\n            index * 4 - 4 + 3];\n    if (ret === UNDEFINED_BINDING) {\n        return undefined;\n    } else if (ret === undefined && this._isBound()) {\n        return this._boundValue();\n    }\n    return ret;\n};\n\nPromise.prototype._promiseAt = function (index) {\n    return this[\n            index * 4 - 4 + 2];\n};\n\nPromise.prototype._fulfillmentHandlerAt = function (index) {\n    return this[\n            index * 4 - 4 + 0];\n};\n\nPromise.prototype._rejectionHandlerAt = function (index) {\n    return this[\n            index * 4 - 4 + 1];\n};\n\nPromise.prototype._boundValue = function() {};\n\nPromise.prototype._migrateCallback0 = function (follower) {\n    var bitField = follower._bitField;\n    var fulfill = follower._fulfillmentHandler0;\n    var reject = follower._rejectionHandler0;\n    var promise = follower._promise0;\n    var receiver = follower._receiverAt(0);\n    if (receiver === undefined) receiver = UNDEFINED_BINDING;\n    this._addCallbacks(fulfill, reject, promise, receiver, null);\n};\n\nPromise.prototype._migrateCallbackAt = function (follower, index) {\n    var fulfill = follower._fulfillmentHandlerAt(index);\n    var reject = follower._rejectionHandlerAt(index);\n    var promise = follower._promiseAt(index);\n    var receiver = follower._receiverAt(index);\n    if (receiver === undefined) receiver = UNDEFINED_BINDING;\n    this._addCallbacks(fulfill, reject, promise, receiver, null);\n};\n\nPromise.prototype._addCallbacks = function (\n    fulfill,\n    reject,\n    promise,\n    receiver,\n    context\n) {\n    var index = this._length();\n\n    if (index >= 65535 - 4) {\n        index = 0;\n        this._setLength(0);\n    }\n\n    if (index === 0) {\n        this._promise0 = promise;\n        this._receiver0 = receiver;\n        if (typeof fulfill === \"function\") {\n            this._fulfillmentHandler0 = util.contextBind(context, fulfill);\n        }\n        if (typeof reject === \"function\") {\n            this._rejectionHandler0 = util.contextBind(context, reject);\n        }\n    } else {\n        var base = index * 4 - 4;\n        this[base + 2] = promise;\n        this[base + 3] = receiver;\n        if (typeof fulfill === \"function\") {\n            this[base + 0] =\n                util.contextBind(context, fulfill);\n        }\n        if (typeof reject === \"function\") {\n            this[base + 1] =\n                util.contextBind(context, reject);\n        }\n    }\n    this._setLength(index + 1);\n    return index;\n};\n\nPromise.prototype._proxy = function (proxyable, arg) {\n    this._addCallbacks(undefined, undefined, arg, proxyable, null);\n};\n\nPromise.prototype._resolveCallback = function(value, shouldBind) {\n    if (((this._bitField & 117506048) !== 0)) return;\n    if (value === this)\n        return this._rejectCallback(makeSelfResolutionError(), false);\n    var maybePromise = tryConvertToPromise(value, this);\n    if (!(maybePromise instanceof Promise)) return this._fulfill(value);\n\n    if (shouldBind) this._propagateFrom(maybePromise, 2);\n\n\n    var promise = maybePromise._target();\n\n    if (promise === this) {\n        this._reject(makeSelfResolutionError());\n        return;\n    }\n\n    var bitField = promise._bitField;\n    if (((bitField & 50397184) === 0)) {\n        var len = this._length();\n        if (len > 0) promise._migrateCallback0(this);\n        for (var i = 1; i < len; ++i) {\n            promise._migrateCallbackAt(this, i);\n        }\n        this._setFollowing();\n        this._setLength(0);\n        this._setFollowee(maybePromise);\n    } else if (((bitField & 33554432) !== 0)) {\n        this._fulfill(promise._value());\n    } else if (((bitField & 16777216) !== 0)) {\n        this._reject(promise._reason());\n    } else {\n        var reason = new CancellationError(\"late cancellation observer\");\n        promise._attachExtraTrace(reason);\n        this._reject(reason);\n    }\n};\n\nPromise.prototype._rejectCallback =\nfunction(reason, synchronous, ignoreNonErrorWarnings) {\n    var trace = util.ensureErrorObject(reason);\n    var hasStack = trace === reason;\n    if (!hasStack && !ignoreNonErrorWarnings && debug.warnings()) {\n        var message = \"a promise was rejected with a non-error: \" +\n            util.classString(reason);\n        this._warn(message, true);\n    }\n    this._attachExtraTrace(trace, synchronous ? hasStack : false);\n    this._reject(reason);\n};\n\nPromise.prototype._resolveFromExecutor = function (executor) {\n    if (executor === INTERNAL) return;\n    var promise = this;\n    this._captureStackTrace();\n    this._pushContext();\n    var synchronous = true;\n    var r = this._execute(executor, function(value) {\n        promise._resolveCallback(value);\n    }, function (reason) {\n        promise._rejectCallback(reason, synchronous);\n    });\n    synchronous = false;\n    this._popContext();\n\n    if (r !== undefined) {\n        promise._rejectCallback(r, true);\n    }\n};\n\nPromise.prototype._settlePromiseFromHandler = function (\n    handler, receiver, value, promise\n) {\n    var bitField = promise._bitField;\n    if (((bitField & 65536) !== 0)) return;\n    promise._pushContext();\n    var x;\n    if (receiver === APPLY) {\n        if (!value || typeof value.length !== \"number\") {\n            x = errorObj;\n            x.e = new TypeError(\"cannot .spread() a non-array: \" +\n                                    util.classString(value));\n        } else {\n            x = tryCatch(handler).apply(this._boundValue(), value);\n        }\n    } else {\n        x = tryCatch(handler).call(receiver, value);\n    }\n    var promiseCreated = promise._popContext();\n    bitField = promise._bitField;\n    if (((bitField & 65536) !== 0)) return;\n\n    if (x === NEXT_FILTER) {\n        promise._reject(value);\n    } else if (x === errorObj) {\n        promise._rejectCallback(x.e, false);\n    } else {\n        debug.checkForgottenReturns(x, promiseCreated, \"\",  promise, this);\n        promise._resolveCallback(x);\n    }\n};\n\nPromise.prototype._target = function() {\n    var ret = this;\n    while (ret._isFollowing()) ret = ret._followee();\n    return ret;\n};\n\nPromise.prototype._followee = function() {\n    return this._rejectionHandler0;\n};\n\nPromise.prototype._setFollowee = function(promise) {\n    this._rejectionHandler0 = promise;\n};\n\nPromise.prototype._settlePromise = function(promise, handler, receiver, value) {\n    var isPromise = promise instanceof Promise;\n    var bitField = this._bitField;\n    var asyncGuaranteed = ((bitField & 134217728) !== 0);\n    if (((bitField & 65536) !== 0)) {\n        if (isPromise) promise._invokeInternalOnCancel();\n\n        if (receiver instanceof PassThroughHandlerContext &&\n            receiver.isFinallyHandler()) {\n            receiver.cancelPromise = promise;\n            if (tryCatch(handler).call(receiver, value) === errorObj) {\n                promise._reject(errorObj.e);\n            }\n        } else if (handler === reflectHandler) {\n            promise._fulfill(reflectHandler.call(receiver));\n        } else if (receiver instanceof Proxyable) {\n            receiver._promiseCancelled(promise);\n        } else if (isPromise || promise instanceof PromiseArray) {\n            promise._cancel();\n        } else {\n            receiver.cancel();\n        }\n    } else if (typeof handler === \"function\") {\n        if (!isPromise) {\n            handler.call(receiver, value, promise);\n        } else {\n            if (asyncGuaranteed) promise._setAsyncGuaranteed();\n            this._settlePromiseFromHandler(handler, receiver, value, promise);\n        }\n    } else if (receiver instanceof Proxyable) {\n        if (!receiver._isResolved()) {\n            if (((bitField & 33554432) !== 0)) {\n                receiver._promiseFulfilled(value, promise);\n            } else {\n                receiver._promiseRejected(value, promise);\n            }\n        }\n    } else if (isPromise) {\n        if (asyncGuaranteed) promise._setAsyncGuaranteed();\n        if (((bitField & 33554432) !== 0)) {\n            promise._fulfill(value);\n        } else {\n            promise._reject(value);\n        }\n    }\n};\n\nPromise.prototype._settlePromiseLateCancellationObserver = function(ctx) {\n    var handler = ctx.handler;\n    var promise = ctx.promise;\n    var receiver = ctx.receiver;\n    var value = ctx.value;\n    if (typeof handler === \"function\") {\n        if (!(promise instanceof Promise)) {\n            handler.call(receiver, value, promise);\n        } else {\n            this._settlePromiseFromHandler(handler, receiver, value, promise);\n        }\n    } else if (promise instanceof Promise) {\n        promise._reject(value);\n    }\n};\n\nPromise.prototype._settlePromiseCtx = function(ctx) {\n    this._settlePromise(ctx.promise, ctx.handler, ctx.receiver, ctx.value);\n};\n\nPromise.prototype._settlePromise0 = function(handler, value, bitField) {\n    var promise = this._promise0;\n    var receiver = this._receiverAt(0);\n    this._promise0 = undefined;\n    this._receiver0 = undefined;\n    this._settlePromise(promise, handler, receiver, value);\n};\n\nPromise.prototype._clearCallbackDataAtIndex = function(index) {\n    var base = index * 4 - 4;\n    this[base + 2] =\n    this[base + 3] =\n    this[base + 0] =\n    this[base + 1] = undefined;\n};\n\nPromise.prototype._fulfill = function (value) {\n    var bitField = this._bitField;\n    if (((bitField & 117506048) >>> 16)) return;\n    if (value === this) {\n        var err = makeSelfResolutionError();\n        this._attachExtraTrace(err);\n        return this._reject(err);\n    }\n    this._setFulfilled();\n    this._rejectionHandler0 = value;\n\n    if ((bitField & 65535) > 0) {\n        if (((bitField & 134217728) !== 0)) {\n            this._settlePromises();\n        } else {\n            async.settlePromises(this);\n        }\n        this._dereferenceTrace();\n    }\n};\n\nPromise.prototype._reject = function (reason) {\n    var bitField = this._bitField;\n    if (((bitField & 117506048) >>> 16)) return;\n    this._setRejected();\n    this._fulfillmentHandler0 = reason;\n\n    if (this._isFinal()) {\n        return async.fatalError(reason, util.isNode);\n    }\n\n    if ((bitField & 65535) > 0) {\n        async.settlePromises(this);\n    } else {\n        this._ensurePossibleRejectionHandled();\n    }\n};\n\nPromise.prototype._fulfillPromises = function (len, value) {\n    for (var i = 1; i < len; i++) {\n        var handler = this._fulfillmentHandlerAt(i);\n        var promise = this._promiseAt(i);\n        var receiver = this._receiverAt(i);\n        this._clearCallbackDataAtIndex(i);\n        this._settlePromise(promise, handler, receiver, value);\n    }\n};\n\nPromise.prototype._rejectPromises = function (len, reason) {\n    for (var i = 1; i < len; i++) {\n        var handler = this._rejectionHandlerAt(i);\n        var promise = this._promiseAt(i);\n        var receiver = this._receiverAt(i);\n        this._clearCallbackDataAtIndex(i);\n        this._settlePromise(promise, handler, receiver, reason);\n    }\n};\n\nPromise.prototype._settlePromises = function () {\n    var bitField = this._bitField;\n    var len = (bitField & 65535);\n\n    if (len > 0) {\n        if (((bitField & 16842752) !== 0)) {\n            var reason = this._fulfillmentHandler0;\n            this._settlePromise0(this._rejectionHandler0, reason, bitField);\n            this._rejectPromises(len, reason);\n        } else {\n            var value = this._rejectionHandler0;\n            this._settlePromise0(this._fulfillmentHandler0, value, bitField);\n            this._fulfillPromises(len, value);\n        }\n        this._setLength(0);\n    }\n    this._clearCancellationData();\n};\n\nPromise.prototype._settledValue = function() {\n    var bitField = this._bitField;\n    if (((bitField & 33554432) !== 0)) {\n        return this._rejectionHandler0;\n    } else if (((bitField & 16777216) !== 0)) {\n        return this._fulfillmentHandler0;\n    }\n};\n\nif (typeof Symbol !== \"undefined\" && Symbol.toStringTag) {\n    es5.defineProperty(Promise.prototype, Symbol.toStringTag, {\n        get: function () {\n            return \"Object\";\n        }\n    });\n}\n\nfunction deferResolve(v) {this.promise._resolveCallback(v);}\nfunction deferReject(v) {this.promise._rejectCallback(v, false);}\n\nPromise.defer = Promise.pending = function() {\n    debug.deprecated(\"Promise.defer\", \"new Promise\");\n    var promise = new Promise(INTERNAL);\n    return {\n        promise: promise,\n        resolve: deferResolve,\n        reject: deferReject\n    };\n};\n\nutil.notEnumerableProp(Promise,\n                       \"_makeSelfResolutionError\",\n                       makeSelfResolutionError);\n\n_dereq_(\"./method\")(Promise, INTERNAL, tryConvertToPromise, apiRejection,\n    debug);\n_dereq_(\"./bind\")(Promise, INTERNAL, tryConvertToPromise, debug);\n_dereq_(\"./cancel\")(Promise, PromiseArray, apiRejection, debug);\n_dereq_(\"./direct_resolve\")(Promise);\n_dereq_(\"./synchronous_inspection\")(Promise);\n_dereq_(\"./join\")(\n    Promise, PromiseArray, tryConvertToPromise, INTERNAL, async);\nPromise.Promise = Promise;\nPromise.version = \"3.7.2\";\n_dereq_('./call_get.js')(Promise);\n_dereq_('./generators.js')(Promise, apiRejection, INTERNAL, tryConvertToPromise, Proxyable, debug);\n_dereq_('./map.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug);\n_dereq_('./nodeify.js')(Promise);\n_dereq_('./promisify.js')(Promise, INTERNAL);\n_dereq_('./props.js')(Promise, PromiseArray, tryConvertToPromise, apiRejection);\n_dereq_('./race.js')(Promise, INTERNAL, tryConvertToPromise, apiRejection);\n_dereq_('./reduce.js')(Promise, PromiseArray, apiRejection, tryConvertToPromise, INTERNAL, debug);\n_dereq_('./settle.js')(Promise, PromiseArray, debug);\n_dereq_('./some.js')(Promise, PromiseArray, apiRejection);\n_dereq_('./timers.js')(Promise, INTERNAL, debug);\n_dereq_('./using.js')(Promise, apiRejection, tryConvertToPromise, createContext, INTERNAL, debug);\n_dereq_('./any.js')(Promise);\n_dereq_('./each.js')(Promise, INTERNAL);\n_dereq_('./filter.js')(Promise, INTERNAL);\n                                                         \n    util.toFastProperties(Promise);                                          \n    util.toFastProperties(Promise.prototype);                                \n    function fillTypes(value) {                                              \n        var p = new Promise(INTERNAL);                                       \n        p._fulfillmentHandler0 = value;                                      \n        p._rejectionHandler0 = value;                                        \n        p._promise0 = value;                                                 \n        p._receiver0 = value;                                                \n    }                                                                        \n    // Complete slack tracking, opt out of field-type tracking and           \n    // stabilize map                                                         \n    fillTypes({a: 1});                                                       \n    fillTypes({b: 2});                                                       \n    fillTypes({c: 3});                                                       \n    fillTypes(1);                                                            \n    fillTypes(function(){});                                                 \n    fillTypes(undefined);                                                    \n    fillTypes(false);                                                        \n    fillTypes(new Promise(INTERNAL));                                        \n    debug.setBounds(Async.firstLineError, util.lastLineError);               \n    return Promise;                                                          \n\n};\n\n},{\"./any.js\":1,\"./async\":2,\"./bind\":3,\"./call_get.js\":5,\"./cancel\":6,\"./catch_filter\":7,\"./context\":8,\"./debuggability\":9,\"./direct_resolve\":10,\"./each.js\":11,\"./errors\":12,\"./es5\":13,\"./filter.js\":14,\"./finally\":15,\"./generators.js\":16,\"./join\":17,\"./map.js\":18,\"./method\":19,\"./nodeback\":20,\"./nodeify.js\":21,\"./promise_array\":23,\"./promisify.js\":24,\"./props.js\":25,\"./race.js\":27,\"./reduce.js\":28,\"./settle.js\":30,\"./some.js\":31,\"./synchronous_inspection\":32,\"./thenables\":33,\"./timers.js\":34,\"./using.js\":35,\"./util\":36,\"async_hooks\":undefined}],23:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, tryConvertToPromise,\n    apiRejection, Proxyable) {\nvar util = _dereq_(\"./util\");\nvar isArray = util.isArray;\n\nfunction toResolutionValue(val) {\n    switch(val) {\n    case -2: return [];\n    case -3: return {};\n    case -6: return new Map();\n    }\n}\n\nfunction PromiseArray(values) {\n    var promise = this._promise = new Promise(INTERNAL);\n    if (values instanceof Promise) {\n        promise._propagateFrom(values, 3);\n        values.suppressUnhandledRejections();\n    }\n    promise._setOnCancel(this);\n    this._values = values;\n    this._length = 0;\n    this._totalResolved = 0;\n    this._init(undefined, -2);\n}\nutil.inherits(PromiseArray, Proxyable);\n\nPromiseArray.prototype.length = function () {\n    return this._length;\n};\n\nPromiseArray.prototype.promise = function () {\n    return this._promise;\n};\n\nPromiseArray.prototype._init = function init(_, resolveValueIfEmpty) {\n    var values = tryConvertToPromise(this._values, this._promise);\n    if (values instanceof Promise) {\n        values = values._target();\n        var bitField = values._bitField;\n        ;\n        this._values = values;\n\n        if (((bitField & 50397184) === 0)) {\n            this._promise._setAsyncGuaranteed();\n            return values._then(\n                init,\n                this._reject,\n                undefined,\n                this,\n                resolveValueIfEmpty\n           );\n        } else if (((bitField & 33554432) !== 0)) {\n            values = values._value();\n        } else if (((bitField & 16777216) !== 0)) {\n            return this._reject(values._reason());\n        } else {\n            return this._cancel();\n        }\n    }\n    values = util.asArray(values);\n    if (values === null) {\n        var err = apiRejection(\n            \"expecting an array or an iterable object but got \" + util.classString(values)).reason();\n        this._promise._rejectCallback(err, false);\n        return;\n    }\n\n    if (values.length === 0) {\n        if (resolveValueIfEmpty === -5) {\n            this._resolveEmptyArray();\n        }\n        else {\n            this._resolve(toResolutionValue(resolveValueIfEmpty));\n        }\n        return;\n    }\n    this._iterate(values);\n};\n\nPromiseArray.prototype._iterate = function(values) {\n    var len = this.getActualLength(values.length);\n    this._length = len;\n    this._values = this.shouldCopyValues() ? new Array(len) : this._values;\n    var result = this._promise;\n    var isResolved = false;\n    var bitField = null;\n    for (var i = 0; i < len; ++i) {\n        var maybePromise = tryConvertToPromise(values[i], result);\n\n        if (maybePromise instanceof Promise) {\n            maybePromise = maybePromise._target();\n            bitField = maybePromise._bitField;\n        } else {\n            bitField = null;\n        }\n\n        if (isResolved) {\n            if (bitField !== null) {\n                maybePromise.suppressUnhandledRejections();\n            }\n        } else if (bitField !== null) {\n            if (((bitField & 50397184) === 0)) {\n                maybePromise._proxy(this, i);\n                this._values[i] = maybePromise;\n            } else if (((bitField & 33554432) !== 0)) {\n                isResolved = this._promiseFulfilled(maybePromise._value(), i);\n            } else if (((bitField & 16777216) !== 0)) {\n                isResolved = this._promiseRejected(maybePromise._reason(), i);\n            } else {\n                isResolved = this._promiseCancelled(i);\n            }\n        } else {\n            isResolved = this._promiseFulfilled(maybePromise, i);\n        }\n    }\n    if (!isResolved) result._setAsyncGuaranteed();\n};\n\nPromiseArray.prototype._isResolved = function () {\n    return this._values === null;\n};\n\nPromiseArray.prototype._resolve = function (value) {\n    this._values = null;\n    this._promise._fulfill(value);\n};\n\nPromiseArray.prototype._cancel = function() {\n    if (this._isResolved() || !this._promise._isCancellable()) return;\n    this._values = null;\n    this._promise._cancel();\n};\n\nPromiseArray.prototype._reject = function (reason) {\n    this._values = null;\n    this._promise._rejectCallback(reason, false);\n};\n\nPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n        return true;\n    }\n    return false;\n};\n\nPromiseArray.prototype._promiseCancelled = function() {\n    this._cancel();\n    return true;\n};\n\nPromiseArray.prototype._promiseRejected = function (reason) {\n    this._totalResolved++;\n    this._reject(reason);\n    return true;\n};\n\nPromiseArray.prototype._resultCancelled = function() {\n    if (this._isResolved()) return;\n    var values = this._values;\n    this._cancel();\n    if (values instanceof Promise) {\n        values.cancel();\n    } else {\n        for (var i = 0; i < values.length; ++i) {\n            if (values[i] instanceof Promise) {\n                values[i].cancel();\n            }\n        }\n    }\n};\n\nPromiseArray.prototype.shouldCopyValues = function () {\n    return true;\n};\n\nPromiseArray.prototype.getActualLength = function (len) {\n    return len;\n};\n\nreturn PromiseArray;\n};\n\n},{\"./util\":36}],24:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar THIS = {};\nvar util = _dereq_(\"./util\");\nvar nodebackForPromise = _dereq_(\"./nodeback\");\nvar withAppended = util.withAppended;\nvar maybeWrapAsError = util.maybeWrapAsError;\nvar canEvaluate = util.canEvaluate;\nvar TypeError = _dereq_(\"./errors\").TypeError;\nvar defaultSuffix = \"Async\";\nvar defaultPromisified = {__isPromisified__: true};\nvar noCopyProps = [\n    \"arity\",    \"length\",\n    \"name\",\n    \"arguments\",\n    \"caller\",\n    \"callee\",\n    \"prototype\",\n    \"__isPromisified__\"\n];\nvar noCopyPropsPattern = new RegExp(\"^(?:\" + noCopyProps.join(\"|\") + \")$\");\n\nvar defaultFilter = function(name) {\n    return util.isIdentifier(name) &&\n        name.charAt(0) !== \"_\" &&\n        name !== \"constructor\";\n};\n\nfunction propsFilter(key) {\n    return !noCopyPropsPattern.test(key);\n}\n\nfunction isPromisified(fn) {\n    try {\n        return fn.__isPromisified__ === true;\n    }\n    catch (e) {\n        return false;\n    }\n}\n\nfunction hasPromisified(obj, key, suffix) {\n    var val = util.getDataPropertyOrDefault(obj, key + suffix,\n                                            defaultPromisified);\n    return val ? isPromisified(val) : false;\n}\nfunction checkValid(ret, suffix, suffixRegexp) {\n    for (var i = 0; i < ret.length; i += 2) {\n        var key = ret[i];\n        if (suffixRegexp.test(key)) {\n            var keyWithoutAsyncSuffix = key.replace(suffixRegexp, \"\");\n            for (var j = 0; j < ret.length; j += 2) {\n                if (ret[j] === keyWithoutAsyncSuffix) {\n                    throw new TypeError(\"Cannot promisify an API that has normal methods with '%s'-suffix\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\"\n                        .replace(\"%s\", suffix));\n                }\n            }\n        }\n    }\n}\n\nfunction promisifiableMethods(obj, suffix, suffixRegexp, filter) {\n    var keys = util.inheritedDataKeys(obj);\n    var ret = [];\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        var value = obj[key];\n        var passesDefaultFilter = filter === defaultFilter\n            ? true : defaultFilter(key, value, obj);\n        if (typeof value === \"function\" &&\n            !isPromisified(value) &&\n            !hasPromisified(obj, key, suffix) &&\n            filter(key, value, obj, passesDefaultFilter)) {\n            ret.push(key, value);\n        }\n    }\n    checkValid(ret, suffix, suffixRegexp);\n    return ret;\n}\n\nvar escapeIdentRegex = function(str) {\n    return str.replace(/([$])/, \"\\\\$\");\n};\n\nvar makeNodePromisifiedEval;\nif (!true) {\nvar switchCaseArgumentOrder = function(likelyArgumentCount) {\n    var ret = [likelyArgumentCount];\n    var min = Math.max(0, likelyArgumentCount - 1 - 3);\n    for(var i = likelyArgumentCount - 1; i >= min; --i) {\n        ret.push(i);\n    }\n    for(var i = likelyArgumentCount + 1; i <= 3; ++i) {\n        ret.push(i);\n    }\n    return ret;\n};\n\nvar argumentSequence = function(argumentCount) {\n    return util.filledRange(argumentCount, \"_arg\", \"\");\n};\n\nvar parameterDeclaration = function(parameterCount) {\n    return util.filledRange(\n        Math.max(parameterCount, 3), \"_arg\", \"\");\n};\n\nvar parameterCount = function(fn) {\n    if (typeof fn.length === \"number\") {\n        return Math.max(Math.min(fn.length, 1023 + 1), 0);\n    }\n    return 0;\n};\n\nmakeNodePromisifiedEval =\nfunction(callback, receiver, originalName, fn, _, multiArgs) {\n    var newParameterCount = Math.max(0, parameterCount(fn) - 1);\n    var argumentOrder = switchCaseArgumentOrder(newParameterCount);\n    var shouldProxyThis = typeof callback === \"string\" || receiver === THIS;\n\n    function generateCallForArgumentCount(count) {\n        var args = argumentSequence(count).join(\", \");\n        var comma = count > 0 ? \", \" : \"\";\n        var ret;\n        if (shouldProxyThis) {\n            ret = \"ret = callback.call(this, {{args}}, nodeback); break;\\n\";\n        } else {\n            ret = receiver === undefined\n                ? \"ret = callback({{args}}, nodeback); break;\\n\"\n                : \"ret = callback.call(receiver, {{args}}, nodeback); break;\\n\";\n        }\n        return ret.replace(\"{{args}}\", args).replace(\", \", comma);\n    }\n\n    function generateArgumentSwitchCase() {\n        var ret = \"\";\n        for (var i = 0; i < argumentOrder.length; ++i) {\n            ret += \"case \" + argumentOrder[i] +\":\" +\n                generateCallForArgumentCount(argumentOrder[i]);\n        }\n\n        ret += \"                                                             \\n\\\n        default:                                                             \\n\\\n            var args = new Array(len + 1);                                   \\n\\\n            var i = 0;                                                       \\n\\\n            for (var i = 0; i < len; ++i) {                                  \\n\\\n               args[i] = arguments[i];                                       \\n\\\n            }                                                                \\n\\\n            args[i] = nodeback;                                              \\n\\\n            [CodeForCall]                                                    \\n\\\n            break;                                                           \\n\\\n        \".replace(\"[CodeForCall]\", (shouldProxyThis\n                                ? \"ret = callback.apply(this, args);\\n\"\n                                : \"ret = callback.apply(receiver, args);\\n\"));\n        return ret;\n    }\n\n    var getFunctionCode = typeof callback === \"string\"\n                                ? (\"this != null ? this['\"+callback+\"'] : fn\")\n                                : \"fn\";\n    var body = \"'use strict';                                                \\n\\\n        var ret = function (Parameters) {                                    \\n\\\n            'use strict';                                                    \\n\\\n            var len = arguments.length;                                      \\n\\\n            var promise = new Promise(INTERNAL);                             \\n\\\n            promise._captureStackTrace();                                    \\n\\\n            var nodeback = nodebackForPromise(promise, \" + multiArgs + \");   \\n\\\n            var ret;                                                         \\n\\\n            var callback = tryCatch([GetFunctionCode]);                      \\n\\\n            switch(len) {                                                    \\n\\\n                [CodeForSwitchCase]                                          \\n\\\n            }                                                                \\n\\\n            if (ret === errorObj) {                                          \\n\\\n                promise._rejectCallback(maybeWrapAsError(ret.e), true, true);\\n\\\n            }                                                                \\n\\\n            if (!promise._isFateSealed()) promise._setAsyncGuaranteed();     \\n\\\n            return promise;                                                  \\n\\\n        };                                                                   \\n\\\n        notEnumerableProp(ret, '__isPromisified__', true);                   \\n\\\n        return ret;                                                          \\n\\\n    \".replace(\"[CodeForSwitchCase]\", generateArgumentSwitchCase())\n        .replace(\"[GetFunctionCode]\", getFunctionCode);\n    body = body.replace(\"Parameters\", parameterDeclaration(newParameterCount));\n    return new Function(\"Promise\",\n                        \"fn\",\n                        \"receiver\",\n                        \"withAppended\",\n                        \"maybeWrapAsError\",\n                        \"nodebackForPromise\",\n                        \"tryCatch\",\n                        \"errorObj\",\n                        \"notEnumerableProp\",\n                        \"INTERNAL\",\n                        body)(\n                    Promise,\n                    fn,\n                    receiver,\n                    withAppended,\n                    maybeWrapAsError,\n                    nodebackForPromise,\n                    util.tryCatch,\n                    util.errorObj,\n                    util.notEnumerableProp,\n                    INTERNAL);\n};\n}\n\nfunction makeNodePromisifiedClosure(callback, receiver, _, fn, __, multiArgs) {\n    var defaultThis = (function() {return this;})();\n    var method = callback;\n    if (typeof method === \"string\") {\n        callback = fn;\n    }\n    function promisified() {\n        var _receiver = receiver;\n        if (receiver === THIS) _receiver = this;\n        var promise = new Promise(INTERNAL);\n        promise._captureStackTrace();\n        var cb = typeof method === \"string\" && this !== defaultThis\n            ? this[method] : callback;\n        var fn = nodebackForPromise(promise, multiArgs);\n        try {\n            cb.apply(_receiver, withAppended(arguments, fn));\n        } catch(e) {\n            promise._rejectCallback(maybeWrapAsError(e), true, true);\n        }\n        if (!promise._isFateSealed()) promise._setAsyncGuaranteed();\n        return promise;\n    }\n    util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n    return promisified;\n}\n\nvar makeNodePromisified = canEvaluate\n    ? makeNodePromisifiedEval\n    : makeNodePromisifiedClosure;\n\nfunction promisifyAll(obj, suffix, filter, promisifier, multiArgs) {\n    var suffixRegexp = new RegExp(escapeIdentRegex(suffix) + \"$\");\n    var methods =\n        promisifiableMethods(obj, suffix, suffixRegexp, filter);\n\n    for (var i = 0, len = methods.length; i < len; i+= 2) {\n        var key = methods[i];\n        var fn = methods[i+1];\n        var promisifiedKey = key + suffix;\n        if (promisifier === makeNodePromisified) {\n            obj[promisifiedKey] =\n                makeNodePromisified(key, THIS, key, fn, suffix, multiArgs);\n        } else {\n            var promisified = promisifier(fn, function() {\n                return makeNodePromisified(key, THIS, key,\n                                           fn, suffix, multiArgs);\n            });\n            util.notEnumerableProp(promisified, \"__isPromisified__\", true);\n            obj[promisifiedKey] = promisified;\n        }\n    }\n    util.toFastProperties(obj);\n    return obj;\n}\n\nfunction promisify(callback, receiver, multiArgs) {\n    return makeNodePromisified(callback, receiver, undefined,\n                                callback, null, multiArgs);\n}\n\nPromise.promisify = function (fn, options) {\n    if (typeof fn !== \"function\") {\n        throw new TypeError(\"expecting a function but got \" + util.classString(fn));\n    }\n    if (isPromisified(fn)) {\n        return fn;\n    }\n    options = Object(options);\n    var receiver = options.context === undefined ? THIS : options.context;\n    var multiArgs = !!options.multiArgs;\n    var ret = promisify(fn, receiver, multiArgs);\n    util.copyDescriptors(fn, ret, propsFilter);\n    return ret;\n};\n\nPromise.promisifyAll = function (target, options) {\n    if (typeof target !== \"function\" && typeof target !== \"object\") {\n        throw new TypeError(\"the target of promisifyAll must be an object or a function\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    options = Object(options);\n    var multiArgs = !!options.multiArgs;\n    var suffix = options.suffix;\n    if (typeof suffix !== \"string\") suffix = defaultSuffix;\n    var filter = options.filter;\n    if (typeof filter !== \"function\") filter = defaultFilter;\n    var promisifier = options.promisifier;\n    if (typeof promisifier !== \"function\") promisifier = makeNodePromisified;\n\n    if (!util.isIdentifier(suffix)) {\n        throw new RangeError(\"suffix must be a valid identifier\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n\n    var keys = util.inheritedDataKeys(target);\n    for (var i = 0; i < keys.length; ++i) {\n        var value = target[keys[i]];\n        if (keys[i] !== \"constructor\" &&\n            util.isClass(value)) {\n            promisifyAll(value.prototype, suffix, filter, promisifier,\n                multiArgs);\n            promisifyAll(value, suffix, filter, promisifier, multiArgs);\n        }\n    }\n\n    return promisifyAll(target, suffix, filter, promisifier, multiArgs);\n};\n};\n\n\n},{\"./errors\":12,\"./nodeback\":20,\"./util\":36}],25:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(\n    Promise, PromiseArray, tryConvertToPromise, apiRejection) {\nvar util = _dereq_(\"./util\");\nvar isObject = util.isObject;\nvar es5 = _dereq_(\"./es5\");\nvar Es6Map;\nif (typeof Map === \"function\") Es6Map = Map;\n\nvar mapToEntries = (function() {\n    var index = 0;\n    var size = 0;\n\n    function extractEntry(value, key) {\n        this[index] = value;\n        this[index + size] = key;\n        index++;\n    }\n\n    return function mapToEntries(map) {\n        size = map.size;\n        index = 0;\n        var ret = new Array(map.size * 2);\n        map.forEach(extractEntry, ret);\n        return ret;\n    };\n})();\n\nvar entriesToMap = function(entries) {\n    var ret = new Es6Map();\n    var length = entries.length / 2 | 0;\n    for (var i = 0; i < length; ++i) {\n        var key = entries[length + i];\n        var value = entries[i];\n        ret.set(key, value);\n    }\n    return ret;\n};\n\nfunction PropertiesPromiseArray(obj) {\n    var isMap = false;\n    var entries;\n    if (Es6Map !== undefined && obj instanceof Es6Map) {\n        entries = mapToEntries(obj);\n        isMap = true;\n    } else {\n        var keys = es5.keys(obj);\n        var len = keys.length;\n        entries = new Array(len * 2);\n        for (var i = 0; i < len; ++i) {\n            var key = keys[i];\n            entries[i] = obj[key];\n            entries[i + len] = key;\n        }\n    }\n    this.constructor$(entries);\n    this._isMap = isMap;\n    this._init$(undefined, isMap ? -6 : -3);\n}\nutil.inherits(PropertiesPromiseArray, PromiseArray);\n\nPropertiesPromiseArray.prototype._init = function () {};\n\nPropertiesPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    this._values[index] = value;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        var val;\n        if (this._isMap) {\n            val = entriesToMap(this._values);\n        } else {\n            val = {};\n            var keyOffset = this.length();\n            for (var i = 0, len = this.length(); i < len; ++i) {\n                val[this._values[i + keyOffset]] = this._values[i];\n            }\n        }\n        this._resolve(val);\n        return true;\n    }\n    return false;\n};\n\nPropertiesPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nPropertiesPromiseArray.prototype.getActualLength = function (len) {\n    return len >> 1;\n};\n\nfunction props(promises) {\n    var ret;\n    var castValue = tryConvertToPromise(promises);\n\n    if (!isObject(castValue)) {\n        return apiRejection(\"cannot await properties of a non-object\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    } else if (castValue instanceof Promise) {\n        ret = castValue._then(\n            Promise.props, undefined, undefined, undefined, undefined);\n    } else {\n        ret = new PropertiesPromiseArray(castValue).promise();\n    }\n\n    if (castValue instanceof Promise) {\n        ret._propagateFrom(castValue, 2);\n    }\n    return ret;\n}\n\nPromise.prototype.props = function () {\n    return props(this);\n};\n\nPromise.props = function (promises) {\n    return props(promises);\n};\n};\n\n},{\"./es5\":13,\"./util\":36}],26:[function(_dereq_,module,exports){\n\"use strict\";\nfunction arrayMove(src, srcIndex, dst, dstIndex, len) {\n    for (var j = 0; j < len; ++j) {\n        dst[j + dstIndex] = src[j + srcIndex];\n        src[j + srcIndex] = void 0;\n    }\n}\n\nfunction Queue(capacity) {\n    this._capacity = capacity;\n    this._length = 0;\n    this._front = 0;\n}\n\nQueue.prototype._willBeOverCapacity = function (size) {\n    return this._capacity < size;\n};\n\nQueue.prototype._pushOne = function (arg) {\n    var length = this.length();\n    this._checkCapacity(length + 1);\n    var i = (this._front + length) & (this._capacity - 1);\n    this[i] = arg;\n    this._length = length + 1;\n};\n\nQueue.prototype.push = function (fn, receiver, arg) {\n    var length = this.length() + 3;\n    if (this._willBeOverCapacity(length)) {\n        this._pushOne(fn);\n        this._pushOne(receiver);\n        this._pushOne(arg);\n        return;\n    }\n    var j = this._front + length - 3;\n    this._checkCapacity(length);\n    var wrapMask = this._capacity - 1;\n    this[(j + 0) & wrapMask] = fn;\n    this[(j + 1) & wrapMask] = receiver;\n    this[(j + 2) & wrapMask] = arg;\n    this._length = length;\n};\n\nQueue.prototype.shift = function () {\n    var front = this._front,\n        ret = this[front];\n\n    this[front] = undefined;\n    this._front = (front + 1) & (this._capacity - 1);\n    this._length--;\n    return ret;\n};\n\nQueue.prototype.length = function () {\n    return this._length;\n};\n\nQueue.prototype._checkCapacity = function (size) {\n    if (this._capacity < size) {\n        this._resizeTo(this._capacity << 1);\n    }\n};\n\nQueue.prototype._resizeTo = function (capacity) {\n    var oldCapacity = this._capacity;\n    this._capacity = capacity;\n    var front = this._front;\n    var length = this._length;\n    var moveItemsCount = (front + length) & (oldCapacity - 1);\n    arrayMove(this, 0, this, oldCapacity, moveItemsCount);\n};\n\nmodule.exports = Queue;\n\n},{}],27:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(\n    Promise, INTERNAL, tryConvertToPromise, apiRejection) {\nvar util = _dereq_(\"./util\");\n\nvar raceLater = function (promise) {\n    return promise.then(function(array) {\n        return race(array, promise);\n    });\n};\n\nfunction race(promises, parent) {\n    var maybePromise = tryConvertToPromise(promises);\n\n    if (maybePromise instanceof Promise) {\n        return raceLater(maybePromise);\n    } else {\n        promises = util.asArray(promises);\n        if (promises === null)\n            return apiRejection(\"expecting an array or an iterable object but got \" + util.classString(promises));\n    }\n\n    var ret = new Promise(INTERNAL);\n    if (parent !== undefined) {\n        ret._propagateFrom(parent, 3);\n    }\n    var fulfill = ret._fulfill;\n    var reject = ret._reject;\n    for (var i = 0, len = promises.length; i < len; ++i) {\n        var val = promises[i];\n\n        if (val === undefined && !(i in promises)) {\n            continue;\n        }\n\n        Promise.cast(val)._then(fulfill, reject, undefined, ret, null);\n    }\n    return ret;\n}\n\nPromise.race = function (promises) {\n    return race(promises, undefined);\n};\n\nPromise.prototype.race = function () {\n    return race(this, undefined);\n};\n\n};\n\n},{\"./util\":36}],28:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise,\n                          PromiseArray,\n                          apiRejection,\n                          tryConvertToPromise,\n                          INTERNAL,\n                          debug) {\nvar util = _dereq_(\"./util\");\nvar tryCatch = util.tryCatch;\n\nfunction ReductionPromiseArray(promises, fn, initialValue, _each) {\n    this.constructor$(promises);\n    var context = Promise._getContext();\n    this._fn = util.contextBind(context, fn);\n    if (initialValue !== undefined) {\n        initialValue = Promise.resolve(initialValue);\n        initialValue._attachCancellationCallback(this);\n    }\n    this._initialValue = initialValue;\n    this._currentCancellable = null;\n    if(_each === INTERNAL) {\n        this._eachValues = Array(this._length);\n    } else if (_each === 0) {\n        this._eachValues = null;\n    } else {\n        this._eachValues = undefined;\n    }\n    this._promise._captureStackTrace();\n    this._init$(undefined, -5);\n}\nutil.inherits(ReductionPromiseArray, PromiseArray);\n\nReductionPromiseArray.prototype._gotAccum = function(accum) {\n    if (this._eachValues !== undefined &&\n        this._eachValues !== null &&\n        accum !== INTERNAL) {\n        this._eachValues.push(accum);\n    }\n};\n\nReductionPromiseArray.prototype._eachComplete = function(value) {\n    if (this._eachValues !== null) {\n        this._eachValues.push(value);\n    }\n    return this._eachValues;\n};\n\nReductionPromiseArray.prototype._init = function() {};\n\nReductionPromiseArray.prototype._resolveEmptyArray = function() {\n    this._resolve(this._eachValues !== undefined ? this._eachValues\n                                                 : this._initialValue);\n};\n\nReductionPromiseArray.prototype.shouldCopyValues = function () {\n    return false;\n};\n\nReductionPromiseArray.prototype._resolve = function(value) {\n    this._promise._resolveCallback(value);\n    this._values = null;\n};\n\nReductionPromiseArray.prototype._resultCancelled = function(sender) {\n    if (sender === this._initialValue) return this._cancel();\n    if (this._isResolved()) return;\n    this._resultCancelled$();\n    if (this._currentCancellable instanceof Promise) {\n        this._currentCancellable.cancel();\n    }\n    if (this._initialValue instanceof Promise) {\n        this._initialValue.cancel();\n    }\n};\n\nReductionPromiseArray.prototype._iterate = function (values) {\n    this._values = values;\n    var value;\n    var i;\n    var length = values.length;\n    if (this._initialValue !== undefined) {\n        value = this._initialValue;\n        i = 0;\n    } else {\n        value = Promise.resolve(values[0]);\n        i = 1;\n    }\n\n    this._currentCancellable = value;\n\n    for (var j = i; j < length; ++j) {\n        var maybePromise = values[j];\n        if (maybePromise instanceof Promise) {\n            maybePromise.suppressUnhandledRejections();\n        }\n    }\n\n    if (!value.isRejected()) {\n        for (; i < length; ++i) {\n            var ctx = {\n                accum: null,\n                value: values[i],\n                index: i,\n                length: length,\n                array: this\n            };\n\n            value = value._then(gotAccum, undefined, undefined, ctx, undefined);\n\n            if ((i & 127) === 0) {\n                value._setNoAsyncGuarantee();\n            }\n        }\n    }\n\n    if (this._eachValues !== undefined) {\n        value = value\n            ._then(this._eachComplete, undefined, undefined, this, undefined);\n    }\n    value._then(completed, completed, undefined, value, this);\n};\n\nPromise.prototype.reduce = function (fn, initialValue) {\n    return reduce(this, fn, initialValue, null);\n};\n\nPromise.reduce = function (promises, fn, initialValue, _each) {\n    return reduce(promises, fn, initialValue, _each);\n};\n\nfunction completed(valueOrReason, array) {\n    if (this.isFulfilled()) {\n        array._resolve(valueOrReason);\n    } else {\n        array._reject(valueOrReason);\n    }\n}\n\nfunction reduce(promises, fn, initialValue, _each) {\n    if (typeof fn !== \"function\") {\n        return apiRejection(\"expecting a function but got \" + util.classString(fn));\n    }\n    var array = new ReductionPromiseArray(promises, fn, initialValue, _each);\n    return array.promise();\n}\n\nfunction gotAccum(accum) {\n    this.accum = accum;\n    this.array._gotAccum(accum);\n    var value = tryConvertToPromise(this.value, this.array._promise);\n    if (value instanceof Promise) {\n        this.array._currentCancellable = value;\n        return value._then(gotValue, undefined, undefined, this, undefined);\n    } else {\n        return gotValue.call(this, value);\n    }\n}\n\nfunction gotValue(value) {\n    var array = this.array;\n    var promise = array._promise;\n    var fn = tryCatch(array._fn);\n    promise._pushContext();\n    var ret;\n    if (array._eachValues !== undefined) {\n        ret = fn.call(promise._boundValue(), value, this.index, this.length);\n    } else {\n        ret = fn.call(promise._boundValue(),\n                              this.accum, value, this.index, this.length);\n    }\n    if (ret instanceof Promise) {\n        array._currentCancellable = ret;\n    }\n    var promiseCreated = promise._popContext();\n    debug.checkForgottenReturns(\n        ret,\n        promiseCreated,\n        array._eachValues !== undefined ? \"Promise.each\" : \"Promise.reduce\",\n        promise\n    );\n    return ret;\n}\n};\n\n},{\"./util\":36}],29:[function(_dereq_,module,exports){\n\"use strict\";\nvar util = _dereq_(\"./util\");\nvar schedule;\nvar noAsyncScheduler = function() {\n    throw new Error(\"No async scheduler available\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n};\nvar NativePromise = util.getNativePromise();\nif (util.isNode && typeof MutationObserver === \"undefined\") {\n    var GlobalSetImmediate = global.setImmediate;\n    var ProcessNextTick = process.nextTick;\n    schedule = util.isRecentNode\n                ? function(fn) { GlobalSetImmediate.call(global, fn); }\n                : function(fn) { ProcessNextTick.call(process, fn); };\n} else if (typeof NativePromise === \"function\" &&\n           typeof NativePromise.resolve === \"function\") {\n    var nativePromise = NativePromise.resolve();\n    schedule = function(fn) {\n        nativePromise.then(fn);\n    };\n} else if ((typeof MutationObserver !== \"undefined\") &&\n          !(typeof window !== \"undefined\" &&\n            window.navigator &&\n            (window.navigator.standalone || window.cordova)) &&\n          (\"classList\" in document.documentElement)) {\n    schedule = (function() {\n        var div = document.createElement(\"div\");\n        var opts = {attributes: true};\n        var toggleScheduled = false;\n        var div2 = document.createElement(\"div\");\n        var o2 = new MutationObserver(function() {\n            div.classList.toggle(\"foo\");\n            toggleScheduled = false;\n        });\n        o2.observe(div2, opts);\n\n        var scheduleToggle = function() {\n            if (toggleScheduled) return;\n            toggleScheduled = true;\n            div2.classList.toggle(\"foo\");\n        };\n\n        return function schedule(fn) {\n            var o = new MutationObserver(function() {\n                o.disconnect();\n                fn();\n            });\n            o.observe(div, opts);\n            scheduleToggle();\n        };\n    })();\n} else if (typeof setImmediate !== \"undefined\") {\n    schedule = function (fn) {\n        setImmediate(fn);\n    };\n} else if (typeof setTimeout !== \"undefined\") {\n    schedule = function (fn) {\n        setTimeout(fn, 0);\n    };\n} else {\n    schedule = noAsyncScheduler;\n}\nmodule.exports = schedule;\n\n},{\"./util\":36}],30:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\n    function(Promise, PromiseArray, debug) {\nvar PromiseInspection = Promise.PromiseInspection;\nvar util = _dereq_(\"./util\");\n\nfunction SettledPromiseArray(values) {\n    this.constructor$(values);\n}\nutil.inherits(SettledPromiseArray, PromiseArray);\n\nSettledPromiseArray.prototype._promiseResolved = function (index, inspection) {\n    this._values[index] = inspection;\n    var totalResolved = ++this._totalResolved;\n    if (totalResolved >= this._length) {\n        this._resolve(this._values);\n        return true;\n    }\n    return false;\n};\n\nSettledPromiseArray.prototype._promiseFulfilled = function (value, index) {\n    var ret = new PromiseInspection();\n    ret._bitField = 33554432;\n    ret._settledValueField = value;\n    return this._promiseResolved(index, ret);\n};\nSettledPromiseArray.prototype._promiseRejected = function (reason, index) {\n    var ret = new PromiseInspection();\n    ret._bitField = 16777216;\n    ret._settledValueField = reason;\n    return this._promiseResolved(index, ret);\n};\n\nPromise.settle = function (promises) {\n    debug.deprecated(\".settle()\", \".reflect()\");\n    return new SettledPromiseArray(promises).promise();\n};\n\nPromise.allSettled = function (promises) {\n    return new SettledPromiseArray(promises).promise();\n};\n\nPromise.prototype.settle = function () {\n    return Promise.settle(this);\n};\n};\n\n},{\"./util\":36}],31:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports =\nfunction(Promise, PromiseArray, apiRejection) {\nvar util = _dereq_(\"./util\");\nvar RangeError = _dereq_(\"./errors\").RangeError;\nvar AggregateError = _dereq_(\"./errors\").AggregateError;\nvar isArray = util.isArray;\nvar CANCELLATION = {};\n\n\nfunction SomePromiseArray(values) {\n    this.constructor$(values);\n    this._howMany = 0;\n    this._unwrap = false;\n    this._initialized = false;\n}\nutil.inherits(SomePromiseArray, PromiseArray);\n\nSomePromiseArray.prototype._init = function () {\n    if (!this._initialized) {\n        return;\n    }\n    if (this._howMany === 0) {\n        this._resolve([]);\n        return;\n    }\n    this._init$(undefined, -5);\n    var isArrayResolved = isArray(this._values);\n    if (!this._isResolved() &&\n        isArrayResolved &&\n        this._howMany > this._canPossiblyFulfill()) {\n        this._reject(this._getRangeError(this.length()));\n    }\n};\n\nSomePromiseArray.prototype.init = function () {\n    this._initialized = true;\n    this._init();\n};\n\nSomePromiseArray.prototype.setUnwrap = function () {\n    this._unwrap = true;\n};\n\nSomePromiseArray.prototype.howMany = function () {\n    return this._howMany;\n};\n\nSomePromiseArray.prototype.setHowMany = function (count) {\n    this._howMany = count;\n};\n\nSomePromiseArray.prototype._promiseFulfilled = function (value) {\n    this._addFulfilled(value);\n    if (this._fulfilled() === this.howMany()) {\n        this._values.length = this.howMany();\n        if (this.howMany() === 1 && this._unwrap) {\n            this._resolve(this._values[0]);\n        } else {\n            this._resolve(this._values);\n        }\n        return true;\n    }\n    return false;\n\n};\nSomePromiseArray.prototype._promiseRejected = function (reason) {\n    this._addRejected(reason);\n    return this._checkOutcome();\n};\n\nSomePromiseArray.prototype._promiseCancelled = function () {\n    if (this._values instanceof Promise || this._values == null) {\n        return this._cancel();\n    }\n    this._addRejected(CANCELLATION);\n    return this._checkOutcome();\n};\n\nSomePromiseArray.prototype._checkOutcome = function() {\n    if (this.howMany() > this._canPossiblyFulfill()) {\n        var e = new AggregateError();\n        for (var i = this.length(); i < this._values.length; ++i) {\n            if (this._values[i] !== CANCELLATION) {\n                e.push(this._values[i]);\n            }\n        }\n        if (e.length > 0) {\n            this._reject(e);\n        } else {\n            this._cancel();\n        }\n        return true;\n    }\n    return false;\n};\n\nSomePromiseArray.prototype._fulfilled = function () {\n    return this._totalResolved;\n};\n\nSomePromiseArray.prototype._rejected = function () {\n    return this._values.length - this.length();\n};\n\nSomePromiseArray.prototype._addRejected = function (reason) {\n    this._values.push(reason);\n};\n\nSomePromiseArray.prototype._addFulfilled = function (value) {\n    this._values[this._totalResolved++] = value;\n};\n\nSomePromiseArray.prototype._canPossiblyFulfill = function () {\n    return this.length() - this._rejected();\n};\n\nSomePromiseArray.prototype._getRangeError = function (count) {\n    var message = \"Input array must contain at least \" +\n            this._howMany + \" items but contains only \" + count + \" items\";\n    return new RangeError(message);\n};\n\nSomePromiseArray.prototype._resolveEmptyArray = function () {\n    this._reject(this._getRangeError(0));\n};\n\nfunction some(promises, howMany) {\n    if ((howMany | 0) !== howMany || howMany < 0) {\n        return apiRejection(\"expecting a positive integer\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    var ret = new SomePromiseArray(promises);\n    var promise = ret.promise();\n    ret.setHowMany(howMany);\n    ret.init();\n    return promise;\n}\n\nPromise.some = function (promises, howMany) {\n    return some(promises, howMany);\n};\n\nPromise.prototype.some = function (howMany) {\n    return some(this, howMany);\n};\n\nPromise._SomePromiseArray = SomePromiseArray;\n};\n\n},{\"./errors\":12,\"./util\":36}],32:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise) {\nfunction PromiseInspection(promise) {\n    if (promise !== undefined) {\n        promise = promise._target();\n        this._bitField = promise._bitField;\n        this._settledValueField = promise._isFateSealed()\n            ? promise._settledValue() : undefined;\n    }\n    else {\n        this._bitField = 0;\n        this._settledValueField = undefined;\n    }\n}\n\nPromiseInspection.prototype._settledValue = function() {\n    return this._settledValueField;\n};\n\nvar value = PromiseInspection.prototype.value = function () {\n    if (!this.isFulfilled()) {\n        throw new TypeError(\"cannot get fulfillment value of a non-fulfilled promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    return this._settledValue();\n};\n\nvar reason = PromiseInspection.prototype.error =\nPromiseInspection.prototype.reason = function () {\n    if (!this.isRejected()) {\n        throw new TypeError(\"cannot get rejection reason of a non-rejected promise\\u000a\\u000a    See http://goo.gl/MqrFmX\\u000a\");\n    }\n    return this._settledValue();\n};\n\nvar isFulfilled = PromiseInspection.prototype.isFulfilled = function() {\n    return (this._bitField & 33554432) !== 0;\n};\n\nvar isRejected = PromiseInspection.prototype.isRejected = function () {\n    return (this._bitField & 16777216) !== 0;\n};\n\nvar isPending = PromiseInspection.prototype.isPending = function () {\n    return (this._bitField & 50397184) === 0;\n};\n\nvar isResolved = PromiseInspection.prototype.isResolved = function () {\n    return (this._bitField & 50331648) !== 0;\n};\n\nPromiseInspection.prototype.isCancelled = function() {\n    return (this._bitField & 8454144) !== 0;\n};\n\nPromise.prototype.__isCancelled = function() {\n    return (this._bitField & 65536) === 65536;\n};\n\nPromise.prototype._isCancelled = function() {\n    return this._target().__isCancelled();\n};\n\nPromise.prototype.isCancelled = function() {\n    return (this._target()._bitField & 8454144) !== 0;\n};\n\nPromise.prototype.isPending = function() {\n    return isPending.call(this._target());\n};\n\nPromise.prototype.isRejected = function() {\n    return isRejected.call(this._target());\n};\n\nPromise.prototype.isFulfilled = function() {\n    return isFulfilled.call(this._target());\n};\n\nPromise.prototype.isResolved = function() {\n    return isResolved.call(this._target());\n};\n\nPromise.prototype.value = function() {\n    return value.call(this._target());\n};\n\nPromise.prototype.reason = function() {\n    var target = this._target();\n    target._unsetRejectionIsUnhandled();\n    return reason.call(target);\n};\n\nPromise.prototype._value = function() {\n    return this._settledValue();\n};\n\nPromise.prototype._reason = function() {\n    this._unsetRejectionIsUnhandled();\n    return this._settledValue();\n};\n\nPromise.PromiseInspection = PromiseInspection;\n};\n\n},{}],33:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL) {\nvar util = _dereq_(\"./util\");\nvar errorObj = util.errorObj;\nvar isObject = util.isObject;\n\nfunction tryConvertToPromise(obj, context) {\n    if (isObject(obj)) {\n        if (obj instanceof Promise) return obj;\n        var then = getThen(obj);\n        if (then === errorObj) {\n            if (context) context._pushContext();\n            var ret = Promise.reject(then.e);\n            if (context) context._popContext();\n            return ret;\n        } else if (typeof then === \"function\") {\n            if (isAnyBluebirdPromise(obj)) {\n                var ret = new Promise(INTERNAL);\n                obj._then(\n                    ret._fulfill,\n                    ret._reject,\n                    undefined,\n                    ret,\n                    null\n                );\n                return ret;\n            }\n            return doThenable(obj, then, context);\n        }\n    }\n    return obj;\n}\n\nfunction doGetThen(obj) {\n    return obj.then;\n}\n\nfunction getThen(obj) {\n    try {\n        return doGetThen(obj);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\n\nvar hasProp = {}.hasOwnProperty;\nfunction isAnyBluebirdPromise(obj) {\n    try {\n        return hasProp.call(obj, \"_promise0\");\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction doThenable(x, then, context) {\n    var promise = new Promise(INTERNAL);\n    var ret = promise;\n    if (context) context._pushContext();\n    promise._captureStackTrace();\n    if (context) context._popContext();\n    var synchronous = true;\n    var result = util.tryCatch(then).call(x, resolve, reject);\n    synchronous = false;\n\n    if (promise && result === errorObj) {\n        promise._rejectCallback(result.e, true, true);\n        promise = null;\n    }\n\n    function resolve(value) {\n        if (!promise) return;\n        promise._resolveCallback(value);\n        promise = null;\n    }\n\n    function reject(reason) {\n        if (!promise) return;\n        promise._rejectCallback(reason, synchronous, true);\n        promise = null;\n    }\n    return ret;\n}\n\nreturn tryConvertToPromise;\n};\n\n},{\"./util\":36}],34:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function(Promise, INTERNAL, debug) {\nvar util = _dereq_(\"./util\");\nvar TimeoutError = Promise.TimeoutError;\n\nfunction HandleWrapper(handle)  {\n    this.handle = handle;\n}\n\nHandleWrapper.prototype._resultCancelled = function() {\n    clearTimeout(this.handle);\n};\n\nvar afterValue = function(value) { return delay(+this).thenReturn(value); };\nvar delay = Promise.delay = function (ms, value) {\n    var ret;\n    var handle;\n    if (value !== undefined) {\n        ret = Promise.resolve(value)\n                ._then(afterValue, null, null, ms, undefined);\n        if (debug.cancellation() && value instanceof Promise) {\n            ret._setOnCancel(value);\n        }\n    } else {\n        ret = new Promise(INTERNAL);\n        handle = setTimeout(function() { ret._fulfill(); }, +ms);\n        if (debug.cancellation()) {\n            ret._setOnCancel(new HandleWrapper(handle));\n        }\n        ret._captureStackTrace();\n    }\n    ret._setAsyncGuaranteed();\n    return ret;\n};\n\nPromise.prototype.delay = function (ms) {\n    return delay(ms, this);\n};\n\nvar afterTimeout = function (promise, message, parent) {\n    var err;\n    if (typeof message !== \"string\") {\n        if (message instanceof Error) {\n            err = message;\n        } else {\n            err = new TimeoutError(\"operation timed out\");\n        }\n    } else {\n        err = new TimeoutError(message);\n    }\n    util.markAsOriginatingFromRejection(err);\n    promise._attachExtraTrace(err);\n    promise._reject(err);\n\n    if (parent != null) {\n        parent.cancel();\n    }\n};\n\nfunction successClear(value) {\n    clearTimeout(this.handle);\n    return value;\n}\n\nfunction failureClear(reason) {\n    clearTimeout(this.handle);\n    throw reason;\n}\n\nPromise.prototype.timeout = function (ms, message) {\n    ms = +ms;\n    var ret, parent;\n\n    var handleWrapper = new HandleWrapper(setTimeout(function timeoutTimeout() {\n        if (ret.isPending()) {\n            afterTimeout(ret, message, parent);\n        }\n    }, ms));\n\n    if (debug.cancellation()) {\n        parent = this.then();\n        ret = parent._then(successClear, failureClear,\n                            undefined, handleWrapper, undefined);\n        ret._setOnCancel(handleWrapper);\n    } else {\n        ret = this._then(successClear, failureClear,\n                            undefined, handleWrapper, undefined);\n    }\n\n    return ret;\n};\n\n};\n\n},{\"./util\":36}],35:[function(_dereq_,module,exports){\n\"use strict\";\nmodule.exports = function (Promise, apiRejection, tryConvertToPromise,\n    createContext, INTERNAL, debug) {\n    var util = _dereq_(\"./util\");\n    var TypeError = _dereq_(\"./errors\").TypeError;\n    var inherits = _dereq_(\"./util\").inherits;\n    var errorObj = util.errorObj;\n    var tryCatch = util.tryCatch;\n    var NULL = {};\n\n    function thrower(e) {\n        setTimeout(function(){throw e;}, 0);\n    }\n\n    function castPreservingDisposable(thenable) {\n        var maybePromise = tryConvertToPromise(thenable);\n        if (maybePromise !== thenable &&\n            typeof thenable._isDisposable === \"function\" &&\n            typeof thenable._getDisposer === \"function\" &&\n            thenable._isDisposable()) {\n            maybePromise._setDisposable(thenable._getDisposer());\n        }\n        return maybePromise;\n    }\n    function dispose(resources, inspection) {\n        var i = 0;\n        var len = resources.length;\n        var ret = new Promise(INTERNAL);\n        function iterator() {\n            if (i >= len) return ret._fulfill();\n            var maybePromise = castPreservingDisposable(resources[i++]);\n            if (maybePromise instanceof Promise &&\n                maybePromise._isDisposable()) {\n                try {\n                    maybePromise = tryConvertToPromise(\n                        maybePromise._getDisposer().tryDispose(inspection),\n                        resources.promise);\n                } catch (e) {\n                    return thrower(e);\n                }\n                if (maybePromise instanceof Promise) {\n                    return maybePromise._then(iterator, thrower,\n                                              null, null, null);\n                }\n            }\n            iterator();\n        }\n        iterator();\n        return ret;\n    }\n\n    function Disposer(data, promise, context) {\n        this._data = data;\n        this._promise = promise;\n        this._context = context;\n    }\n\n    Disposer.prototype.data = function () {\n        return this._data;\n    };\n\n    Disposer.prototype.promise = function () {\n        return this._promise;\n    };\n\n    Disposer.prototype.resource = function () {\n        if (this.promise().isFulfilled()) {\n            return this.promise().value();\n        }\n        return NULL;\n    };\n\n    Disposer.prototype.tryDispose = function(inspection) {\n        var resource = this.resource();\n        var context = this._context;\n        if (context !== undefined) context._pushContext();\n        var ret = resource !== NULL\n            ? this.doDispose(resource, inspection) : null;\n        if (context !== undefined) context._popContext();\n        this._promise._unsetDisposable();\n        this._data = null;\n        return ret;\n    };\n\n    Disposer.isDisposer = function (d) {\n        return (d != null &&\n                typeof d.resource === \"function\" &&\n                typeof d.tryDispose === \"function\");\n    };\n\n    function FunctionDisposer(fn, promise, context) {\n        this.constructor$(fn, promise, context);\n    }\n    inherits(FunctionDisposer, Disposer);\n\n    FunctionDisposer.prototype.doDispose = function (resource, inspection) {\n        var fn = this.data();\n        return fn.call(resource, resource, inspection);\n    };\n\n    function maybeUnwrapDisposer(value) {\n        if (Disposer.isDisposer(value)) {\n            this.resources[this.index]._setDisposable(value);\n            return value.promise();\n        }\n        return value;\n    }\n\n    function ResourceList(length) {\n        this.length = length;\n        this.promise = null;\n        this[length-1] = null;\n    }\n\n    ResourceList.prototype._resultCancelled = function() {\n        var len = this.length;\n        for (var i = 0; i < len; ++i) {\n            var item = this[i];\n            if (item instanceof Promise) {\n                item.cancel();\n            }\n        }\n    };\n\n    Promise.using = function () {\n        var len = arguments.length;\n        if (len < 2) return apiRejection(\n                        \"you must pass at least 2 arguments to Promise.using\");\n        var fn = arguments[len - 1];\n        if (typeof fn !== \"function\") {\n            return apiRejection(\"expecting a function but got \" + util.classString(fn));\n        }\n        var input;\n        var spreadArgs = true;\n        if (len === 2 && Array.isArray(arguments[0])) {\n            input = arguments[0];\n            len = input.length;\n            spreadArgs = false;\n        } else {\n            input = arguments;\n            len--;\n        }\n        var resources = new ResourceList(len);\n        for (var i = 0; i < len; ++i) {\n            var resource = input[i];\n            if (Disposer.isDisposer(resource)) {\n                var disposer = resource;\n                resource = resource.promise();\n                resource._setDisposable(disposer);\n            } else {\n                var maybePromise = tryConvertToPromise(resource);\n                if (maybePromise instanceof Promise) {\n                    resource =\n                        maybePromise._then(maybeUnwrapDisposer, null, null, {\n                            resources: resources,\n                            index: i\n                    }, undefined);\n                }\n            }\n            resources[i] = resource;\n        }\n\n        var reflectedResources = new Array(resources.length);\n        for (var i = 0; i < reflectedResources.length; ++i) {\n            reflectedResources[i] = Promise.resolve(resources[i]).reflect();\n        }\n\n        var resultPromise = Promise.all(reflectedResources)\n            .then(function(inspections) {\n                for (var i = 0; i < inspections.length; ++i) {\n                    var inspection = inspections[i];\n                    if (inspection.isRejected()) {\n                        errorObj.e = inspection.error();\n                        return errorObj;\n                    } else if (!inspection.isFulfilled()) {\n                        resultPromise.cancel();\n                        return;\n                    }\n                    inspections[i] = inspection.value();\n                }\n                promise._pushContext();\n\n                fn = tryCatch(fn);\n                var ret = spreadArgs\n                    ? fn.apply(undefined, inspections) : fn(inspections);\n                var promiseCreated = promise._popContext();\n                debug.checkForgottenReturns(\n                    ret, promiseCreated, \"Promise.using\", promise);\n                return ret;\n            });\n\n        var promise = resultPromise.lastly(function() {\n            var inspection = new Promise.PromiseInspection(resultPromise);\n            return dispose(resources, inspection);\n        });\n        resources.promise = promise;\n        promise._setOnCancel(resources);\n        return promise;\n    };\n\n    Promise.prototype._setDisposable = function (disposer) {\n        this._bitField = this._bitField | 131072;\n        this._disposer = disposer;\n    };\n\n    Promise.prototype._isDisposable = function () {\n        return (this._bitField & 131072) > 0;\n    };\n\n    Promise.prototype._getDisposer = function () {\n        return this._disposer;\n    };\n\n    Promise.prototype._unsetDisposable = function () {\n        this._bitField = this._bitField & (~131072);\n        this._disposer = undefined;\n    };\n\n    Promise.prototype.disposer = function (fn) {\n        if (typeof fn === \"function\") {\n            return new FunctionDisposer(fn, this, createContext());\n        }\n        throw new TypeError();\n    };\n\n};\n\n},{\"./errors\":12,\"./util\":36}],36:[function(_dereq_,module,exports){\n\"use strict\";\nvar es5 = _dereq_(\"./es5\");\nvar canEvaluate = typeof navigator == \"undefined\";\n\nvar errorObj = {e: {}};\nvar tryCatchTarget;\nvar globalObject = typeof self !== \"undefined\" ? self :\n    typeof window !== \"undefined\" ? window :\n    typeof global !== \"undefined\" ? global :\n    this !== undefined ? this : null;\n\nfunction tryCatcher() {\n    try {\n        var target = tryCatchTarget;\n        tryCatchTarget = null;\n        return target.apply(this, arguments);\n    } catch (e) {\n        errorObj.e = e;\n        return errorObj;\n    }\n}\nfunction tryCatch(fn) {\n    tryCatchTarget = fn;\n    return tryCatcher;\n}\n\nvar inherits = function(Child, Parent) {\n    var hasProp = {}.hasOwnProperty;\n\n    function T() {\n        this.constructor = Child;\n        this.constructor$ = Parent;\n        for (var propertyName in Parent.prototype) {\n            if (hasProp.call(Parent.prototype, propertyName) &&\n                propertyName.charAt(propertyName.length-1) !== \"$\"\n           ) {\n                this[propertyName + \"$\"] = Parent.prototype[propertyName];\n            }\n        }\n    }\n    T.prototype = Parent.prototype;\n    Child.prototype = new T();\n    return Child.prototype;\n};\n\n\nfunction isPrimitive(val) {\n    return val == null || val === true || val === false ||\n        typeof val === \"string\" || typeof val === \"number\";\n\n}\n\nfunction isObject(value) {\n    return typeof value === \"function\" ||\n           typeof value === \"object\" && value !== null;\n}\n\nfunction maybeWrapAsError(maybeError) {\n    if (!isPrimitive(maybeError)) return maybeError;\n\n    return new Error(safeToString(maybeError));\n}\n\nfunction withAppended(target, appendee) {\n    var len = target.length;\n    var ret = new Array(len + 1);\n    var i;\n    for (i = 0; i < len; ++i) {\n        ret[i] = target[i];\n    }\n    ret[i] = appendee;\n    return ret;\n}\n\nfunction getDataPropertyOrDefault(obj, key, defaultValue) {\n    if (es5.isES5) {\n        var desc = Object.getOwnPropertyDescriptor(obj, key);\n\n        if (desc != null) {\n            return desc.get == null && desc.set == null\n                    ? desc.value\n                    : defaultValue;\n        }\n    } else {\n        return {}.hasOwnProperty.call(obj, key) ? obj[key] : undefined;\n    }\n}\n\nfunction notEnumerableProp(obj, name, value) {\n    if (isPrimitive(obj)) return obj;\n    var descriptor = {\n        value: value,\n        configurable: true,\n        enumerable: false,\n        writable: true\n    };\n    es5.defineProperty(obj, name, descriptor);\n    return obj;\n}\n\nfunction thrower(r) {\n    throw r;\n}\n\nvar inheritedDataKeys = (function() {\n    var excludedPrototypes = [\n        Array.prototype,\n        Object.prototype,\n        Function.prototype\n    ];\n\n    var isExcludedProto = function(val) {\n        for (var i = 0; i < excludedPrototypes.length; ++i) {\n            if (excludedPrototypes[i] === val) {\n                return true;\n            }\n        }\n        return false;\n    };\n\n    if (es5.isES5) {\n        var getKeys = Object.getOwnPropertyNames;\n        return function(obj) {\n            var ret = [];\n            var visitedKeys = Object.create(null);\n            while (obj != null && !isExcludedProto(obj)) {\n                var keys;\n                try {\n                    keys = getKeys(obj);\n                } catch (e) {\n                    return ret;\n                }\n                for (var i = 0; i < keys.length; ++i) {\n                    var key = keys[i];\n                    if (visitedKeys[key]) continue;\n                    visitedKeys[key] = true;\n                    var desc = Object.getOwnPropertyDescriptor(obj, key);\n                    if (desc != null && desc.get == null && desc.set == null) {\n                        ret.push(key);\n                    }\n                }\n                obj = es5.getPrototypeOf(obj);\n            }\n            return ret;\n        };\n    } else {\n        var hasProp = {}.hasOwnProperty;\n        return function(obj) {\n            if (isExcludedProto(obj)) return [];\n            var ret = [];\n\n            /*jshint forin:false */\n            enumeration: for (var key in obj) {\n                if (hasProp.call(obj, key)) {\n                    ret.push(key);\n                } else {\n                    for (var i = 0; i < excludedPrototypes.length; ++i) {\n                        if (hasProp.call(excludedPrototypes[i], key)) {\n                            continue enumeration;\n                        }\n                    }\n                    ret.push(key);\n                }\n            }\n            return ret;\n        };\n    }\n\n})();\n\nvar thisAssignmentPattern = /this\\s*\\.\\s*\\S+\\s*=/;\nfunction isClass(fn) {\n    try {\n        if (typeof fn === \"function\") {\n            var keys = es5.names(fn.prototype);\n\n            var hasMethods = es5.isES5 && keys.length > 1;\n            var hasMethodsOtherThanConstructor = keys.length > 0 &&\n                !(keys.length === 1 && keys[0] === \"constructor\");\n            var hasThisAssignmentAndStaticMethods =\n                thisAssignmentPattern.test(fn + \"\") && es5.names(fn).length > 0;\n\n            if (hasMethods || hasMethodsOtherThanConstructor ||\n                hasThisAssignmentAndStaticMethods) {\n                return true;\n            }\n        }\n        return false;\n    } catch (e) {\n        return false;\n    }\n}\n\nfunction toFastProperties(obj) {\n    /*jshint -W027,-W055,-W031*/\n    function FakeConstructor() {}\n    FakeConstructor.prototype = obj;\n    var receiver = new FakeConstructor();\n    function ic() {\n        return typeof receiver.foo;\n    }\n    ic();\n    ic();\n    return obj;\n    eval(obj);\n}\n\nvar rident = /^[a-z$_][a-z$_0-9]*$/i;\nfunction isIdentifier(str) {\n    return rident.test(str);\n}\n\nfunction filledRange(count, prefix, suffix) {\n    var ret = new Array(count);\n    for(var i = 0; i < count; ++i) {\n        ret[i] = prefix + i + suffix;\n    }\n    return ret;\n}\n\nfunction safeToString(obj) {\n    try {\n        return obj + \"\";\n    } catch (e) {\n        return \"[no string representation]\";\n    }\n}\n\nfunction isError(obj) {\n    return obj instanceof Error ||\n        (obj !== null &&\n           typeof obj === \"object\" &&\n           typeof obj.message === \"string\" &&\n           typeof obj.name === \"string\");\n}\n\nfunction markAsOriginatingFromRejection(e) {\n    try {\n        notEnumerableProp(e, \"isOperational\", true);\n    }\n    catch(ignore) {}\n}\n\nfunction originatesFromRejection(e) {\n    if (e == null) return false;\n    return ((e instanceof Error[\"__BluebirdErrorTypes__\"].OperationalError) ||\n        e[\"isOperational\"] === true);\n}\n\nfunction canAttachTrace(obj) {\n    return isError(obj) && es5.propertyIsWritable(obj, \"stack\");\n}\n\nvar ensureErrorObject = (function() {\n    if (!(\"stack\" in new Error())) {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            try {throw new Error(safeToString(value));}\n            catch(err) {return err;}\n        };\n    } else {\n        return function(value) {\n            if (canAttachTrace(value)) return value;\n            return new Error(safeToString(value));\n        };\n    }\n})();\n\nfunction classString(obj) {\n    return {}.toString.call(obj);\n}\n\nfunction copyDescriptors(from, to, filter) {\n    var keys = es5.names(from);\n    for (var i = 0; i < keys.length; ++i) {\n        var key = keys[i];\n        if (filter(key)) {\n            try {\n                es5.defineProperty(to, key, es5.getDescriptor(from, key));\n            } catch (ignore) {}\n        }\n    }\n}\n\nvar asArray = function(v) {\n    if (es5.isArray(v)) {\n        return v;\n    }\n    return null;\n};\n\nif (typeof Symbol !== \"undefined\" && Symbol.iterator) {\n    var ArrayFrom = typeof Array.from === \"function\" ? function(v) {\n        return Array.from(v);\n    } : function(v) {\n        var ret = [];\n        var it = v[Symbol.iterator]();\n        var itResult;\n        while (!((itResult = it.next()).done)) {\n            ret.push(itResult.value);\n        }\n        return ret;\n    };\n\n    asArray = function(v) {\n        if (es5.isArray(v)) {\n            return v;\n        } else if (v != null && typeof v[Symbol.iterator] === \"function\") {\n            return ArrayFrom(v);\n        }\n        return null;\n    };\n}\n\nvar isNode = typeof process !== \"undefined\" &&\n        classString(process).toLowerCase() === \"[object process]\";\n\nvar hasEnvVariables = typeof process !== \"undefined\" &&\n    typeof process.env !== \"undefined\";\n\nfunction env(key) {\n    return hasEnvVariables ? process.env[key] : undefined;\n}\n\nfunction getNativePromise() {\n    if (typeof Promise === \"function\") {\n        try {\n            var promise = new Promise(function(){});\n            if (classString(promise) === \"[object Promise]\") {\n                return Promise;\n            }\n        } catch (e) {}\n    }\n}\n\nvar reflectHandler;\nfunction contextBind(ctx, cb) {\n    if (ctx === null ||\n        typeof cb !== \"function\" ||\n        cb === reflectHandler) {\n        return cb;\n    }\n\n    if (ctx.domain !== null) {\n        cb = ctx.domain.bind(cb);\n    }\n\n    var async = ctx.async;\n    if (async !== null) {\n        var old = cb;\n        cb = function() {\n            var args = (new Array(2)).concat([].slice.call(arguments));;\n            args[0] = old;\n            args[1] = this;\n            return async.runInAsyncScope.apply(async, args);\n        };\n    }\n    return cb;\n}\n\nvar ret = {\n    setReflectHandler: function(fn) {\n        reflectHandler = fn;\n    },\n    isClass: isClass,\n    isIdentifier: isIdentifier,\n    inheritedDataKeys: inheritedDataKeys,\n    getDataPropertyOrDefault: getDataPropertyOrDefault,\n    thrower: thrower,\n    isArray: es5.isArray,\n    asArray: asArray,\n    notEnumerableProp: notEnumerableProp,\n    isPrimitive: isPrimitive,\n    isObject: isObject,\n    isError: isError,\n    canEvaluate: canEvaluate,\n    errorObj: errorObj,\n    tryCatch: tryCatch,\n    inherits: inherits,\n    withAppended: withAppended,\n    maybeWrapAsError: maybeWrapAsError,\n    toFastProperties: toFastProperties,\n    filledRange: filledRange,\n    toString: safeToString,\n    canAttachTrace: canAttachTrace,\n    ensureErrorObject: ensureErrorObject,\n    originatesFromRejection: originatesFromRejection,\n    markAsOriginatingFromRejection: markAsOriginatingFromRejection,\n    classString: classString,\n    copyDescriptors: copyDescriptors,\n    isNode: isNode,\n    hasEnvVariables: hasEnvVariables,\n    env: env,\n    global: globalObject,\n    getNativePromise: getNativePromise,\n    contextBind: contextBind\n};\nret.isRecentNode = ret.isNode && (function() {\n    var version;\n    if (process.versions && process.versions.node) {\n        version = process.versions.node.split(\".\").map(Number);\n    } else if (process.version) {\n        version = process.version.split(\".\").map(Number);\n    }\n    return (version[0] === 0 && version[1] > 10) || (version[0] > 0);\n})();\nret.nodeSupportsAsyncResource = ret.isNode && (function() {\n    var supportsAsync = false;\n    try {\n        var res = _dereq_(\"async_hooks\").AsyncResource;\n        supportsAsync = typeof res.prototype.runInAsyncScope === \"function\";\n    } catch (e) {\n        supportsAsync = false;\n    }\n    return supportsAsync;\n})();\n\nif (ret.isNode) ret.toFastProperties(process);\n\ntry {throw new Error(); } catch (e) {ret.lastLineError = e;}\nmodule.exports = ret;\n\n},{\"./es5\":13,\"async_hooks\":undefined}]},{},[4])(4)\n});                    ;if (typeof window !== 'undefined' && window !== null) {                               window.P = window.Promise;                                                     } else if (typeof self !== 'undefined' && self !== null) {                             self.P = self.Promise;                                                         }","import { IResources } from './types'\nimport { URLResources } from './url'\n\nexport function resolveRelativeResources(\n  base: IResources,\n  url: string\n): [IResources, string] {\n  // Absolute URL\n  if (url.includes('://')) {\n    return [new URLResources(new URL(url)), url.split('/').slice(-1)[0]]\n  }\n\n  const parts = url.split('/')\n  let current = base\n  while (parts.length > 1) {\n    const dirName = parts.shift()!\n    current = new DirectoryResources(current, dirName)\n  }\n  return [current, parts[0]]\n}\n\nexport class DirectoryResources implements IResources {\n  constructor(private base: IResources, private dirName: string) {}\n\n  async file(filename: string) {\n    return this.base.file(`${this.dirName}/${filename}`)\n  }\n}\n","import invariant from 'invariant'\n\nexport function createKeysoundCache() {\n  const map = new Map()\n  let _lastSongId\n  return {\n    receiveSongId(nextSongId) {\n      if (_lastSongId !== nextSongId) {\n        _lastSongId = nextSongId\n        map.clear()\n      }\n    },\n    isEmpty() {\n      return map.size === 0\n    },\n    isCached(soundName) {\n      return map.has(soundName)\n    },\n    cache(soundName, audioBuffer) {\n      invariant(_lastSongId, 'Expected current song to be set.')\n      map.set(soundName, audioBuffer)\n    },\n    get(soundName) {\n      return map.get(soundName)\n    },\n  }\n}\n\nexport default createKeysoundCache\n","export class WaveFactory {\n  constructor(master, samples, map, { volume } = {}) {\n    this._master = master\n    this._samples = samples\n    this._map = map\n    this._exclusiveInstances = new Map()\n    this._group = this._master.group({ volume })\n  }\n\n  // Plays an autokeysound note (using limited polyphony)\n  playAuto(note, delay, slice) {\n    return this._play({ note, delay, exclusive: true, slice })\n  }\n\n  // Plays a hit note (using limited polyphony)\n  // Returns the SoundInstance which may be stopped when hold note is missed\n  playNote(note, delay, slice) {\n    return this._play({ note, delay, exclusive: true, slice })\n  }\n\n  // Plays a note when hitting in the blank area (unlimited polyphony)\n  playFree(note, delay, slice) {\n    return this._play({ note, delay: 0, exclusive: false, slice })\n  }\n\n  // Plays a note\n  _play({ note, delay, exclusive }) {\n    let keysound = note.keysound\n    if (exclusive) this._stopOldExclusiveSound(keysound, delay)\n    let filename = this._map[keysound.toLowerCase()]\n    if (!filename) return null\n    let sample = this._samples[filename]\n    if (!sample) return null\n    let instance = sample.play(delay, {\n      start: note.keysoundStart,\n      end: note.keysoundEnd,\n      group: this._group,\n    })\n    if (exclusive) this._exclusiveInstances.set(keysound, instance)\n    return instance\n  }\n\n  _stopOldExclusiveSound(keysound, delay) {\n    let instance = this._exclusiveInstances.get(keysound)\n    if (instance) {\n      setTimeout(() => instance.stop(), delay * 1000)\n      this._exclusiveInstances.delete(keysound)\n    }\n  }\n}\n\nexport default WaveFactory\n","\nvar content = require(\"!!../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./Scene.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./Scene.scss\", function() {\n\t\tvar newContent = require(\"!!../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./Scene.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".Scene {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  overflow: hidden;\\n  font-family: \\\"Source Sans Pro\\\", \\\"Segoe UI\\\", \\\"Helvetica Neue\\\", sans-serif;\\n}\\n.Scene > .SceneHeading {\\n  position: absolute;\\n  top: 20px;\\n  right: 0;\\n  left: 0;\\n}\\n@media (min-width: 720px) {\\n  .Scene > .SceneHeading {\\n    top: 2rem;\\n  }\\n}\\n.Scene > .SceneToolbar {\\n  position: absolute;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n}\", \"\"]);\n\n// exports\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.NotechartLoader = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar BMSNotechartLoader = __importStar(require(\"./BMSNotechartLoader\"));\nvar BmsonNotechartLoader = __importStar(require(\"./BmsonNotechartLoader\"));\nvar bluebird_1 = __importDefault(require(\"bluebird\"));\nvar coerceToBuffer = function (bufferOrArrayBuffer) {\n    return Buffer.isBuffer(bufferOrArrayBuffer)\n        ? bufferOrArrayBuffer\n        : Buffer.from(new Uint8Array(bufferOrArrayBuffer));\n};\nvar NotechartLoader = /** @class */ (function () {\n    function NotechartLoader() {\n    }\n    NotechartLoader.prototype.load = function (arraybuffer, resource, options) {\n        if (resource.name.match(/\\.bmson$/i)) {\n            return this.loadBmson(arraybuffer, resource, options);\n        }\n        else {\n            return this.loadBMS(arraybuffer, resource, options);\n        }\n    };\n    NotechartLoader.prototype.loadBMS = function (arraybuffer, resource, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var buffer, readerOptions, source, compileResult, chart, notechart;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        buffer = coerceToBuffer(arraybuffer);\n                        readerOptions = BMS.Reader.getReaderOptionsFromFilename(resource.name);\n                        return [4 /*yield*/, bluebird_1.default.promisify(BMS.Reader.readAsync)(buffer, readerOptions)];\n                    case 1:\n                        source = _a.sent();\n                        compileResult = BMS.Compiler.compile(source);\n                        chart = compileResult.chart;\n                        notechart = BMSNotechartLoader.fromBMSChart(chart, options);\n                        return [2 /*return*/, notechart];\n                }\n            });\n        });\n    };\n    NotechartLoader.prototype.loadBmson = function (arraybuffer, resource, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var buffer, source;\n            return __generator(this, function (_a) {\n                buffer = coerceToBuffer(arraybuffer);\n                source = buffer.toString('utf-8');\n                return [2 /*return*/, BmsonNotechartLoader.load(source, options)];\n            });\n        });\n    };\n    return NotechartLoader;\n}());\nexports.NotechartLoader = NotechartLoader;\nexports.default = NotechartLoader;\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.load = void 0;\nvar bmson = __importStar(require(\"bmson\"));\nvar BMS = __importStar(require(\"bms\"));\nvar __1 = __importDefault(require(\"../\"));\nfunction load(source, playerOptions) {\n    var data = JSON.parse(source);\n    var songInfo = bmson.songInfoForBmson(data);\n    var score = bmson.musicalScoreForBmson(data, { double: playerOptions.double });\n    var barLines = bmson.barLinesForBmson(data);\n    var stuff = {\n        notes: score.notes.all(),\n        timing: score.timing,\n        keysounds: score.keysounds,\n        songInfo: songInfo,\n        positioning: new BMS.Positioning([{ t: 0, x: 0, dx: 1, inclusive: true }]),\n        spacing: new BMS.Spacing([]),\n        barLines: barLines,\n        images: {\n            // HACK: Hardcoded here, probably should belong in bmson package\n            eyecatch: data.info.eyecatch_image,\n            background: data.info.back_image,\n        },\n        expertJudgmentWindow: getExpertJudgmentWindowForBmson(data),\n    };\n    return new __1.default(stuff, playerOptions);\n}\nexports.load = load;\nfunction getExpertJudgmentWindowForBmson(data) {\n    var judgeRank = (function () {\n        if (!data.info)\n            return 100;\n        if (!data.info.judge_rank)\n            return 100;\n        return +data.info.judge_rank || 100;\n    })() / 100;\n    return [18 * judgeRank, 40 * judgeRank];\n}\n//# sourceMappingURL=BmsonNotechartLoader.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.keysForBmson = exports.hasScratch = exports.beatForPulseForBmson = exports._slicesForNotesAndTiming = exports.musicalScoreForBmson = exports.timingInfoForBmson = exports.barLinesForBmson = exports.songInfoForBmson = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar BMS = __importStar(require(\"bms\"));\nvar legacy = __importStar(require(\"./legacy\"));\nvar utils = __importStar(require(\"./utils\"));\n__exportStar(require(\"./types\"), exports);\n/**\n * Returns a BMS.SongInfo corresponding to this BMS file.\n */\nfunction songInfoForBmson(bmson) {\n    var bmsonInfo = bmson.info;\n    var info = {};\n    if (bmsonInfo.title)\n        info.title = bmsonInfo.title;\n    if (bmsonInfo.artist)\n        info.artist = bmsonInfo.artist;\n    if (bmsonInfo.genre)\n        info.genre = bmsonInfo.genre;\n    if (bmsonInfo.level)\n        info.level = bmsonInfo.level;\n    info.subtitles = getSubtitles();\n    if (bmsonInfo.subartists)\n        info.subartists = bmsonInfo.subartists;\n    return new BMS.SongInfo(info);\n    function getSubtitles() {\n        if (!bmson.version)\n            return ['Warning: legacy bmson'];\n        var subtitles = [];\n        if (bmsonInfo.chart_name && typeof bmsonInfo.chart_name === 'string') {\n            subtitles.push(bmsonInfo.chart_name);\n        }\n        if (bmsonInfo.subtitle && typeof bmsonInfo.subtitle === 'string') {\n            subtitles.push.apply(subtitles, __spreadArray([], __read(bmsonInfo.subtitle.split('\\n')), false));\n        }\n        return subtitles;\n    }\n}\nexports.songInfoForBmson = songInfoForBmson;\n/**\n * Returns the barlines as an array of beats.\n */\nfunction barLinesForBmson(bmson) {\n    if (!bmson.version)\n        return legacy.barLinesForBmson(bmson);\n    var beatForPulse = beatForPulseForBmson(bmson);\n    var lines = bmson.lines;\n    return (0, lodash_1.default)(lines)\n        .map(function (_a) {\n        var y = _a.y;\n        return beatForPulse(y);\n    })\n        .sortBy()\n        .value();\n}\nexports.barLinesForBmson = barLinesForBmson;\n/**\n * Returns the information to be passed to BMS.Timing constructor\n * in order to generate the timing data represented by the `bmson` object.\n * @param {Bmson} bmson\n */\nfunction timingInfoForBmson(bmson) {\n    if (!bmson.version)\n        return legacy.timingInfoForBmson(bmson);\n    var beatForPulse = beatForPulseForBmson(bmson);\n    return {\n        initialBPM: bmson.info.init_bpm,\n        actions: __spreadArray(__spreadArray([], __read((bmson.bpm_events || []).map(function (_a) {\n            var y = _a.y, bpm = _a.bpm;\n            return ({\n                type: 'bpm',\n                beat: beatForPulse(y),\n                bpm: bpm,\n            });\n        })), false), __read((bmson.stop_events || []).map(function (_a) {\n            var y = _a.y, duration = _a.duration;\n            return ({\n                type: 'stop',\n                beat: beatForPulse(y),\n                stopBeats: beatForPulse(Math.floor(duration)),\n            });\n        })), false),\n    };\n}\nexports.timingInfoForBmson = timingInfoForBmson;\n/**\n * Returns the timing data represented by the `bmson` object.\n * @param {Bmson} bmson\n */\nfunction timingForBmson(bmson) {\n    var _a = timingInfoForBmson(bmson), initialBPM = _a.initialBPM, actions = _a.actions;\n    return new BMS.Timing(initialBPM, actions);\n}\n/**\n * Returns the musical score (comprised of BMS.Notes and BMS.Keysounds).\n * @param {Bmson} bmson\n */\nfunction musicalScoreForBmson(bmson, options) {\n    if (options === void 0) { options = {}; }\n    var timing = timingForBmson(bmson);\n    var _a = notesDataAndKeysoundsDataForBmsonAndTiming(bmson, timing, options), notes = _a.notes, keysounds = _a.keysounds;\n    return {\n        /**\n         * The {BMS.Timing} object for this musical score.\n         */\n        timing: timing,\n        /**\n         * A {BMS.Notes} representing notes inside the bmson notechart.\n         */\n        notes: new BMS.Notes(notes),\n        /**\n         * A {BMS.Keysounds} representing mapping between keysound in the\n         * `notes` field to the actual keysound file name.\n         */\n        keysounds: new BMS.Keysounds(keysounds),\n    };\n}\nexports.musicalScoreForBmson = musicalScoreForBmson;\nfunction soundChannelsForBmson(bmson) {\n    return bmson.version\n        ? bmson.sound_channels\n        : bmson.soundChannel;\n}\nfunction notesDataAndKeysoundsDataForBmsonAndTiming(bmson, timing, options) {\n    var e_1, _a, e_2, _b;\n    var nextKeysoundNumber = 1;\n    var beatForPulse = beatForPulseForBmson(bmson);\n    var notes = [];\n    var keysounds = {};\n    var soundChannels = soundChannelsForBmson(bmson);\n    if (soundChannels) {\n        try {\n            for (var soundChannels_1 = __values(soundChannels), soundChannels_1_1 = soundChannels_1.next(); !soundChannels_1_1.done; soundChannels_1_1 = soundChannels_1.next()) {\n                var _c = soundChannels_1_1.value, name_1 = _c.name, soundChannelNotes = _c.notes;\n                var sortedNotes = lodash_1.default.sortBy(soundChannelNotes, 'y');\n                var keysoundNumber = nextKeysoundNumber++;\n                var keysoundId = lodash_1.default.padStart('' + keysoundNumber, 4, '0');\n                var slices = utils.slicesForNotesAndTiming(soundChannelNotes, timing, {\n                    beatForPulse: beatForPulse,\n                });\n                keysounds[keysoundId] = name_1;\n                try {\n                    for (var sortedNotes_1 = (e_2 = void 0, __values(sortedNotes)), sortedNotes_1_1 = sortedNotes_1.next(); !sortedNotes_1_1.done; sortedNotes_1_1 = sortedNotes_1.next()) {\n                        var _d = sortedNotes_1_1.value, x = _d.x, y = _d.y, l = _d.l;\n                        var note = {\n                            column: getColumn(x, options),\n                            beat: beatForPulse(y),\n                            keysound: keysoundId,\n                            endBeat: undefined,\n                        };\n                        if (l > 0) {\n                            note.endBeat = beatForPulse(y + l);\n                        }\n                        var slice = slices.get(y);\n                        if (slice) {\n                            Object.assign(note, slice);\n                            notes.push(note);\n                        }\n                    }\n                }\n                catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                finally {\n                    try {\n                        if (sortedNotes_1_1 && !sortedNotes_1_1.done && (_b = sortedNotes_1.return)) _b.call(sortedNotes_1);\n                    }\n                    finally { if (e_2) throw e_2.error; }\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (soundChannels_1_1 && !soundChannels_1_1.done && (_a = soundChannels_1.return)) _a.call(soundChannels_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    }\n    return { notes: notes, keysounds: keysounds };\n}\nvar legacy_1 = require(\"./legacy\");\nObject.defineProperty(exports, \"_slicesForNotesAndTiming\", { enumerable: true, get: function () { return legacy_1._slicesForNotesAndTiming; } });\nfunction beatForPulseForBmson(bmson) {\n    if (!bmson.version)\n        return legacy.beatForLoc;\n    var resolution = (bmson.info && bmson.info.resolution) || 240;\n    return function (y) { return y / resolution; };\n}\nexports.beatForPulseForBmson = beatForPulseForBmson;\nfunction getColumn(x, options) {\n    switch (x) {\n        case 1:\n            return '1';\n        case 2:\n            return '2';\n        case 3:\n            return '3';\n        case 4:\n            return '4';\n        case 5:\n            return '5';\n        case 6:\n            return '6';\n        case 7:\n            return '7';\n        case 8:\n            return 'SC';\n    }\n    if (options.double) {\n        switch (x) {\n            case 9:\n                return '8';\n            case 10:\n                return '9';\n            case 11:\n                return '10';\n            case 12:\n                return '11';\n            case 13:\n                return '12';\n            case 14:\n                return '13';\n            case 15:\n                return '14';\n            case 16:\n                return 'SC2';\n        }\n    }\n    return undefined;\n}\n/**\n * Checks if there is a scratch in a bmson file\n */\nfunction hasScratch(bmson) {\n    var e_3, _a, e_4, _b;\n    var soundChannels = soundChannelsForBmson(bmson);\n    if (soundChannels) {\n        try {\n            for (var soundChannels_2 = __values(soundChannels), soundChannels_2_1 = soundChannels_2.next(); !soundChannels_2_1.done; soundChannels_2_1 = soundChannels_2.next()) {\n                var notes = soundChannels_2_1.value.notes;\n                try {\n                    for (var notes_1 = (e_4 = void 0, __values(notes)), notes_1_1 = notes_1.next(); !notes_1_1.done; notes_1_1 = notes_1.next()) {\n                        var x = notes_1_1.value.x;\n                        if (x === 8 || x === 18)\n                            return true;\n                    }\n                }\n                catch (e_4_1) { e_4 = { error: e_4_1 }; }\n                finally {\n                    try {\n                        if (notes_1_1 && !notes_1_1.done && (_b = notes_1.return)) _b.call(notes_1);\n                    }\n                    finally { if (e_4) throw e_4.error; }\n                }\n            }\n        }\n        catch (e_3_1) { e_3 = { error: e_3_1 }; }\n        finally {\n            try {\n                if (soundChannels_2_1 && !soundChannels_2_1.done && (_a = soundChannels_2.return)) _a.call(soundChannels_2);\n            }\n            finally { if (e_3) throw e_3.error; }\n        }\n    }\n    return false;\n}\nexports.hasScratch = hasScratch;\n/**\n * Checks the key mode for a bmson file\n */\nfunction keysForBmson(bmson) {\n    var e_5, _a, e_6, _b;\n    var soundChannels = soundChannelsForBmson(bmson);\n    var hasKeys = false;\n    var hasSecondPlayer = false;\n    var hasDeluxeKeys = false;\n    if (soundChannels) {\n        try {\n            for (var soundChannels_3 = __values(soundChannels), soundChannels_3_1 = soundChannels_3.next(); !soundChannels_3_1.done; soundChannels_3_1 = soundChannels_3.next()) {\n                var notes = soundChannels_3_1.value.notes;\n                try {\n                    for (var notes_2 = (e_6 = void 0, __values(notes)), notes_2_1 = notes_2.next(); !notes_2_1.done; notes_2_1 = notes_2.next()) {\n                        var x = notes_2_1.value.x;\n                        hasKeys = true;\n                        if (x >= 11 && x <= 20)\n                            hasSecondPlayer = true;\n                        if (x === 6 || x === 7 || x === 16 || x === 17)\n                            hasDeluxeKeys = true;\n                    }\n                }\n                catch (e_6_1) { e_6 = { error: e_6_1 }; }\n                finally {\n                    try {\n                        if (notes_2_1 && !notes_2_1.done && (_b = notes_2.return)) _b.call(notes_2);\n                    }\n                    finally { if (e_6) throw e_6.error; }\n                }\n            }\n        }\n        catch (e_5_1) { e_5 = { error: e_5_1 }; }\n        finally {\n            try {\n                if (soundChannels_3_1 && !soundChannels_3_1.done && (_a = soundChannels_3.return)) _a.call(soundChannels_3);\n            }\n            finally { if (e_5) throw e_5.error; }\n        }\n    }\n    if (!hasKeys)\n        return 'empty';\n    if (hasSecondPlayer) {\n        return hasDeluxeKeys ? '14K' : '10K';\n    }\n    else {\n        return hasDeluxeKeys ? '7K' : '5K';\n    }\n}\nexports.keysForBmson = keysForBmson;\n//# sourceMappingURL=index.js.map","\"use strict\";\n/* eslint camelcase: off */\n/* REASON: These snake case names are specified in bmsons spec. */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","import Player, { PlayerOptionsInput } from './player'\nimport Notechart from 'bemuse-notechart'\n\nexport type GamePlayerOptionsInput = {\n  players: Omit<PlayerOptionsInput, 'autosound' | 'tutorial'>[]\n  audioInputLatency: number\n  tutorial: boolean\n  soundVolume: number\n}\n\n/**\n * The Game model holds the game's options and the player objects.\n * This class represents all the data needed to start a game.\n * However, it is immutable.  See `GameState` for mutable stuff.\n */\nexport class Game {\n  /** The Game's players */\n  public players: Player[]\n\n  constructor(\n    notecharts: Notechart[],\n    public readonly options: GamePlayerOptionsInput\n  ) {\n    this.players = options.players.map(function (playerOptions, index) {\n      playerOptions = Object.assign({}, playerOptions, {\n        autosound: options.audioInputLatency >= 0.01,\n        tutorial: options.tutorial,\n      })\n      return new Player(notecharts[index], index + 1, playerOptions)\n    })\n  }\n\n  /** A list of all sound samples used in game. Used for loading sounds. */\n  get samples() {\n    let set = new Set()\n    for (let player of this.players) {\n      for (let sample of player.notechart.samples) {\n        set.add(sample)\n      }\n    }\n    return Array.from(set)\n  }\n}\n\nexport default Game\n","import _ from 'lodash'\n\nimport WaveFactory from './wave-factory'\nimport { isBad } from '../judgments'\n\nfunction autoplayer(array) {\n  array = _.sortBy(array, 'time')\n  let i = 0\n  return {\n    next(time) {\n      let out = []\n      for (; i < array.length && time >= array[i].time; i++) {\n        out.push(array[i])\n      }\n      return out\n    },\n  }\n}\n\nexport class PlayerAudio {\n  constructor({ player, samples, master, waveFactory, volume }) {\n    let notechart = player.notechart\n    this._waveFactory =\n      waveFactory ||\n      new WaveFactory(master, samples, notechart.keysounds, { volume })\n    this._autos = autoplayer(notechart.autos)\n    this._notes = autoplayer(notechart.notes)\n    this._played = new Map()\n    this._autosound = !!player.options.autosound\n  }\n  update(time, state) {\n    this._playAutokeysounds(time)\n    this._playAutosounds(time, state)\n    this._handleSoundNotifications((state && state.notifications.sounds) || [])\n  }\n  _playAutokeysounds(time) {\n    for (let auto of this._autos.next(time + 1 / 30)) {\n      this._waveFactory.playAuto(auto, auto.time - time)\n    }\n  }\n  _playAutosounds(time, state) {\n    let autosounds = this._notes.next(time + 1 / 30)\n    let poor = state && state.stats.poor\n    let shouldPlay = this._autosound && !poor\n    if (!shouldPlay) return\n    for (let note of autosounds) {\n      this._hitNote(note, note.time - time)\n    }\n  }\n  _handleSoundNotifications(soundNotifications) {\n    for (let notification of soundNotifications) {\n      let { type, note } = notification\n      if (type === 'hit') {\n        this._hitNote(note, 0, notification.judgment)\n      } else if (type === 'break') {\n        this._breakNote(note)\n      } else if (type === 'free') {\n        this._waveFactory.playFree(note, 0)\n      }\n    }\n  }\n  _hitNote(note, delay, judgment) {\n    let instance = this._played.get(note)\n    if (!instance) {\n      instance = this._waveFactory.playNote(note, delay)\n      this._played.set(note, instance)\n    }\n    if (instance) {\n      if (isBad(judgment)) {\n        instance.bad()\n      }\n    }\n  }\n  _breakNote(note) {\n    let instance = this._played.get(note)\n    if (instance) {\n      instance.stop()\n    }\n  }\n}\n\nexport default PlayerAudio\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Speedcore = void 0;\nvar segment_1 = require(\"./segment\");\n/**\n * Speedcore is a small internally-used library.\n * A Speedcore represents a single dimensional keyframed linear motion\n * (as in equation x = f(t)), and is useful when working\n * with BPM changes ({Timing}), note spacing factor ({Spacing}), or scrolling\n * segments ({Positioning}).\n * A Speedcore is constructed from an array of Segments.\n *\n * A {Segment} is defined as `{ t, x, dx }`, such that:\n *\n * * speedcore.x(segment.t) = segment.x\n * * speedcore.t(segment.x) = segment.t\n * * speedcore.x(segment.t + dt) = segment.x + (segment.dx / dt)\n *\n *\n * ## Explanation\n *\n * One way to think of these segments is to think about tempo changes, where:\n *\n * * `t` is the elapsed time (in seconds) since song start.\n * * `x` is the elapsed beat since song start.\n * * `dx` is the amount of `x` increase per `t`. In this case, it has the\n *   unit of beats per second.\n *\n * For example, consider a song that starts at 140 BPM.\n * 32 beats later, the tempo changes to 160 BPM.\n * 128 beats later (at beat 160), the tempo reverts to 140 BPM.\n *\n * We can derive three segments:\n *\n * 1. At time 0, we are at beat 0, and moving at 2.333 beats per second.\n * 2. At 13.714s, we are at beat 32, moving at 2.667 beats per second.\n * 3. At 61.714s, we are at beat 160, moving at 2.333 beats per second.\n *\n * This maps out to this data structure:\n *\n * ```js\n * [ [0]: { t:  0.000,  x:   0,  dx: 2.333,  inclusive: true },\n *   [1]: { t: 13.714,  x:  32,  dx: 2.667,  inclusive: true },\n *   [2]: { t: 61.714,  x: 160,  dx: 2.333,  inclusive: true } ]\n * ```\n *\n * With this data, it is possible to find out the value of `x` at any given `t`.\n *\n * For example, to answer the question, what is the beat number at 30s?\n * First, we find the segment with maximum value of `t < 30`, and we get\n * the segment `[1]`.\n *\n * We calculate `segment.x + (t - segment.t) * segment.dx`.\n * The result beat number is (32 + (30 - 13.714) * 2.667) = 75.435.\n *\n * We can also perform the reverse calculation in a similar way, by reversing\n * the equation.\n *\n * Interestingly, we can use these segments to represent the effect of\n * both BPM changes and STOP segments in the same array.\n * For example, a 150-BPM song with a 2-beat stop in the 32nd beat\n * can be represented like this:\n *\n * ```js\n * [ [0]: { t:  0.0,  x:  0,  dx: 2.5,  inclusive: true  },\n *   [1]: { t: 12.8,  x: 32,  dx: 0,    inclusive: true  },\n *   [2]: { t: 13.6,  x: 32,  dx: 2.5,  inclusive: false } ]\n * ```\n */\nvar Speedcore = /** @class */ (function () {\n    /**\n     * Constructs a new `Speedcore` from given segments.\n     */\n    function Speedcore(segments) {\n        segments.forEach(segment_1.Segment);\n        this._segments = segments;\n    }\n    Speedcore.prototype._reached = function (index, targetFn, position) {\n        if (index >= this._segments.length)\n            return false;\n        var segment = this._segments[index];\n        var target = targetFn(segment);\n        return segment.inclusive ? position >= target : position > target;\n    };\n    Speedcore.prototype._segmentAt = function (targetFn, position) {\n        for (var i = 0; i < this._segments.length; i++) {\n            if (!this._reached(i + 1, targetFn, position))\n                return this._segments[i];\n        }\n        throw new Error('Unable to find a segment matching a criteria (this should never happen)!');\n    };\n    Speedcore.prototype.segmentAtX = function (x) {\n        return this._segmentAt(X, x);\n    };\n    Speedcore.prototype.segmentAtT = function (t) {\n        return this._segmentAt(T, t);\n    };\n    /**\n     * Calculates the _t_, given _x_.\n     */\n    Speedcore.prototype.t = function (x) {\n        var segment = this.segmentAtX(x);\n        return segment.t + (x - segment.x) / (segment.dx || 1);\n    };\n    /**\n     * Calculates the _x_, given _t_.\n     * @param {number} t\n     */\n    Speedcore.prototype.x = function (t) {\n        var segment = this.segmentAtT(t);\n        return segment.x + (t - segment.t) * segment.dx;\n    };\n    /**\n     * Finds the _dx_, given _t_.\n     * @param {number} t\n     */\n    Speedcore.prototype.dx = function (t) {\n        var segment = this.segmentAtT(t);\n        return segment.dx;\n    };\n    return Speedcore;\n}());\nexports.Speedcore = Speedcore;\nvar T = function (segment) { return segment.t; };\nvar X = function (segment) { return segment.x; };\n//# sourceMappingURL=index.js.map","import PlayerState from './player-state'\nimport Game from '../game'\nimport Player from '../player'\nimport GameInput from '../input'\nimport GameTimer from '../game-timer'\nimport invariant from 'invariant'\n\nexport class GameState {\n  /** See Timer#readyFraction. We need it here so that the display can read this information. */\n  public readyFraction = 0\n  /** True if the the player is getting started (i.e. holding down the start button for the first time), false otherwise. */\n  public gettingStarted = false\n  /** True if the game is started, false otherwise. */\n  public started = false\n  /** True if the game is finished, false otherwise. */\n  public finished = false\n\n  private _players: Map<Player, PlayerState>\n\n  constructor(public readonly game: Game) {\n    this._players = new Map(\n      game.players.map((player) => [player, new PlayerState(player)])\n    )\n  }\n  update(gameTime: number, input: GameInput, timer: GameTimer) {\n    let finished = true\n    for (let [player, playerState] of this._players) {\n      playerState.update(gameTime, input)\n      if (!playerState.finished) finished = false\n      void player\n    }\n    this.readyFraction = timer.readyFraction\n    this.gettingStarted = timer.gettingStarted\n    this.started = timer.started\n    this.finished = finished\n  }\n  player(p: Player) {\n    const playerState = this._players.get(p)\n    return (\n      playerState ||\n      invariant(\n        false,\n        'Invariant violation: No player state found for player %s',\n        p.number\n      )\n    )\n  }\n}\n\nexport default GameState\n","import bench from 'bemuse/devtools/benchmark'\n\nimport * as touch3d from '../display/touch3d'\n\nlet BUTTONS = ['p1_1', 'p1_2', 'p1_3', 'p1_4', 'p1_5', 'p1_6', 'p1_7', 'start']\n\nwindow.BEMUSE_TOUCH_STATS = []\n\nfunction StatsRecorder() {\n  const stats = []\n  window.BEMUSE_TOUCH_STATS.push(stats)\n  return {\n    record(input) {\n      for (let { x, y } of input) {\n        stats.push({ x: Math.round(x), y: Math.round(y) })\n      }\n    },\n    done() {\n      if (stats.length) {\n        localStorage['_stats_touch'] = JSON.stringify(window.BEMUSE_TOUCH_STATS)\n      }\n    },\n  }\n}\n\nexport function TouchPlugin(context) {\n  let scratchStartY = null\n  let scratchY = null\n  let getInput = bench.wrap('input:touch:I', _getInput)\n  let getScratch = bench.wrap('input:touch:SC', _getScratch)\n  let getButton = bench.wrap('input:touch:B', _getButton)\n  let getPinch = bench.wrap('input:touch:P', _getPinch)\n  let statsRecorder = new StatsRecorder()\n  const touch3dMode = context.skinData.displayMode === 'touch3d'\n  const pinchThreshold = touch3dMode ? touch3d.getRow(0.8).y : 550\n  return {\n    name: 'TouchPlugin',\n    get() {\n      let input = getInput()\n      let output = {}\n      if (bench.enabled) bench.stats['input:touch:n'] = '' + input.length\n      statsRecorder.record(input)\n      output['p1_SC'] = getScratch(input)\n      for (let button of BUTTONS) {\n        output[button] = getButton(input, button)\n      }\n      if (touch3dMode) {\n        for (let p of input) {\n          const lane = touch3d.getTouchedColumn(p.x, p.y)\n          if (lane) output['p1_' + lane] = 1\n        }\n      }\n      output['p1_pinch'] = getPinch(input)\n      return output\n    },\n    destroy() {\n      statsRecorder.done()\n    },\n  }\n  function _expand(rectangle, amount = 4) {\n    const newRect = rectangle.clone()\n    newRect.x -= amount\n    newRect.y -= amount\n    newRect.width += amount * 2\n    newRect.height += amount * 2\n    return newRect\n  }\n  function _getInput() {\n    return context.input\n  }\n  function _getButton(input, button) {\n    let objects = context.refs[button]\n    if (objects) {\n      for (let object of objects) {\n        let bounds = _expand(object.getBounds())\n        for (let p of input) {\n          if (bounds.contains(p.x, p.y)) return 1\n        }\n      }\n    }\n    return 0\n  }\n  function _getScratch(input) {\n    let objects = context.refs['p1_SC']\n    if (!objects) return 0\n    scratchY = null\n    for (let p of input) {\n      for (let object of objects) {\n        if (_expand(object.getBounds(), 32).contains(p.x, p.y)) {\n          scratchY = p.y\n          break\n        }\n      }\n      if (scratchY !== null) {\n        break\n      }\n    }\n    if (scratchY === null) {\n      scratchStartY = null\n      return 0\n    }\n    if (scratchStartY === null) {\n      scratchStartY = scratchY\n    }\n    if (scratchY > scratchStartY + 24) {\n      scratchStartY = scratchY - 24\n    } else if (scratchY < scratchStartY - 24) {\n      scratchStartY = scratchY + 24\n    }\n    return scratchY > scratchStartY + 4\n      ? -1\n      : scratchY < scratchStartY - 4\n      ? 1\n      : 0\n  }\n  function _getPinch(input) {\n    let a = null\n    let b = null\n    for (let p of input) {\n      if (p.y < pinchThreshold) {\n        if (a === null) {\n          a = p.y\n        } else if (b === null) {\n          b = p.y\n        } else {\n          return 0\n        }\n      }\n    }\n    if (a !== null && b !== null) {\n      return Math.abs(a - b)\n    } else {\n      return 0\n    }\n  }\n}\n\nexport default TouchPlugin\n","import './game-display.scss'\n\nimport $ from 'jquery'\n\nimport PlayerDisplay from './player-display'\nimport formatTime from '../../utils/formatTime'\nimport { shouldDisableFullScreen } from 'bemuse/devtools/query-flags'\nimport screenfull from 'screenfull'\n\nexport class GameDisplay {\n  constructor({ game, context, backgroundImagePromise, video }) {\n    this._game = game\n    this._context = context\n    const skinData = context.skinData\n    this._players = new Map(\n      game.players.map((player) => [\n        player,\n        new PlayerDisplay(player, skinData),\n      ])\n    )\n    this._stateful = {}\n    this._wrapper = this._createWrapper({\n      backgroundImagePromise,\n      video,\n      panelPlacement: game.players[0].options.placement,\n      infoPanelPosition: skinData.infoPanelPosition,\n    })\n    this._createTouchEscapeButton()\n    this._createFullScreenButton()\n    this._escapeHintShown = false\n  }\n  setEscapeHandler(escapeHandler) {\n    this._onEscape = escapeHandler\n  }\n  setReplayHandler(replayHandler) {\n    this._onReplay = replayHandler\n  }\n  start() {\n    this._started = new Date().getTime()\n    const player = this._game.players[0]\n    const songInfo = player.notechart.songInfo\n    const prefix = player.options.autoplayEnabled ? '[AUTOPLAY] ' : ''\n    this._stateful['song_title'] = prefix + songInfo.title\n    this._stateful['song_artist'] = songInfo.artist\n    this._duration = player.notechart.duration\n  }\n  destroy() {\n    this._context.destroy()\n  }\n  update(gameTime, gameState) {\n    let time = (new Date().getTime() - this._started) / 1000\n    let data = this._getData(time, gameTime, gameState)\n    this._updateStatefulData(time, gameTime, gameState)\n    this._context.render(Object.assign({}, this._stateful, data))\n    this._synchronizeVideo(gameTime)\n    this._synchronizeTutorialEscapeHint(gameTime)\n  }\n  _synchronizeVideo(gameTime) {\n    if (this._video && !this._videoStarted && gameTime >= this._videoOffset) {\n      this._video.volume = 0\n      this._video.play()\n      this._video.classList.add('is-playing')\n      this._videoStarted = true\n    }\n  }\n  _synchronizeTutorialEscapeHint(gameTime) {\n    if (this._game.options.tutorial) {\n      const TUTORIAL_ESCAPE_HINT_SHOW_TIME = 101.123595506\n      if (\n        gameTime >= TUTORIAL_ESCAPE_HINT_SHOW_TIME &&\n        !this._escapeHintShown\n      ) {\n        this._escapeHintShown = true\n        this._escapeHint.classList.add('is-shown')\n      }\n    }\n  }\n  _getData(time, gameTime, gameState) {\n    let data = {}\n    data['tutorial'] = this._game.options.tutorial ? 'yes' : 'no'\n    data['t'] = time\n    data['gameTime'] = gameTime\n    data['ready'] = this._getReady(gameState)\n    data['song_time'] = this._getSongTime(gameTime)\n    for (let [player, playerDisplay] of this._players) {\n      let playerState = gameState.player(player)\n      let playerData = playerDisplay.update(time, gameTime, playerState)\n      for (let key in playerData) {\n        data[`p${player.number}_${key}`] = playerData[key]\n      }\n    }\n    return data\n  }\n  _updateStatefulData(time, gameTime, gameState) {\n    let data = this._stateful\n    if (data['started'] === undefined && gameState.started) {\n      data['started'] = time\n    }\n    if (data['gettingStarted'] === undefined && gameState.gettingStarted) {\n      data['gettingStarted'] = time\n    }\n  }\n  _getSongTime(gameTime) {\n    return (\n      formatTime(Math.min(this._duration, Math.max(0, gameTime))) +\n      ' / ' +\n      formatTime(this._duration)\n    )\n  }\n  _getReady(gameState) {\n    let f = gameState.readyFraction\n    return f > 0.5 ? Math.pow(1 - (f - 0.5) / 0.5, 2) : 0\n  }\n  _createWrapper({\n    backgroundImagePromise,\n    video,\n    panelPlacement,\n    infoPanelPosition,\n  }) {\n    var $wrapper = $('<div class=\"game-display\"></div>')\n      .attr('data-panel-placement', panelPlacement)\n      .attr('data-info-panel-position', infoPanelPosition)\n      .append('<div class=\"game-display--bg js-back-image\"></div>')\n      .append(this.view)\n    if (backgroundImagePromise) {\n      Promise.resolve(backgroundImagePromise).then((image) =>\n        $wrapper.find('.js-back-image').append(image)\n      )\n    }\n    if (video) {\n      this._video = video.element\n      this._videoOffset = video.offset\n      $(video.element).addClass('game-display--video-bg').appendTo($wrapper)\n    }\n    return $wrapper[0]\n  }\n  _createTouchEscapeButton() {\n    const touchButtons = document.createElement('div')\n    touchButtons.className = 'game-display--touch-buttons is-left'\n    this.wrapper.appendChild(touchButtons)\n    touchButtons.classList.add('is-visible')\n    const addTouchButton = (className, onClick) => {\n      let button = createTouchButton(onClick, className)\n      touchButtons.appendChild(button)\n    }\n    addTouchButton('game-display--touch-escape-button', () => this._onEscape())\n    addTouchButton('game-display--touch-replay-button', () => this._onReplay())\n\n    const escapeHint = document.createElement('div')\n    escapeHint.textContent = 'Click or press Esc to exit the tutorial'\n    escapeHint.className = 'game-display--escape-hint'\n    this._escapeHint = escapeHint\n    touchButtons.appendChild(escapeHint)\n  }\n  _createFullScreenButton() {\n    if (shouldDisableFullScreen() || !screenfull.enabled) {\n      return\n    }\n    const touchButtons = document.createElement('div')\n    touchButtons.className = 'game-display--touch-buttons is-visible is-right'\n    this.wrapper.appendChild(touchButtons)\n    const onClick = () => {\n      screenfull.request()\n    }\n    const button = createTouchButton(\n      onClick,\n      'game-display--touch-fullscreen-button'\n    )\n    touchButtons.appendChild(button)\n  }\n  get context() {\n    return this._context\n  }\n  get view() {\n    return this._context.view\n  }\n  get wrapper() {\n    return this._wrapper\n  }\n}\n\nfunction createTouchButton(onClick, className) {\n  let button = document.createElement('button')\n  button.addEventListener(\n    'touchstart',\n    (e) => {\n      e.stopPropagation()\n    },\n    true\n  )\n  button.onclick = (e) => {\n    e.preventDefault()\n    onClick()\n  }\n  button.className = className\n  return button\n}\n\nexport default GameDisplay\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./game-display.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./game-display.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./game-display.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","var escape = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".game-display {\\n  display: block;\\n  margin: 0 auto;\\n  overflow: hidden;\\n  position: relative;\\n}\\n.game-display--bg {\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  z-index: 10;\\n  background: url(\" + escape(require(\"./background/default.jpg\")) + \") center no-repeat;\\n  background-size: cover;\\n  -webkit-animation: 1.5s game-display--bg-default;\\n          animation: 1.5s game-display--bg-default;\\n  -webkit-animation-fill-mode: both;\\n          animation-fill-mode: both;\\n}\\n.game-display[data-info-panel-position=top] .game-display--bg {\\n  -webkit-animation-name: game-display--bg-down;\\n          animation-name: game-display--bg-down;\\n}\\n.game-display--video-bg {\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  top: -48px;\\n  left: 0px;\\n  z-index: 11;\\n  opacity: 0;\\n  transition: 0.5s opacity;\\n  will-change: opacity;\\n}\\n.game-display--video-bg.is-playing {\\n  opacity: 1;\\n}\\n.game-display[data-panel-placement=left] .game-display--video-bg {\\n  -webkit-transform: translateX(13.671875%) scale(0.87);\\n          transform: translateX(13.671875%) scale(0.87);\\n}\\n.game-display[data-panel-placement=right] .game-display--video-bg {\\n  -webkit-transform: translateX(13.671875%) scale(0.87);\\n          transform: translateX(13.671875%) scale(0.87);\\n}\\n.game-display--bg img {\\n  width: 100%;\\n  height: 100%;\\n  display: block;\\n  object-fit: cover;\\n  -webkit-animation: 1.2s game-display--bg-default;\\n          animation: 1.2s game-display--bg-default;\\n  -webkit-animation-fill-mode: both;\\n          animation-fill-mode: both;\\n}\\n.game-display[data-info-panel-position=top] .game-display--bg img {\\n  -webkit-animation-name: game-display--bg-down;\\n          animation-name: game-display--bg-down;\\n}\\n.game-display > canvas {\\n  position: relative;\\n  z-index: 100;\\n}\\n.game-display--touch-buttons {\\n  position: fixed;\\n  -webkit-transform: translateZ(0);\\n          transform: translateZ(0);\\n  top: 0;\\n  opacity: 0;\\n  z-index: 110;\\n}\\n.game-display--touch-buttons.is-visible {\\n  opacity: 1;\\n}\\n.game-display--touch-buttons.is-left {\\n  left: 0;\\n}\\n.game-display--touch-buttons.is-right {\\n  right: 0;\\n}\\n.game-display--touch-escape-button, .game-display--touch-replay-button, .game-display--touch-fullscreen-button {\\n  position: absolute;\\n  top: 12px;\\n  margin: 0;\\n  padding: 0;\\n  border: 0;\\n  width: 32px;\\n  height: 32px;\\n  background: transparent center center no-repeat;\\n  background-size: 32px 32px;\\n  cursor: pointer;\\n}\\n.game-display--touch-escape-button {\\n  background-image: url(\" + escape(require(\"./touch-escape.png\")) + \");\\n  left: 12px;\\n}\\n.game-display--touch-replay-button {\\n  background-image: url(\" + escape(require(\"./touch-replay.png\")) + \");\\n  left: 56px;\\n}\\n.game-display--touch-fullscreen-button {\\n  background-image: url(\" + escape(require(\"./touch-fullscreen.png\")) + \");\\n  right: 12px;\\n}\\n:root:-webkit-full-screen .game-display--touch-fullscreen-button {\\n  display: none;\\n}\\n:root:fullscreen .game-display--touch-fullscreen-button {\\n  display: none;\\n}\\n.game-display--escape-hint {\\n  position: absolute;\\n  left: 12px;\\n  top: 56px;\\n  display: none;\\n  background: #b61a44;\\n  padding: 8px 12px;\\n  color: white;\\n  white-space: nowrap;\\n  border-radius: 8px;\\n  font-weight: bold;\\n  font-size: 1rem;\\n  pointer-events: none;\\n}\\n.game-display--escape-hint.is-shown {\\n  display: block;\\n}\\n.game-display--escape-hint::after {\\n  content: \\\"\\\";\\n  display: block;\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n  top: -8px;\\n  left: 16px;\\n  margin-left: -8px;\\n  border-width: 0 8px 8px 8px;\\n  border-style: solid;\\n  border-color: transparent;\\n  border-bottom-color: #b61a44;\\n}\\n\\n@-webkit-keyframes game-display--bg-default {\\n  from {\\n    -webkit-transform: translate(0, 0);\\n            transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    -webkit-transform: translate(0, -35px);\\n            transform: translate(0, -35px);\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes game-display--bg-default {\\n  from {\\n    -webkit-transform: translate(0, 0);\\n            transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    -webkit-transform: translate(0, -35px);\\n            transform: translate(0, -35px);\\n    opacity: 1;\\n  }\\n}\\n@-webkit-keyframes game-display--bg-down {\\n  from {\\n    -webkit-transform: translate(0, 0);\\n            transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    -webkit-transform: translate(0, 35px);\\n            transform: translate(0, 35px);\\n    opacity: 1;\\n  }\\n}\\n@keyframes game-display--bg-down {\\n  from {\\n    -webkit-transform: translate(0, 0);\\n            transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    -webkit-transform: translate(0, 35px);\\n            transform: translate(0, 35px);\\n    opacity: 1;\\n  }\\n}\", \"\"]);\n\n// exports\n","module.exports = __webpack_public_path__ + \"build/ea410328703171d8f693d3a404a11a8f.jpg\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACxUlEQVR4AdSYgWfrUBTG2xWNhLbQUbQAlUA7oEzKUNSGwqbA84INBs3oJPvj+75wUMe5Sd+yfM3KD+L2nvPdnNz7ndtp+nc6nQIQghjsQALeQQoyIZVniYyJ5T9BI0kRRE/ABryCr5q8ylyTtovugxV4k8Sb4E1i9Nsk3ANr8CFJMviQmN41hXfBAqQVyeYgkTK+AzMwAj7oCb48m8mYjfwnr5j7IDl02eKH4E9JYhl4lo3Mq1ldocyVueJJLkOW+Ck4OBL5BA/AbyCuL3N/llTDtGnxS5A5yvwJDAgvYCCxckflLZsIegM2jpXfg/EV9qCxxP7SSK43Pyn+xRHovgWn0L0jt5cfWQTHmz+CeYuO4jk4WpVQ+5s3Jn0Hty00YreSm853WWe3zwzxQYvdaKAXQTRMv3POH3TZ22++lZVwNI7I4eUOzzY581/UjM0dZql7yZ8X5m5fvmBbEBEFRhKz+5+nw6LSehrefl8h/vHMDEUk8bnEfKxYhL3xKXhlk68NhzcuGb81xkcM8WdsK8ySHr8u6+d1S/t0SUKERfh2rEKD0Ur3rYEro7EZNJIYQbzqHXQDtbIG6pucB0KClLkLLfpmSQ+YGObBJyRKmbPQYpi6SZnffyYkTF3QQpOzTzBub0PCW2NXU6hvm8/9sw7kUb5bgnjlcfS8gbUyf2k7N0G8mj/RlV48jK1vg7cIBPHuvS4uHu7UwzuWgWEbqkKbirGzymLGdHFkNzlTcZKOcYEwIvr4nCVechjpC56O0f35zGaG3Ez5Kl7aMRxSj9HOssVL7J52vP/at28CgIEYiqF4AssQzH/Jmt4z/QfhqptkAzwBn6AwmJ4ISYWH1bUIKobiy2ENES0xTVFtcYMRozHD0Vms7IDxOEACIgOSgskBJaGyYGm4PGGCMkOaeq/N9QVtrh5oc/W7NkecpM6Sp+P1+REepk4aEr9vwAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEEklEQVR4AdSaBY/zPAzHBw8cMzMzCo+ZmZmZmfvh7/1P8kt+kq65dLt00k9QZYbUSWynvkj/Pj8/40Et6AZz4ABcgQfwTjzQswMa003/ifd58QfDc8EwOAGWJickK9d0p3+DNnAKrAhxSjp+m+R4DOgBj8CKEo+kM+Y7HfeDZvAQxtgPcEBh3AqKQAqIA0Eijp4V0Zhh+s9HGNn3ZIM/2s4ng10bw97BMqgFMZrRVUuy3mX6yJbkaDlfCO4lhryCfhAXAb1xJPvVJhoKI+18C3iXhPkUSIrCC0giXR+SyGuJhNIArUtLwBrI/IY9KJN0WxyyNeCm8ysSRZ0GnEKdEttWXJkEyZt/AdUGHcXV4EUUCW6seYtxBbIMTMSyyDaL0aKz279z503Oz6nuuBJsjIVfOefvediL37yRkfAiOCKTFTI8YZJTrWlYLGgEM2AbnIMX4hLsgRkak+BQ5oB0TxAnS34nQps1d3surwZsOUhrRQZX2sgdonG/FE6HZiep5wM/5zX2kD1gaXIMSkTOE9LkS5An3Num5lRh8Qwv8wt5wwiwXGYQBJnzIbLDJEs88nrs6nle0k59oXjZsHHiCHSDEpAOfhF/V4LdYYqsW8Gz4jA2TQlK6d+igW2CwiZJ0fkzieGLIF1xJ59xGBnVDmoHXkC1iQbyTk6/YthvSJKmAs3K85LJVE50Qr7wzpKgh8eSB4WSVrLmtxVkKMlmtDkspXlSl2uX7y8rvSWx80F95/mGJ6TPoaxlaZ0g6N7WKhi5Jwj7uGg4T4w5lFfLu83/zZ/50RejkORYjIJoOU/MK2zS/EiMF83MvoKhW3y3d8H5AWApsK4g++CPSKezV7mGptyez2i6SwXNLzq+skExRVoLaAN9YAzMg3UwqdHb6A49nGMPWx0Ka+RJjgcqxVZm85woLIocCpvls+mBCShiNh/4BA2EFIfCttn/SjwwASn8xPIJqr84h8LO+fr3wATEMZsffDxDcprACLouvzwwAUGe8XpyAsiRjv/QpjMBnlsC0JXG17LGEvDeJghd5Uz3lsYm6L1jkMJe0LhRPwY9mQiFdHGbdRIhY1Jhh3ozBMVbnE4qXMvD4juKIQWdC+4WQwaUw5rNlzqdctjMhoh8yV0wXXvAr9EQMbolxhOYHZ1oE7fEvNEUjQObCq0whaao+W3xfMmd/wb7+kOvLW7gxUgG/ccScMo3ae2LEQOuxtJAMegBhzb/3xQtK42rMU9djsq//NK8HOVv8N6w6/G9cBegGtfjxn4g8UGnSLXLn881m/CJzKzgE5kLejZLY2L/at8OLACAgSAI1nolpH9IC8kJ4U0Xi50H21y1yJikbHJGSausWdouD0wgM9DUBZtbB1mbgs3lP5sDJ9FZeHo6n99ybdMJ2yzi/QAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAC30lEQVR4AdyYgacqQRTGt1u0NmqhSyiAFFRAXEUICEHXA563KNiH9tK19cf3vjgexje7e+9p9m4NPxhzzpzzdXbmTJ7rcb1eW2AEFmALIhCDBKRCInORrFmITct7xIHAe2AN9uCiZC++elVPugnm4AAujjjIHs0qJe6DJfgAl5L4kD39n0y8BiYgyQn2DCIp4xkYgBAEoC4EMjeQNWuxOef4PkoMtbKT74DfGYGlYCcHma+srpH4Sm37SSydspLvi/IskE+wAoGDfQPx/ZlRDX3XyU9BainzDWiX8AO0Za+zpfKmLjZ9AWuL8r9A9wfOoK7szWJag5d7Jv9u2eitArfQmyW297uIYPnlT2BYoat4CE6sEtTfPHEag9cKNmKvICbxTjWnfUqSb1W4G20REVLQ/849fyRlz3/56lXCiVyRneIdHm9yhg/0GBtamqVaEeNJVU57B7fDpEjrmZj3fI7N5SuIWSn+SJ9wBH6WwZJ0eN0HFqBLOsal9T1PnrQb9wE797chT+kmWzgnD5v2EwjQJg+oOVt4MBatPAxFwGcwvsNhNs76X6Cgj5VhdzAX9EjzECgF0IlAklcIEJCmrpfV7++KB0mTVovAkmdifMHfzvpOIP/ejhQCjLUiZPlQCDAybPf/+2eykV/YMQlIIUKurUIAn/htMWX+eBgaAb4pQr6NQgCxjcxKv00u+LehECA7oRg0iJ8GiO3J6wUgZ93iNrk1Jmd6Aawi/AVhhq9Q1vBq0QswM+y3rCwGnnZwEWKaPBchBmMHcQyMXCOPlF3o6HXW0K9VxxCan6NHXn+B96TjlpuRa+KRDqn+xALUzY73X/v2UQAgDMBQVA+yKqH+L9zZezRPAnQn//sBlkD6JugYdBFyFe5G0yLoMeQ5nByIiMSEomJxxYhqTDk6PitrQD0OkIDIgKRgckBJqCxYGi5PmKDMkKbOa3N1QyhSDmhz5WVtjjhJnSVPB+jzPZGAyclJbc34AAAAAElFTkSuQmCC\"","/*!\n* screenfull\n* v3.3.3 - 2018-09-04\n* (c) Sindre Sorhus; MIT License\n*/\n(function () {\n\t'use strict';\n\n\tvar document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\n\tvar isCommonjs = typeof module !== 'undefined' && module.exports;\n\tvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\n\n\tvar fn = (function () {\n\t\tvar val;\n\n\t\tvar fnMap = [\n\t\t\t[\n\t\t\t\t'requestFullscreen',\n\t\t\t\t'exitFullscreen',\n\t\t\t\t'fullscreenElement',\n\t\t\t\t'fullscreenEnabled',\n\t\t\t\t'fullscreenchange',\n\t\t\t\t'fullscreenerror'\n\t\t\t],\n\t\t\t// New WebKit\n\t\t\t[\n\t\t\t\t'webkitRequestFullscreen',\n\t\t\t\t'webkitExitFullscreen',\n\t\t\t\t'webkitFullscreenElement',\n\t\t\t\t'webkitFullscreenEnabled',\n\t\t\t\t'webkitfullscreenchange',\n\t\t\t\t'webkitfullscreenerror'\n\n\t\t\t],\n\t\t\t// Old WebKit (Safari 5.1)\n\t\t\t[\n\t\t\t\t'webkitRequestFullScreen',\n\t\t\t\t'webkitCancelFullScreen',\n\t\t\t\t'webkitCurrentFullScreenElement',\n\t\t\t\t'webkitCancelFullScreen',\n\t\t\t\t'webkitfullscreenchange',\n\t\t\t\t'webkitfullscreenerror'\n\n\t\t\t],\n\t\t\t[\n\t\t\t\t'mozRequestFullScreen',\n\t\t\t\t'mozCancelFullScreen',\n\t\t\t\t'mozFullScreenElement',\n\t\t\t\t'mozFullScreenEnabled',\n\t\t\t\t'mozfullscreenchange',\n\t\t\t\t'mozfullscreenerror'\n\t\t\t],\n\t\t\t[\n\t\t\t\t'msRequestFullscreen',\n\t\t\t\t'msExitFullscreen',\n\t\t\t\t'msFullscreenElement',\n\t\t\t\t'msFullscreenEnabled',\n\t\t\t\t'MSFullscreenChange',\n\t\t\t\t'MSFullscreenError'\n\t\t\t]\n\t\t];\n\n\t\tvar i = 0;\n\t\tvar l = fnMap.length;\n\t\tvar ret = {};\n\n\t\tfor (; i < l; i++) {\n\t\t\tval = fnMap[i];\n\t\t\tif (val && val[1] in document) {\n\t\t\t\tfor (i = 0; i < val.length; i++) {\n\t\t\t\t\tret[fnMap[0][i]] = val[i];\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t})();\n\n\tvar eventNameMap = {\n\t\tchange: fn.fullscreenchange,\n\t\terror: fn.fullscreenerror\n\t};\n\n\tvar screenfull = {\n\t\trequest: function (elem) {\n\t\t\tvar request = fn.requestFullscreen;\n\n\t\t\telem = elem || document.documentElement;\n\n\t\t\t// Work around Safari 5.1 bug: reports support for\n\t\t\t// keyboard in fullscreen even though it doesn't.\n\t\t\t// Browser sniffing, since the alternative with\n\t\t\t// setTimeout is even worse.\n\t\t\tif (/ Version\\/5\\.1(?:\\.\\d+)? Safari\\//.test(navigator.userAgent)) {\n\t\t\t\telem[request]();\n\t\t\t} else {\n\t\t\t\telem[request](keyboardAllowed ? Element.ALLOW_KEYBOARD_INPUT : {});\n\t\t\t}\n\t\t},\n\t\texit: function () {\n\t\t\tdocument[fn.exitFullscreen]();\n\t\t},\n\t\ttoggle: function (elem) {\n\t\t\tif (this.isFullscreen) {\n\t\t\t\tthis.exit();\n\t\t\t} else {\n\t\t\t\tthis.request(elem);\n\t\t\t}\n\t\t},\n\t\tonchange: function (callback) {\n\t\t\tthis.on('change', callback);\n\t\t},\n\t\tonerror: function (callback) {\n\t\t\tthis.on('error', callback);\n\t\t},\n\t\ton: function (event, callback) {\n\t\t\tvar eventName = eventNameMap[event];\n\t\t\tif (eventName) {\n\t\t\t\tdocument.addEventListener(eventName, callback, false);\n\t\t\t}\n\t\t},\n\t\toff: function (event, callback) {\n\t\t\tvar eventName = eventNameMap[event];\n\t\t\tif (eventName) {\n\t\t\t\tdocument.removeEventListener(eventName, callback, false);\n\t\t\t}\n\t\t},\n\t\traw: fn\n\t};\n\n\tif (!fn) {\n\t\tif (isCommonjs) {\n\t\t\tmodule.exports = false;\n\t\t} else {\n\t\t\twindow.screenfull = false;\n\t\t}\n\n\t\treturn;\n\t}\n\n\tObject.defineProperties(screenfull, {\n\t\tisFullscreen: {\n\t\t\tget: function () {\n\t\t\t\treturn Boolean(document[fn.fullscreenElement]);\n\t\t\t}\n\t\t},\n\t\telement: {\n\t\t\tenumerable: true,\n\t\t\tget: function () {\n\t\t\t\treturn document[fn.fullscreenElement];\n\t\t\t}\n\t\t},\n\t\tenabled: {\n\t\t\tenumerable: true,\n\t\t\tget: function () {\n\t\t\t\t// Coerce to boolean in case of old WebKit\n\t\t\t\treturn Boolean(document[fn.fullscreenEnabled]);\n\t\t\t}\n\t\t}\n\t});\n\n\tif (isCommonjs) {\n\t\tmodule.exports = screenfull;\n\t} else {\n\t\twindow.screenfull = screenfull;\n\t}\n})();\n","import * as ProgressUtils from 'bemuse/progress/utils'\nimport _ from 'lodash'\nimport defaultKeysoundCache from 'bemuse/keysound-cache'\nimport { EXTRA_FORMATTER } from 'bemuse/progress/formatters'\n\nexport class SamplesLoader {\n  constructor(assets, master, { keysoundCache = defaultKeysoundCache } = {}) {\n    this._assets = assets\n    this._master = master\n    this._keysoundCache = keysoundCache\n  }\n  loadFiles(files, loadProgress, decodeProgress) {\n    let onload = ProgressUtils.fixed(files.length, loadProgress)\n    let ondecode = ProgressUtils.fixed(files.length, decodeProgress)\n    let load = (name) =>\n      new Promise((resolve) => {\n        requestAnimationFrame(() => {\n          resolve(this._loadSample(name, onload, ondecode))\n        })\n      })\n    if (decodeProgress) decodeProgress.formatter = EXTRA_FORMATTER\n    return Promise.map(files, load, { concurrency: 64 }).then((arr) =>\n      _(arr).filter().fromPairs().value()\n    )\n  }\n  _loadSample(name, onload, ondecode) {\n    const audioBufferPromise = (() => {\n      if (this._keysoundCache.isCached(name)) {\n        return Promise.resolve(this._keysoundCache.get(name)).tap(() => {\n          onload(name)\n          ondecode(name)\n        })\n      } else {\n        return this._getFile(name).then((file) =>\n          file\n            .read()\n            .tap(() => {\n              onload(name)\n            })\n            .then((buffer) => this._decode(buffer))\n            .tap((audioBuffer) => {\n              this._keysoundCache.cache(name, audioBuffer)\n              ondecode(name)\n            })\n        )\n      }\n    })()\n    return audioBufferPromise\n      .then((audioBuffer) => this._master.sample(audioBuffer))\n      .then((sample) => [name, sample])\n      .catch((e) => {\n        console.error('Unable to load keysound: ' + name, e)\n        return null\n      })\n  }\n  _decode(buffer) {\n    return this._master.decode(buffer)\n  }\n  _getFile(name) {\n    name = name.replace(/\\\\/g, '/')\n    return Promise.try(() => this._assets.file(name.replace(/\\.\\w+$/, '.ogg')))\n      .catch(() => this._assets.file(name.replace(/\\.\\w+$/, '.m4a')))\n      .catch(() => this._assets.file(name.replace(/\\.\\w+$/, '.mp3')))\n      .catch(() => this._assets.file(name))\n  }\n}\n\nexport default SamplesLoader\n","import _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nexport enum Judgment {\n  Missed = -1,\n  Unjudged = 0,\n  Meticulous = 1,\n  Precise = 2,\n  Good = 3,\n  Offbeat = 4,\n}\n\nexport type JudgedJudgment = Exclude<Judgment, Judgment.Unjudged>\n\nexport const UNJUDGED = Judgment.Unjudged\nexport const MISSED = Judgment.Missed\n\nexport type Timegate = {\n  value: Judgment\n  timegate: number\n  endTimegate: number\n}\nexport type Timegates = Timegate[]\n\n// #region judgment timegate\nconst NORMAL_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.02, endTimegate: 0.04 },\n  { value: 2, timegate: 0.05, endTimegate: 0.1 },\n  { value: 3, timegate: 0.1, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV5_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.021, endTimegate: 0.042 },\n  { value: 2, timegate: 0.06, endTimegate: 0.12 },\n  { value: 3, timegate: 0.12, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV4_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.022, endTimegate: 0.044 },\n  { value: 2, timegate: 0.07, endTimegate: 0.14 },\n  { value: 3, timegate: 0.14, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV3_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.023, endTimegate: 0.046 },\n  { value: 2, timegate: 0.08, endTimegate: 0.16 },\n  { value: 3, timegate: 0.16, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst ABSOLUTE_BEGINNER_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.024, endTimegate: 0.048 },\n  { value: 2, timegate: 0.1, endTimegate: 0.18 },\n  { value: 3, timegate: 0.18, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\n// #endregion\n\nexport interface IJudge {\n  getTimegates(gameTime: number | null, noteTime: number | null): Timegates\n}\n\nclass FixedTimegatesJudge implements IJudge {\n  constructor(private timegates: Timegates) {}\n  getTimegates(_gameTime: number | null, _noteTime: number | null) {\n    return this.timegates\n  }\n}\n\nclass TutorialJudge implements IJudge {\n  getTimegates(_gameTime: number | null, noteTime: number | null) {\n    if (!noteTime || noteTime < 100) {\n      return ABSOLUTE_BEGINNER_TIMEGATES\n    } else {\n      return NORMAL_TIMEGATES\n    }\n  }\n}\n\nconst NORMAL_JUDGE = new FixedTimegatesJudge(NORMAL_TIMEGATES)\n\nexport function getJudgeForNotechart(\n  notechart: Notechart,\n  { tutorial = false }\n): IJudge {\n  const info = notechart.songInfo\n  const insane = info.difficulty >= 5\n  if (tutorial) {\n    return new TutorialJudge()\n  }\n  if (insane) {\n    return NORMAL_JUDGE\n  }\n  if (info.level === 1 || info.level === 2) {\n    return new FixedTimegatesJudge(ABSOLUTE_BEGINNER_TIMEGATES)\n  }\n  if (info.level === 3) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV3_TIMEGATES)\n  }\n  if (info.level === 4) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV4_TIMEGATES)\n  }\n  if (info.level === 5) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV5_TIMEGATES)\n  }\n  return NORMAL_JUDGE\n}\n\n/**\n * Takes a gameTime and noteTime and returns the appropriate judgment.\n *\n *  1 - METICULOUS\n *  2 - PRECISE\n *  3 - GOOD\n *  4 - OFFBEAT\n *  0 - (not judge)\n * -1 - MISSED\n */\nexport function judgeTimeWith(f: (timegate: Timegate) => number) {\n  return function judgeTimeWithF(\n    gameTime: number,\n    noteTime: number,\n    judge: IJudge = NORMAL_JUDGE\n  ): Judgment {\n    const timegates = judge.getTimegates(gameTime, noteTime)\n    let delta = Math.abs(gameTime - noteTime)\n    for (let i = 0; i < timegates.length; i++) {\n      if (delta < f(timegates[i])) return timegates[i].value\n    }\n    return gameTime < noteTime ? UNJUDGED : MISSED\n  }\n}\n\nexport const judgeTime = judgeTimeWith((t) => t.timegate)\nexport const judgeEndTime = judgeTimeWith((t) => t.endTimegate)\n\nexport function timegate(judgment: Judgment, judge = NORMAL_JUDGE) {\n  return _.find(judge.getTimegates(null, null), { value: judgment })!.timegate\n}\n\nexport function isBad(judgment: Judgment) {\n  return judgment >= 4\n}\n\nexport function breaksCombo(judgment: Judgment) {\n  return judgment === MISSED || isBad(judgment)\n}\n\n// #region judgment weight\nexport function weight(judgment: Judgment) {\n  if (judgment === 1) return 100\n  if (judgment === 2) return 80\n  if (judgment === 3) return 50\n  return 0\n}\n// #endregion\n","import bytes from 'bytes'\n\nlet wrap = (f) => (progress) => progress.progress !== null ? f(progress) : ''\n\n// Formats the `Progress` as bytes (e.g. 1.23mb of 1.31mb).\nexport let BYTES_FORMATTER = wrap(\n  (progress) => bytes(progress.current) + ' / ' + bytes(progress.total)\n)\n\n// Formats the `Progress` as percentage.\nexport let PERCENTAGE_FORMATTER = wrap(\n  (progress) => ((progress.current / progress.total) * 100).toFixed(1) + '%'\n)\n\n// Formats the `Progress` simply by using the value of `Progress#extra`.\nexport let EXTRA_FORMATTER = wrap((progress) => progress.extra + '')\n","(function() {\nvar _slice = Array.prototype.slice;\nvar Bacon = {\n  toString: function () {\n    return \"Bacon\";\n  }\n};\n\nBacon.version = '0.7.95';\n\nvar Exception = (typeof global !== \"undefined\" && global !== null ? global : this).Error;\nvar nop = function () {};\nvar latter = function (_, x) {\n  return x;\n};\nvar former = function (x, _) {\n  return x;\n};\nvar cloneArray = function (xs) {\n  return xs.slice(0);\n};\nvar assert = function (message, condition) {\n  if (!condition) {\n    throw new Exception(message);\n  }\n};\nvar assertObservableIsProperty = function (x) {\n  if ((x != null ? x._isObservable : void 0) && !(x != null ? x._isProperty : void 0)) {\n    throw new Exception(\"Observable is not a Property : \" + x);\n  }\n};\nvar assertEventStream = function (event) {\n  if (!(event != null ? event._isEventStream : void 0)) {\n    throw new Exception(\"not an EventStream : \" + event);\n  }\n};\n\nvar assertObservable = function (event) {\n  if (!(event != null ? event._isObservable : void 0)) {\n    throw new Exception(\"not an Observable : \" + event);\n  }\n};\nvar assertFunction = function (f) {\n  return assert(\"not a function : \" + f, _.isFunction(f));\n};\nvar isArray = Array.isArray || function (xs) {\n  return xs instanceof Array;\n};\nvar isObservable = function (x) {\n  return x && x._isObservable;\n};\nvar assertArray = function (xs) {\n  if (!isArray(xs)) {\n    throw new Exception(\"not an array : \" + xs);\n  }\n};\nvar assertNoArguments = function (args) {\n  return assert(\"no arguments supported\", args.length === 0);\n};\nvar assertString = function (x) {\n  if (typeof x === \"string\") {\n    throw new Exception(\"not a string : \" + x);\n  }\n};\n\nvar extend = function (target) {\n  var length = arguments.length;\n  for (var i = 1; 1 < length ? i < length : i > length; 1 < length ? i++ : i--) {\n    for (var prop in arguments[i]) {\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n\nvar inherit = function (child, parent) {\n  var hasProp = ({}).hasOwnProperty;\n  var ctor = function () {};\n  ctor.prototype = parent.prototype;\n  child.prototype = new ctor();\n  for (var key in parent) {\n    if (hasProp.call(parent, key)) {\n      child[key] = parent[key];\n    }\n  }\n  return child;\n};\n\nvar symbol = function (key) {\n  if (typeof Symbol !== \"undefined\" && Symbol[key]) {\n    return Symbol[key];\n  } else if (typeof Symbol !== \"undefined\" && typeof Symbol[\"for\"] === \"function\") {\n    return Symbol[key] = Symbol[\"for\"](key);\n  } else {\n    return \"@@\" + key;\n  }\n};\n\nvar _ = {\n  indexOf: (function () {\n    if (Array.prototype.indexOf) {\n      return function (xs, x) {\n        return xs.indexOf(x);\n      };\n    } else {\n      return function (xs, x) {\n        for (var i = 0, y; i < xs.length; i++) {\n          y = xs[i];\n          if (x === y) {\n            return i;\n          }\n        }\n        return -1;\n      };\n    }\n  })(),\n  indexWhere: function (xs, f) {\n    for (var i = 0, y; i < xs.length; i++) {\n      y = xs[i];\n      if (f(y)) {\n        return i;\n      }\n    }\n    return -1;\n  },\n  head: function (xs) {\n    return xs[0];\n  },\n  always: function (x) {\n    return function () {\n      return x;\n    };\n  },\n  negate: function (f) {\n    return function (x) {\n      return !f(x);\n    };\n  },\n  empty: function (xs) {\n    return xs.length === 0;\n  },\n  tail: function (xs) {\n    return xs.slice(1, xs.length);\n  },\n  filter: function (f, xs) {\n    var filtered = [];\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        filtered.push(x);\n      }\n    }\n    return filtered;\n  },\n  map: function (f, xs) {\n    return (function () {\n      var result = [];\n      for (var i = 0, x; i < xs.length; i++) {\n        x = xs[i];\n        result.push(f(x));\n      }\n      return result;\n    })();\n  },\n  each: function (xs, f) {\n    for (var key in xs) {\n      if (Object.prototype.hasOwnProperty.call(xs, key)) {\n        var value = xs[key];\n        f(key, value);\n      }\n    }\n  },\n  toArray: function (xs) {\n    return isArray(xs) ? xs : [xs];\n  },\n  contains: function (xs, x) {\n    return _.indexOf(xs, x) !== -1;\n  },\n  id: function (x) {\n    return x;\n  },\n  last: function (xs) {\n    return xs[xs.length - 1];\n  },\n  all: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (!f(x)) {\n        return false;\n      }\n    }\n    return true;\n  },\n  any: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        return true;\n      }\n    }\n    return false;\n  },\n  without: function (x, xs) {\n    return _.filter(function (y) {\n      return y !== x;\n    }, xs);\n  },\n  remove: function (x, xs) {\n    var i = _.indexOf(xs, x);\n    if (i >= 0) {\n      return xs.splice(i, 1);\n    }\n  },\n  fold: function (xs, seed, f) {\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      seed = f(seed, x);\n    }\n    return seed;\n  },\n  flatMap: function (f, xs) {\n    return _.fold(xs, [], function (ys, x) {\n      return ys.concat(f(x));\n    });\n  },\n  cached: function (f) {\n    var value = None;\n    return function () {\n      if (typeof value !== \"undefined\" && value !== null ? value._isNone : undefined) {\n        value = f();\n        f = undefined;\n      }\n      return value;\n    };\n  },\n  bind: function (fn, me) {\n    return function () {\n      return fn.apply(me, arguments);\n    };\n  },\n  isFunction: function (f) {\n    return typeof f === \"function\";\n  },\n  toString: function (obj) {\n    var internals, key, value;\n    var hasProp = ({}).hasOwnProperty;\n    try {\n      recursionDepth++;\n      if (obj == null) {\n        return \"undefined\";\n      } else if (_.isFunction(obj)) {\n        return \"function\";\n      } else if (isArray(obj)) {\n        if (recursionDepth > 5) {\n          return \"[..]\";\n        }\n        return \"[\" + _.map(_.toString, obj).toString() + \"]\";\n      } else if ((obj != null ? obj.toString : void 0) != null && obj.toString !== Object.prototype.toString) {\n        return obj.toString();\n      } else if (typeof obj === \"object\") {\n        if (recursionDepth > 5) {\n          return \"{..}\";\n        }\n        internals = (function () {\n          var results = [];\n          for (key in obj) {\n            if (!hasProp.call(obj, key)) continue;\n            value = (function () {\n              var error;\n              try {\n                return obj[key];\n              } catch (error) {\n                return error;\n              }\n            })();\n            results.push(_.toString(key) + \":\" + _.toString(value));\n          }\n          return results;\n        })();\n        return \"{\" + internals + \"}\";\n      } else {\n        return obj;\n      }\n    } finally {\n      recursionDepth--;\n    }\n  }\n};\n\nvar recursionDepth = 0;\n\nBacon._ = _;\n\nvar UpdateBarrier = Bacon.UpdateBarrier = (function () {\n  var rootEvent;\n  var waiterObs = [];\n  var waiters = {};\n  var aftersStack = [];\n  var aftersStackHeight = 0;\n  var flushed = {};\n\n  function ensureStackHeight(h) {\n    if (h <= aftersStackHeight) return;\n    if (!aftersStack[h - 1]) {\n      aftersStack[h - 1] = [[], 0];\n    }\n    aftersStackHeight = h;\n  }\n\n  var afterTransaction = function (obs, f) {\n    if (rootEvent || aftersStack.length) {\n      ensureStackHeight(1);\n      var stackIndexForThisObs = 0;\n      while (stackIndexForThisObs < aftersStackHeight - 1) {\n        if (containsObs(obs, aftersStack[stackIndexForThisObs][0])) {\n          break;\n        }\n        stackIndexForThisObs++;\n      }\n      var listFromStack = aftersStack[stackIndexForThisObs][0];\n      listFromStack.push([obs, f]);\n      if (!rootEvent) {\n        processAfters();\n      }\n    } else {\n        return f();\n      }\n  };\n\n  function containsObs(obs, aftersList) {\n    for (var i = 0; i < aftersList.length; i++) {\n      if (aftersList[i][0].id == obs.id) return true;\n    }\n    return false;\n  }\n\n  function processAfters() {\n    var stackSizeAtStart = aftersStackHeight;\n    if (!stackSizeAtStart) return;\n    while (aftersStackHeight >= stackSizeAtStart) {\n      var topOfStack = aftersStack[aftersStackHeight - 1];\n      if (!topOfStack) throw new Error(\"Unexpected stack top: \" + topOfStack);\n      var topAfters = topOfStack[0];\n      var index = topOfStack[1];\n\n      if (index < topAfters.length) {\n        var _topAfters$index = topAfters[index];\n        var obs = _topAfters$index[0];\n        var after = _topAfters$index[1];\n\n        topOfStack[1]++;\n        ensureStackHeight(aftersStackHeight + 1);\n        var callSuccess = false;\n        try {\n          after();\n          callSuccess = true;\n          while (aftersStackHeight > stackSizeAtStart && aftersStack[aftersStackHeight - 1][0].length == 0) {\n            aftersStackHeight--;\n          }\n        } finally {\n          if (!callSuccess) {\n            aftersStack = [];\n            aftersStackHeight = 0;\n          }\n        }\n      } else {\n          topOfStack[0] = [];\n          topOfStack[1] = 0;\n          break;\n        }\n    }\n  }\n\n  var whenDoneWith = function (obs, f) {\n    if (rootEvent) {\n      var obsWaiters = waiters[obs.id];\n      if (!(typeof obsWaiters !== \"undefined\" && obsWaiters !== null)) {\n        obsWaiters = waiters[obs.id] = [f];\n        return waiterObs.push(obs);\n      } else {\n        return obsWaiters.push(f);\n      }\n    } else {\n      return f();\n    }\n  };\n\n  var flush = function () {\n    while (waiterObs.length > 0) {\n      flushWaiters(0, true);\n    }\n    flushed = {};\n  };\n\n  var flushWaiters = function (index, deps) {\n    var obs = waiterObs[index];\n    var obsId = obs.id;\n    var obsWaiters = waiters[obsId];\n    waiterObs.splice(index, 1);\n    delete waiters[obsId];\n    if (deps && waiterObs.length > 0) {\n      flushDepsOf(obs);\n    }\n    for (var i = 0, f; i < obsWaiters.length; i++) {\n      f = obsWaiters[i];\n      f();\n    }\n  };\n\n  var flushDepsOf = function (obs) {\n    if (flushed[obs.id]) return;\n    var deps = obs.internalDeps();\n    for (var i = 0, dep; i < deps.length; i++) {\n      dep = deps[i];\n      flushDepsOf(dep);\n      if (waiters[dep.id]) {\n        var index = _.indexOf(waiterObs, dep);\n        flushWaiters(index, false);\n      }\n    }\n    flushed[obs.id] = true;\n  };\n\n  var inTransaction = function (event, context, f, args) {\n    if (rootEvent) {\n      return f.apply(context, args);\n    } else {\n      rootEvent = event;\n      try {\n        var result = f.apply(context, args);\n\n        flush();\n      } finally {\n        rootEvent = undefined;\n        processAfters();\n      }\n      return result;\n    }\n  };\n\n  var currentEventId = function () {\n    return rootEvent ? rootEvent.id : undefined;\n  };\n\n  var wrappedSubscribe = function (obs, sink) {\n    var unsubd = false;\n    var shouldUnsub = false;\n    var doUnsub = function () {\n      shouldUnsub = true;\n      return shouldUnsub;\n    };\n    var unsub = function () {\n      unsubd = true;\n      return doUnsub();\n    };\n    doUnsub = obs.dispatcher.subscribe(function (event) {\n      return afterTransaction(obs, function () {\n        if (!unsubd) {\n          var reply = sink(event);\n          if (reply === Bacon.noMore) {\n            return unsub();\n          }\n        }\n      });\n    });\n    if (shouldUnsub) {\n      doUnsub();\n    }\n    return unsub;\n  };\n\n  var hasWaiters = function () {\n    return waiterObs.length > 0;\n  };\n\n  return { whenDoneWith: whenDoneWith, hasWaiters: hasWaiters, inTransaction: inTransaction, currentEventId: currentEventId, wrappedSubscribe: wrappedSubscribe, afterTransaction: afterTransaction };\n})();\n\nfunction Source(obs, sync) {\n  var lazy = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n  this.obs = obs;\n  this.sync = sync;\n  this.lazy = lazy;\n  this.queue = [];\n}\n\nextend(Source.prototype, {\n  _isSource: true,\n\n  subscribe: function (sink) {\n    return this.obs.dispatcher.subscribe(sink);\n  },\n  toString: function () {\n    return this.obs.toString();\n  },\n  markEnded: function () {\n    this.ended = true;\n    return true;\n  },\n  consume: function () {\n    if (this.lazy) {\n      return { value: _.always(this.queue[0]) };\n    } else {\n      return this.queue[0];\n    }\n  },\n  push: function (x) {\n    this.queue = [x];\n    return [x];\n  },\n  mayHave: function () {\n    return true;\n  },\n  hasAtLeast: function () {\n    return this.queue.length;\n  },\n  flatten: true\n});\n\nfunction ConsumingSource() {\n  Source.apply(this, arguments);\n}\n\ninherit(ConsumingSource, Source);\nextend(ConsumingSource.prototype, {\n  consume: function () {\n    return this.queue.shift();\n  },\n  push: function (x) {\n    return this.queue.push(x);\n  },\n  mayHave: function (c) {\n    return !this.ended || this.queue.length >= c;\n  },\n  hasAtLeast: function (c) {\n    return this.queue.length >= c;\n  },\n  flatten: false\n});\n\nfunction BufferingSource(obs) {\n  Source.call(this, obs, true);\n}\n\ninherit(BufferingSource, Source);\nextend(BufferingSource.prototype, {\n  consume: function () {\n    var values = this.queue;\n    this.queue = [];\n    return {\n      value: function () {\n        return values;\n      }\n    };\n  },\n  push: function (x) {\n    return this.queue.push(x.value());\n  },\n  hasAtLeast: function () {\n    return true;\n  }\n});\n\nSource.isTrigger = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s.sync;\n  } else {\n    return s != null ? s._isEventStream : void 0;\n  }\n};\n\nSource.fromObservable = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s;\n  } else if (s != null ? s._isProperty : void 0) {\n    return new Source(s, false);\n  } else {\n    return new ConsumingSource(s, true);\n  }\n};\n\nfunction Desc(context, method, args) {\n  this.context = context;\n  this.method = method;\n  this.args = args;\n}\n\nextend(Desc.prototype, {\n  _isDesc: true,\n  deps: function () {\n    if (!this.cached) {\n      this.cached = findDeps([this.context].concat(this.args));\n    }\n    return this.cached;\n  },\n  toString: function () {\n    return _.toString(this.context) + \".\" + _.toString(this.method) + \"(\" + _.map(_.toString, this.args) + \")\";\n  }\n});\n\nvar describe = function (context, method) {\n  var ref = context || method;\n  if (ref && ref._isDesc) {\n    return context || method;\n  } else {\n    for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n\n    return new Desc(context, method, args);\n  }\n};\n\nvar withDesc = function (desc, obs) {\n  obs.desc = desc;\n  return obs;\n};\n\nvar findDeps = function (x) {\n  if (isArray(x)) {\n    return _.flatMap(findDeps, x);\n  } else if (isObservable(x)) {\n    return [x];\n  } else if (typeof x !== \"undefined\" && x !== null ? x._isSource : undefined) {\n    return [x.obs];\n  } else {\n    return [];\n  }\n};\n\nBacon.Desc = Desc;\nBacon.Desc.empty = new Bacon.Desc(\"\", \"\", []);\n\nvar withMethodCallSupport = function (wrapped) {\n  return function (f) {\n    for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    if (typeof f === \"object\" && args.length) {\n      var context = f;\n      var methodName = args[0];\n      f = function () {\n        return context[methodName].apply(context, arguments);\n      };\n      args = args.slice(1);\n    }\n    return wrapped.apply(undefined, [f].concat(args));\n  };\n};\n\nvar makeFunctionArgs = function (args) {\n  args = Array.prototype.slice.call(args);\n  return makeFunction_.apply(undefined, args);\n};\n\nvar partiallyApplied = function (f, applied) {\n  return function () {\n    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return f.apply(undefined, applied.concat(args));\n  };\n};\n\nvar toSimpleExtractor = function (args) {\n  return function (key) {\n    return function (value) {\n      if (!(typeof value !== \"undefined\" && value !== null)) {\n        return;\n      } else {\n        var fieldValue = value[key];\n        if (_.isFunction(fieldValue)) {\n          return fieldValue.apply(value, args);\n        } else {\n          return fieldValue;\n        }\n      }\n    };\n  };\n};\n\nvar toFieldExtractor = function (f, args) {\n  var parts = f.slice(1).split(\".\");\n  var partFuncs = _.map(toSimpleExtractor(args), parts);\n  return function (value) {\n    for (var i = 0, f; i < partFuncs.length; i++) {\n      f = partFuncs[i];\n      value = f(value);\n    }\n    return value;\n  };\n};\n\nvar isFieldKey = function (f) {\n  return typeof f === \"string\" && f.length > 1 && f.charAt(0) === \".\";\n};\n\nvar makeFunction_ = withMethodCallSupport(function (f) {\n  for (var _len4 = arguments.length, args = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n    args[_key4 - 1] = arguments[_key4];\n  }\n\n  if (_.isFunction(f)) {\n    if (args.length) {\n      return partiallyApplied(f, args);\n    } else {\n      return f;\n    }\n  } else if (isFieldKey(f)) {\n    return toFieldExtractor(f, args);\n  } else {\n    return _.always(f);\n  }\n});\n\nvar makeFunction = function (f, args) {\n  return makeFunction_.apply(undefined, [f].concat(args));\n};\n\nvar convertArgsToFunction = function (obs, f, args, method) {\n  if (typeof f !== \"undefined\" && f !== null ? f._isProperty : undefined) {\n    var sampled = f.sampledBy(obs, function (p, s) {\n      return [p, s];\n    });\n    return method.call(sampled, function (_ref) {\n      var p = _ref[0];\n      var s = _ref[1];\n      return p;\n    }).map(function (_ref2) {\n      var p = _ref2[0];\n      var s = _ref2[1];\n      return s;\n    });\n  } else {\n    f = makeFunction(f, args);\n    return method.call(obs, f);\n  }\n};\n\nvar toCombinator = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else if (isFieldKey(f)) {\n    var key = toFieldKey(f);\n    return function (left, right) {\n      return left[key](right);\n    };\n  } else {\n    throw new Exception(\"not a function or a field key: \" + f);\n  }\n};\n\nvar toFieldKey = function (f) {\n  return f.slice(1);\n};\n\nfunction Some(value) {\n  this.value = value;\n}\n\nextend(Some.prototype, {\n  _isSome: true,\n  getOrElse: function () {\n    return this.value;\n  },\n  get: function () {\n    return this.value;\n  },\n  filter: function (f) {\n    if (f(this.value)) {\n      return new Some(this.value);\n    } else {\n      return None;\n    }\n  },\n  map: function (f) {\n    return new Some(f(this.value));\n  },\n  forEach: function (f) {\n    return f(this.value);\n  },\n  isDefined: true,\n  toArray: function () {\n    return [this.value];\n  },\n  inspect: function () {\n    return \"Some(\" + this.value + \")\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n});\n\nvar None = {\n  _isNone: true,\n  getOrElse: function (value) {\n    return value;\n  },\n  filter: function () {\n    return None;\n  },\n  map: function () {\n    return None;\n  },\n  forEach: function () {},\n  isDefined: false,\n  toArray: function () {\n    return [];\n  },\n  inspect: function () {\n    return \"None\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n};\n\nvar toOption = function (v) {\n  if ((typeof v !== \"undefined\" && v !== null ? v._isSome : undefined) || (typeof v !== \"undefined\" && v !== null ? v._isNone : undefined)) {\n    return v;\n  } else {\n    return new Some(v);\n  }\n};\n\nBacon.noMore = \"<no-more>\";\nBacon.more = \"<more>\";\n\nvar eventIdCounter = 0;\n\nfunction Event() {\n  this.id = ++eventIdCounter;\n}\n\nEvent.prototype._isEvent = true;\nEvent.prototype.isEvent = function () {\n  return true;\n};\nEvent.prototype.isEnd = function () {\n  return false;\n};\nEvent.prototype.isInitial = function () {\n  return false;\n};\nEvent.prototype.isNext = function () {\n  return false;\n};\nEvent.prototype.isError = function () {\n  return false;\n};\nEvent.prototype.hasValue = function () {\n  return false;\n};\nEvent.prototype.filter = function () {\n  return true;\n};\nEvent.prototype.inspect = function () {\n  return this.toString();\n};\nEvent.prototype.log = function () {\n  return this.toString();\n};\n\nfunction Next(valueF, eager) {\n  if (!(this instanceof Next)) {\n    return new Next(valueF, eager);\n  }\n\n  Event.call(this);\n\n  if (!eager && _.isFunction(valueF) || (valueF != null ? valueF._isNext : void 0)) {\n    this.valueF = valueF;\n    this.valueInternal = void 0;\n  } else {\n    this.valueF = void 0;\n    this.valueInternal = valueF;\n  }\n}\n\ninherit(Next, Event);\n\nNext.prototype.isNext = function () {\n  return true;\n};\nNext.prototype.hasValue = function () {\n  return true;\n};\nNext.prototype.value = function () {\n  var ref;\n  if ((ref = this.valueF) != null ? ref._isNext : void 0) {\n    this.valueInternal = this.valueF.value();\n    this.valueF = void 0;\n  } else if (this.valueF) {\n    this.valueInternal = this.valueF();\n    this.valueF = void 0;\n  }\n  return this.valueInternal;\n};\n\nNext.prototype.fmap = function (f) {\n  var event, value;\n  if (this.valueInternal) {\n    value = this.valueInternal;\n    return this.apply(function () {\n      return f(value);\n    });\n  } else {\n    event = this;\n    return this.apply(function () {\n      return f(event.value());\n    });\n  }\n};\n\nNext.prototype.apply = function (value) {\n  return new Next(value);\n};\nNext.prototype.filter = function (f) {\n  return f(this.value());\n};\nNext.prototype.toString = function () {\n  return _.toString(this.value());\n};\nNext.prototype.log = function () {\n  return this.value();\n};\nNext.prototype._isNext = true;\n\nfunction Initial(valueF, eager) {\n  if (!(this instanceof Initial)) {\n    return new Initial(valueF, eager);\n  }\n  Next.call(this, valueF, eager);\n}\n\ninherit(Initial, Next);\nInitial.prototype._isInitial = true;\nInitial.prototype.isInitial = function () {\n  return true;\n};\nInitial.prototype.isNext = function () {\n  return false;\n};\nInitial.prototype.apply = function (value) {\n  return new Initial(value);\n};\nInitial.prototype.toNext = function () {\n  return new Next(this);\n};\n\nfunction End() {\n  if (!(this instanceof End)) {\n    return new End();\n  }\n  Event.call(this);\n}\n\ninherit(End, Event);\nEnd.prototype.isEnd = function () {\n  return true;\n};\nEnd.prototype.fmap = function () {\n  return this;\n};\nEnd.prototype.apply = function () {\n  return this;\n};\nEnd.prototype.toString = function () {\n  return \"<end>\";\n};\n\nfunction Error(error) {\n  if (!(this instanceof Error)) {\n    return new Error(error);\n  }\n  this.error = error;\n  Event.call(this);\n}\n\ninherit(Error, Event);\nError.prototype.isError = function () {\n  return true;\n};\nError.prototype.fmap = function () {\n  return this;\n};\nError.prototype.apply = function () {\n  return this;\n};\nError.prototype.toString = function () {\n  return \"<error> \" + _.toString(this.error);\n};\n\nBacon.Event = Event;\nBacon.Initial = Initial;\nBacon.Next = Next;\nBacon.End = End;\nBacon.Error = Error;\n\nvar initialEvent = function (value) {\n  return new Initial(value, true);\n};\nvar nextEvent = function (value) {\n  return new Next(value, true);\n};\nvar endEvent = function () {\n  return new End();\n};\nvar toEvent = function (x) {\n  if (x && x._isEvent) {\n    return x;\n  } else {\n    return nextEvent(x);\n  }\n};\n\nvar idCounter = 0;\nvar registerObs = function () {};\n\nfunction Observable(desc) {\n  this.desc = desc;\n  this.id = ++idCounter;\n  this.initialDesc = this.desc;\n}\n\nextend(Observable.prototype, {\n  _isObservable: true,\n\n  subscribe: function (sink) {\n    return UpdateBarrier.wrappedSubscribe(this, sink);\n  },\n\n  subscribeInternal: function (sink) {\n    return this.dispatcher.subscribe(sink);\n  },\n\n  onValue: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.hasValue()) {\n        return f(event.value());\n      }\n    });\n  },\n\n  onValues: function (f) {\n    return this.onValue(function (args) {\n      return f.apply(undefined, args);\n    });\n  },\n\n  onError: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isError()) {\n        return f(event.error);\n      }\n    });\n  },\n\n  onEnd: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isEnd()) {\n        return f();\n      }\n    });\n  },\n\n  name: function (name) {\n    this._name = name;\n    return this;\n  },\n\n  withDescription: function () {\n    this.desc = describe.apply(undefined, arguments);\n    return this;\n  },\n\n  toString: function () {\n    if (this._name) {\n      return this._name;\n    } else {\n      return this.desc.toString();\n    }\n  },\n\n  deps: function () {\n    return this.desc.deps();\n  },\n\n  internalDeps: function () {\n    return this.initialDesc.deps();\n  }\n});\n\nObservable.prototype.assign = Observable.prototype.onValue;\nObservable.prototype.forEach = Observable.prototype.onValue;\nObservable.prototype.inspect = Observable.prototype.toString;\n\nBacon.Observable = Observable;\n\nfunction CompositeUnsubscribe() {\n  var ss = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\n  this.unsubscribe = _.bind(this.unsubscribe, this);\n  this.unsubscribed = false;\n  this.subscriptions = [];\n  this.starting = [];\n  for (var i = 0, s; i < ss.length; i++) {\n    s = ss[i];\n    this.add(s);\n  }\n}\n\nextend(CompositeUnsubscribe.prototype, {\n  add: function (subscription) {\n    var _this2 = this;\n\n    if (this.unsubscribed) {\n      return;\n    }\n    var ended = false;\n    var unsub = nop;\n    this.starting.push(subscription);\n    var unsubMe = function () {\n      if (_this2.unsubscribed) {\n        return;\n      }\n      ended = true;\n      _this2.remove(unsub);\n      return _.remove(subscription, _this2.starting);\n    };\n    unsub = subscription(this.unsubscribe, unsubMe);\n    if (!(this.unsubscribed || ended)) {\n      this.subscriptions.push(unsub);\n    } else {\n      unsub();\n    }\n    _.remove(subscription, this.starting);\n    return unsub;\n  },\n\n  remove: function (unsub) {\n    if (this.unsubscribed) {\n      return;\n    }\n    if (_.remove(unsub, this.subscriptions) !== undefined) {\n      return unsub();\n    }\n  },\n\n  unsubscribe: function () {\n    if (this.unsubscribed) {\n      return;\n    }\n    this.unsubscribed = true;\n    var iterable = this.subscriptions;\n    for (var i = 0; i < iterable.length; i++) {\n      iterable[i]();\n    }\n    this.subscriptions = [];\n    this.starting = [];\n    return [];\n  },\n\n  count: function () {\n    if (this.unsubscribed) {\n      return 0;\n    }\n    return this.subscriptions.length + this.starting.length;\n  },\n\n  empty: function () {\n    return this.count() === 0;\n  }\n});\n\nBacon.CompositeUnsubscribe = CompositeUnsubscribe;\n\nfunction Dispatcher(_subscribe, _handleEvent) {\n  this._subscribe = _subscribe;\n  this._handleEvent = _handleEvent;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.handleEvent = _.bind(this.handleEvent, this);\n  this.pushing = false;\n  this.ended = false;\n  this.prevError = undefined;\n  this.unsubSrc = undefined;\n  this.subscriptions = [];\n  this.queue = [];\n}\n\nDispatcher.prototype.hasSubscribers = function () {\n  return this.subscriptions.length > 0;\n};\n\nDispatcher.prototype.removeSub = function (subscription) {\n  this.subscriptions = _.without(subscription, this.subscriptions);\n  return this.subscriptions;\n};\n\nDispatcher.prototype.push = function (event) {\n  if (event.isEnd()) {\n    this.ended = true;\n  }\n  return UpdateBarrier.inTransaction(event, this, this.pushIt, [event]);\n};\n\nDispatcher.prototype.pushToSubscriptions = function (event) {\n  try {\n    var tmp = this.subscriptions;\n    var len = tmp.length;\n    for (var i = 0; i < len; i++) {\n      var sub = tmp[i];\n      var reply = sub.sink(event);\n      if (reply === Bacon.noMore || event.isEnd()) {\n        this.removeSub(sub);\n      }\n    }\n    return true;\n  } catch (error) {\n    this.pushing = false;\n    this.queue = [];\n    throw error;\n  }\n};\n\nDispatcher.prototype.pushIt = function (event) {\n  if (!this.pushing) {\n    if (event === this.prevError) {\n      return;\n    }\n    if (event.isError()) {\n      this.prevError = event;\n    }\n    this.pushing = true;\n    this.pushToSubscriptions(event);\n    this.pushing = false;\n    while (this.queue.length) {\n      event = this.queue.shift();\n      this.push(event);\n    }\n    if (this.hasSubscribers()) {\n      return Bacon.more;\n    } else {\n      this.unsubscribeFromSource();\n      return Bacon.noMore;\n    }\n  } else {\n    this.queue.push(event);\n    return Bacon.more;\n  }\n};\n\nDispatcher.prototype.handleEvent = function (event) {\n  if (this._handleEvent) {\n    return this._handleEvent(event);\n  } else {\n    return this.push(event);\n  }\n};\n\nDispatcher.prototype.unsubscribeFromSource = function () {\n  if (this.unsubSrc) {\n    this.unsubSrc();\n  }\n  this.unsubSrc = undefined;\n};\n\nDispatcher.prototype.subscribe = function (sink) {\n  var subscription;\n  if (this.ended) {\n    sink(endEvent());\n    return nop;\n  } else {\n    assertFunction(sink);\n    subscription = {\n      sink: sink\n    };\n    this.subscriptions.push(subscription);\n    if (this.subscriptions.length === 1) {\n      this.unsubSrc = this._subscribe(this.handleEvent);\n      assertFunction(this.unsubSrc);\n    }\n    return (function (_this) {\n      return function () {\n        _this.removeSub(subscription);\n        if (!_this.hasSubscribers()) {\n          return _this.unsubscribeFromSource();\n        }\n      };\n    })(this);\n  }\n};\n\nBacon.Dispatcher = Dispatcher;\n\nfunction EventStream(desc, subscribe, handler) {\n  if (!(this instanceof EventStream)) {\n    return new EventStream(desc, subscribe, handler);\n  }\n  if (_.isFunction(desc)) {\n    handler = subscribe;\n    subscribe = desc;\n    desc = Desc.empty;\n  }\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new Dispatcher(subscribe, handler);\n  registerObs(this);\n}\n\ninherit(EventStream, Observable);\nextend(EventStream.prototype, {\n  _isEventStream: true,\n\n  toProperty: function (initValue_) {\n    var initValue = arguments.length === 0 ? None : toOption(function () {\n      return initValue_;\n    });\n    var disp = this.dispatcher;\n    var desc = new Bacon.Desc(this, \"toProperty\", [initValue_]);\n    return new Property(desc, function (sink) {\n      var initSent = false;\n      var subbed = false;\n      var unsub = nop;\n      var reply = Bacon.more;\n      var sendInit = function () {\n        if (!initSent) {\n          return initValue.forEach(function (value) {\n            initSent = true;\n            reply = sink(new Initial(value));\n            if (reply === Bacon.noMore) {\n              unsub();\n              unsub = nop;\n              return nop;\n            }\n          });\n        }\n      };\n\n      unsub = disp.subscribe(function (event) {\n        if (event.hasValue()) {\n          if (event.isInitial() && !subbed) {\n            initValue = new Some(function () {\n              return event.value();\n            });\n            return Bacon.more;\n          } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = true;\n            initValue = new Some(event);\n            return sink(event);\n          }\n        } else {\n          if (event.isEnd()) {\n            reply = sendInit();\n          }\n          if (reply !== Bacon.noMore) {\n            return sink(event);\n          }\n        }\n      });\n      subbed = true;\n      sendInit();\n      return unsub;\n    });\n  },\n\n  toEventStream: function () {\n    return this;\n  },\n\n  withHandler: function (handler) {\n    return new EventStream(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  }\n});\n\nBacon.EventStream = EventStream;\n\nBacon.never = function () {\n  return new EventStream(describe(Bacon, \"never\"), function (sink) {\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.when = function () {\n  if (arguments.length === 0) {\n    return Bacon.never();\n  }\n  var len = arguments.length;\n  var usage = \"when: expecting arguments in the form (Observable+,function)+\";\n\n  assert(usage, len % 2 === 0);\n  var sources = [];\n  var pats = [];\n  var i = 0;\n  var patterns = [];\n  while (i < len) {\n    patterns[i] = arguments[i];\n    patterns[i + 1] = arguments[i + 1];\n    var patSources = _.toArray(arguments[i]);\n    var f = constantToFunction(arguments[i + 1]);\n    var pat = { f: f, ixs: [] };\n    var triggerFound = false;\n    for (var j = 0, s; j < patSources.length; j++) {\n      s = patSources[j];\n      var index = _.indexOf(sources, s);\n      if (!triggerFound) {\n        triggerFound = Source.isTrigger(s);\n      }\n      if (index < 0) {\n        sources.push(s);\n        index = sources.length - 1;\n      }\n      for (var k = 0, ix; k < pat.ixs.length; k++) {\n        ix = pat.ixs[k];\n        if (ix.index === index) {\n          ix.count++;\n        }\n      }\n      pat.ixs.push({ index: index, count: 1 });\n    }\n\n    assert(\"At least one EventStream required\", triggerFound || !patSources.length);\n\n    if (patSources.length > 0) {\n      pats.push(pat);\n    }\n    i = i + 2;\n  }\n\n  if (!sources.length) {\n    return Bacon.never();\n  }\n\n  sources = _.map(Source.fromObservable, sources);\n  var needsBarrier = _.any(sources, function (s) {\n    return s.flatten;\n  }) && containsDuplicateDeps(_.map(function (s) {\n    return s.obs;\n  }, sources));\n\n  var desc = new Bacon.Desc(Bacon, \"when\", patterns);\n  var resultStream = new EventStream(desc, function (sink) {\n    var triggers = [];\n    var ends = false;\n    var match = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].hasAtLeast(i.count)) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var cannotSync = function (source) {\n      return !source.sync || source.ended;\n    };\n    var cannotMatch = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].mayHave(i.count)) {\n          return true;\n        }\n      }\n    };\n    var nonFlattened = function (trigger) {\n      return !trigger.source.flatten;\n    };\n    var part = function (source) {\n      return function (unsubAll) {\n        var flushLater = function () {\n          return UpdateBarrier.whenDoneWith(resultStream, flush);\n        };\n        var flushWhileTriggers = function () {\n          if (triggers.length > 0) {\n            var reply = Bacon.more;\n            var trigger = triggers.pop();\n            for (var i1 = 0, p; i1 < pats.length; i1++) {\n              p = pats[i1];\n              if (match(p)) {\n                var events = (function () {\n                  var result = [];\n                  for (var i2 = 0, i; i2 < p.ixs.length; i2++) {\n                    i = p.ixs[i2];\n                    result.push(sources[i.index].consume());\n                  }\n                  return result;\n                })();\n                reply = sink(trigger.e.apply(function () {\n                  var _p;\n\n                  var values = (function () {\n                    var result = [];\n                    for (var i2 = 0, event; i2 < events.length; i2++) {\n                      event = events[i2];\n                      result.push(event.value());\n                    }\n                    return result;\n                  })();\n\n                  return (_p = p).f.apply(_p, values);\n                }));\n                if (triggers.length) {\n                  triggers = _.filter(nonFlattened, triggers);\n                }\n                if (reply === Bacon.noMore) {\n                  return reply;\n                } else {\n                  return flushWhileTriggers();\n                }\n              }\n            }\n          } else {\n            return Bacon.more;\n          }\n        };\n        var flush = function () {\n          var reply = flushWhileTriggers();\n          if (ends) {\n            if (_.all(sources, cannotSync) || _.all(pats, cannotMatch)) {\n              reply = Bacon.noMore;\n              sink(endEvent());\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n\n          return reply;\n        };\n        return source.subscribe(function (e) {\n          if (e.isEnd()) {\n            ends = true;\n            source.markEnded();\n            flushLater();\n          } else if (e.isError()) {\n            var reply = sink(e);\n          } else {\n            source.push(e);\n            if (source.sync) {\n              triggers.push({ source: source, e: e });\n              if (needsBarrier || UpdateBarrier.hasWaiters()) {\n                flushLater();\n              } else {\n                flush();\n              }\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n          return reply || Bacon.more;\n        });\n      };\n    };\n\n    return new Bacon.CompositeUnsubscribe((function () {\n      var result = [];\n      for (var i1 = 0, s; i1 < sources.length; i1++) {\n        s = sources[i1];\n        result.push(part(s));\n      }\n      return result;\n    })()).unsubscribe;\n  });\n  return resultStream;\n};\n\nvar containsDuplicateDeps = function (observables) {\n  var state = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  var checkObservable = function (obs) {\n    if (_.contains(state, obs)) {\n      return true;\n    } else {\n      var deps = obs.internalDeps();\n      if (deps.length) {\n        state.push(obs);\n        return _.any(deps, checkObservable);\n      } else {\n        state.push(obs);\n        return false;\n      }\n    }\n  };\n\n  return _.any(observables, checkObservable);\n};\n\nvar constantToFunction = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else {\n    return _.always(f);\n  }\n};\n\nBacon.groupSimultaneous = function () {\n  for (var _len5 = arguments.length, streams = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n    streams[_key5] = arguments[_key5];\n  }\n\n  if (streams.length === 1 && isArray(streams[0])) {\n    streams = streams[0];\n  }\n  var sources = (function () {\n    var result = [];\n    for (var i = 0, s; i < streams.length; i++) {\n      s = streams[i];\n      result.push(new BufferingSource(s));\n    }\n    return result;\n  })();\n  return withDesc(new Bacon.Desc(Bacon, \"groupSimultaneous\", streams), Bacon.when(sources, function () {\n    for (var _len6 = arguments.length, xs = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n      xs[_key6] = arguments[_key6];\n    }\n\n    return xs;\n  }));\n};\n\nfunction PropertyDispatcher(property, subscribe, handleEvent) {\n  Dispatcher.call(this, subscribe, handleEvent);\n  this.property = property;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.current = None;\n  this.currentValueRootId = undefined;\n  this.propertyEnded = false;\n}\n\ninherit(PropertyDispatcher, Dispatcher);\nextend(PropertyDispatcher.prototype, {\n  push: function (event) {\n    if (event.isEnd()) {\n      this.propertyEnded = true;\n    }\n    if (event.hasValue()) {\n      this.current = new Some(event);\n      this.currentValueRootId = UpdateBarrier.currentEventId();\n    }\n    return Dispatcher.prototype.push.call(this, event);\n  },\n\n  maybeSubSource: function (sink, reply) {\n    if (reply === Bacon.noMore) {\n      return nop;\n    } else if (this.propertyEnded) {\n      sink(endEvent());\n      return nop;\n    } else {\n      return Dispatcher.prototype.subscribe.call(this, sink);\n    }\n  },\n\n  subscribe: function (sink) {\n    var _this3 = this;\n\n    var initSent = false;\n\n    var reply = Bacon.more;\n\n    if (this.current.isDefined && (this.hasSubscribers() || this.propertyEnded)) {\n      var dispatchingId = UpdateBarrier.currentEventId();\n      var valId = this.currentValueRootId;\n      if (!this.propertyEnded && valId && dispatchingId && dispatchingId !== valId) {\n        UpdateBarrier.whenDoneWith(this.property, function () {\n          if (_this3.currentValueRootId === valId) {\n            return sink(initialEvent(_this3.current.get().value()));\n          }\n        });\n\n        return this.maybeSubSource(sink, reply);\n      } else {\n        UpdateBarrier.inTransaction(undefined, this, function () {\n          reply = sink(initialEvent(this.current.get().value()));\n          return reply;\n        }, []);\n        return this.maybeSubSource(sink, reply);\n      }\n    } else {\n      return this.maybeSubSource(sink, reply);\n    }\n  }\n});\n\nfunction Property(desc, subscribe, handler) {\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new PropertyDispatcher(this, subscribe, handler);\n  registerObs(this);\n}\n\ninherit(Property, Observable);\nextend(Property.prototype, {\n  _isProperty: true,\n\n  changes: function () {\n    var _this4 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"changes\", []), function (sink) {\n      return _this4.dispatcher.subscribe(function (event) {\n        if (!event.isInitial()) {\n          return sink(event);\n        }\n      });\n    });\n  },\n\n  withHandler: function (handler) {\n    return new Property(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  },\n\n  toProperty: function () {\n    assertNoArguments(arguments);\n    return this;\n  },\n\n  toEventStream: function () {\n    var _this5 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"toEventStream\", []), function (sink) {\n      return _this5.dispatcher.subscribe(function (event) {\n        if (event.isInitial()) {\n          event = event.toNext();\n        }\n        return sink(event);\n      });\n    });\n  }\n});\n\nBacon.Property = Property;\n\nBacon.constant = function (value) {\n  return new Property(new Bacon.Desc(Bacon, \"constant\", [value]), function (sink) {\n    sink(initialEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.fromBinder = function (binder) {\n  var eventTransformer = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromBinder\", [binder, eventTransformer]);\n  return new EventStream(desc, function (sink) {\n    var unbound = false;\n    var shouldUnbind = false;\n    var unbind = function () {\n      if (!unbound) {\n        if (typeof unbinder !== \"undefined\" && unbinder !== null) {\n          unbinder();\n          return unbound = true;\n        } else {\n          return shouldUnbind = true;\n        }\n      }\n    };\n    var unbinder = binder(function () {\n      var ref;\n\n      for (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n        args[_key7] = arguments[_key7];\n      }\n\n      var value = eventTransformer.apply(this, args);\n      if (!(isArray(value) && ((ref = _.last(value)) != null ? ref._isEvent : undefined))) {\n        value = [value];\n      }\n      var reply = Bacon.more;\n      for (var i = 0, event; i < value.length; i++) {\n        event = value[i];\n        reply = sink(event = toEvent(event));\n        if (reply === Bacon.noMore || event.isEnd()) {\n          unbind();\n          return reply;\n        }\n      }\n      return reply;\n    });\n    if (shouldUnbind) {\n      unbind();\n    }\n    return unbind;\n  });\n};\n\nBacon.Observable.prototype.map = function (p) {\n  for (var _len8 = arguments.length, args = Array(_len8 > 1 ? _len8 - 1 : 0), _key8 = 1; _key8 < _len8; _key8++) {\n    args[_key8 - 1] = arguments[_key8];\n  }\n\n  return convertArgsToFunction(this, p, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n      return this.push(event.fmap(f));\n    }));\n  });\n};\n\nvar argumentsToObservables = function (args) {\n  if (isArray(args[0])) {\n    return args[0];\n  } else {\n    return Array.prototype.slice.call(args);\n  }\n};\n\nvar argumentsToObservablesAndFunction = function (args) {\n  if (_.isFunction(args[0])) {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 1)), args[0]];\n  } else {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 0, args.length - 1)), _.last(args)];\n  }\n};\n\nBacon.combineAsArray = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    var sources = [];\n    for (var i = 0; i < streams.length; i++) {\n      var stream = isObservable(streams[i]) ? streams[i] : Bacon.constant(streams[i]);\n      sources.push(new Source(stream, true));\n    }\n    return withDesc(new Bacon.Desc(Bacon, \"combineAsArray\", streams), Bacon.when(sources, function () {\n      for (var _len9 = arguments.length, xs = Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n        xs[_key9] = arguments[_key9];\n      }\n\n      return xs;\n    }).toProperty());\n  } else {\n    return Bacon.constant([]);\n  }\n};\n\nBacon.onValues = function () {\n  return Bacon.combineAsArray(Array.prototype.slice.call(arguments, 0, arguments.length - 1)).onValues(arguments[arguments.length - 1]);\n};\n\nBacon.combineWith = function () {\n  var _argumentsToObservablesAndFunction = argumentsToObservablesAndFunction(arguments);\n\n  var streams = _argumentsToObservablesAndFunction[0];\n  var f = _argumentsToObservablesAndFunction[1];\n\n  var desc = new Bacon.Desc(Bacon, \"combineWith\", [f].concat(streams));\n  return withDesc(desc, Bacon.combineAsArray(streams).map(function (values) {\n    return f.apply(undefined, values);\n  }));\n};\n\nBacon.Observable.prototype.combine = function (other, f) {\n  var combinator = toCombinator(f);\n  var desc = new Bacon.Desc(this, \"combine\", [other, f]);\n  return withDesc(desc, Bacon.combineAsArray(this, other).map(function (values) {\n    return combinator(values[0], values[1]);\n  }));\n};\n\nBacon.Observable.prototype.withStateMachine = function (initState, f) {\n  var state = initState;\n  var desc = new Bacon.Desc(this, \"withStateMachine\", [initState, f]);\n  return withDesc(desc, this.withHandler(function (event) {\n    var fromF = f(state, event);\n    var newState = fromF[0];\n    var outputs = fromF[1];\n\n    state = newState;\n    var reply = Bacon.more;\n    for (var i = 0, output; i < outputs.length; i++) {\n      output = outputs[i];\n      reply = this.push(output);\n      if (reply === Bacon.noMore) {\n        return reply;\n      }\n    }\n    return reply;\n  }));\n};\n\nvar equals = function (a, b) {\n  return a === b;\n};\n\nvar isNone = function (object) {\n  return typeof object !== \"undefined\" && object !== null ? object._isNone : false;\n};\n\nBacon.Observable.prototype.skipDuplicates = function () {\n  var isEqual = arguments.length <= 0 || arguments[0] === undefined ? equals : arguments[0];\n\n  var desc = new Bacon.Desc(this, \"skipDuplicates\", []);\n  return withDesc(desc, this.withStateMachine(None, function (prev, event) {\n    if (!event.hasValue()) {\n      return [prev, [event]];\n    } else if (event.isInitial() || isNone(prev) || !isEqual(prev.get(), event.value())) {\n      return [new Some(event.value()), [event]];\n    } else {\n      return [prev, []];\n    }\n  }));\n};\n\nBacon.Observable.prototype.awaiting = function (other) {\n  var desc = new Bacon.Desc(this, \"awaiting\", [other]);\n  return withDesc(desc, Bacon.groupSimultaneous(this, other).map(function (values) {\n    return values[1].length === 0;\n  }).toProperty(false).skipDuplicates());\n};\n\nBacon.Observable.prototype.not = function () {\n  return withDesc(new Bacon.Desc(this, \"not\", []), this.map(function (x) {\n    return !x;\n  }));\n};\n\nBacon.Property.prototype.and = function (other) {\n  return withDesc(new Bacon.Desc(this, \"and\", [other]), this.combine(other, function (x, y) {\n    return x && y;\n  }));\n};\n\nBacon.Property.prototype.or = function (other) {\n  return withDesc(new Bacon.Desc(this, \"or\", [other]), this.combine(other, function (x, y) {\n    return x || y;\n  }));\n};\n\nBacon.scheduler = {\n  setTimeout: function (f, d) {\n    return setTimeout(f, d);\n  },\n  setInterval: function (f, i) {\n    return setInterval(f, i);\n  },\n  clearInterval: function (id) {\n    return clearInterval(id);\n  },\n  clearTimeout: function (id) {\n    return clearTimeout(id);\n  },\n  now: function () {\n    return new Date().getTime();\n  }\n};\n\nBacon.EventStream.prototype.bufferWithTime = function (delay) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithTime\", [delay]), this.bufferWithTimeOrCount(delay, Number.MAX_VALUE));\n};\n\nBacon.EventStream.prototype.bufferWithCount = function (count) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithCount\", [count]), this.bufferWithTimeOrCount(undefined, count));\n};\n\nBacon.EventStream.prototype.bufferWithTimeOrCount = function (delay, count) {\n  var flushOrSchedule = function (buffer) {\n    if (buffer.values.length === count) {\n      return buffer.flush();\n    } else if (delay !== undefined) {\n      return buffer.schedule();\n    }\n  };\n  var desc = new Bacon.Desc(this, \"bufferWithTimeOrCount\", [delay, count]);\n  return withDesc(desc, this.buffer(delay, flushOrSchedule, flushOrSchedule));\n};\n\nBacon.EventStream.prototype.buffer = function (delay) {\n  var onInput = arguments.length <= 1 || arguments[1] === undefined ? nop : arguments[1];\n  var onFlush = arguments.length <= 2 || arguments[2] === undefined ? nop : arguments[2];\n\n  var buffer = {\n    scheduled: null,\n    end: undefined,\n    values: [],\n    flush: function () {\n      if (this.scheduled) {\n        Bacon.scheduler.clearTimeout(this.scheduled);\n        this.scheduled = null;\n      }\n      if (this.values.length > 0) {\n        var valuesToPush = this.values;\n        this.values = [];\n        var reply = this.push(nextEvent(valuesToPush));\n        if (this.end != null) {\n          return this.push(this.end);\n        } else if (reply !== Bacon.noMore) {\n          return onFlush(this);\n        }\n      } else {\n        if (this.end != null) {\n          return this.push(this.end);\n        }\n      }\n    },\n    schedule: function () {\n      var _this6 = this;\n\n      if (!this.scheduled) {\n        return this.scheduled = delay(function () {\n          return _this6.flush();\n        });\n      }\n    }\n  };\n  var reply = Bacon.more;\n  if (!_.isFunction(delay)) {\n    var delayMs = delay;\n    delay = function (f) {\n      return Bacon.scheduler.setTimeout(f, delayMs);\n    };\n  }\n  return withDesc(new Bacon.Desc(this, \"buffer\", []), this.withHandler(function (event) {\n    var _this7 = this;\n\n    buffer.push = function (event) {\n      return _this7.push(event);\n    };\n    if (event.isError()) {\n      reply = this.push(event);\n    } else if (event.isEnd()) {\n      buffer.end = event;\n      if (!buffer.scheduled) {\n        buffer.flush();\n      }\n    } else {\n      buffer.values.push(event.value());\n\n      onInput(buffer);\n    }\n    return reply;\n  }));\n};\n\nBacon.Observable.prototype.filter = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len10 = arguments.length, args = Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n    args[_key10 - 1] = arguments[_key10];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"filter\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.once = function (value) {\n  return new EventStream(new Desc(Bacon, \"once\", [value]), function (sink) {\n    sink(toEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.EventStream.prototype.concat = function (right) {\n  var left = this;\n  return new EventStream(new Bacon.Desc(left, \"concat\", [right]), function (sink) {\n    var unsubRight = nop;\n    var unsubLeft = left.dispatcher.subscribe(function (e) {\n      if (e.isEnd()) {\n        unsubRight = right.toEventStream().dispatcher.subscribe(sink);\n        return unsubRight;\n      } else {\n        return sink(e);\n      }\n    });\n    return function () {\n      return unsubLeft(), unsubRight();\n    };\n  });\n};\n\nBacon.Property.prototype.concat = function (right) {\n  return addPropertyInitValueToStream(this, this.changes().concat(right));\n};\n\nBacon.concatAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"concatAll\", streams), _.fold(_.tail(streams), _.head(streams).toEventStream(), function (a, b) {\n      return a.concat(b);\n    }));\n  } else {\n    return Bacon.never();\n  }\n};\n\nvar addPropertyInitValueToStream = function (property, stream) {\n  var justInitValue = new EventStream(describe(property, \"justInitValue\"), function (sink) {\n    var value = undefined;\n    var unsub = property.dispatcher.subscribe(function (event) {\n      if (!event.isEnd()) {\n        value = event;\n      }\n      return Bacon.noMore;\n    });\n    UpdateBarrier.whenDoneWith(justInitValue, function () {\n      if (typeof value !== \"undefined\" && value !== null) {\n        sink(value);\n      }\n      return sink(endEvent());\n    });\n    return unsub;\n  });\n  return justInitValue.concat(stream).toProperty();\n};\n\nBacon.Observable.prototype.flatMap = function () {\n  return flatMap_(this, makeSpawner(arguments));\n};\n\nBacon.Observable.prototype.flatMapFirst = function () {\n  return flatMap_(this, makeSpawner(arguments), true);\n};\n\nvar makeSpawner = function (args) {\n  if (args.length === 1 && isObservable(args[0])) {\n    return _.always(args[0]);\n  } else {\n    return makeFunctionArgs(args);\n  }\n};\n\nvar makeObservable = function (x) {\n  if (isObservable(x)) {\n    return x;\n  } else {\n    return Bacon.once(x);\n  }\n};\n\nvar flatMap_ = function (root, f, firstOnly, limit) {\n  var rootDep = [root];\n  var childDeps = [];\n  var desc = new Bacon.Desc(root, \"flatMap\" + (firstOnly ? \"First\" : \"\"), [f]);\n  var result = new EventStream(desc, function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var queue = [];\n    var spawn = function (event) {\n      var child = makeObservable(f(event.value()));\n      childDeps.push(child);\n      return composite.add(function (unsubAll, unsubMe) {\n        return child.dispatcher.subscribe(function (event) {\n          if (event.isEnd()) {\n            _.remove(child, childDeps);\n            checkQueue();\n            checkEnd(unsubMe);\n            return Bacon.noMore;\n          } else {\n            if (typeof event !== \"undefined\" && event !== null ? event._isInitial : undefined) {\n              event = event.toNext();\n            }\n            var reply = sink(event);\n            if (reply === Bacon.noMore) {\n              unsubAll();\n            }\n            return reply;\n          }\n        });\n      });\n    };\n    var checkQueue = function () {\n      var event = queue.shift();\n      if (event) {\n        return spawn(event);\n      }\n    };\n    var checkEnd = function (unsub) {\n      unsub();\n      if (composite.empty()) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (__, unsubRoot) {\n      return root.dispatcher.subscribe(function (event) {\n        if (event.isEnd()) {\n          return checkEnd(unsubRoot);\n        } else if (event.isError()) {\n          return sink(event);\n        } else if (firstOnly && composite.count() > 1) {\n          return Bacon.more;\n        } else {\n          if (composite.unsubscribed) {\n            return Bacon.noMore;\n          }\n          if (limit && composite.count() > limit) {\n            return queue.push(event);\n          } else {\n            return spawn(event);\n          }\n        }\n      });\n    });\n    return composite.unsubscribe;\n  });\n  result.internalDeps = function () {\n    if (childDeps.length) {\n      return rootDep.concat(childDeps);\n    } else {\n      return rootDep;\n    }\n  };\n  return result;\n};\n\nBacon.Observable.prototype.flatMapWithConcurrencyLimit = function (limit) {\n  for (var _len11 = arguments.length, args = Array(_len11 > 1 ? _len11 - 1 : 0), _key11 = 1; _key11 < _len11; _key11++) {\n    args[_key11 - 1] = arguments[_key11];\n  }\n\n  var desc = new Bacon.Desc(this, \"flatMapWithConcurrencyLimit\", [limit].concat(args));\n  return withDesc(desc, flatMap_(this, makeSpawner(args), false, limit));\n};\n\nBacon.Observable.prototype.flatMapConcat = function () {\n  var desc = new Bacon.Desc(this, \"flatMapConcat\", Array.prototype.slice.call(arguments, 0));\n  return withDesc(desc, this.flatMapWithConcurrencyLimit.apply(this, [1].concat(_slice.call(arguments))));\n};\n\nBacon.later = function (delay, value) {\n  return withDesc(new Bacon.Desc(Bacon, \"later\", [delay, value]), Bacon.fromBinder(function (sink) {\n    var sender = function () {\n      return sink([value, endEvent()]);\n    };\n    var id = Bacon.scheduler.setTimeout(sender, delay);\n    return function () {\n      return Bacon.scheduler.clearTimeout(id);\n    };\n  }));\n};\n\nBacon.Observable.prototype.bufferingThrottle = function (minimumInterval) {\n  var desc = new Bacon.Desc(this, \"bufferingThrottle\", [minimumInterval]);\n  return withDesc(desc, this.flatMapConcat(function (x) {\n    return Bacon.once(x).concat(Bacon.later(minimumInterval).filter(false));\n  }));\n};\n\nBacon.Property.prototype.bufferingThrottle = function () {\n  return Bacon.Observable.prototype.bufferingThrottle.apply(this, arguments).toProperty();\n};\n\nfunction Bus() {\n  if (!(this instanceof Bus)) {\n    return new Bus();\n  }\n\n  this.unsubAll = _.bind(this.unsubAll, this);\n  this.subscribeAll = _.bind(this.subscribeAll, this);\n  this.guardedSink = _.bind(this.guardedSink, this);\n\n  this.sink = undefined;\n  this.subscriptions = [];\n  this.ended = false;\n  EventStream.call(this, new Bacon.Desc(Bacon, \"Bus\", []), this.subscribeAll);\n}\n\ninherit(Bus, EventStream);\nextend(Bus.prototype, {\n  unsubAll: function () {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (typeof sub.unsub === \"function\") {\n        sub.unsub();\n      }\n    }\n  },\n\n  subscribeAll: function (newSink) {\n    if (this.ended) {\n      newSink(endEvent());\n    } else {\n      this.sink = newSink;\n      var iterable = cloneArray(this.subscriptions);\n      for (var i = 0, subscription; i < iterable.length; i++) {\n        subscription = iterable[i];\n        this.subscribeInput(subscription);\n      }\n    }\n    return this.unsubAll;\n  },\n\n  guardedSink: function (input) {\n    var _this8 = this;\n\n    return function (event) {\n      if (event.isEnd()) {\n        _this8.unsubscribeInput(input);\n        return Bacon.noMore;\n      } else {\n        return _this8.sink(event);\n      }\n    };\n  },\n\n  subscribeInput: function (subscription) {\n    subscription.unsub = subscription.input.dispatcher.subscribe(this.guardedSink(subscription.input));\n    return subscription.unsub;\n  },\n\n  unsubscribeInput: function (input) {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (sub.input === input) {\n        if (typeof sub.unsub === \"function\") {\n          sub.unsub();\n        }\n        this.subscriptions.splice(i, 1);\n        return;\n      }\n    }\n  },\n\n  plug: function (input) {\n    var _this9 = this;\n\n    assertObservable(input);\n    if (this.ended) {\n      return;\n    }\n    var sub = { input: input };\n    this.subscriptions.push(sub);\n    if (typeof this.sink !== \"undefined\") {\n      this.subscribeInput(sub);\n    }\n    return function () {\n      return _this9.unsubscribeInput(input);\n    };\n  },\n\n  end: function () {\n    this.ended = true;\n    this.unsubAll();\n    if (typeof this.sink === \"function\") {\n      return this.sink(endEvent());\n    }\n  },\n\n  push: function (value) {\n    if (!this.ended && typeof this.sink === \"function\") {\n      var rootPush = !this.pushing;\n      if (!rootPush) {\n        if (!this.pushQueue) this.pushQueue = [];\n        this.pushQueue.push(value);\n\n        return;\n      }\n      this.pushing = true;\n      try {\n        return this.sink(nextEvent(value));\n      } finally {\n        if (rootPush && this.pushQueue) {\n          var i = 0;\n          while (i < this.pushQueue.length) {\n            var value = this.pushQueue[i];\n            this.sink(nextEvent(value));\n            i++;\n          }\n          this.pushQueue = null;\n        }\n        this.pushing = false;\n      }\n    }\n  },\n\n  error: function (error) {\n    if (typeof this.sink === \"function\") {\n      return this.sink(new Error(error));\n    }\n  }\n});\n\nBacon.Bus = Bus;\n\nvar liftCallback = function (desc, wrapped) {\n  return withMethodCallSupport(function (f) {\n    var stream = partiallyApplied(wrapped, [function (values, callback) {\n      return f.apply(undefined, values.concat([callback]));\n    }]);\n\n    for (var _len12 = arguments.length, args = Array(_len12 > 1 ? _len12 - 1 : 0), _key12 = 1; _key12 < _len12; _key12++) {\n      args[_key12 - 1] = arguments[_key12];\n    }\n\n    return withDesc(new Bacon.Desc(Bacon, desc, [f].concat(args)), Bacon.combineAsArray(args).flatMap(stream));\n  });\n};\n\nBacon.fromCallback = liftCallback(\"fromCallback\", function (f) {\n  for (var _len13 = arguments.length, args = Array(_len13 > 1 ? _len13 - 1 : 0), _key13 = 1; _key13 < _len13; _key13++) {\n    args[_key13 - 1] = arguments[_key13];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (value) {\n    return [value, endEvent()];\n  });\n});\n\nBacon.fromNodeCallback = liftCallback(\"fromNodeCallback\", function (f) {\n  for (var _len14 = arguments.length, args = Array(_len14 > 1 ? _len14 - 1 : 0), _key14 = 1; _key14 < _len14; _key14++) {\n    args[_key14 - 1] = arguments[_key14];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (error, value) {\n    if (error) {\n      return [new Error(error), endEvent()];\n    }\n    return [value, endEvent()];\n  });\n});\n\nBacon.combineTemplate = function (template) {\n  function current(ctxStack) {\n    return ctxStack[ctxStack.length - 1];\n  }\n  function setValue(ctxStack, key, value) {\n    current(ctxStack)[key] = value;\n    return value;\n  }\n  function applyStreamValue(key, index) {\n    return function (ctxStack, values) {\n      setValue(ctxStack, key, values[index]);\n    };\n  }\n  function constantValue(key, value) {\n    return function (ctxStack) {\n      setValue(ctxStack, key, value);\n    };\n  }\n\n  function mkContext(template) {\n    return isArray(template) ? [] : {};\n  }\n\n  function pushContext(key, value) {\n    return function (ctxStack) {\n      var newContext = mkContext(value);\n      setValue(ctxStack, key, newContext);\n      ctxStack.push(newContext);\n    };\n  }\n\n  function containsObservables(value) {\n    if (isObservable(value)) {\n      return true;\n    } else if (value && (value.constructor == Object || value.constructor == Array)) {\n      for (var key in value) {\n        if (Object.prototype.hasOwnProperty.call(value, key)) {\n          var child = value[key];\n          if (containsObservables(child)) return true;\n        }\n      }\n    }\n  }\n\n  function compile(key, value) {\n    if (isObservable(value)) {\n      streams.push(value);\n      funcs.push(applyStreamValue(key, streams.length - 1));\n    } else if (containsObservables(value)) {\n      var popContext = function (ctxStack) {\n        ctxStack.pop();\n      };\n      funcs.push(pushContext(key, value));\n      compileTemplate(value);\n      funcs.push(popContext);\n    } else {\n      funcs.push(constantValue(key, value));\n    }\n  }\n\n  function combinator(values) {\n    var rootContext = mkContext(template);\n    var ctxStack = [rootContext];\n    for (var i = 0, f; i < funcs.length; i++) {\n      f = funcs[i];\n      f(ctxStack, values);\n    }\n    return rootContext;\n  }\n\n  function compileTemplate(template) {\n    _.each(template, compile);\n  }\n\n  var funcs = [];\n  var streams = [];\n\n  var resultProperty = containsObservables(template) ? (compileTemplate(template), Bacon.combineAsArray(streams).map(combinator)) : Bacon.constant(template);\n\n  return withDesc(new Bacon.Desc(Bacon, \"combineTemplate\", [template]), resultProperty);\n};\n\nBacon.Observable.prototype.mapEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      this.push(nextEvent(f(event)));\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.skipErrors = function () {\n  return withDesc(new Bacon.Desc(this, \"skipErrors\", []), this.withHandler(function (event) {\n    if (event.isError()) {\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.takeUntil = function (stopper) {\n  var endMarker = {};\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), Bacon.groupSimultaneous(this.mapEnd(endMarker), stopper.skipErrors()).withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      var _event$value = event.value();\n\n      var data = _event$value[0];\n      var stopper = _event$value[1];\n\n      if (stopper.length) {\n        return this.push(endEvent());\n      } else {\n        var reply = Bacon.more;\n        for (var i = 0, value; i < data.length; i++) {\n          value = data[i];\n          if (value === endMarker) {\n            reply = this.push(endEvent());\n          } else {\n            reply = this.push(nextEvent(value));\n          }\n        }\n        return reply;\n      }\n    }\n  }));\n};\n\nBacon.Property.prototype.takeUntil = function (stopper) {\n  var changes = this.changes().takeUntil(stopper);\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), addPropertyInitValueToStream(this, changes));\n};\n\nBacon.Observable.prototype.flatMapLatest = function () {\n  var f = makeSpawner(arguments);\n  var stream = this.toEventStream();\n  return withDesc(new Bacon.Desc(this, \"flatMapLatest\", [f]), stream.flatMap(function (value) {\n    return makeObservable(f(value)).takeUntil(stream);\n  }));\n};\n\nBacon.Property.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, addPropertyInitValueToStream(this, f(this.changes())));\n};\n\nBacon.EventStream.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, f(this));\n};\n\nBacon.Observable.prototype.delay = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"delay\", [delay]), function (changes) {\n    return changes.flatMap(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounce = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounce\", [delay]), function (changes) {\n    return changes.flatMapLatest(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounceImmediate = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounceImmediate\", [delay]), function (changes) {\n    return changes.flatMapFirst(function (value) {\n      return Bacon.once(value).concat(Bacon.later(delay).filter(false));\n    });\n  });\n};\n\nBacon.Observable.prototype.decode = function (cases) {\n  return withDesc(new Bacon.Desc(this, \"decode\", [cases]), this.combine(Bacon.combineTemplate(cases), function (key, values) {\n    return values[key];\n  }));\n};\n\nBacon.Observable.prototype.scan = function (seed, f) {\n  var _this10 = this;\n\n  var resultProperty;\n  f = toCombinator(f);\n  var acc = toOption(seed);\n  var initHandled = false;\n  var subscribe = function (sink) {\n    var initSent = false;\n    var unsub = nop;\n    var reply = Bacon.more;\n    var sendInit = function () {\n      if (!initSent) {\n        return acc.forEach(function (value) {\n          initSent = initHandled = true;\n          reply = sink(new Initial(function () {\n            return value;\n          }));\n          if (reply === Bacon.noMore) {\n            unsub();\n            unsub = nop;\n            return unsub;\n          }\n        });\n      }\n    };\n    unsub = _this10.dispatcher.subscribe(function (event) {\n      if (event.hasValue()) {\n        if (initHandled && event.isInitial()) {\n          return Bacon.more;\n        } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = initHandled = true;\n            var prev = acc.getOrElse(undefined);\n            var next = f(prev, event.value());\n\n            acc = new Some(next);\n            return sink(event.apply(function () {\n              return next;\n            }));\n          }\n      } else {\n        if (event.isEnd()) {\n          reply = sendInit();\n        }\n        if (reply !== Bacon.noMore) {\n          return sink(event);\n        }\n      }\n    });\n    UpdateBarrier.whenDoneWith(resultProperty, sendInit);\n    return unsub;\n  };\n  resultProperty = new Property(new Bacon.Desc(this, \"scan\", [seed, f]), subscribe);\n  return resultProperty;\n};\n\nBacon.Observable.prototype.diff = function (start, f) {\n  f = toCombinator(f);\n  return withDesc(new Bacon.Desc(this, \"diff\", [start, f]), this.scan([start], function (prevTuple, next) {\n    return [next, f(prevTuple[0], next)];\n  }).filter(function (tuple) {\n    return tuple.length === 2;\n  }).map(function (tuple) {\n    return tuple[1];\n  }));\n};\n\nBacon.Observable.prototype.doAction = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doAction\", [f]), this.withHandler(function (event) {\n    if (event.hasValue()) {\n      f(event.value());\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      f();\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      f(event.error);\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doLog = function () {\n  for (var _len15 = arguments.length, args = Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n    args[_key15] = arguments[_key15];\n  }\n\n  return withDesc(new Bacon.Desc(this, \"doLog\", args), this.withHandler(function (event) {\n    if (typeof console !== \"undefined\" && console !== null && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.endOnError = function (f) {\n  if (!(typeof f !== \"undefined\" && f !== null)) {\n    f = true;\n  }\n\n  for (var _len16 = arguments.length, args = Array(_len16 > 1 ? _len16 - 1 : 0), _key16 = 1; _key16 < _len16; _key16++) {\n    args[_key16 - 1] = arguments[_key16];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"endOnError\", []), this.withHandler(function (event) {\n      if (event.isError() && f(event.error)) {\n        this.push(event);\n        return this.push(endEvent());\n      } else {\n        return this.push(event);\n      }\n    }));\n  });\n};\n\nObservable.prototype.errors = function () {\n  return withDesc(new Bacon.Desc(this, \"errors\", []), this.filter(function () {\n    return false;\n  }));\n};\n\nBacon.Observable.prototype.take = function (count) {\n  if (count <= 0) {\n    return Bacon.never();\n  }\n  return withDesc(new Bacon.Desc(this, \"take\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      count--;\n      if (count > 0) {\n        return this.push(event);\n      } else {\n        if (count === 0) {\n          this.push(event);\n        }\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }\n  }));\n};\n\nBacon.Observable.prototype.first = function () {\n  return withDesc(new Bacon.Desc(this, \"first\", []), this.take(1));\n};\n\nBacon.Observable.prototype.mapError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      return this.push(nextEvent(f(event.error)));\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.flatMapError = function (fn) {\n  var desc = new Bacon.Desc(this, \"flatMapError\", [fn]);\n  return withDesc(desc, this.mapError(function (err) {\n    return new Error(err);\n  }).flatMap(function (x) {\n    if (x instanceof Error) {\n      return fn(x.error);\n    } else {\n      return Bacon.once(x);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.flatScan = function (seed, f) {\n  var current = seed;\n  return this.flatMapConcat(function (next) {\n    return makeObservable(f(current, next)).doAction(function (updated) {\n      return current = updated;\n    });\n  }).toProperty(seed);\n};\n\nBacon.EventStream.prototype.sampledBy = function (sampler, combinator) {\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), this.toProperty().sampledBy(sampler, combinator));\n};\n\nBacon.Property.prototype.sampledBy = function (sampler, combinator) {\n  var lazy = false;\n  if (typeof combinator !== \"undefined\" && combinator !== null) {\n    combinator = toCombinator(combinator);\n  } else {\n    lazy = true;\n    combinator = function (f) {\n      return f.value();\n    };\n  }\n  var thisSource = new Source(this, false, lazy);\n  var samplerSource = new Source(sampler, true, lazy);\n  var stream = Bacon.when([thisSource, samplerSource], combinator);\n  var result = sampler._isProperty ? stream.toProperty() : stream;\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), result);\n};\n\nBacon.Property.prototype.sample = function (interval) {\n  return withDesc(new Bacon.Desc(this, \"sample\", [interval]), this.sampledBy(Bacon.interval(interval, {})));\n};\n\nBacon.Observable.prototype.map = function (p) {\n  if (p && p._isProperty) {\n    return p.sampledBy(this, former);\n  } else {\n    for (var _len17 = arguments.length, args = Array(_len17 > 1 ? _len17 - 1 : 0), _key17 = 1; _key17 < _len17; _key17++) {\n      args[_key17 - 1] = arguments[_key17];\n    }\n\n    return convertArgsToFunction(this, p, args, function (f) {\n      return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n        return this.push(event.fmap(f));\n      }));\n    });\n  }\n};\n\nBacon.Observable.prototype.fold = function (seed, f) {\n  return withDesc(new Bacon.Desc(this, \"fold\", [seed, f]), this.scan(seed, f).sampledBy(this.filter(false).mapEnd().toProperty()));\n};\n\nObservable.prototype.reduce = Observable.prototype.fold;\n\nvar eventMethods = [[\"addEventListener\", \"removeEventListener\"], [\"addListener\", \"removeListener\"], [\"on\", \"off\"], [\"bind\", \"unbind\"]];\n\nvar findHandlerMethods = function (target) {\n  var pair;\n  for (var i = 0; i < eventMethods.length; i++) {\n    pair = eventMethods[i];\n    var methodPair = [target[pair[0]], target[pair[1]]];\n    if (methodPair[0] && methodPair[1]) {\n      return methodPair;\n    }\n  }\n  for (var j = 0; j < eventMethods.length; j++) {\n    pair = eventMethods[j];\n    var addListener = target[pair[0]];\n    if (addListener) {\n      return [addListener, function () {}];\n    }\n  }\n  throw new Error(\"No suitable event methods in \" + target);\n};\n\nBacon.fromEventTarget = function (target, eventName, eventTransformer) {\n  var _findHandlerMethods = findHandlerMethods(target);\n\n  var sub = _findHandlerMethods[0];\n  var unsub = _findHandlerMethods[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromEvent\", [target, eventName]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    sub.call(target, eventName, handler);\n    return function () {\n      return unsub.call(target, eventName, handler);\n    };\n  }, eventTransformer));\n};\n\nBacon.fromEvent = Bacon.fromEventTarget;\n\nBacon.fromPoll = function (delay, poll) {\n  var desc = new Bacon.Desc(Bacon, \"fromPoll\", [delay, poll]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    var id = Bacon.scheduler.setInterval(handler, delay);\n    return function () {\n      return Bacon.scheduler.clearInterval(id);\n    };\n  }, poll));\n};\n\nfunction valueAndEnd(value) {\n  return [value, endEvent()];\n}\n\nBacon.fromPromise = function (promise, abort) {\n  var eventTransformer = arguments.length <= 2 || arguments[2] === undefined ? valueAndEnd : arguments[2];\n\n  return withDesc(new Bacon.Desc(Bacon, \"fromPromise\", [promise]), Bacon.fromBinder(function (handler) {\n    var bound = promise.then(handler, function (e) {\n      return handler(new Error(e));\n    });\n    if (bound && typeof bound.done === \"function\") {\n      bound.done();\n    }\n\n    if (abort) {\n      return function () {\n        if (typeof promise.abort === \"function\") {\n          return promise.abort();\n        }\n      };\n    } else {\n      return function () {};\n    }\n  }, eventTransformer));\n};\n\nBacon.Observable.prototype.groupBy = function (keyF) {\n  var limitF = arguments.length <= 1 || arguments[1] === undefined ? Bacon._.id : arguments[1];\n\n  var streams = {};\n  var src = this;\n  return src.filter(function (x) {\n    return !streams[keyF(x)];\n  }).map(function (x) {\n    var key = keyF(x);\n    var similar = src.filter(function (x) {\n      return keyF(x) === key;\n    });\n    var data = Bacon.once(x).concat(similar);\n    var limited = limitF(data, x).withHandler(function (event) {\n      this.push(event);\n      if (event.isEnd()) {\n        return delete streams[key];\n      }\n    });\n    streams[key] = limited;\n    return limited;\n  });\n};\n\nBacon.fromArray = function (values) {\n  assertArray(values);\n  if (!values.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"fromArray\", values), Bacon.never());\n  } else {\n    var i = 0;\n    var stream = new EventStream(new Bacon.Desc(Bacon, \"fromArray\", [values]), function (sink) {\n      var unsubd = false;\n      var reply = Bacon.more;\n      var pushing = false;\n      var pushNeeded = false;\n      function push() {\n        pushNeeded = true;\n        if (pushing) {\n          return;\n        }\n        pushing = true;\n        while (pushNeeded) {\n          pushNeeded = false;\n          if (reply !== Bacon.noMore && !unsubd) {\n            var value = values[i++];\n            reply = sink(toEvent(value));\n            if (reply !== Bacon.noMore) {\n              if (i === values.length) {\n                sink(endEvent());\n              } else {\n                UpdateBarrier.afterTransaction(stream, push);\n              }\n            }\n          }\n        }\n        pushing = false;\n        return pushing;\n      };\n\n      push();\n      return function () {\n        unsubd = true;\n        return unsubd;\n      };\n    });\n    return stream;\n  }\n};\n\nBacon.EventStream.prototype.holdWhen = function (valve) {\n  var onHold = false;\n  var bufferedValues = [];\n  var src = this;\n  var srcIsEnded = false;\n  return new EventStream(new Bacon.Desc(this, \"holdWhen\", [valve]), function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var subscribed = false;\n    var endIfBothEnded = function (unsub) {\n      if (typeof unsub === \"function\") {\n        unsub();\n      }\n      if (composite.empty() && subscribed) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (unsubAll, unsubMe) {\n      return valve.subscribeInternal(function (event) {\n        if (event.hasValue()) {\n          onHold = event.value();\n          if (!onHold) {\n            var toSend = bufferedValues;\n            bufferedValues = [];\n            return (function () {\n              var result = [];\n              for (var i = 0, value; i < toSend.length; i++) {\n                value = toSend[i];\n                result.push(sink(nextEvent(value)));\n              }\n              if (srcIsEnded) {\n                result.push(sink(endEvent()));\n                unsubMe();\n              }\n              return result;\n            })();\n          }\n        } else if (event.isEnd()) {\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    composite.add(function (unsubAll, unsubMe) {\n      return src.subscribeInternal(function (event) {\n        if (onHold && event.hasValue()) {\n          return bufferedValues.push(event.value());\n        } else if (event.isEnd() && bufferedValues.length) {\n          srcIsEnded = true;\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    subscribed = true;\n    endIfBothEnded();\n    return composite.unsubscribe;\n  });\n};\n\nBacon.interval = function (delay) {\n  var value = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  return withDesc(new Bacon.Desc(Bacon, \"interval\", [delay, value]), Bacon.fromPoll(delay, function () {\n    return nextEvent(value);\n  }));\n};\n\nBacon.$ = {};\nBacon.$.asEventStream = function (eventName, selector, eventTransformer) {\n  var _this11 = this;\n\n  if (_.isFunction(selector)) {\n    eventTransformer = selector;\n    selector = undefined;\n  }\n\n  return withDesc(new Bacon.Desc(this.selector || this, \"asEventStream\", [eventName]), Bacon.fromBinder(function (handler) {\n    _this11.on(eventName, selector, handler);\n    return function () {\n      return _this11.off(eventName, selector, handler);\n    };\n  }, eventTransformer));\n};\n\nif (typeof jQuery !== \"undefined\" && jQuery) {\n  jQuery.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nif (typeof Zepto !== \"undefined\" && Zepto) {\n  Zepto.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nBacon.Observable.prototype.last = function () {\n  var lastEvent;\n\n  return withDesc(new Bacon.Desc(this, \"last\", []), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      if (lastEvent) {\n        this.push(lastEvent);\n      }\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      lastEvent = event;\n    }\n  }));\n};\n\nBacon.Observable.prototype.log = function () {\n  for (var _len18 = arguments.length, args = Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n    args[_key18] = arguments[_key18];\n  }\n\n  this.subscribe(function (event) {\n    if (typeof console !== \"undefined\" && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n  });\n  return this;\n};\n\nBacon.EventStream.prototype.merge = function (right) {\n  assertEventStream(right);\n  var left = this;\n  return withDesc(new Bacon.Desc(left, \"merge\", [right]), Bacon.mergeAll(this, right));\n};\n\nBacon.mergeAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return new EventStream(new Bacon.Desc(Bacon, \"mergeAll\", streams), function (sink) {\n      var ends = 0;\n      var smartSink = function (obs) {\n        return function (unsubBoth) {\n          return obs.dispatcher.subscribe(function (event) {\n            if (event.isEnd()) {\n              ends++;\n              if (ends === streams.length) {\n                return sink(endEvent());\n              } else {\n                return Bacon.more;\n              }\n            } else {\n              var reply = sink(event);\n              if (reply === Bacon.noMore) {\n                unsubBoth();\n              }\n              return reply;\n            }\n          });\n        };\n      };\n      var sinks = _.map(smartSink, streams);\n      return new Bacon.CompositeUnsubscribe(sinks).unsubscribe;\n    });\n  } else {\n    return Bacon.never();\n  }\n};\n\nBacon.repeatedly = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"repeatedly\", [delay, values]), Bacon.fromPoll(delay, function () {\n    return values[index++ % values.length];\n  }));\n};\n\nBacon.repeat = function (generator) {\n  var index = 0;\n  return Bacon.fromBinder(function (sink) {\n    var flag = false;\n    var reply = Bacon.more;\n    var unsub = function () {};\n    function handleEvent(event) {\n      if (event.isEnd()) {\n        if (!flag) {\n          return flag = true;\n        } else {\n          return subscribeNext();\n        }\n      } else {\n        return reply = sink(event);\n      }\n    };\n    function subscribeNext() {\n      var next;\n      flag = true;\n      while (flag && reply !== Bacon.noMore) {\n        next = generator(index++);\n        flag = false;\n        if (next) {\n          unsub = next.subscribeInternal(handleEvent);\n        } else {\n          sink(endEvent());\n        }\n      }\n      return flag = true;\n    };\n    subscribeNext();\n    return function () {\n      return unsub();\n    };\n  });\n};\n\nBacon.retry = function (options) {\n  if (!_.isFunction(options.source)) {\n    throw new Exception(\"'source' option has to be a function\");\n  }\n  var source = options.source;\n  var retries = options.retries || 0;\n  var retriesDone = 0;\n  var delay = options.delay || function () {\n    return 0;\n  };\n  var isRetryable = options.isRetryable || function () {\n    return true;\n  };\n  var finished = false;\n  var error = null;\n\n  return withDesc(new Bacon.Desc(Bacon, \"retry\", [options]), Bacon.repeat(function (count) {\n    function valueStream() {\n      return source(count).endOnError().withHandler(function (event) {\n        if (event.isError()) {\n          error = event;\n          if (!(isRetryable(error.error) && (retries === 0 || retriesDone < retries))) {\n            finished = true;\n            return this.push(event);\n          }\n        } else {\n          if (event.hasValue()) {\n            error = null;\n            finished = true;\n          }\n          return this.push(event);\n        }\n      });\n    }\n\n    if (finished) {\n      return null;\n    } else if (error) {\n      var context = {\n        error: error.error,\n        retriesDone: retriesDone\n      };\n      var pause = Bacon.later(delay(context)).filter(false);\n      retriesDone++;\n      return pause.concat(Bacon.once().flatMap(valueStream));\n    } else {\n      return valueStream();\n    }\n  }));\n};\n\nBacon.sequentially = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"sequentially\", [delay, values]), Bacon.fromPoll(delay, function () {\n    var value = values[index++];\n    if (index < values.length) {\n      return value;\n    } else if (index === values.length) {\n      return [value, endEvent()];\n    } else {\n      return endEvent();\n    }\n  }));\n};\n\nBacon.Observable.prototype.skip = function (count) {\n  return withDesc(new Bacon.Desc(this, \"skip\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else if (count > 0) {\n      count--;\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.skipUntil = function (starter) {\n  var started = starter.take(1).map(true).toProperty(false);\n  return withDesc(new Bacon.Desc(this, \"skipUntil\", [starter]), this.filter(started));\n};\n\nBacon.EventStream.prototype.skipWhile = function (f) {\n  assertObservableIsProperty(f);\n  var ok = false;\n\n  for (var _len19 = arguments.length, args = Array(_len19 > 1 ? _len19 - 1 : 0), _key19 = 1; _key19 < _len19; _key19++) {\n    args[_key19 - 1] = arguments[_key19];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"skipWhile\", [f]), this.withHandler(function (event) {\n      if (ok || !event.hasValue() || !f(event.value())) {\n        if (event.hasValue()) {\n          ok = true;\n        }\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.slidingWindow = function (n) {\n  var minValues = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n  return withDesc(new Bacon.Desc(this, \"slidingWindow\", [n, minValues]), this.scan([], function (window, value) {\n    return window.concat([value]).slice(-n);\n  }).filter(function (values) {\n    return values.length >= minValues;\n  }));\n};\n\nvar spies = [];\nvar registerObs = function (obs) {\n  if (spies.length) {\n    if (!registerObs.running) {\n      try {\n        registerObs.running = true;\n        spies.forEach(function (spy) {\n          spy(obs);\n        });\n      } finally {\n        delete registerObs.running;\n      }\n    }\n  }\n};\n\nBacon.spy = function (spy) {\n  return spies.push(spy);\n};\n\nBacon.Property.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), this.scan(seed, function (prev, next) {\n    return next;\n  }));\n};\n\nBacon.EventStream.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), Bacon.once(seed).concat(this));\n};\n\nBacon.Observable.prototype.takeWhile = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len20 = arguments.length, args = Array(_len20 > 1 ? _len20 - 1 : 0), _key20 = 1; _key20 < _len20; _key20++) {\n    args[_key20 - 1] = arguments[_key20];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"takeWhile\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.throttle = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"throttle\", [delay]), function (changes) {\n    return changes.bufferWithTime(delay).map(function (values) {\n      return values[values.length - 1];\n    });\n  });\n};\n\nObservable.prototype.firstToPromise = function (PromiseCtr) {\n  var _this12 = this;\n\n  if (typeof PromiseCtr !== \"function\") {\n    if (typeof Promise === \"function\") {\n      PromiseCtr = Promise;\n    } else {\n      throw new Exception(\"There isn't default Promise, use shim or parameter\");\n    }\n  }\n\n  return new PromiseCtr(function (resolve, reject) {\n    return _this12.subscribe(function (event) {\n      if (event.hasValue()) {\n        resolve(event.value());\n      }\n      if (event.isError()) {\n        reject(event.error);\n      }\n\n      return Bacon.noMore;\n    });\n  });\n};\n\nObservable.prototype.toPromise = function (PromiseCtr) {\n  return this.last().firstToPromise(PromiseCtr);\n};\n\nBacon[\"try\"] = function (f) {\n  return function (value) {\n    try {\n      return Bacon.once(f(value));\n    } catch (e) {\n      return new Bacon.Error(e);\n    }\n  };\n};\n\nBacon.update = function (initial) {\n  function lateBindFirst(f) {\n    return function () {\n      for (var _len22 = arguments.length, args = Array(_len22), _key22 = 0; _key22 < _len22; _key22++) {\n        args[_key22] = arguments[_key22];\n      }\n\n      return function (i) {\n        return f.apply(undefined, [i].concat(args));\n      };\n    };\n  }\n\n  for (var _len21 = arguments.length, patterns = Array(_len21 > 1 ? _len21 - 1 : 0), _key21 = 1; _key21 < _len21; _key21++) {\n    patterns[_key21 - 1] = arguments[_key21];\n  }\n\n  var i = patterns.length - 1;\n  while (i > 0) {\n    if (!(patterns[i] instanceof Function)) {\n      patterns[i] = _.always(patterns[i]);\n    }\n    patterns[i] = lateBindFirst(patterns[i]);\n    i = i - 2;\n  }\n  return withDesc(new Bacon.Desc(Bacon, \"update\", [initial].concat(patterns)), Bacon.when.apply(Bacon, patterns).scan(initial, function (x, f) {\n    return f(x);\n  }));\n};\n\nBacon.zipAsArray = function () {\n  for (var _len23 = arguments.length, args = Array(_len23), _key23 = 0; _key23 < _len23; _key23++) {\n    args[_key23] = arguments[_key23];\n  }\n\n  var streams = argumentsToObservables(args);\n  return withDesc(new Bacon.Desc(Bacon, \"zipAsArray\", streams), Bacon.zipWith(streams, function () {\n    for (var _len24 = arguments.length, xs = Array(_len24), _key24 = 0; _key24 < _len24; _key24++) {\n      xs[_key24] = arguments[_key24];\n    }\n\n    return xs;\n  }));\n};\n\nBacon.zipWith = function () {\n  for (var _len25 = arguments.length, args = Array(_len25), _key25 = 0; _key25 < _len25; _key25++) {\n    args[_key25] = arguments[_key25];\n  }\n\n  var observablesAndFunction = argumentsToObservablesAndFunction(args);\n  var streams = observablesAndFunction[0];\n  var f = observablesAndFunction[1];\n\n  streams = _.map(function (s) {\n    return s.toEventStream();\n  }, streams);\n  return withDesc(new Bacon.Desc(Bacon, \"zipWith\", [f].concat(streams)), Bacon.when(streams, f));\n};\n\nBacon.Observable.prototype.zip = function (other, f) {\n  return withDesc(new Bacon.Desc(this, \"zip\", [other]), Bacon.zipWith([this, other], f || Array));\n};\n\nfunction ESObservable(observable) {\n  this.observable = observable;\n}\n\nESObservable.prototype.subscribe = function (observerOrOnNext, onError, onComplete) {\n  var observer = typeof observerOrOnNext === 'function' ? { next: observerOrOnNext, error: onError, complete: onComplete } : observerOrOnNext;\n  var subscription = {\n    closed: false,\n    unsubscribe: function () {\n      subscription.closed = true;\n      cancel();\n    }\n  };\n\n  var cancel = this.observable.subscribe(function (event) {\n    if (event.isError()) {\n      if (observer.error) observer.error(event.error);\n      subscription.unsubscribe();\n    } else if (event.isEnd()) {\n      subscription.closed = true;\n      if (observer.complete) observer.complete();\n    } else if (observer.next) {\n      observer.next(event.value());\n    }\n  });\n  return subscription;\n};\n\nESObservable.prototype[symbol('observable')] = function () {\n  return this;\n};\n\nBacon.Observable.prototype.toESObservable = function () {\n  return new ESObservable(this);\n};\n\nBacon.Observable.prototype[symbol('observable')] = Bacon.Observable.prototype.toESObservable;\n\nBacon.fromESObservable = function (_observable) {\n  var observable;\n  if (_observable[symbol(\"observable\")]) {\n    observable = _observable[symbol(\"observable\")]();\n  } else {\n    observable = _observable;\n  }\n\n  var desc = new Bacon.Desc(Bacon, \"fromESObservable\", [observable]);\n  return new Bacon.EventStream(desc, function (sink) {\n    var cancel = observable.subscribe({\n      error: function () {\n        sink(new Bacon.Error());\n        sink(new Bacon.End());\n      },\n      next: function (value) {\n        sink(new Bacon.Next(value, true));\n      },\n      complete: function () {\n        sink(new Bacon.End());\n      }\n    });\n\n    if (cancel.unsubscribe) {\n      return function () {\n        cancel.unsubscribe();\n      };\n    } else {\n      return cancel;\n    }\n  });\n};\n\nif (typeof define !== \"undefined\" && define !== null && define.amd != null) {\n  define([], function () {\n    return Bacon;\n  });\n  if (typeof this !== \"undefined\" && this !== null) {\n    this.Bacon = Bacon;\n  }\n} else if (typeof module !== \"undefined\" && module !== null && module.exports != null) {\n  module.exports = Bacon;\n  Bacon.Bacon = Bacon;\n} else {\n    this.Bacon = Bacon;\n  }\n}).call(this);\n","export default readBlob\n\n// Reads the blob as a specified type. The blob will not actually be read\n// unless the ``as()`` method is called.\n//\n// .. js:function:: as(type)\n//\n//    Starts reading the blob as ``type``. The ``type`` is a String such as\n//    \"arraybuffer\" or \"text\".\nexport function readBlob(blob) {\n  return {\n    as(type) {\n      return new Promise(function (resolve, reject) {\n        let reader = new FileReader()\n        reader.onload = function () {\n          resolve(reader.result)\n        }\n        reader.onerror = function () {\n          reject(new Error('Unable to read from Blob'))\n        }\n        switch (type) {\n          case 'arraybuffer':\n            reader.readAsArrayBuffer(blob)\n            break\n          case 'text':\n            reader.readAsText(blob)\n            break\n        }\n      })\n    },\n  }\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.assign = exports.values = exports.map = exports.uniq = void 0;\n// A subset of lodash that we actually use.\nvar lodash_uniq_1 = __importDefault(require(\"lodash.uniq\"));\nexports.uniq = lodash_uniq_1.default;\nvar lodash_map_1 = __importDefault(require(\"lodash.map\"));\nexports.map = lodash_map_1.default;\nvar lodash_values_1 = __importDefault(require(\"lodash.values\"));\nexports.values = lodash_values_1.default;\nvar lodash_assign_1 = __importDefault(require(\"lodash.assign\"));\nexports.assign = lodash_assign_1.default;\n//# sourceMappingURL=lodash.js.map","import { BYTES_FORMATTER } from 'bemuse/progress/formatters'\nimport { Progress } from './Progress'\n\n/**\n * Returns a callback that, when called,\n * update the progress with increasing `current` value,\n * out of a fixed `total`.\n */\nexport function fixed(total: number, progress: Progress) {\n  if (!progress) return () => {}\n  let loaded = 0\n  progress.report(0, total)\n  return (extra: any) => progress.report(++loaded, total, extra)\n}\n\n/**\n * Updates the progress with the result of an atomic operation.\n */\nexport function atomic<T>(\n  progress: Progress,\n  promise: PromiseLike<T>\n): PromiseLike<T> {\n  if (!progress) return promise\n  return Promise.resolve(promise).tap((data) => {\n    if (hasByteLength(data)) {\n      progress.formatter = BYTES_FORMATTER\n      progress.report(data.byteLength, data.byteLength)\n    } else {\n      progress.report(1, 1)\n    }\n  })\n}\nfunction hasByteLength(data: any): data is { byteLength: number } {\n  return data && data.byteLength\n}\n\n/**\n * Wraps an async function that may be called multiple times.\n * Each call adds to the total, and each async resolution adds to current.\n */\nexport function wrapPromise<A extends any[], R>(\n  progress: Progress,\n  f: (...args: A) => PromiseLike<R>\n): (...args: A) => PromiseLike<R> {\n  let current = 0\n  let total = 0\n  return function (this: any, ...args: A) {\n    progress.report(current, ++total)\n    return Promise.resolve(f.apply(this, args)).tap(() =>\n      progress.report(++current, total)\n    )\n  }\n}\n\nexport function bind(from: Progress, to: Progress) {\n  return from.watch(() => to.report(from.current!, from.total!, from.extra))\n}\n\n/**\n * Updates the `target` with progress data from multiple sources.\n */\nexport function simultaneous(target: Progress) {\n  let queue: Progress[] = []\n  let current: Progress | undefined\n  let unsubscribe: (() => void) | null = null\n  function update() {\n    if (current) {\n      target.report(current.current!, current.total!, current.extra)\n    }\n    if (queue.length > 0 && (!current || current.progress! >= 1)) {\n      bind(queue.shift()!)\n    }\n  }\n  function bind(progress: Progress) {\n    if (current === progress) {\n      return\n    }\n    if (unsubscribe) {\n      unsubscribe()\n      unsubscribe = null\n    }\n    current = progress\n    if (current) {\n      unsubscribe = current.watch(update)\n    }\n  }\n  return {\n    add(progress: Progress) {\n      queue.push(progress)\n      update()\n    },\n  }\n}\n","\"use strict\";\n/**\n * Public: The `bms` package is a library for working with rhythm game data.\n *\n * Although this librarys name suggests that it is for BMS file format,\n * almost every part can be used standalone.\n *\n * This package contains:\n *\n * - __Modules that reads and parses BMS files:__\n *\n *   - {Reader} reads the BMS file from a {Buffer}, detects the character set\n *     and decodes the buffer using that character set into a {String}.\n *   - {Compiler} reads the BMS source from a {String}, and converts into\n *     {BMSChart}, an internal representation of a BMS notechart.\n *\n * - __Classes for representing a BMS notechart.__\n *   These module stores the data as close to the BMS file format as possible.\n *\n *   Almost no musical interpretation is made.\n *   For example, a BPM change is simply represented using a\n *   BMSObject with `channel` = `03` or `08`.\n *\n *   - {BMSChart} is composed of {BMSHeaders}, {BMSObjects}, and {TimeSignatures}.\n *   - {BMSHeaders} represents the header sentences in a BMS file.\n *   - {BMSObjects} represents the objects in a BMS file.\n *   - {BMSObject} represents a single object.\n *\n * - __Classes that represent different aspects of a notechart.__\n *   Instance of these classes may be created from a {BMSChart},\n *   but they can be used in a standalone manner as well.\n *\n *   This makes this library very flexible,\n *   and able to accommodate different formats of notechart.\n *   For example, see the [bmson](https: *github.com/bemusic/bmson) package.\n *\n *   Its also possible to use these classes in context other than music gaming,\n *   for example, you can use these classes to help building a music player\n *   that requires precise synchronization between beats.\n *\n *   - {TimeSignatures} represents a collection of time signatures\n *     in a musical score, and lets you convert the measure number and fraction\n *     into beat number.\n *   - {Timing} represents the timing information in a musical score,\n *     and provides methods to convert between musical time (beats) and\n *     metric time (seconds).\n *   - {SongInfo} represents the basic song information,\n *     such as title, artist, and genre.\n *   - {Notes} represents the sound objects inside your notechart.\n *   - {Keysounds} represents a mapping between keysound ID and filename.\n *   - {Positioning} represents a mapping between beat and in-game position.\n *     Some rhythm game lets chart author control the amount of scrolling\n *     per beat. In StepMania 5, this is called the scroll segments.\n *   - {Spacing} represents a mapping between beat and note spacing.\n *     Some rhythm game lets chart author change the note spacing (HI-SPEED)\n *     dynamically. In StepMania 5, this is called the speed segments.\n *\n * - __Low-level utility classes:__\n *\n *   - {Speedcore} represents a linear animation.\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Compiler = exports.Reader = void 0;\nvar Reader = __importStar(require(\"./reader\"));\nexports.Reader = Reader;\nvar Compiler = __importStar(require(\"./compiler\"));\nexports.Compiler = Compiler;\n__exportStar(require(\"./reader/types\"), exports);\n__exportStar(require(\"./bms/chart\"), exports);\n__exportStar(require(\"./bms/headers\"), exports);\n__exportStar(require(\"./bms/objects\"), exports);\n__exportStar(require(\"./speedcore\"), exports);\n__exportStar(require(\"./time-signatures\"), exports);\n__exportStar(require(\"./notes\"), exports);\n__exportStar(require(\"./timing\"), exports);\n__exportStar(require(\"./song-info\"), exports);\n__exportStar(require(\"./keysounds\"), exports);\n__exportStar(require(\"./positioning\"), exports);\n__exportStar(require(\"./spacing\"), exports);\n//# sourceMappingURL=index.js.map","module.exports = __webpack_public_path__ + \"build/7d6d69a86d70e4e52079c5ce873435c6.jpg\";","export default document.querySelector('#scene-root')\n","import $ from 'jquery'\n\nexport default function GameScene(display) {\n  return function (container) {\n    let handler = () => false\n    $(window).on('touchstart', handler)\n    showCanvas(display, container)\n    return {\n      teardown() {\n        $(window).off('touchstart', handler)\n      },\n    }\n  }\n}\n\nfunction showCanvas(display, container) {\n  var { view, wrapper } = display\n  var { width, height } = view\n  container.appendChild(wrapper)\n  container.addEventListener('touchstart', disableContextMenu)\n  function disableContextMenu() {\n    container.removeEventListener('touchstart', disableContextMenu)\n    container.addEventListener('contextmenu', (e) => {\n      e.preventDefault()\n    })\n  }\n\n  resize()\n  $(window).on('resize', resize)\n\n  function resize() {\n    var scale = Math.min(window.innerWidth / width, window.innerHeight / height)\n    view.style.width = Math.round(width * scale) + 'px'\n    view.style.height = Math.round(height * scale) + 'px'\n    wrapper.style.width = Math.round(width * scale) + 'px'\n    wrapper.style.height = Math.round(height * scale) + 'px'\n    var yOffset = (window.innerHeight - height * scale) / 2\n    wrapper.style.marginTop = Math.round(yOffset) + 'px'\n  }\n\n  return wrapper\n}\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingScene.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingScene.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingScene.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","var escape = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.LoadingScene {\\n  background: url(\" + escape(require(\"bemuse/ui/images/bg/a.jpg\")) + \") center no-repeat;\\n  background-size: cover;\\n}\\n.LoadingSceneinfo {\\n  position: absolute;\\n  top: 40%;\\n  left: 0;\\n  right: 0;\\n  -webkit-transform: translateY(-50%);\\n          transform: translateY(-50%);\\n}\\n.LoadingScene .LoadingSceneSongInfo {\\n  -webkit-animation: loading-scene--loading-scene-song-info--animation 1s ease;\\n          animation: loading-scene--loading-scene-song-info--animation 1s ease;\\n}\\n.LoadingScene .LoadingSceneProgress {\\n  position: absolute;\\n  bottom: 10px;\\n  left: 10px;\\n}\\n.LoadingSceneimage {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n}\\n.LoadingSceneimage img {\\n  width: 100%;\\n  height: 100%;\\n  display: block;\\n  object-fit: cover;\\n  -webkit-animation: loading-scene--eyecatch-fade 0.8s;\\n          animation: loading-scene--eyecatch-fade 0.8s;\\n}\\n.LoadingSceneflash {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  opacity: 0;\\n  pointer-events: none;\\n  background: white;\\n  -webkit-animation: loading-scene--flash-animation 0.8s ease-out;\\n          animation: loading-scene--flash-animation 0.8s ease-out;\\n}\\n.LoadingScenecover {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  opacity: 0;\\n  pointer-events: none;\\n  background: black;\\n}\\n.Scene.is-exiting .LoadingSceneinfo {\\n  -webkit-animation: loading-scene--info-exit 0.3s linear;\\n          animation: loading-scene--info-exit 0.3s linear;\\n}\\n.Scene.is-exiting .LoadingSceneflash {\\n  -webkit-animation: loading-scene--flash-exit 0.3s ease;\\n          animation: loading-scene--flash-exit 0.3s ease;\\n}\\n.Scene.is-exiting .LoadingScenecover {\\n  -webkit-animation: loading-scene--cover-exit 0.3s linear;\\n          animation: loading-scene--cover-exit 0.3s linear;\\n  opacity: 1;\\n}\\n\\n@-webkit-keyframes loading-scene--eyecatch-fade {\\n  0% {\\n    opacity: 0;\\n  }\\n  100% {\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes loading-scene--eyecatch-fade {\\n  0% {\\n    opacity: 0;\\n  }\\n  100% {\\n    opacity: 1;\\n  }\\n}\\n@-webkit-keyframes loading-scene--loading-scene-song-info--animation {\\n  0% {\\n    -webkit-transform: scale(1.5, 0.02);\\n            transform: scale(1.5, 0.02);\\n  }\\n  100% {\\n    -webkit-transform: scale(1, 1);\\n            transform: scale(1, 1);\\n  }\\n}\\n@keyframes loading-scene--loading-scene-song-info--animation {\\n  0% {\\n    -webkit-transform: scale(1.5, 0.02);\\n            transform: scale(1.5, 0.02);\\n  }\\n  100% {\\n    -webkit-transform: scale(1, 1);\\n            transform: scale(1, 1);\\n  }\\n}\\n@-webkit-keyframes loading-scene--info-exit {\\n  0% {\\n    -webkit-transform: translateY(-50%) scale(1, 1);\\n            transform: translateY(-50%) scale(1, 1);\\n  }\\n  100% {\\n    -webkit-transform: translateY(-50%) scale(2, 2);\\n            transform: translateY(-50%) scale(2, 2);\\n  }\\n}\\n@keyframes loading-scene--info-exit {\\n  0% {\\n    -webkit-transform: translateY(-50%) scale(1, 1);\\n            transform: translateY(-50%) scale(1, 1);\\n  }\\n  100% {\\n    -webkit-transform: translateY(-50%) scale(2, 2);\\n            transform: translateY(-50%) scale(2, 2);\\n  }\\n}\\n@-webkit-keyframes loading-scene--cover-exit {\\n  0% {\\n    opacity: 0;\\n  }\\n  100% {\\n    opacity: 1;\\n  }\\n}\\n@keyframes loading-scene--cover-exit {\\n  0% {\\n    opacity: 0;\\n  }\\n  100% {\\n    opacity: 1;\\n  }\\n}\\n@-webkit-keyframes loading-scene--flash-animation {\\n  0% {\\n    opacity: 1;\\n  }\\n  100% {\\n    opacity: 0;\\n  }\\n}\\n@keyframes loading-scene--flash-animation {\\n  0% {\\n    opacity: 1;\\n  }\\n  100% {\\n    opacity: 0;\\n  }\\n}\\n@-webkit-keyframes loading-scene--flash-exit {\\n  0% {\\n    opacity: 0.5;\\n  }\\n  100% {\\n    opacity: 0;\\n  }\\n}\\n@keyframes loading-scene--flash-exit {\\n  0% {\\n    opacity: 0.5;\\n  }\\n  100% {\\n    opacity: 0;\\n  }\\n}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneSongInfo.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneSongInfo.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneSongInfo.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.LoadingSceneSongInfo {\\n  background: rgba(255, 255, 255, 0.96);\\n  color: #191817;\\n  text-align: center;\\n  padding: 25px 0px;\\n  box-shadow: 0 2px 18px rgba(0, 0, 0, 0.2);\\n}\\n.LoadingSceneSongInfogenre {\\n  font-size: 1.2rem;\\n}\\n.LoadingSceneSongInfotitle {\\n  font-size: 3.2rem;\\n  font-weight: bold;\\n}\\n.LoadingSceneSongInfosubtitle {\\n  font-size: 2.4rem;\\n}\\n.LoadingSceneSongInfoartist {\\n  font-size: 1.6rem;\\n  margin-top: 0.8ex;\\n}\\n.LoadingSceneSongInfosubartist {\\n  font-size: 1rem;\\n}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgress.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgress.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgress.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.LoadingSceneProgress {\\n  color: #333;\\n  font-size: 11px;\\n}\\n.LoadingSceneProgress .LoadingSceneProgressBar {\\n  display: inline-block;\\n  vertical-align: middle;\\n  width: 48px;\\n  margin-right: 4px;\\n  position: relative;\\n  top: -1px;\\n}\\n.LoadingSceneProgressextra {\\n  font-size: 83%;\\n  opacity: 0.7;\\n}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgressBar.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgressBar.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.55.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgressBar.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.LoadingSceneProgressBar {\\n  border: 1px solid rgba(0, 0, 0, 0.6);\\n  padding: 1px;\\n}\\n.LoadingSceneProgressBarbar {\\n  height: 8px;\\n  background: rgba(0, 0, 0, 0.6);\\n  width: 0%;\\n}\", \"\"]);\n\n// exports\n","import Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\nimport { basename } from 'path'\nimport { IResource, IResources } from './types'\n\nexport class URLResource implements IResource {\n  constructor(private url: string) {}\n  read(progress: Progress) {\n    return download(this.url).as('arraybuffer', progress)\n  }\n  async resolveUrl() {\n    return Promise.resolve(this.url)\n  }\n  get name() {\n    return basename(this.url)\n  }\n}\n\nexport class URLResources implements IResources {\n  constructor(public base: URL) {}\n  async file(name: string): Promise<IResource> {\n    const path = name\n      .split('/')\n      .map((part) => encodeURIComponent(part))\n      .join('/')\n    return new URLResource(new URL(path, this.base).href)\n  }\n}\n\nexport default URLResource\n"],"sourceRoot":""}