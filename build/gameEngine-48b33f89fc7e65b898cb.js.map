{"version":3,"file":"build/gameEngine-48b33f89fc7e65b898cb.js","mappings":"sFAcA,SAASA,EAAgBC,EAASC,EAAUC,EAAOC,GACjDC,KAAKJ,QAAWA,EAChBI,KAAKH,SAAWA,EAChBG,KAAKF,MAAWA,EAChBE,KAAKD,SAAWA,EAChBC,KAAKC,KAAW,cAEuB,mBAA5BC,MAAMC,mBACfD,MAAMC,kBAAkBH,KAAML,EAElC,EAhBA,SAAsBS,EAAOC,GAC3B,SAASC,IAASN,KAAKO,YAAcH,CAAO,CAC5CE,EAAKE,UAAYH,EAAOG,UACxBJ,EAAMI,UAAY,IAAIF,CACxB,CAcAG,CAAad,EAAiBO,OAE9BP,EAAgBe,aAAe,SAASb,EAAUC,GAChD,IAAIa,EAA2B,CACzBC,QAAS,SAASC,GAChB,MAAO,IAAOC,EAAcD,EAAYE,MAAQ,GAClD,EAEA,MAAS,SAASF,GAChB,IACIG,EADAC,EAAe;AAGnB,IAAKD,EAAI,EAAGA,EAAIH,EAAYK,MAAMC,OAAQH,IACxCC,GAAgBJ,EAAYK,MAAMF,aAAcI,MAC5CC,EAAYR,EAAYK,MAAMF,GAAG,IAAM,IAAMK,EAAYR,EAAYK,MAAMF,GAAG,IAC9EK,EAAYR,EAAYK,MAAMF;AAGpC,MAAO,KAAOH,EAAYS,SAAW,IAAM,IAAML,EAAe,GAClE,EAEAM,IAAK,SAASV,GACZ,MAAO,eACT,EAEAW,IAAK,SAASX,GACZ,MAAO,cACT,EAEAY,MAAO,SAASZ,GACd,OAAOA,EAAYa,WACrB;AAGN,SAASC,EAAIC,GACX,OAAOA,EAAGC,WAAW,GAAGC,SAAS,IAAIC,aACvC,CAEA,SAASjB,EAAckB,GACrB,OAAOA,EACJC,QAAQ,MAAO,QACfA,QAAQ,KAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,gBAAyB,SAASL,GAAM,MAAO,OAASD,EAAIC,EAAK,IACzEK,QAAQ,yBAAyB,SAASL,GAAM,MAAO,MAASD,EAAIC,EAAK,GAC9E,CAEA,SAASP,EAAYW,GACnB,OAAOA,EACJC,QAAQ,MAAO,QACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,KAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,MAAO,OACfA,QAAQ,gBAAyB,SAASL,GAAM,MAAO,OAASD,EAAIC,EAAK,IACzEK,QAAQ,yBAAyB,SAASL,GAAM,MAAO,MAASD,EAAIC,EAAK,GAC9E,CA4CA,MAAO,YAtCP,SAA0B/B,GACxB,IACImB,EAAGkB,EANoBrB,EAKvBsB,EAAe,IAAIf,MAAMvB,EAASsB;AAGtC,IAAKH,EAAI,EAAGA,EAAInB,EAASsB,OAAQH,IAC/BmB,EAAanB,IATYH,EASahB,EAASmB,GAR1CL,EAAyBE,EAAYuB,MAAMvB;AAalD,GAFAsB,EAAaE,OAETF,EAAahB,OAAS,EAAG,CAC3B,IAAKH,EAAI,EAAGkB,EAAI,EAAGlB,EAAImB,EAAahB,OAAQH,IACtCmB,EAAanB,EAAI,KAAOmB,EAAanB,KACvCmB,EAAaD,GAAKC,EAAanB,GAC/BkB;AAGJC,EAAahB,OAASe,CACxB,CAEA,OAAQC,EAAahB,QACnB,KAAK,EACH,OAAOgB,EAAa;AAEtB,KAAK,EACH,OAAOA,EAAa,GAAK,OAASA,EAAa;AAEjD,QACE,OAAOA,EAAaG,MAAM,GAAI,GAAGC,KAAK,MAClC,QACAJ,EAAaA,EAAahB,OAAS,GAE7C,CAMqBqB,CAAiB3C,GAAY,QAJlD,SAAuBC,GACrB,OAAOA,EAAQ,IAAOgB,EAAchB,GAAS,IAAO,cACtD,CAE4D2C,CAAc3C,GAAS,SACrF,EAmiCA4C,EAAOC,QAAU,CACfC,YAAajD,EACbkD,MAniCF,SAAmBC,EAAOC,GACxBA,OAAsB,IAAZA,EAAqBA,EAAU,CAAC;AAE1C,IA0DIC,EA1DAC,EAAa,CAAC,EAEdC,EAAyB,CAAEC,KAAMC,GACjCC,EAAyBD,EAEzBE,EAAS,KACTC,EAASC,EAAuB,MAAM,GACtCC,EAAS,SAASC,EAAOC,GACnB,OA8/BR,SAAiBD,EAAOC,GACtB,OAAOD,EAAQC,EAAKC,IAAIC,IAAStB,KAAK,GACxC,CAhgCeuB,CAAQJ,EAAOC,EACxB,EACJI,EAAS,KACTC,EAASR,EAAuB,MAAM,GACtCS,EAAS,IACTC,EAASV,EAAuB,KAAK,GACrCW,EAAS,IACTC,EAASZ,EAAuB,KAAK,GAErCa,EAAUb,EAAuB,KAAK,GAEtCc,EAAUd,EAAuB,KAAK,GAEtCe,EAAUf,EAAuB,KAAK,GAEtCgB,EAAUhB,EAAuB,KAAK,GAEtCiB,EAAUjB,EAAuB,KAAK,GAGtCkB,EAAUlB,EAAuB,KAAK,GAEtCmB,EAAUC,EAAqB,UAE/BC,EAAU,QACVC,EAAUC,EAAqB,CAAC,IAAK,MAAM,GAAO,GAClDC,EAAU,SACVC,EAAUF,EAAqB,CAAC,CAAC,IAAK,OAAO,GAAO,GAEpDG,EAAU1B,EAAuB,KAAK,GAEtC2B,EAAU3B,EAAuB,KAAK,GACtC4B,EAAU,SACVC,EAAUN,EAAqB,CAAC,CAAC,IAAK,OAAO,GAAO,GACpDO,EAAU,YACVC,EAAUR,EAAqB,CAAC,CAAC,IAAK,KAAM,CAAC,IAAK,OAAO,GAAO,GAChES,EAAU,gBACVC,EAAUV,EAAqB,CAAC,CAAC,IAAK,KAAM,CAAC,IAAK,KAAM,CAAC,IAAK,KAAM,MAAM,GAAO,GAEjFW,EAAUd,EAAqB,cAC/Be,EAAU,aACVC,EAAUb,EAAqB,CAAC,IAAK,KAAM,KAAM,OAAO,GAAO,GAE/Dc,EAAuB,EACvBC,EAAuB,EACvBC,EAAuB,CAAC,CAAEC,KAAM,EAAGC,OAAQ,IAC3CC,EAAuB,EACvBC,EAAuB,GACvBC,EAAuB;AAI3B,GAAI,cAAerD,EAAS,CAC1B,KAAMA,EAAQsD,aAAanD,GACzB,MAAM,IAAIhD,MAAM,mCAAqC6C,EAAQsD,UAAY;AAG3EhD,EAAwBH,EAAuBH,EAAQsD,UACzD,CAEA,SAAStF,IACP,OAAO+B,EAAMwD,UAAUR,EAAcD,EACvC,CAsBA,SAASrC,EAAuBzC,EAAMwF,GACpC,MAAO,CAAEnE,KAAM,UAAWrB,KAAMA,EAAMwF,WAAYA,EACpD,CAEA,SAASxB,EAAqB7D,EAAOI,EAAUiF,GAC7C,MAAO,CAAEnE,KAAM,QAASlB,MAAOA,EAAOI,SAAUA,EAAUiF,WAAYA,EACxE,CAUA,SAAS3B,EAAqBlD,GAC5B,MAAO,CAAEU,KAAM,QAASV,YAAaA,EACvC,CAEA,SAAS8E,EAAsBC,GAC7B,IAAwCC,EAApCC,EAAUZ,EAAoBU;AAElC,GAAIE,EACF,OAAOA;AAGP,IADAD,EAAID,EAAM,GACFV,EAAoBW,IAC1BA;AASF,IALAC,EAAU,CACRX,MAFFW,EAAUZ,EAAoBW,IAEZV,KAChBC,OAAQU,EAAQV,QAGXS,EAAID,GACmB,KAAxB3D,EAAMjB,WAAW6E,IACnBC,EAAQX,OACRW,EAAQV,OAAS,GAEjBU,EAAQV,SAGVS;AAIF,OADAX,EAAoBU,GAAOE,EACpBA,CAEX,CAEA,SAASC,EAAoBC,EAAUC,GACrC,IAAIC,EAAkBP,EAAsBK,GACxCG,EAAkBR,EAAsBM;AAE5C,MAAO,CACLG,MAAO,CACLC,OAAQL,EACRb,KAAQe,EAAgBf,KACxBC,OAAQc,EAAgBd,QAE1BzE,IAAK,CACH0F,OAAQJ,EACRd,KAAQgB,EAAchB,KACtBC,OAAQe,EAAcf,QAG5B,CAEA,SAASkB,EAAStH,GACZgG,EAAcK,IAEdL,EAAcK,IAChBA,EAAiBL,EACjBM,EAAsB,IAGxBA,EAAoBiB,KAAKvH,GAC3B,CAMA,SAASwH,EAAyBxH,EAAUC,EAAOC,GACjD,OAAO,IAAIJ,EACTA,EAAgBe,aAAab,EAAUC,GACvCD,EACAC,EACAC,EAEJ,CAEA,SAASqD,IAKP,OAFKkE,GAGP,CAEA,SAASA,IACP,IAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC;AAIhC,GAFAP,EAAK1B,GACL2B,EAAKO,QACM9E,EAAY,CAmCrB,IAlCAwE,EAAK,GACLC,EAAK7B,GACL8B,EAAKK,QACM/E,GACLH,EAAMmF,OAAOpC,EAAa,KAAOvC,GACnCsE,EAAKtE,EACLuC,GAAe,IAEf+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS5D,IAEpCqE,IAAO3E,IACT4E,EAAKG,QACM/E,IACT6E,EAAKC,QACM9E,EAETyE,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAWtBjC,EAAc6B,EACdA,EAAKzE,KAGP4C,EAAc6B,EACdA,EAAKzE,GAEAyE,IAAOzE,GACZwE,EAAGL,KAAKM,GACRA,EAAK7B,GACL8B,EAAKK,QACM/E,GACLH,EAAMmF,OAAOpC,EAAa,KAAOvC,GACnCsE,EAAKtE,EACLuC,GAAe,IAEf+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS5D,IAEpCqE,IAAO3E,IACT4E,EAAKG,QACM/E,IACT6E,EAAKC,QACM9E,EAETyE,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAWtBjC,EAAc6B,EACdA,EAAKzE,KAGP4C,EAAc6B,EACdA,EAAKzE;AAGLwE,IAAOxE,GACT6C,EAAeyB,EAEfA,EADAC,EAAK/D,EAAO+D,EAAIC,KAGhB5B,EAAc0B,EACdA,EAAKtE,EAET,MACE4C,EAAc0B,EACdA,EAAKtE;AAGP,OAAOsE,CACT,CAEA,SAASQ,KACP,IAAIR,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC;AAIhC,GAFAP,EAAK1B,GACL2B,EAAKU,QACMjF,EAAY,CAmCrB,IAlCAwE,EAAK,GACLC,EAAK7B,GACL8B,EAAKK,QACM/E,GACLH,EAAMmF,OAAOpC,EAAa,KAAO9B,GACnC6D,EAAK7D,EACL8B,GAAe,IAEf+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAASnD,IAEpC4D,IAAO3E,IACT4E,EAAKG,QACM/E,IACT6E,EAAKI,QACMjF,EAETyE,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAWtBjC,EAAc6B,EACdA,EAAKzE,KAGP4C,EAAc6B,EACdA,EAAKzE,GAEAyE,IAAOzE,GACZwE,EAAGL,KAAKM,GACRA,EAAK7B,GACL8B,EAAKK,QACM/E,GACLH,EAAMmF,OAAOpC,EAAa,KAAO9B,GACnC6D,EAAK7D,EACL8B,GAAe,IAEf+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAASnD,IAEpC4D,IAAO3E,IACT4E,EAAKG,QACM/E,IACT6E,EAAKI,QACMjF,EAETyE,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAWtBjC,EAAc6B,EACdA,EAAKzE,KAGP4C,EAAc6B,EACdA,EAAKzE;AAGLwE,IAAOxE,GACT6C,EAAeyB,EAEfA,EADAC,EAAK/D,EAAO+D,EAAIC,KAGhB5B,EAAc0B,EACdA,EAAKtE,EAET,MACE4C,EAAc0B,EACdA,EAAKtE;AAGP,OAAOsE,CACT,CAEA,SAASW,KACP,IAAIX,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC;AAIhC,GAFAP,EAAK1B,GACL2B,EAAKW,QACMlF,EAAY,CA4CrB,IA3CAwE,EAAK,GACLC,EAAK7B,GACL8B,EAAKK,QACM/E,GAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EA1XK,IA2XL/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAASjD,IAEpC0D,IAAO3E,IAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EAAKzD,EACL0B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS/C,KAGtCwD,IAAO3E,IACT4E,EAAKG,QACM/E,IACT6E,EAAKK,QACMlF,EAETyE,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAWtBjC,EAAc6B,EACdA,EAAKzE,KAGP4C,EAAc6B,EACdA,EAAKzE,GAEAyE,IAAOzE,GACZwE,EAAGL,KAAKM,GACRA,EAAK7B,GACL8B,EAAKK,QACM/E,GAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EAtaG,IAuaH/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAASjD,IAEpC0D,IAAO3E,IAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EAAKzD,EACL0B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS/C,KAGtCwD,IAAO3E,IACT4E,EAAKG,QACM/E,IACT6E,EAAKK,QACMlF,EAETyE,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAWtBjC,EAAc6B,EACdA,EAAKzE,KAGP4C,EAAc6B,EACdA,EAAKzE;AAGLwE,IAAOxE,GACT6C,EAAeyB,EAEfA,EADAC,EAAK/D,EAAO+D,EAAIC,KAGhB5B,EAAc0B,EACdA,EAAKtE,EAET,MACE4C,EAAc0B,EACdA,EAAKtE;AAGP,OAAOsE,CACT,CAEA,SAASY,KACP,IAAIZ,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC,EAAIC;AAIhC,GAFAP,EAAK1B,GACL2B,EAAKY,QACMnF,EAAY,CAqDrB,IApDAwE,EAAK,GACLC,EAAK7B,GACL8B,EAAKK,QACM/E,GAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EApeK,IAqeL/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS9C,IAEpCuD,IAAO3E,IAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EA1eI,IA2eJ/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS7C,IAEpCsD,IAAO3E,IAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EAhfE,IAifF/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS5C,MAIxCqD,IAAO3E,IACT4E,EAAKG,QACM/E,IACT6E,EAAKM,QACMnF,EAETyE,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAWtBjC,EAAc6B,EACdA,EAAKzE,KAGP4C,EAAc6B,EACdA,EAAKzE,GAEAyE,IAAOzE,GACZwE,EAAGL,KAAKM,GACRA,EAAK7B,GACL8B,EAAKK,QACM/E,GAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EAzhBG,IA0hBH/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS9C,IAEpCuD,IAAO3E,IAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EA/hBE,IAgiBF/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS7C,IAEpCsD,IAAO3E,IAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EAriBA,IAsiBA/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS5C,MAIxCqD,IAAO3E,IACT4E,EAAKG,QACM/E,IACT6E,EAAKM,QACMnF,EAETyE,EADAC,EAAK,CAACA,EAAIC,EAAIC,EAAIC,IAWtBjC,EAAc6B,EACdA,EAAKzE,KAGP4C,EAAc6B,EACdA,EAAKzE;AAGLwE,IAAOxE,GACT6C,EAAeyB,EAEfA,EADAC,EAAK/D,EAAO+D,EAAIC,KAGhB5B,EAAc0B,EACdA,EAAKtE,EAET,MACE4C,EAAc0B,EACdA,EAAKtE;AAGP,OAAOsE,CACT,CAEA,SAASa,KACP,IAAIb,EAAIC,EAAIC,EAAIC,EAAQE;AA+ExB,OA7EAL,EAAK1B,EACiC,KAAlC/C,EAAMjB,WAAWgE,IACnB2B,EAxlBU,IAylBV3B,MAEA2B,EAAKvE,EACmB,IAApBmD,GAAyBe,EAAS3C,IAEpCgD,IAAOvE,IACTwE,EAAKO,QACM/E,IACTyE,EAAKJ,OACMrE,GACJ+E,OACM/E,GAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB+B,EApmBE,IAqmBF/B,MAEA+B,EAAK3E,EACmB,IAApBmD,GAAyBe,EAAS1C,IAEpCmD,IAAO3E,GACT6C,EAAeyB,EAEfA,EADAC,EA1mB0B,IA0mBbE,EA1mB0B,MA6mBvC7B,EAAc0B,EACdA,EAAKtE,KAeb4C,EAAc0B,EACdA,EAAKtE,GAEHsE,IAAOtE,IACTsE,EAAK1B,EACiC,KAAlC/C,EAAMjB,WAAWgE,IACnB2B,EAloBQ,IAmoBR3B,MAEA2B,EAAKvE,EACmB,IAApBmD,GAAyBe,EAASzC,IAEpC8C,IAAOvE,IACTwE,EAAKW,QACMnF,GACT6C,EAAeyB,EAEfA,EADAC,EA1oB6B,IA0oBhBC,IAOf5B,EAAc0B,EACdA,EAAKtE,GAEHsE,IAAOtE,IACTsE,EAUN,WACE,IAAIA,EAAIC,EAAIC,EAAIC,EAAIC;AAEpBvB,IACAmB,EAAK1B,EACiC,KAAlC/C,EAAMjB,WAAWgE,IACnB2B,EAAKrD,EACL0B,MAEA2B,EAAKvE,EACmB,IAApBmD,GAAyBe,EAAS/C;AAEpCoD,IAAOvE,IACTuE,EAAK;AAEHA,IAAOvE,GACTwE,EAkKJ,WACE,IAAIF,EAAIC,EAAIC,EAAIC;AAEsB,KAAlC5E,EAAMjB,WAAWgE,IACnB0B,EA50BU,IA60BV1B,MAEA0B,EAAKtE,EACmB,IAApBmD,GAAyBe,EAAShC;AAExC,GAAIoC,IAAOtE,EAST,GARAsE,EAAK1B,EACDT,EAAQiD,KAAKvF,EAAMwF,OAAOzC,KAC5B2B,EAAK1E,EAAMwF,OAAOzC,GAClBA,MAEA2B,EAAKvE,EACmB,IAApBmD,GAAyBe,EAAS9B,IAEpCmC,IAAOvE,EAAY,CASrB,IARAwE,EAAK,GACDzC,EAAQqD,KAAKvF,EAAMwF,OAAOzC,KAC5B6B,EAAK5E,EAAMwF,OAAOzC,GAClBA,MAEA6B,EAAKzE,EACmB,IAApBmD,GAAyBe,EAASlC,IAEjCyC,IAAOzE,GACZwE,EAAGL,KAAKM,GACJ1C,EAAQqD,KAAKvF,EAAMwF,OAAOzC,KAC5B6B,EAAK5E,EAAMwF,OAAOzC,GAClBA,MAEA6B,EAAKzE,EACmB,IAApBmD,GAAyBe,EAASlC;AAGtCwC,IAAOxE,EAETsE,EADAC,EAAK,CAACA,EAAIC,IAGV5B,EAAc0B,EACdA,EAAKtE,EAET,MACE4C,EAAc0B,EACdA,EAAKtE;AAIT,OAAOsE,CACT,CAtNSgB,GACDd,IAAOxE,GACTyE,EA+GN,WACE,IAAIH,EAAIC,EAAIC,EAAIC;AAEhBH,EAAK1B,EACiC,KAAlC/C,EAAMjB,WAAWgE,IACnB2B,EA9xBU,IA+xBV3B,MAEA2B,EAAKvE,EACmB,IAApBmD,GAAyBe,EAASjC;AAExC,GAAIsC,IAAOvE,EAAY,CASrB,GARAwE,EAAK,GACDzC,EAAQqD,KAAKvF,EAAMwF,OAAOzC,KAC5B6B,EAAK5E,EAAMwF,OAAOzC,GAClBA,MAEA6B,EAAKzE,EACmB,IAApBmD,GAAyBe,EAASlC,IAEpCyC,IAAOzE,EACT,KAAOyE,IAAOzE,GACZwE,EAAGL,KAAKM,GACJ1C,EAAQqD,KAAKvF,EAAMwF,OAAOzC,KAC5B6B,EAAK5E,EAAMwF,OAAOzC,GAClBA,MAEA6B,EAAKzE,EACmB,IAApBmD,GAAyBe,EAASlC;KAI1CwC,EAAKxE;AAEHwE,IAAOxE,EAETsE,EADAC,EAAK,CAACA,EAAIC,IAGV5B,EAAc0B,EACdA,EAAKtE,EAET,MACE4C,EAAc0B,EACdA,EAAKtE;AAGP,OAAOsE,CACT,CA9JWiB,GACDd,IAAOzE,IACTyE,EAAK,MAEHA,IAAOzE,GACT0E,EAiCR,WACE,IAAIJ,EAAIC,EAAIC,EAAIC,EAAIC;AAEpBJ,EAAK1B,EACDhB,EAAQwD,KAAKvF,EAAMwF,OAAOzC,KAC5B2B,EAAK1E,EAAMwF,OAAOzC,GAClBA,MAEA2B,EAAKvE,EACmB,IAApBmD,GAAyBe,EAASrC;AAExC,GAAI0C,IAAOvE,EAoBT,GAnBsC,KAAlCH,EAAMjB,WAAWgE,IACnB4B,EAAKtD,EACL0B,MAEA4B,EAAKxE,EACmB,IAApBmD,GAAyBe,EAAS/C,IAEpCqD,IAAOxE,IAC6B,KAAlCH,EAAMjB,WAAWgE,IACnB4B,EAAKxD,EACL4B,MAEA4B,EAAKxE,EACmB,IAApBmD,GAAyBe,EAASjD,KAGtCuD,IAAOxE,IACTwE,EAAK,MAEHA,IAAOxE,EAAY,CASrB,GARAyE,EAAK,GACD1C,EAAQqD,KAAKvF,EAAMwF,OAAOzC,KAC5B8B,EAAK7E,EAAMwF,OAAOzC,GAClBA,MAEA8B,EAAK1E,EACmB,IAApBmD,GAAyBe,EAASlC,IAEpC0C,IAAO1E,EACT,KAAO0E,IAAO1E,GACZyE,EAAGN,KAAKO,GACJ3C,EAAQqD,KAAKvF,EAAMwF,OAAOzC,KAC5B8B,EAAK7E,EAAMwF,OAAOzC,GAClBA,MAEA8B,EAAK1E,EACmB,IAApBmD,GAAyBe,EAASlC;KAI1CyC,EAAKzE;AAEHyE,IAAOzE,EAETsE,EADAC,EAAK,CAACA,EAAIC,EAAIC,IAGd7B,EAAc0B,EACdA,EAAKtE,EAET,MACE4C,EAAc0B,EACdA,EAAKtE;KAGP4C,EAAc0B,EACdA,EAAKtE;AAGP,OAAOsE,CACT,CAxGakB,GACDd,IAAO1E,IACT0E,EAAK,MAEHA,IAAO1E,GACT6C,EAAeyB,EAEfA,EADAC,EA1rBwBzG,MA6rBxB8E,EAAc0B,EACdA,EAAKtE,KAGP4C,EAAc0B,EACdA,EAAKtE,KAGP4C,EAAc0B,EACdA,EAAKtE,KAGP4C,EAAc0B,EACdA,EAAKtE;AAEPmD,IACImB,IAAOtE,IACTuE,EAAKvE,EACmB,IAApBmD,GAAyBe,EAASxC;AAGxC,OAAO4C,CACT,CAhEWmB,GACDnB,IAAOtE,IACTsE,EAgPR,WACE,IAAIA,EAAIC,EAAIC,EAAIC;AAEhBH,EAAK1B,EACL2B,EAAK,GACDlC,EAAQ+C,KAAKvF,EAAMwF,OAAOzC,KAC5B4B,EAAK3E,EAAMwF,OAAOzC,GAClBA,MAEA4B,EAAKxE,EACmB,IAApBmD,GAAyBe,EAAS5B;AAExC,GAAIkC,IAAOxE,EACT,KAAOwE,IAAOxE,GACZuE,EAAGJ,KAAKK,GACJnC,EAAQ+C,KAAKvF,EAAMwF,OAAOzC,KAC5B4B,EAAK3E,EAAMwF,OAAOzC,GAClBA,MAEA4B,EAAKxE,EACmB,IAApBmD,GAAyBe,EAAS5B;KAI1CiC,EAAKvE;AAEP,GAAIuE,IAAOvE,EAAY,CASrB,IARAwE,EAAK,GACDjC,EAAQ6C,KAAKvF,EAAMwF,OAAOzC,KAC5B6B,EAAK5E,EAAMwF,OAAOzC,GAClBA,MAEA6B,EAAKzE,EACmB,IAApBmD,GAAyBe,EAAS1B,IAEjCiC,IAAOzE,GACZwE,EAAGL,KAAKM,GACJlC,EAAQ6C,KAAKvF,EAAMwF,OAAOzC,KAC5B6B,EAAK5E,EAAMwF,OAAOzC,GAClBA,MAEA6B,EAAKzE,EACmB,IAApBmD,GAAyBe,EAAS1B;AAGtCgC,IAAOxE,GACT6C,EAAeyB,EAEfA,EADAC,EAr6B4B,OAASmB,KAAKC,UAAU7H,KAAU,MAw6B9D8E,EAAc0B,EACdA,EAAKtE,EAET,MACE4C,EAAc0B,EACdA,EAAKtE;AAGP,OAAOsE,CACT,CA3SasB,MAKJtB,CACT,CAuSA,SAASS,KACP,IAAIT,EAAIC;AAWR,IATApB,IACAmB,EAAK,GACD5B,EAAQ0C,KAAKvF,EAAMwF,OAAOzC,KAC5B2B,EAAK1E,EAAMwF,OAAOzC,GAClBA,MAEA2B,EAAKvE,EACmB,IAApBmD,GAAyBe,EAASvB,IAEjC4B,IAAOvE,GACZsE,EAAGH,KAAKI,GACJ7B,EAAQ0C,KAAKvF,EAAMwF,OAAOzC,KAC5B2B,EAAK1E,EAAMwF,OAAOzC,GAClBA,MAEA2B,EAAKvE,EACmB,IAApBmD,GAAyBe,EAASvB;AAS1C,OANAQ,IACImB,IAAOtE,IACTuE,EAAKvE,EACmB,IAApBmD,GAAyBe,EAASzB,IAGjC6B,CACT,CAGE,SAAS1D,GAAQiF,GAGf,MAAO,IAFQA,EAAK,GAEI,IADVA,EAAK,EAErB,CAQF,IAFA9F,EAAaK,OAEMJ,GAAc4C,IAAgB/C,EAAM3B,OACrD,OAAO6B;AAMP,MAJIA,IAAeC,GAAc4C,EAAc/C,EAAM3B,QACnDgG,EAx6BK,CAAE/E,KAAM,QA26BTiF,EACJlB,EACAD,EAAiBpD,EAAM3B,OAAS2B,EAAMwF,OAAOpC,GAAkB,KAC/DA,EAAiBpD,EAAM3B,OACnByF,EAAoBV,EAAgBA,EAAiB,GACrDU,EAAoBV,EAAgBA,GAG9C,E;AClqCA,MAAM6C,IAAM,6CAAM;AAElB,SAASC,eAAeC,MACtB,MAAMC,GAAKC,KAAK,2BAA6BF,KAAO;AAGpD,OAFAC,GAAGE,YAAc,IAAMH,KAAO,IAC9BC,GAAGG,WAAa,aAAahB,KAAKY,MAC3BC,EACT,CAEO,SAASI,WAAWvI,GACzBgI,IAAI,aAAchI;AAClB,MAAMkI,EAAO,qDAAApG,MAAa9B;AAC1BgI,IAAI,kBAAmBhI,EAAMkI;AAC7B,MAAMM,EAAIP,eAAeC;AACzB,IAAIO;AAWJ,OATEA,EADED,EAAEF,SACOE,EAEA,SAAUE,GACnB,OAAOF,GAAE,SAAUG,GACjB,OAAOD,EAAKC,EACd,GACF,EAEFF,EAASH,SAAWE,EAAEF,SACfG,CACT,CAEA,gC;;AC9BA,SAASG,EAAeC,EAAGC,GASzB,OAMA,kCAAuC,KAAM,EANtC,IAAI,iBAAoBD,EAAGC,EAAG,CAAEC,aAAa,GACtD,CAQO,MAAMC,EACXxJ,YAAYyJ,GAAM,iBAAEC,GAAqB,CAAC,GACxCjK,KAAKkK,KAAO,CAAC,EACblK,KAAKmK,MAAQH,EACbhK,KAAKoK,kBAAoBH,EACzBjK,KAAKqK,UAAYL,EAAKM,YAAYtK,MAClCA,KAAKuK,UAAYZ,EAAeK,EAAKQ,MAAOR,EAAKS,QACjDzK,KAAK0K,MAAQ1K,KAAKqK,UAAUM,OAC5B3K,KAAK4K,KAAO5K,KAAKuK,UAAUK,KAC3B5K,KAAK6K,SAAWb,EAAKP,KACrBzJ,KAAK8K,qBACP,CAEAC,OAAOtB,GACLzJ,KAAKqK,UAAUjD,KAAKqC,GACpBzJ,KAAKuK,UAAUQ,OAAO/K,KAAK0K,MAC7B,CAEAM,UACEhL,KAAKqK,UAAUW,UACfhL,KAAKqK,UAAY,KACjBrK,KAAKiL,wBACP,CAEInI,YACF,OAAO9C,KAAKkL,OAAOC,KACrB,CAEAC,IAAI1B,EAAKiB,IACK3K,KAAKkK,KAAKR,KAAS1J,KAAKkK,KAAKR,GAAO,IAAI2B,MAChDC,IAAIX,EACV,CAEAY,MAAM7B,EAAKiB,GACT,MAAMa,EAAMxL,KAAKkK,KAAKR;AACjB8B,GACLA,EAAIC,OAAOd,EACb,CAEAG,sBACE,IAAIY,EAAQ,KACRC,EAAU;AACd,MAAMC,EAAWC,IACfH,EAAQG,CAAC,EAELC,EAAiBD,IACrBH,EAAQA,GAASG,CAAC,EAEdE,EAAY,KAChBL,EAAQ,IAAI,EAERM,EAAWH,IACfF,EAAU,GAAGrJ,MAAM2J,KAAKJ,EAAEF,QAAQ,EAE9BO,EAAclM,KAAKoK,mBAAqBpK,KAAK4K,KAC7CJ,EAAQxK,KAAKmK,MAAMK,MACnBC,EAASzK,KAAKmK,MAAMM;AA6B1B,SAAS0B,EAAMC,EAAI1F,EAAG2F,GACpB,MAAO,CACLC,GAAK5F,EAAE6F,QAAUF,EAAKG,MAAQH,EAAK7B,MAASA,EAC5CiC,GAAK/F,EAAEgG,QAAUL,EAAKM,KAAON,EAAK5B,OAAUA,EAC5C2B,GAAIA,EAER,CAlCAF,EAAYU,iBAAiB,YAAahB,GAAS,GACnDM,EAAYU,iBAAiB,YAAad,GAAe,GACzDI,EAAYU,iBAAiB,UAAWb,GAAW,GACnDG,EAAYU,iBAAiB,aAAcZ,GAAS,GACpDE,EAAYU,iBAAiB,YAAaZ,GAAS,GACnDE,EAAYU,iBAAiB,WAAYZ,GAAS,GAClDhM,KAAKiL,uBAAyB,KAC5BiB,EAAYW,oBAAoB,YAAajB,GAAS,GACtDM,EAAYW,oBAAoB,YAAaf,GAAe,GAC5DI,EAAYW,oBAAoB,UAAWd,GAAW,GACtDG,EAAYW,oBAAoB,aAAcb,GAAS,GACvDE,EAAYW,oBAAoB,YAAab,GAAS,GACtDE,EAAYW,oBAAoB,WAAYb,GAAS,EAAM,EAE7DhM,KAAKkL,OAAS,CACZC,IAAK,KACH,MAAM2B,EAAS,GACTT,EAAOrM,KAAK4K,KAAKmC;AACnBrB,GACFoB,EAAO1F,KAAK+E,EAAM,QAAST,EAAOW;AAEpC,IAAK,IAAIrL,EAAI,EAAGA,EAAI2K,EAAQxK,OAAQH,IAAK,CACvC,MAAMgM,EAAQrB,EAAQ3K;AACtB8L,EAAO1F,KAAK+E,EAAM,QAAUa,EAAMC,WAAYD,EAAOX,G,CAEvD,OAAOS,CAAM,EAUnB,EAGF,I;ACjGA,MARO,MACLI,eAAgBC,EAAUC,GACxB,IAAIC,EAAO,IAAIrN;AAEf,OADAqN,EAAKC,QAAQH,EAAUC,GAChBC,CACT,G;ACkFF,MA/FO,MACL9M,YAAawC,GAQX,GAPA/C,KAAKuN,SAAWxK,EAAQyK,QACxBxN,KAAKyN,QAAU1K,EAAQ4H,OACvB3K,KAAK0N,UAAY3K,EAAQ4K,SACzB3N,KAAK4N,UAAY,GACjB5N,KAAK6N,UAAY,GACjB7N,KAAK8N,OAAS,IAAI,IAAU/K,EAAQ+K,QACpC9N,KAAK+N,UAAY,IAAI,IAAUhL,EAAQgL,WACnChL,EAAQiL,SACV,IAAK,IAAIC,KAAWlL,EAAQiL,SAC1BhO,KAAKkO,QAAQD;AAGjB,GAAIlL,EAAQoL,SACV,IAAK,IAAIC,KAAWrL,EAAQoL,SAC1BnO,KAAK6N,UAAUzG,KAAKgH,EAAQ9D,YAAYtK,KAAKuN,SAAUvN;AAG3D,GAAI+C,EAAQ4K,SACV,IAAK,IAAIA,KAAY5K,EAAQ4K,SAC3B3N,KAAK6N,UAAUzG,KAAKuG,EAASrD,YAAYtK,KAAKuN,SAAUvN,KAAKyN;AAG7D1K,EAAQsL,UACV,IAAI,IAAUtL,EAAQsL,UAAUpC,OAE9BlJ,EAAQ1C,QACVL,KAAKsO,SAASvL,EAAQ1C,OAE1B,CACA6N,QAASK,GACP,IAAIC,EAqDR,SAAmBjF,GACjB,IAAIkF;AACJ,OAAO,SAA0BC,GAC3BD,IAAUC,IACZD,EAAQC,EACRnF,EAAEmF,GAEN,CACF,CA7DqBC,CAASJ,EAASK;AACX,IAApBL,EAASpN,QAAgBoN,EAAS,GAAGlF,SAGvCmF,EAAWD,EAAS,MAEpBvO,KAAK4N,UAAUxG,MAAKqH,IAClB,IAAK,IAAIzN,EAAI,EAAGA,EAAIuN,EAASpN,OAAQH,IACnCyN,EAAQF,EAASvN,GAAGyN;AAEtBD,EAAWC,EAAM,GAGvB,CACAH,SAAUjO,GACRL,KAAK6O,QAAUxO,EACfL,KAAK6O,QAAQC,SAAS9O,KAAKyN,QAC7B,CACAsB,SACM/O,KAAK6O,UACP7O,KAAK6O,QAAQG,YAAYhP,KAAKyN,SAC9BzN,KAAK6O,QAAU,KAEnB,CACAzH,KAAMqH,GACJ,IAAIzN;AACJ,IAAKA,EAAI,EAAGA,EAAIhB,KAAK4N,UAAUzM,OAAQH,IACrChB,KAAK4N,UAAU5M,GAAGyN;AAEpB,IAAKzN,EAAI,EAAGA,EAAIhB,KAAK6N,UAAU1M,OAAQH,IACrChB,KAAK6N,UAAU7M,GAAGoG,KAAKqH;AAEzBzO,KAAK8N,OAAO7B,KAAKwC,EACnB,CACAzD,UACEhL,KAAK+O;AACL,IAAK,IAAI/N,EAAI,EAAGA,EAAIhB,KAAK6N,UAAU1M,OAAQH,IACzChB,KAAK6N,UAAU7M,GAAGgK;AAEpBhL,KAAK+N,UAAU9B,OACfjM,KAAK6N,UAAY,KACjB7N,KAAK4N,UAAY,KACjB5N,KAAK6O,QAAU,KACf7O,KAAKyN,QAAU,IACjB,CACI9C,aACF,OAAO3K,KAAKyN,OACd,CACIpN,aACF,OAAOL,KAAK6O,OACd,G;AC3EF,MAAMI,EAAa,CACjB,CAAEhP,KAAM,IAAKiP,QAAS,IAAKC,MAAO,CAACC,EAAKV,IAAOU,EAAI9C,EAAIoC,GACvD,CAAEzO,KAAM,IAAKiP,QAAS,IAAKC,MAAO,CAACC,EAAKV,IAAOU,EAAI3C,EAAIiC,GACvD,CAAEzO,KAAM,UAAWiP,QAAS,IAAKC,MAAO,CAACC,EAAKV,IAAOU,EAAIC,MAAM/C,EAAIoC,GACnE,CAAEzO,KAAM,UAAWiP,QAAS,IAAKC,MAAO,CAACC,EAAKV,IAAOU,EAAIC,MAAM5C,EAAIiC,GACnE,CAAEzO,KAAM,QAASiP,QAAS,IAAKC,MAAO,CAACC,EAAKV,IAAOU,EAAIE,MAAQZ,GAC/D,CAAEzO,KAAM,QAASkP,MAAO,CAACC,EAAKV,IAAOU,EAAI5E,MAAQkE,GACjD,CAAEzO,KAAM,SAAUkP,MAAO,CAACC,EAAKV,IAAOU,EAAI3E,OAASiE,GACnD,CAAEzO,KAAM,UAAWkP,MAAO,CAACC,EAAKV,IAAOU,EAAIG,QAAUb;AA+CvD,MA5CO,cAA4B,EACjCpB,QAAQH,EAAUC,GAChBpN,KAAKwP,WAAa,aAAkBrC,EAAUC,GAC9CpN,KAAK4N,UAAY;AACjB,IAAK,MAAM6B,KAAYR,EAAY,CACjC,MAAMhG,EAAOmE,EAAIsC,KAAKD,EAASxP,OAASwP,EAASP;AACjD,IAAKjG,EAAM;AACX,MAAM0G,EAAa,IAAI,IAAW1G,GAC5B2G,EAAS5P,KAAKwP,WAAWK,KAAKJ,EAASxP,KAAM0P;AACnD3P,KAAK4N,UAAUxG,KAAK,CAClBwI,OAAQA,EACRT,MAAOM,EAASN,O,CAGpBnP,KAAK8P,UAwBT,SAAwB/O,GACtB,GAAa,WAATA,EAAmB,OAAO;AAC9B,GAAa,WAATA,EAAmB,OAAO;AAC9B,MAAM,IAAIb,MAAM,uBAAyBa,EAC3C,CA5BqBgP,CAAe3C,EAAIsC,KAAK,UAAY,UACrD1P,KAAKoL,IAAMgC,EAAIsC,KAAK,QAAU,IAChC,CAEApF,YAAYkD,EAASwC,GACnB,MAAMrF,EAASqF,EAAQrF,OACjBqD,EAAW;AACjB,IAAID,EAAY;AAChBpD,EAAOmF,UAAY9P,KAAK8P;AACxB,IAAK,IAAI9O,EAAI,EAAGA,EAAIhB,KAAK4N,UAAUzM,OAAQH,IAAK,CAC9C,MAAMiN,EAAUjO,KAAK4N,UAAU5M;AAC/BgN,EAAS5G,KAAK,CAAC6G,EAAQ2B,OAAQ3B,EAAQkB,MAAMjB,KAAK,KAAMvD,I,CAM1D,OAJI3K,KAAKoL,MACPoC,EAAQpC,IAAIpL,KAAKoL,IAAKT,GACtBoD,EAAY,IAAMP,EAAQjC,MAAMvL,KAAKoL,IAAKT,IAErC,IAAI,EAAS,CAClBqD,SAAUA,EACVD,UAAWA,GAEf;ACrDK,SAASkC,EAAYlP,GAC1B,IAAImP,EAAInP,EAAKoP,MAAM;AACnB,OAAKD,EACE,IAAI,aAAgBA,EAAE,IAAKA,EAAE,IAAKA,EAAE,IAAKA,EAAE,IADnC,IAEjB,CCEO,MAAME,EACX7P,YAAY8P,GACVrQ,KAAKsQ,OAASD,CAChB,CAEA/F,YAAYkD,EAASwC,GACnB,MAAMO,EAAO,IAAI;AAKjB,OAJAA,EAAKC,YACLD,EAAKE,UAAUzQ,KAAKsQ,QACpBC,EAAKG,UACLV,EAAQrF,OAAO4F,KAAOA,EACf,IAAI,EAAS,CAClB/C,QAASA,EACT7C,OAAQ4F,EACRlQ,OAAQ2P,EAAQrF,QAEpB,EA2BF,MAxBO,cAAwB,EAC7B2C,QAAQH,EAAUC,GAChBpN,KAAK2N,SAAWR,EAASwD,gBAAgBvD,GACzCpN,KAAK4Q,QAAU,UAAsBzD,EAAUC;AAC/C,MAAMyD,EAAYZ,EAAW7C,EAAIsC,KAAK,SAAW;AAC7CmB,IAAW7Q,KAAKuQ,KAAO,IAAIH,EAAKS,GACtC,CAEAvG,YAAYkD,EAASsD,GACnB,MAAMnG,EAAS,IAAI,YACbwD,EAAW,CAACnO,KAAK4Q;AAIvB,OAHI5Q,KAAKuQ,MACPpC,EAAS/G,KAAKpH,KAAKuQ,MAEd,IAAI,EAAS,CAClB/C,QAASA,EACT7C,OAAQA,EACRtK,OAAQyQ,EACR3C,SAAUA,EACVR,SAAU3N,KAAK2N,UAEnB;ACFF,MAxCO,cAAqB,EAC1BL,QAAQH,EAAUC,GAChB,MAAMO,EAAWR,EAASwD,gBAAgBvD;AAC1C,GAAwB,IAApBO,EAASxM,OACX,MAAM,IAAIjB,MACR,gCAAkCyN,EAASxM,OAAS;AAGxDnB,KAAKI,MAAQuN,EAAS,GACtB3N,KAAK0J,IAAM,IAAI,IAAW0D,EAAIsC,KAAK,QACnC1P,KAAKyO,MAAQsC,OAAO3D,EAAIsC,KAAK,SAC/B,CAEApF,YAAYkD,EAASsD,GACnB,MAAMnG,EAAS,IAAI,YACbxH,EAAOnD,KAAK0J,IACZ+E,EAAQzO,KAAKyO,MACbuC,EAAYhR,KAAKI;AACvB,IAAIA,EAAQ;AACZ,OAAO,IAAI,EAAS,CAClBoN,QAASA,EACTnN,OAAQyQ,EACRnG,OAAQA,EACRmD,OAASrE,IACHsH,OAAO5N,EAAKsG,MAAWgF,GACX,OAAVrO,IACFA,EAAQ4Q,EAAU1G,YAAYkD,EAAS7C,IAEzCvK,EAAMgH,KAAKqC,IAEG,OAAVrJ,IACFA,EAAM4K,UACN5K,EAAQ,K,GAKlB;ACrCF,SAAS6Q,EAAa9N,EAAM/C,EAAO8Q,GACjC,MAAO,CACL5G,YAAYkD,EAASwC,GACnB,MAAMmB,EAAY,IAAIC,IAChBC,EAAO;AAEb,OAMA,WACE,IAAIC;AACJ,IAAK,IAAItQ,EAAI,EAAGA,EAAIkQ,EAAUlQ,IAC5BsQ,EAAWlR,EAAMkK,YAAYkD,EAASwC,EAAQrF,QAC9C2G,EAASvC,SACTsC,EAAKjK,KAAKkK,EAEd,CAdAC,GACO,IAAI,EAAS,CAClB/D,QAASA,EACTM,OAASrE,KAYX,SAAgB+H,GACd,MAAMC,EAAS,IAAIpG,IAAI8F,EAAUO;AACjC,IAAIhI,EACAZ,EACAwI;AACCE,IAAOA,EAAQ;AACpB,IAAK,IAAIxQ,EAAI,EAAGA,EAAIwQ,EAAMrQ,OAAQH,IAChC8H,EAAO0I,EAAMxQ,GACb0I,EAAMZ,EAAKY,IACPyH,EAAUQ,IAAIjI,GAChB4H,EAAWH,EAAUhG,IAAIzB,IAEzB4H,EAAWM,IACXT,EAAU3F,IAAI9B,EAAK4H,IAErBA,EAASlK,KAAK0B,GACd2I,EAAOhG,OAAO/B;AAEhB,IAAKA,KAAO+H,EACVH,EAAWH,EAAUhG,IAAIzB,GACzB4H,EAASvC,SACToC,EAAU1F,OAAO/B,GACjB2H,EAAKjK,KAAKkK,EAEd,CAnCIO,CAAO1O,EAAKsG,GAAM;AAoCtB,SAASmI,IACP,IAAIN,EAAWD,EAAKzC;AAMpB,OALI0C,EACFA,EAAShD,SAAS0B,EAAQrF,QAE1B2G,EAAWlR,EAAMkK,YAAYkD,EAASwC,EAAQrF,QAEzC2G,CACT,CACF,EAEJ,CA6BA,MA3BO,cAAyB,EAC9BhE,QAAQH,EAAUC,GAEhB,GADApN,KAAK2N,SAAWR,EAASwD,gBAAgBvD,GACZ,IAAzBpN,KAAK2N,SAASxM,OAChB,MAAM,IAAIjB,MACR,gCAAkCF,KAAK2N,SAASxM,OAAS;AAG7DnB,KAAKqR,MAAQjE,EAAIsC,KAAK,SAAW,EACjC1P,KAAK0J,IAAM,IAAI,IAAW0D,EAAIsC,KAAK,OACrC,CAEApF,YAAYkD,EAASsD,GACnB,MAAMgB,EAAQ,IAAI,mCAAiCC,EAAW,CAC5DC,UAAU,EACV1C,OAAO,IAEH2C,EAAU,IAAIhB,EAAajR,KAAK0J,IAAK1J,KAAK2N,SAAS,GAAI3N,KAAKqR;AAClE,OAAO,IAAI,EAAS,CAClB7D,QAASA,EACTnN,OAAQyQ,EACRnG,OAAQmH,EACR3D,SAAU,CAAC8D,IAEf;ACjEF,MAlBO,cAA2B,EAChC3E,QAAQH,EAAUC,GAChBpN,KAAK2N,SAAWR,EAASwD,gBAAgBvD,GACzCpN,KAAKwK,OAAS4C,EAAIsC,KAAK,SACvB1P,KAAKyK,QAAU2C,EAAIsC,KAAK,UACxB1P,KAAKyJ,KAAO2D,EAAI3D,MAClB,CAEAa,YAAYkD,GACV,MAAM9C,EAAQ,IAAI,QAAW;AAC7B,OAAO,IAAI,EAAS,CAClB8C,QAASA,EACT7C,OAAQD,EACRiD,SAAU3N,KAAK2N,UAEnB;ACkBF,MA/BO,cAAyB,EAC9BL,QAAQH,EAAUC,GAChBpN,KAAKkS,IAAM/E,EAASgF,UAAUhH,IAAIiC,EAAIsC,KAAK,UAC3C1P,KAAK4Q,QAAU,UAAsBzD,EAAUC,GAC/CpN,KAAKqQ,MAAQJ,EAAW7C,EAAIsC,KAAK,UAAY,IAC7C1P,KAAKoS,SAAWhF,EAAIsC,KAAK,aAAe,EACxC1P,KAAKqS,SAAWjF,EAAIsC,KAAK,aAAe,CAC1C,CAEApF,YAAYkD,EAASsD,GACnB,MAAMwB,EAAS,IAAI,SAAYtS,KAAKuS;AAGpC,OAFAD,EAAOE,OAAOlG,EAAItM,KAAKoS,QACvBE,EAAOE,OAAO/F,EAAIzM,KAAKqS,QAChB,IAAI,EAAS,CAClB7E,QAASA,EACT7C,OAAQ2H,EACRjS,OAAQyQ,EACR3C,SAAU,CAACnO,KAAK4Q,UAEpB,CAEA2B,aACE,GAAIvS,KAAKyS,SAAU,OAAOzS,KAAKyS;AAC/B,MAAMC,EAAY,sBACZC,EAAO,wBAA2B3S,KAAKkS,SAAKH,EAAWW,GACvDE,EAAU,IAAI,UAAaD,EAAM3S,KAAKqQ;AAE5C,OADArQ,KAAKyS,SAAWG,EACTA,CACT;ACeF,MA3CO,cAAuB,EAC5BtF,QAAQH,EAAUC,GAChBpN,KAAK6S,KAAOzF,EAAIsC,KAAK,QACrB1P,KAAKe,KAAOqM,EAAIsC,KAAK,QACrB1P,KAAKyJ,KAAO,IAAI,IAAW2D,EAAIsC,KAAK,SAAW,KAC/C1P,KAAK4Q,QAAU,UAAsBzD,EAAUC,GAC/CpN,KAAK8S,KAAO1F,EAAIsC,KAAK,YACrB1P,KAAK+S,KAAO3F,EAAIsC,KAAK,QACrB1P,KAAKgT,MACmB,SAAtB5F,EAAIsC,KAAK,SAAsB,EAA0B,UAAtBtC,EAAIsC,KAAK,SAAuB,EAAI,EAC3E,CAEApF,YAAYkD,EAASsD,GACnB,IAAI/P;AAEFA,EADEf,KAAK8S,IACA,IAAI,OAAU9S,KAAKe,KAAM,CAC9B8R,KAAM7S,KAAK6S,KACXE,KAAM/S,KAAK+S,OAGN,IAAI,oBAAuB/S,KAAKe,KAAM,CAAE8R,KAAM7S,KAAK6S;AAE5D,MAAMlI,EAAS,IAAI;AAEnB,OADAA,EAAOmE,SAAS/N,GACT,IAAI,EAAS,CAClByM,QAASA,EACTnN,OAAQyQ,EACRnG,OAAQA,EACRwD,SAAU,CAACnO,KAAK4Q,SAChB5C,SAAU,CACR,CACEhO,KAAKyJ,KACJiF,IACC3N,EAAKA,KAAOf,KAAKe,KAAKkB,QAAQ,KAAMyM,GACpC3N,EAAKkS,aACLlS,EAAKuL,EAAIvL,EAAKyJ,OAASxK,KAAKgT,KAAK,KAK3C;ACrCF,MAAMjK,EAAM,IAAM,yBAEZmK,EAAQ,CACZlJ,KAAM,EACNsI,OAAQ,EACRa,MAAO,EACPxI,OAAQ,EACR5J,KAAM,EACNqS,GAAI;AAMN,MAAMC,EACJ9S,YAAY+S,GACVC,OAAOC,OAAOxT,KAAMsT,GACpBtT,KAAKyT,MAAQ,IAAIrC,GACnB,CAEA9D,QAAQF,GACN,MAAMsG,EAAWtG,EAAI,GAAGsG;AACxB3K,EAAI,YAAaqE,EAAI;AACrB,MAAMuG,EAAON,EAASO,aAAaF;AACnC,IAAKC,EAAM,MAAM,IAAIzT,MAAM,sBAAwBwT;AACnD,OAAOC,EAAKrG,QAAQtN,KAAMoN,EAC5B,CAEAuD,gBAAgBvD,GACd,MAAMN,EAAS;AACf,IAAK,MAAM1M,KAASgB,MAAMyS,KAAKzG,EAAIO,YAAa,CAC9C,MAAM+F,EAAWtT,EAAMsT;AACvB,GAAiB,SAAbA,EACF1T,KAAK8T,YAAY,IAAE1T;KACd,GAAiB,QAAbsT,EACT5G,EAAO1F,KAAKpH,KAAK+T,OAAO3T,EAAM4T,aAAa;IACtC,CACQX,EAASO,aAAaF,IACzB5G,EAAO1F,KAAKpH,KAAKsN,QAAQ,IAAElN,I,EAGzC,OAAO0M,CACT,CAEAgH,YAAY1G,GACV,IAAK,MAAMhN,KAASgB,MAAMyS,KAAKzG,EAAIO,YAAa,CAC9C,MAAMvB,EAAKhM,EAAM4T,aAAa;AAC9B,IAAK5H,EAAI,MAAM,IAAIlM,MAAM,4BAA8BE,EAAMsT;AAC7D1T,KAAKyT,MAAMjI,IAAIY,EAAIpM,KAAKsN,QAAQ,IAAElN,I,CAEtC,CAEA2T,OAAO3H,GACL,MAAMiB,EAAOrN,KAAKyT,MAAMtI,IAAIiB;AAC5B,IAAKiB,EAAM,MAAM,IAAInN,MAAM,oBAAsBkM;AACjD,OAAOiB,CACT,CAEAH,oBAAoBwG,GAClB,OAAOR,EAAMQ,EACf,EAGF,Q;AChDA,MAnBO,MACLnT,cACEP,KAAKiU,KAAO,CAAC,CACf,CAEA3I,IAAI4I,EAAKhC,GACPlS,KAAKiU,KAAKC,GAAOhC,CACnB,CAEA/G,IAAI+I,GACF,KAAMA,KAAOlU,KAAKiU,MAAO,MAAM,IAAI/T,MAAM,mBAAqBgU;AAC9D,OAAOlU,KAAKiU,KAAKC,EACnB,CAEIC,WACF,OAAO,WAASnU,KAAKiU,KACvB;ACdF,MAAM,EAAM,IAAM;AAEXG,eAAeC,EAAKC,EAASC,GAClC,EAAI,mBAAoBD;AACxB,MAAME,QA8BSC,EA9BYH,EA+BpBI,MAAMD,GACVE,MAAMC,GAAQA,EAAI7T,SAClB4T,MAAM5T,GACL,KAAE,IAAI8T,WAAYC,gBAAgB/T,EAAM,YAAYgU;AAJ1D,IAAiBN;AA3Bf,MAAMtC,EAAY,IAAI,EAChB6C,EAAQ,IAAI3J;AAClB,IAAK,MAAM4J,KAAW7T,MAAMyS,KAAKW,EAAKU,KAAK,YACzCF,EAAM1J,IAAI,IAAE2J,GAASvF,KAAK;AAE5B,IAAK,MAAMuF,KAAW7T,MAAMyS,KAAKW,EAAKU,KAAK,eACzCF,EAAM1J,IAAI,IAAE2J,GAASvF,KAAK;AAE5B,MAAMiD,EAAO,IAAIwC,IAAIb,EAAS;AAC9B,IAAK,MAAMc,KAAQJ,EAAO,CACxB,MAAMK,EAAW,IAAIF,IAAIC,EAAMzC;AAC/B,GAA0B,UAAtB0C,EAASC,SAAsB,CACjC,MAAM,SAAEC,EAAQ,OAAEC,EAAM,KAAEC,GAASJ;AACnClD,EAAU7G,IAAI8J,EAAMG,EAAWC,EAASC,E,MAExCtD,EAAU7G,IAAI8J,EAAMC,EAASvT,W,CASjC,aAWF,SAAuBqQ,EAAWoC,GAEhC,OADA,EAAI,qBACG,IAAImB,SAAQ,SAAUC,GAC3B,GAA8B,IAA1BxD,EAAUgC,KAAKhT,OAAc,OAAOwU;AACxC,MAAMC,EAAS,IAAI;AACnB,IAAK,MAAM1D,KAAOC,EAAUgC,KAC1ByB,EAAOtK,IAAI4G,EAAKA;AAElB0D,EAAOC,KAAK,YAAY,WACtB,EAAI,8BACJF,GACF,IACIpB,IACFA,EAASuB,UAAY,KACrBF,EAAOC,KAAK,YAAY,WACtBtB,EAASwB,OAAO,IAAK,IACvB,IACAH,EAAOI,GAAG,YAAY,WACpBzB,EAASwB,OAAOH,EAAOrB,SAAU,IACnC,KAEFqB,EAAOvB,MACT,GACF,CAtCQ4B,CAAc9D,EAAWoC,GAG/B,EAAI,aACG,IAAI,EAAS,CAAEpC,cAAa7E,QAAQkH,EAC7C,CCnCO,SAAS0B,GAAW,YAAEC,GAAgB,CAAC,GAC5C,MAAoB,YAAhBA,EACK,kCAEHC,OAAOC,WAAaD,OAAOE,YACtB,gCAEA,gCAGb,C;;ACXA,MAAMC,EAAiBC,GACrBjD,OAAOC,OAAO,CAAC,EAAGgD,EAAK,CAAE/M,KAAM,IAAQ+M,EAAI/M;AAEtC,MAAMgN,EACXlW,YAAYmW,EAAYC,GACtB3W,KAAK4W,SAAWD,GAAW,IAC3B3W,KAAK6W,YAAc,IAAEH,GAClB9S,KAAKkT,GAAc,QAAMA,EAAUrN,KAAM,UACzCsN,UACAC,MAAMxF,GAAU,IAAInG,IAAImG,KACxB/C,QACHzO,KAAKiX,YAAc,QAAMP,EAAYH,GACrCvW,KAAKkX,QAAU,SAAO,QAAMR,EAAY,MAC1C,CAEA7G,KAAK5P,EAAMkX,GACT,OAAKnX,KAAK6W,YAAYlF,IAAI1R,GAGlBwJ,IACN,MAAM2N,EAASpX,KAAKqX,cAAc5N;AAClC,OAAI2N,EAAOE,eAAerX,GACjBmX,EAAOnX,GAEPkX,EAAS1N,E,EAPX0N,CAUX,CAEAE,cAAc5N,GACZ,MAAM8N,EAAQ,IAAEvX,KAAKkX,SAClBM,QAAQ3L,GAAY,KAANA,GAAYA,KAAKpC,IAC/BgO,OAAO5L,GAAMpC,EAAKoC,IAAM,IACrB6L,EAAIjO,EAAKzJ,KAAK4W,WAAanN,EAAK8N,IAAU,GAE1CH,EADapX,KAAKiX,YAAYO,QAAQG,GAAMA,EAAE3B,KAAOuB,IACjC3T,KAAK+T,GAAMA,EAAElO,KAAK2N,OAAOM;AACnD,OAAOnE,OAAOC,OAAO,CAAC,KAAM4D,EAC9B,CAEAlK,eAAeC,EAAUC,GACvB,MAAMwK,EAAoBxW,MAAMyS,KAAKzG,EAAIO,SAAS,cAC5C+I,EAAa,QAAMkB,GAAoBC,GAAOC,EAAS,IAAED,MACzDlB,EAAUvJ,EAAIsC,KAAK,MAAQ;AACjC,OAAO,IAAI+G,EAAUC,EAAYC,EACnC,EAGK,SAASmB,EAAS1K,GACvB,MAAM2K,EAAY,QAAM3W,MAAMyS,KAAKzG,EAAIO,SAAS,aAAcqK,GACxDC,EAAQ,CAAC;AACf,IAAK,MAAMC,KAAYH,EAAW,CAChC,MAAMI,GAAQD,EAASR,EACjBU,EAAOF,EAASE,MAAQ;AAC9B,GAAIC,MAAMF,GAAO,MAAM,IAAIjY,MAAM;AACjC,IAAK,MAAMwJ,KAAOwO,EAAU,CAC1B,GAAY,MAARxO,GAAuB,SAARA,EAAgB;AACnC,MAAM+E,GAASyJ,EAASxO,IACXuO,EAAMvO,KAASuO,EAAMvO,GAW/B,CAAEzJ,KAXqDyJ,EAW/CqO,UAAW,MAVjBA,UAAU3Q,KAAK,CAAE+Q,OAAM1J,QAAO2J,Q,EAGvC,MAAO,CACLpC,GAAI5I,EAAIsC,KAAK,OAAS,GACtBjG,KAAM,WAASwO,GAEnB,CAMO,SAASD,EAAOH,GACrB,OAAO,IAAEA,EAAGS,YACT1U,KAAK2U,GAAM,CAACA,EAAEtY,KAAKuY,cAAeD,EAAE9J,SACpCgK,YACAhK,OACL,CAEA,M","sources":["file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/expression/parser.pegjs","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/expression/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/context.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/lib/base.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/lib/instance.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/concerns/display-object.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/lib/utils.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/group.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/if.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/object.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/skin-root.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/sprite.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/text.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/compiler.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/resources.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/loader.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scintillator/nodes/concerns/animation.js"],"sourcesContent":["/*\n * Generated by PEG.js 0.10.0.\n *\n * http://pegjs.org/\n */\n\n\"use strict\";\n\nfunction peg$subclass(child, parent) {\n  function ctor() { this.constructor = child; }\n  ctor.prototype = parent.prototype;\n  child.prototype = new ctor();\n}\n\nfunction peg$SyntaxError(message, expected, found, location) {\n  this.message  = message;\n  this.expected = expected;\n  this.found    = found;\n  this.location = location;\n  this.name     = \"SyntaxError\";\n\n  if (typeof Error.captureStackTrace === \"function\") {\n    Error.captureStackTrace(this, peg$SyntaxError);\n  }\n}\n\npeg$subclass(peg$SyntaxError, Error);\n\npeg$SyntaxError.buildMessage = function(expected, found) {\n  var DESCRIBE_EXPECTATION_FNS = {\n        literal: function(expectation) {\n          return \"\\\"\" + literalEscape(expectation.text) + \"\\\"\";\n        },\n\n        \"class\": function(expectation) {\n          var escapedParts = \"\",\n              i;\n\n          for (i = 0; i < expectation.parts.length; i++) {\n            escapedParts += expectation.parts[i] instanceof Array\n              ? classEscape(expectation.parts[i][0]) + \"-\" + classEscape(expectation.parts[i][1])\n              : classEscape(expectation.parts[i]);\n          }\n\n          return \"[\" + (expectation.inverted ? \"^\" : \"\") + escapedParts + \"]\";\n        },\n\n        any: function(expectation) {\n          return \"any character\";\n        },\n\n        end: function(expectation) {\n          return \"end of input\";\n        },\n\n        other: function(expectation) {\n          return expectation.description;\n        }\n      };\n\n  function hex(ch) {\n    return ch.charCodeAt(0).toString(16).toUpperCase();\n  }\n\n  function literalEscape(s) {\n    return s\n      .replace(/\\\\/g, '\\\\\\\\')\n      .replace(/\"/g,  '\\\\\"')\n      .replace(/\\0/g, '\\\\0')\n      .replace(/\\t/g, '\\\\t')\n      .replace(/\\n/g, '\\\\n')\n      .replace(/\\r/g, '\\\\r')\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return '\\\\x0' + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return '\\\\x'  + hex(ch); });\n  }\n\n  function classEscape(s) {\n    return s\n      .replace(/\\\\/g, '\\\\\\\\')\n      .replace(/\\]/g, '\\\\]')\n      .replace(/\\^/g, '\\\\^')\n      .replace(/-/g,  '\\\\-')\n      .replace(/\\0/g, '\\\\0')\n      .replace(/\\t/g, '\\\\t')\n      .replace(/\\n/g, '\\\\n')\n      .replace(/\\r/g, '\\\\r')\n      .replace(/[\\x00-\\x0F]/g,          function(ch) { return '\\\\x0' + hex(ch); })\n      .replace(/[\\x10-\\x1F\\x7F-\\x9F]/g, function(ch) { return '\\\\x'  + hex(ch); });\n  }\n\n  function describeExpectation(expectation) {\n    return DESCRIBE_EXPECTATION_FNS[expectation.type](expectation);\n  }\n\n  function describeExpected(expected) {\n    var descriptions = new Array(expected.length),\n        i, j;\n\n    for (i = 0; i < expected.length; i++) {\n      descriptions[i] = describeExpectation(expected[i]);\n    }\n\n    descriptions.sort();\n\n    if (descriptions.length > 0) {\n      for (i = 1, j = 1; i < descriptions.length; i++) {\n        if (descriptions[i - 1] !== descriptions[i]) {\n          descriptions[j] = descriptions[i];\n          j++;\n        }\n      }\n      descriptions.length = j;\n    }\n\n    switch (descriptions.length) {\n      case 1:\n        return descriptions[0];\n\n      case 2:\n        return descriptions[0] + \" or \" + descriptions[1];\n\n      default:\n        return descriptions.slice(0, -1).join(\", \")\n          + \", or \"\n          + descriptions[descriptions.length - 1];\n    }\n  }\n\n  function describeFound(found) {\n    return found ? \"\\\"\" + literalEscape(found) + \"\\\"\" : \"end of input\";\n  }\n\n  return \"Expected \" + describeExpected(expected) + \" but \" + describeFound(found) + \" found.\";\n};\n\nfunction peg$parse(input, options) {\n  options = options !== void 0 ? options : {};\n\n  var peg$FAILED = {},\n\n      peg$startRuleFunctions = { expr: peg$parseexpr },\n      peg$startRuleFunction  = peg$parseexpr,\n\n      peg$c0 = \"||\",\n      peg$c1 = peg$literalExpectation(\"||\", false),\n      peg$c2 = function(first, rest) {\n            return combine(first, rest);\n          },\n      peg$c3 = \"&&\",\n      peg$c4 = peg$literalExpectation(\"&&\", false),\n      peg$c5 = \"+\",\n      peg$c6 = peg$literalExpectation(\"+\", false),\n      peg$c7 = \"-\",\n      peg$c8 = peg$literalExpectation(\"-\", false),\n      peg$c9 = \"*\",\n      peg$c10 = peg$literalExpectation(\"*\", false),\n      peg$c11 = \"/\",\n      peg$c12 = peg$literalExpectation(\"/\", false),\n      peg$c13 = \"%\",\n      peg$c14 = peg$literalExpectation(\"%\", false),\n      peg$c15 = \"(\",\n      peg$c16 = peg$literalExpectation(\"(\", false),\n      peg$c17 = \")\",\n      peg$c18 = peg$literalExpectation(\")\", false),\n      peg$c19 = function(expr) { return \"(\" + expr + \")\"; },\n      peg$c20 = \"!\",\n      peg$c21 = peg$literalExpectation(\"!\", false),\n      peg$c22 = function(val) { return \"!\" + val },\n      peg$c23 = peg$otherExpectation(\"number\"),\n      peg$c24 = function() { return text(); },\n      peg$c25 = /^[eE]/,\n      peg$c26 = peg$classExpectation([\"e\", \"E\"], false, false),\n      peg$c27 = /^[0-9]/,\n      peg$c28 = peg$classExpectation([[\"0\", \"9\"]], false, false),\n      peg$c29 = \".\",\n      peg$c30 = peg$literalExpectation(\".\", false),\n      peg$c31 = \"0\",\n      peg$c32 = peg$literalExpectation(\"0\", false),\n      peg$c33 = /^[1-9]/,\n      peg$c34 = peg$classExpectation([[\"1\", \"9\"]], false, false),\n      peg$c35 = /^[a-zA-Z]/,\n      peg$c36 = peg$classExpectation([[\"a\", \"z\"], [\"A\", \"Z\"]], false, false),\n      peg$c37 = /^[a-zA-Z0-9_]/,\n      peg$c38 = peg$classExpectation([[\"a\", \"z\"], [\"A\", \"Z\"], [\"0\", \"9\"], \"_\"], false, false),\n      peg$c39 = function() { return \"get(\" + JSON.stringify(text()) + \")\" },\n      peg$c40 = peg$otherExpectation(\"whitespace\"),\n      peg$c41 = /^[ \\t\\n\\r]/,\n      peg$c42 = peg$classExpectation([\" \", \"\\t\", \"\\n\", \"\\r\"], false, false),\n\n      peg$currPos          = 0,\n      peg$savedPos         = 0,\n      peg$posDetailsCache  = [{ line: 1, column: 1 }],\n      peg$maxFailPos       = 0,\n      peg$maxFailExpected  = [],\n      peg$silentFails      = 0,\n\n      peg$result;\n\n  if (\"startRule\" in options) {\n    if (!(options.startRule in peg$startRuleFunctions)) {\n      throw new Error(\"Can't start parsing from rule \\\"\" + options.startRule + \"\\\".\");\n    }\n\n    peg$startRuleFunction = peg$startRuleFunctions[options.startRule];\n  }\n\n  function text() {\n    return input.substring(peg$savedPos, peg$currPos);\n  }\n\n  function location() {\n    return peg$computeLocation(peg$savedPos, peg$currPos);\n  }\n\n  function expected(description, location) {\n    location = location !== void 0 ? location : peg$computeLocation(peg$savedPos, peg$currPos)\n\n    throw peg$buildStructuredError(\n      [peg$otherExpectation(description)],\n      input.substring(peg$savedPos, peg$currPos),\n      location\n    );\n  }\n\n  function error(message, location) {\n    location = location !== void 0 ? location : peg$computeLocation(peg$savedPos, peg$currPos)\n\n    throw peg$buildSimpleError(message, location);\n  }\n\n  function peg$literalExpectation(text, ignoreCase) {\n    return { type: \"literal\", text: text, ignoreCase: ignoreCase };\n  }\n\n  function peg$classExpectation(parts, inverted, ignoreCase) {\n    return { type: \"class\", parts: parts, inverted: inverted, ignoreCase: ignoreCase };\n  }\n\n  function peg$anyExpectation() {\n    return { type: \"any\" };\n  }\n\n  function peg$endExpectation() {\n    return { type: \"end\" };\n  }\n\n  function peg$otherExpectation(description) {\n    return { type: \"other\", description: description };\n  }\n\n  function peg$computePosDetails(pos) {\n    var details = peg$posDetailsCache[pos], p;\n\n    if (details) {\n      return details;\n    } else {\n      p = pos - 1;\n      while (!peg$posDetailsCache[p]) {\n        p--;\n      }\n\n      details = peg$posDetailsCache[p];\n      details = {\n        line:   details.line,\n        column: details.column\n      };\n\n      while (p < pos) {\n        if (input.charCodeAt(p) === 10) {\n          details.line++;\n          details.column = 1;\n        } else {\n          details.column++;\n        }\n\n        p++;\n      }\n\n      peg$posDetailsCache[pos] = details;\n      return details;\n    }\n  }\n\n  function peg$computeLocation(startPos, endPos) {\n    var startPosDetails = peg$computePosDetails(startPos),\n        endPosDetails   = peg$computePosDetails(endPos);\n\n    return {\n      start: {\n        offset: startPos,\n        line:   startPosDetails.line,\n        column: startPosDetails.column\n      },\n      end: {\n        offset: endPos,\n        line:   endPosDetails.line,\n        column: endPosDetails.column\n      }\n    };\n  }\n\n  function peg$fail(expected) {\n    if (peg$currPos < peg$maxFailPos) { return; }\n\n    if (peg$currPos > peg$maxFailPos) {\n      peg$maxFailPos = peg$currPos;\n      peg$maxFailExpected = [];\n    }\n\n    peg$maxFailExpected.push(expected);\n  }\n\n  function peg$buildSimpleError(message, location) {\n    return new peg$SyntaxError(message, null, null, location);\n  }\n\n  function peg$buildStructuredError(expected, found, location) {\n    return new peg$SyntaxError(\n      peg$SyntaxError.buildMessage(expected, found),\n      expected,\n      found,\n      location\n    );\n  }\n\n  function peg$parseexpr() {\n    var s0;\n\n    s0 = peg$parselogical_or();\n\n    return s0;\n  }\n\n  function peg$parselogical_or() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    s1 = peg$parselogical_and();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      s4 = peg$parse_();\n      if (s4 !== peg$FAILED) {\n        if (input.substr(peg$currPos, 2) === peg$c0) {\n          s5 = peg$c0;\n          peg$currPos += 2;\n        } else {\n          s5 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c1); }\n        }\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parse_();\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parselogical_and();\n            if (s7 !== peg$FAILED) {\n              s4 = [s4, s5, s6, s7];\n              s3 = s4;\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        s4 = peg$parse_();\n        if (s4 !== peg$FAILED) {\n          if (input.substr(peg$currPos, 2) === peg$c0) {\n            s5 = peg$c0;\n            peg$currPos += 2;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c1); }\n          }\n          if (s5 !== peg$FAILED) {\n            s6 = peg$parse_();\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parselogical_and();\n              if (s7 !== peg$FAILED) {\n                s4 = [s4, s5, s6, s7];\n                s3 = s4;\n              } else {\n                peg$currPos = s3;\n                s3 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c2(s1, s2);\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parselogical_and() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    s1 = peg$parseadd();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      s4 = peg$parse_();\n      if (s4 !== peg$FAILED) {\n        if (input.substr(peg$currPos, 2) === peg$c3) {\n          s5 = peg$c3;\n          peg$currPos += 2;\n        } else {\n          s5 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c4); }\n        }\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parse_();\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parseadd();\n            if (s7 !== peg$FAILED) {\n              s4 = [s4, s5, s6, s7];\n              s3 = s4;\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        s4 = peg$parse_();\n        if (s4 !== peg$FAILED) {\n          if (input.substr(peg$currPos, 2) === peg$c3) {\n            s5 = peg$c3;\n            peg$currPos += 2;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c4); }\n          }\n          if (s5 !== peg$FAILED) {\n            s6 = peg$parse_();\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parseadd();\n              if (s7 !== peg$FAILED) {\n                s4 = [s4, s5, s6, s7];\n                s3 = s4;\n              } else {\n                peg$currPos = s3;\n                s3 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c2(s1, s2);\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseadd() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    s1 = peg$parsemul();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      s4 = peg$parse_();\n      if (s4 !== peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 43) {\n          s5 = peg$c5;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c6); }\n        }\n        if (s5 === peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 45) {\n            s5 = peg$c7;\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c8); }\n          }\n        }\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parse_();\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parsemul();\n            if (s7 !== peg$FAILED) {\n              s4 = [s4, s5, s6, s7];\n              s3 = s4;\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        s4 = peg$parse_();\n        if (s4 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 43) {\n            s5 = peg$c5;\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c6); }\n          }\n          if (s5 === peg$FAILED) {\n            if (input.charCodeAt(peg$currPos) === 45) {\n              s5 = peg$c7;\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c8); }\n            }\n          }\n          if (s5 !== peg$FAILED) {\n            s6 = peg$parse_();\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parsemul();\n              if (s7 !== peg$FAILED) {\n                s4 = [s4, s5, s6, s7];\n                s3 = s4;\n              } else {\n                peg$currPos = s3;\n                s3 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c2(s1, s2);\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsemul() {\n    var s0, s1, s2, s3, s4, s5, s6, s7;\n\n    s0 = peg$currPos;\n    s1 = peg$parseval();\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      s3 = peg$currPos;\n      s4 = peg$parse_();\n      if (s4 !== peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 42) {\n          s5 = peg$c9;\n          peg$currPos++;\n        } else {\n          s5 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c10); }\n        }\n        if (s5 === peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 47) {\n            s5 = peg$c11;\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c12); }\n          }\n          if (s5 === peg$FAILED) {\n            if (input.charCodeAt(peg$currPos) === 37) {\n              s5 = peg$c13;\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c14); }\n            }\n          }\n        }\n        if (s5 !== peg$FAILED) {\n          s6 = peg$parse_();\n          if (s6 !== peg$FAILED) {\n            s7 = peg$parseval();\n            if (s7 !== peg$FAILED) {\n              s4 = [s4, s5, s6, s7];\n              s3 = s4;\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s3;\n        s3 = peg$FAILED;\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        s3 = peg$currPos;\n        s4 = peg$parse_();\n        if (s4 !== peg$FAILED) {\n          if (input.charCodeAt(peg$currPos) === 42) {\n            s5 = peg$c9;\n            peg$currPos++;\n          } else {\n            s5 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c10); }\n          }\n          if (s5 === peg$FAILED) {\n            if (input.charCodeAt(peg$currPos) === 47) {\n              s5 = peg$c11;\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c12); }\n            }\n            if (s5 === peg$FAILED) {\n              if (input.charCodeAt(peg$currPos) === 37) {\n                s5 = peg$c13;\n                peg$currPos++;\n              } else {\n                s5 = peg$FAILED;\n                if (peg$silentFails === 0) { peg$fail(peg$c14); }\n              }\n            }\n          }\n          if (s5 !== peg$FAILED) {\n            s6 = peg$parse_();\n            if (s6 !== peg$FAILED) {\n              s7 = peg$parseval();\n              if (s7 !== peg$FAILED) {\n                s4 = [s4, s5, s6, s7];\n                s3 = s4;\n              } else {\n                peg$currPos = s3;\n                s3 = peg$FAILED;\n              }\n            } else {\n              peg$currPos = s3;\n              s3 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s3;\n            s3 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s3;\n          s3 = peg$FAILED;\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c2(s1, s2);\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseval() {\n    var s0, s1, s2, s3, s4, s5;\n\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 40) {\n      s1 = peg$c15;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c16); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parse_();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parselogical_or();\n        if (s3 !== peg$FAILED) {\n          s4 = peg$parse_();\n          if (s4 !== peg$FAILED) {\n            if (input.charCodeAt(peg$currPos) === 41) {\n              s5 = peg$c17;\n              peg$currPos++;\n            } else {\n              s5 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c18); }\n            }\n            if (s5 !== peg$FAILED) {\n              peg$savedPos = s0;\n              s1 = peg$c19(s3);\n              s0 = s1;\n            } else {\n              peg$currPos = s0;\n              s0 = peg$FAILED;\n            }\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      if (input.charCodeAt(peg$currPos) === 33) {\n        s1 = peg$c20;\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c21); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = peg$parseval();\n        if (s2 !== peg$FAILED) {\n          peg$savedPos = s0;\n          s1 = peg$c22(s2);\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n      if (s0 === peg$FAILED) {\n        s0 = peg$parsenumber();\n        if (s0 === peg$FAILED) {\n          s0 = peg$parseidentifier();\n        }\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parsenumber() {\n    var s0, s1, s2, s3, s4;\n\n    peg$silentFails++;\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 45) {\n      s1 = peg$c7;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c8); }\n    }\n    if (s1 === peg$FAILED) {\n      s1 = null;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = peg$parseint();\n      if (s2 !== peg$FAILED) {\n        s3 = peg$parsefrac();\n        if (s3 === peg$FAILED) {\n          s3 = null;\n        }\n        if (s3 !== peg$FAILED) {\n          s4 = peg$parseexp();\n          if (s4 === peg$FAILED) {\n            s4 = null;\n          }\n          if (s4 !== peg$FAILED) {\n            peg$savedPos = s0;\n            s1 = peg$c24();\n            s0 = s1;\n          } else {\n            peg$currPos = s0;\n            s0 = peg$FAILED;\n          }\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c23); }\n    }\n\n    return s0;\n  }\n\n  function peg$parseexp() {\n    var s0, s1, s2, s3, s4;\n\n    s0 = peg$currPos;\n    if (peg$c25.test(input.charAt(peg$currPos))) {\n      s1 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c26); }\n    }\n    if (s1 !== peg$FAILED) {\n      if (input.charCodeAt(peg$currPos) === 45) {\n        s2 = peg$c7;\n        peg$currPos++;\n      } else {\n        s2 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c8); }\n      }\n      if (s2 === peg$FAILED) {\n        if (input.charCodeAt(peg$currPos) === 43) {\n          s2 = peg$c5;\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c6); }\n        }\n      }\n      if (s2 === peg$FAILED) {\n        s2 = null;\n      }\n      if (s2 !== peg$FAILED) {\n        s3 = [];\n        if (peg$c27.test(input.charAt(peg$currPos))) {\n          s4 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s4 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c28); }\n        }\n        if (s4 !== peg$FAILED) {\n          while (s4 !== peg$FAILED) {\n            s3.push(s4);\n            if (peg$c27.test(input.charAt(peg$currPos))) {\n              s4 = input.charAt(peg$currPos);\n              peg$currPos++;\n            } else {\n              s4 = peg$FAILED;\n              if (peg$silentFails === 0) { peg$fail(peg$c28); }\n            }\n          }\n        } else {\n          s3 = peg$FAILED;\n        }\n        if (s3 !== peg$FAILED) {\n          s1 = [s1, s2, s3];\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parsefrac() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    if (input.charCodeAt(peg$currPos) === 46) {\n      s1 = peg$c29;\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c30); }\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      if (peg$c27.test(input.charAt(peg$currPos))) {\n        s3 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c28); }\n      }\n      if (s3 !== peg$FAILED) {\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          if (peg$c27.test(input.charAt(peg$currPos))) {\n            s3 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c28); }\n          }\n        }\n      } else {\n        s2 = peg$FAILED;\n      }\n      if (s2 !== peg$FAILED) {\n        s1 = [s1, s2];\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parseint() {\n    var s0, s1, s2, s3;\n\n    if (input.charCodeAt(peg$currPos) === 48) {\n      s0 = peg$c31;\n      peg$currPos++;\n    } else {\n      s0 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c32); }\n    }\n    if (s0 === peg$FAILED) {\n      s0 = peg$currPos;\n      if (peg$c33.test(input.charAt(peg$currPos))) {\n        s1 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c34); }\n      }\n      if (s1 !== peg$FAILED) {\n        s2 = [];\n        if (peg$c27.test(input.charAt(peg$currPos))) {\n          s3 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c28); }\n        }\n        while (s3 !== peg$FAILED) {\n          s2.push(s3);\n          if (peg$c27.test(input.charAt(peg$currPos))) {\n            s3 = input.charAt(peg$currPos);\n            peg$currPos++;\n          } else {\n            s3 = peg$FAILED;\n            if (peg$silentFails === 0) { peg$fail(peg$c28); }\n          }\n        }\n        if (s2 !== peg$FAILED) {\n          s1 = [s1, s2];\n          s0 = s1;\n        } else {\n          peg$currPos = s0;\n          s0 = peg$FAILED;\n        }\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    }\n\n    return s0;\n  }\n\n  function peg$parseidentifier() {\n    var s0, s1, s2, s3;\n\n    s0 = peg$currPos;\n    s1 = [];\n    if (peg$c35.test(input.charAt(peg$currPos))) {\n      s2 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s2 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c36); }\n    }\n    if (s2 !== peg$FAILED) {\n      while (s2 !== peg$FAILED) {\n        s1.push(s2);\n        if (peg$c35.test(input.charAt(peg$currPos))) {\n          s2 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s2 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c36); }\n        }\n      }\n    } else {\n      s1 = peg$FAILED;\n    }\n    if (s1 !== peg$FAILED) {\n      s2 = [];\n      if (peg$c37.test(input.charAt(peg$currPos))) {\n        s3 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s3 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c38); }\n      }\n      while (s3 !== peg$FAILED) {\n        s2.push(s3);\n        if (peg$c37.test(input.charAt(peg$currPos))) {\n          s3 = input.charAt(peg$currPos);\n          peg$currPos++;\n        } else {\n          s3 = peg$FAILED;\n          if (peg$silentFails === 0) { peg$fail(peg$c38); }\n        }\n      }\n      if (s2 !== peg$FAILED) {\n        peg$savedPos = s0;\n        s1 = peg$c39();\n        s0 = s1;\n      } else {\n        peg$currPos = s0;\n        s0 = peg$FAILED;\n      }\n    } else {\n      peg$currPos = s0;\n      s0 = peg$FAILED;\n    }\n\n    return s0;\n  }\n\n  function peg$parse_() {\n    var s0, s1;\n\n    peg$silentFails++;\n    s0 = [];\n    if (peg$c41.test(input.charAt(peg$currPos))) {\n      s1 = input.charAt(peg$currPos);\n      peg$currPos++;\n    } else {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c42); }\n    }\n    while (s1 !== peg$FAILED) {\n      s0.push(s1);\n      if (peg$c41.test(input.charAt(peg$currPos))) {\n        s1 = input.charAt(peg$currPos);\n        peg$currPos++;\n      } else {\n        s1 = peg$FAILED;\n        if (peg$silentFails === 0) { peg$fail(peg$c42); }\n      }\n    }\n    peg$silentFails--;\n    if (s0 === peg$FAILED) {\n      s1 = peg$FAILED;\n      if (peg$silentFails === 0) { peg$fail(peg$c40); }\n    }\n\n    return s0;\n  }\n\n\n    function operate(item) {\n      var operator = item[1]\n      var operand = item[3]\n      return \" \" + operator + \" \" + operand\n    }\n    function combine(first, rest) {\n      return first + rest.map(operate).join('')\n    }\n\n\n  peg$result = peg$startRuleFunction();\n\n  if (peg$result !== peg$FAILED && peg$currPos === input.length) {\n    return peg$result;\n  } else {\n    if (peg$result !== peg$FAILED && peg$currPos < input.length) {\n      peg$fail(peg$endExpectation());\n    }\n\n    throw peg$buildStructuredError(\n      peg$maxFailExpected,\n      peg$maxFailPos < input.length ? input.charAt(peg$maxFailPos) : null,\n      peg$maxFailPos < input.length\n        ? peg$computeLocation(peg$maxFailPos, peg$maxFailPos + 1)\n        : peg$computeLocation(peg$maxFailPos, peg$maxFailPos)\n    );\n  }\n}\n\nmodule.exports = {\n  SyntaxError: peg$SyntaxError,\n  parse:       peg$parse\n};\n","import debug from 'debug'\n\nimport parser from './parser.pegjs'\n\nconst log = debug('scintillator:expression')\n\nfunction createFunction(code) {\n  const fn = eval('(function(get) { return ' + code + ' })') // eslint-disable-line no-eval\n  fn.displayName = '(' + code + ')'\n  fn.constant = !!/^[-0-9.]+$/.test(code)\n  return fn\n}\n\nexport function Expression(text) {\n  log('parsing %s', text)\n  const code = parser.parse(text)\n  log('parsed %s => %s', text, code)\n  const f = createFunction(code)\n  let evaluate\n  if (f.constant) {\n    evaluate = f\n  } else {\n    evaluate = function (data) {\n      return f(function (key) {\n        return data[key]\n      })\n    }\n  }\n  evaluate.constant = f.constant\n  return evaluate\n}\n\nexport default Expression\n","import * as PIXI from 'pixi.js'\n\nfunction createRenderer(w, h) {\n  hackPIXIToForceNewBlendModes()\n\n  // For now, we are using CanvasRenderer instead of WebGLRenderer or\n  // autoDetectRenderer befcause of two reasons.\n  // 1. Current implementation has some problem with rendering\n  //    sprite batches: https://github.com/pixijs/pixi.js/issues/1910\n  // 2. It seems that Canvas performs better on some browsers, i.e. Chrome.\n  //    WebGLRenderer only performs better on Firefox from the experiment.\n  return new PIXI.CanvasRenderer(w, h, { transparent: true })\n}\n\n// HACK: Sometimes, when using the canvas renderer,\n// the blend mode is not properly set.\nfunction hackPIXIToForceNewBlendModes() {\n  PIXI.utils.canUseNewCanvasBlendModes = () => true\n}\n\nexport class Context {\n  constructor(skin, { touchEventTarget } = {}) {\n    this.refs = {}\n    this._skin = skin\n    this._touchEventTarget = touchEventTarget\n    this._instance = skin.instantiate(this)\n    this._renderer = createRenderer(skin.width, skin.height)\n    this.stage = this._instance.object\n    this.view = this._renderer.view\n    this.skinData = skin.data\n    this._setupInteractivity()\n  }\n\n  render(data) {\n    this._instance.push(data)\n    this._renderer.render(this.stage)\n  }\n\n  destroy() {\n    this._instance.destroy()\n    this._instance = null\n    this._teardownInteractivity()\n  }\n\n  get input() {\n    return this._input.get()\n  }\n\n  ref(key, object) {\n    const set = this.refs[key] || (this.refs[key] = new Set())\n    set.add(object)\n  }\n\n  unref(key, object) {\n    const set = this.refs[key]\n    if (!set) return\n    set.delete(object)\n  }\n\n  _setupInteractivity() {\n    let mouse = null\n    let touches = []\n    const onMouse = (e) => {\n      mouse = e\n    }\n    const onUpdateMouse = (e) => {\n      mouse = mouse && e\n    }\n    const onNoMouse = () => {\n      mouse = null\n    }\n    const onTouch = (e) => {\n      touches = [].slice.call(e.touches)\n    }\n    const touchTarget = this._touchEventTarget || this.view\n    const width = this._skin.width\n    const height = this._skin.height\n    touchTarget.addEventListener('mousedown', onMouse, false)\n    touchTarget.addEventListener('mousemove', onUpdateMouse, false)\n    touchTarget.addEventListener('mouseup', onNoMouse, false)\n    touchTarget.addEventListener('touchstart', onTouch, false)\n    touchTarget.addEventListener('touchmove', onTouch, false)\n    touchTarget.addEventListener('touchend', onTouch, false)\n    this._teardownInteractivity = () => {\n      touchTarget.removeEventListener('mousedown', onMouse, false)\n      touchTarget.removeEventListener('mousemove', onUpdateMouse, false)\n      touchTarget.removeEventListener('mouseup', onNoMouse, false)\n      touchTarget.removeEventListener('touchstart', onTouch, false)\n      touchTarget.removeEventListener('touchmove', onTouch, false)\n      touchTarget.removeEventListener('touchend', onTouch, false)\n    }\n    this._input = {\n      get: () => {\n        const output = []\n        const rect = this.view.getBoundingClientRect()\n        if (mouse) {\n          output.push(point('mouse', mouse, rect))\n        }\n        for (let i = 0; i < touches.length; i++) {\n          const touch = touches[i]\n          output.push(point('touch' + touch.identifier, touch, rect))\n        }\n        return output\n      },\n    }\n    function point(id, p, rect) {\n      return {\n        x: ((p.clientX - rect.left) / rect.width) * width,\n        y: ((p.clientY - rect.top) / rect.height) * height,\n        id: id,\n      }\n    }\n  }\n}\n\nexport default Context\n","/**\n * A SkinNode is an internal representation of a Skin.\n *\n * Node.compile     :: (compiler, $xml) -> Node\n *\n * To implement:\n *\n * Node#compile     :: (compiler, $xml) -> undefined (side-effect)\n * Node#instantiate :: (instantiator)   -> PIXI.DisplayObject\n */\nexport class SkinNode {\n  static compile (compiler, $el) {\n    let node = new this()\n    node.compile(compiler, $el)\n    return node\n  }\n}\n\nexport default SkinNode\n","import Callbacks from 'bemuse/utils/callbacks'\n\nexport class Instance {\n  constructor (options) {\n    this._context = options.context\n    this._object = options.object\n    this._children = options.children\n    this._bindings = []\n    this._concerns = []\n    this.onData = new Callbacks(options.onData)\n    this.onDestroy = new Callbacks(options.onDestroy)\n    if (options.bindings) {\n      for (let binding of options.bindings) {\n        this.bind(...binding)\n      }\n    }\n    if (options.concerns) {\n      for (let concern of options.concerns) {\n        this._concerns.push(concern.instantiate(this._context, this))\n      }\n    }\n    if (options.children) {\n      for (let children of options.children) {\n        this._concerns.push(children.instantiate(this._context, this._object))\n      }\n    }\n    if (options.onCreate) {\n      new Callbacks(options.onCreate).call()\n    }\n    if (options.parent) {\n      this.attachTo(options.parent)\n    }\n  }\n  bind (...pipeline) {\n    let sideEffect = onChange(pipeline.pop())\n    if (pipeline.length === 1 && pipeline[0].constant) {\n      // optimize: don't add binding when expression is constant --\n      // just do it once\n      sideEffect(pipeline[0]())\n    } else {\n      this._bindings.push(value => {\n        for (var i = 0; i < pipeline.length; i++) {\n          value = pipeline[i](value)\n        }\n        sideEffect(value)\n      })\n    }\n  }\n  attachTo (parent) {\n    this._parent = parent\n    this._parent.addChild(this._object)\n  }\n  detach () {\n    if (this._parent) {\n      this._parent.removeChild(this._object)\n      this._parent = null\n    }\n  }\n  push (value) {\n    var i\n    for (i = 0; i < this._bindings.length; i++) {\n      this._bindings[i](value)\n    }\n    for (i = 0; i < this._concerns.length; i++) {\n      this._concerns[i].push(value)\n    }\n    this.onData.call(value)\n  }\n  destroy () {\n    this.detach()\n    for (var i = 0; i < this._concerns.length; i++) {\n      this._concerns[i].destroy()\n    }\n    this.onDestroy.call()\n    this._concerns = null\n    this._bindings = null\n    this._parent = null\n    this._object = null\n  }\n  get object () {\n    return this._object\n  }\n  get parent () {\n    return this._parent\n  }\n}\n\nfunction onChange (f) {\n  let value\n  return function receiveNewValue (v) {\n    if (value !== v) {\n      value = v\n      f(v)\n    }\n  }\n}\n\nexport default Instance\n","import * as PIXI from 'pixi.js'\n\nimport SkinNode from '../lib/base'\nimport Instance from '../lib/instance'\n\nimport Expression from '../../expression'\nimport Animation from './animation'\n\n// Numeric properties that may be interpreted as expressions.\nconst properties = [\n  { name: 'x', default: '0', apply: (obj, v) => (obj.x = v) },\n  { name: 'y', default: '0', apply: (obj, v) => (obj.y = v) },\n  { name: 'scale-x', default: '1', apply: (obj, v) => (obj.scale.x = v) },\n  { name: 'scale-y', default: '1', apply: (obj, v) => (obj.scale.y = v) },\n  { name: 'alpha', default: '1', apply: (obj, v) => (obj.alpha = v) },\n  { name: 'width', apply: (obj, v) => (obj.width = v) },\n  { name: 'height', apply: (obj, v) => (obj.height = v) },\n  { name: 'visible', apply: (obj, v) => (obj.visible = v) },\n]\n\nexport class DisplayObject extends SkinNode {\n  compile(compiler, $el) {\n    this._animation = Animation.compile(compiler, $el)\n    this._bindings = []\n    for (const property of properties) {\n      const code = $el.attr(property.name) || property.default\n      if (!code) continue\n      const expression = new Expression(code)\n      const getter = this._animation.prop(property.name, expression)\n      this._bindings.push({\n        getter: getter,\n        apply: property.apply,\n      })\n    }\n    this.blendMode = parseBlendMode($el.attr('blend') || 'normal')\n    this.ref = $el.attr('ref') || null\n  }\n\n  instantiate(context, subject) {\n    const object = subject.object\n    const bindings = []\n    let onDestroy = null\n    object.blendMode = this.blendMode\n    for (let i = 0; i < this._bindings.length; i++) {\n      const binding = this._bindings[i]\n      bindings.push([binding.getter, binding.apply.bind(null, object)])\n    }\n    if (this.ref) {\n      context.ref(this.ref, object)\n      onDestroy = () => context.unref(this.ref, object)\n    }\n    return new Instance({\n      bindings: bindings,\n      onDestroy: onDestroy,\n    })\n  }\n}\n\nfunction parseBlendMode(text) {\n  if (text === 'normal') return PIXI.BLEND_MODES.NORMAL\n  if (text === 'screen') return PIXI.BLEND_MODES.SCREEN\n  throw new Error('Invalid blend mode: ' + text)\n}\n\nexport default DisplayObject\n","import * as PIXI from 'pixi.js'\n\nexport function parseFrame (text) {\n  let m = text.match(/^(\\d+)x(\\d+)\\+(\\d+)\\+(\\d+)$/)\n  if (!m) return null\n  return new PIXI.Rectangle(+m[3], +m[4], +m[1], +m[2])\n}\n","import * as PIXI from 'pixi.js'\n\nimport SkinNode from './lib/base'\nimport Instance from './lib/instance'\n\nimport DisplayObject from './concerns/display-object'\nimport { parseFrame } from './lib/utils'\n\nexport class Mask {\n  constructor(frame) {\n    this._frame = frame\n  }\n\n  instantiate(context, subject) {\n    const mask = new PIXI.Graphics()\n    mask.beginFill()\n    mask.drawShape(this._frame)\n    mask.endFill()\n    subject.object.mask = mask\n    return new Instance({\n      context: context,\n      object: mask,\n      parent: subject.object,\n    })\n  }\n}\n\nexport class GroupNode extends SkinNode {\n  compile(compiler, $el) {\n    this.children = compiler.compileChildren($el)\n    this.display = DisplayObject.compile(compiler, $el)\n    const maskFrame = parseFrame($el.attr('mask') || '')\n    if (maskFrame) this.mask = new Mask(maskFrame)\n  }\n\n  instantiate(context, container) {\n    const object = new PIXI.Container()\n    const concerns = [this.display]\n    if (this.mask) {\n      concerns.push(this.mask)\n    }\n    return new Instance({\n      context: context,\n      object: object,\n      parent: container,\n      concerns: concerns,\n      children: this.children,\n    })\n  }\n}\n\nexport default GroupNode\n","import * as PIXI from 'pixi.js'\n\nimport SkinNode from './lib/base'\nimport Instance from './lib/instance'\nimport Expression from '../expression'\n\nexport class IfNode extends SkinNode {\n  compile(compiler, $el) {\n    const children = compiler.compileChildren($el)\n    if (children.length !== 1) {\n      throw new Error(\n        'Expected exactly 1 children, ' + children.length + ' found'\n      )\n    }\n    this.child = children[0]\n    this.key = new Expression($el.attr('key'))\n    this.value = String($el.attr('value'))\n  }\n\n  instantiate(context, container) {\n    const object = new PIXI.Container()\n    const expr = this.key\n    const value = this.value\n    const childNode = this.child\n    let child = null\n    return new Instance({\n      context: context,\n      parent: container,\n      object: object,\n      onData: (data) => {\n        if (String(expr(data)) === value) {\n          if (child === null) {\n            child = childNode.instantiate(context, object)\n          }\n          child.push(data)\n        } else {\n          if (child !== null) {\n            child.destroy()\n            child = null\n          }\n        }\n      },\n    })\n  }\n}\n\nexport default IfNode\n","import * as PIXI from 'pixi.js'\n\nimport Expression from '../expression'\nimport Instance from './lib/instance'\nimport SkinNode from './lib/base'\n\nfunction ChildManager(expr, child, poolSize) {\n  return {\n    instantiate(context, subject) {\n      const instances = new Map()\n      const pool = []\n      initPool()\n      return new Instance({\n        context: context,\n        onData: (data) => {\n          update(expr(data))\n        },\n      })\n      function initPool() {\n        let instance\n        for (let i = 0; i < poolSize; i++) {\n          instance = child.instantiate(context, subject.object)\n          instance.detach()\n          pool.push(instance)\n        }\n      }\n      function update(array) {\n        const unused = new Set(instances.keys())\n        let key\n        let item\n        let instance\n        if (!array) array = []\n        for (let i = 0; i < array.length; i++) {\n          item = array[i]\n          key = item.key\n          if (instances.has(key)) {\n            instance = instances.get(key)\n          } else {\n            instance = createInstance()\n            instances.set(key, instance)\n          }\n          instance.push(item)\n          unused.delete(key)\n        }\n        for (key of unused) {\n          instance = instances.get(key)\n          instance.detach()\n          instances.delete(key)\n          pool.push(instance)\n        }\n      }\n      function createInstance() {\n        let instance = pool.pop()\n        if (instance) {\n          instance.attachTo(subject.object)\n        } else {\n          instance = child.instantiate(context, subject.object)\n        }\n        return instance\n      }\n    },\n  }\n}\n\nexport class ObjectNode extends SkinNode {\n  compile(compiler, $el) {\n    this.children = compiler.compileChildren($el)\n    if (this.children.length !== 1) {\n      throw new Error(\n        'Expected exactly 1 children, ' + this.children.length + ' given'\n      )\n    }\n    this.pool = +$el.attr('pool') || 1\n    this.key = new Expression($el.attr('key'))\n  }\n\n  instantiate(context, container) {\n    const batch = new PIXI.particles.ParticleContainer(undefined, {\n      position: true,\n      alpha: true,\n    })\n    const manager = new ChildManager(this.key, this.children[0], this.pool)\n    return new Instance({\n      context: context,\n      parent: container,\n      object: batch,\n      concerns: [manager],\n    })\n  }\n}\n\nexport default ObjectNode\n","import * as PIXI from 'pixi.js'\n\nimport Instance from './lib/instance'\nimport SkinNode from './lib/base'\n\nexport class SkinRootNode extends SkinNode {\n  compile(compiler, $el) {\n    this.children = compiler.compileChildren($el)\n    this.width = +$el.attr('width')\n    this.height = +$el.attr('height')\n    this.data = $el.data()\n  }\n\n  instantiate(context) {\n    const stage = new PIXI.Stage(0x090807)\n    return new Instance({\n      context: context,\n      object: stage,\n      children: this.children,\n    })\n  }\n}\n\nexport default SkinRootNode\n","import * as PIXI from 'pixi.js'\n\nimport DisplayObject from './concerns/display-object'\nimport Instance from './lib/instance'\nimport SkinNode from './lib/base'\nimport { parseFrame } from './lib/utils'\n\nexport class SpriteNode extends SkinNode {\n  compile(compiler, $el) {\n    this.url = compiler.resources.get($el.attr('image'))\n    this.display = DisplayObject.compile(compiler, $el)\n    this.frame = parseFrame($el.attr('frame') || '')\n    this.anchorX = +$el.attr('anchor-x') || 0\n    this.anchorY = +$el.attr('anchor-y') || 0\n  }\n\n  instantiate(context, container) {\n    const sprite = new PIXI.Sprite(this.getTexture())\n    sprite.anchor.x = this.anchorX\n    sprite.anchor.y = this.anchorY\n    return new Instance({\n      context: context,\n      object: sprite,\n      parent: container,\n      concerns: [this.display],\n    })\n  }\n\n  getTexture() {\n    if (this._texture) return this._texture\n    const scaleMode = PIXI.SCALE_MODES.NEAREST\n    const base = PIXI.BaseTexture.fromImage(this.url, undefined, scaleMode)\n    const texture = new PIXI.Texture(base, this.frame)\n    this._texture = texture\n    return texture\n  }\n}\n\nexport default SpriteNode\n","import * as PIXI from 'pixi.js'\n\nimport SkinNode from './lib/base'\nimport Instance from './lib/instance'\nimport DisplayObject from './concerns/display-object'\nimport Expression from '../expression'\n\nexport class TextNode extends SkinNode {\n  compile(compiler, $el) {\n    this.font = $el.attr('font')\n    this.text = $el.attr('text')\n    this.data = new Expression($el.attr('data') || '0')\n    this.display = DisplayObject.compile(compiler, $el)\n    this.ttf = !$el.attr('font-src')\n    this.fill = $el.attr('fill')\n    this.align =\n      $el.attr('align') === 'left' ? 0 : $el.attr('align') === 'right' ? 1 : 0.5\n  }\n\n  instantiate(context, container) {\n    let text\n    if (this.ttf) {\n      text = new PIXI.Text(this.text, {\n        font: this.font,\n        fill: this.fill,\n      })\n    } else {\n      text = new PIXI.extras.BitmapText(this.text, { font: this.font })\n    }\n    const object = new PIXI.Container()\n    object.addChild(text)\n    return new Instance({\n      context: context,\n      parent: container,\n      object: object,\n      concerns: [this.display],\n      bindings: [\n        [\n          this.data,\n          (v) => {\n            text.text = this.text.replace('%s', v)\n            text.updateText()\n            text.x = text.width * -this.align\n          },\n        ],\n      ],\n    })\n  }\n}\n\nexport default TextNode\n","import $ from 'jquery'\nimport debug from 'debug'\n\nimport GroupNode from './nodes/group'\nimport IfNode from './nodes/if'\nimport ObjectNode from './nodes/object'\nimport SkinRootNode from './nodes/skin-root'\nimport SpriteNode from './nodes/sprite'\nimport TextNode from './nodes/text'\n\nconst log = debug('scintillator:compiler')\n\nconst NODES = {\n  skin: SkinRootNode,\n  sprite: SpriteNode,\n  group: GroupNode,\n  object: ObjectNode,\n  text: TextNode,\n  if: IfNode,\n}\n\n/**\n * A Compiler compiles the $xml theme file into SkinNode.\n */\nclass Compiler {\n  constructor(env) {\n    Object.assign(this, env)\n    this._defs = new Map()\n  }\n\n  compile($el) {\n    const nodeName = $el[0].nodeName\n    log('compiling', $el[0])\n    const Node = Compiler.getNodeClass(nodeName)\n    if (!Node) throw new Error('Invalid node name: ' + nodeName)\n    return Node.compile(this, $el)\n  }\n\n  compileChildren($el) {\n    const output = []\n    for (const child of Array.from($el.children())) {\n      const nodeName = child.nodeName\n      if (nodeName === 'defs') {\n        this.compileDefs($(child))\n      } else if (nodeName === 'use') {\n        output.push(this.getDef(child.getAttribute('def')))\n      } else {\n        const Node = Compiler.getNodeClass(nodeName)\n        if (Node) output.push(this.compile($(child)))\n      }\n    }\n    return output\n  }\n\n  compileDefs($el) {\n    for (const child of Array.from($el.children())) {\n      const id = child.getAttribute('id')\n      if (!id) throw new Error('A def should have an id: ' + child.nodeName)\n      this._defs.set(id, this.compile($(child)))\n    }\n  }\n\n  getDef(id) {\n    const node = this._defs.get(id)\n    if (!node) throw new Error('Cannot find def: ' + id)\n    return node\n  }\n\n  static getNodeClass(nodeName) {\n    return NODES[nodeName]\n  }\n}\n\nexport default Compiler\n","import _ from 'lodash'\n\n/**\n * The resources class contains a mapping from an image \"src\" to the resolved\n * image \"url.\"\n */\nexport class Resources {\n  constructor() {\n    this._map = {}\n  }\n\n  add(src, url) {\n    this._map[src] = url\n  }\n\n  get(src) {\n    if (!(src in this._map)) throw new Error('Not registered: ' + src)\n    return this._map[src]\n  }\n\n  get urls() {\n    return _.values(this._map)\n  }\n}\n\nexport default Resources\n","import * as PIXI from 'pixi.js'\nimport $ from 'jquery'\nimport debug from 'debug'\nimport { PERCENTAGE_FORMATTER } from 'bemuse/progress/formatters'\n\nimport Compiler from './compiler'\nimport Resources from './resources'\n\nconst log = debug('scintillator:loader')\n\nexport async function load(xmlPath, progress) {\n  log('load XML from %s', xmlPath)\n  const $xml = await loadXml(xmlPath)\n\n  // scan all images\n  const resources = new Resources()\n  const paths = new Set()\n  for (const element of Array.from($xml.find('[image]'))) {\n    paths.add($(element).attr('image'))\n  }\n  for (const element of Array.from($xml.find('[font-src]'))) {\n    paths.add($(element).attr('font-src'))\n  }\n  const base = new URL(xmlPath, 'file://')\n  for (const path of paths) {\n    const assetUrl = new URL(path, base)\n    if (assetUrl.protocol === 'file:') {\n      const { pathname, search, hash } = assetUrl\n      resources.add(path, pathname + search + hash)\n    } else {\n      resources.add(path, assetUrl.toString())\n    }\n  }\n\n  // load all images + progress reporting\n  await loadResources(resources, progress)\n\n  // compile the skin\n  log('compiling')\n  return new Compiler({ resources }).compile($xml)\n}\n\nfunction loadXml(xmlUrl) {\n  return fetch(xmlUrl)\n    .then((res) => res.text())\n    .then((text) =>\n      $(new DOMParser().parseFromString(text, 'text/xml').documentElement)\n    )\n}\n\nfunction loadResources(resources, progress) {\n  log('loading resources')\n  return new Promise(function (resolve) {\n    if (resources.urls.length === 0) return resolve()\n    const loader = new PIXI.loaders.Loader()\n    for (const url of resources.urls) {\n      loader.add(url, url)\n    }\n    loader.once('complete', function () {\n      log('resources finished loading')\n      resolve()\n    })\n    if (progress) {\n      progress.formatter = PERCENTAGE_FORMATTER\n      loader.once('complete', function () {\n        progress.report(100, 100)\n      })\n      loader.on('progress', function () {\n        progress.report(loader.progress, 100)\n      })\n    }\n    loader.load()\n  })\n}\n","import { Context } from './context'\nimport { load } from './loader'\n\nexport { load, Context }\n\nexport function getSkinUrl({ displayMode } = {}) {\n  if (displayMode === 'touch3d') {\n    return '/skins/default/skin_touch3d.xml'\n  } else {\n    if (window.innerWidth < window.innerHeight) {\n      return '/skins/default/skin_touch.xml'\n    } else {\n      return '/skins/default/skin_screen.xml'\n    }\n  }\n}\n","import _ from 'lodash'\nimport $ from 'jquery'\nimport keytime from 'keytime'\n\nconst createKeytime = (def) =>\n  Object.assign({}, def, { data: keytime(def.data) })\n\nexport class Animation {\n  constructor(animations, timeKey) {\n    this._timeKey = timeKey || 't'\n    this._properties = _(animations)\n      .map((animation) => _.map(animation.data, 'name'))\n      .flatten()\n      .thru((array) => new Set(array))\n      .value()\n    this._animations = _.map(animations, createKeytime)\n    this._events = _.uniq(_.map(animations, 'on'))\n  }\n\n  prop(name, fallback) {\n    if (!this._properties.has(name)) {\n      return fallback\n    }\n    return (data) => {\n      const values = this._getAnimation(data)\n      if (values.hasOwnProperty(name)) {\n        return values[name]\n      } else {\n        return fallback(data)\n      }\n    }\n  }\n\n  _getAnimation(data) {\n    const event = _(this._events)\n      .filter((e) => e === '' || e in data)\n      .maxBy((e) => data[e] || 0)\n    const t = data[this._timeKey] - (data[event] || 0)\n    const animations = this._animations.filter((a) => a.on === event)\n    const values = animations.map((a) => a.data.values(t))\n    return Object.assign({}, ...values)\n  }\n\n  static compile(compiler, $el) {\n    const animationElements = Array.from($el.children('animation'))\n    const animations = _.map(animationElements, (el) => _compile($(el)))\n    const timeKey = $el.attr('t') || 't'\n    return new Animation(animations, timeKey)\n  }\n}\n\nexport function _compile($el) {\n  const keyframes = _.map(Array.from($el.children('keyframe')), _attrs)\n  const attrs = {}\n  for (const keyframe of keyframes) {\n    const time = +keyframe.t\n    const ease = keyframe.ease || 'linear'\n    if (isNaN(time)) throw new Error('Expected keyframe to have \"t\" attribute')\n    for (const key in keyframe) {\n      if (key === 't' || key === 'ease') continue\n      const value = +keyframe[key]\n      const attr = attrs[key] || (attrs[key] = _createKeyframes(key))\n      attr.keyframes.push({ time, value, ease })\n    }\n  }\n  return {\n    on: $el.attr('on') || '',\n    data: _.values(attrs),\n  }\n}\n\nfunction _createKeyframes(name) {\n  return { name, keyframes: [] }\n}\n\nexport function _attrs(el) {\n  return _(el.attributes)\n    .map((n) => [n.name.toLowerCase(), n.value])\n    .fromPairs()\n    .value()\n}\n\nexport default Animation\n"],"names":["peg$SyntaxError","message","expected","found","location","this","name","Error","captureStackTrace","child","parent","ctor","constructor","prototype","peg$subclass","buildMessage","DESCRIBE_EXPECTATION_FNS","literal","expectation","literalEscape","text","i","escapedParts","parts","length","Array","classEscape","inverted","any","end","other","description","hex","ch","charCodeAt","toString","toUpperCase","s","replace","j","descriptions","type","sort","slice","join","describeExpected","describeFound","module","exports","SyntaxError","parse","input","options","peg$result","peg$FAILED","peg$startRuleFunctions","expr","peg$parseexpr","peg$startRuleFunction","peg$c0","peg$c1","peg$literalExpectation","peg$c2","first","rest","map","operate","combine","peg$c3","peg$c4","peg$c5","peg$c6","peg$c7","peg$c8","peg$c10","peg$c12","peg$c14","peg$c16","peg$c18","peg$c21","peg$c23","peg$otherExpectation","peg$c25","peg$c26","peg$classExpectation","peg$c27","peg$c28","peg$c30","peg$c32","peg$c33","peg$c34","peg$c35","peg$c36","peg$c37","peg$c38","peg$c40","peg$c41","peg$c42","peg$currPos","peg$savedPos","peg$posDetailsCache","line","column","peg$maxFailPos","peg$maxFailExpected","peg$silentFails","startRule","substring","ignoreCase","peg$computePosDetails","pos","p","details","peg$computeLocation","startPos","endPos","startPosDetails","endPosDetails","start","offset","peg$fail","push","peg$buildStructuredError","peg$parselogical_or","s0","s1","s2","s3","s4","s5","s6","s7","peg$parselogical_and","peg$parse_","substr","peg$parseadd","peg$parsemul","peg$parseval","test","charAt","peg$parseint","peg$parsefrac","peg$parseexp","peg$parsenumber","JSON","stringify","peg$parseidentifier","item","log","createFunction","code","fn","eval","displayName","constant","Expression","f","evaluate","data","key","createRenderer","w","h","transparent","Context","skin","touchEventTarget","refs","_skin","_touchEventTarget","_instance","instantiate","_renderer","width","height","stage","object","view","skinData","_setupInteractivity","render","destroy","_teardownInteractivity","_input","get","ref","Set","add","unref","set","delete","mouse","touches","onMouse","e","onUpdateMouse","onNoMouse","onTouch","call","touchTarget","point","id","rect","x","clientX","left","y","clientY","top","addEventListener","removeEventListener","output","getBoundingClientRect","touch","identifier","static","compiler","$el","node","compile","_context","context","_object","_children","children","_bindings","_concerns","onData","onDestroy","bindings","binding","bind","concerns","concern","onCreate","attachTo","pipeline","sideEffect","value","v","onChange","pop","_parent","addChild","detach","removeChild","properties","default","apply","obj","scale","alpha","visible","_animation","property","attr","expression","getter","prop","blendMode","parseBlendMode","subject","parseFrame","m","match","Mask","frame","_frame","mask","beginFill","drawShape","endFill","compileChildren","display","maskFrame","container","String","childNode","ChildManager","poolSize","instances","Map","pool","instance","initPool","array","unused","keys","has","createInstance","update","batch","undefined","position","manager","url","resources","anchorX","anchorY","sprite","getTexture","anchor","_texture","scaleMode","base","texture","font","ttf","fill","align","updateText","NODES","group","if","Compiler","env","Object","assign","_defs","nodeName","Node","getNodeClass","from","compileDefs","getDef","getAttribute","_map","src","urls","async","load","xmlPath","progress","$xml","xmlUrl","fetch","then","res","DOMParser","parseFromString","documentElement","paths","element","find","URL","path","assetUrl","protocol","pathname","search","hash","Promise","resolve","loader","once","formatter","report","on","loadResources","getSkinUrl","displayMode","window","innerWidth","innerHeight","createKeytime","def","Animation","animations","timeKey","_timeKey","_properties","animation","flatten","thru","_animations","_events","fallback","values","_getAnimation","hasOwnProperty","event","filter","maxBy","t","a","animationElements","el","_compile","keyframes","_attrs","attrs","keyframe","time","ease","isNaN","attributes","n","toLowerCase","fromPairs"],"sourceRoot":""}