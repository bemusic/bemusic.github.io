{"version":3,"file":"build/269-301969deb71b82508a47.js","mappings":"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","sources":["file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/entities/Collections.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/entities/LoadState.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/entities/MusicSearchText.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/entities/MusicSelection.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/entities/Options.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/interactors/findMatchingSong.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/query-flags.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/music-collection/filterSongs.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/redux/ReduxState.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/redux/collectionFetchMiddleware.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/redux/collectionLoader.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/redux/optionsStorageMiddleware.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/app/redux/configureStore.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/BemuseTestMode.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss?[contenthash]","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/benchmark.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/query-flags.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/Gauge.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/note-area.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/player-display.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/touch3d.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/control.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/judgments.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/player.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/player-state.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/player-stats.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/logger/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/music-collection/getPlayableCharts.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/music-collection/SongOfTheDay.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/music-collection/groupSongsIntoCategories.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/music-collection/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/music-collection/isChartPlayable.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/music-collection/preprocessCollection.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/music-collection/sortSongs.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/axis-logic.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/midi.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/Progress.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/formatters.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/utils.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/addUnprefixed.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/resource-logging.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/unarchiver.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/custom-song-resources.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/url.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/callbacks.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/download.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/formatTime.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/now.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/observable.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/read-blob.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/index.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/BMSNotechartLoader.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/types.js"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".BenchmarkPanel {\\n  background: #449;\\n  border: 2px solid #66e;\\n  padding: 4px;\\n}\\n.BenchmarkPanel table {\\n  font-size: 10px;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./devtools/ui/BenchmarkPanel.scss\"],\"names\":[],\"mappings\":\"AAEA;EACE,gBAAA;EACA,sBAAA;EACA,YAAA;AADF;AAEE;EACE,eAAA;AAAJ\",\"sourcesContent\":[\"@import '~bemuse/ui/common';\\n\\n.BenchmarkPanel {\\n  background: #449;\\n  border: 2px solid #66e;\\n  padding: 4px;\\n  table {\\n    font-size: 10px;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","import {\n  LoadState,\n  completeWithValue,\n  errorWithReason,\n  initLoading,\n} from './LoadState'\nimport produce, { enableMapSet } from 'immer'\n\nenableMapSet()\n\nexport type CollectionsState<V> = Map<string, LoadState<V>>\n\nexport const initialState = new Map<string, LoadState<unknown>>()\n\nexport const beginLoading = <V>(url: string) =>\n  produce((state: CollectionsState<V>) => state.set(url, initLoading()))\n\nexport const completeLoading = <V>(url: string, data: V) =>\n  produce((state: CollectionsState<V>) =>\n    state.set(url, completeWithValue(data)())\n  )\n\nexport const errorLoading = <V>(url: string, error: Error) =>\n  produce((state: CollectionsState<V>) =>\n    state.set(url, errorWithReason(error)())\n  )\n\nexport const getCollectionByUrl =\n  <V>(url: string) =>\n  (state: CollectionsState<V>) =>\n    state.get(url)\n","// An entity that represents something that can have a loading state.\n\nexport type Loading = {\n  status: 'loading'\n}\n\nexport type LoadError = {\n  status: 'error'\n  error: Error\n}\n\nexport type Completed<V> = {\n  status: 'completed'\n  value: V\n}\n\nexport type LoadState<V> = Loading | LoadError | Completed<V>\n\nexport const initLoading = <V>(): LoadState<V> => ({ status: 'loading' })\nexport const initCompletedWithValue = <V>(value: V): LoadState<V> => ({\n  status: 'completed',\n  value,\n})\n\n// Queries\nexport const isLoading = <V>(state: LoadState<V>): state is Loading =>\n  state.status === 'loading'\nexport const isCompleted = <V>(state: LoadState<V>): state is Completed<V> =>\n  state.status === 'completed'\nexport const isError = <V>(state: LoadState<V>): state is LoadError =>\n  state.status === 'error'\nexport const value = <V>(state: LoadState<V>) =>\n  isCompleted(state) && state.value\nexport const error = <V>(state: LoadState<V>) => isError(state) && state.error\n\n// State Updaters\nexport const beginLoading =\n  <V>() =>\n  () =>\n    initLoading<V>()\n\nexport const completeWithValue =\n  <V>(value: V) =>\n  (): Completed<V> => ({\n    status: 'completed',\n    value: value,\n  })\n\nexport const errorWithReason = (error: Error) => (): LoadError => ({\n  status: 'error',\n  error: error,\n})\n","import { PayloadAction, createSlice } from '@reduxjs/toolkit'\nimport produce, { Draft } from 'immer'\n\nexport interface MusicSearchTextState {\n  staged: string\n  committed: string\n}\n\n// Initializer\nexport const initWithText = (text: string): MusicSearchTextState => ({\n  staged: text,\n  committed: text,\n})\n\n// Default initial state\nexport const initialState = initWithText('')\n\n// Queries\nexport const searchText = (state: MusicSearchTextState) => state.committed\nexport const inputText = (state: MusicSearchTextState) => state.staged\n\n// Updaters\nexport const handleTextType = (text: string) =>\n  produce((draft: Draft<MusicSearchTextState>) => {\n    draft.staged = text\n  })\nexport const handleDebounce = (state: MusicSearchTextState) => ({\n  ...state,\n  committed: state.staged,\n})\nexport const setText = (text: string) => () => initWithText(text)\n\nexport const musicSearchTextSlice = createSlice({\n  name: 'musicSearchText',\n  initialState,\n  reducers: {\n    MUSIC_SEARCH_TEXT_TYPED: (\n      state,\n      { payload: { text } }: PayloadAction<{ text: string }>\n    ) => handleTextType(text)(state),\n    MUSIC_SEARCH_DEBOUNCED: (state) => handleDebounce(state),\n    MUSIC_SEARCH_TEXT_INITIALIZED: (\n      _state,\n      { payload: { text } }: PayloadAction<{ text: string }>\n    ) => setText(text)(),\n  },\n})\n","import type { Chart, SongMetadataInCollection } from 'bemuse-types'\nimport { PayloadAction, createSlice } from '@reduxjs/toolkit'\nimport produce, { Draft } from 'immer'\n\nimport _ from 'lodash'\n\nexport interface MusicSelectionState {\n  selectedSongId: string | null\n  selectedChartId: string | null\n  selectedChartLevel: number\n}\n\nexport const initialState: MusicSelectionState = {\n  selectedSongId: null,\n  selectedChartId: null,\n  selectedChartLevel: 1,\n}\n\n// Queries\nexport const selectedSongGivenSongs =\n  (songs: SongMetadataInCollection[]) =>\n  (state: MusicSelectionState): SongMetadataInCollection => {\n    const song = _.find(songs, (item) => item.id === state.selectedSongId)\n    if (song) return song\n    return songs[0]\n  }\nexport const selectedChartGivenCharts =\n  (charts: Chart[] = []) =>\n  (state: MusicSelectionState): Chart => {\n    // Workaround by https://github.com/DefinitelyTyped/DefinitelyTyped/issues/25758#issuecomment-580690247\n    const chart = _.find(charts, { file: state.selectedChartId as any })\n    if (chart) return chart\n    return _.minBy(charts, (chart) =>\n      Math.abs(getChartLevel(chart) - state.selectedChartLevel)\n    )!\n  }\n\n// Updater\nexport const selectSong = (songId: string) =>\n  produce((draft: Draft<MusicSelectionState>) => {\n    draft.selectedSongId = songId\n  })\nexport const selectChart = (\n  songId: string,\n  chartId: string,\n  chartLevel: number\n) =>\n  produce((draft: Draft<MusicSelectionState>) => {\n    draft.selectedSongId = songId\n    draft.selectedChartId = chartId\n    draft.selectedChartLevel = chartLevel\n  })\n\nexport interface PartialChart {\n  info: {\n    difficulty: number\n    level: number\n  }\n}\n\n// Utilities\nexport function getChartLevel(chart: PartialChart): number {\n  return chart.info.level + (chart.info.difficulty === 5 ? 1000 : 0)\n}\n\nexport const musicSelectionSlice = createSlice({\n  name: 'musicSelection',\n  initialState,\n  reducers: {\n    CUSTOM_SONG_LOADED: (\n      state,\n      { payload: { song } }: PayloadAction<{ song: SongMetadataInCollection }>\n    ) => selectSong(song.id)(state),\n    MUSIC_SONG_SELECTED: (\n      state,\n      { payload: { songId } }: PayloadAction<{ songId: string }>\n    ) => selectSong(songId)(state),\n    MUSIC_CHART_SELECTED: (\n      state,\n      {\n        payload: { songId, chartId, chartLevel },\n      }: PayloadAction<{ songId: string; chartId: string; chartLevel: number }>\n    ) => selectChart(songId, chartId, chartLevel)(state),\n  },\n})\n","import { PayloadAction, createSlice } from '@reduxjs/toolkit'\n\nimport { Draft } from 'immer'\nimport { MappingMode } from '../../rules/mapping-mode'\nimport { StoredOptions } from '../types'\n\nexport type OptionsState = StoredOptions & Record<string, string>\n\n// Initializers\nexport const initialState: OptionsState = {\n  // Game mode (KB, BM)\n  'player.P1.mode': 'KB',\n\n  // Keyboard mapping\n  'input.P1.keyboard.BM.SC': '16',\n  'input.P1.keyboard.BM.SC2': '65',\n  'input.P1.keyboard.BM.1': '90',\n  'input.P1.keyboard.BM.2': '83',\n  'input.P1.keyboard.BM.3': '88',\n  'input.P1.keyboard.BM.4': '68',\n  'input.P1.keyboard.BM.5': '67',\n  'input.P1.keyboard.BM.6': '70',\n  'input.P1.keyboard.BM.7': '86',\n\n  'input.P1.keyboard.KB.1': '83',\n  'input.P1.keyboard.KB.2': '68',\n  'input.P1.keyboard.KB.3': '70',\n  'input.P1.keyboard.KB.4': '32',\n  'input.P1.keyboard.KB.5': '74',\n  'input.P1.keyboard.KB.6': '75',\n  'input.P1.keyboard.KB.7': '76',\n\n  // Note speed\n  'player.P1.speed': '1.0',\n  'player.P1.lane-cover': '0',\n  'player.P1.lead-time': '1685',\n  'player.P1.auto-velocity': '0',\n\n  // Scratch placement (left, right, off)\n  'player.P1.scratch': 'left',\n\n  // Panel placement (left, center, right)\n  'player.P1.panel': 'center',\n\n  // Gauge type (off, hope)\n  'player.P1.gauge': 'off',\n\n  // Gamepad settings\n  'gamepad.continuous': '0',\n  'gamepad.sensitivity': '4',\n\n  // Offsets\n  'system.offset.audio-input': '0',\n  'system.offset.audio-visual': '0',\n\n  // BGA\n  'system.bga.enabled': '1',\n  'system.preview.enabled': '1',\n\n  // Version\n  'system.last-seen-version': '0.0.0',\n\n  // Acknowledgements (guide texts)\n  'system.ack.twitter': '0',\n  'system.ack.deltas': '0',\n  'system.ack.finishGame': '0',\n  'system.ack.replayGame': '0',\n}\nexport const initWithDataFromStorage = (options: Record<string, string>) => {\n  if (options['player.P1.scratch'] === 'off') {\n    options['player.P1.scratch'] = 'left'\n  }\n  return {\n    ...initialState,\n    ...options,\n  }\n}\n\n// Internal utils\nconst toggleOptionEnabled = (value: string) => value === '1'\nconst toggleOption = (value: string) => (toggleOptionEnabled(value) ? '0' : '1')\n\nexport const getKeyMapping =\n  (mode: MappingMode, key: string) =>\n  (state: OptionsState): MappingMode =>\n    state['input.P1.keyboard.' + mode + '.' + key] as MappingMode\n\n// Play mode\nexport const playMode = (state: OptionsState): MappingMode =>\n  state['player.P1.mode'] as MappingMode\nconst _changePlayMode = (state: Draft<OptionsState>, mode: MappingMode) => {\n  state['player.P1.mode'] = mode\n  state['player.P1.panel'] =\n    state['player.P1.panel'] === '3d' && mode !== 'KB'\n      ? 'center'\n      : state['player.P1.panel']\n}\n\n// Speed\nexport const speed = (state: OptionsState) => state['player.P1.speed']\n\n// Lead time\nexport const leadTime = (state: OptionsState) => {\n  const parsed = parseInt(state['player.P1.lead-time'], 10)\n  if (!parsed) return 1685\n  if (parsed < 138) return 138\n  return parsed\n}\n\n// Scratch position\nexport const SCRATCH_POSITION = ['off', 'left', 'right'] as const\nexport type ScratchPosition = typeof SCRATCH_POSITION[number]\nexport const isScratchPosition = (str: string): str is ScratchPosition =>\n  (SCRATCH_POSITION as readonly string[]).includes(str)\nexport const scratchPosition = (state: OptionsState): ScratchPosition => {\n  if (state['player.P1.mode'] === 'KB') {\n    return 'off'\n  } else {\n    return state['player.P1.scratch'] as ScratchPosition\n  }\n}\n\n// Panel\nexport type PanelPlacement = 'left' | 'center' | 'right' | '3d'\nexport const panelPlacement = (state: OptionsState) => state['player.P1.panel']\n\n// Lane cover\nexport const laneCover = (state: OptionsState) => {\n  return (\n    Math.min(\n      50,\n      Math.max(-50, Math.round(+state['player.P1.lane-cover'] * 100))\n    ) / 100 || 0\n  )\n}\n\n// BGA\nexport const isBackgroundAnimationsEnabled = (state: OptionsState) =>\n  toggleOptionEnabled(state['system.bga.enabled'])\n\n// Auto-velocity\nexport const isAutoVelocityEnabled = (state: OptionsState) =>\n  toggleOptionEnabled(state['player.P1.auto-velocity'])\n\n// Song preview enabled\nexport const isPreviewEnabled = (state: OptionsState) =>\n  toggleOptionEnabled(state['system.preview.enabled'])\n\n// Gauge\nexport type Gauge = 'off' | 'hope'\nexport const isGaugeEnabled = (state: OptionsState) => getGauge(state) !== 'off'\nexport const getGauge = (state: OptionsState): Gauge =>\n  state['player.P1.gauge'] as Gauge\n\n// Queries\nexport const keyboardMapping = (state: OptionsState) => {\n  const mapping: Record<string, string> = {}\n  for (const control of ['1', '2', '3', '4', '5', '6', '7', 'SC', 'SC2']) {\n    const key = 'input.P1.keyboard.' + playMode(state) + '.' + control\n    mapping[control] = state[key] || ''\n  }\n  return mapping\n}\n\n// Feature acknowledgements\nexport const hasAcknowledged = (featureKey: string) => (state: OptionsState) =>\n  state[`system.ack.${featureKey}`] === '1'\n\n// Audio-input latency\nexport const audioInputLatency = (state: OptionsState) =>\n  +state['system.offset.audio-input']\n\n// Gamepad Continuous Axis\nexport const isContinuousAxisEnabled = (state: OptionsState) =>\n  toggleOptionEnabled(state['gamepad.continuous'])\n\n// Gamepad Sensitivity\nexport const sensitivity = (state: OptionsState): number =>\n  parseInt(state['gamepad.sensitivity'], 10)\n\n// Latest version\nexport const lastSeenVersion = (state: OptionsState) =>\n  state['system.last-seen-version']\n\n// Utils\nexport const nextKeyToEdit = (editing: string, scratch: ScratchPosition) => {\n  const keySet = (() => {\n    if (scratch === 'left') {\n      return ['SC', 'SC2', '1', '2', '3', '4', '5', '6', '7']\n    } else if (scratch === 'right') {\n      return ['1', '2', '3', '4', '5', '6', '7', 'SC', 'SC2']\n    } else {\n      return ['1', '2', '3', '4', '5', '6', '7']\n    }\n  })()\n  const index = keySet.indexOf(editing)\n  if (index < 0) return null\n  return keySet[index + 1] || null\n}\n\n// Slice\nexport const optionsSlice = createSlice({\n  name: 'options',\n  initialState: initialState,\n  reducers: {\n    LOAD_FROM_STORAGE: () => {},\n    LOADED_FROM_STORAGE: (\n      _state,\n      {\n        payload: { options },\n      }: PayloadAction<{ options: Record<string, string> }>\n    ) => initWithDataFromStorage(options),\n    INIT_WITH_DATA_FROM_STORAGE: (\n      _state,\n      {\n        payload: { options },\n      }: PayloadAction<{ options: Record<string, string> }>\n    ) => ({\n      ...initialState,\n      ...options,\n    }),\n    CHANGE_KEY_MAPPING: (\n      state,\n      {\n        payload: { mode, key, keyCode },\n      }: PayloadAction<{\n        mode: MappingMode\n        key: string\n        keyCode: string\n      }>\n    ) => {\n      state['input.P1.keyboard.' + mode + '.' + key] = keyCode\n    },\n    CHANGE_PLAY_MODE: (\n      state,\n      { payload: { mode } }: PayloadAction<{ mode: MappingMode }>\n    ) => {\n      _changePlayMode(state, mode)\n    },\n    CHANGE_SPEED: (\n      state,\n      { payload: { speed } }: PayloadAction<{ speed: string }>\n    ) => {\n      state['player.P1.speed'] = speed\n    },\n    CHANGE_LEAD_TIME: (\n      state,\n      { payload: { leadTime } }: PayloadAction<{ leadTime: number }>\n    ) => {\n      state['player.P1.lead-time'] = leadTime.toString()\n    },\n    CHANGE_SCRATCH_POSITION: (\n      state,\n      { payload: { position } }: PayloadAction<{ position: ScratchPosition }>\n    ) => {\n      if (position === 'off') {\n        _changePlayMode(state, 'KB')\n        return\n      }\n      _changePlayMode(state, 'BM')\n      state['player.P1.scratch'] = position\n    },\n    CHANGE_PANEL_PLACEMENT: (\n      state,\n      { payload: { placement } }: PayloadAction<{ placement: PanelPlacement }>\n    ) => {\n      state['player.P1.panel'] = placement\n      state['player.P1.mode'] =\n        placement === '3d' && state['player.P1.mode'] !== 'KB'\n          ? 'KB'\n          : state['player.P1.mode']\n    },\n    CHANGE_LANE_COVER: (\n      state,\n      { payload: { laneCover } }: PayloadAction<{ laneCover: number }>\n    ) => {\n      state['player.P1.lane-cover'] = `${laneCover}`\n    },\n    TOGGLE_BACKGROUND_ANIMATIONS: (state) => {\n      state['system.bga.enabled'] = toggleOption(state['system.bga.enabled'])\n    },\n    TOGGLE_AUTO_VELOCITY: (state) => {\n      state['player.P1.auto-velocity'] = toggleOption(\n        state['player.P1.auto-velocity']\n      )\n    },\n    TOGGLE_PREVIEW: (state) => {\n      state['system.preview.enabled'] = toggleOption(\n        state['system.preview.enabled']\n      )\n    },\n    TOGGLE_GAUGE: (state) => {\n      state['player.P1.gauge'] =\n        state['player.P1.gauge'] === 'off' ? 'hope' : 'off'\n    },\n    ACKNOWLEDGE: (\n      state,\n      { payload: { featureKey } }: PayloadAction<{ featureKey: string }>\n    ) => {\n      state[`system.ack.${featureKey}`] = '1'\n    },\n    CHANGE_AUDIO_INPUT_LATENCY: (\n      state,\n      { payload: { latency } }: PayloadAction<{ latency: number }>\n    ) => {\n      state['system.offset.audio-input'] = `${latency}`\n    },\n    TOGGLE_CONTINUOUS_AXIS: (state) => {\n      state['gamepad.continuous'] = toggleOption(state['gamepad.continuous'])\n    },\n    CHANGE_SENSITIVITY: (\n      state,\n      { payload: { sensitivity } }: PayloadAction<{ sensitivity: number }>\n    ) => {\n      state['gamepad.sensitivity'] = sensitivity.toString()\n    },\n    UPDATE_LAST_SEEN_VERSION: (\n      state,\n      { payload: { newVersion } }: PayloadAction<{ newVersion: string }>\n    ) => {\n      state['system.last-seen-version'] = newVersion\n    },\n  },\n})\n","// Finds a song matching the title\n\nfunction findMatchingSong({ songs, title, getTitle }) {\n  for (const song of songs) {\n    if (titleFullyMatches(getTitle(song), title)) {\n      return song\n    }\n  }\n}\n\nfunction titleFullyMatches(haystack, needle) {\n  return (\n    String(haystack).toLowerCase().trim() ===\n    String(needle).toLowerCase().trim()\n  )\n}\n\nexport default findMatchingSong\n","import query from 'bemuse/utils/query'\n\n/**\n * The `?server` flag specifies a URL to a Bemuse custom music server.\n *\n * @see https://bemuse.ninja/project/docs/music-server.html\n */\nexport function getMusicServer() {\n  return query.BEMUSE_MUSIC_SERVER || query.server\n}\n\n/**\n * The `?volume` flag specifies the sound volume.\n *\n * @see https://bemuse.ninja/project/docs/music-server.html\n */\nexport function getSoundVolume() {\n  return +query.volume || 1\n}\n\n/**\n * The `?archive` flag specifies a URL to a BMS archive file to be downloaded when the player enters the game.\n *\n * @see https://github.com/bemusic/bemuse/pull/568\n * @see https://twitter.com/Nekokan_Server/status/1173186650865713153\n */\nexport function getPreloadArchiveFlag() {\n  return query.archive\n}\n\n/**\n * The `?grep` flag specifies the initials search text to be pre-filled when the player enters the music selection screen.\n */\nexport function getInitialGrepString() {\n  return query.grep\n}\n\n/**\n * The `?song` flag specifies the title of the song to be pre-selected when the player enters the music selection screen.\n */\nexport function getInitiallySelectedSong() {\n  return query.song\n}\n\nexport function getTimeSynchroServer() {\n  return query.BEMUSE_TIMESYNCHRO_SERVER\n}\n","export function filterSongs(songs, filterText) {\n  return songs.filter((song) => matches(song, filterText))\n}\n\nfunction matches(song, filterText) {\n  if (!filterText) return true\n  return (\n    contains(song.title, filterText) ||\n    contains(song.artist, filterText) ||\n    contains(song.genre, filterText)\n  )\n}\n\nfunction contains(haystack, needle) {\n  return String(haystack.toLowerCase()).indexOf(needle.toLowerCase()) >= 0\n}\n\nexport default filterSongs\n","// This module defines the state shape, behavior, and actions of the Redux store.\n//\n// - Use action constants to create actions. They are in past tense, describing\n//   what happened.\n// - The reducers are used to apply the action to the state. Domain logic should\n//   not be here. Instead, put them in entities.\n// - The selectors can be used to query data from the store.\n//\n\nimport * as Collections from '../entities/Collections'\nimport * as LoadState from '../entities/LoadState'\nimport * as MusicSearchText from '../entities/MusicSearchText'\nimport * as MusicSelection from '../entities/MusicSelection'\nimport * as Options from '../entities/Options'\n\nimport type {\n  Chart,\n  MusicServerIndex,\n  SongMetadataInCollection,\n} from 'bemuse-types'\nimport { PayloadAction, createSlice } from '@reduxjs/toolkit'\n\nimport _ from 'lodash'\nimport { createSelector } from 'reselect'\nimport { enableMapSet } from 'immer'\nimport filterSongs from 'bemuse/music-collection/filterSongs'\nimport getPlayableCharts from 'bemuse/music-collection/getPlayableCharts'\nimport groupSongsIntoCategories from 'bemuse/music-collection/groupSongsIntoCategories'\nimport preprocessCollection from 'bemuse/music-collection/preprocessCollection'\nimport sortSongs from 'bemuse/music-collection/sortSongs'\n\nenableMapSet()\n\nexport interface AppState {\n  collections: Map<string, LoadState.LoadState<MusicServerIndex>>\n  customSongLoadState: LoadState.LoadState<undefined>\n  customSongs: SongMetadataInCollection[]\n  currentCollection: string\n  musicSearchText: MusicSearchText.MusicSearchTextState\n  musicSelection: MusicSelection.MusicSelectionState\n  options: Options.OptionsState\n  currentSongReadme: string\n  rageQuit: boolean\n}\n\n// Slice\nexport const collectionsSlice = createSlice({\n  name: 'collections',\n  initialState: new Map<string, LoadState.LoadState<MusicServerIndex>>(),\n  reducers: {\n    COLLECTION_LOADING_BEGAN: (\n      state,\n      { payload: { url } }: PayloadAction<{ url: string }>\n    ) => {\n      state.set(url, LoadState.initLoading())\n    },\n    COLLECTION_LOADING_ERRORED: (\n      state,\n      { payload: { url, error } }: PayloadAction<{ url: string; error: Error }>\n    ) => {\n      state.set(url, LoadState.errorWithReason(error)())\n    },\n    COLLECTION_LOADED: (\n      state,\n      {\n        payload: { url, data },\n      }: PayloadAction<{ url: string; data: MusicServerIndex }>\n    ) => {\n      state.set(url, LoadState.completeWithValue(data)())\n    },\n  },\n})\nexport const customSongLoadStateSlice = createSlice({\n  name: 'customSongLoadState',\n  initialState: LoadState.initCompletedWithValue(undefined),\n  reducers: {\n    CUSTOM_SONG_LOAD_STARTED: () => LoadState.beginLoading<undefined>()(),\n    CUSTOM_SONG_LOADED: () => LoadState.completeWithValue(undefined)(),\n  },\n})\nexport const customSongsSlice = createSlice({\n  name: 'customSongs',\n  initialState: [] as SongMetadataInCollection[],\n  reducers: {\n    CUSTOM_SONG_LOADED: (\n      _state,\n      { payload: { song } }: PayloadAction<{ song: SongMetadataInCollection }>\n    ) => [song],\n    CUSTOM_SONGS_LOADED: (\n      _state,\n      {\n        payload: { songs },\n      }: PayloadAction<{ songs: SongMetadataInCollection[] }>\n    ) => songs,\n  },\n})\nexport const currentCollectionSlice = createSlice({\n  name: 'currentCollection',\n  initialState: '',\n  reducers: {\n    COLLECTION_LOADING_BEGAN: (\n      state,\n      { payload: { url } }: PayloadAction<{ url: string }>\n    ) => (state === '' ? url : state),\n  },\n})\nexport const currentSongReadmeSlice = createSlice({\n  name: 'currentSongReadme',\n  initialState: 'Omachi kudasai…',\n  reducers: {\n    README_LOADING_STARTED: () => 'Omachi kudasai…',\n    README_LOADING_ERRORED: (\n      _state,\n      { payload: { url } }: PayloadAction<{ url: string }>\n    ) => 'Cannot download ' + url,\n    README_LOADED: (\n      _state,\n      { payload: { text } }: PayloadAction<{ text: string }>\n    ) => text,\n  },\n})\nexport const rageQuitSlice = createSlice({\n  name: 'rageQuit',\n  initialState: false,\n  reducers: {\n    RAGEQUITTED: () => true,\n    RAGEQUIT_DISMISSED: () => false,\n  },\n})\n\n// Reducer\nexport const reducer = {\n  collections: collectionsSlice.reducer,\n  customSongLoadState: customSongLoadStateSlice.reducer,\n  customSongs: customSongsSlice.reducer,\n  currentCollection: currentCollectionSlice.reducer,\n  musicSearchText: MusicSearchText.musicSearchTextSlice.reducer,\n  musicSelection: MusicSelection.musicSelectionSlice.reducer,\n  options: Options.optionsSlice.reducer,\n  currentSongReadme: currentSongReadmeSlice.reducer,\n  rageQuit: rageQuitSlice.reducer,\n}\n\n// Selectors\nexport const selectCurrentCollectionUrl = (state: AppState) =>\n  state.currentCollection\n\nexport const selectCurrentCollection = createSelector(\n  (state: AppState) => state.collections,\n  selectCurrentCollectionUrl,\n  (collections, currentCollection): LoadState.LoadState<MusicServerIndex> => {\n    const index =\n      Collections.getCollectionByUrl<MusicServerIndex>(currentCollection)(\n        collections\n      )\n    if (!index) {\n      throw new Error(\n        `${currentCollection} is selected but not started to load yet`\n      )\n    }\n    return index\n  }\n)\n\nexport const selectIsCurrentCollectionLoading = (state: AppState) =>\n  LoadState.isLoading(selectCurrentCollection(state))\n\nexport const selectCurrentCorrectionLoadError = (state: AppState) =>\n  LoadState.error(selectCurrentCollection(state))\n\nexport const selectRawCurrentCollectionValue = (state: AppState) =>\n  LoadState.value(selectCurrentCollection(state))\n\nexport const selectCurrentCollectionValue = createSelector(\n  selectRawCurrentCollectionValue,\n  (collection) => collection && preprocessCollection(collection)\n)\n\nexport const selectSearchInputText = (state: AppState) =>\n  MusicSearchText.inputText(state.musicSearchText)\n\nexport const selectSearchText = (state: AppState) =>\n  MusicSearchText.searchText(state.musicSearchText)\n\nexport const { selectGroups, selectSongs } = (() => {\n  const selectSongListFromCurrentCollection = createSelector(\n    selectCurrentCollectionValue,\n    (collectionData) => (collectionData && collectionData.songs) || []\n  )\n  const selectSongList = createSelector(\n    selectSongListFromCurrentCollection,\n    (state: AppState) => state.customSongs,\n    (songList, customSongs) => [...customSongs, ...songList]\n  )\n  const selectSortedSongList = createSelector(selectSongList, (songList) =>\n    sortSongs(songList)\n  )\n  const selectFilteredSongList = createSelector(\n    selectSortedSongList,\n    selectSearchText,\n    (songList, searchText) => filterSongs(songList, searchText)\n  )\n  const selectSongOfTheDayEnabled = createSelector(\n    selectCurrentCollectionValue,\n    (collectionData) => collectionData && collectionData.songOfTheDayEnabled\n  )\n  const selectGroups = createSelector(\n    selectFilteredSongList,\n    selectSongOfTheDayEnabled,\n    (songs, songOfTheDayEnabled) =>\n      groupSongsIntoCategories(songs, {\n        songOfTheDayEnabled,\n      })\n  )\n  const selectSongs = createSelector(selectGroups, (groups) =>\n    _(groups).map('songs').flatten().value()\n  )\n  return { selectGroups, selectSongs }\n})()\n\nexport const {\n  selectSelectedSong,\n  selectChartsForSelectedSong,\n  selectSelectedChart,\n} = (() => {\n  const selectMusicSelection = (state: AppState) => state.musicSelection\n  const selectSelectedSong = createSelector(\n    selectMusicSelection,\n    selectSongs,\n    (musicSelection, songs) =>\n      MusicSelection.selectedSongGivenSongs(songs)(musicSelection)\n  )\n  const selectChartsForSelectedSong = createSelector(\n    selectSelectedSong,\n    (song) => getPlayableCharts((song && song.charts) || [])\n  )\n  const selectSelectedChart = createSelector(\n    selectMusicSelection,\n    selectChartsForSelectedSong,\n    (musicSelection, charts): Chart =>\n      MusicSelection.selectedChartGivenCharts(charts)(musicSelection)\n  )\n  return {\n    selectSelectedSong,\n    selectChartsForSelectedSong,\n    selectSelectedChart,\n  }\n})()\n\nexport const selectReadmeTextForSelectedSong = (state: AppState) =>\n  state.currentSongReadme\n\nexport const selectOptions = (state: AppState) => state.options\n\nexport const selectPlayMode = (store: AppState) =>\n  Options.playMode(store.options)\n\nexport const selectRageQuittedFlag = (store: AppState) => store.rageQuit\n","import { AnyAction, Middleware } from 'redux'\nimport {\n  AppState,\n  collectionsSlice,\n  currentCollectionSlice,\n} from './ReduxState'\n\nimport { load as loadCollection } from 'bemuse/music-collection'\n\nexport const collectionFetchMiddleware: Middleware<{}, AppState> =\n  ({ dispatch }) =>\n  (next) =>\n  (action: AnyAction) => {\n    if (\n      action.type === collectionsSlice.actions.COLLECTION_LOADING_BEGAN.type\n    ) {\n      const { url } = action.payload\n      dispatch(currentCollectionSlice.actions.COLLECTION_LOADING_BEGAN({ url }))\n      loadCollection(url).then(\n        (data) =>\n          dispatch(collectionsSlice.actions.COLLECTION_LOADED({ url, data })),\n        (error: Error) => () =>\n          dispatch(\n            collectionsSlice.actions.COLLECTION_LOADING_ERRORED({ url, error })\n          )\n      )\n    }\n\n    return next(action)\n  }\n\nexport default collectionFetchMiddleware\n","import type { AnyAction, Middleware } from 'redux'\nimport type { SongMetadataInCollection } from 'bemuse-types'\n\nimport findMatchingSong from '../interactors/findMatchingSong'\nimport { collectionsSlice } from '../redux/ReduxState'\nimport { getInitiallySelectedSong } from '../query-flags'\nimport { musicSelectionSlice } from '../entities/MusicSelection'\n\n// Configure a collection loader, which loads the Bemuse music collection.\nexport const collectionLoader: Middleware =\n  ({ dispatch }) =>\n  (next) =>\n  <A extends AnyAction>(action: A) => {\n    if (action.type !== collectionsSlice.actions.COLLECTION_LOADED.type) {\n      return next(action)\n    }\n    const ret = next(action)\n    const initiallySelectedSong = getInitiallySelectedSong()\n    if (initiallySelectedSong) {\n      const matchingSong = findMatchingSong({\n        songs: action.data.songs,\n        getTitle: (song: SongMetadataInCollection) => song.title,\n        title: initiallySelectedSong,\n      })\n      if (matchingSong) {\n        dispatch(\n          musicSelectionSlice.actions.MUSIC_SONG_SELECTED({\n            songId: matchingSong.id,\n          })\n        )\n      }\n    }\n    return ret\n  }\n","import type { AnyAction, Middleware } from 'redux'\nimport { initialState, optionsSlice } from '../entities/Options'\n\nimport type { AppState } from './ReduxState'\n\nexport const optionsStorageMiddleware =\n  (storage: Storage = localStorage): Middleware<{}, AppState> =>\n  ({ dispatch, getState }) =>\n  (next) =>\n  (action: AnyAction) => {\n    if (action.type === optionsSlice.actions.LOAD_FROM_STORAGE.type) {\n      const options: Record<string, string> = {}\n      for (const key of Object.keys(initialState)) {\n        options[key] = storage.getItem(key) ?? initialState[key]\n      }\n      dispatch(optionsSlice.actions.LOADED_FROM_STORAGE({ options }))\n    }\n    next(action)\n    if (action.type.startsWith('options/')) {\n      const { options } = getState()\n      for (const key of Object.keys(options)) {\n        storage.setItem(key, options[key])\n      }\n    }\n  }\n","import { Middleware, compose } from 'redux'\n\nimport { collectionFetchMiddleware } from './collectionFetchMiddleware'\nimport { collectionLoader } from './collectionLoader'\nimport { configureStore as createStore } from '@reduxjs/toolkit'\nimport { optionsStorageMiddleware } from './optionsStorageMiddleware'\nimport { reducer } from './ReduxState'\n\ndeclare global {\n  interface Window {\n    devToolsExtension?: typeof compose\n  }\n}\n\nexport default function configureStore() {\n  const devTools = () =>\n    window.devToolsExtension ? window.devToolsExtension() : <T>(f: T) => f\n  const middleware: Middleware[] = [\n    optionsStorageMiddleware(),\n    collectionFetchMiddleware,\n    collectionLoader,\n    devTools,\n  ]\n  const store = createStore({ reducer, middleware })\n  return store\n}\n","let _enabled = false\n\nlet _lifecycleHandler = {\n  /** @returns {Promise<void>} */\n  pauseAt(t) {\n    throw new Error('Cannot pause: No lifecycle handler registered!')\n  },\n  /** @returns {void} */\n  unpause() {\n    throw new Error('Cannot unpause: No lifecycle handler registered!')\n  },\n  /** @returns {number} */\n  getScore() {\n    throw new Error('Cannot get score: No lifecycle handler registered!')\n  },\n}\n\n/**\n * Activates the test mode. In this mode,\n *\n * - An overlay will be displayed indicating the test mode.\n * - The following APIs will be available to facilitate automated testing:\n *     - `BemuseTestMode.pauseAt(t)` will make the game pause at time `t`.\n *     - `BemuseTestMode.unpause()` will unpause the game.\n * - Score submission is disabled.\n *\n * Note: Once test mode is activated, it cannot be deactivated for the rest of the game session.\n */\nexport function enableTestMode() {\n  if (!_enabled) {\n    _enabled = true\n    console.log('[Bemuse test mode enabled]')\n    const overlay = document.createElement('div')\n    overlay.setAttribute(\n      'style',\n      `\n        position: fixed;\n        top: 20px;\n        left: 20px;\n        font: 20px Comic Sans MS, sans-serif;\n        z-index: 99999;\n        background: rgba(0,0,0,0.5);\n        color: #0f0;\n        border: 2px solid #0f0;\n        padding: 4px;\n        pointer-events: none;\n      `\n    )\n    overlay.innerHTML = `\n      <strong>Test mode:</strong>\n      Bemuse is being controlled by automated test software.\n    `\n    document.body.appendChild(overlay)\n  }\n}\n\n/**\n * Registers a pause handler.\n * This allows the `pauseAt` and `unpause` APIs to be used.\n *\n * @param {typeof _lifecycleHandler} handler\n */\nexport function setGameLifecycleHandler(handler) {\n  console.log('[Bemuse test mode] A pause handler has been registered.')\n  _lifecycleHandler = handler\n}\n\n/**\n * Returns `true` if test mode is enabled, `false` otherwise.\n */\nexport function isTestModeEnabled() {\n  return !!_enabled\n}\n\n/**\n * Will schedule the game to pause at time `t`.\n *\n * @param {number} t The song time to pause in seconds\n * @returns {Promise<void>} A promise that will be resolved when the time is reached and game is paused.\n */\nexport function pauseAt(t) {\n  return _lifecycleHandler.pauseAt(t)\n}\n\n/**\n * Unpauses the game.\n */\nexport function unpause() {\n  return _lifecycleHandler.unpause()\n}\n\n/**\n * Returns the current score.\n */\nexport function getScore() {\n  return _lifecycleHandler.getScore()\n}\n","\n      import API from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.2_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.57.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./BenchmarkPanel.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../common/temp/node_modules/.pnpm/css-loader@6.7.3_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.2_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.57.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./BenchmarkPanel.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import './BenchmarkPanel.scss'\n\nimport React, { MouseEvent, TouchEvent, useEffect, useState } from 'react'\n\nconst Table = ({ stats }: { stats: Record<string, unknown> }) => (\n  <table>\n    <tbody>\n      {Object.keys(stats).map((key) => {\n        const stat = stats[key]\n        return (\n          <tr key={key}>\n            <td>\n              <strong>{key}</strong>\n            </td>\n            <td align='right'>{'' + stat}</td>\n          </tr>\n        )\n      })}\n    </tbody>\n  </table>\n)\n\nexport interface BenchmarkPanelProps {\n  bench: {\n    stats: Record<string, unknown>\n  }\n}\n\nconst BenchmarkPanel = ({ bench }: BenchmarkPanelProps) => {\n  const [show, setShow] = useState(false)\n  const [, updater] = useState(false)\n\n  useEffect(() => {\n    const id = setInterval(() => updater((flag) => !flag), 1000)\n    return () => {\n      clearInterval(id)\n    }\n  }, [])\n\n  const handleInteraction = (e: MouseEvent | TouchEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setShow((flag) => !flag)\n  }\n\n  return (\n    <div\n      className='BenchmarkPanel'\n      onClick={handleInteraction}\n      onTouchStart={handleInteraction}\n    >\n      {show ? (\n        <article>\n          <b>Benchmark Stats</b>\n          <br />\n          <Table stats={bench.stats} />\n        </article>\n      ) : (\n        'Show Benchmark Stats'\n      )}\n    </div>\n  )\n}\n\nexport default BenchmarkPanel\n","import now from 'bemuse/utils/now'\nimport { shouldEnableBenchmark } from './query-flags'\nimport React from 'react'\nimport { createRoot } from 'react-dom/client'\nimport BenchmarkPanel from './ui/BenchmarkPanel'\n\nfunction Stat() {\n  let sum = 0\n  let count = 0\n  let average = 0\n  const hist = []\n  let lastSec = 0\n  let secAvg = 0\n  return {\n    push: function (delta) {\n      const t = now()\n      sum += delta\n      count += 1\n      average = sum / count\n      lastSec += delta\n      hist.push({ delta, time: t })\n      while (hist[0] && hist[0].time < t - 1000) {\n        lastSec -= hist.shift().delta\n      }\n      secAvg = lastSec / hist.length\n    },\n    toString() {\n      return format(average) + ' / ' + format(secAvg)\n    },\n  }\n}\n\nfunction format(x) {\n  return x.toFixed(2) + 'ms'\n}\n\nfunction Benchmarker() {\n  const stats = {}\n  const bench = {\n    enabled: true,\n    stats,\n    wrap(title, f) {\n      return function () {\n        const start = now()\n        try {\n          return f.apply(this, arguments)\n        } finally {\n          const finish = now()\n          const stat = stats[title] || (stats[title] = new Stat(title))\n          stat.push(finish - start)\n        }\n      }\n    },\n    benchmark(title, obj, name) {\n      obj[name] = this.wrap(title, obj[name])\n    },\n    toString() {\n      const lines = []\n      Object.keys(stats).forEach(function (key) {\n        lines.push('- ' + key + ': ' + stats[key])\n      })\n      return lines.join('\\n')\n    },\n  }\n  const div = document.createElement('div')\n  div.setAttribute('style', 'position:fixed;top:10px;right:10px;z-index:99999')\n  document.body.appendChild(div)\n  createRoot(div).render(<BenchmarkPanel bench={bench} />)\n  return bench\n}\n\nfunction FakeBenchmarker() {\n  return {\n    enabled: false,\n    wrap: (title, f) => f,\n  }\n}\n\nexport default window.BEMUSE_BENCHMARK = shouldEnableBenchmark()\n  ? new Benchmarker()\n  : new FakeBenchmarker()\n","import query from 'bemuse/utils/query'\n\nexport function shouldShowOptions() {\n  return query.BEMUSE_SHOW_OPTIONS === '1'\n}\n\nexport function shouldEnableBenchmark() {\n  return query.BEMUSE_BENCHMARK === '1'\n}\n\nexport function shouldDisableFullScreen() {\n  return query.BEMUSE_NO_FULLSCREEN === '1'\n}\n\nexport function shouldShowAbout() {\n  return query.BEMUSE_SHOW_ABOUT === '1'\n}\n\nexport function shouldShowModeSelect() {\n  return query.BEMUSE_SHOW_MODE_SELECT === '1'\n}\n\nexport function isTitleDisplayMode() {\n  return query.BEMUSE_TITLE_DISPLAY === '1'\n}\n","export function getGauge(gaugeType) {\n  if (gaugeType === 'hope') {\n    return hopeGauge()\n  }\n  return nullGauge()\n}\n\nfunction nullGauge() {\n  return {\n    update() {},\n    shouldDisplay() {\n      return false\n    },\n    getPrimary() {\n      return 0\n    },\n    getSecondary() {\n      return 0\n    },\n    getExtra() {\n      return 0\n    },\n  }\n}\n\nfunction hopeGauge() {\n  let primary\n  let secondary\n  let extra\n  return {\n    update(playerState) {\n      const stats = playerState.stats\n      const progress = stats.numJudgments / stats.totalCombo\n      const getHope = (min, max1, max2) => {\n        const max = max1 + (max2 - max1) * progress\n        const maxPossibleScore = stats.maxPossibleScore\n        return Math.max(0, (maxPossibleScore - min) / (max - min))\n      }\n      const hopeS = getHope(500000, 555555, 510000) * 0.5\n      primary = Math.min(1, hopeS)\n      extra = Math.max(0, Math.min(1, hopeS - 1))\n      if (hopeS > 0) {\n        secondary = 0\n      } else {\n        const hopeA = getHope(450000, 500000, 500000)\n        secondary = hopeA\n      }\n    },\n    shouldDisplay() {\n      return primary > 0 || secondary > 0\n    },\n    getPrimary() {\n      return primary\n    },\n    getSecondary() {\n      return secondary\n    },\n    getExtra() {\n      return extra\n    },\n  }\n}\n","import _ from 'lodash'\n\nexport class NoteArea {\n  constructor(notes, barLines) {\n    this._notes = _.sortBy(notes, position)\n    this._barLines = _(barLines).map('position').sortBy().value()\n  }\n\n  getVisibleNotes(lower, upper, headroom) {\n    const out = []\n    const notes = this._notes\n    if (!headroom) headroom = 0\n    for (let i = 0; i < notes.length; i++) {\n      const note = notes[i]\n      const visible = note.end\n        ? !(note.position > upper || note.end.position < lower - headroom)\n        : !(note.position > upper || note.position < lower - headroom)\n      if (visible) {\n        const entity = { note: note }\n        if (!note.end) {\n          entity.y = y(lower, upper, note.position)\n        } else {\n          const head = y(lower, upper, note.position)\n          const tail = y(lower, upper, note.end.position)\n          entity.y = Math.min(head, tail)\n          entity.height = Math.abs(head - tail)\n        }\n        out.push(entity)\n      }\n    }\n    return out\n  }\n\n  getVisibleBarLines(lower, upper, headroom) {\n    if (!headroom) headroom = 0\n    return this._barLines\n      .filter((pos) => lower - headroom <= pos && pos <= upper)\n      .map((pos) => ({ id: pos, y: y(lower, upper, pos) }))\n  }\n}\n\nexport default NoteArea\n\nfunction y(lower, upper, pos) {\n  return 1 - (pos - lower) / (upper - lower)\n}\n\nfunction position(event) {\n  return event.position\n}\n","import * as touch3d from './touch3d'\nimport NoteArea from './note-area'\nimport { MISSED, breaksCombo } from '../judgments'\nimport { getGauge } from './Gauge'\n\nexport class PlayerDisplay {\n  constructor(player, skinData) {\n    this._currentSpeed = 1\n    this._player = player\n    this._noteArea = new NoteArea(\n      player.notechart.notes,\n      player.notechart.barLines\n    )\n    this._stateful = {}\n    this._defaultData = {\n      placement: player.options.placement,\n      scratch: player.options.scratch,\n      key_mode: player.notechart.getKeyMode(player.options.scratch),\n      lane_lift: Math.max(0, -player.options.laneCover),\n      lane_press: Math.max(0, player.options.laneCover),\n    }\n    this._gauge = getGauge(player.options.gauge)\n    this._touch3dMode = skinData.displayMode === 'touch3d'\n  }\n\n  update(time, gameTime, playerState) {\n    const touch3dMode = this._touch3dMode\n    const player = this._player\n    const noteArea = this._noteArea\n    const stateful = this._stateful\n    const beat = player.notechart.secondsToBeat(gameTime)\n    const position = player.notechart.beatToPosition(beat)\n    const spacing = player.notechart.spacingAtBeat(beat)\n    const data = Object.assign({}, this._defaultData)\n    const push = (key, value) => (data[key] || (data[key] = [])).push(value)\n    const gauge = this._gauge\n\n    this._currentSpeed += (playerState.speed - this._currentSpeed) / 3\n    const speed = this._currentSpeed * spacing\n\n    updateBeat()\n    updateVisibleNotes()\n    updateBarLines()\n    updateInput()\n    updateJudgment()\n    updateGauge()\n    updateExplode()\n\n    data['speed'] = playerState.speed.toFixed(1) + 'x'\n    data['stat_1'] = getCount(1)\n    data['stat_2'] = getCount(2)\n    data['stat_3'] = getCount(3)\n    data['stat_4'] = getCount(4)\n    data['stat_missed'] = getCount(MISSED)\n    data['stat_acc'] = getAccuracy()\n    const bpm = player.notechart.bpmAtBeat(beat)\n    data['bpm'] = bpm < 1 ? '' : Math.round(bpm) % 10000 || ''\n\n    Object.assign(data, stateful)\n    return data\n\n    function updateBeat() {\n      data.beat = beat\n    }\n\n    function getCount(judgment) {\n      return playerState.stats.counts && playerState.stats.counts[judgment]\n    }\n\n    function getAccuracy() {\n      return ((playerState.stats.currentAccuracy || 0) * 100).toFixed(2) + '%'\n    }\n\n    function updateVisibleNotes() {\n      const entities = noteArea.getVisibleNotes(position, getUpperBound(), 1)\n      if (touch3dMode) {\n        const putNote = (id, noteY, column, scale = 1) => {\n          const row = touch3d.getRow(noteY - 0.01)\n          const columnIndex = +column || -1\n          const areaWidth = touch3d.PLAY_AREA_WIDTH\n          const xOffset =\n            row.projection * areaWidth * ((2 * (columnIndex - 0.5)) / 7 - 1)\n          const desiredWidth = (row.projection * scale * areaWidth * 2) / 7\n          push(`note3d_${column}`, {\n            key: id,\n            y: row.y,\n            x: xOffset + 1280 / 2,\n            width: desiredWidth,\n          })\n        }\n        const longNoteStep = 3 / 128\n        for (const entity of entities) {\n          const note = entity.note\n          const column = note.column\n          if (entity.height) {\n            let c = 0\n            const start = entity.y + entity.height\n            for (\n              let i =\n                start -\n                Math.max(\n                  0,\n                  Math.floor((start - 1) / longNoteStep) * longNoteStep\n                );\n              i >= 0 && i >= entity.y;\n              i -= longNoteStep\n            ) {\n              putNote(note.id + 'x' + c++, i, column, 0.8)\n            }\n            putNote(note.id, entity.y + entity.height, column)\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              putNote(note.id, entity.y, column)\n            }\n          }\n        }\n      } else {\n        for (const entity of entities) {\n          const note = entity.note\n          const column = note.column\n          if (entity.height) {\n            const judgment = playerState.getNoteJudgment(note)\n            const status = playerState.getNoteStatus(note)\n            push(`longnote_${column}`, {\n              key: note.id,\n              y: entity.y,\n              height: entity.height,\n              active: judgment !== 0 && judgment !== MISSED,\n              missed: status === 'judged' && judgment === MISSED,\n            })\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              push(`note_${column}`, {\n                key: note.id,\n                y: entity.y,\n              })\n            }\n          }\n        }\n      }\n    }\n\n    function updateBarLines() {\n      const entities = noteArea.getVisibleBarLines(position, getUpperBound(), 1)\n      for (const entity of entities) {\n        if (touch3dMode) {\n          const row = touch3d.getRow(entity.y - 0.01)\n          push('barlines3d', {\n            key: entity.id,\n            y: row.y,\n            x: row.projection * -touch3d.PLAY_AREA_WIDTH + 1280 / 2,\n            width: row.projection * touch3d.PLAY_AREA_WIDTH * 2,\n          })\n        } else {\n          push('barlines', { key: entity.id, y: entity.y })\n        }\n      }\n    }\n\n    function updateInput() {\n      const input = playerState.input\n      for (const column of player.columns) {\n        const control = input.get(column)\n        data[`${column}_active`] = control.value !== 0 ? 1 : 0\n        if (control.changed) {\n          if (control.value !== 0) {\n            stateful[`${column}_down`] = time\n          } else {\n            stateful[`${column}_up`] = time\n          }\n        }\n      }\n    }\n\n    function updateJudgment() {\n      const notifications = playerState.notifications.judgments\n      const notification = notifications[notifications.length - 1]\n      if (notification) {\n        const name =\n          notification.judgment === -1 ? 'missed' : `${notification.judgment}`\n        stateful[`judge_${name}`] = time\n        const deviationMode =\n          notification.judgment === -1 || notification.judgment === 1\n            ? 'none'\n            : notification.delta > 0\n            ? 'late'\n            : notification.delta < 0\n            ? 'early'\n            : 'none'\n        stateful[`judge_deviation_${deviationMode}`] = time\n        stateful['combo'] = notification.combo\n      }\n      data['score'] = playerState.stats.score\n    }\n\n    function updateGauge() {\n      gauge.update(playerState)\n      if (gauge.shouldDisplay()) {\n        if (!stateful['gauge_enter']) stateful['gauge_enter'] = time\n      } else {\n        if (stateful['gauge_enter']) {\n          if (!stateful['gauge_exit']) stateful['gauge_exit'] = time\n        }\n      }\n      data['gauge_primary'] = gauge.getPrimary()\n      data['gauge_secondary'] = gauge.getSecondary()\n      data['gauge_extra'] = gauge.getExtra()\n    }\n\n    function updateExplode() {\n      const notifications = playerState.notifications.judgments\n      for (let i = 0; i < notifications.length; i++) {\n        const notification = notifications[i]\n        if (!breaksCombo(notification.judgment)) {\n          stateful[`${notification.column}_explode`] = time\n        }\n      }\n    }\n\n    function getUpperBound() {\n      return position + 5 / speed\n    }\n  }\n}\n\nexport default PlayerDisplay\n","// Touch3D mode -- inspired by Thapster.\n// Notes are arranged on a 3D arc that moves towards the screen.\n// Example: https://twitter.com/bemusegame/status/950505986409709569\n\n/** Parameters to the algorithm. These values are obtained by trial-and-error. */\nconst config = {\n  /** Centre point of the arc (X-coordinate) */\n  cx: 1024,\n  /** Centre point of the arc (Y-coordinate) */\n  cy: -975,\n  /** Radius of the arc */\n  r: 1024,\n  /** Beginning angle of the arc */\n  t0: 3.922,\n  /** Ending angle of the arc */\n  t1: 4.555,\n  /**\n   * Perspective value (field of view).\n   * Camera is placed at (p, 0, 0), facing towards (0, 0, 0).\n   * See: https://developer.mozilla.org/en-US/docs/Web/CSS/perspective\n   */\n  p: 960,\n  /** Width of the play area */\n  w: 60,\n}\n\n/**\n * Given the display position (0 representing top and 1 representing bottom),\n * calculates the onscreen position to display it.\n *\n * Screen size is hardcoded as 1280x720.\n *\n * @param position The display position (0 representing top and 1 representing bottom)\n * @return An object with\n *   - `y` A number represeting the onscreen position to display the note.\n *   - `projection` The projected scale. If an object is closer to the screen,\n *     it will appear bigger. This value represents that scale.\n */\nexport function getRow(position) {\n  const excess = Math.max(0, position - 1)\n  if (position < 0) position = 0\n  if (position > 1) position = 1\n  const theta = config.t0 + (config.t1 - config.t0) * position\n  const pointX = config.cx + Math.cos(theta) * config.r\n  const pointY = config.cy - Math.sin(theta) * config.r\n  const projection = config.p / (config.p - pointX)\n  const screenY = pointY * projection + 720 / 2\n  return { y: screenY + excess * 2048, projection }\n}\n\n/**\n * The world width of the play area.\n * Multiply this with the projection number to get the onscreen width.\n */\nexport const PLAY_AREA_WIDTH = config.w\n\n/**\n * Finds the touched column based on screen coordinate.\n *\n * @param {number} x The x onscreen coordinate (0~1280)\n * @param {number} y The y onscreen coordinate (0~1280)\n * @return Column name ('1'~'7') or `null` if no column should be triggered.\n */\nexport function getTouchedColumn(x, y) {\n  let min = 0.75\n  let max = 1\n  let mid\n  let row\n  for (let i = 0; i < 8; i++) {\n    mid = (min + max) / 2\n    row = getRow(mid)\n    if (row.y > y) {\n      max = mid\n    } else {\n      min = mid\n    }\n  }\n  if (mid < 0.8) return null\n  const x0 = 1280 / 2 + row.projection * -config.w\n  const x1 = 1280 / 2 + row.projection * config.w\n  let pos = Math.floor(((x - x0) / (x1 - x0)) * 7)\n  if (pos >= -1 && pos <= 7) {\n    if (pos < 0) pos = 0\n    if (pos > 6) pos = 6\n    return String(pos + 1)\n  }\n  return null\n}\n","export class Control {\n  public value = 0\n  public changed = false\n  get justPressed() {\n    return this.changed && this.value\n  }\n}\n\nexport default Control\n","import Control from './control'\nimport _ from 'lodash'\nimport bench from 'bemuse/devtools/benchmark'\n\ntype GameInputPluginInternalInstance = {\n  get(): [string, number][]\n  destroy(): void\n}\n\ninterface IGameInputPlugin {\n  name: string\n  get(): { [key: string]: number }\n  destroy?(): void\n}\n\nexport class GameInput {\n  private _controls = new Map<string, Control>()\n  private _plugins: GameInputPluginInternalInstance[] = []\n  update() {\n    const changes = new Map()\n    for (const [name, control] of this._controls) {\n      void name\n      control.changed = false\n    }\n    for (const plugin of this._plugins) {\n      for (const [name, value] of plugin.get()) {\n        changes.set(name, value)\n      }\n    }\n    for (const [name, value] of changes) {\n      const control = this.get(name)!\n      if (control.value !== value) {\n        control.changed = true\n        control.value = value\n      }\n    }\n  }\n\n  destroy() {\n    for (const plugin of this._plugins) {\n      plugin.destroy()\n    }\n  }\n\n  get(controlName: string) {\n    if (!this._controls.has(controlName)) {\n      this._controls.set(controlName, new Control())\n    }\n    return this._controls.get(controlName)!\n  }\n\n  use(plugin: IGameInputPlugin) {\n    const state: { [key: string]: number } = {}\n    const name = 'input:' + plugin.name\n    this._plugins.push({\n      get: bench.wrap(name, function () {\n        const out = plugin.get()\n        const diff = []\n        for (const key of _.union(_.keys(out), _.keys(state))) {\n          const last = +state[key] || 0\n          const current = +out[key] || 0\n          if (last !== current) diff.push([key, current])\n          state[key] = current\n        }\n        return diff\n      }),\n      destroy() {\n        if (typeof plugin.destroy === 'function') {\n          return plugin.destroy()\n        } else {\n          return true\n        }\n      },\n    })\n  }\n}\n\nexport default GameInput\n","import _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nexport enum Judgment {\n  Missed = -1,\n  Unjudged = 0,\n  Meticulous = 1,\n  Precise = 2,\n  Good = 3,\n  Offbeat = 4,\n}\n\nexport type JudgedJudgment = Exclude<Judgment, Judgment.Unjudged>\n\nexport const UNJUDGED = Judgment.Unjudged\nexport const MISSED = Judgment.Missed\n\nexport type Timegate = {\n  value: Judgment\n  timegate: number\n  endTimegate: number\n}\nexport type Timegates = Timegate[]\n\n// #region judgment timegate\nconst NORMAL_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.02, endTimegate: 0.04 },\n  { value: 2, timegate: 0.05, endTimegate: 0.1 },\n  { value: 3, timegate: 0.1, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV5_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.021, endTimegate: 0.042 },\n  { value: 2, timegate: 0.06, endTimegate: 0.12 },\n  { value: 3, timegate: 0.12, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV4_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.022, endTimegate: 0.044 },\n  { value: 2, timegate: 0.07, endTimegate: 0.14 },\n  { value: 3, timegate: 0.14, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV3_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.023, endTimegate: 0.046 },\n  { value: 2, timegate: 0.08, endTimegate: 0.16 },\n  { value: 3, timegate: 0.16, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst ABSOLUTE_BEGINNER_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.024, endTimegate: 0.048 },\n  { value: 2, timegate: 0.1, endTimegate: 0.18 },\n  { value: 3, timegate: 0.18, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\n// #endregion\n\nexport interface IJudge {\n  getTimegates(gameTime: number | null, noteTime: number | null): Timegates\n}\n\nclass FixedTimegatesJudge implements IJudge {\n  constructor(private timegates: Timegates) {}\n  getTimegates(_gameTime: number | null, _noteTime: number | null) {\n    return this.timegates\n  }\n}\n\nclass TutorialJudge implements IJudge {\n  getTimegates(_gameTime: number | null, noteTime: number | null) {\n    if (!noteTime || noteTime < 100) {\n      return ABSOLUTE_BEGINNER_TIMEGATES\n    } else {\n      return NORMAL_TIMEGATES\n    }\n  }\n}\n\nconst NORMAL_JUDGE = new FixedTimegatesJudge(NORMAL_TIMEGATES)\n\nexport function getJudgeForNotechart(\n  notechart: Notechart,\n  { tutorial = false }\n): IJudge {\n  const info = notechart.songInfo\n  const insane = info.difficulty >= 5\n  if (tutorial) {\n    return new TutorialJudge()\n  }\n  if (insane) {\n    return NORMAL_JUDGE\n  }\n  if (info.level === 1 || info.level === 2) {\n    return new FixedTimegatesJudge(ABSOLUTE_BEGINNER_TIMEGATES)\n  }\n  if (info.level === 3) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV3_TIMEGATES)\n  }\n  if (info.level === 4) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV4_TIMEGATES)\n  }\n  if (info.level === 5) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV5_TIMEGATES)\n  }\n  return NORMAL_JUDGE\n}\n\n/**\n * Takes a gameTime and noteTime and returns the appropriate judgment.\n *\n *  1 - METICULOUS\n *  2 - PRECISE\n *  3 - GOOD\n *  4 - OFFBEAT\n *  0 - (not judge)\n * -1 - MISSED\n */\nexport function judgeTimeWith(f: (timegate: Timegate) => number) {\n  return function judgeTimeWithF(\n    gameTime: number,\n    noteTime: number,\n    judge: IJudge = NORMAL_JUDGE\n  ): Judgment {\n    const timegates = judge.getTimegates(gameTime, noteTime)\n    const delta = Math.abs(gameTime - noteTime)\n    for (let i = 0; i < timegates.length; i++) {\n      if (delta < f(timegates[i])) return timegates[i].value\n    }\n    return gameTime < noteTime ? UNJUDGED : MISSED\n  }\n}\n\nexport const judgeTime = judgeTimeWith((t) => t.timegate)\nexport const judgeEndTime = judgeTimeWith((t) => t.endTimegate)\n\nexport function timegate(judgment: Judgment, judge = NORMAL_JUDGE) {\n  return _.find(judge.getTimegates(null, null), { value: judgment })!.timegate\n}\n\nexport function isBad(judgment: Judgment) {\n  return judgment >= 4\n}\n\nexport function breaksCombo(judgment: Judgment) {\n  return judgment === MISSED || isBad(judgment)\n}\n\n// #region judgment weight\nexport function weight(judgment: Judgment) {\n  if (judgment === 1) return 100\n  if (judgment === 2) return 80\n  if (judgment === 3) return 50\n  return 0\n}\n// #endregion\n","import Notechart from 'bemuse-notechart'\nimport { PlayerOptions } from 'bemuse-notechart/lib/types'\n\nexport type PlayerControlKeys =\n  | '1'\n  | '2'\n  | '3'\n  | '4'\n  | '5'\n  | '6'\n  | '7'\n  | 'SC'\n  | 'SC2'\n\nexport type PlayerOptionsPlacement = 'left' | 'center' | 'right' | '3d'\n\nexport type PlayerOptionsScratch = 'left' | 'right' | 'off'\n\nexport type PlayerOptionsGauge = 'off' | 'hope'\n\ntype PlayerOptionsInputMapping = {\n  keyboard: { [control in PlayerControlKeys]: string }\n  continuous: boolean\n  sensitivity: number\n}\n\ntype PlayerOptionsInternal = {\n  autoplayEnabled: boolean\n  autosound: boolean\n  speed: number\n  placement: PlayerOptionsPlacement\n  scratch: PlayerOptionsScratch\n  laneCover: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial: boolean\n}\n\nexport type PlayerOptionsInput = PlayerOptions & {\n  autoplayEnabled?: boolean\n  autosound?: boolean\n  speed: number\n  placement?: PlayerOptionsPlacement\n  laneCover?: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial?: boolean\n}\n\n/** The object representing the player's information, notechart and options. */\nexport class Player {\n  public readonly options: PlayerOptionsInternal\n  constructor(\n    public readonly notechart: Notechart,\n    public readonly number: number,\n    options: PlayerOptionsInput\n  ) {\n    this.options = {\n      autoplayEnabled: !!options.autoplayEnabled,\n      autosound: !!options.autosound,\n      speed: +options.speed,\n      placement: options.placement || 'center',\n      scratch: options.scratch || 'left',\n      input: options.input,\n      laneCover: +(options.laneCover || 0),\n      gauge: options.gauge,\n      tutorial: !!options.tutorial,\n    }\n  }\n\n  // An array of column names for this Notechart.\n  get columns() {\n    return this.notechart.columns\n  }\n}\n\nexport default Player\n","import _ from 'lodash'\n\nimport PlayerStats from './player-stats'\nimport {\n  MISSED,\n  getJudgeForNotechart,\n  isBad,\n  judgeEndTime,\n  judgeTime,\n  IJudge,\n  Judgment,\n  JudgedJudgment,\n} from '../judgments'\nimport Player from '../player'\nimport { GameNote } from 'bemuse-notechart/lib/types'\nimport GameInput from '../input'\nimport Control from '../input/control'\nimport invariant from 'invariant'\n\ntype NoteResult = {\n  judgment: Judgment\n  status: NoteStatus\n  delta: number\n}\n\nenum NoteStatus {\n  /** For long notes -- when the player is holding the note but not yet release it. */\n  Active = 'active',\n  /** This not is not yet judged. */\n  Unjudged = 'unjudged',\n  /** This note is fully-judged. */\n  Judged = 'judged',\n}\n\ntype Notifications = {\n  sounds: (\n    | { type: 'hit'; note: GameNote; judgment: Judgment }\n    | { type: 'free'; note: GameNote }\n    | { type: 'break'; note: GameNote }\n  )[]\n  judgments: {}[]\n}\n\nfunction initializeNotifications(): Notifications {\n  return { sounds: [], judgments: [] }\n}\n\n// The PlayerState class holds a single player's state, including the stats\n// (score, current combo, maximum combo).\nexport class PlayerState {\n  /** The PlayerStats object. */\n  public stats: PlayerStats\n\n  /** The notifications from the previous update. */\n  public notifications = initializeNotifications()\n  /** The current note scrolling speed. */\n  public speed: number\n  /** `true` if finished playing, `false` otherwise. */\n  public finished = false\n  /** `true` if score is invalid due to autoplay being activated. `false` otherwise. */\n  public tainted = false\n  public input: Map<string, Control> = new Map()\n\n  private _columns: string[]\n  private _noteBufferByColumn: _.Dictionary<NoteBuffer>\n  private _noteResult: Map<GameNote, NoteResult>\n  private _duration: number\n  private _judge: IJudge\n  private _gameTime = 0\n  private _rawInput?: GameInput\n  private _pinching: null | { start: number; speed: number } = null\n\n  constructor(public readonly player: Player) {\n    this._columns = player.columns\n    this._noteBufferByColumn = _(player.notechart.notes)\n      .sortBy((n) => n.time)\n      .groupBy((n) => n.column)\n      .mapValues(noteBuffer(this))\n      .value()\n    this._noteResult = new Map()\n    this._duration = player.notechart.duration\n    this._judge = getJudgeForNotechart(player.notechart, {\n      tutorial: player.options.tutorial,\n    })\n    this.stats = new PlayerStats(player.notechart)\n    this.speed = player.options.speed\n  }\n\n  /**\n   * Updates the state. Judge the notes and emit notifications.\n   */\n  update(gameTime: number, input: GameInput) {\n    this._gameTime = gameTime\n    this._rawInput = input\n    this.notifications = initializeNotifications()\n    this._updateInputColumnMap()\n    this._judgeNotes()\n    this._updateSpeed()\n    if (gameTime > this._duration + 3) this.finished = true\n  }\n\n  getNoteStatus(note: GameNote): NoteStatus {\n    const result = this._noteResult.get(note)\n    if (!result) return NoteStatus.Unjudged\n    return result.status\n  }\n\n  getNoteJudgment(note: GameNote) {\n    const result = this._noteResult.get(note)\n    if (!result) return Judgment.Unjudged\n    return result.judgment\n  }\n\n  getPlayerInput(control: string) {\n    return this._rawInput!.get(`p${this.player.number}_${control}`)!\n  }\n\n  _updateInputColumnMap() {\n    this.input = new Map(\n      this._columns.map((column) => [column, this.getPlayerInput(column)])\n    )\n  }\n\n  _judgeNotes() {\n    for (const column of this._columns) {\n      const buffer = this._noteBufferByColumn[column]\n      if (buffer) {\n        const control = this.input.get(column)!\n        this._judgeColumn(buffer, control, column)\n        buffer.update()\n      }\n    }\n  }\n\n  _updateSpeed() {\n    if (this.getPlayerInput('speedup').justPressed) {\n      this._modifySpeed(+1)\n    }\n    if (this.getPlayerInput('speeddown').justPressed) {\n      this._modifySpeed(-1)\n    }\n    const pinch = this.getPlayerInput('pinch').value\n    if (pinch && !this._pinching) {\n      this._pinching = { start: pinch, speed: this.speed }\n    } else if (!pinch) {\n      this._pinching = null\n    }\n    if (pinch && this._pinching) {\n      const pinching = this._pinching\n      const speed = (pinching.speed * pinch) / pinching.start\n      this.speed = Math.max(0.2, Math.round(speed * 10) / 10)\n    }\n  }\n\n  _modifySpeed(direction: 1 | -1) {\n    const amount = this._rawInput!.get('select').value\n      ? 0.1\n      : this.speed < 0.5\n      ? 0.3\n      : 0.5\n    this.speed += direction * amount\n    if (this.speed < 0.2) this.speed = 0.2\n  }\n\n  _shouldAutoplay() {\n    return this.player.options.autoplayEnabled || isAutoplayEnabled()\n  }\n\n  _judgeColumn(buffer: NoteBuffer, control: Control, column: string) {\n    let judgedNote\n    let judgment\n    const notes = buffer.notes\n    let autoPlayed = false\n    for (let i = buffer.startIndex; i < notes.length; i++) {\n      const note = notes[i]\n      if (this._shouldJudge(note, control, buffer)) {\n        const shouldBreak = this.getNoteStatus(note) !== 'active'\n        judgedNote = note\n        judgment = this._judgeNote(note)\n        if (this._shouldAutoplay()) {\n          autoPlayed = true\n        }\n        if (shouldBreak) break\n      }\n    }\n    if (control.justPressed || autoPlayed) {\n      if (judgedNote && judgment != null) {\n        this.notifications.sounds!.push({\n          note: judgedNote,\n          type: 'hit',\n          judgment: judgment,\n        })\n      } else {\n        const freestyleNote = this._getFreestyleNote(notes)\n        if (freestyleNote) {\n          const shouldPlayFreestyleNote =\n            this.player.options.placement !== '3d' ||\n            !this._isSandwiched(column)\n          if (shouldPlayFreestyleNote) {\n            this.notifications.sounds!.push({\n              note: freestyleNote,\n              type: 'free',\n            })\n          }\n        }\n      }\n    }\n  }\n\n  _getClosestNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => Math.abs(this._gameTime - note.time))\n  }\n\n  _getFreestyleNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => {\n      const distance = Math.abs(this._gameTime - note.time)\n      const penalty = this._gameTime < note.time - 1 ? 1000000 : 0\n      return distance + penalty\n    })\n  }\n\n  _isSandwiched(column: string) {\n    const mapping: { [col: string]: string[] } = {\n      '2': ['1', '3'],\n      '3': ['2', '4'],\n      '4': ['3', '5'],\n      '5': ['4', '6'],\n      '6': ['5', '7'],\n    }\n    if (!mapping[column]) return false\n    return mapping[column].every((adjacentColumn) => {\n      const buffer = this._noteBufferByColumn[adjacentColumn]\n      if (!buffer) return false\n      return buffer.notes.some(\n        (note) => Math.abs(this._gameTime - note.time) < 0.1\n      )\n    })\n  }\n\n  _shouldJudge(note: GameNote, control: Control, buffer: NoteBuffer) {\n    const status = this.getNoteStatus(note)\n    if (status === 'unjudged') {\n      if (this._shouldAutoplay() && this._gameTime >= note.time) {\n        this.tainted = true\n        return true\n      }\n      const judgment = judgeTime(this._gameTime, note.time, this._judge)\n      const missed = judgment === MISSED\n      let hit = judgment > 0 && control.changed && control.value\n      if (isBad(judgment) && this._getClosestNote(buffer.notes) !== note) {\n        hit = false\n      }\n      return missed || hit\n    } else if (status === 'active') {\n      const noteEnd = note.end || invariant(false, 'note.end must exist')\n      if (this._shouldAutoplay() && this._gameTime >= noteEnd.time) {\n        this.tainted = true\n        return true\n      }\n      const judgment = judgeEndTime(this._gameTime, noteEnd.time, this._judge)\n      const missed = judgment === MISSED\n      const lifted = control.changed\n      const scratch = note.column === 'SC'\n      const passed = this._gameTime >= noteEnd.time\n      return missed || lifted || (scratch && passed)\n    } else {\n      return false\n    }\n  }\n\n  _judgeNote(note: GameNote) {\n    let delta = this._gameTime - note.time\n    let judgment = judgeTime(this._gameTime, note.time, this._judge)\n    let result = this._noteResult.get(note)\n    const isDown = !result || result.status === 'unjudged'\n    const isUp = result && result.status === 'active'\n    if (this._shouldAutoplay() && judgment >= 1) {\n      judgment = 1\n    }\n    if (note.end) {\n      if (isDown) {\n        const status =\n          judgment === MISSED ? NoteStatus.Judged : NoteStatus.Active\n        if (judgment === MISSED) {\n          // judge missed long note twice\n          this._setJudgment(judgment, delta, note.column)\n        }\n        result = { status, judgment, delta }\n      } else if (isUp) {\n        const scratch = note.column === 'SC'\n        delta = this._gameTime - note.end.time\n        judgment =\n          judgeEndTime(this._gameTime, note.end.time, this._judge) || MISSED\n        if (scratch && delta > 0) judgment = 1\n        result = { status: NoteStatus.Judged, judgment, delta }\n      }\n    } else {\n      result = { status: NoteStatus.Judged, judgment, delta }\n    }\n    if (judgment === MISSED) {\n      this.notifications.sounds.push({ note, type: 'break' })\n    }\n    if (isDown && judgment !== MISSED) {\n      this.stats.handleDelta(delta)\n    }\n    if (!result) {\n      throw new Error('Invariant violation: result must not be undefined')\n    }\n    if (!judgment) {\n      throw new Error(\n        'Invariant violation: note should be judged by this point'\n      )\n    }\n    this._noteResult.set(note, result)\n    this._setJudgment(judgment, delta, note.column)\n    return judgment\n  }\n\n  _setJudgment(judgment: JudgedJudgment, delta: number, column: string) {\n    this.stats.handleJudgment(judgment)\n    const info = { judgment, combo: this.stats.combo, delta, column }\n    this.notifications.judgments.push(info)\n  }\n}\n\ntype NoteBuffer = {\n  notes: GameNote[]\n  startIndex: number\n  update: () => void\n}\n\nfunction isAutoplayEnabled() {\n  return !!(window as any).BEMUSE_AUTOPLAY\n}\n\nfunction noteBuffer(state: PlayerState) {\n  return function bufferNotes(notes: GameNote[]): NoteBuffer {\n    let startIndex = 0\n    return {\n      notes,\n      get startIndex() {\n        return startIndex\n      },\n      update() {\n        while (\n          startIndex < notes.length &&\n          state.getNoteStatus(notes[startIndex]) === 'judged'\n        ) {\n          startIndex += 1\n        }\n      },\n    }\n  }\n}\n\nexport default PlayerState\n","import * as Judgments from '../judgments'\n\nimport _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nconst getAccuracyScore = (accuracy: number) => Math.floor(accuracy * 500000)\nconst getComboScore = (sum: number, total: number) =>\n  Math.floor((sum * 55555) / total)\n\nexport class PlayerStats {\n  public totalCombo: number\n  public totalNotes: number\n  public combo: number\n  public maxCombo: number\n  public rawSumJudgmentWeight: number\n  public rawTotalComboScore: number\n  public rawSumComboScore: number\n  public counts: { [k in Judgments.JudgedJudgment]: number }\n  public numJudgments: number\n  public poor: boolean\n  public deltas: number[]\n\n  private _remainingMaxPossibleRawComboScore: number\n  private _log: { character: string; count: number }[]\n\n  constructor(notechart: Notechart) {\n    this.totalCombo = _(notechart.notes)\n      .map((note) => notechart.info(note)!.combos)\n      .sum()\n    this.totalNotes = notechart.notes.length\n    this.combo = 0\n    this.maxCombo = 0\n    this.rawSumJudgmentWeight = 0\n    this.rawTotalComboScore = this._calculateRawTotalComboScore(this.totalCombo)\n    this._remainingMaxPossibleRawComboScore = this.rawTotalComboScore\n    this.rawSumComboScore = 0\n    this.counts = { [Judgments.MISSED]: 0, '1': 0, '2': 0, '3': 0, '4': 0 }\n    this.numJudgments = 0\n    this.poor = false\n    this._log = []\n    this.deltas = []\n  }\n\n  get score() {\n    // #region score\n    return this.accuracyScore + this.comboScore\n    // #endregion\n  }\n\n  get accuracyScore() {\n    return getAccuracyScore(this.accuracy)\n  }\n\n  get comboScore() {\n    return getComboScore(this.rawSumComboScore, this.rawTotalComboScore)\n  }\n\n  get maxPossibleScore() {\n    return this.maxPossibleAccuracyScore + this.maxPossibleComboScore\n  }\n\n  get maxPossibleAccuracyScore() {\n    const remainingJudgments = this.totalCombo - this.numJudgments\n    const maxPossibleRawWeight =\n      this.rawSumJudgmentWeight + Judgments.weight(1) * remainingJudgments\n    const maxPossibleAccuracy =\n      maxPossibleRawWeight / (Judgments.weight(1) * this.totalCombo)\n    return getAccuracyScore(maxPossibleAccuracy)\n  }\n\n  get maxPossibleComboScore() {\n    const maxPossibleRawComboScore =\n      this.rawSumComboScore + this._remainingMaxPossibleRawComboScore\n    return getComboScore(maxPossibleRawComboScore, this.rawTotalComboScore)\n  }\n\n  get accuracy() {\n    return this.rawSumJudgmentWeight / (Judgments.weight(1) * this.totalCombo)\n  }\n\n  get currentAccuracy() {\n    return (\n      this.rawSumJudgmentWeight / (Judgments.weight(1) * this.numJudgments || 1)\n    )\n  }\n\n  get log() {\n    return this._log\n      .map(({ character, count }) => `${count > 1 ? count : ''}${character}`)\n      .join('')\n  }\n\n  handleJudgment(judgment: Judgments.JudgedJudgment) {\n    this.counts[judgment] += 1\n    this.numJudgments += 1\n    if (Judgments.breaksCombo(judgment)) {\n      const remainingJudgments = this.totalCombo - this.numJudgments\n      this.combo = 0\n      this.poor = true\n      this._remainingMaxPossibleRawComboScore =\n        this._calculateRawTotalComboScore(remainingJudgments)\n    } else {\n      this.combo += 1\n      const rawComboScore = this._calculateRawComboScore(this.combo)\n      this.rawSumComboScore += rawComboScore\n      this._remainingMaxPossibleRawComboScore -= rawComboScore\n      this.poor = false\n    }\n    this.rawSumJudgmentWeight += Judgments.weight(judgment)\n    if (this.combo > this.maxCombo) {\n      this.maxCombo = this.combo\n    }\n    this._recordLog(judgment)\n  }\n\n  handleDelta(delta: number) {\n    this.deltas.push(delta)\n  }\n\n  private _calculateRawTotalComboScore(total: number) {\n    let sum = 0\n    for (let i = 1; i <= total; i++) {\n      sum += this._calculateRawComboScore(i)\n    }\n    return sum\n  }\n\n  private _calculateRawComboScore(i: number) {\n    // #region combo\n    if (i === 0) return 0\n    if (i < 23) return 1\n    if (i < 51) return 2\n    if (i < 92) return 3\n    if (i < 161) return 4\n    return 5\n    // #endregion\n  }\n\n  private _recordLog(judgment: Judgments.JudgedJudgment) {\n    const character = this._getLogCharacter(judgment)\n    if (character) {\n      if (\n        this._log.length === 0 ||\n        this._log[this._log.length - 1].character !== character\n      ) {\n        this._log.push({ character, count: 1 })\n      } else {\n        this._log[this._log.length - 1].count += 1\n      }\n    }\n  }\n\n  private _getLogCharacter(judgment: Judgments.JudgedJudgment) {\n    switch (judgment) {\n      case 1:\n        return 'A'\n      case 2:\n        return 'B'\n      case 3:\n        return 'C'\n      case 4:\n        return 'D'\n      case Judgments.MISSED:\n        return 'M'\n    }\n  }\n}\n\nexport default PlayerStats\n","export function forModule(moduleName: string) {\n  return {\n    info: bindLogger(moduleName, 'info'),\n    warn: bindLogger(moduleName, 'warn'),\n    error: bindLogger(moduleName, 'error'),\n  }\n}\n\nfunction bindLogger(moduleName: string, level: 'info' | 'warn' | 'error') {\n  return (...args: any[]) => {\n    console.log(\n      `[${new Date().toJSON()}] [${moduleName}] [${level}] ${require('util').format(\n        ...args\n      )}`\n    )\n  }\n}\n","import _ from 'lodash'\n\nimport isChartPlayable from './isChartPlayable'\n\nexport function getPlayableCharts(charts) {\n  return _(charts)\n    .filter(isChartPlayable)\n    .orderBy([\n      (chart) => (chart.info.difficulty >= 5 ? 1 : 0),\n      (chart) => chart.keys,\n      (chart) => chart.info.level,\n    ])\n    .value()\n}\n\nexport default getPlayableCharts\n","import _ from 'lodash'\nimport { createHash } from 'crypto'\nimport { Song } from 'bemuse/collection-model/types'\n\nconst getHashFunction = _.once(() => {\n  const today = new Date(Date.now() + 9 * 3600e3).toISOString().split('T')[0]\n  return _.memoize((id: string) => {\n    const md5 = createHash('md5')\n    md5.update(id)\n    md5.update(today)\n    return md5.digest('hex')\n  })\n})\n\nexport class SongOfTheDay {\n  private ids: Set<string>\n  constructor(songs: Song[], { enabled = true } = {}) {\n    if (!enabled) {\n      this.ids = new Set()\n      return\n    }\n\n    const sorted = _.sortBy(\n      songs.filter((s) => !s.custom && !s.tutorial),\n      (s) => getHashFunction()(s.id)\n    )\n    this.ids = new Set(sorted.slice(0, 3).map((s) => s.id))\n  }\n\n  isSongOfTheDay(id: string) {\n    return this.ids.has(id)\n  }\n}\n","import _ from 'lodash'\nimport { SongOfTheDay } from './SongOfTheDay'\n\nconst grouping = [\n  { title: 'Custom Song', criteria: (song) => song.custom },\n  { title: 'Tutorial', criteria: (song) => song.tutorial },\n  { title: 'Unreleased', criteria: (song) => song.unreleased },\n  {\n    title: 'Recently Added Songs',\n    criteria: (song) =>\n      song.added && Date.now() - Date.parse(song.added) < 60 * 86400000,\n    sort: (song) => song.added,\n    reverse: true,\n  },\n  {\n    title: 'Random Songs of the Day',\n    criteria: (song, context) => context.songOfTheDay.isSongOfTheDay(song.id),\n  },\n  { title: '☆', criteria: () => true },\n]\n\nexport function groupSongsIntoCategories(\n  songs,\n  { songOfTheDayEnabled = false } = {}\n) {\n  const context = {\n    songOfTheDay: new SongOfTheDay(songs, { enabled: songOfTheDayEnabled }),\n  }\n  const groups = grouping.map((group) => ({\n    input: group,\n    output: { title: group.title, songs: [] },\n  }))\n  for (const song of songs) {\n    for (const { input, output } of groups) {\n      if (input.criteria(song, context)) {\n        output.songs.push(song)\n        break\n      }\n    }\n  }\n  for (const { input, output } of groups) {\n    if (input.sort) {\n      output.songs = _.orderBy(\n        output.songs,\n        [input.sort],\n        [input.reverse ? 'desc' : 'asc']\n      )\n    } else if (input.reverse) {\n      output.songs.reverse()\n    }\n  }\n  return _(groups)\n    .map('output')\n    .filter((group) => group.songs.length > 0)\n    .value()\n}\n\nexport default groupSongsIntoCategories\n","export const OFFICIAL_SERVER_URL = 'https://music4.bemuse.ninja/server'\n\nexport async function load(serverUrl, { fetch = global.fetch } = {}) {\n  const indexUrl = getServerIndexFileUrl(serverUrl)\n  const data = await fetch(indexUrl).then((response) => response.json())\n\n  if (Array.isArray(data.songs)) {\n    return data\n  } else if (Array.isArray(data.charts)) {\n    // Single-song server\n    const dir = indexUrl.replace(/[^/]*$/, '')\n    return { songs: [{ ...data, id: 'song', path: dir }] }\n  } else {\n    throw new Error(\n      `Invalid server file at ${indexUrl}: Does not contain \"songs\" array.`\n    )\n  }\n}\n\nexport function getServerIndexFileUrl(serverUrl) {\n  if (serverUrl.endsWith('/bemuse-song.json')) {\n    return serverUrl\n  }\n  return serverUrl.replace(/\\/(?:index\\.json)?$/, '') + '/index.json'\n}\n","export function isChartPlayable(chart) {\n  return chart.keys === '7K' || chart.keys === '5K'\n}\n\nexport default isChartPlayable\n","import produce from 'immer'\n\nexport const preprocessCollection = produce((draft, songs) => {\n  if (songs) {\n    draft.songs = songs.map((song) => preprocessSong(song))\n  }\n})\n\nfunction preprocessSong(song) {\n  if (song.chart_names) {\n    song = produce(song, (draft) => {\n      if (draft.charts) {\n        draft.charts = draft.charts.map((chart) => {\n          const name = song.chart_names[chart.file]\n          if (!name) return chart\n          return produce(chart, (draft) => {\n            draft.info = {\n              subtitles: (subtitles) => [...subtitles, name],\n            }\n          })\n        })\n      }\n    })\n  }\n  return song\n}\n\nexport default preprocessCollection\n","import _ from 'lodash'\nimport isChartPlayable from './isChartPlayable'\n\nexport function sortSongs(songs) {\n  return _.orderBy(songs, [\n    (song) => {\n      return _(song.charts)\n        .filter(isChartPlayable)\n        .filter((chart) => chart.info.difficulty < 5)\n        .filter((chart) => chart.info.level > 0)\n        .map((chart) => chart.info.level)\n        .min()\n    },\n    (song) => song.bpm,\n    (song) => song.title.toLowerCase(),\n  ])\n}\n\nexport default sortSongs\n","export class AxisLogic {\n  private stop = 1\n  private charge = 0\n  private previous: false | number = false\n  private active = false\n  private positive = false\n\n  public update(axis: number, threshold: number = 3) {\n    if (this.previous === false) {\n      this.previous = axis\n      return 0\n    }\n\n    if (this.previous !== axis) {\n      let delta = axis - this.previous\n      if (delta > 1) {\n        delta -= 2 + 0.005\n      } else if (delta < -1) {\n        delta += 2 + 0.005\n      }\n\n      const immediateOutput = delta > 0\n\n      if (this.active && this.positive !== immediateOutput) {\n        this.positive = immediateOutput\n        this.active = false\n        this.charge = 0\n      } else if (!this.active) {\n        if (this.charge === 0 || this.stop <= threshold) {\n          this.charge += Math.ceil(Math.abs(delta) / 0.01)\n        }\n\n        if (this.charge >= 2) {\n          this.active = true\n          this.positive = immediateOutput\n        }\n      }\n\n      this.stop = 0\n      this.previous = axis\n    }\n\n    if (this.stop > threshold * 2) {\n      this.active = false\n      this.charge = 0\n      this.stop = 0\n    }\n\n    this.stop += 1\n\n    return this.active ? (this.positive ? 1 : -1) : 0\n  }\n}\n","import {\n  EMPTY,\n  Observable,\n  catchError,\n  concatMap,\n  from,\n  fromEvent,\n  tap,\n} from 'rxjs'\n\nimport { EventListenerObject } from 'rxjs/internal/observable/fromEvent'\n\ndeclare global {\n  interface Navigator {\n    requestMIDIAccess?(options?: MIDIAccessOptions): Promise<MIDIAccess>\n  }\n\n  interface MIDIAccessOptions {\n    sysex: boolean\n    software: boolean\n  }\n\n  interface MIDIAccess {\n    readonly inputs: Map<string, MIDIInput>\n    readonly outputs: Map<string, MIDIOutput>\n    onstatechange: (event: MIDIConnectEvent) => void\n  }\n  interface MIDIInput extends MIDIPort {\n    type: 'input'\n\n    addEventListener(\n      type: 'midimessage',\n      listener:\n        | ((evt: MIDIMessageEvent) => void)\n        | EventListenerObject<MIDIMessageEvent>\n        | null,\n      options?: boolean | AddEventListenerOptions\n    ): void\n    removeEventListener(\n      type: 'midimessage',\n      listener:\n        | ((evt: MIDIMessageEvent) => void)\n        | EventListenerObject<MIDIMessageEvent>\n        | null,\n      options?: EventListenerOptions | boolean\n    ): void\n  }\n  interface MIDIOutput extends MIDIPort {\n    type: 'output'\n  }\n  interface MIDIPort {\n    type: 'input' | 'output'\n    id: string\n  }\n  interface MIDIConnectEvent {\n    readonly port: MIDIPort\n  }\n\n  interface MIDIMessageEvent {\n    readonly data: Uint8Array\n    readonly target: MIDIPort | null\n  }\n}\n\nfunction observeMidiAccess(access: MIDIAccess) {\n  return new Observable<MIDIPort>((subscriber) => {\n    for (const port of access.inputs.values()) {\n      subscriber.next(port)\n    }\n    for (const port of access.outputs.values()) {\n      subscriber.next(port)\n    }\n    access.onstatechange = (e) => {\n      subscriber.next(e.port)\n    }\n  })\n}\n\nfunction requestMIDIAccess() {\n  if (!navigator.requestMIDIAccess) {\n    return Promise.reject(new Error('MIDI is not supported'))\n  }\n  return navigator.requestMIDIAccess()\n}\n\nexport function getMidi川(): Observable<MIDIMessageEvent> {\n  return from(requestMIDIAccess())\n    .pipe(concatMap(observeMidiAccess))\n    .pipe(\n      catchError((e: Error) => {\n        console.warn('MIDI Error:', e.stack)\n        return EMPTY\n      })\n    )\n    .pipe(concatMap(message川ForPort))\n    .pipe(tap((message) => console.log('messageforport', message)))\n}\n\nfunction message川ForPort(port: MIDIPort): Observable<MIDIMessageEvent> {\n  if (port.type !== 'input') return EMPTY\n  return fromEvent<MIDIMessageEvent>(port as MIDIInput, 'midimessage')\n}\n\nexport default getMidi川\n","import {\n  Observable,\n  Subscription,\n  concat,\n  concatMap,\n  fromEvent,\n  map,\n  of,\n  pairwise,\n} from 'rxjs'\n\nimport { AxisLogic } from './axis-logic'\nimport _ from 'lodash'\nimport getMidi川 from './midi'\nimport keycode from 'keycode'\n\ndeclare global {\n  interface Navigator {\n    webkitGetGamepads?(): (Gamepad | null)[]\n  }\n}\n\nexport interface OmniInputOptions {\n  getMidi川?: () => Observable<MIDIMessageEvent>\n  exclusive?: boolean\n  continuous?: boolean\n  sensitivity?: number\n}\n\nexport type KeyState = Record<string, boolean>\n\n// Public: OmniInput is a poll-based class that handles the key-pressed state of\n// multiple inputs.\n//\n// Each call to `update()` returns a mapping of active inputs. This object may\n// be reused and mutated by OmniInput for performance reasons, and thus the\n// caller SHOULD NOT hold on to or mutate it.\n//\n// ## Keys\n//\n// The key is a string that identifies some key on each input.\n// It follows the following convention:\n//\n// - `65` A keyboard keycode.\n// - `gamepad.0.button.3` A gamepad button.\n// - `gamepad.0.axis.3.positive` A gamepad axis (positive value).\n// - `gamepad.0.axis.3.negative` A gamepad axis (negative value).\n// - `midi.[id].[channel].note.[note]` A MIDI note.\n// - `midi.[id].[channel].sustain` Sustain pedal.\n// - `midi.[id].[channel].mod` Modulation level.\n// - `midi.[id].[channel].pitch.up` Pitch bend (up).\n// - `midi.[id].[channel].pitch.down` Pitch bend (down).\n//\nexport class OmniInput {\n  constructor(\n    private readonly win: Window = window,\n    options: OmniInputOptions = {}\n  ) {\n    const midi川 = (options.getMidi川 || getMidi川)()\n    this.exclusive = !!options.exclusive\n    this.continuousAxis = !!options.continuous\n    this.setGamepadSensitivity(options.sensitivity ?? 3)\n\n    this.subscriptions = [\n      fromEvent<KeyboardEvent>(win, 'keydown').subscribe(this.handleKeyDown),\n      fromEvent<KeyboardEvent>(win, 'keyup').subscribe(this.handleKeyUp),\n      midi川.subscribe(this.handleMIDIMessage),\n    ]\n  }\n\n  private readonly exclusive: boolean\n  private continuousAxis: boolean\n  private sensitivity: number = 0\n  analogThreshold: number = 0\n  private deadzone: number = 0\n  private status: KeyState = {}\n  private axis: Record<string, AxisLogic> = {}\n\n  private readonly subscriptions: readonly Subscription[]\n\n  // TODO: `which` should be replaced with `KeyboardEvent.code`, but this migration will affects the system entirely.\n  private handleKeyDown = (e: KeyboardEvent) => {\n    this.status[`${e.which}`] = true\n    if (this.exclusive) e.preventDefault()\n  }\n\n  private handleKeyUp = (e: KeyboardEvent) => {\n    this.status[`${e.which}`] = false\n  }\n\n  private handleMIDIMessage = (e: MIDIMessageEvent) => {\n    if (!e || !e.data) return\n    const data = e.data\n    const prefix = `midi.${e.target?.id}.${e.data[0] & 0x0f}`\n    const handleNote = (state: boolean) => {\n      this.status[`${prefix}.note.${data[1]}`] = state\n    }\n    if ((data[0] & 0xf0) === 0x80) {\n      // NoteOff\n      handleNote(false)\n    } else if ((data[0] & 0xf0) === 0x90) {\n      // NoteOn\n      if (data[2] > 0x0) {\n        // NoteOn (really)\n        handleNote(true)\n      } else {\n        // NoteOff disguised as NoteOn\n        handleNote(false)\n      }\n    } else if ((data[0] & 0xf0) === 0xb0) {\n      // CC\n      if (data[1] === 0x40) {\n        // Sustain\n        this.status[`${prefix}.sustain`] = data[2] >= 64\n      } else if (data[1] === 0x01) {\n        // Modulation\n        this.status[`${prefix}.mod`] = data[2] >= 16\n      }\n    } else if ((data[0] & 0xf0) === 0xe0) {\n      // Pitch Bend\n      const bend = data[1] | (data[2] << 7)\n      this.status[`${prefix}.pitch.up`] = bend >= 0x2100\n      this.status[`${prefix}.pitch.down`] = bend < 0x1f00\n    }\n  }\n\n  private updateGamepads() {\n    const nav = this.win.navigator\n    const gamepads = this.fetchGamepads(nav)\n    if (!gamepads) return\n    for (const gamepad of gamepads) {\n      if (gamepad) {\n        this.updateGamepad(gamepad)\n      }\n    }\n  }\n\n  private fetchGamepads(nav: Navigator) {\n    if (nav.getGamepads) {\n      return nav.getGamepads()\n    }\n    if (nav.webkitGetGamepads) {\n      return nav.webkitGetGamepads()\n    }\n    return []\n  }\n\n  private updateGamepad(gamepad: Gamepad) {\n    const prefix = `gamepad.${gamepad.index}`\n    for (let i = 0; i < gamepad.buttons.length; i++) {\n      const button = gamepad.buttons[i]\n      this.status[`${prefix}.button.${i}`] = button && button.value >= 0.5\n    }\n    for (let i = 0; i < gamepad.axes.length; i++) {\n      const axisName = `${prefix}.axis.${i}`\n      let axis = gamepad.axes[i]\n\n      if (this.continuousAxis) {\n        if (this.axis[axisName] == null) {\n          this.axis[axisName] = new AxisLogic()\n        }\n        axis = this.axis[axisName].update(axis)\n      }\n\n      this.status[`${axisName}.positive`] = axis >= this.deadzone\n      this.status[`${axisName}.negative`] = axis <= -this.deadzone\n    }\n  }\n\n  update(): KeyState {\n    this.updateGamepads()\n    return this.status\n  }\n\n  setGamepadSensitivity(sensitivity: number) {\n    this.sensitivity = sensitivity\n    this.deadzone = (9 - this.sensitivity) * 0.05\n    if (this.deadzone < 0.01) this.deadzone = 0.01\n    this.analogThreshold = 18 - this.sensitivity * 2\n  }\n\n  setGamepadContinuousAxisEnabled(enabled: boolean) {\n    this.continuousAxis = enabled\n  }\n\n  dispose() {\n    for (const subscription of this.subscriptions) {\n      subscription.unsubscribe()\n    }\n  }\n}\n\n// Public: Returns a Bacon EventStream of keys pressed.\n//\nexport function key川(\n  input = new OmniInput(),\n  win: Window = window\n): Observable<string> {\n  return _key川ForUpdate川(\n    new Observable<KeyState>((subscriber) => {\n      const handle = win.setInterval(() => {\n        subscriber.next(input.update())\n      }, 16)\n      return () => win.clearInterval(handle)\n    })\n  )\n}\n\nexport function _key川ForUpdate川(\n  update川: Observable<KeyState>\n): Observable<string> {\n  return concat(\n    of<string[]>([]),\n    update川.pipe(\n      map((update) => Object.keys(update).filter((key) => update[key]))\n    )\n  )\n    .pipe(pairwise())\n    .pipe(map(([previous, current]) => _.difference(current, previous)))\n    .pipe(concatMap((array) => of(...array)))\n}\n\nexport default OmniInput\n\nconst knownMidiIds = new Map<string, number>()\n\nexport function getName(key: string) {\n  if (+key) {\n    return _.capitalize(keycode(+key))\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.axis\\.(\\d+)\\.(\\w+)/)\n    if (match) {\n      return `Joy${match[1]} Axis${match[2]} (${\n        match[3] === 'positive' ? '+' : '-'\n      })`\n    }\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.button\\.(\\d+)/)\n    if (match) {\n      return `Joy${match[1]} Btn${match[2]}`\n    }\n  }\n  {\n    const match = key.match(/^midi\\.(.+)\\.(\\d+)\\.(.+)$/)\n    if (match) {\n      const rest = match[3].split('.')\n      const id = match[1]\n      if (!knownMidiIds.has(id)) {\n        knownMidiIds.set(id, knownMidiIds.size + 1)\n      }\n      const midiDeviceNumber = knownMidiIds.get(id)!\n      const prefix = `MIDI${midiDeviceNumber} Ch${+match[2] + 1}`\n      if (rest[0] === 'note') {\n        const midiNote = +rest[1]\n        const lookup = [\n          'C',\n          'C#',\n          'D',\n          'D#',\n          'E',\n          'F',\n          'F#',\n          'G',\n          'G#',\n          'A',\n          'A#',\n          'B',\n        ]\n        const noteName = lookup[midiNote % 12]\n        const octave = Math.floor(midiNote / 12) - 1\n        return `${prefix} ${noteName}${octave}`\n      }\n      if (rest[0] === 'pitch') {\n        return `${prefix} Pitch${rest[1] === 'up' ? '+' : '-'}`\n      }\n      if (rest[0] === 'sustain') return 'Sustain'\n      if (rest[0] === 'mod') return 'Mod'\n    }\n  }\n  return `${String(key).replace(/\\./g, ' ')}?`\n}\n","import Observable from 'bemuse/utils/observable'\n\ninterface IProgressFormatter {\n  (progress: Progress): string\n}\n\n/**\n * The Progress class represents the progress of an asynchronous operation.\n * It is inspired by C#'s IProgress interface.\n *\n * See: http://blogs.msdn.com/b/dotnet/archive/2012/06/06/async-in-4-5-enabling-progress-and-cancellation-in-async-apis.aspx\n */\nexport class Progress {\n  /** The current progress (out of `Progress#total`). */\n  public current: number | undefined = undefined\n  /** Total progress value */\n  public total: number | undefined = undefined\n  /** Some arbitrary information associated with this Progress. */\n  public extra: any\n  /**\n   * The formatter of this progress. This formatter will be used to compute\n   * the text representation of this progress (`Progress#toString`).\n   */\n  public formatter?: IProgressFormatter\n  private _observable = new Observable<void>()\n  /**\n   * Updates the progress.\n   */\n  report(current: number, total: number, extra?: any) {\n    this.current = current\n    this.total = total\n    this.extra = extra\n    this._observable.notify()\n  }\n\n  /**\n   * Attaches a progress listener function to this progress.\n   * The function `f` will be called immediately and synchronously upon watching,\n   * and will be called when the progress value is updated.\n   * @param f\n   * @returns a function that, when called, unsubscribes this listener.\n   */\n  watch(f: (progress: Progress) => void) {\n    f(this)\n    return this._observable.watch(() => f(this))\n  }\n\n  /**\n   * The current progress as a fraction (out of 1).\n   */\n  get progress() {\n    if (this.total && this.current !== undefined && this.current !== null) {\n      return this.current / this.total\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * Returns a string representation of this progress instance.\n   * This method is used for displaying the progress as a text.\n   */\n  toString() {\n    if (this.formatter !== undefined) {\n      return this.formatter(this)\n    } else if (this.progress !== null) {\n      return this.current + ' / ' + this.total\n    } else {\n      return ''\n    }\n  }\n}\n","import bytes from 'bytes'\n\nconst wrap = (f) => (progress) => progress.progress !== null ? f(progress) : ''\n\n// Formats the `Progress` as bytes (e.g. 1.23mb of 1.31mb).\nexport const BYTES_FORMATTER = wrap(\n  (progress) => bytes(progress.current) + ' / ' + bytes(progress.total)\n)\n\n// Formats the `Progress` as percentage.\nexport const PERCENTAGE_FORMATTER = wrap(\n  (progress) => ((progress.current / progress.total) * 100).toFixed(1) + '%'\n)\n\n// Formats the `Progress` simply by using the value of `Progress#extra`.\nexport const EXTRA_FORMATTER = wrap((progress) => progress.extra + '')\n","// !! avoid external dependencies since this is used in boot script!\n\nimport { Progress } from './Progress'\nexport default Progress\n","import { BYTES_FORMATTER } from 'bemuse/progress/formatters'\nimport { Progress } from './Progress'\n\n/**\n * Returns a callback that, when called,\n * update the progress with increasing `current` value,\n * out of a fixed `total`.\n */\nexport function fixed(total: number, progress: Progress) {\n  if (!progress) return () => {}\n  let loaded = 0\n  progress.report(0, total)\n  return (extra: any) => progress.report(++loaded, total, extra)\n}\n\n/**\n * Updates the progress with the result of an atomic operation.\n */\nexport async function atomic<T>(\n  progress: Progress,\n  promise: PromiseLike<T>\n): Promise<T> {\n  if (!progress) return promise\n  const data = await Promise.resolve(promise)\n  if (hasByteLength(data)) {\n    progress.formatter = BYTES_FORMATTER\n    progress.report(data.byteLength, data.byteLength)\n  } else {\n    progress.report(1, 1)\n  }\n  return data\n}\nfunction hasByteLength(data: any): data is { byteLength: number } {\n  return data && data.byteLength\n}\n\n/**\n * Wraps an async function that may be called multiple times.\n * Each call adds to the total, and each async resolution adds to current.\n */\nexport function wrapPromise<A extends any[], R>(\n  progress: Progress,\n  f: (...args: A) => PromiseLike<R>\n): (...args: A) => PromiseLike<R> {\n  let current = 0\n  let total = 0\n  return async function (this: any, ...args: A) {\n    progress.report(current, ++total)\n    const ret = await f.apply(this, args)\n    progress.report(++current, total)\n    return ret\n  }\n}\n\nexport function bind(from: Progress, to: Progress) {\n  return from.watch(() => to.report(from.current!, from.total!, from.extra))\n}\n\n/**\n * Updates the `target` with progress data from multiple sources.\n */\nexport function simultaneous(target: Progress) {\n  const queue: Progress[] = []\n  let current: Progress | undefined\n  let unsubscribe: (() => void) | null = null\n  function update() {\n    if (current) {\n      target.report(current.current!, current.total!, current.extra)\n    }\n    if (queue.length > 0 && (!current || current.progress! >= 1)) {\n      bind(queue.shift()!)\n    }\n  }\n  function bind(progress: Progress) {\n    if (current === progress) {\n      return\n    }\n    if (unsubscribe) {\n      unsubscribe()\n      unsubscribe = null\n    }\n    current = progress\n    if (current) {\n      unsubscribe = current.watch(update)\n    }\n  }\n  return {\n    add(progress: Progress) {\n      queue.push(progress)\n      update()\n    },\n  }\n}\n","export function addUnprefixed(\n  prefix: string,\n  name: string,\n  callback: (path: string) => void\n) {\n  if (name.match(/\\.(?:bms|bme|bml|bmson)/i)) {\n    callback(name)\n    return\n  }\n  const parts = (prefix + name).split('/')\n  for (let i = 0; i < parts.length; i++) {\n    callback(parts.slice(i).join('/'))\n  }\n}\n","import { LoggingFunction } from './types'\n\nexport default class ResourceLogging {\n  private buffer: string[] | null = []\n  private loggingFunction: LoggingFunction = (text) => {\n    if (this.buffer) this.buffer.push(text)\n  }\n\n  public log: LoggingFunction = (text) => {\n    this.loggingFunction(text)\n  }\n\n  setLoggingFunction = (fn: LoggingFunction) => {\n    this.loggingFunction = fn\n    if (this.buffer) {\n      this.buffer.forEach((text) => fn(text))\n      this.buffer = null\n    }\n  }\n}\n","import { Archive } from 'libarchive.js/main.js'\nimport { addUnprefixed } from './addUnprefixed'\nimport { FileEntry } from './types'\n\nArchive.init({\n  workerUrl: '/vendor/libarchive.js-1.3.0/dist/worker-bundle.js',\n})\n\nexport async function unarchive(file: File): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const archive = await Archive.open(file)\n  const extracted = await archive.extractFiles()\n  const traverse = (tree: any, prefix = '') => {\n    for (const key of Object.keys(tree)) {\n      if (tree[key] instanceof File) {\n        addUnprefixed(prefix, key, (name) => {\n          out.push({ name, file: tree[key] })\n        })\n      } else if (tree[key] && typeof tree[key] === 'object') {\n        traverse(tree[key], prefix + key + '/')\n      }\n    }\n  }\n  traverse(extracted)\n  return out\n}\n","import * as ProgressUtils from 'bemuse/progress/utils'\nimport {\n  FileEntry,\n  LoggingFunction,\n  IResource,\n  ICustomSongResources,\n} from './types'\nimport ResourceLogging from './resource-logging'\nimport { unarchive } from './unarchiver'\nimport readBlob from 'bemuse/utils/read-blob'\nimport Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\n\nexport const ARCHIVE_REGEXP = /\\.(?:zip|rar|7z|tar(?:\\.(?:gz|bz2))?)/i\n\n// http://nekokan.dyndns.info/tool/DropboxReplacer/index.html\nconst DROPBOX_REGEXP =\n  /https?:\\/\\/(?:(?:www|dl)\\.dropbox\\.com|dl\\.dropboxusercontent\\.com)\\/(sh?)\\/([^?]*)(.*)?$/\n\n/**\n * A resource provider for custom songs.\n * It may retrieve the files from, e.g., a drag and drop event or an `?archive` flag.\n */\nexport interface CustomResourceProvider {\n  getFiles(loggingFunction: LoggingFunction): PromiseLike<FileEntry[]>\n}\n\n/**\n * An IResources for songs provided by a CustomResourceProvider.\n */\nexport class CustomSongResources implements ICustomSongResources {\n  private _logging = new ResourceLogging()\n  private _files: PromiseLike<FileEntry[]>\n  public setLoggingFunction = this._logging.setLoggingFunction\n\n  constructor(provider: CustomResourceProvider) {\n    this._files = Promise.resolve(provider.getFiles(this._logging.log)).then(\n      (files) => unarchiveIfNeeded(files, this._logging.log)\n    )\n  }\n\n  file(name: string) {\n    return this._files.then(function (files) {\n      for (const file of files) {\n        if (file.name.toLowerCase() === name.toLowerCase()) {\n          return new FileResource(file.file)\n        }\n      }\n      throw new Error('unable to find ' + name)\n    })\n  }\n\n  get fileList(): Promise<string[]> {\n    return Promise.resolve(this._files).then((a) => a.map((f) => f.name))\n  }\n}\n\nexport class FileResource implements IResource {\n  constructor(private _file: File) {}\n  read(progress: Progress) {\n    return ProgressUtils.atomic(\n      progress,\n      readBlob(this._file).as('arraybuffer')\n    )\n  }\n\n  resolveUrl() {\n    return Promise.resolve(URL.createObjectURL(this._file))\n  }\n\n  get name() {\n    return this._file.name\n  }\n}\n\n/**\n * If only 1 FileEntry is present and it is an archive file, extract it.\n */\nexport async function unarchiveIfNeeded(\n  files: FileEntry[],\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  if (files.length !== 1) return files\n  const fileEntry = files[0]\n  if (!fileEntry.name.match(ARCHIVE_REGEXP)) {\n    return files\n  }\n  log('Archive file detected! Now unarchiving…')\n  return unarchive(fileEntry.file)\n}\n\n/**\n * Downloads a URL as a FileEntry.\n */\nexport async function downloadFileEntryFromURL(\n  url: string,\n  log: LoggingFunction\n): Promise<FileEntry> {\n  const name = url\n    .replace(/[?#].*/, '')\n    .split('/')\n    .pop()!\n\n  // Try Dropbox URL replacement\n  const match = url.match(DROPBOX_REGEXP)\n  if (match) {\n    url = `https://dl.dropboxusercontent.com/${match[1]}/${match[2]}`\n  }\n\n  const progress = new Progress()\n  let lastTime = 0\n  progress.watch(() => {\n    if (Date.now() < lastTime + 5e3) return\n    log(`Downloading: ${progress}`)\n    lastTime = Date.now()\n  })\n  const blob = await download(url).as('blob', progress)\n  return { name, file: blob }\n}\n","import Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\nimport { basename } from 'path'\nimport { IResource, IResources } from './types'\n\nexport class URLResource implements IResource {\n  constructor(private url: string) {}\n  read(progress: Progress) {\n    return download(this.url).as('arraybuffer', progress)\n  }\n\n  async resolveUrl() {\n    return Promise.resolve(this.url)\n  }\n\n  get name() {\n    return basename(this.url)\n  }\n}\n\nexport class URLResources implements IResources {\n  constructor(public base: URL) {}\n  async file(name: string): Promise<IResource> {\n    const path = name\n      .split('/')\n      .map((part) => encodeURIComponent(part))\n      .join('/')\n    return new URLResource(new URL(path, this.base).href)\n  }\n}\n\nexport default URLResource\n","// !! avoid external dependencies since this is used in boot script!\n\ntype CallbackEffect<T extends any[]> = (...args: T) => void\n\n/**\n * A utility class to hold a collection of callbacks.\n */\nexport class Callbacks<T extends any[]> {\n  private _callbacks: { [id: number]: CallbackEffect<T> } = {}\n  private _nextId = 1\n  constructor(init?: CallbackEffect<T>[] | CallbackEffect<T>) {\n    if (typeof init === 'function') {\n      this.add(init)\n    } else if (typeof init === 'object' && init && init.length) {\n      for (let i = 0; i < init.length; i++) this.add(init[i])\n    }\n  }\n\n  /**\n   * Calls all the callbacks.\n   */\n  call(...args: T) {\n    const callbacks = this._callbacks\n    for (const id in callbacks) {\n      callbacks[id](...args)\n    }\n  }\n\n  /**\n   * Adds a `callback` Function to this Callbacks collection.\n   * Returns a function that, when invoked, removes the inserted `callback` from the collection.\n   */\n  add(callback: CallbackEffect<T>) {\n    const id = this._nextId++\n    this._callbacks[id] = callback\n    return () => delete this._callbacks[id]\n  }\n}\n\nexport default Callbacks\n","import delay from 'delay'\nimport { BYTES_FORMATTER } from 'bemuse/progress/formatters'\n\n// Downloads the file from the URL.\n// The download will not actually be started unless the ``as()`` method\n// is called.\n//\n// .. js:function:: as(type)\n//\n//    Initiates the download as ``type``. The ``type`` is a string such as\n//    \"arraybuffer\" or \"blob\".\nexport function download(\n  url,\n  { getRetryDelay = () => 1000 + Math.random() * 4000 } = {}\n) {\n  return {\n    async as(type, progress) {\n      let shouldGiveUp = false\n      for (let i = 1; ; i++) {\n        try {\n          return await attempt()\n        } catch (error) {\n          console.error(`Unable to download ${url} [attempt ${i}]`, error)\n          if (i >= 3 || shouldGiveUp) throw error\n          const waitMs = getRetryDelay()\n          await delay(waitMs)\n        }\n      }\n      function attempt() {\n        return new Promise((resolve, reject) => {\n          const xh = new XMLHttpRequest()\n          xh.open('GET', url, true)\n          xh.responseType = type\n          xh.onload = () => {\n            if (+xh.status === 200) {\n              resolve(xh.response)\n            } else {\n              if (+xh.status === 403 || +xh.status === 404) {\n                shouldGiveUp = true\n              }\n              reject(new Error(`Unable to download ${url}: HTTP ${xh.status}`))\n            }\n          }\n          xh.onerror = () => reject(new Error(`Unable to download ${url}`))\n          if (progress) {\n            progress.formatter = BYTES_FORMATTER\n            xh.onprogress = (e) => progress.report(e.loaded, e.total)\n          }\n          xh.send(null)\n        })\n      }\n    },\n  }\n}\n\nexport default download\n","export function formatTime(seconds) {\n  const s = Math.floor(seconds % 60)\n  return Math.floor(seconds / 60) + ':' + (s < 10 ? '0' : '') + s\n}\n\nexport default formatTime\n","// :doc:\n//\n// High-accuracy timer, optionally synchronized globally.\n\nimport sync from 'timesynchro'\nconst Log = BemuseLogger.forModule('timesynchro')\n\nlet offset = 0\n\nfunction now() {\n  if (window.performance && typeof window.performance.now === 'function') {\n    return window.performance.now()\n  } else {\n    return Date.now()\n  }\n}\n\nnow.synchronize = function (server: string) {\n  sync(server, onFinish, onResult)\n  function onResult(result: number) {\n    // result + Date.now() = real time = now() + offset\n    // result + Date.now() = now() + offset\n    // offset = result + Date.now() - now()\n    offset = result + Date.now() - now()\n  }\n  function onFinish(err: Error | null, result?: number) {\n    if (err) {\n      Log.error('Cannot synchronize time: ' + err)\n    } else {\n      onResult(result!)\n      Log.info('Synchronized time with global server! Offset = ' + offset)\n    }\n  }\n}\nnow.synchronized = function () {\n  const o = offset\n  return () => now() + o\n}\nexport { now }\nexport default now\n","// !! avoid external dependencies since this is used in boot script!\n\nimport Callbacks from 'bemuse/utils/callbacks'\n\nexport class Observable<T> {\n  private _callbacks = new Callbacks<[T]>()\n  private _value?: T\n  constructor(value?: T) {\n    this._value = value\n  }\n\n  get value() {\n    return this._value\n  }\n\n  set value(value) {\n    this._value = value\n    this.notify(value!)\n  }\n\n  notify(value: T) {\n    this._callbacks.call(value)\n  }\n\n  watch(f: (value: T) => void) {\n    if (this._value !== undefined) f(this._value)\n    return this._callbacks.add(f)\n  }\n}\n\nexport default Observable\n","export default readBlob\n\n// Reads the blob as a specified type. The blob will not actually be read\n// unless the ``as()`` method is called.\n//\n// .. js:function:: as(type)\n//\n//    Starts reading the blob as ``type``. The ``type`` is a String such as\n//    \"arraybuffer\" or \"text\".\nexport function readBlob(blob) {\n  return {\n    as(type) {\n      return new Promise(function (resolve, reject) {\n        const reader = new FileReader()\n        reader.onload = function () {\n          resolve(reader.result)\n        }\n        reader.onerror = function () {\n          reject(new Error('Unable to read from Blob'))\n        }\n        switch (type) {\n          case 'arraybuffer':\n            reader.readAsArrayBuffer(blob)\n            break\n          case 'text':\n            reader.readAsText(blob)\n            break\n        }\n      })\n    },\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notechart = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar invariant_1 = __importDefault(require(\"invariant\"));\n__exportStar(require(\"./types\"), exports);\n/**\n * A notechart holds every info about a single player's note chart that the\n * game will ever need.\n */\nvar Notechart = /** @class */ (function () {\n    function Notechart(data, playerOptions) {\n        if (playerOptions === void 0) { playerOptions = {}; }\n        var _this = this;\n        var bmsNotes = data.notes, timing = data.timing, keysounds = data.keysounds, songInfo = data.songInfo, positioning = data.positioning, spacing = data.spacing, barLines = data.barLines, images = data.images, expertJudgmentWindow = data.expertJudgmentWindow, _a = data.landmineNotes, landmineNotes = _a === void 0 ? [] : _a;\n        (0, invariant_1.default)(bmsNotes, 'Expected \"data.notes\"');\n        (0, invariant_1.default)(timing, 'Expected \"data.timing\"');\n        (0, invariant_1.default)(keysounds, 'Expected \"data.keysounds\"');\n        (0, invariant_1.default)(songInfo, 'Expected \"data.songInfo\"');\n        (0, invariant_1.default)(positioning, 'Expected \"data.positioning\"');\n        (0, invariant_1.default)(spacing, 'Expected \"data.spacing\"');\n        (0, invariant_1.default)(barLines, 'Expected \"data.barLines\"');\n        this.expertJudgmentWindow = expertJudgmentWindow;\n        bmsNotes = this._preTransform(bmsNotes, playerOptions);\n        this._timing = timing;\n        this._positioning = positioning;\n        this._spacing = spacing;\n        this._keysounds = keysounds;\n        this._duration = 0;\n        this._notes = this._generatePlayableNotesFromBMS(bmsNotes);\n        this._landmines = this._generatePlayableNotesFromBMS(landmineNotes);\n        this._autos = this._generateAutoKeysoundEventsFromBMS(bmsNotes);\n        this._barLines = this._generateBarLineEvents(barLines);\n        this._samples = this._generateKeysoundFiles(keysounds);\n        this._infos = new Map(this._notes.map(function (note) { return [note, _this._getNoteInfo(note)]; }));\n        this._songInfo = songInfo;\n        this._images = images;\n    }\n    Object.defineProperty(Notechart.prototype, \"notes\", {\n        /**\n         * An Array of note events.\n         */\n        get: function () {\n            return this._notes;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"landmines\", {\n        /**\n         * An Array of landmines events.\n         */\n        get: function () {\n            return this._landmines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"autos\", {\n        /**\n         * An Array of auto-keysound events.\n         */\n        get: function () {\n            return this._autos;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"samples\", {\n        /**\n         * An Array of all the sample files to use.\n         */\n        get: function () {\n            return this._samples;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"keysounds\", {\n        /**\n         * An Object containing the mapping from keysound ID to keysound filename.\n         */\n        get: function () {\n            return this._keysounds.all();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"barLines\", {\n        /**\n         * An Object representing the bar line events.\n         */\n        get: function () {\n            return this._barLines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"columns\", {\n        /**\n         * An Array of all column names in this notechart.\n         */\n        get: function () {\n            return ['SC', '1', '2', '3', '4', '5', '6', '7'];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"duration\", {\n        /**\n         * Notechart's duration (time of last event)\n         */\n        get: function () {\n            return this._duration;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"songInfo\", {\n        /**\n         * Notechart's song info\n         */\n        get: function () {\n            return this._songInfo;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"eyecatchImage\", {\n        /**\n         * Eyecatch image\n         */\n        get: function () {\n            return (this._images && this._images.eyecatch) || 'eyecatch_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"backgroundImage\", {\n        /**\n         * Background image\n         */\n        get: function () {\n            return (this._images && this._images.background) || 'back_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the characteristic of the note as an Object.\n     */\n    Notechart.prototype.info = function (note) {\n        return this._infos.get(note);\n    };\n    /**\n     * Converts the beat number to in-song position (seconds)\n     */\n    Notechart.prototype.beatToSeconds = function (beat) {\n        return this._timing.beatToSeconds(beat);\n    };\n    /**\n     * Converts the beat number to in-game position.\n     */\n    Notechart.prototype.beatToPosition = function (beat) {\n        return this._positioning.position(beat);\n    };\n    /**\n     * Converts measure number to beat.\n     */\n    Notechart.prototype.measureToBeat = function (measure) {\n        return (this._barLines[measure] || this._barLines[this._barLines.length - 1]).beat;\n    };\n    /**\n     * Converts the in-song position to beat number.\n     */\n    Notechart.prototype.secondsToBeat = function (seconds) {\n        return this._timing.secondsToBeat(seconds);\n    };\n    /**\n     * Converts the in-song position to in-game position.\n     */\n    Notechart.prototype.secondsToPosition = function (seconds) {\n        return this.beatToPosition(this.secondsToBeat(seconds));\n    };\n    /**\n     * Finds BPM at the specified beat.\n     */\n    Notechart.prototype.bpmAtBeat = function (beat) {\n        return this._timing.bpmAtBeat(beat);\n    };\n    /**\n     * Finds the scrolling speed at the specified beat.\n     */\n    Notechart.prototype.scrollSpeedAtBeat = function (beat) {\n        return this._positioning.speed(beat);\n    };\n    /**\n     * Calculates the note spacing factor at the specified beat.\n     */\n    Notechart.prototype.spacingAtBeat = function (beat) {\n        return this._spacing.factor(beat);\n    };\n    /**\n     * Gets the keyMode from scratch\n     * @param scratch\n     * @returns {string}\n     */\n    Notechart.prototype.getKeyMode = function (scratch) {\n        var e_1, _a;\n        var usedColumns = {};\n        try {\n            for (var _b = __values(this.notes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var note = _c.value;\n                usedColumns[note.column] = true;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        if (scratch === 'off' && !usedColumns['1'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'left' && !usedColumns['6'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'right' && !usedColumns['1'] && !usedColumns['2'])\n            return '5K';\n        return '7K';\n    };\n    Notechart.prototype._preTransform = function (bmsNotes, playerOptions) {\n        var chain = lodash_1.default.chain(bmsNotes);\n        var keys = getKeys(bmsNotes);\n        if (playerOptions.scratch === 'off') {\n            chain = chain.map(function (note) {\n                if (note.column && note.column === 'SC') {\n                    return Object.assign({}, note, { column: null });\n                }\n                else {\n                    return note;\n                }\n            });\n        }\n        if (keys === '5K') {\n            var columnsToShift_1 = ['1', '2', '3', '4', '5', '6', '7'];\n            var shiftNote = function (amount) { return function (note) {\n                if (note.column) {\n                    var index = columnsToShift_1.indexOf(note.column);\n                    if (index > -1) {\n                        var newIndex = index + amount;\n                        (0, invariant_1.default)(newIndex < columnsToShift_1.length, 'Weird. Columns must not shift beyond available column');\n                        var newColumn = columnsToShift_1[newIndex];\n                        return Object.assign({}, note, { column: newColumn });\n                    }\n                }\n                return note;\n            }; };\n            if (playerOptions.scratch === 'off') {\n                chain = chain.map(shiftNote(1));\n            }\n            else if (playerOptions.scratch === 'right') {\n                chain = chain.map(shiftNote(2));\n            }\n        }\n        return chain.value();\n    };\n    Notechart.prototype._generatePlayableNotesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            _this._updateDuration(spec);\n            if (note.endBeat !== undefined) {\n                spec.end = _this._generateEvent(note.endBeat);\n                _this._updateDuration(spec.end);\n            }\n            else {\n                spec.end = undefined;\n            }\n            return spec;\n        });\n    };\n    Notechart.prototype._generateLandminesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            _this._updateDuration(spec);\n            return spec;\n        });\n    };\n    Notechart.prototype._updateDuration = function (event) {\n        if (event.time > this._duration)\n            this._duration = event.time;\n    };\n    Notechart.prototype._generateAutoKeysoundEventsFromBMS = function (bmsNotes) {\n        var _this = this;\n        return bmsNotes\n            .filter(function (note) { return !note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            return spec;\n        });\n    };\n    Notechart.prototype._generateKeysoundFiles = function (keysounds) {\n        var e_2, _a, e_3, _b;\n        var set = new Set();\n        try {\n            for (var _c = __values([this.notes, this.autos]), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var array = _d.value;\n                try {\n                    for (var array_1 = (e_3 = void 0, __values(array)), array_1_1 = array_1.next(); !array_1_1.done; array_1_1 = array_1.next()) {\n                        var event_ = array_1_1.value;\n                        var file = keysounds.get(event_.keysound);\n                        if (file)\n                            set.add(file);\n                    }\n                }\n                catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                finally {\n                    try {\n                        if (array_1_1 && !array_1_1.done && (_b = array_1.return)) _b.call(array_1);\n                    }\n                    finally { if (e_3) throw e_3.error; }\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return Array.from(set);\n    };\n    Notechart.prototype._generateBarLineEvents = function (beats) {\n        var _this = this;\n        return beats.map(function (beat) { return _this._generateEvent(beat); });\n    };\n    Notechart.prototype._generateEvent = function (beat) {\n        return {\n            beat: beat,\n            time: this.beatToSeconds(beat),\n            position: this.beatToPosition(beat),\n        };\n    };\n    Notechart.prototype._getNoteInfo = function (note) {\n        return { combos: note.end ? 2 : 1 };\n    };\n    return Notechart;\n}());\nexports.Notechart = Notechart;\nexports.default = Notechart;\nfunction getKeys(bmsNotes) {\n    var e_4, _a;\n    try {\n        for (var bmsNotes_1 = __values(bmsNotes), bmsNotes_1_1 = bmsNotes_1.next(); !bmsNotes_1_1.done; bmsNotes_1_1 = bmsNotes_1.next()) {\n            var note = bmsNotes_1_1.value;\n            if (note.column === '6' || note.column === '7') {\n                return '7K';\n            }\n        }\n    }\n    catch (e_4_1) { e_4 = { error: e_4_1 }; }\n    finally {\n        try {\n            if (bmsNotes_1_1 && !bmsNotes_1_1.done && (_a = bmsNotes_1.return)) _a.call(bmsNotes_1);\n        }\n        finally { if (e_4) throw e_4.error; }\n    }\n    return '5K';\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fromBMSChart = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar __1 = __importDefault(require(\"../\"));\n// Returns a new Notechart from a BMSChart.\nfunction fromBMSChart(bms, playerOptions) {\n    var notes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1,\n    }).all();\n    var landmineNotes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP_LANDMINE\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1_LANDMINE,\n    }).all();\n    var timing = BMS.Timing.fromBMSChart(bms);\n    var keysounds = BMS.Keysounds.fromBMSChart(bms);\n    var songInfo = BMS.SongInfo.fromBMSChart(bms);\n    var positioning = BMS.Positioning.fromBMSChart(bms);\n    var spacing = BMS.Spacing.fromBMSChart(bms);\n    var data = {\n        notes: notes,\n        landmineNotes: landmineNotes,\n        timing: timing,\n        keysounds: keysounds,\n        songInfo: songInfo,\n        positioning: positioning,\n        spacing: spacing,\n        barLines: generateBarLinesFromBMS(notes, bms),\n        expertJudgmentWindow: getJudgmentWindowFromBMS(bms),\n    };\n    return new __1.default(data, playerOptions);\n}\nexports.fromBMSChart = fromBMSChart;\nfunction getJudgmentWindowFromBMS(bms) {\n    // http://hitkey.nekokan.dyndns.info/diary1501.php\n    var rank = +bms.headers.get('rank') || 2;\n    if (rank === 0)\n        return [8, 24]; // Very Hard\n    if (rank === 1)\n        return [15, 30]; // Hard\n    if (rank === 3)\n        return [21, 60]; // Easy\n    return [18, 40]; // Normal\n}\nfunction generateBarLinesFromBMS(bmsNotes, bms) {\n    var max = lodash_1.default.max(bmsNotes.map(function (note) { return note.endBeat || note.beat; })) || 0;\n    var barLines = [0];\n    var currentBeat = 0;\n    var currentMeasure = 0;\n    do {\n        currentBeat += bms.timeSignatures.getBeats(currentMeasure);\n        currentMeasure += 1;\n        barLines.push(currentBeat);\n    } while (currentBeat <= max);\n    return barLines;\n}\n//# sourceMappingURL=BMSNotechartLoader.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map"],"names":["___CSS_LOADER_EXPORT___","push","module","id","initialState","Map","beginLoading","url","state","set","completeLoading","data","errorLoading","error","getCollectionByUrl","get","initLoading","status","initCompletedWithValue","value","isLoading","isCompleted","isError","completeWithValue","errorWithReason","initWithText","text","staged","committed","searchText","inputText","handleTextType","draft","handleDebounce","setText","musicSearchTextSlice","name","reducers","MUSIC_SEARCH_TEXT_TYPED","payload","MUSIC_SEARCH_DEBOUNCED","MUSIC_SEARCH_TEXT_INITIALIZED","_state","selectedSongId","selectedChartId","selectedChartLevel","selectedSongGivenSongs","songs","song","item","selectedChartGivenCharts","charts","chart","file","Math","abs","getChartLevel","selectSong","songId","selectChart","chartId","chartLevel","info","level","difficulty","musicSelectionSlice","CUSTOM_SONG_LOADED","MUSIC_SONG_SELECTED","MUSIC_CHART_SELECTED","initWithDataFromStorage","options","toggleOptionEnabled","toggleOption","getKeyMapping","mode","key","playMode","_changePlayMode","speed","leadTime","parsed","parseInt","SCRATCH_POSITION","isScratchPosition","str","includes","scratchPosition","panelPlacement","laneCover","min","max","round","isBackgroundAnimationsEnabled","isAutoVelocityEnabled","isPreviewEnabled","isGaugeEnabled","getGauge","keyboardMapping","mapping","control","hasAcknowledged","featureKey","audioInputLatency","isContinuousAxisEnabled","sensitivity","lastSeenVersion","nextKeyToEdit","editing","scratch","keySet","index","indexOf","optionsSlice","LOAD_FROM_STORAGE","LOADED_FROM_STORAGE","INIT_WITH_DATA_FROM_STORAGE","CHANGE_KEY_MAPPING","keyCode","CHANGE_PLAY_MODE","CHANGE_SPEED","CHANGE_LEAD_TIME","toString","CHANGE_SCRATCH_POSITION","position","CHANGE_PANEL_PLACEMENT","placement","CHANGE_LANE_COVER","TOGGLE_BACKGROUND_ANIMATIONS","TOGGLE_AUTO_VELOCITY","TOGGLE_PREVIEW","TOGGLE_GAUGE","ACKNOWLEDGE","CHANGE_AUDIO_INPUT_LATENCY","latency","TOGGLE_CONTINUOUS_AXIS","CHANGE_SENSITIVITY","UPDATE_LAST_SEEN_VERSION","newVersion","title","getTitle","haystack","needle","String","toLowerCase","trim","getMusicServer","getSoundVolume","getPreloadArchiveFlag","getInitialGrepString","getInitiallySelectedSong","getTimeSynchroServer","contains","filterText","filter","artist","genre","matches","collectionsSlice","COLLECTION_LOADING_BEGAN","LoadState","COLLECTION_LOADING_ERRORED","COLLECTION_LOADED","customSongLoadStateSlice","undefined","CUSTOM_SONG_LOAD_STARTED","customSongsSlice","CUSTOM_SONGS_LOADED","currentCollectionSlice","currentSongReadmeSlice","README_LOADING_STARTED","README_LOADING_ERRORED","README_LOADED","rageQuitSlice","RAGEQUITTED","RAGEQUIT_DISMISSED","reducer","collections","customSongLoadState","customSongs","currentCollection","musicSearchText","MusicSearchText","musicSelection","MusicSelection","Options","currentSongReadme","rageQuit","selectCurrentCollectionUrl","selectCurrentCollection","Collections","Error","selectIsCurrentCollectionLoading","selectCurrentCorrectionLoadError","selectCurrentCollectionValue","collection","preprocessCollection","selectSearchInputText","selectSearchText","selectGroups","selectSongs","selectSongListFromCurrentCollection","collectionData","selectSongList","songList","selectSortedSongList","sortSongs","selectFilteredSongList","selectSongOfTheDayEnabled","songOfTheDayEnabled","groupSongsIntoCategories","groups","map","flatten","selectSelectedSong","selectChartsForSelectedSong","selectSelectedChart","selectMusicSelection","getPlayableCharts","selectOptions","selectPlayMode","store","selectRageQuittedFlag","collectionFetchMiddleware","dispatch","next","action","type","then","collectionLoader","ret","initiallySelectedSong","matchingSong","findMatchingSong","optionsStorageMiddleware","storage","localStorage","getState","Object","keys","getItem","startsWith","setItem","configureStore","middleware","window","devToolsExtension","f","_enabled","_lifecycleHandler","pauseAt","t","unpause","getScore","enableTestMode","console","log","overlay","document","createElement","setAttribute","innerHTML","body","appendChild","setGameLifecycleHandler","handler","isTestModeEnabled","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","Table","stats","stat","align","bench","show","setShow","useState","updater","useEffect","setInterval","flag","clearInterval","handleInteraction","e","preventDefault","stopPropagation","className","onClick","onTouchStart","Stat","sum","count","average","hist","lastSec","secAvg","delta","now","time","shift","length","format","x","toFixed","BEMUSE_BENCHMARK","enabled","wrap","start","apply","this","arguments","finish","benchmark","obj","lines","forEach","join","div","render","shouldShowOptions","shouldEnableBenchmark","shouldDisableFullScreen","shouldShowAbout","shouldShowModeSelect","isTitleDisplayMode","gaugeType","primary","secondary","extra","update","playerState","progress","numJudgments","totalCombo","getHope","max1","max2","maxPossibleScore","hopeS","hopeA","shouldDisplay","getPrimary","getSecondary","getExtra","hopeGauge","y","lower","upper","pos","event","constructor","notes","barLines","_notes","_barLines","sortBy","getVisibleNotes","headroom","out","i","note","end","entity","head","tail","height","getVisibleBarLines","player","skinData","_currentSpeed","_player","_noteArea","notechart","_stateful","_defaultData","key_mode","getKeyMode","lane_lift","lane_press","_gauge","gauge","_touch3dMode","displayMode","gameTime","touch3dMode","noteArea","stateful","beat","secondsToBeat","beatToPosition","spacing","spacingAtBeat","assign","entities","getUpperBound","putNote","noteY","column","scale","row","columnIndex","areaWidth","xOffset","projection","desiredWidth","width","longNoteStep","c","floor","getNoteStatus","judgment","getNoteJudgment","active","missed","updateVisibleNotes","updateBarLines","input","columns","changed","updateInput","notifications","judgments","notification","deviationMode","combo","score","updateJudgment","updateGauge","updateExplode","getCount","currentAccuracy","bpm","bpmAtBeat","counts","config","getRow","excess","theta","pointX","cos","pointY","sin","PLAY_AREA_WIDTH","getTouchedColumn","mid","x0","x1","justPressed","_controls","_plugins","changes","plugin","destroy","controlName","has","use","diff","last","current","Judgment","UNJUDGED","Unjudged","MISSED","Missed","NORMAL_TIMEGATES","timegate","endTimegate","TRANSITIONAL_BEGINNER_LV5_TIMEGATES","TRANSITIONAL_BEGINNER_LV4_TIMEGATES","TRANSITIONAL_BEGINNER_LV3_TIMEGATES","ABSOLUTE_BEGINNER_TIMEGATES","FixedTimegatesJudge","timegates","getTimegates","_gameTime","_noteTime","TutorialJudge","noteTime","NORMAL_JUDGE","getJudgeForNotechart","tutorial","songInfo","insane","judgeTimeWith","judge","judgeTime","judgeEndTime","isBad","breaksCombo","weight","number","autoplayEnabled","autosound","NoteStatus","sounds","finished","tainted","_pinching","_columns","_noteBufferByColumn","n","groupBy","mapValues","startIndex","_noteResult","_duration","duration","_judge","_rawInput","_updateInputColumnMap","_judgeNotes","_updateSpeed","result","getPlayerInput","buffer","_judgeColumn","_modifySpeed","pinch","pinching","direction","amount","_shouldAutoplay","BEMUSE_AUTOPLAY","judgedNote","autoPlayed","_shouldJudge","shouldBreak","_judgeNote","freestyleNote","_getFreestyleNote","_isSandwiched","_getClosestNote","every","adjacentColumn","some","hit","noteEnd","lifted","passed","isDown","isUp","Judged","Active","_setJudgment","handleDelta","handleJudgment","getAccuracyScore","accuracy","getComboScore","total","combos","totalNotes","maxCombo","rawSumJudgmentWeight","rawTotalComboScore","_calculateRawTotalComboScore","_remainingMaxPossibleRawComboScore","rawSumComboScore","poor","_log","deltas","accuracyScore","comboScore","maxPossibleAccuracyScore","maxPossibleComboScore","remainingJudgments","maxPossibleAccuracy","maxPossibleRawComboScore","character","rawComboScore","_calculateRawComboScore","_recordLog","_getLogCharacter","forModule","moduleName","bindLogger","warn","args","Date","toJSON","orderBy","getHashFunction","today","toISOString","split","md5","createHash","digest","SongOfTheDay","ids","Set","sorted","s","custom","slice","isSongOfTheDay","grouping","criteria","unreleased","added","parse","sort","reverse","context","songOfTheDay","group","output","OFFICIAL_SERVER_URL","async","load","serverUrl","fetch","g","indexUrl","getServerIndexFileUrl","response","json","Array","isArray","dir","replace","path","endsWith","chart_names","subtitles","preprocessSong","AxisLogic","stop","charge","previous","positive","axis","threshold","immediateOutput","ceil","observeMidiAccess","access","Observable","subscriber","port","inputs","values","outputs","onstatechange","E","fromEvent","from","navigator","requestMIDIAccess","Promise","reject","pipe","concatMap","catchError","stack","tap","message","OmniInput","win","analogThreshold","deadzone","handleKeyDown","which","exclusive","handleKeyUp","handleMIDIMessage","prefix","target","handleNote","bend","continuousAxis","continuous","setGamepadSensitivity","subscriptions","subscribe","updateGamepads","nav","gamepads","fetchGamepads","gamepad","updateGamepad","getGamepads","webkitGetGamepads","buttons","button","axes","axisName","setGamepadContinuousAxisEnabled","dispose","subscription","unsubscribe","handle","concat","of","pairwise","array","knownMidiIds","getName","match","rest","size","midiNote","Progress","_observable","report","notify","watch","formatter","BYTES_FORMATTER","PERCENTAGE_FORMATTER","EXTRA_FORMATTER","fixed","loaded","atomic","promise","resolve","byteLength","hasByteLength","wrapPromise","bind","to","simultaneous","queue","add","addUnprefixed","callback","parts","ResourceLogging","loggingFunction","setLoggingFunction","fn","workerUrl","ARCHIVE_REGEXP","DROPBOX_REGEXP","CustomSongResources","provider","_logging","_files","getFiles","files","fileEntry","archive","extracted","extractFiles","traverse","tree","File","unarchive","unarchiveIfNeeded","FileResource","fileList","a","_file","read","as","resolveUrl","URL","createObjectURL","downloadFileEntryFromURL","pop","lastTime","download","URLResource","basename","URLResources","base","part","encodeURIComponent","href","init","_callbacks","_nextId","call","callbacks","getRetryDelay","random","shouldGiveUp","xh","XMLHttpRequest","open","responseType","onload","onerror","onprogress","send","waitMs","seconds","Log","offset","performance","synchronize","server","onResult","err","synchronized","o","_value","blob","reader","FileReader","readAsArrayBuffer","readAsText","__createBinding","create","m","k","k2","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","defineProperty","__exportStar","exports","p","prototype","hasOwnProperty","__values","Symbol","iterator","done","TypeError","__importDefault","mod","Notechart","lodash_1","invariant_1","playerOptions","_this","bmsNotes","timing","keysounds","positioning","images","expertJudgmentWindow","_a","landmineNotes","default","_preTransform","_timing","_positioning","_spacing","_keysounds","_generatePlayableNotesFromBMS","_landmines","_autos","_generateAutoKeysoundEventsFromBMS","_generateBarLineEvents","_samples","_generateKeysoundFiles","_infos","_getNoteInfo","_songInfo","_images","all","eyecatch","background","beatToSeconds","measureToBeat","measure","secondsToPosition","scrollSpeedAtBeat","factor","e_1","usedColumns","_b","_c","e_1_1","return","chain","e_4","bmsNotes_1","bmsNotes_1_1","e_4_1","getKeys","columnsToShift_1","shiftNote","newIndex","newColumn","nextId","spec","_generateEvent","keysound","keysoundStart","keysoundEnd","_updateDuration","endBeat","_generateLandminesFromBMS","e_2","e_3","autos","_d","array_1","array_1_1","event_","e_3_1","e_2_1","beats","__setModuleDefault","v","__importStar","fromBMSChart","BMS","__1","getJudgmentWindowFromBMS","bms","rank","headers","generateBarLinesFromBMS","currentBeat","currentMeasure","timeSignatures","getBeats","Notes","double","CHANNEL_MAPPING","IIDX_DP","IIDX_P1","IIDX_DP_LANDMINE","IIDX_P1_LANDMINE","Timing","Keysounds","SongInfo","Positioning","Spacing"],"sourceRoot":""}