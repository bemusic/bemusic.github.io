{"version":3,"file":"build/419-368f459a71eeb62aea3f.js","mappings":"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","sources":["file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/BemuseTestMode.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss?[contenthash]","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/benchmark.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/query-flags.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/Gauge.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/note-area.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/player-display.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/touch3d.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/control.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/judgments.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/player.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/player-state.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/player-stats.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/logger/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/midi.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/axis-logic.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/Progress.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/formatters.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/utils.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/addUnprefixed.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/resource-logging.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/unarchiver.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/custom-song-resources.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/url.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/callbacks.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/download.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/formatTime.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/now.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/observable.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/read-blob.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/index.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/BMSNotechartLoader.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/types.js"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \".BenchmarkPanel {\\n  background: #449;\\n  border: 2px solid #66e;\\n  padding: 4px;\\n}\\n.BenchmarkPanel table {\\n  font-size: 10px;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./devtools/ui/BenchmarkPanel.scss\"],\"names\":[],\"mappings\":\"AAEA;EACE,gBAAA;EACA,sBAAA;EACA,YAAA;AADF;AAEE;EACE,eAAA;AAAJ\",\"sourcesContent\":[\"@import '~bemuse/ui/common';\\n\\n.BenchmarkPanel {\\n  background: #449;\\n  border: 2px solid #66e;\\n  padding: 4px;\\n  table {\\n    font-size: 10px;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","let _enabled = false\n\nlet _lifecycleHandler = {\n  /** @returns {Promise<void>} */\n  pauseAt(t) {\n    throw new Error('Cannot pause: No lifecycle handler registered!')\n  },\n  /** @returns {void} */\n  unpause() {\n    throw new Error('Cannot unpause: No lifecycle handler registered!')\n  },\n  /** @returns {number} */\n  getScore() {\n    throw new Error('Cannot get score: No lifecycle handler registered!')\n  },\n}\n\n/**\n * Activates the test mode. In this mode,\n *\n * - An overlay will be displayed indicating the test mode.\n * - The following APIs will be available to facilitate automated testing:\n *     - `BemuseTestMode.pauseAt(t)` will make the game pause at time `t`.\n *     - `BemuseTestMode.unpause()` will unpause the game.\n * - Score submission is disabled.\n *\n * Note: Once test mode is activated, it cannot be deactivated for the rest of the game session.\n */\nexport function enableTestMode() {\n  if (!_enabled) {\n    _enabled = true\n    console.log('[Bemuse test mode enabled]')\n    const overlay = document.createElement('div')\n    overlay.setAttribute(\n      'style',\n      `\n        position: fixed;\n        top: 20px;\n        left: 20px;\n        font: 20px Comic Sans MS, sans-serif;\n        z-index: 99999;\n        background: rgba(0,0,0,0.5);\n        color: #0f0;\n        border: 2px solid #0f0;\n        padding: 4px;\n        pointer-events: none;\n      `\n    )\n    overlay.innerHTML = `\n      <strong>Test mode:</strong>\n      Bemuse is being controlled by automated test software.\n    `\n    document.body.appendChild(overlay)\n  }\n}\n\n/**\n * Registers a pause handler.\n * This allows the `pauseAt` and `unpause` APIs to be used.\n *\n * @param {typeof _lifecycleHandler} handler\n */\nexport function setGameLifecycleHandler(handler) {\n  console.log('[Bemuse test mode] A pause handler has been registered.')\n  _lifecycleHandler = handler\n}\n\n/**\n * Returns `true` if test mode is enabled, `false` otherwise.\n */\nexport function isTestModeEnabled() {\n  return !!_enabled\n}\n\n/**\n * Will schedule the game to pause at time `t`.\n *\n * @param {number} t The song time to pause in seconds\n * @returns {Promise<void>} A promise that will be resolved when the time is reached and game is paused.\n */\nexport function pauseAt(t) {\n  return _lifecycleHandler.pauseAt(t)\n}\n\n/**\n * Unpauses the game.\n */\nexport function unpause() {\n  return _lifecycleHandler.unpause()\n}\n\n/**\n * Returns the current score.\n */\nexport function getScore() {\n  return _lifecycleHandler.getScore()\n}\n","\n      import API from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./BenchmarkPanel.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./BenchmarkPanel.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import './BenchmarkPanel.scss'\n\nimport React, { MouseEvent, TouchEvent, useEffect, useState } from 'react'\n\nconst Table = ({ stats }: { stats: Record<string, unknown> }) => (\n  <table>\n    <tbody>\n      {Object.keys(stats).map((key) => {\n        const stat = stats[key]\n        return (\n          <tr key={key}>\n            <td>\n              <strong>{key}</strong>\n            </td>\n            <td align='right'>{'' + stat}</td>\n          </tr>\n        )\n      })}\n    </tbody>\n  </table>\n)\n\nexport interface BenchmarkPanelProps {\n  bench: {\n    stats: Record<string, unknown>\n  }\n}\n\nconst BenchmarkPanel = ({ bench }: BenchmarkPanelProps) => {\n  const [show, setShow] = useState(false)\n  const [, updater] = useState(false)\n\n  useEffect(() => {\n    const id = setInterval(() => updater((flag) => !flag), 1000)\n    return () => {\n      clearInterval(id)\n    }\n  }, [])\n\n  const handleInteraction = (e: MouseEvent | TouchEvent) => {\n    e.preventDefault()\n    e.stopPropagation()\n    setShow((flag) => !flag)\n  }\n\n  return (\n    <div\n      className='BenchmarkPanel'\n      onClick={handleInteraction}\n      onTouchStart={handleInteraction}\n    >\n      {show ? (\n        <article>\n          <b>Benchmark Stats</b>\n          <br />\n          <Table stats={bench.stats} />\n        </article>\n      ) : (\n        'Show Benchmark Stats'\n      )}\n    </div>\n  )\n}\n\nexport default BenchmarkPanel\n","import now from 'bemuse/utils/now'\nimport { shouldEnableBenchmark } from './query-flags'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport BenchmarkPanel from './ui/BenchmarkPanel'\n\nfunction Stat() {\n  let sum = 0\n  let count = 0\n  let average = 0\n  const hist = []\n  let lastSec = 0\n  let secAvg = 0\n  return {\n    push: function (delta) {\n      const t = now()\n      sum += delta\n      count += 1\n      average = sum / count\n      lastSec += delta\n      hist.push({ delta, time: t })\n      while (hist[0] && hist[0].time < t - 1000) {\n        lastSec -= hist.shift().delta\n      }\n      secAvg = lastSec / hist.length\n    },\n    toString() {\n      return format(average) + ' / ' + format(secAvg)\n    },\n  }\n}\n\nfunction format(x) {\n  return x.toFixed(2) + 'ms'\n}\n\nfunction Benchmarker() {\n  const stats = {}\n  const bench = {\n    enabled: true,\n    stats,\n    wrap(title, f) {\n      return function () {\n        const start = now()\n        try {\n          return f.apply(this, arguments)\n        } finally {\n          const finish = now()\n          const stat = stats[title] || (stats[title] = new Stat(title))\n          stat.push(finish - start)\n        }\n      }\n    },\n    benchmark(title, obj, name) {\n      obj[name] = this.wrap(title, obj[name])\n    },\n    toString() {\n      const lines = []\n      Object.keys(stats).forEach(function (key) {\n        lines.push('- ' + key + ': ' + stats[key])\n      })\n      return lines.join('\\n')\n    },\n  }\n  const div = document.createElement('div')\n  div.setAttribute('style', 'position:fixed;top:10px;right:10px;z-index:99999')\n  document.body.appendChild(div)\n  ReactDOM.render(<BenchmarkPanel bench={bench} />, div)\n  return bench\n}\n\nfunction FakeBenchmarker() {\n  return {\n    enabled: false,\n    wrap: (title, f) => f,\n  }\n}\n\nexport default window.BEMUSE_BENCHMARK = shouldEnableBenchmark()\n  ? new Benchmarker()\n  : new FakeBenchmarker()\n","import query from 'bemuse/utils/query'\n\nexport function shouldShowOptions() {\n  return query.BEMUSE_SHOW_OPTIONS === '1'\n}\n\nexport function shouldEnableBenchmark() {\n  return query.BEMUSE_BENCHMARK === '1'\n}\n\nexport function shouldDisableFullScreen() {\n  return query.BEMUSE_NO_FULLSCREEN === '1'\n}\n\nexport function shouldShowAbout() {\n  return query.BEMUSE_SHOW_ABOUT === '1'\n}\n\nexport function shouldShowModeSelect() {\n  return query.BEMUSE_SHOW_MODE_SELECT === '1'\n}\n\nexport function isTitleDisplayMode() {\n  return query.BEMUSE_TITLE_DISPLAY === '1'\n}\n","export function getGauge(gaugeType) {\n  if (gaugeType === 'hope') {\n    return hopeGauge()\n  }\n  return nullGauge()\n}\n\nfunction nullGauge() {\n  return {\n    update() {},\n    shouldDisplay() {\n      return false\n    },\n    getPrimary() {\n      return 0\n    },\n    getSecondary() {\n      return 0\n    },\n    getExtra() {\n      return 0\n    },\n  }\n}\n\nfunction hopeGauge() {\n  let primary\n  let secondary\n  let extra\n  return {\n    update(playerState) {\n      const stats = playerState.stats\n      const progress = stats.numJudgments / stats.totalCombo\n      const getHope = (min, max1, max2) => {\n        const max = max1 + (max2 - max1) * progress\n        const maxPossibleScore = stats.maxPossibleScore\n        return Math.max(0, (maxPossibleScore - min) / (max - min))\n      }\n      const hopeS = getHope(500000, 555555, 510000) * 0.5\n      primary = Math.min(1, hopeS)\n      extra = Math.max(0, Math.min(1, hopeS - 1))\n      if (hopeS > 0) {\n        secondary = 0\n      } else {\n        const hopeA = getHope(450000, 500000, 500000)\n        secondary = hopeA\n      }\n    },\n    shouldDisplay() {\n      return primary > 0 || secondary > 0\n    },\n    getPrimary() {\n      return primary\n    },\n    getSecondary() {\n      return secondary\n    },\n    getExtra() {\n      return extra\n    },\n  }\n}\n","import _ from 'lodash'\n\nexport class NoteArea {\n  constructor(notes, barLines) {\n    this._notes = _.sortBy(notes, position)\n    this._barLines = _(barLines).map('position').sortBy().value()\n  }\n\n  getVisibleNotes(lower, upper, headroom) {\n    const out = []\n    const notes = this._notes\n    if (!headroom) headroom = 0\n    for (let i = 0; i < notes.length; i++) {\n      const note = notes[i]\n      const visible = note.end\n        ? !(note.position > upper || note.end.position < lower - headroom)\n        : !(note.position > upper || note.position < lower - headroom)\n      if (visible) {\n        const entity = { note: note }\n        if (!note.end) {\n          entity.y = y(lower, upper, note.position)\n        } else {\n          const head = y(lower, upper, note.position)\n          const tail = y(lower, upper, note.end.position)\n          entity.y = Math.min(head, tail)\n          entity.height = Math.abs(head - tail)\n        }\n        out.push(entity)\n      }\n    }\n    return out\n  }\n\n  getVisibleBarLines(lower, upper, headroom) {\n    if (!headroom) headroom = 0\n    return this._barLines\n      .filter((pos) => lower - headroom <= pos && pos <= upper)\n      .map((pos) => ({ id: pos, y: y(lower, upper, pos) }))\n  }\n}\n\nexport default NoteArea\n\nfunction y(lower, upper, pos) {\n  return 1 - (pos - lower) / (upper - lower)\n}\n\nfunction position(event) {\n  return event.position\n}\n","import * as touch3d from './touch3d'\nimport NoteArea from './note-area'\nimport { MISSED, breaksCombo } from '../judgments'\nimport { getGauge } from './Gauge'\n\nexport class PlayerDisplay {\n  constructor(player, skinData) {\n    this._currentSpeed = 1\n    this._player = player\n    this._noteArea = new NoteArea(\n      player.notechart.notes,\n      player.notechart.barLines\n    )\n    this._stateful = {}\n    this._defaultData = {\n      placement: player.options.placement,\n      scratch: player.options.scratch,\n      key_mode: player.notechart.getKeyMode(player.options.scratch),\n      lane_lift: Math.max(0, -player.options.laneCover),\n      lane_press: Math.max(0, player.options.laneCover),\n    }\n    this._gauge = getGauge(player.options.gauge)\n    this._touch3dMode = skinData.displayMode === 'touch3d'\n  }\n\n  update(time, gameTime, playerState) {\n    const touch3dMode = this._touch3dMode\n    const player = this._player\n    const noteArea = this._noteArea\n    const stateful = this._stateful\n    const beat = player.notechart.secondsToBeat(gameTime)\n    const position = player.notechart.beatToPosition(beat)\n    const spacing = player.notechart.spacingAtBeat(beat)\n    const data = Object.assign({}, this._defaultData)\n    const push = (key, value) => (data[key] || (data[key] = [])).push(value)\n    const gauge = this._gauge\n\n    this._currentSpeed += (playerState.speed - this._currentSpeed) / 3\n    const speed = this._currentSpeed * spacing\n\n    updateBeat()\n    updateVisibleNotes()\n    updateBarLines()\n    updateInput()\n    updateJudgment()\n    updateGauge()\n    updateExplode()\n\n    data['speed'] = playerState.speed.toFixed(1) + 'x'\n    data['stat_1'] = getCount(1)\n    data['stat_2'] = getCount(2)\n    data['stat_3'] = getCount(3)\n    data['stat_4'] = getCount(4)\n    data['stat_missed'] = getCount(MISSED)\n    data['stat_acc'] = getAccuracy()\n    const bpm = player.notechart.bpmAtBeat(beat)\n    data['bpm'] = bpm < 1 ? '' : Math.round(bpm) % 10000 || ''\n\n    Object.assign(data, stateful)\n    return data\n\n    function updateBeat() {\n      data.beat = beat\n    }\n\n    function getCount(judgment) {\n      return playerState.stats.counts && playerState.stats.counts[judgment]\n    }\n\n    function getAccuracy() {\n      return ((playerState.stats.currentAccuracy || 0) * 100).toFixed(2) + '%'\n    }\n\n    function updateVisibleNotes() {\n      const entities = noteArea.getVisibleNotes(position, getUpperBound(), 1)\n      if (touch3dMode) {\n        const putNote = (id, noteY, column, scale = 1) => {\n          const row = touch3d.getRow(noteY - 0.01)\n          const columnIndex = +column || -1\n          const areaWidth = touch3d.PLAY_AREA_WIDTH\n          const xOffset =\n            row.projection * areaWidth * ((2 * (columnIndex - 0.5)) / 7 - 1)\n          const desiredWidth = (row.projection * scale * areaWidth * 2) / 7\n          push(`note3d_${column}`, {\n            key: id,\n            y: row.y,\n            x: xOffset + 1280 / 2,\n            width: desiredWidth,\n          })\n        }\n        const longNoteStep = 3 / 128\n        for (const entity of entities) {\n          const note = entity.note\n          const column = note.column\n          if (entity.height) {\n            let c = 0\n            const start = entity.y + entity.height\n            for (\n              let i =\n                start -\n                Math.max(\n                  0,\n                  Math.floor((start - 1) / longNoteStep) * longNoteStep\n                );\n              i >= 0 && i >= entity.y;\n              i -= longNoteStep\n            ) {\n              putNote(note.id + 'x' + c++, i, column, 0.8)\n            }\n            putNote(note.id, entity.y + entity.height, column)\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              putNote(note.id, entity.y, column)\n            }\n          }\n        }\n      } else {\n        for (const entity of entities) {\n          const note = entity.note\n          const column = note.column\n          if (entity.height) {\n            const judgment = playerState.getNoteJudgment(note)\n            const status = playerState.getNoteStatus(note)\n            push(`longnote_${column}`, {\n              key: note.id,\n              y: entity.y,\n              height: entity.height,\n              active: judgment !== 0 && judgment !== MISSED,\n              missed: status === 'judged' && judgment === MISSED,\n            })\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              push(`note_${column}`, {\n                key: note.id,\n                y: entity.y,\n              })\n            }\n          }\n        }\n      }\n    }\n\n    function updateBarLines() {\n      const entities = noteArea.getVisibleBarLines(position, getUpperBound(), 1)\n      for (const entity of entities) {\n        if (touch3dMode) {\n          const row = touch3d.getRow(entity.y - 0.01)\n          push('barlines3d', {\n            key: entity.id,\n            y: row.y,\n            x: row.projection * -touch3d.PLAY_AREA_WIDTH + 1280 / 2,\n            width: row.projection * touch3d.PLAY_AREA_WIDTH * 2,\n          })\n        } else {\n          push('barlines', { key: entity.id, y: entity.y })\n        }\n      }\n    }\n\n    function updateInput() {\n      const input = playerState.input\n      for (const column of player.columns) {\n        const control = input.get(column)\n        data[`${column}_active`] = control.value !== 0 ? 1 : 0\n        if (control.changed) {\n          if (control.value !== 0) {\n            stateful[`${column}_down`] = time\n          } else {\n            stateful[`${column}_up`] = time\n          }\n        }\n      }\n    }\n\n    function updateJudgment() {\n      const notifications = playerState.notifications.judgments\n      const notification = notifications[notifications.length - 1]\n      if (notification) {\n        const name =\n          notification.judgment === -1 ? 'missed' : `${notification.judgment}`\n        stateful[`judge_${name}`] = time\n        const deviationMode =\n          notification.judgment === -1 || notification.judgment === 1\n            ? 'none'\n            : notification.delta > 0\n            ? 'late'\n            : notification.delta < 0\n            ? 'early'\n            : 'none'\n        stateful[`judge_deviation_${deviationMode}`] = time\n        stateful['combo'] = notification.combo\n      }\n      data['score'] = playerState.stats.score\n    }\n\n    function updateGauge() {\n      gauge.update(playerState)\n      if (gauge.shouldDisplay()) {\n        if (!stateful['gauge_enter']) stateful['gauge_enter'] = time\n      } else {\n        if (stateful['gauge_enter']) {\n          if (!stateful['gauge_exit']) stateful['gauge_exit'] = time\n        }\n      }\n      data['gauge_primary'] = gauge.getPrimary()\n      data['gauge_secondary'] = gauge.getSecondary()\n      data['gauge_extra'] = gauge.getExtra()\n    }\n\n    function updateExplode() {\n      const notifications = playerState.notifications.judgments\n      for (let i = 0; i < notifications.length; i++) {\n        const notification = notifications[i]\n        if (!breaksCombo(notification.judgment)) {\n          stateful[`${notification.column}_explode`] = time\n        }\n      }\n    }\n\n    function getUpperBound() {\n      return position + 5 / speed\n    }\n  }\n}\n\nexport default PlayerDisplay\n","// Touch3D mode -- inspired by Thapster.\n// Notes are arranged on a 3D arc that moves towards the screen.\n// Example: https://twitter.com/bemusegame/status/950505986409709569\n\n/** Parameters to the algorithm. These values are obtained by trial-and-error. */\nconst config = {\n  /** Centre point of the arc (X-coordinate) */\n  cx: 1024,\n  /** Centre point of the arc (Y-coordinate) */\n  cy: -975,\n  /** Radius of the arc */\n  r: 1024,\n  /** Beginning angle of the arc */\n  t0: 3.922,\n  /** Ending angle of the arc */\n  t1: 4.555,\n  /**\n   * Perspective value (field of view).\n   * Camera is placed at (p, 0, 0), facing towards (0, 0, 0).\n   * See: https://developer.mozilla.org/en-US/docs/Web/CSS/perspective\n   */\n  p: 960,\n  /** Width of the play area */\n  w: 60,\n}\n\n/**\n * Given the display position (0 representing top and 1 representing bottom),\n * calculates the onscreen position to display it.\n *\n * Screen size is hardcoded as 1280x720.\n *\n * @param position The display position (0 representing top and 1 representing bottom)\n * @return An object with\n *   - `y` A number represeting the onscreen position to display the note.\n *   - `projection` The projected scale. If an object is closer to the screen,\n *     it will appear bigger. This value represents that scale.\n */\nexport function getRow(position) {\n  const excess = Math.max(0, position - 1)\n  if (position < 0) position = 0\n  if (position > 1) position = 1\n  const theta = config.t0 + (config.t1 - config.t0) * position\n  const pointX = config.cx + Math.cos(theta) * config.r\n  const pointY = config.cy - Math.sin(theta) * config.r\n  const projection = config.p / (config.p - pointX)\n  const screenY = pointY * projection + 720 / 2\n  return { y: screenY + excess * 2048, projection }\n}\n\n/**\n * The world width of the play area.\n * Multiply this with the projection number to get the onscreen width.\n */\nexport const PLAY_AREA_WIDTH = config.w\n\n/**\n * Finds the touched column based on screen coordinate.\n *\n * @param {number} x The x onscreen coordinate (0~1280)\n * @param {number} y The y onscreen coordinate (0~1280)\n * @return Column name ('1'~'7') or `null` if no column should be triggered.\n */\nexport function getTouchedColumn(x, y) {\n  let min = 0.75\n  let max = 1\n  let mid\n  let row\n  for (let i = 0; i < 8; i++) {\n    mid = (min + max) / 2\n    row = getRow(mid)\n    if (row.y > y) {\n      max = mid\n    } else {\n      min = mid\n    }\n  }\n  if (mid < 0.8) return null\n  const x0 = 1280 / 2 + row.projection * -config.w\n  const x1 = 1280 / 2 + row.projection * config.w\n  let pos = Math.floor(((x - x0) / (x1 - x0)) * 7)\n  if (pos >= -1 && pos <= 7) {\n    if (pos < 0) pos = 0\n    if (pos > 6) pos = 6\n    return String(pos + 1)\n  }\n  return null\n}\n","export class Control {\n  public value = 0\n  public changed = false\n  get justPressed() {\n    return this.changed && this.value\n  }\n}\n\nexport default Control\n","import Control from './control'\nimport _ from 'lodash'\nimport bench from 'bemuse/devtools/benchmark'\n\ntype GameInputPluginInternalInstance = {\n  get(): [string, number][]\n  destroy(): void\n}\n\ninterface IGameInputPlugin {\n  name: string\n  get(): { [key: string]: number }\n  destroy?(): void\n}\n\nexport class GameInput {\n  private _controls = new Map<string, Control>()\n  private _plugins: GameInputPluginInternalInstance[] = []\n  update() {\n    const changes = new Map()\n    for (const [name, control] of this._controls) {\n      void name\n      control.changed = false\n    }\n    for (const plugin of this._plugins) {\n      for (const [name, value] of plugin.get()) {\n        changes.set(name, value)\n      }\n    }\n    for (const [name, value] of changes) {\n      const control = this.get(name)!\n      if (control.value !== value) {\n        control.changed = true\n        control.value = value\n      }\n    }\n  }\n\n  destroy() {\n    for (const plugin of this._plugins) {\n      plugin.destroy()\n    }\n  }\n\n  get(controlName: string) {\n    if (!this._controls.has(controlName)) {\n      this._controls.set(controlName, new Control())\n    }\n    return this._controls.get(controlName)!\n  }\n\n  use(plugin: IGameInputPlugin) {\n    const state: { [key: string]: number } = {}\n    const name = 'input:' + plugin.name\n    this._plugins.push({\n      get: bench.wrap(name, function () {\n        const out = plugin.get()\n        const diff = []\n        for (const key of _.union(_.keys(out), _.keys(state))) {\n          const last = +state[key] || 0\n          const current = +out[key] || 0\n          if (last !== current) diff.push([key, current])\n          state[key] = current\n        }\n        return diff\n      }),\n      destroy() {\n        if (typeof plugin.destroy === 'function') {\n          return plugin.destroy()\n        } else {\n          return true\n        }\n      },\n    })\n  }\n}\n\nexport default GameInput\n","import _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nexport enum Judgment {\n  Missed = -1,\n  Unjudged = 0,\n  Meticulous = 1,\n  Precise = 2,\n  Good = 3,\n  Offbeat = 4,\n}\n\nexport type JudgedJudgment = Exclude<Judgment, Judgment.Unjudged>\n\nexport const UNJUDGED = Judgment.Unjudged\nexport const MISSED = Judgment.Missed\n\nexport type Timegate = {\n  value: Judgment\n  timegate: number\n  endTimegate: number\n}\nexport type Timegates = Timegate[]\n\n// #region judgment timegate\nconst NORMAL_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.02, endTimegate: 0.04 },\n  { value: 2, timegate: 0.05, endTimegate: 0.1 },\n  { value: 3, timegate: 0.1, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV5_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.021, endTimegate: 0.042 },\n  { value: 2, timegate: 0.06, endTimegate: 0.12 },\n  { value: 3, timegate: 0.12, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV4_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.022, endTimegate: 0.044 },\n  { value: 2, timegate: 0.07, endTimegate: 0.14 },\n  { value: 3, timegate: 0.14, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV3_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.023, endTimegate: 0.046 },\n  { value: 2, timegate: 0.08, endTimegate: 0.16 },\n  { value: 3, timegate: 0.16, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst ABSOLUTE_BEGINNER_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.024, endTimegate: 0.048 },\n  { value: 2, timegate: 0.1, endTimegate: 0.18 },\n  { value: 3, timegate: 0.18, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\n// #endregion\n\nexport interface IJudge {\n  getTimegates(gameTime: number | null, noteTime: number | null): Timegates\n}\n\nclass FixedTimegatesJudge implements IJudge {\n  constructor(private timegates: Timegates) {}\n  getTimegates(_gameTime: number | null, _noteTime: number | null) {\n    return this.timegates\n  }\n}\n\nclass TutorialJudge implements IJudge {\n  getTimegates(_gameTime: number | null, noteTime: number | null) {\n    if (!noteTime || noteTime < 100) {\n      return ABSOLUTE_BEGINNER_TIMEGATES\n    } else {\n      return NORMAL_TIMEGATES\n    }\n  }\n}\n\nconst NORMAL_JUDGE = new FixedTimegatesJudge(NORMAL_TIMEGATES)\n\nexport function getJudgeForNotechart(\n  notechart: Notechart,\n  { tutorial = false }\n): IJudge {\n  const info = notechart.songInfo\n  const insane = info.difficulty >= 5\n  if (tutorial) {\n    return new TutorialJudge()\n  }\n  if (insane) {\n    return NORMAL_JUDGE\n  }\n  if (info.level === 1 || info.level === 2) {\n    return new FixedTimegatesJudge(ABSOLUTE_BEGINNER_TIMEGATES)\n  }\n  if (info.level === 3) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV3_TIMEGATES)\n  }\n  if (info.level === 4) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV4_TIMEGATES)\n  }\n  if (info.level === 5) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV5_TIMEGATES)\n  }\n  return NORMAL_JUDGE\n}\n\n/**\n * Takes a gameTime and noteTime and returns the appropriate judgment.\n *\n *  1 - METICULOUS\n *  2 - PRECISE\n *  3 - GOOD\n *  4 - OFFBEAT\n *  0 - (not judge)\n * -1 - MISSED\n */\nexport function judgeTimeWith(f: (timegate: Timegate) => number) {\n  return function judgeTimeWithF(\n    gameTime: number,\n    noteTime: number,\n    judge: IJudge = NORMAL_JUDGE\n  ): Judgment {\n    const timegates = judge.getTimegates(gameTime, noteTime)\n    const delta = Math.abs(gameTime - noteTime)\n    for (let i = 0; i < timegates.length; i++) {\n      if (delta < f(timegates[i])) return timegates[i].value\n    }\n    return gameTime < noteTime ? UNJUDGED : MISSED\n  }\n}\n\nexport const judgeTime = judgeTimeWith((t) => t.timegate)\nexport const judgeEndTime = judgeTimeWith((t) => t.endTimegate)\n\nexport function timegate(judgment: Judgment, judge = NORMAL_JUDGE) {\n  return _.find(judge.getTimegates(null, null), { value: judgment })!.timegate\n}\n\nexport function isBad(judgment: Judgment) {\n  return judgment >= 4\n}\n\nexport function breaksCombo(judgment: Judgment) {\n  return judgment === MISSED || isBad(judgment)\n}\n\n// #region judgment weight\nexport function weight(judgment: Judgment) {\n  if (judgment === 1) return 100\n  if (judgment === 2) return 80\n  if (judgment === 3) return 50\n  return 0\n}\n// #endregion\n","import Notechart from 'bemuse-notechart'\nimport { PlayerOptions } from 'bemuse-notechart/lib/types'\n\nexport type PlayerControlKeys =\n  | '1'\n  | '2'\n  | '3'\n  | '4'\n  | '5'\n  | '6'\n  | '7'\n  | 'SC'\n  | 'SC2'\n\nexport type PlayerOptionsPlacement = 'left' | 'center' | 'right' | '3d'\n\nexport type PlayerOptionsScratch = 'left' | 'right' | 'off'\n\nexport type PlayerOptionsGauge = 'off' | 'hope'\n\ntype PlayerOptionsInputMapping = {\n  keyboard: { [control in PlayerControlKeys]: string }\n  continuous: boolean\n  sensitivity: number\n}\n\ntype PlayerOptionsInternal = {\n  autoplayEnabled: boolean\n  autosound: boolean\n  speed: number\n  placement: PlayerOptionsPlacement\n  scratch: PlayerOptionsScratch\n  laneCover: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial: boolean\n}\n\nexport type PlayerOptionsInput = PlayerOptions & {\n  autoplayEnabled?: boolean\n  autosound?: boolean\n  speed: number\n  placement?: PlayerOptionsPlacement\n  laneCover?: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial?: boolean\n}\n\n/** The object representing the player's information, notechart and options. */\nexport class Player {\n  public readonly options: PlayerOptionsInternal\n  constructor(\n    public readonly notechart: Notechart,\n    public readonly number: number,\n    options: PlayerOptionsInput\n  ) {\n    this.options = {\n      autoplayEnabled: !!options.autoplayEnabled,\n      autosound: !!options.autosound,\n      speed: +options.speed,\n      placement: options.placement || 'center',\n      scratch: options.scratch || 'left',\n      input: options.input,\n      laneCover: +(options.laneCover || 0),\n      gauge: options.gauge,\n      tutorial: !!options.tutorial,\n    }\n  }\n\n  // An array of column names for this Notechart.\n  get columns() {\n    return this.notechart.columns\n  }\n}\n\nexport default Player\n","import _ from 'lodash'\n\nimport PlayerStats from './player-stats'\nimport {\n  MISSED,\n  getJudgeForNotechart,\n  isBad,\n  judgeEndTime,\n  judgeTime,\n  IJudge,\n  Judgment,\n  JudgedJudgment,\n} from '../judgments'\nimport Player from '../player'\nimport { GameNote } from 'bemuse-notechart/lib/types'\nimport GameInput from '../input'\nimport Control from '../input/control'\nimport invariant from 'invariant'\n\ntype NoteResult = {\n  judgment: Judgment\n  status: NoteStatus\n  delta: number\n}\n\nenum NoteStatus {\n  /** For long notes -- when the player is holding the note but not yet release it. */\n  Active = 'active',\n  /** This not is not yet judged. */\n  Unjudged = 'unjudged',\n  /** This note is fully-judged. */\n  Judged = 'judged',\n}\n\ntype Notifications = {\n  sounds: (\n    | { type: 'hit'; note: GameNote; judgment: Judgment }\n    | { type: 'free'; note: GameNote }\n    | { type: 'break'; note: GameNote }\n  )[]\n  judgments: {}[]\n}\n\nfunction initializeNotifications(): Notifications {\n  return { sounds: [], judgments: [] }\n}\n\n// The PlayerState class holds a single player's state, including the stats\n// (score, current combo, maximum combo).\nexport class PlayerState {\n  /** The PlayerStats object. */\n  public stats: PlayerStats\n\n  /** The notifications from the previous update. */\n  public notifications = initializeNotifications()\n  /** The current note scrolling speed. */\n  public speed: number\n  /** `true` if finished playing, `false` otherwise. */\n  public finished = false\n  /** `true` if score is invalid due to autoplay being activated. `false` otherwise. */\n  public tainted = false\n  public input: Map<string, Control> = new Map()\n\n  private _columns: string[]\n  private _noteBufferByColumn: _.Dictionary<NoteBuffer>\n  private _noteResult: Map<GameNote, NoteResult>\n  private _duration: number\n  private _judge: IJudge\n  private _gameTime = 0\n  private _rawInput?: GameInput\n  private _pinching: null | { start: number; speed: number } = null\n\n  constructor(public readonly player: Player) {\n    this._columns = player.columns\n    this._noteBufferByColumn = _(player.notechart.notes)\n      .sortBy((n) => n.time)\n      .groupBy((n) => n.column)\n      .mapValues(noteBuffer(this))\n      .value()\n    this._noteResult = new Map()\n    this._duration = player.notechart.duration\n    this._judge = getJudgeForNotechart(player.notechart, {\n      tutorial: player.options.tutorial,\n    })\n    this.stats = new PlayerStats(player.notechart)\n    this.speed = player.options.speed\n  }\n\n  /**\n   * Updates the state. Judge the notes and emit notifications.\n   */\n  update(gameTime: number, input: GameInput) {\n    this._gameTime = gameTime\n    this._rawInput = input\n    this.notifications = initializeNotifications()\n    this._updateInputColumnMap()\n    this._judgeNotes()\n    this._updateSpeed()\n    if (gameTime > this._duration + 3) this.finished = true\n  }\n\n  getNoteStatus(note: GameNote): NoteStatus {\n    const result = this._noteResult.get(note)\n    if (!result) return NoteStatus.Unjudged\n    return result.status\n  }\n\n  getNoteJudgment(note: GameNote) {\n    const result = this._noteResult.get(note)\n    if (!result) return Judgment.Unjudged\n    return result.judgment\n  }\n\n  getPlayerInput(control: string) {\n    return this._rawInput!.get(`p${this.player.number}_${control}`)!\n  }\n\n  _updateInputColumnMap() {\n    this.input = new Map(\n      this._columns.map((column) => [column, this.getPlayerInput(column)])\n    )\n  }\n\n  _judgeNotes() {\n    for (const column of this._columns) {\n      const buffer = this._noteBufferByColumn[column]\n      if (buffer) {\n        const control = this.input.get(column)!\n        this._judgeColumn(buffer, control, column)\n        buffer.update()\n      }\n    }\n  }\n\n  _updateSpeed() {\n    if (this.getPlayerInput('speedup').justPressed) {\n      this._modifySpeed(+1)\n    }\n    if (this.getPlayerInput('speeddown').justPressed) {\n      this._modifySpeed(-1)\n    }\n    const pinch = this.getPlayerInput('pinch').value\n    if (pinch && !this._pinching) {\n      this._pinching = { start: pinch, speed: this.speed }\n    } else if (!pinch) {\n      this._pinching = null\n    }\n    if (pinch && this._pinching) {\n      const pinching = this._pinching\n      const speed = (pinching.speed * pinch) / pinching.start\n      this.speed = Math.max(0.2, Math.round(speed * 10) / 10)\n    }\n  }\n\n  _modifySpeed(direction: 1 | -1) {\n    const amount = this._rawInput!.get('select').value\n      ? 0.1\n      : this.speed < 0.5\n      ? 0.3\n      : 0.5\n    this.speed += direction * amount\n    if (this.speed < 0.2) this.speed = 0.2\n  }\n\n  _shouldAutoplay() {\n    return this.player.options.autoplayEnabled || isAutoplayEnabled()\n  }\n\n  _judgeColumn(buffer: NoteBuffer, control: Control, column: string) {\n    let judgedNote\n    let judgment\n    const notes = buffer.notes\n    let autoPlayed = false\n    for (let i = buffer.startIndex; i < notes.length; i++) {\n      const note = notes[i]\n      if (this._shouldJudge(note, control, buffer)) {\n        const shouldBreak = this.getNoteStatus(note) !== 'active'\n        judgedNote = note\n        judgment = this._judgeNote(note)\n        if (this._shouldAutoplay()) {\n          autoPlayed = true\n        }\n        if (shouldBreak) break\n      }\n    }\n    if (control.justPressed || autoPlayed) {\n      if (judgedNote && judgment != null) {\n        this.notifications.sounds!.push({\n          note: judgedNote,\n          type: 'hit',\n          judgment: judgment,\n        })\n      } else {\n        const freestyleNote = this._getFreestyleNote(notes)\n        if (freestyleNote) {\n          const shouldPlayFreestyleNote =\n            this.player.options.placement !== '3d' ||\n            !this._isSandwiched(column)\n          if (shouldPlayFreestyleNote) {\n            this.notifications.sounds!.push({\n              note: freestyleNote,\n              type: 'free',\n            })\n          }\n        }\n      }\n    }\n  }\n\n  _getClosestNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => Math.abs(this._gameTime - note.time))\n  }\n\n  _getFreestyleNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => {\n      const distance = Math.abs(this._gameTime - note.time)\n      const penalty = this._gameTime < note.time - 1 ? 1000000 : 0\n      return distance + penalty\n    })\n  }\n\n  _isSandwiched(column: string) {\n    const mapping: { [col: string]: string[] } = {\n      '2': ['1', '3'],\n      '3': ['2', '4'],\n      '4': ['3', '5'],\n      '5': ['4', '6'],\n      '6': ['5', '7'],\n    }\n    if (!mapping[column]) return false\n    return mapping[column].every((adjacentColumn) => {\n      const buffer = this._noteBufferByColumn[adjacentColumn]\n      if (!buffer) return false\n      return buffer.notes.some(\n        (note) => Math.abs(this._gameTime - note.time) < 0.1\n      )\n    })\n  }\n\n  _shouldJudge(note: GameNote, control: Control, buffer: NoteBuffer) {\n    const status = this.getNoteStatus(note)\n    if (status === 'unjudged') {\n      if (this._shouldAutoplay() && this._gameTime >= note.time) {\n        this.tainted = true\n        return true\n      }\n      const judgment = judgeTime(this._gameTime, note.time, this._judge)\n      const missed = judgment === MISSED\n      let hit = judgment > 0 && control.changed && control.value\n      if (isBad(judgment) && this._getClosestNote(buffer.notes) !== note) {\n        hit = false\n      }\n      return missed || hit\n    } else if (status === 'active') {\n      const noteEnd = note.end || invariant(false, 'note.end must exist')\n      if (this._shouldAutoplay() && this._gameTime >= noteEnd.time) {\n        this.tainted = true\n        return true\n      }\n      const judgment = judgeEndTime(this._gameTime, noteEnd.time, this._judge)\n      const missed = judgment === MISSED\n      const lifted = control.changed\n      const scratch = note.column === 'SC'\n      const passed = this._gameTime >= noteEnd.time\n      return missed || lifted || (scratch && passed)\n    } else {\n      return false\n    }\n  }\n\n  _judgeNote(note: GameNote) {\n    let delta = this._gameTime - note.time\n    let judgment = judgeTime(this._gameTime, note.time, this._judge)\n    let result = this._noteResult.get(note)\n    const isDown = !result || result.status === 'unjudged'\n    const isUp = result && result.status === 'active'\n    if (this._shouldAutoplay() && judgment >= 1) {\n      judgment = 1\n    }\n    if (note.end) {\n      if (isDown) {\n        const status =\n          judgment === MISSED ? NoteStatus.Judged : NoteStatus.Active\n        if (judgment === MISSED) {\n          // judge missed long note twice\n          this._setJudgment(judgment, delta, note.column)\n        }\n        result = { status, judgment, delta }\n      } else if (isUp) {\n        const scratch = note.column === 'SC'\n        delta = this._gameTime - note.end.time\n        judgment =\n          judgeEndTime(this._gameTime, note.end.time, this._judge) || MISSED\n        if (scratch && delta > 0) judgment = 1\n        result = { status: NoteStatus.Judged, judgment, delta }\n      }\n    } else {\n      result = { status: NoteStatus.Judged, judgment, delta }\n    }\n    if (judgment === MISSED) {\n      this.notifications.sounds.push({ note, type: 'break' })\n    }\n    if (isDown && judgment !== MISSED) {\n      this.stats.handleDelta(delta)\n    }\n    if (!result) {\n      throw new Error('Invariant violation: result must not be undefined')\n    }\n    if (!judgment) {\n      throw new Error(\n        'Invariant violation: note should be judged by this point'\n      )\n    }\n    this._noteResult.set(note, result)\n    this._setJudgment(judgment, delta, note.column)\n    return judgment\n  }\n\n  _setJudgment(judgment: JudgedJudgment, delta: number, column: string) {\n    this.stats.handleJudgment(judgment)\n    const info = { judgment, combo: this.stats.combo, delta, column }\n    this.notifications.judgments.push(info)\n  }\n}\n\ntype NoteBuffer = {\n  notes: GameNote[]\n  startIndex: number\n  update: () => void\n}\n\nfunction isAutoplayEnabled() {\n  return !!(window as any).BEMUSE_AUTOPLAY\n}\n\nfunction noteBuffer(state: PlayerState) {\n  return function bufferNotes(notes: GameNote[]): NoteBuffer {\n    let startIndex = 0\n    return {\n      notes,\n      get startIndex() {\n        return startIndex\n      },\n      update() {\n        while (\n          startIndex < notes.length &&\n          state.getNoteStatus(notes[startIndex]) === 'judged'\n        ) {\n          startIndex += 1\n        }\n      },\n    }\n  }\n}\n\nexport default PlayerState\n","import * as Judgments from '../judgments'\n\nimport _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nconst getAccuracyScore = (accuracy: number) => Math.floor(accuracy * 500000)\nconst getComboScore = (sum: number, total: number) =>\n  Math.floor((sum * 55555) / total)\n\nexport class PlayerStats {\n  public totalCombo: number\n  public totalNotes: number\n  public combo: number\n  public maxCombo: number\n  public rawSumJudgmentWeight: number\n  public rawTotalComboScore: number\n  public rawSumComboScore: number\n  public counts: { [k in Judgments.JudgedJudgment]: number }\n  public numJudgments: number\n  public poor: boolean\n  public deltas: number[]\n\n  private _remainingMaxPossibleRawComboScore: number\n  private _log: { character: string; count: number }[]\n\n  constructor(notechart: Notechart) {\n    this.totalCombo = _(notechart.notes)\n      .map((note) => notechart.info(note)!.combos)\n      .sum()\n    this.totalNotes = notechart.notes.length\n    this.combo = 0\n    this.maxCombo = 0\n    this.rawSumJudgmentWeight = 0\n    this.rawTotalComboScore = this._calculateRawTotalComboScore(this.totalCombo)\n    this._remainingMaxPossibleRawComboScore = this.rawTotalComboScore\n    this.rawSumComboScore = 0\n    this.counts = { [Judgments.MISSED]: 0, '1': 0, '2': 0, '3': 0, '4': 0 }\n    this.numJudgments = 0\n    this.poor = false\n    this._log = []\n    this.deltas = []\n  }\n\n  get score() {\n    // #region score\n    return this.accuracyScore + this.comboScore\n    // #endregion\n  }\n\n  get accuracyScore() {\n    return getAccuracyScore(this.accuracy)\n  }\n\n  get comboScore() {\n    return getComboScore(this.rawSumComboScore, this.rawTotalComboScore)\n  }\n\n  get maxPossibleScore() {\n    return this.maxPossibleAccuracyScore + this.maxPossibleComboScore\n  }\n\n  get maxPossibleAccuracyScore() {\n    const remainingJudgments = this.totalCombo - this.numJudgments\n    const maxPossibleRawWeight =\n      this.rawSumJudgmentWeight + Judgments.weight(1) * remainingJudgments\n    const maxPossibleAccuracy =\n      maxPossibleRawWeight / (Judgments.weight(1) * this.totalCombo)\n    return getAccuracyScore(maxPossibleAccuracy)\n  }\n\n  get maxPossibleComboScore() {\n    const maxPossibleRawComboScore =\n      this.rawSumComboScore + this._remainingMaxPossibleRawComboScore\n    return getComboScore(maxPossibleRawComboScore, this.rawTotalComboScore)\n  }\n\n  get accuracy() {\n    return this.rawSumJudgmentWeight / (Judgments.weight(1) * this.totalCombo)\n  }\n\n  get currentAccuracy() {\n    return (\n      this.rawSumJudgmentWeight / (Judgments.weight(1) * this.numJudgments || 1)\n    )\n  }\n\n  get log() {\n    return this._log\n      .map(({ character, count }) => `${count > 1 ? count : ''}${character}`)\n      .join('')\n  }\n\n  handleJudgment(judgment: Judgments.JudgedJudgment) {\n    this.counts[judgment] += 1\n    this.numJudgments += 1\n    if (Judgments.breaksCombo(judgment)) {\n      const remainingJudgments = this.totalCombo - this.numJudgments\n      this.combo = 0\n      this.poor = true\n      this._remainingMaxPossibleRawComboScore =\n        this._calculateRawTotalComboScore(remainingJudgments)\n    } else {\n      this.combo += 1\n      const rawComboScore = this._calculateRawComboScore(this.combo)\n      this.rawSumComboScore += rawComboScore\n      this._remainingMaxPossibleRawComboScore -= rawComboScore\n      this.poor = false\n    }\n    this.rawSumJudgmentWeight += Judgments.weight(judgment)\n    if (this.combo > this.maxCombo) {\n      this.maxCombo = this.combo\n    }\n    this._recordLog(judgment)\n  }\n\n  handleDelta(delta: number) {\n    this.deltas.push(delta)\n  }\n\n  private _calculateRawTotalComboScore(total: number) {\n    let sum = 0\n    for (let i = 1; i <= total; i++) {\n      sum += this._calculateRawComboScore(i)\n    }\n    return sum\n  }\n\n  private _calculateRawComboScore(i: number) {\n    // #region combo\n    if (i === 0) return 0\n    if (i < 23) return 1\n    if (i < 51) return 2\n    if (i < 92) return 3\n    if (i < 161) return 4\n    return 5\n    // #endregion\n  }\n\n  private _recordLog(judgment: Judgments.JudgedJudgment) {\n    const character = this._getLogCharacter(judgment)\n    if (character) {\n      if (\n        this._log.length === 0 ||\n        this._log[this._log.length - 1].character !== character\n      ) {\n        this._log.push({ character, count: 1 })\n      } else {\n        this._log[this._log.length - 1].count += 1\n      }\n    }\n  }\n\n  private _getLogCharacter(judgment: Judgments.JudgedJudgment) {\n    switch (judgment) {\n      case 1:\n        return 'A'\n      case 2:\n        return 'B'\n      case 3:\n        return 'C'\n      case 4:\n        return 'D'\n      case Judgments.MISSED:\n        return 'M'\n    }\n  }\n}\n\nexport default PlayerStats\n","export function forModule(moduleName: string) {\n  return {\n    info: bindLogger(moduleName, 'info'),\n    warn: bindLogger(moduleName, 'warn'),\n    error: bindLogger(moduleName, 'error'),\n  }\n}\n\nfunction bindLogger(moduleName: string, level: 'info' | 'warn' | 'error') {\n  return (...args: any[]) => {\n    console.log(\n      `[${new Date().toJSON()}] [${moduleName}] [${level}] ${require('util').format(\n        ...args\n      )}`\n    )\n  }\n}\n","import Bacon from 'baconjs'\n\nfunction observeMidiAccess(access) {\n  return Bacon.fromBinder((sink) => {\n    for (const port of access.inputs.values()) {\n      sink(new Bacon.Next(port))\n    }\n    for (const port of access.outputs.values()) {\n      sink(new Bacon.Next(port))\n    }\n    access.onstatechange = (e) => {\n      sink(new Bacon.Next(e.port))\n    }\n  })\n}\n\nfunction requestMIDIAccess() {\n  if (!navigator.requestMIDIAccess) {\n    return Promise.reject(new Error('MIDI is not supported'))\n  }\n  return navigator.requestMIDIAccess()\n}\n\nexport function getMidi川() {\n  return Bacon.fromPromise(requestMIDIAccess())\n    .flatMap(observeMidiAccess)\n    .flatMapError((e) => (console.warn('MIDI Error:', e.stack), Bacon.never()))\n    .flatMap(message川ForPort)\n    .doLog('messageforport')\n}\n\nfunction message川ForPort(port) {\n  if (port.type !== 'input') return Bacon.never()\n  return Bacon.fromEvent(port, 'midimessage')\n}\n\nexport default getMidi川\n","export class AxisLogic {\n  private stop = 1\n  private charge = 0\n  private previous: false | number = false\n  private active = false\n  private positive = false\n\n  public update(axis: number, threshold: number = 3) {\n    if (this.previous === false) {\n      this.previous = axis\n      return 0\n    }\n\n    if (this.previous !== axis) {\n      let delta = axis - this.previous\n      if (delta > 1) {\n        delta -= 2 + 0.005\n      } else if (delta < -1) {\n        delta += 2 + 0.005\n      }\n\n      const immediateOutput = delta > 0\n\n      if (this.active && this.positive !== immediateOutput) {\n        this.positive = immediateOutput\n        this.active = false\n        this.charge = 0\n      } else if (!this.active) {\n        if (this.charge === 0 || this.stop <= threshold) {\n          this.charge += Math.ceil(Math.abs(delta) / 0.01)\n        }\n\n        if (this.charge >= 2) {\n          this.active = true\n          this.positive = immediateOutput\n        }\n      }\n\n      this.stop = 0\n      this.previous = axis\n    }\n\n    if (this.stop > threshold * 2) {\n      this.active = false\n      this.charge = 0\n      this.stop = 0\n    }\n\n    this.stop += 1\n\n    return this.active ? (this.positive ? 1 : -1) : 0\n  }\n}\n","import keycode from 'keycode'\nimport _ from 'lodash'\nimport Bacon from 'baconjs'\nimport getMidi川 from './midi'\nimport { AxisLogic } from './axis-logic'\n\n// Public: OmniInput is a poll-based class that handles the key-pressed state of\n// multiple inputs.\n//\n// Each call to `update()` returns a mapping of active inputs. This object may\n// be reused and mutated by OmniInput for performance reasons, and thus the\n// caller SHOULD NOT hold on to or mutate it.\n//\n// ## Keys\n//\n// The key is a string that identifies some key on each input.\n// It follows the following convention:\n//\n// - `65` A keyboard keycode.\n// - `gamepad.0.button.3` A gamepad button.\n// - `gamepad.0.axis.3.positive` A gamepad axis (positive value).\n// - `gamepad.0.axis.3.negative` A gamepad axis (negative value).\n// - `midi.[id].[channel].note.[note]` A MIDI note.\n// - `midi.[id].[channel].sustain` Sustain pedal.\n// - `midi.[id].[channel].mod` Modulation level.\n// - `midi.[id].[channel].pitch.up` Pitch bend (up).\n// - `midi.[id].[channel].pitch.down` Pitch bend (down).\n//\nexport class OmniInput {\n  constructor(win = window, options = {}) {\n    const midi川 = (options.getMidi川 || getMidi川)()\n    this._window = win\n    this._exclusive = !!options.exclusive\n    this._continuousAxis = !!options.continuous\n    this.setGamepadSensitivity(options.sensitivity || 3)\n\n    this._disposables = [\n      listen(win, 'keydown', (e) => this._handleKeyDown(e)),\n      listen(win, 'keyup', (e) => this._handleKeyUp(e)),\n      midi川.onValue((e) => this._handleMIDIMessage(e)),\n    ]\n    this._status = {}\n    this._axis = {}\n  }\n\n  _handleKeyDown(e) {\n    this._status[`${e.which}`] = true\n    if (this._exclusive) e.preventDefault()\n  }\n\n  _handleKeyUp(e) {\n    this._status[`${e.which}`] = false\n  }\n\n  _handleMIDIMessage(e) {\n    if (!e || !e.data) return\n    const data = e.data\n    const prefix = `midi.${e.target.id}.${e.data[0] & 0x0f}`\n    const handleNote = (state) => {\n      this._status[`${prefix}.note.${data[1]}`] = state\n    }\n    if ((data[0] & 0xf0) === 0x80) {\n      // NoteOff\n      handleNote(false)\n    } else if ((data[0] & 0xf0) === 0x90) {\n      // NoteOn\n      if (data[2] > 0x0) {\n        // NoteOn (really)\n        handleNote(true)\n      } else {\n        // NoteOff disguised as NoteOn\n        handleNote(false)\n      }\n    } else if ((data[0] & 0xf0) === 0xb0) {\n      // CC\n      if (data[1] === 0x40) {\n        // Sustain\n        this._status[`${prefix}.sustain`] = data[2] >= 64\n      } else if (data[1] === 0x01) {\n        // Modulation\n        this._status[`${prefix}.mod`] = data[2] >= 16\n      }\n    } else if ((data[0] & 0xf0) === 0xe0) {\n      // Pitch Bend\n      const bend = data[1] | (data[2] << 7)\n      this._status[`${prefix}.pitch.up`] = bend >= 0x2100\n      this._status[`${prefix}.pitch.down`] = bend < 0x1f00\n    }\n  }\n\n  _updateGamepads() {\n    const nav = this._window.navigator\n    const gamepads = nav.getGamepads\n      ? nav.getGamepads()\n      : nav.webkitGetGamepads\n      ? nav.webkitGetGamepads()\n      : []\n    if (!gamepads) return\n    for (let i = 0; i < gamepads.length; i++) {\n      const gamepad = gamepads[i]\n      if (gamepad) {\n        this._updateGamepad(gamepad)\n      }\n    }\n  }\n\n  _updateGamepad(gamepad) {\n    const prefix = `gamepad.${gamepad.index}`\n    for (let i = 0; i < gamepad.buttons.length; i++) {\n      const button = gamepad.buttons[i]\n      this._status[`${prefix}.button.${i}`] = button && button.value >= 0.5\n    }\n    for (let i = 0; i < gamepad.axes.length; i++) {\n      const axisName = `${prefix}.axis.${i}`\n      let axis = gamepad.axes[i]\n\n      if (this._continuousAxis) {\n        if (this._axis[axisName] == null) {\n          this._axis[axisName] = new AxisLogic()\n        }\n        axis = this._axis[axisName].update(axis)\n      }\n\n      this._status[`${axisName}.positive`] = axis >= this._deadzone\n      this._status[`${axisName}.negative`] = axis <= -this._deadzone\n    }\n  }\n\n  update() {\n    this._updateGamepads()\n    return this._status\n  }\n\n  setGamepadSensitivity(sensitivity) {\n    this._sensitivity = sensitivity\n    this._deadzone = (9 - this._sensitivity) * 0.05\n    if (this._deadzone < 0.01) this._deadzone = 0.01\n    this._analogThreshold = 18 - this._sensitivity * 2\n  }\n\n  setGamepadContinuousAxisEnabled(enabled) {\n    this._continuousAxis = enabled\n  }\n\n  dispose() {\n    for (const dispose of this._disposables) {\n      dispose()\n    }\n  }\n}\n\n// Public: Returns a Bacon EventStream of keys pressed.\n//\nexport function key川(input = new OmniInput(), win = window) {\n  return _key川ForUpdate川(\n    Bacon.fromBinder((sink) => {\n      const handle = win.setInterval(() => {\n        sink(new Bacon.Next(input.update()))\n      }, 16)\n      return () => win.clearInterval(handle)\n    })\n  )\n}\n\nexport function _key川ForUpdate川(update川) {\n  return update川\n    .map((update) => Object.keys(update).filter((key) => update[key]))\n    .diff([], (previous, current) => _.difference(current, previous))\n    .flatMap((array) => Bacon.fromArray(array))\n}\n\nexport default OmniInput\n\nconst knownMidiIds = {}\n\nexport function getName(key) {\n  if (+key) {\n    return _.capitalize(keycode(+key))\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.axis\\.(\\d+)\\.(\\w+)/)\n    if (match) {\n      return `Joy${match[1]} Axis${match[2]} (${\n        match[3] === 'positive' ? '+' : '-'\n      })`\n    }\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.button\\.(\\d+)/)\n    if (match) {\n      return `Joy${match[1]} Btn${match[2]}`\n    }\n  }\n  {\n    const match = key.match(/^midi\\.(.+)\\.(\\d+)\\.(.+)$/)\n    if (match) {\n      const rest = match[3].split('.')\n      const id = match[1]\n      const midiDeviceNumber =\n        knownMidiIds[id] ||\n        (knownMidiIds[id] = Object.keys(knownMidiIds).length + 1)\n      const prefix = `MIDI${midiDeviceNumber} Ch${+match[2] + 1}`\n      if (rest[0] === 'note') {\n        const midiNote = +rest[1]\n        const lookup = [\n          'C',\n          'C#',\n          'D',\n          'D#',\n          'E',\n          'F',\n          'F#',\n          'G',\n          'G#',\n          'A',\n          'A#',\n          'B',\n        ]\n        const noteName = lookup[midiNote % 12]\n        const octave = Math.floor(midiNote / 12) - 1\n        return `${prefix} ${noteName}${octave}`\n      }\n      if (rest[0] === 'pitch') {\n        return `${prefix} Pitch${rest[1] === 'up' ? '+' : '-'}`\n      }\n      if (rest[0] === 'sustain') return 'Sustain'\n      if (rest[0] === 'mod') return 'Mod'\n    }\n  }\n  return `${String(key).replace(/\\./g, ' ')}?`\n}\n\nfunction listen(subject, eventName, listener) {\n  subject.addEventListener(eventName, listener)\n  return function dispose() {\n    subject.removeEventListener(eventName, listener)\n  }\n}\n","import Observable from 'bemuse/utils/observable'\n\ninterface IProgressFormatter {\n  (progress: Progress): string\n}\n\n/**\n * The Progress class represents the progress of an asynchronous operation.\n * It is inspired by C#'s IProgress interface.\n *\n * See: http://blogs.msdn.com/b/dotnet/archive/2012/06/06/async-in-4-5-enabling-progress-and-cancellation-in-async-apis.aspx\n */\nexport class Progress {\n  /** The current progress (out of `Progress#total`). */\n  public current: number | undefined = undefined\n  /** Total progress value */\n  public total: number | undefined = undefined\n  /** Some arbitrary information associated with this Progress. */\n  public extra: any\n  /**\n   * The formatter of this progress. This formatter will be used to compute\n   * the text representation of this progress (`Progress#toString`).\n   */\n  public formatter?: IProgressFormatter\n  private _observable = new Observable<void>()\n  /**\n   * Updates the progress.\n   */\n  report(current: number, total: number, extra?: any) {\n    this.current = current\n    this.total = total\n    this.extra = extra\n    this._observable.notify()\n  }\n\n  /**\n   * Attaches a progress listener function to this progress.\n   * The function `f` will be called immediately and synchronously upon watching,\n   * and will be called when the progress value is updated.\n   * @param f\n   * @returns a function that, when called, unsubscribes this listener.\n   */\n  watch(f: (progress: Progress) => void) {\n    f(this)\n    return this._observable.watch(() => f(this))\n  }\n\n  /**\n   * The current progress as a fraction (out of 1).\n   */\n  get progress() {\n    if (this.total && this.current !== undefined && this.current !== null) {\n      return this.current / this.total\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * Returns a string representation of this progress instance.\n   * This method is used for displaying the progress as a text.\n   */\n  toString() {\n    if (this.formatter !== undefined) {\n      return this.formatter(this)\n    } else if (this.progress !== null) {\n      return this.current + ' / ' + this.total\n    } else {\n      return ''\n    }\n  }\n}\n","import bytes from 'bytes'\n\nconst wrap = (f) => (progress) => progress.progress !== null ? f(progress) : ''\n\n// Formats the `Progress` as bytes (e.g. 1.23mb of 1.31mb).\nexport const BYTES_FORMATTER = wrap(\n  (progress) => bytes(progress.current) + ' / ' + bytes(progress.total)\n)\n\n// Formats the `Progress` as percentage.\nexport const PERCENTAGE_FORMATTER = wrap(\n  (progress) => ((progress.current / progress.total) * 100).toFixed(1) + '%'\n)\n\n// Formats the `Progress` simply by using the value of `Progress#extra`.\nexport const EXTRA_FORMATTER = wrap((progress) => progress.extra + '')\n","// !! avoid external dependencies since this is used in boot script!\n\nimport { Progress } from './Progress'\nexport default Progress\n","import { BYTES_FORMATTER } from 'bemuse/progress/formatters'\nimport { Progress } from './Progress'\n\n/**\n * Returns a callback that, when called,\n * update the progress with increasing `current` value,\n * out of a fixed `total`.\n */\nexport function fixed(total: number, progress: Progress) {\n  if (!progress) return () => {}\n  let loaded = 0\n  progress.report(0, total)\n  return (extra: any) => progress.report(++loaded, total, extra)\n}\n\n/**\n * Updates the progress with the result of an atomic operation.\n */\nexport async function atomic<T>(\n  progress: Progress,\n  promise: PromiseLike<T>\n): Promise<T> {\n  if (!progress) return promise\n  const data = await Promise.resolve(promise)\n  if (hasByteLength(data)) {\n    progress.formatter = BYTES_FORMATTER\n    progress.report(data.byteLength, data.byteLength)\n  } else {\n    progress.report(1, 1)\n  }\n  return data\n}\nfunction hasByteLength(data: any): data is { byteLength: number } {\n  return data && data.byteLength\n}\n\n/**\n * Wraps an async function that may be called multiple times.\n * Each call adds to the total, and each async resolution adds to current.\n */\nexport function wrapPromise<A extends any[], R>(\n  progress: Progress,\n  f: (...args: A) => PromiseLike<R>\n): (...args: A) => PromiseLike<R> {\n  let current = 0\n  let total = 0\n  return async function (this: any, ...args: A) {\n    progress.report(current, ++total)\n    const ret = await f.apply(this, args)\n    progress.report(++current, total)\n    return ret\n  }\n}\n\nexport function bind(from: Progress, to: Progress) {\n  return from.watch(() => to.report(from.current!, from.total!, from.extra))\n}\n\n/**\n * Updates the `target` with progress data from multiple sources.\n */\nexport function simultaneous(target: Progress) {\n  const queue: Progress[] = []\n  let current: Progress | undefined\n  let unsubscribe: (() => void) | null = null\n  function update() {\n    if (current) {\n      target.report(current.current!, current.total!, current.extra)\n    }\n    if (queue.length > 0 && (!current || current.progress! >= 1)) {\n      bind(queue.shift()!)\n    }\n  }\n  function bind(progress: Progress) {\n    if (current === progress) {\n      return\n    }\n    if (unsubscribe) {\n      unsubscribe()\n      unsubscribe = null\n    }\n    current = progress\n    if (current) {\n      unsubscribe = current.watch(update)\n    }\n  }\n  return {\n    add(progress: Progress) {\n      queue.push(progress)\n      update()\n    },\n  }\n}\n","export function addUnprefixed(\n  prefix: string,\n  name: string,\n  callback: (path: string) => void\n) {\n  if (name.match(/\\.(?:bms|bme|bml|bmson)/i)) {\n    callback(name)\n    return\n  }\n  const parts = (prefix + name).split('/')\n  for (let i = 0; i < parts.length; i++) {\n    callback(parts.slice(i).join('/'))\n  }\n}\n","import { LoggingFunction } from './types'\n\nexport default class ResourceLogging {\n  private buffer: string[] | null = []\n  private loggingFunction: LoggingFunction = (text) => {\n    if (this.buffer) this.buffer.push(text)\n  }\n\n  public log: LoggingFunction = (text) => {\n    this.loggingFunction(text)\n  }\n\n  setLoggingFunction = (fn: LoggingFunction) => {\n    this.loggingFunction = fn\n    if (this.buffer) {\n      this.buffer.forEach((text) => fn(text))\n      this.buffer = null\n    }\n  }\n}\n","import { Archive } from 'libarchive.js/main.js'\nimport { addUnprefixed } from './addUnprefixed'\nimport { FileEntry } from './types'\n\nArchive.init({\n  workerUrl: '/vendor/libarchive.js-1.3.0/dist/worker-bundle.js',\n})\n\nexport async function unarchive(file: File): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const archive = await Archive.open(file)\n  const extracted = await archive.extractFiles()\n  const traverse = (tree: any, prefix = '') => {\n    for (const key of Object.keys(tree)) {\n      if (tree[key] instanceof File) {\n        addUnprefixed(prefix, key, (name) => {\n          out.push({ name, file: tree[key] })\n        })\n      } else if (tree[key] && typeof tree[key] === 'object') {\n        traverse(tree[key], prefix + key + '/')\n      }\n    }\n  }\n  traverse(extracted)\n  return out\n}\n","import * as ProgressUtils from 'bemuse/progress/utils'\nimport {\n  FileEntry,\n  LoggingFunction,\n  IResource,\n  ICustomSongResources,\n} from './types'\nimport ResourceLogging from './resource-logging'\nimport { unarchive } from './unarchiver'\nimport readBlob from 'bemuse/utils/read-blob'\nimport Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\n\nexport const ARCHIVE_REGEXP = /\\.(?:zip|rar|7z|tar(?:\\.(?:gz|bz2))?)/i\n\n// http://nekokan.dyndns.info/tool/DropboxReplacer/index.html\nconst DROPBOX_REGEXP =\n  /https?:\\/\\/(?:(?:www|dl)\\.dropbox\\.com|dl\\.dropboxusercontent\\.com)\\/(sh?)\\/([^?]*)(.*)?$/\n\n/**\n * A resource provider for custom songs.\n * It may retrieve the files from, e.g., a drag and drop event or an `?archive` flag.\n */\nexport interface CustomResourceProvider {\n  getFiles(loggingFunction: LoggingFunction): PromiseLike<FileEntry[]>\n}\n\n/**\n * An IResources for songs provided by a CustomResourceProvider.\n */\nexport class CustomSongResources implements ICustomSongResources {\n  private _logging = new ResourceLogging()\n  private _files: PromiseLike<FileEntry[]>\n  public setLoggingFunction = this._logging.setLoggingFunction\n\n  constructor(provider: CustomResourceProvider) {\n    this._files = Promise.resolve(provider.getFiles(this._logging.log)).then(\n      (files) => unarchiveIfNeeded(files, this._logging.log)\n    )\n  }\n\n  file(name: string) {\n    return this._files.then(function (files) {\n      for (const file of files) {\n        if (file.name.toLowerCase() === name.toLowerCase()) {\n          return new FileResource(file.file)\n        }\n      }\n      throw new Error('unable to find ' + name)\n    })\n  }\n\n  get fileList(): Promise<string[]> {\n    return Promise.resolve(this._files).then((a) => a.map((f) => f.name))\n  }\n}\n\nexport class FileResource implements IResource {\n  constructor(private _file: File) {}\n  read(progress: Progress) {\n    return ProgressUtils.atomic(\n      progress,\n      readBlob(this._file).as('arraybuffer')\n    )\n  }\n\n  resolveUrl() {\n    return Promise.resolve(URL.createObjectURL(this._file))\n  }\n\n  get name() {\n    return this._file.name\n  }\n}\n\n/**\n * If only 1 FileEntry is present and it is an archive file, extract it.\n */\nexport async function unarchiveIfNeeded(\n  files: FileEntry[],\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  if (files.length !== 1) return files\n  const fileEntry = files[0]\n  if (!fileEntry.name.match(ARCHIVE_REGEXP)) {\n    return files\n  }\n  log('Archive file detected! Now unarchiving…')\n  return unarchive(fileEntry.file)\n}\n\n/**\n * Downloads a URL as a FileEntry.\n */\nexport async function downloadFileEntryFromURL(\n  url: string,\n  log: LoggingFunction\n): Promise<FileEntry> {\n  const name = url\n    .replace(/[?#].*/, '')\n    .split('/')\n    .pop()!\n\n  // Try Dropbox URL replacement\n  const match = url.match(DROPBOX_REGEXP)\n  if (match) {\n    url = `https://dl.dropboxusercontent.com/${match[1]}/${match[2]}`\n  }\n\n  const progress = new Progress()\n  let lastTime = 0\n  progress.watch(() => {\n    if (Date.now() < lastTime + 5e3) return\n    log(`Downloading: ${progress}`)\n    lastTime = Date.now()\n  })\n  const blob = await download(url).as('blob', progress)\n  return { name, file: blob }\n}\n","import Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\nimport { basename } from 'path'\nimport { IResource, IResources } from './types'\n\nexport class URLResource implements IResource {\n  constructor(private url: string) {}\n  read(progress: Progress) {\n    return download(this.url).as('arraybuffer', progress)\n  }\n\n  async resolveUrl() {\n    return Promise.resolve(this.url)\n  }\n\n  get name() {\n    return basename(this.url)\n  }\n}\n\nexport class URLResources implements IResources {\n  constructor(public base: URL) {}\n  async file(name: string): Promise<IResource> {\n    const path = name\n      .split('/')\n      .map((part) => encodeURIComponent(part))\n      .join('/')\n    return new URLResource(new URL(path, this.base).href)\n  }\n}\n\nexport default URLResource\n","// !! avoid external dependencies since this is used in boot script!\n\ntype CallbackEffect<T extends any[]> = (...args: T) => void\n\n/**\n * A utility class to hold a collection of callbacks.\n */\nexport class Callbacks<T extends any[]> {\n  private _callbacks: { [id: number]: CallbackEffect<T> } = {}\n  private _nextId = 1\n  constructor(init?: CallbackEffect<T>[] | CallbackEffect<T>) {\n    if (typeof init === 'function') {\n      this.add(init)\n    } else if (typeof init === 'object' && init && init.length) {\n      for (let i = 0; i < init.length; i++) this.add(init[i])\n    }\n  }\n\n  /**\n   * Calls all the callbacks.\n   */\n  call(...args: T) {\n    const callbacks = this._callbacks\n    for (const id in callbacks) {\n      callbacks[id](...args)\n    }\n  }\n\n  /**\n   * Adds a `callback` Function to this Callbacks collection.\n   * Returns a function that, when invoked, removes the inserted `callback` from the collection.\n   */\n  add(callback: CallbackEffect<T>) {\n    const id = this._nextId++\n    this._callbacks[id] = callback\n    return () => delete this._callbacks[id]\n  }\n}\n\nexport default Callbacks\n","import delay from 'delay'\nimport { BYTES_FORMATTER } from 'bemuse/progress/formatters'\n\n// Downloads the file from the URL.\n// The download will not actually be started unless the ``as()`` method\n// is called.\n//\n// .. js:function:: as(type)\n//\n//    Initiates the download as ``type``. The ``type`` is a string such as\n//    \"arraybuffer\" or \"blob\".\nexport function download(\n  url,\n  { getRetryDelay = () => 1000 + Math.random() * 4000 } = {}\n) {\n  return {\n    async as(type, progress) {\n      let shouldGiveUp = false\n      for (let i = 1; ; i++) {\n        try {\n          return await attempt()\n        } catch (error) {\n          console.error(`Unable to download ${url} [attempt ${i}]`, error)\n          if (i >= 3 || shouldGiveUp) throw error\n          const waitMs = getRetryDelay()\n          await delay(waitMs)\n        }\n      }\n      function attempt() {\n        return new Promise((resolve, reject) => {\n          const xh = new XMLHttpRequest()\n          xh.open('GET', url, true)\n          xh.responseType = type\n          xh.onload = () => {\n            if (+xh.status === 200) {\n              resolve(xh.response)\n            } else {\n              if (+xh.status === 403 || +xh.status === 404) {\n                shouldGiveUp = true\n              }\n              reject(new Error(`Unable to download ${url}: HTTP ${xh.status}`))\n            }\n          }\n          xh.onerror = () => reject(new Error(`Unable to download ${url}`))\n          if (progress) {\n            progress.formatter = BYTES_FORMATTER\n            xh.onprogress = (e) => progress.report(e.loaded, e.total)\n          }\n          xh.send(null)\n        })\n      }\n    },\n  }\n}\n\nexport default download\n","export function formatTime(seconds) {\n  const s = Math.floor(seconds % 60)\n  return Math.floor(seconds / 60) + ':' + (s < 10 ? '0' : '') + s\n}\n\nexport default formatTime\n","// :doc:\n//\n// High-accuracy timer, optionally synchronized globally.\n\nimport sync from 'timesynchro'\nconst Log = BemuseLogger.forModule('timesynchro')\n\nlet offset = 0\n\nfunction now() {\n  if (window.performance && typeof window.performance.now === 'function') {\n    return window.performance.now()\n  } else {\n    return Date.now()\n  }\n}\n\nnow.synchronize = function (server: string) {\n  sync(server, onFinish, onResult)\n  function onResult(result: number) {\n    // result + Date.now() = real time = now() + offset\n    // result + Date.now() = now() + offset\n    // offset = result + Date.now() - now()\n    offset = result + Date.now() - now()\n  }\n  function onFinish(err: Error | null, result?: number) {\n    if (err) {\n      Log.error('Cannot synchronize time: ' + err)\n    } else {\n      onResult(result!)\n      Log.info('Synchronized time with global server! Offset = ' + offset)\n    }\n  }\n}\nnow.synchronized = function () {\n  const o = offset\n  return () => now() + o\n}\nexport { now }\nexport default now\n","// !! avoid external dependencies since this is used in boot script!\n\nimport Callbacks from 'bemuse/utils/callbacks'\n\nexport class Observable<T> {\n  private _callbacks = new Callbacks<[T]>()\n  private _value?: T\n  constructor(value?: T) {\n    this._value = value\n  }\n\n  get value() {\n    return this._value\n  }\n\n  set value(value) {\n    this._value = value\n    this.notify(value!)\n  }\n\n  notify(value: T) {\n    this._callbacks.call(value)\n  }\n\n  watch(f: (value: T) => void) {\n    if (this._value !== undefined) f(this._value)\n    return this._callbacks.add(f)\n  }\n}\n\nexport default Observable\n","export default readBlob\n\n// Reads the blob as a specified type. The blob will not actually be read\n// unless the ``as()`` method is called.\n//\n// .. js:function:: as(type)\n//\n//    Starts reading the blob as ``type``. The ``type`` is a String such as\n//    \"arraybuffer\" or \"text\".\nexport function readBlob(blob) {\n  return {\n    as(type) {\n      return new Promise(function (resolve, reject) {\n        const reader = new FileReader()\n        reader.onload = function () {\n          resolve(reader.result)\n        }\n        reader.onerror = function () {\n          reject(new Error('Unable to read from Blob'))\n        }\n        switch (type) {\n          case 'arraybuffer':\n            reader.readAsArrayBuffer(blob)\n            break\n          case 'text':\n            reader.readAsText(blob)\n            break\n        }\n      })\n    },\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notechart = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar invariant_1 = __importDefault(require(\"invariant\"));\n__exportStar(require(\"./types\"), exports);\n/**\n * A notechart holds every info about a single player's note chart that the\n * game will ever need.\n */\nvar Notechart = /** @class */ (function () {\n    function Notechart(data, playerOptions) {\n        if (playerOptions === void 0) { playerOptions = {}; }\n        var _this = this;\n        var bmsNotes = data.notes, timing = data.timing, keysounds = data.keysounds, songInfo = data.songInfo, positioning = data.positioning, spacing = data.spacing, barLines = data.barLines, images = data.images, expertJudgmentWindow = data.expertJudgmentWindow, _a = data.landmineNotes, landmineNotes = _a === void 0 ? [] : _a;\n        (0, invariant_1.default)(bmsNotes, 'Expected \"data.notes\"');\n        (0, invariant_1.default)(timing, 'Expected \"data.timing\"');\n        (0, invariant_1.default)(keysounds, 'Expected \"data.keysounds\"');\n        (0, invariant_1.default)(songInfo, 'Expected \"data.songInfo\"');\n        (0, invariant_1.default)(positioning, 'Expected \"data.positioning\"');\n        (0, invariant_1.default)(spacing, 'Expected \"data.spacing\"');\n        (0, invariant_1.default)(barLines, 'Expected \"data.barLines\"');\n        this.expertJudgmentWindow = expertJudgmentWindow;\n        bmsNotes = this._preTransform(bmsNotes, playerOptions);\n        this._timing = timing;\n        this._positioning = positioning;\n        this._spacing = spacing;\n        this._keysounds = keysounds;\n        this._duration = 0;\n        this._notes = this._generatePlayableNotesFromBMS(bmsNotes);\n        this._landmines = this._generatePlayableNotesFromBMS(landmineNotes);\n        this._autos = this._generateAutoKeysoundEventsFromBMS(bmsNotes);\n        this._barLines = this._generateBarLineEvents(barLines);\n        this._samples = this._generateKeysoundFiles(keysounds);\n        this._infos = new Map(this._notes.map(function (note) { return [note, _this._getNoteInfo(note)]; }));\n        this._songInfo = songInfo;\n        this._images = images;\n    }\n    Object.defineProperty(Notechart.prototype, \"notes\", {\n        /**\n         * An Array of note events.\n         */\n        get: function () {\n            return this._notes;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"landmines\", {\n        /**\n         * An Array of landmines events.\n         */\n        get: function () {\n            return this._landmines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"autos\", {\n        /**\n         * An Array of auto-keysound events.\n         */\n        get: function () {\n            return this._autos;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"samples\", {\n        /**\n         * An Array of all the sample files to use.\n         */\n        get: function () {\n            return this._samples;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"keysounds\", {\n        /**\n         * An Object containing the mapping from keysound ID to keysound filename.\n         */\n        get: function () {\n            return this._keysounds.all();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"barLines\", {\n        /**\n         * An Object representing the bar line events.\n         */\n        get: function () {\n            return this._barLines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"columns\", {\n        /**\n         * An Array of all column names in this notechart.\n         */\n        get: function () {\n            return ['SC', '1', '2', '3', '4', '5', '6', '7'];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"duration\", {\n        /**\n         * Notechart's duration (time of last event)\n         */\n        get: function () {\n            return this._duration;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"songInfo\", {\n        /**\n         * Notechart's song info\n         */\n        get: function () {\n            return this._songInfo;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"eyecatchImage\", {\n        /**\n         * Eyecatch image\n         */\n        get: function () {\n            return (this._images && this._images.eyecatch) || 'eyecatch_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"backgroundImage\", {\n        /**\n         * Background image\n         */\n        get: function () {\n            return (this._images && this._images.background) || 'back_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the characteristic of the note as an Object.\n     */\n    Notechart.prototype.info = function (note) {\n        return this._infos.get(note);\n    };\n    /**\n     * Converts the beat number to in-song position (seconds)\n     */\n    Notechart.prototype.beatToSeconds = function (beat) {\n        return this._timing.beatToSeconds(beat);\n    };\n    /**\n     * Converts the beat number to in-game position.\n     */\n    Notechart.prototype.beatToPosition = function (beat) {\n        return this._positioning.position(beat);\n    };\n    /**\n     * Converts measure number to beat.\n     */\n    Notechart.prototype.measureToBeat = function (measure) {\n        return (this._barLines[measure] || this._barLines[this._barLines.length - 1]).beat;\n    };\n    /**\n     * Converts the in-song position to beat number.\n     */\n    Notechart.prototype.secondsToBeat = function (seconds) {\n        return this._timing.secondsToBeat(seconds);\n    };\n    /**\n     * Converts the in-song position to in-game position.\n     */\n    Notechart.prototype.secondsToPosition = function (seconds) {\n        return this.beatToPosition(this.secondsToBeat(seconds));\n    };\n    /**\n     * Finds BPM at the specified beat.\n     */\n    Notechart.prototype.bpmAtBeat = function (beat) {\n        return this._timing.bpmAtBeat(beat);\n    };\n    /**\n     * Finds the scrolling speed at the specified beat.\n     */\n    Notechart.prototype.scrollSpeedAtBeat = function (beat) {\n        return this._positioning.speed(beat);\n    };\n    /**\n     * Calculates the note spacing factor at the specified beat.\n     */\n    Notechart.prototype.spacingAtBeat = function (beat) {\n        return this._spacing.factor(beat);\n    };\n    /**\n     * Gets the keyMode from scratch\n     * @param scratch\n     * @returns {string}\n     */\n    Notechart.prototype.getKeyMode = function (scratch) {\n        var e_1, _a;\n        var usedColumns = {};\n        try {\n            for (var _b = __values(this.notes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var note = _c.value;\n                usedColumns[note.column] = true;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        if (scratch === 'off' && !usedColumns['1'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'left' && !usedColumns['6'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'right' && !usedColumns['1'] && !usedColumns['2'])\n            return '5K';\n        return '7K';\n    };\n    Notechart.prototype._preTransform = function (bmsNotes, playerOptions) {\n        var chain = lodash_1.default.chain(bmsNotes);\n        var keys = getKeys(bmsNotes);\n        if (playerOptions.scratch === 'off') {\n            chain = chain.map(function (note) {\n                if (note.column && note.column === 'SC') {\n                    return Object.assign({}, note, { column: null });\n                }\n                else {\n                    return note;\n                }\n            });\n        }\n        if (keys === '5K') {\n            var columnsToShift_1 = ['1', '2', '3', '4', '5', '6', '7'];\n            var shiftNote = function (amount) { return function (note) {\n                if (note.column) {\n                    var index = columnsToShift_1.indexOf(note.column);\n                    if (index > -1) {\n                        var newIndex = index + amount;\n                        (0, invariant_1.default)(newIndex < columnsToShift_1.length, 'Weird. Columns must not shift beyond available column');\n                        var newColumn = columnsToShift_1[newIndex];\n                        return Object.assign({}, note, { column: newColumn });\n                    }\n                }\n                return note;\n            }; };\n            if (playerOptions.scratch === 'off') {\n                chain = chain.map(shiftNote(1));\n            }\n            else if (playerOptions.scratch === 'right') {\n                chain = chain.map(shiftNote(2));\n            }\n        }\n        return chain.value();\n    };\n    Notechart.prototype._generatePlayableNotesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            _this._updateDuration(spec);\n            if (note.endBeat !== undefined) {\n                spec.end = _this._generateEvent(note.endBeat);\n                _this._updateDuration(spec.end);\n            }\n            else {\n                spec.end = undefined;\n            }\n            return spec;\n        });\n    };\n    Notechart.prototype._generateLandminesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            _this._updateDuration(spec);\n            return spec;\n        });\n    };\n    Notechart.prototype._updateDuration = function (event) {\n        if (event.time > this._duration)\n            this._duration = event.time;\n    };\n    Notechart.prototype._generateAutoKeysoundEventsFromBMS = function (bmsNotes) {\n        var _this = this;\n        return bmsNotes\n            .filter(function (note) { return !note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            return spec;\n        });\n    };\n    Notechart.prototype._generateKeysoundFiles = function (keysounds) {\n        var e_2, _a, e_3, _b;\n        var set = new Set();\n        try {\n            for (var _c = __values([this.notes, this.autos]), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var array = _d.value;\n                try {\n                    for (var array_1 = (e_3 = void 0, __values(array)), array_1_1 = array_1.next(); !array_1_1.done; array_1_1 = array_1.next()) {\n                        var event_ = array_1_1.value;\n                        var file = keysounds.get(event_.keysound);\n                        if (file)\n                            set.add(file);\n                    }\n                }\n                catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                finally {\n                    try {\n                        if (array_1_1 && !array_1_1.done && (_b = array_1.return)) _b.call(array_1);\n                    }\n                    finally { if (e_3) throw e_3.error; }\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return Array.from(set);\n    };\n    Notechart.prototype._generateBarLineEvents = function (beats) {\n        var _this = this;\n        return beats.map(function (beat) { return _this._generateEvent(beat); });\n    };\n    Notechart.prototype._generateEvent = function (beat) {\n        return {\n            beat: beat,\n            time: this.beatToSeconds(beat),\n            position: this.beatToPosition(beat),\n        };\n    };\n    Notechart.prototype._getNoteInfo = function (note) {\n        return { combos: note.end ? 2 : 1 };\n    };\n    return Notechart;\n}());\nexports.Notechart = Notechart;\nexports.default = Notechart;\nfunction getKeys(bmsNotes) {\n    var e_4, _a;\n    try {\n        for (var bmsNotes_1 = __values(bmsNotes), bmsNotes_1_1 = bmsNotes_1.next(); !bmsNotes_1_1.done; bmsNotes_1_1 = bmsNotes_1.next()) {\n            var note = bmsNotes_1_1.value;\n            if (note.column === '6' || note.column === '7') {\n                return '7K';\n            }\n        }\n    }\n    catch (e_4_1) { e_4 = { error: e_4_1 }; }\n    finally {\n        try {\n            if (bmsNotes_1_1 && !bmsNotes_1_1.done && (_a = bmsNotes_1.return)) _a.call(bmsNotes_1);\n        }\n        finally { if (e_4) throw e_4.error; }\n    }\n    return '5K';\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fromBMSChart = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar __1 = __importDefault(require(\"../\"));\n// Returns a new Notechart from a BMSChart.\nfunction fromBMSChart(bms, playerOptions) {\n    var notes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1,\n    }).all();\n    var landmineNotes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP_LANDMINE\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1_LANDMINE,\n    }).all();\n    var timing = BMS.Timing.fromBMSChart(bms);\n    var keysounds = BMS.Keysounds.fromBMSChart(bms);\n    var songInfo = BMS.SongInfo.fromBMSChart(bms);\n    var positioning = BMS.Positioning.fromBMSChart(bms);\n    var spacing = BMS.Spacing.fromBMSChart(bms);\n    var data = {\n        notes: notes,\n        landmineNotes: landmineNotes,\n        timing: timing,\n        keysounds: keysounds,\n        songInfo: songInfo,\n        positioning: positioning,\n        spacing: spacing,\n        barLines: generateBarLinesFromBMS(notes, bms),\n        expertJudgmentWindow: getJudgmentWindowFromBMS(bms),\n    };\n    return new __1.default(data, playerOptions);\n}\nexports.fromBMSChart = fromBMSChart;\nfunction getJudgmentWindowFromBMS(bms) {\n    // http://hitkey.nekokan.dyndns.info/diary1501.php\n    var rank = +bms.headers.get('rank') || 2;\n    if (rank === 0)\n        return [8, 24]; // Very Hard\n    if (rank === 1)\n        return [15, 30]; // Hard\n    if (rank === 3)\n        return [21, 60]; // Easy\n    return [18, 40]; // Normal\n}\nfunction generateBarLinesFromBMS(bmsNotes, bms) {\n    var max = lodash_1.default.max(bmsNotes.map(function (note) { return note.endBeat || note.beat; })) || 0;\n    var barLines = [0];\n    var currentBeat = 0;\n    var currentMeasure = 0;\n    do {\n        currentBeat += bms.timeSignatures.getBeats(currentMeasure);\n        currentMeasure += 1;\n        barLines.push(currentBeat);\n    } while (currentBeat <= max);\n    return barLines;\n}\n//# sourceMappingURL=BMSNotechartLoader.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map"],"names":["___CSS_LOADER_EXPORT___","push","module","id","_enabled","_lifecycleHandler","pauseAt","t","Error","unpause","getScore","enableTestMode","console","log","overlay","document","createElement","setAttribute","innerHTML","body","appendChild","setGameLifecycleHandler","handler","isTestModeEnabled","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","Table","stats","Object","keys","map","key","stat","align","bench","show","setShow","useState","updater","useEffect","setInterval","flag","clearInterval","handleInteraction","e","preventDefault","stopPropagation","className","onClick","onTouchStart","Stat","sum","count","average","hist","lastSec","secAvg","delta","now","time","shift","length","toString","format","x","toFixed","window","BEMUSE_BENCHMARK","enabled","wrap","title","f","start","apply","this","arguments","finish","benchmark","obj","name","lines","forEach","join","div","shouldShowOptions","shouldEnableBenchmark","shouldDisableFullScreen","shouldShowAbout","shouldShowModeSelect","isTitleDisplayMode","getGauge","gaugeType","primary","secondary","extra","update","playerState","progress","numJudgments","totalCombo","getHope","min","max1","max2","max","maxPossibleScore","Math","hopeS","hopeA","shouldDisplay","getPrimary","getSecondary","getExtra","hopeGauge","y","lower","upper","pos","position","event","constructor","notes","barLines","_notes","_barLines","sortBy","value","getVisibleNotes","headroom","out","i","note","end","entity","head","tail","height","abs","getVisibleBarLines","filter","player","skinData","_currentSpeed","_player","_noteArea","notechart","_stateful","_defaultData","placement","scratch","key_mode","getKeyMode","lane_lift","laneCover","lane_press","_gauge","gauge","_touch3dMode","displayMode","gameTime","touch3dMode","noteArea","stateful","beat","secondsToBeat","beatToPosition","spacing","spacingAtBeat","data","assign","speed","entities","getUpperBound","putNote","noteY","column","scale","row","columnIndex","areaWidth","xOffset","projection","desiredWidth","width","longNoteStep","c","floor","getNoteStatus","judgment","getNoteJudgment","status","active","missed","updateVisibleNotes","updateBarLines","input","columns","control","get","changed","updateInput","notifications","judgments","notification","deviationMode","combo","score","updateJudgment","updateGauge","updateExplode","getCount","currentAccuracy","bpm","bpmAtBeat","round","counts","config","getRow","excess","theta","pointX","cos","pointY","sin","PLAY_AREA_WIDTH","getTouchedColumn","mid","x0","x1","String","justPressed","_controls","Map","_plugins","changes","plugin","set","destroy","controlName","has","use","state","diff","last","current","Judgment","UNJUDGED","Unjudged","MISSED","Missed","NORMAL_TIMEGATES","timegate","endTimegate","TRANSITIONAL_BEGINNER_LV5_TIMEGATES","TRANSITIONAL_BEGINNER_LV4_TIMEGATES","TRANSITIONAL_BEGINNER_LV3_TIMEGATES","ABSOLUTE_BEGINNER_TIMEGATES","FixedTimegatesJudge","timegates","getTimegates","_gameTime","_noteTime","TutorialJudge","noteTime","NORMAL_JUDGE","getJudgeForNotechart","tutorial","info","songInfo","insane","difficulty","level","judgeTimeWith","judge","judgeTime","judgeEndTime","isBad","breaksCombo","weight","number","autoplayEnabled","autosound","NoteStatus","sounds","finished","tainted","_pinching","_columns","_noteBufferByColumn","n","groupBy","mapValues","startIndex","_noteResult","_duration","duration","_judge","_rawInput","_updateInputColumnMap","_judgeNotes","_updateSpeed","result","getPlayerInput","buffer","_judgeColumn","_modifySpeed","pinch","pinching","direction","amount","_shouldAutoplay","BEMUSE_AUTOPLAY","judgedNote","autoPlayed","_shouldJudge","shouldBreak","_judgeNote","type","freestyleNote","_getFreestyleNote","_isSandwiched","_getClosestNote","mapping","every","adjacentColumn","some","hit","noteEnd","lifted","passed","isDown","isUp","Judged","Active","_setJudgment","handleDelta","handleJudgment","getAccuracyScore","accuracy","getComboScore","total","combos","totalNotes","maxCombo","rawSumJudgmentWeight","rawTotalComboScore","_calculateRawTotalComboScore","_remainingMaxPossibleRawComboScore","rawSumComboScore","poor","_log","deltas","accuracyScore","comboScore","maxPossibleAccuracyScore","maxPossibleComboScore","remainingJudgments","maxPossibleAccuracy","maxPossibleRawComboScore","character","rawComboScore","_calculateRawComboScore","_recordLog","_getLogCharacter","forModule","moduleName","bindLogger","warn","error","args","Date","toJSON","observeMidiAccess","access","sink","port","inputs","values","outputs","onstatechange","navigator","requestMIDIAccess","Promise","reject","flatMap","flatMapError","stack","doLog","AxisLogic","stop","charge","previous","positive","axis","threshold","immediateOutput","ceil","OmniInput","win","_window","_exclusive","exclusive","_continuousAxis","continuous","setGamepadSensitivity","sensitivity","_disposables","listen","_handleKeyDown","_handleKeyUp","onValue","_handleMIDIMessage","_status","_axis","which","prefix","target","handleNote","bend","_updateGamepads","nav","gamepads","getGamepads","webkitGetGamepads","gamepad","_updateGamepad","index","buttons","button","axes","axisName","_deadzone","_sensitivity","_analogThreshold","setGamepadContinuousAxisEnabled","dispose","handle","array","knownMidiIds","getName","match","rest","split","midiNote","replace","subject","eventName","listener","addEventListener","removeEventListener","Progress","undefined","_observable","report","notify","watch","formatter","BYTES_FORMATTER","PERCENTAGE_FORMATTER","EXTRA_FORMATTER","fixed","loaded","async","atomic","promise","resolve","byteLength","hasByteLength","wrapPromise","ret","bind","from","to","simultaneous","queue","unsubscribe","add","addUnprefixed","callback","parts","slice","ResourceLogging","loggingFunction","text","setLoggingFunction","fn","workerUrl","ARCHIVE_REGEXP","DROPBOX_REGEXP","CustomSongResources","provider","_logging","_files","getFiles","then","files","fileEntry","file","archive","extracted","extractFiles","traverse","tree","File","unarchive","unarchiveIfNeeded","toLowerCase","FileResource","fileList","a","_file","read","as","resolveUrl","URL","createObjectURL","downloadFileEntryFromURL","url","pop","lastTime","download","URLResource","basename","URLResources","base","path","part","encodeURIComponent","href","init","_callbacks","_nextId","call","callbacks","getRetryDelay","random","shouldGiveUp","xh","XMLHttpRequest","open","responseType","onload","response","onerror","onprogress","send","waitMs","seconds","s","Log","offset","performance","synchronize","server","onResult","err","synchronized","o","_value","blob","reader","FileReader","readAsArrayBuffer","readAsText","__createBinding","create","m","k","k2","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","defineProperty","__exportStar","exports","p","prototype","hasOwnProperty","__values","Symbol","iterator","next","done","TypeError","__importDefault","mod","Notechart","lodash_1","invariant_1","playerOptions","_this","bmsNotes","timing","keysounds","positioning","images","expertJudgmentWindow","_a","landmineNotes","default","_preTransform","_timing","_positioning","_spacing","_keysounds","_generatePlayableNotesFromBMS","_landmines","_autos","_generateAutoKeysoundEventsFromBMS","_generateBarLineEvents","_samples","_generateKeysoundFiles","_infos","_getNoteInfo","_songInfo","_images","all","eyecatch","background","beatToSeconds","measureToBeat","measure","secondsToPosition","scrollSpeedAtBeat","factor","e_1","usedColumns","_b","_c","e_1_1","return","chain","e_4","bmsNotes_1","bmsNotes_1_1","e_4_1","getKeys","columnsToShift_1","shiftNote","indexOf","newIndex","newColumn","nextId","spec","_generateEvent","keysound","keysoundStart","keysoundEnd","_updateDuration","endBeat","_generateLandminesFromBMS","e_2","e_3","Set","autos","_d","array_1","array_1_1","event_","e_3_1","e_2_1","Array","beats","__setModuleDefault","v","__importStar","fromBMSChart","BMS","__1","getJudgmentWindowFromBMS","bms","rank","headers","generateBarLinesFromBMS","currentBeat","currentMeasure","timeSignatures","getBeats","Notes","double","CHANNEL_MAPPING","IIDX_DP","IIDX_P1","IIDX_DP_LANDMINE","IIDX_P1_LANDMINE","Timing","Keysounds","SongInfo","Positioning","Spacing"],"sourceRoot":""}