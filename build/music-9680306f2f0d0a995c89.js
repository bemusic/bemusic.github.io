(this.webpackJsonp=this.webpackJsonp||[]).push([[12],{100:function(e,t,n){"use strict";var r=n(68);t.a=function(e,{getRetryDelay:t=(()=>1e3+4e3*Math.random())}={}){return{async as(n,a){let s=!1;for(let o=1;;o++)try{return await new Promise(((t,o)=>{const i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType=n,i.onload=()=>{200==+i.status?t(i.response):(403!=+i.status&&404!=+i.status||(s=!0),o(new Error(`Unable to download ${e}: HTTP ${i.status}`)))},i.onerror=()=>o(new Error(`Unable to download ${e}`)),a&&(a.formatter=r.a,i.onprogress=e=>a.report(e.loaded,e.total)),i.send(null)}))}catch(n){if(console.error(`Unable to download ${e} [attempt ${o}]`,n),o>=3||s)throw n;const r=t();await new Promise((e=>setTimeout(e,r)))}}}}},1009:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(23),a=n.n(r),s=n(26),o=n.n(s),i=n(566);i.d();class c extends a.a.Component{componentDidMount(){i.b(),i.e(this.props.url),addEventListener("message",this.handleMessage)}componentWillUnmount(){i.a(),removeEventListener("message",this.handleMessage)}componentWillReceiveProps(e){i.e(e.url)}render(){return null}handleMessage({data:e}){"calibration-started"===e.type?i.a():"calibration-closed"===e.type&&i.b()}}c.propTypes={url:o.a.string}},1010:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(591);async function a(e,t){if(!e)return null;if(e.tutorial)return null;const{baseResources:n}=Object(r.a)(e,t);return(await n.file(e.preview_url||"_bemuse_preview.mp3")).resolveUrl()}},104:function(e,t,n){"use strict";var r=n(154);t.a=r.a},154:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(155);class a{constructor(){this.current=void 0,this.total=void 0,this._observable=new r.a}report(e,t,n){this.current=e,this.total=t,this.extra=n,this._observable.notify()}watch(e){return e(this),this._observable.watch((()=>e(this)))}get progress(){return this.total&&void 0!==this.current&&null!==this.current?this.current/this.total:null}toString(){return void 0!==this.formatter?this.formatter(this):null!==this.progress?this.current+" / "+this.total:""}}},155:function(e,t,n){"use strict";var r=n(156);t.a=class{constructor(e){this._callbacks=new r.a,this._value=e}get value(){return this._value}set value(e){this._value=e,this.notify(e)}notify(e){this._callbacks.call(e)}watch(e){return void 0!==this._value&&e(this._value),this._callbacks.add(e)}}},156:function(e,t,n){"use strict";t.a=class{constructor(e){if(this._callbacks={},this._nextId=1,"function"==typeof e)this.add(e);else if("object"==typeof e&&e&&e.length)for(let t=0;t<e.length;t++)this.add(e[t])}call(...e){const t=this._callbacks;for(const n in t)t[n](...e)}add(e){const t=this._nextId++;return this._callbacks[t]=e,()=>delete this._callbacks[t]}}},1824:function(e,t,n){"use strict";n.r(t),n.d(t,"main",(function(){return R}));var r=n(566),a=n(91),s=n(23),o=n.n(s),i=n(49),c=n(476),l=n(2),u=n(308),d=n(27),f=n.n(d),h=n(1009),p=n(26),m=n.n(p),b=n(309),g=n(517),y=n(477),w=n(1010);const v={ingame:e=>Object(g.a)(Object(y.a)(e)),added:e=>[{title:"Sorted by added date",songs:f.a.reverse(f.a.sortBy(e,E))}]},E=e=>e.added||(e.initial?"0000-00-00":"9999-99-99");function _(e){const t=function(e){const t=[],n=(e,...n)=>t.push({keys:n,message:e});e.unreleased&&n("Not released","unreleased"),e.readme||n("No README file found","README.md"),e.replaygain||n("No replay gain","replaygain"),e.artist_url||n("No artist URL","artist_url"),e.added||e.initial||n("No added date","added"),e.song_url||e.youtube_url||e.long_url||n("No song/YouTube/long URL","song_url","long_url","youtube_url"),e.bms_url||e.exclusive||n("No download URL","bms_url"),e.bmssearch_id||e.exclusive||n("No BMS search ID","bmssearch_id"),e.charts.filter((e=>"5K"===e.keys)).length||n("No 5-key charts","5key");for(const t of Object(b.a)(e.charts))t.info.subtitles.length||n("Missing subtitle","chart_names "+t.file);return t}(e);return t.length?o.a.createElement("div",null,t.map(((e,t)=>o.a.createElement("div",{key:t},e.keys.map((e=>o.a.createElement("code",{key:e,style:{fontFamily:"Ubuntu Mono",marginRight:"2",padding:3,fontSize:"0.8em",background:"#755"}},e))),e.message)))):null}class k extends o.a.Component{constructor(e){super(e),this.state={sort:this.props.initialSort||Object.keys(v)[0],previewUrl:null,previewEnabled:!1}}renderTable(){return o.a.createElement("table",{style:{borderSpacing:4}},o.a.createElement("thead",null,o.a.createElement("tr",null,o.a.createElement("th",{colSpan:4},this.renderSorter()," Â· ",this.renderPreview())),o.a.createElement("tr",null,o.a.createElement("th",null,"id"),o.a.createElement("th",null,"song"),o.a.createElement("th",null,"warnings"))),o.a.createElement("tbody",null,this.renderRows()))}renderSorter(){const e=[];for(const t of Object.keys(v))e.push(o.a.createElement("button",{key:t,onClick:()=>{this.setState({sort:t})}},t));return o.a.createElement("span",null,o.a.createElement("strong",null,"Sort by:")," ",e)}renderPreview(){const e=o.a.createElement("button",{onClick:()=>{this.setState((e=>({previewEnabled:!e.previewEnabled})))}},this.state.previewEnabled?"disable":"enable");return o.a.createElement("span",null,o.a.createElement("strong",null,"Music preview:")," ",e,this.state.previewEnabled&&o.a.createElement(h.a,{url:this.state.previewUrl}))}renderRows(){const e=v[this.state.sort](this.props.data.songs),t=[];for(const r of e){t.push(o.a.createElement("tr",{key:r.title},o.a.createElement("th",{colSpan:4},r.title)));for(const e of r.songs)t.push(o.a.createElement("tr",{key:e.id},o.a.createElement("td",null,o.a.createElement("strong",{onClick:()=>{prompt("",`vim '${e.id}/README.md'`)}},o.a.createElement("code",{style:{fontFamily:"Ubuntu Mono"}},e.id)),o.a.createElement("br",null),o.a.createElement("span",{style:{color:"#8b8685"}},e.added)),o.a.createElement("td",{style:{textAlign:"center",background:"#353433"}},o.a.createElement("span",{style:{color:"#8b8685"},onClick:async()=>{const t=await Object(w.a)(e,this.props.url);this.setState({previewUrl:t})}},e.genre),o.a.createElement("br",null),o.a.createElement("strong",{onClick:()=>{console.log(e),alert(n(121).inspect(e))}},e.title),o.a.createElement("br",null),e.artist),o.a.createElement("td",null,_(e))))}return t}renderMessage(e){return o.a.createElement("div",{style:{textAlign:"center"}},e)}render(){if(!this.props.data)return this.renderMessage("No data");try{return this.renderTable()}catch(e){return this.renderMessage(`Error: ${e}`)}}}k.propTypes={data:m.a.object,url:m.a.string,initialSort:m.a.string};var j=k;class O extends o.a.Component{constructor(e){super(e),this.state={url:l.a.server||u.a,status:"Loading"}}componentDidMount(){Object(u.c)(this.state.url).then((e=>{this.setState({status:"Load completed",data:e})})).catch((e=>{this.setState({status:"Load error: "+e})}))}render(){return o.a.createElement("div",null,o.a.createElement("header",{style:{textAlign:"center"}},o.a.createElement("h1",null,"Bemuse collection viewer"),o.a.createElement("div",null,this.state.url,o.a.createElement("br",null),this.state.status)),o.a.createElement("div",{style:{padding:20}},o.a.createElement(j,{data:this.state.data&&Object(c.a)(this.state.data),url:this.state.url,initialSort:l.a.sort})))}}var S=O;function R(){r.d(),Object(i.render)(o.a.createElement(S,null),a.a)}},184:function(e,t,n){"use strict";t.a=function(e){return"7K"===e.keys||"5K"===e.keys}},308:function(e,t,n){"use strict";(function(e){n.d(t,"a",(function(){return r})),n.d(t,"c",(function(){return a})),n.d(t,"b",(function(){return s}));const r="https://music4.bemuse.ninja/server";async function a(t,{fetch:n=e.fetch}={}){const r=s(t),a=await n(r).then((e=>e.json()));if(Array.isArray(a.songs))return a;if(Array.isArray(a.charts)){const e=r.replace(/[^/]*$/,"");return{songs:[{...a,id:"song",path:e}]}}throw new Error(`Invalid server file at ${r}: Does not contain "songs" array.`)}function s(e){return e.endsWith("/bemuse-song.json")?e:e.replace(/\/(?:index\.json)?$/,"")+"/index.json"}}).call(this,n(28))},309:function(e,t,n){"use strict";var r=n(27),a=n.n(r),s=n(184);t.a=function(e){return a()(e).filter(s.a).orderBy([e=>e.info.difficulty>=5?1:0,e=>e.keys,e=>e.info.level]).value()}},397:function(e,t){},399:function(e,t){},409:function(e,t){},411:function(e,t){},436:function(e,t){},437:function(e,t){},442:function(e,t){},476:function(e,t,n){"use strict";var r=n(93);const a=Object(r.a)(((e,t)=>{t&&(e.songs=t.map((e=>function(e){e.chart_names&&(e=Object(r.a)(e,(t=>{t.charts&&(t.charts=t.charts.map((t=>{const n=e.chart_names[t.file];return n?Object(r.a)(t,(e=>{e.info={subtitles:e=>[...e,n]}})):t})))})));return e}(e))))}));t.a=a},477:function(e,t,n){"use strict";var r=n(27),a=n.n(r),s=n(184);t.a=function(e){return a.a.orderBy(e,[e=>a()(e.charts).filter(s.a).filter((e=>e.info.difficulty<5)).filter((e=>e.info.level>0)).map((e=>e.info.level)).min(),e=>e.bpm,e=>e.title.toLowerCase()])}},482:function(e,t,n){"use strict";var r=n(104),a=n(84),s=n(79),o=n(27),i=n.n(o),c=n(169),l=n.n(c),u=n(99);class d{constructor(e,t,n){this.resources=e,this.ref=t,this.name=n}read(e){return a.a(e,this.resources.getBlob(this.ref).then((e=>Object(s.a)(e).as("arraybuffer"))))}async resolveUrl(){const e=await this.resources.getBlob(this.ref);return URL.createObjectURL(e)}}class f{constructor(e,t){this.resources=e,this._basePromise=e.base.file(t.path)}load(){return this._promise||(this._promise=this.resources.loadPayload(this._basePromise))}}async function h(e){if("BEMUSEPACK"!==await Object(s.a)(e.slice(0,10)).as("text"))throw new Error("Invalid magic number");const t=await Object(s.a)(e.slice(10,14)).as("arraybuffer"),n=new Uint8Array(t),r=n[0]+(n[1]<<8)+(n[2]<<16)+(n[3]<<24);return e.slice(14+r)}t.a=class{constructor(e,t={}){this.progress={all:new r.a,current:new r.a},this._getMetadata=i.a.once((async()=>{const e=await this._base.file(this._metadataFilename),t=await e.read(),n=await new Blob([t]).text();return JSON.parse(n)})),this._getRefs=i.a.once((async()=>(await this._getMetadata()).refs.map((e=>new f(this,e))))),this._getFileMap=i.a.once((async()=>{const e=await this._getMetadata(),t=new Map;for(const n of e.files)t.set(n.name.toLowerCase(),n);return t})),"string"==typeof e&&(e=new u.a(new URL(e,location.href)));const n="string"==typeof t.fallback?new u.a(new URL(t.fallback,location.href)):t.fallback;this._base=e,this._fallback=n,this._fallbackPattern=t.fallbackPattern,this._metadataFilename=t.metadataFilename||"metadata.json";const s=a.d(this.progress.current);this.loadPayload=a.e(this.progress.all,l()(2,(e=>e.then((e=>e.read((()=>{const e=new r.a;return s.add(e),e})()))).then((e=>new Blob([e]))).then(h))))}get base(){return this._base}async file(e){const t=(await this._getFileMap()).get(e.toLowerCase());if(t)return new d(this,t.ref,t.name);if(this._fallback&&this._fallbackPattern&&this._fallbackPattern.test(e))return this._fallback.file(e);throw new Error("Unable to find: "+e)}async getBlob([e,t,n]){const r=(await this._getRefs())[e];return(await r.load()).slice(t,n)}}},517:function(e,t,n){"use strict";var r=n(27),a=n.n(r),s=n(396);const o=a.a.once((()=>{const e=new Date(Date.now()+324e5).toISOString().split("T")[0];return a.a.memoize((t=>{const n=Object(s.createHash)("md5");return n.update(t),n.update(e),n.digest("hex")}))}));class i{constructor(e,{enabled:t=!0}={}){if(!t)return void(this.ids=new Set);const n=a.a.sortBy(e.filter((e=>!e.custom&&!e.tutorial)),(e=>o()(e.id)));this.ids=new Set(n.slice(0,3).map((e=>e.id)))}isSongOfTheDay(e){return this.ids.has(e)}}const c=[{title:"Custom Song",criteria:e=>e.custom},{title:"Tutorial",criteria:e=>e.tutorial},{title:"Unreleased",criteria:e=>e.unreleased},{title:"Recently Added Songs",criteria:e=>e.added&&Date.now()-Date.parse(e.added)<5184e6,sort:e=>e.added,reverse:!0},{title:"Random Songs of the Day",criteria:(e,t)=>t.songOfTheDay.isSongOfTheDay(e.id)},{title:"â",criteria:()=>!0}];t.a=function(e,{songOfTheDayEnabled:t=!1}={}){const n={songOfTheDay:new i(e,{enabled:t})},r=c.map((e=>({input:e,output:{title:e.title,songs:[]}})));for(const t of e)for(const{input:e,output:a}of r)if(e.criteria(t,n)){a.songs.push(t);break}for(const{input:e,output:t}of r)e.sort?t.songs=a.a.orderBy(t.songs,[e.sort],[e.reverse?"desc":"asc"]):e.reverse&&t.songs.reverse();return a()(r).map("output").filter((e=>e.songs.length>0)).value()}},529:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(99);function a(e,t){if(t.includes("://"))return[new r.a(new URL(t)),t.split("/").slice(-1)[0]];const n=t.split("/");let a=e;for(;n.length>1;){const e=n.shift();a=new s(a,e)}return[a,n[0]]}class s{constructor(e,t){this.base=e,this.dirName=t}async file(e){return this.base.file(`${this.dirName}/${e}`)}}},566:function(e,t,n){"use strict";n.d(t,"d",(function(){return s})),n.d(t,"b",(function(){return o})),n.d(t,"a",(function(){return i})),n.d(t,"c",(function(){return c})),n.d(t,"e",(function(){return l}));let r=null;function a(){return r||(r=function(){let e=!1,t=null,r=!1,a=!1;const s={},o=new Audio(n(923));o.preload="auto",o.loop=!0,o.oncanplaythrough=()=>{r=!0,l()},o.load();const i=document.createElement("audio");i.src=n(924),i.volume=.5,i.load();const c=d(o,.5,(e=>{0===e&&a&&(a=!1,o.pause())}));function l(){if(!e){a&&(c.fadeTo(0,100),a=!1,o.pause());for(const e of Object.keys(s)){s[e].destroy()}return}let n=null;for(const e of Object.keys(s)){const r=s[e];e===t?r.loaded&&(r.play(),n=r):r.stop()}n?c.fadeTo(0,1):(c.fadeTo(.4,.5),r&&!a&&(a=!0,u(o).catch((()=>console.warn("Cannot play background music")))))}function f(e){const t=document.createElement("audio");t.src=e;let n=!1;const r=d(t,1,(n=>{0===n&&(t.pause(),delete s[e],l())})),a={loaded:!1,play(){n||u(t).then((()=>{n=!0})).catch((()=>console.warn("Cannot play",t.src))),r.fadeTo(1,2)},stop(){r.fadeTo(0,4)},destroy(){t.pause(),delete s[e],l()}};return t.oncanplaythrough=()=>{a.loaded=!0,l()},t.onended=()=>{delete s[e],l()},t.load(),a}return{enable(){e||(e=!0,l())},disable(){e&&(e=!1,l())},go(){e&&(i.currentTime=0,u(i).catch((()=>console.warn("Cannot play go sound."))))},preview(e){t!==e&&(t=e,e&&!s[e]&&(s[e]=f(e)),l())}}}())}function s(){a()}function o(){return a().enable()}function i(){return a().disable()}function c(){return a().go()}function l(e){return a().preview(e)}function u(e){return new Promise((t=>{t(e.play())}))}function d(e,t,n){let r,a=0,s=0,o=!1;function i(){return(Date.now()-r)/1e3}function c(){return a>t?Math.min(a,t+i()*s):a<t?Math.max(a,t-i()*s):a}function l(){o=!1;const t=c();e.volume=t,t===a?n&&n(a):o||(o=!0,requestAnimationFrame(l))}return e.volume=t,{fadeTo(e,n){a===e&&n===s||(t=c(),a=e,s=n,r=Date.now(),l())}}}},591:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(482),a=n(529),s=n(99);function o(e,t){const n=e.resources||new s.a(new URL(e.path.replace(/\/?$/,"/"),t.replace(/\/?$/,"/")));return{baseResources:n,assetResources:function(e,t){if(null===t)return e;void 0===t&&(t="assets/metadata.json");const[n,s]=Object(a.a)(e,t);return new r.a(n,{metadataFilename:s,fallback:e,fallbackPattern:/\.(?:png|jpg|webm|mp4|m4v)/})}(n,e.bemusepack_url)}}},68:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return c}));var r=n(168),a=n.n(r);const s=e=>t=>null!==t.progress?e(t):"",o=s((e=>a()(e.current)+" / "+a()(e.total))),i=s((e=>(e.current/e.total*100).toFixed(1)+"%")),c=s((e=>e.extra+""))},79:function(e,t,n){"use strict";t.a=function(e){return{as:t=>new Promise((function(n,r){const a=new FileReader;switch(a.onload=function(){n(a.result)},a.onerror=function(){r(new Error("Unable to read from Blob"))},t){case"arraybuffer":a.readAsArrayBuffer(e);break;case"text":a.readAsText(e)}}))}}},84:function(e,t,n){"use strict";n.d(t,"c",(function(){return a})),n.d(t,"a",(function(){return s})),n.d(t,"e",(function(){return o})),n.d(t,"b",(function(){return i})),n.d(t,"d",(function(){return c}));var r=n(68);function a(e,t){if(!t)return()=>{};let n=0;return t.report(0,e),r=>t.report(++n,e,r)}function s(e,t){return e?Promise.resolve(t).tap((t=>{!function(e){return e&&e.byteLength}(t)?e.report(1,1):(e.formatter=r.a,e.report(t.byteLength,t.byteLength))})):t}function o(e,t){let n=0,r=0;return function(...a){return e.report(n,++r),Promise.resolve(t.apply(this,a)).tap((()=>e.report(++n,r)))}}function i(e,t){return e.watch((()=>t.report(e.current,e.total,e.extra)))}function c(e){const t=[];let n,r=null;function a(){n&&e.report(n.current,n.total,n.extra),t.length>0&&(!n||n.progress>=1)&&function(e){if(n===e)return;r&&(r(),r=null);n=e,n&&(r=n.watch(a))}(t.shift())}return{add(e){t.push(e),a()}}}},91:function(e,t,n){"use strict";t.a=document.querySelector("#scene-root")},923:function(e,t,n){e.exports=n.p+"build/354b30433269481d2f132496a0d13f64.ogg"},924:function(e,t,n){e.exports=n.p+"build/38fbcad5f2b14ca6ffc359446f7ec455.ogg"},99:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(100),a=n(46);class s{constructor(e){this.url=e}read(e){return Object(r.a)(this.url).as("arraybuffer",e)}async resolveUrl(){return Promise.resolve(this.url)}get name(){return Object(a.basename)(this.url)}}class o{constructor(e){this.base=e}async file(e){const t=e.split("/").map((e=>encodeURIComponent(e))).join("/");return new s(new URL(t,this.base).href)}}t.b=s}}]);
//# sourceMappingURL=music-9680306f2f0d0a995c89.js.map