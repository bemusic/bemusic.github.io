{"version":3,"sources":["file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/webpack@4.46.0/node_modules/webpack/buildin/amd-define.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/webpack@4.46.0/node_modules/webpack/buildin/amd-options.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/audio-context@1.0.3/node_modules/audio-context/index.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/classnames@2.3.1/node_modules/classnames/index.js","file:///home/circleci/bemuse/common/temp/node_modules/.pnpm/baconjs@0.7.95/node_modules/baconjs/dist/Bacon.js"],"names":["module","exports","Error","__webpack_amd_options__","cache","options","window","OfflineContext","OfflineAudioContext","webkitOfflineAudioContext","Context","AudioContext","webkitAudioContext","sampleRate","offline","channels","length","ctx","err","hasOwn","hasOwnProperty","classNames","classes","i","arguments","arg","argType","push","Array","isArray","inner","apply","toString","Object","prototype","key","call","join","default","_slice","slice","Bacon","Exception","global","this","nop","former","x","_","assert","message","condition","assertObservableIsProperty","_isObservable","_isProperty","assertFunction","f","isFunction","xs","isObservable","assertNoArguments","args","extend","target","prop","inherit","child","parent","hasProp","ctor","symbol","Symbol","indexOf","indexWhere","head","always","negate","empty","tail","filter","filtered","map","result","each","toArray","contains","id","last","all","undefined","any","without","y","remove","splice","fold","seed","flatMap","ys","concat","cached","value","None","_isNone","bind","fn","me","obj","recursionDepth","results","error","UpdateBarrier","rootEvent","waiterObs","waiters","aftersStack","aftersStackHeight","flushed","ensureStackHeight","h","afterTransaction","obs","stackIndexForThisObs","containsObs","processAfters","aftersList","stackSizeAtStart","topOfStack","topAfters","index","_topAfters$index","after","callSuccess","flushWaiters","deps","obsId","obsWaiters","flushDepsOf","dep","internalDeps","whenDoneWith","hasWaiters","inTransaction","event","context","flush","currentEventId","wrappedSubscribe","sink","unsubd","shouldUnsub","doUnsub","unsub","dispatcher","subscribe","noMore","Source","sync","lazy","queue","ConsumingSource","BufferingSource","Desc","method","_isSource","markEnded","ended","consume","mayHave","hasAtLeast","flatten","shift","c","values","isTrigger","s","_isEventStream","fromObservable","_isDesc","findDeps","describe","ref","_len","_key","withDesc","desc","withMethodCallSupport","wrapped","_len2","_key2","methodName","makeFunctionArgs","makeFunction_","partiallyApplied","applied","_len3","_key3","toFieldExtractor","parts","split","partFuncs","fieldValue","toSimpleExtractor","isFieldKey","charAt","_len4","_key4","makeFunction","convertArgsToFunction","sampled","sampledBy","p","_ref","_ref2","toCombinator","toFieldKey","left","right","Some","_isSome","getOrElse","get","forEach","isDefined","inspect","toOption","v","more","eventIdCounter","Event","Next","valueF","eager","_isNext","valueInternal","Initial","End","_isEvent","isEvent","isEnd","isInitial","isNext","isError","hasValue","log","fmap","_isInitial","toNext","initialEvent","nextEvent","endEvent","toEvent","idCounter","registerObs","Observable","initialDesc","CompositeUnsubscribe","ss","unsubscribe","unsubscribed","subscriptions","starting","add","Dispatcher","_subscribe","_handleEvent","handleEvent","pushing","prevError","unsubSrc","EventStream","handler","subscribeInternal","onValue","onValues","onError","onEnd","name","_name","withDescription","assign","subscription","_this2","iterable","count","hasSubscribers","removeSub","pushIt","pushToSubscriptions","tmp","len","sub","unsubscribeFromSource","_this","toProperty","initValue_","initValue","disp","Property","initSent","subbed","reply","sendInit","toEventStream","withHandler","never","when","usage","sources","pats","patterns","patSources","constantToFunction","pat","ixs","triggerFound","j","ix","k","needsBarrier","containsDuplicateDeps","resultStream","triggers","ends","match","i1","cannotSync","source","cannotMatch","nonFlattened","trigger","part","unsubAll","flushLater","flushWhileTriggers","pop","events","i2","e","_p","observables","state","checkObservable","PropertyDispatcher","property","current","currentValueRootId","propertyEnded","groupSimultaneous","_len5","streams","_key5","_len6","_key6","maybeSubSource","_this3","dispatchingId","valId","changes","_this4","_this5","constant","fromBinder","binder","eventTransformer","unbound","shouldUnbind","unbind","unbinder","_len7","_key7","_len8","_key8","argumentsToObservables","argumentsToObservablesAndFunction","combineAsArray","stream","_len9","_key9","combineWith","_argumentsToObservablesAndFunction","combine","other","combinator","withStateMachine","initState","fromF","newState","outputs","output","equals","a","b","isNone","object","skipDuplicates","isEqual","prev","awaiting","not","and","or","scheduler","setTimeout","d","setInterval","clearInterval","clearTimeout","now","Date","getTime","bufferWithTime","delay","bufferWithTimeOrCount","Number","MAX_VALUE","bufferWithCount","flushOrSchedule","buffer","schedule","onInput","onFlush","scheduled","end","valuesToPush","_this6","delayMs","_this7","_len10","_key10","once","unsubRight","unsubLeft","addPropertyInitValueToStream","concatAll","justInitValue","flatMap_","makeSpawner","flatMapFirst","makeObservable","root","firstOnly","limit","rootDep","childDeps","composite","spawn","unsubMe","checkQueue","checkEnd","__","unsubRoot","Bus","subscribeAll","guardedSink","flatMapWithConcurrencyLimit","_len11","_key11","flatMapConcat","later","bufferingThrottle","minimumInterval","newSink","subscribeInput","input","_this8","unsubscribeInput","plug","_this9","assertObservable","rootPush","pushQueue","liftCallback","callback","_len12","_key12","fromCallback","_len13","_key13","fromNodeCallback","_len14","_key14","combineTemplate","template","setValue","ctxStack","mkContext","containsObservables","constructor","compile","funcs","applyStreamValue","newContext","pushContext","compileTemplate","constantValue","resultProperty","rootContext","mapEnd","skipErrors","takeUntil","stopper","endMarker","_event$value","data","flatMapLatest","delayChanges","debounce","debounceImmediate","decode","cases","scan","_this10","acc","initHandled","next","diff","start","prevTuple","tuple","doAction","doEnd","doError","doLog","_len15","_key15","console","endOnError","_len16","_key16","errors","take","first","mapError","flatMapError","flatScan","updated","sampler","thisSource","samplerSource","sample","interval","_len17","_key17","reduce","eventMethods","valueAndEnd","fromEventTarget","eventName","_findHandlerMethods","pair","methodPair","addListener","findHandlerMethods","fromEvent","fromPoll","poll","fromPromise","promise","abort","bound","then","done","groupBy","keyF","limitF","src","similar","limited","fromArray","assertArray","pushNeeded","holdWhen","valve","onHold","bufferedValues","srcIsEnded","subscribed","endIfBothEnded","toSend","$","asEventStream","selector","_this11","on","off","jQuery","Zepto","lastEvent","_len18","_key18","merge","assertEventStream","mergeAll","sinks","unsubBoth","repeatedly","repeat","generator","flag","subscribeNext","retry","retries","retriesDone","isRetryable","finished","valueStream","pause","sequentially","skip","skipUntil","starter","started","skipWhile","ok","_len19","_key19","slidingWindow","n","minValues","spies","running","spy","ESObservable","observable","startWith","takeWhile","_len20","_key20","throttle","firstToPromise","PromiseCtr","_this12","Promise","resolve","reject","toPromise","update","initial","lateBindFirst","_len22","_key22","_len21","_key21","Function","zipAsArray","_len23","_key23","zipWith","_len24","_key24","_len25","_key25","observablesAndFunction","zip","observerOrOnNext","onComplete","observer","complete","closed","cancel","toESObservable","fromESObservable","_observable"],"mappings":"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","file":"build/vendors~sync-f687b5e939f885a9d95f.js","sourcesContent":["module.exports = function() {\n\tthrow new Error(\"define cannot be used indirect\");\n};\n","/* globals __webpack_amd_options__ */\nmodule.exports = __webpack_amd_options__;\n","'use strict'\r\n\r\nvar cache = {}\r\n\r\nmodule.exports = function getContext (options) {\r\n\tif (typeof window === 'undefined') return null\r\n\t\r\n\tvar OfflineContext = window.OfflineAudioContext || window.webkitOfflineAudioContext\r\n\tvar Context = window.AudioContext || window.webkitAudioContext\r\n\t\r\n\tif (!Context) return null\r\n\r\n\tif (typeof options === 'number') {\r\n\t\toptions = {sampleRate: options}\r\n\t}\r\n\r\n\tvar sampleRate = options && options.sampleRate\r\n\r\n\r\n\tif (options && options.offline) {\r\n\t\tif (!OfflineContext) return null\r\n\r\n\t\treturn new OfflineContext(options.channels || 2, options.length, sampleRate || 44100)\r\n\t}\r\n\r\n\r\n\t//cache by sampleRate, rather strong guess\r\n\tvar ctx = cache[sampleRate]\r\n\r\n\tif (ctx) return ctx\r\n\r\n\t//several versions of firefox have issues with the\r\n\t//constructor argument\r\n\t//see: https://bugzilla.mozilla.org/show_bug.cgi?id=1361475\r\n\ttry {\r\n\t\tctx = new Context(options)\r\n\t}\r\n\tcatch (err) {\r\n\t\tctx = new Context()\r\n\t}\r\n\tcache[ctx.sampleRate] = cache[sampleRate] = ctx\r\n\r\n\treturn ctx\r\n}\r\n","/*!\n  Copyright (c) 2018 Jed Watson.\n  Licensed under the MIT License (MIT), see\n  http://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString === Object.prototype.toString) {\n\t\t\t\t\tfor (var key in arg) {\n\t\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t\t}\n\t\t\t\t\t}\n\t\t\t\t} else {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","(function() {\nvar _slice = Array.prototype.slice;\nvar Bacon = {\n  toString: function () {\n    return \"Bacon\";\n  }\n};\n\nBacon.version = '0.7.95';\n\nvar Exception = (typeof global !== \"undefined\" && global !== null ? global : this).Error;\nvar nop = function () {};\nvar latter = function (_, x) {\n  return x;\n};\nvar former = function (x, _) {\n  return x;\n};\nvar cloneArray = function (xs) {\n  return xs.slice(0);\n};\nvar assert = function (message, condition) {\n  if (!condition) {\n    throw new Exception(message);\n  }\n};\nvar assertObservableIsProperty = function (x) {\n  if ((x != null ? x._isObservable : void 0) && !(x != null ? x._isProperty : void 0)) {\n    throw new Exception(\"Observable is not a Property : \" + x);\n  }\n};\nvar assertEventStream = function (event) {\n  if (!(event != null ? event._isEventStream : void 0)) {\n    throw new Exception(\"not an EventStream : \" + event);\n  }\n};\n\nvar assertObservable = function (event) {\n  if (!(event != null ? event._isObservable : void 0)) {\n    throw new Exception(\"not an Observable : \" + event);\n  }\n};\nvar assertFunction = function (f) {\n  return assert(\"not a function : \" + f, _.isFunction(f));\n};\nvar isArray = Array.isArray || function (xs) {\n  return xs instanceof Array;\n};\nvar isObservable = function (x) {\n  return x && x._isObservable;\n};\nvar assertArray = function (xs) {\n  if (!isArray(xs)) {\n    throw new Exception(\"not an array : \" + xs);\n  }\n};\nvar assertNoArguments = function (args) {\n  return assert(\"no arguments supported\", args.length === 0);\n};\nvar assertString = function (x) {\n  if (typeof x === \"string\") {\n    throw new Exception(\"not a string : \" + x);\n  }\n};\n\nvar extend = function (target) {\n  var length = arguments.length;\n  for (var i = 1; 1 < length ? i < length : i > length; 1 < length ? i++ : i--) {\n    for (var prop in arguments[i]) {\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n\nvar inherit = function (child, parent) {\n  var hasProp = ({}).hasOwnProperty;\n  var ctor = function () {};\n  ctor.prototype = parent.prototype;\n  child.prototype = new ctor();\n  for (var key in parent) {\n    if (hasProp.call(parent, key)) {\n      child[key] = parent[key];\n    }\n  }\n  return child;\n};\n\nvar symbol = function (key) {\n  if (typeof Symbol !== \"undefined\" && Symbol[key]) {\n    return Symbol[key];\n  } else if (typeof Symbol !== \"undefined\" && typeof Symbol[\"for\"] === \"function\") {\n    return Symbol[key] = Symbol[\"for\"](key);\n  } else {\n    return \"@@\" + key;\n  }\n};\n\nvar _ = {\n  indexOf: (function () {\n    if (Array.prototype.indexOf) {\n      return function (xs, x) {\n        return xs.indexOf(x);\n      };\n    } else {\n      return function (xs, x) {\n        for (var i = 0, y; i < xs.length; i++) {\n          y = xs[i];\n          if (x === y) {\n            return i;\n          }\n        }\n        return -1;\n      };\n    }\n  })(),\n  indexWhere: function (xs, f) {\n    for (var i = 0, y; i < xs.length; i++) {\n      y = xs[i];\n      if (f(y)) {\n        return i;\n      }\n    }\n    return -1;\n  },\n  head: function (xs) {\n    return xs[0];\n  },\n  always: function (x) {\n    return function () {\n      return x;\n    };\n  },\n  negate: function (f) {\n    return function (x) {\n      return !f(x);\n    };\n  },\n  empty: function (xs) {\n    return xs.length === 0;\n  },\n  tail: function (xs) {\n    return xs.slice(1, xs.length);\n  },\n  filter: function (f, xs) {\n    var filtered = [];\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        filtered.push(x);\n      }\n    }\n    return filtered;\n  },\n  map: function (f, xs) {\n    return (function () {\n      var result = [];\n      for (var i = 0, x; i < xs.length; i++) {\n        x = xs[i];\n        result.push(f(x));\n      }\n      return result;\n    })();\n  },\n  each: function (xs, f) {\n    for (var key in xs) {\n      if (Object.prototype.hasOwnProperty.call(xs, key)) {\n        var value = xs[key];\n        f(key, value);\n      }\n    }\n  },\n  toArray: function (xs) {\n    return isArray(xs) ? xs : [xs];\n  },\n  contains: function (xs, x) {\n    return _.indexOf(xs, x) !== -1;\n  },\n  id: function (x) {\n    return x;\n  },\n  last: function (xs) {\n    return xs[xs.length - 1];\n  },\n  all: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (!f(x)) {\n        return false;\n      }\n    }\n    return true;\n  },\n  any: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        return true;\n      }\n    }\n    return false;\n  },\n  without: function (x, xs) {\n    return _.filter(function (y) {\n      return y !== x;\n    }, xs);\n  },\n  remove: function (x, xs) {\n    var i = _.indexOf(xs, x);\n    if (i >= 0) {\n      return xs.splice(i, 1);\n    }\n  },\n  fold: function (xs, seed, f) {\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      seed = f(seed, x);\n    }\n    return seed;\n  },\n  flatMap: function (f, xs) {\n    return _.fold(xs, [], function (ys, x) {\n      return ys.concat(f(x));\n    });\n  },\n  cached: function (f) {\n    var value = None;\n    return function () {\n      if (typeof value !== \"undefined\" && value !== null ? value._isNone : undefined) {\n        value = f();\n        f = undefined;\n      }\n      return value;\n    };\n  },\n  bind: function (fn, me) {\n    return function () {\n      return fn.apply(me, arguments);\n    };\n  },\n  isFunction: function (f) {\n    return typeof f === \"function\";\n  },\n  toString: function (obj) {\n    var internals, key, value;\n    var hasProp = ({}).hasOwnProperty;\n    try {\n      recursionDepth++;\n      if (obj == null) {\n        return \"undefined\";\n      } else if (_.isFunction(obj)) {\n        return \"function\";\n      } else if (isArray(obj)) {\n        if (recursionDepth > 5) {\n          return \"[..]\";\n        }\n        return \"[\" + _.map(_.toString, obj).toString() + \"]\";\n      } else if ((obj != null ? obj.toString : void 0) != null && obj.toString !== Object.prototype.toString) {\n        return obj.toString();\n      } else if (typeof obj === \"object\") {\n        if (recursionDepth > 5) {\n          return \"{..}\";\n        }\n        internals = (function () {\n          var results = [];\n          for (key in obj) {\n            if (!hasProp.call(obj, key)) continue;\n            value = (function () {\n              var error;\n              try {\n                return obj[key];\n              } catch (error) {\n                return error;\n              }\n            })();\n            results.push(_.toString(key) + \":\" + _.toString(value));\n          }\n          return results;\n        })();\n        return \"{\" + internals + \"}\";\n      } else {\n        return obj;\n      }\n    } finally {\n      recursionDepth--;\n    }\n  }\n};\n\nvar recursionDepth = 0;\n\nBacon._ = _;\n\nvar UpdateBarrier = Bacon.UpdateBarrier = (function () {\n  var rootEvent;\n  var waiterObs = [];\n  var waiters = {};\n  var aftersStack = [];\n  var aftersStackHeight = 0;\n  var flushed = {};\n\n  function ensureStackHeight(h) {\n    if (h <= aftersStackHeight) return;\n    if (!aftersStack[h - 1]) {\n      aftersStack[h - 1] = [[], 0];\n    }\n    aftersStackHeight = h;\n  }\n\n  var afterTransaction = function (obs, f) {\n    if (rootEvent || aftersStack.length) {\n      ensureStackHeight(1);\n      var stackIndexForThisObs = 0;\n      while (stackIndexForThisObs < aftersStackHeight - 1) {\n        if (containsObs(obs, aftersStack[stackIndexForThisObs][0])) {\n          break;\n        }\n        stackIndexForThisObs++;\n      }\n      var listFromStack = aftersStack[stackIndexForThisObs][0];\n      listFromStack.push([obs, f]);\n      if (!rootEvent) {\n        processAfters();\n      }\n    } else {\n        return f();\n      }\n  };\n\n  function containsObs(obs, aftersList) {\n    for (var i = 0; i < aftersList.length; i++) {\n      if (aftersList[i][0].id == obs.id) return true;\n    }\n    return false;\n  }\n\n  function processAfters() {\n    var stackSizeAtStart = aftersStackHeight;\n    if (!stackSizeAtStart) return;\n    while (aftersStackHeight >= stackSizeAtStart) {\n      var topOfStack = aftersStack[aftersStackHeight - 1];\n      if (!topOfStack) throw new Error(\"Unexpected stack top: \" + topOfStack);\n      var topAfters = topOfStack[0];\n      var index = topOfStack[1];\n\n      if (index < topAfters.length) {\n        var _topAfters$index = topAfters[index];\n        var obs = _topAfters$index[0];\n        var after = _topAfters$index[1];\n\n        topOfStack[1]++;\n        ensureStackHeight(aftersStackHeight + 1);\n        var callSuccess = false;\n        try {\n          after();\n          callSuccess = true;\n          while (aftersStackHeight > stackSizeAtStart && aftersStack[aftersStackHeight - 1][0].length == 0) {\n            aftersStackHeight--;\n          }\n        } finally {\n          if (!callSuccess) {\n            aftersStack = [];\n            aftersStackHeight = 0;\n          }\n        }\n      } else {\n          topOfStack[0] = [];\n          topOfStack[1] = 0;\n          break;\n        }\n    }\n  }\n\n  var whenDoneWith = function (obs, f) {\n    if (rootEvent) {\n      var obsWaiters = waiters[obs.id];\n      if (!(typeof obsWaiters !== \"undefined\" && obsWaiters !== null)) {\n        obsWaiters = waiters[obs.id] = [f];\n        return waiterObs.push(obs);\n      } else {\n        return obsWaiters.push(f);\n      }\n    } else {\n      return f();\n    }\n  };\n\n  var flush = function () {\n    while (waiterObs.length > 0) {\n      flushWaiters(0, true);\n    }\n    flushed = {};\n  };\n\n  var flushWaiters = function (index, deps) {\n    var obs = waiterObs[index];\n    var obsId = obs.id;\n    var obsWaiters = waiters[obsId];\n    waiterObs.splice(index, 1);\n    delete waiters[obsId];\n    if (deps && waiterObs.length > 0) {\n      flushDepsOf(obs);\n    }\n    for (var i = 0, f; i < obsWaiters.length; i++) {\n      f = obsWaiters[i];\n      f();\n    }\n  };\n\n  var flushDepsOf = function (obs) {\n    if (flushed[obs.id]) return;\n    var deps = obs.internalDeps();\n    for (var i = 0, dep; i < deps.length; i++) {\n      dep = deps[i];\n      flushDepsOf(dep);\n      if (waiters[dep.id]) {\n        var index = _.indexOf(waiterObs, dep);\n        flushWaiters(index, false);\n      }\n    }\n    flushed[obs.id] = true;\n  };\n\n  var inTransaction = function (event, context, f, args) {\n    if (rootEvent) {\n      return f.apply(context, args);\n    } else {\n      rootEvent = event;\n      try {\n        var result = f.apply(context, args);\n\n        flush();\n      } finally {\n        rootEvent = undefined;\n        processAfters();\n      }\n      return result;\n    }\n  };\n\n  var currentEventId = function () {\n    return rootEvent ? rootEvent.id : undefined;\n  };\n\n  var wrappedSubscribe = function (obs, sink) {\n    var unsubd = false;\n    var shouldUnsub = false;\n    var doUnsub = function () {\n      shouldUnsub = true;\n      return shouldUnsub;\n    };\n    var unsub = function () {\n      unsubd = true;\n      return doUnsub();\n    };\n    doUnsub = obs.dispatcher.subscribe(function (event) {\n      return afterTransaction(obs, function () {\n        if (!unsubd) {\n          var reply = sink(event);\n          if (reply === Bacon.noMore) {\n            return unsub();\n          }\n        }\n      });\n    });\n    if (shouldUnsub) {\n      doUnsub();\n    }\n    return unsub;\n  };\n\n  var hasWaiters = function () {\n    return waiterObs.length > 0;\n  };\n\n  return { whenDoneWith: whenDoneWith, hasWaiters: hasWaiters, inTransaction: inTransaction, currentEventId: currentEventId, wrappedSubscribe: wrappedSubscribe, afterTransaction: afterTransaction };\n})();\n\nfunction Source(obs, sync) {\n  var lazy = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n  this.obs = obs;\n  this.sync = sync;\n  this.lazy = lazy;\n  this.queue = [];\n}\n\nextend(Source.prototype, {\n  _isSource: true,\n\n  subscribe: function (sink) {\n    return this.obs.dispatcher.subscribe(sink);\n  },\n  toString: function () {\n    return this.obs.toString();\n  },\n  markEnded: function () {\n    this.ended = true;\n    return true;\n  },\n  consume: function () {\n    if (this.lazy) {\n      return { value: _.always(this.queue[0]) };\n    } else {\n      return this.queue[0];\n    }\n  },\n  push: function (x) {\n    this.queue = [x];\n    return [x];\n  },\n  mayHave: function () {\n    return true;\n  },\n  hasAtLeast: function () {\n    return this.queue.length;\n  },\n  flatten: true\n});\n\nfunction ConsumingSource() {\n  Source.apply(this, arguments);\n}\n\ninherit(ConsumingSource, Source);\nextend(ConsumingSource.prototype, {\n  consume: function () {\n    return this.queue.shift();\n  },\n  push: function (x) {\n    return this.queue.push(x);\n  },\n  mayHave: function (c) {\n    return !this.ended || this.queue.length >= c;\n  },\n  hasAtLeast: function (c) {\n    return this.queue.length >= c;\n  },\n  flatten: false\n});\n\nfunction BufferingSource(obs) {\n  Source.call(this, obs, true);\n}\n\ninherit(BufferingSource, Source);\nextend(BufferingSource.prototype, {\n  consume: function () {\n    var values = this.queue;\n    this.queue = [];\n    return {\n      value: function () {\n        return values;\n      }\n    };\n  },\n  push: function (x) {\n    return this.queue.push(x.value());\n  },\n  hasAtLeast: function () {\n    return true;\n  }\n});\n\nSource.isTrigger = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s.sync;\n  } else {\n    return s != null ? s._isEventStream : void 0;\n  }\n};\n\nSource.fromObservable = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s;\n  } else if (s != null ? s._isProperty : void 0) {\n    return new Source(s, false);\n  } else {\n    return new ConsumingSource(s, true);\n  }\n};\n\nfunction Desc(context, method, args) {\n  this.context = context;\n  this.method = method;\n  this.args = args;\n}\n\nextend(Desc.prototype, {\n  _isDesc: true,\n  deps: function () {\n    if (!this.cached) {\n      this.cached = findDeps([this.context].concat(this.args));\n    }\n    return this.cached;\n  },\n  toString: function () {\n    return _.toString(this.context) + \".\" + _.toString(this.method) + \"(\" + _.map(_.toString, this.args) + \")\";\n  }\n});\n\nvar describe = function (context, method) {\n  var ref = context || method;\n  if (ref && ref._isDesc) {\n    return context || method;\n  } else {\n    for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n\n    return new Desc(context, method, args);\n  }\n};\n\nvar withDesc = function (desc, obs) {\n  obs.desc = desc;\n  return obs;\n};\n\nvar findDeps = function (x) {\n  if (isArray(x)) {\n    return _.flatMap(findDeps, x);\n  } else if (isObservable(x)) {\n    return [x];\n  } else if (typeof x !== \"undefined\" && x !== null ? x._isSource : undefined) {\n    return [x.obs];\n  } else {\n    return [];\n  }\n};\n\nBacon.Desc = Desc;\nBacon.Desc.empty = new Bacon.Desc(\"\", \"\", []);\n\nvar withMethodCallSupport = function (wrapped) {\n  return function (f) {\n    for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    if (typeof f === \"object\" && args.length) {\n      var context = f;\n      var methodName = args[0];\n      f = function () {\n        return context[methodName].apply(context, arguments);\n      };\n      args = args.slice(1);\n    }\n    return wrapped.apply(undefined, [f].concat(args));\n  };\n};\n\nvar makeFunctionArgs = function (args) {\n  args = Array.prototype.slice.call(args);\n  return makeFunction_.apply(undefined, args);\n};\n\nvar partiallyApplied = function (f, applied) {\n  return function () {\n    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return f.apply(undefined, applied.concat(args));\n  };\n};\n\nvar toSimpleExtractor = function (args) {\n  return function (key) {\n    return function (value) {\n      if (!(typeof value !== \"undefined\" && value !== null)) {\n        return;\n      } else {\n        var fieldValue = value[key];\n        if (_.isFunction(fieldValue)) {\n          return fieldValue.apply(value, args);\n        } else {\n          return fieldValue;\n        }\n      }\n    };\n  };\n};\n\nvar toFieldExtractor = function (f, args) {\n  var parts = f.slice(1).split(\".\");\n  var partFuncs = _.map(toSimpleExtractor(args), parts);\n  return function (value) {\n    for (var i = 0, f; i < partFuncs.length; i++) {\n      f = partFuncs[i];\n      value = f(value);\n    }\n    return value;\n  };\n};\n\nvar isFieldKey = function (f) {\n  return typeof f === \"string\" && f.length > 1 && f.charAt(0) === \".\";\n};\n\nvar makeFunction_ = withMethodCallSupport(function (f) {\n  for (var _len4 = arguments.length, args = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n    args[_key4 - 1] = arguments[_key4];\n  }\n\n  if (_.isFunction(f)) {\n    if (args.length) {\n      return partiallyApplied(f, args);\n    } else {\n      return f;\n    }\n  } else if (isFieldKey(f)) {\n    return toFieldExtractor(f, args);\n  } else {\n    return _.always(f);\n  }\n});\n\nvar makeFunction = function (f, args) {\n  return makeFunction_.apply(undefined, [f].concat(args));\n};\n\nvar convertArgsToFunction = function (obs, f, args, method) {\n  if (typeof f !== \"undefined\" && f !== null ? f._isProperty : undefined) {\n    var sampled = f.sampledBy(obs, function (p, s) {\n      return [p, s];\n    });\n    return method.call(sampled, function (_ref) {\n      var p = _ref[0];\n      var s = _ref[1];\n      return p;\n    }).map(function (_ref2) {\n      var p = _ref2[0];\n      var s = _ref2[1];\n      return s;\n    });\n  } else {\n    f = makeFunction(f, args);\n    return method.call(obs, f);\n  }\n};\n\nvar toCombinator = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else if (isFieldKey(f)) {\n    var key = toFieldKey(f);\n    return function (left, right) {\n      return left[key](right);\n    };\n  } else {\n    throw new Exception(\"not a function or a field key: \" + f);\n  }\n};\n\nvar toFieldKey = function (f) {\n  return f.slice(1);\n};\n\nfunction Some(value) {\n  this.value = value;\n}\n\nextend(Some.prototype, {\n  _isSome: true,\n  getOrElse: function () {\n    return this.value;\n  },\n  get: function () {\n    return this.value;\n  },\n  filter: function (f) {\n    if (f(this.value)) {\n      return new Some(this.value);\n    } else {\n      return None;\n    }\n  },\n  map: function (f) {\n    return new Some(f(this.value));\n  },\n  forEach: function (f) {\n    return f(this.value);\n  },\n  isDefined: true,\n  toArray: function () {\n    return [this.value];\n  },\n  inspect: function () {\n    return \"Some(\" + this.value + \")\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n});\n\nvar None = {\n  _isNone: true,\n  getOrElse: function (value) {\n    return value;\n  },\n  filter: function () {\n    return None;\n  },\n  map: function () {\n    return None;\n  },\n  forEach: function () {},\n  isDefined: false,\n  toArray: function () {\n    return [];\n  },\n  inspect: function () {\n    return \"None\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n};\n\nvar toOption = function (v) {\n  if ((typeof v !== \"undefined\" && v !== null ? v._isSome : undefined) || (typeof v !== \"undefined\" && v !== null ? v._isNone : undefined)) {\n    return v;\n  } else {\n    return new Some(v);\n  }\n};\n\nBacon.noMore = \"<no-more>\";\nBacon.more = \"<more>\";\n\nvar eventIdCounter = 0;\n\nfunction Event() {\n  this.id = ++eventIdCounter;\n}\n\nEvent.prototype._isEvent = true;\nEvent.prototype.isEvent = function () {\n  return true;\n};\nEvent.prototype.isEnd = function () {\n  return false;\n};\nEvent.prototype.isInitial = function () {\n  return false;\n};\nEvent.prototype.isNext = function () {\n  return false;\n};\nEvent.prototype.isError = function () {\n  return false;\n};\nEvent.prototype.hasValue = function () {\n  return false;\n};\nEvent.prototype.filter = function () {\n  return true;\n};\nEvent.prototype.inspect = function () {\n  return this.toString();\n};\nEvent.prototype.log = function () {\n  return this.toString();\n};\n\nfunction Next(valueF, eager) {\n  if (!(this instanceof Next)) {\n    return new Next(valueF, eager);\n  }\n\n  Event.call(this);\n\n  if (!eager && _.isFunction(valueF) || (valueF != null ? valueF._isNext : void 0)) {\n    this.valueF = valueF;\n    this.valueInternal = void 0;\n  } else {\n    this.valueF = void 0;\n    this.valueInternal = valueF;\n  }\n}\n\ninherit(Next, Event);\n\nNext.prototype.isNext = function () {\n  return true;\n};\nNext.prototype.hasValue = function () {\n  return true;\n};\nNext.prototype.value = function () {\n  var ref;\n  if ((ref = this.valueF) != null ? ref._isNext : void 0) {\n    this.valueInternal = this.valueF.value();\n    this.valueF = void 0;\n  } else if (this.valueF) {\n    this.valueInternal = this.valueF();\n    this.valueF = void 0;\n  }\n  return this.valueInternal;\n};\n\nNext.prototype.fmap = function (f) {\n  var event, value;\n  if (this.valueInternal) {\n    value = this.valueInternal;\n    return this.apply(function () {\n      return f(value);\n    });\n  } else {\n    event = this;\n    return this.apply(function () {\n      return f(event.value());\n    });\n  }\n};\n\nNext.prototype.apply = function (value) {\n  return new Next(value);\n};\nNext.prototype.filter = function (f) {\n  return f(this.value());\n};\nNext.prototype.toString = function () {\n  return _.toString(this.value());\n};\nNext.prototype.log = function () {\n  return this.value();\n};\nNext.prototype._isNext = true;\n\nfunction Initial(valueF, eager) {\n  if (!(this instanceof Initial)) {\n    return new Initial(valueF, eager);\n  }\n  Next.call(this, valueF, eager);\n}\n\ninherit(Initial, Next);\nInitial.prototype._isInitial = true;\nInitial.prototype.isInitial = function () {\n  return true;\n};\nInitial.prototype.isNext = function () {\n  return false;\n};\nInitial.prototype.apply = function (value) {\n  return new Initial(value);\n};\nInitial.prototype.toNext = function () {\n  return new Next(this);\n};\n\nfunction End() {\n  if (!(this instanceof End)) {\n    return new End();\n  }\n  Event.call(this);\n}\n\ninherit(End, Event);\nEnd.prototype.isEnd = function () {\n  return true;\n};\nEnd.prototype.fmap = function () {\n  return this;\n};\nEnd.prototype.apply = function () {\n  return this;\n};\nEnd.prototype.toString = function () {\n  return \"<end>\";\n};\n\nfunction Error(error) {\n  if (!(this instanceof Error)) {\n    return new Error(error);\n  }\n  this.error = error;\n  Event.call(this);\n}\n\ninherit(Error, Event);\nError.prototype.isError = function () {\n  return true;\n};\nError.prototype.fmap = function () {\n  return this;\n};\nError.prototype.apply = function () {\n  return this;\n};\nError.prototype.toString = function () {\n  return \"<error> \" + _.toString(this.error);\n};\n\nBacon.Event = Event;\nBacon.Initial = Initial;\nBacon.Next = Next;\nBacon.End = End;\nBacon.Error = Error;\n\nvar initialEvent = function (value) {\n  return new Initial(value, true);\n};\nvar nextEvent = function (value) {\n  return new Next(value, true);\n};\nvar endEvent = function () {\n  return new End();\n};\nvar toEvent = function (x) {\n  if (x && x._isEvent) {\n    return x;\n  } else {\n    return nextEvent(x);\n  }\n};\n\nvar idCounter = 0;\nvar registerObs = function () {};\n\nfunction Observable(desc) {\n  this.desc = desc;\n  this.id = ++idCounter;\n  this.initialDesc = this.desc;\n}\n\nextend(Observable.prototype, {\n  _isObservable: true,\n\n  subscribe: function (sink) {\n    return UpdateBarrier.wrappedSubscribe(this, sink);\n  },\n\n  subscribeInternal: function (sink) {\n    return this.dispatcher.subscribe(sink);\n  },\n\n  onValue: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.hasValue()) {\n        return f(event.value());\n      }\n    });\n  },\n\n  onValues: function (f) {\n    return this.onValue(function (args) {\n      return f.apply(undefined, args);\n    });\n  },\n\n  onError: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isError()) {\n        return f(event.error);\n      }\n    });\n  },\n\n  onEnd: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isEnd()) {\n        return f();\n      }\n    });\n  },\n\n  name: function (name) {\n    this._name = name;\n    return this;\n  },\n\n  withDescription: function () {\n    this.desc = describe.apply(undefined, arguments);\n    return this;\n  },\n\n  toString: function () {\n    if (this._name) {\n      return this._name;\n    } else {\n      return this.desc.toString();\n    }\n  },\n\n  deps: function () {\n    return this.desc.deps();\n  },\n\n  internalDeps: function () {\n    return this.initialDesc.deps();\n  }\n});\n\nObservable.prototype.assign = Observable.prototype.onValue;\nObservable.prototype.forEach = Observable.prototype.onValue;\nObservable.prototype.inspect = Observable.prototype.toString;\n\nBacon.Observable = Observable;\n\nfunction CompositeUnsubscribe() {\n  var ss = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\n  this.unsubscribe = _.bind(this.unsubscribe, this);\n  this.unsubscribed = false;\n  this.subscriptions = [];\n  this.starting = [];\n  for (var i = 0, s; i < ss.length; i++) {\n    s = ss[i];\n    this.add(s);\n  }\n}\n\nextend(CompositeUnsubscribe.prototype, {\n  add: function (subscription) {\n    var _this2 = this;\n\n    if (this.unsubscribed) {\n      return;\n    }\n    var ended = false;\n    var unsub = nop;\n    this.starting.push(subscription);\n    var unsubMe = function () {\n      if (_this2.unsubscribed) {\n        return;\n      }\n      ended = true;\n      _this2.remove(unsub);\n      return _.remove(subscription, _this2.starting);\n    };\n    unsub = subscription(this.unsubscribe, unsubMe);\n    if (!(this.unsubscribed || ended)) {\n      this.subscriptions.push(unsub);\n    } else {\n      unsub();\n    }\n    _.remove(subscription, this.starting);\n    return unsub;\n  },\n\n  remove: function (unsub) {\n    if (this.unsubscribed) {\n      return;\n    }\n    if (_.remove(unsub, this.subscriptions) !== undefined) {\n      return unsub();\n    }\n  },\n\n  unsubscribe: function () {\n    if (this.unsubscribed) {\n      return;\n    }\n    this.unsubscribed = true;\n    var iterable = this.subscriptions;\n    for (var i = 0; i < iterable.length; i++) {\n      iterable[i]();\n    }\n    this.subscriptions = [];\n    this.starting = [];\n    return [];\n  },\n\n  count: function () {\n    if (this.unsubscribed) {\n      return 0;\n    }\n    return this.subscriptions.length + this.starting.length;\n  },\n\n  empty: function () {\n    return this.count() === 0;\n  }\n});\n\nBacon.CompositeUnsubscribe = CompositeUnsubscribe;\n\nfunction Dispatcher(_subscribe, _handleEvent) {\n  this._subscribe = _subscribe;\n  this._handleEvent = _handleEvent;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.handleEvent = _.bind(this.handleEvent, this);\n  this.pushing = false;\n  this.ended = false;\n  this.prevError = undefined;\n  this.unsubSrc = undefined;\n  this.subscriptions = [];\n  this.queue = [];\n}\n\nDispatcher.prototype.hasSubscribers = function () {\n  return this.subscriptions.length > 0;\n};\n\nDispatcher.prototype.removeSub = function (subscription) {\n  this.subscriptions = _.without(subscription, this.subscriptions);\n  return this.subscriptions;\n};\n\nDispatcher.prototype.push = function (event) {\n  if (event.isEnd()) {\n    this.ended = true;\n  }\n  return UpdateBarrier.inTransaction(event, this, this.pushIt, [event]);\n};\n\nDispatcher.prototype.pushToSubscriptions = function (event) {\n  try {\n    var tmp = this.subscriptions;\n    var len = tmp.length;\n    for (var i = 0; i < len; i++) {\n      var sub = tmp[i];\n      var reply = sub.sink(event);\n      if (reply === Bacon.noMore || event.isEnd()) {\n        this.removeSub(sub);\n      }\n    }\n    return true;\n  } catch (error) {\n    this.pushing = false;\n    this.queue = [];\n    throw error;\n  }\n};\n\nDispatcher.prototype.pushIt = function (event) {\n  if (!this.pushing) {\n    if (event === this.prevError) {\n      return;\n    }\n    if (event.isError()) {\n      this.prevError = event;\n    }\n    this.pushing = true;\n    this.pushToSubscriptions(event);\n    this.pushing = false;\n    while (this.queue.length) {\n      event = this.queue.shift();\n      this.push(event);\n    }\n    if (this.hasSubscribers()) {\n      return Bacon.more;\n    } else {\n      this.unsubscribeFromSource();\n      return Bacon.noMore;\n    }\n  } else {\n    this.queue.push(event);\n    return Bacon.more;\n  }\n};\n\nDispatcher.prototype.handleEvent = function (event) {\n  if (this._handleEvent) {\n    return this._handleEvent(event);\n  } else {\n    return this.push(event);\n  }\n};\n\nDispatcher.prototype.unsubscribeFromSource = function () {\n  if (this.unsubSrc) {\n    this.unsubSrc();\n  }\n  this.unsubSrc = undefined;\n};\n\nDispatcher.prototype.subscribe = function (sink) {\n  var subscription;\n  if (this.ended) {\n    sink(endEvent());\n    return nop;\n  } else {\n    assertFunction(sink);\n    subscription = {\n      sink: sink\n    };\n    this.subscriptions.push(subscription);\n    if (this.subscriptions.length === 1) {\n      this.unsubSrc = this._subscribe(this.handleEvent);\n      assertFunction(this.unsubSrc);\n    }\n    return (function (_this) {\n      return function () {\n        _this.removeSub(subscription);\n        if (!_this.hasSubscribers()) {\n          return _this.unsubscribeFromSource();\n        }\n      };\n    })(this);\n  }\n};\n\nBacon.Dispatcher = Dispatcher;\n\nfunction EventStream(desc, subscribe, handler) {\n  if (!(this instanceof EventStream)) {\n    return new EventStream(desc, subscribe, handler);\n  }\n  if (_.isFunction(desc)) {\n    handler = subscribe;\n    subscribe = desc;\n    desc = Desc.empty;\n  }\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new Dispatcher(subscribe, handler);\n  registerObs(this);\n}\n\ninherit(EventStream, Observable);\nextend(EventStream.prototype, {\n  _isEventStream: true,\n\n  toProperty: function (initValue_) {\n    var initValue = arguments.length === 0 ? None : toOption(function () {\n      return initValue_;\n    });\n    var disp = this.dispatcher;\n    var desc = new Bacon.Desc(this, \"toProperty\", [initValue_]);\n    return new Property(desc, function (sink) {\n      var initSent = false;\n      var subbed = false;\n      var unsub = nop;\n      var reply = Bacon.more;\n      var sendInit = function () {\n        if (!initSent) {\n          return initValue.forEach(function (value) {\n            initSent = true;\n            reply = sink(new Initial(value));\n            if (reply === Bacon.noMore) {\n              unsub();\n              unsub = nop;\n              return nop;\n            }\n          });\n        }\n      };\n\n      unsub = disp.subscribe(function (event) {\n        if (event.hasValue()) {\n          if (event.isInitial() && !subbed) {\n            initValue = new Some(function () {\n              return event.value();\n            });\n            return Bacon.more;\n          } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = true;\n            initValue = new Some(event);\n            return sink(event);\n          }\n        } else {\n          if (event.isEnd()) {\n            reply = sendInit();\n          }\n          if (reply !== Bacon.noMore) {\n            return sink(event);\n          }\n        }\n      });\n      subbed = true;\n      sendInit();\n      return unsub;\n    });\n  },\n\n  toEventStream: function () {\n    return this;\n  },\n\n  withHandler: function (handler) {\n    return new EventStream(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  }\n});\n\nBacon.EventStream = EventStream;\n\nBacon.never = function () {\n  return new EventStream(describe(Bacon, \"never\"), function (sink) {\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.when = function () {\n  if (arguments.length === 0) {\n    return Bacon.never();\n  }\n  var len = arguments.length;\n  var usage = \"when: expecting arguments in the form (Observable+,function)+\";\n\n  assert(usage, len % 2 === 0);\n  var sources = [];\n  var pats = [];\n  var i = 0;\n  var patterns = [];\n  while (i < len) {\n    patterns[i] = arguments[i];\n    patterns[i + 1] = arguments[i + 1];\n    var patSources = _.toArray(arguments[i]);\n    var f = constantToFunction(arguments[i + 1]);\n    var pat = { f: f, ixs: [] };\n    var triggerFound = false;\n    for (var j = 0, s; j < patSources.length; j++) {\n      s = patSources[j];\n      var index = _.indexOf(sources, s);\n      if (!triggerFound) {\n        triggerFound = Source.isTrigger(s);\n      }\n      if (index < 0) {\n        sources.push(s);\n        index = sources.length - 1;\n      }\n      for (var k = 0, ix; k < pat.ixs.length; k++) {\n        ix = pat.ixs[k];\n        if (ix.index === index) {\n          ix.count++;\n        }\n      }\n      pat.ixs.push({ index: index, count: 1 });\n    }\n\n    assert(\"At least one EventStream required\", triggerFound || !patSources.length);\n\n    if (patSources.length > 0) {\n      pats.push(pat);\n    }\n    i = i + 2;\n  }\n\n  if (!sources.length) {\n    return Bacon.never();\n  }\n\n  sources = _.map(Source.fromObservable, sources);\n  var needsBarrier = _.any(sources, function (s) {\n    return s.flatten;\n  }) && containsDuplicateDeps(_.map(function (s) {\n    return s.obs;\n  }, sources));\n\n  var desc = new Bacon.Desc(Bacon, \"when\", patterns);\n  var resultStream = new EventStream(desc, function (sink) {\n    var triggers = [];\n    var ends = false;\n    var match = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].hasAtLeast(i.count)) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var cannotSync = function (source) {\n      return !source.sync || source.ended;\n    };\n    var cannotMatch = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].mayHave(i.count)) {\n          return true;\n        }\n      }\n    };\n    var nonFlattened = function (trigger) {\n      return !trigger.source.flatten;\n    };\n    var part = function (source) {\n      return function (unsubAll) {\n        var flushLater = function () {\n          return UpdateBarrier.whenDoneWith(resultStream, flush);\n        };\n        var flushWhileTriggers = function () {\n          if (triggers.length > 0) {\n            var reply = Bacon.more;\n            var trigger = triggers.pop();\n            for (var i1 = 0, p; i1 < pats.length; i1++) {\n              p = pats[i1];\n              if (match(p)) {\n                var events = (function () {\n                  var result = [];\n                  for (var i2 = 0, i; i2 < p.ixs.length; i2++) {\n                    i = p.ixs[i2];\n                    result.push(sources[i.index].consume());\n                  }\n                  return result;\n                })();\n                reply = sink(trigger.e.apply(function () {\n                  var _p;\n\n                  var values = (function () {\n                    var result = [];\n                    for (var i2 = 0, event; i2 < events.length; i2++) {\n                      event = events[i2];\n                      result.push(event.value());\n                    }\n                    return result;\n                  })();\n\n                  return (_p = p).f.apply(_p, values);\n                }));\n                if (triggers.length) {\n                  triggers = _.filter(nonFlattened, triggers);\n                }\n                if (reply === Bacon.noMore) {\n                  return reply;\n                } else {\n                  return flushWhileTriggers();\n                }\n              }\n            }\n          } else {\n            return Bacon.more;\n          }\n        };\n        var flush = function () {\n          var reply = flushWhileTriggers();\n          if (ends) {\n            if (_.all(sources, cannotSync) || _.all(pats, cannotMatch)) {\n              reply = Bacon.noMore;\n              sink(endEvent());\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n\n          return reply;\n        };\n        return source.subscribe(function (e) {\n          if (e.isEnd()) {\n            ends = true;\n            source.markEnded();\n            flushLater();\n          } else if (e.isError()) {\n            var reply = sink(e);\n          } else {\n            source.push(e);\n            if (source.sync) {\n              triggers.push({ source: source, e: e });\n              if (needsBarrier || UpdateBarrier.hasWaiters()) {\n                flushLater();\n              } else {\n                flush();\n              }\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n          return reply || Bacon.more;\n        });\n      };\n    };\n\n    return new Bacon.CompositeUnsubscribe((function () {\n      var result = [];\n      for (var i1 = 0, s; i1 < sources.length; i1++) {\n        s = sources[i1];\n        result.push(part(s));\n      }\n      return result;\n    })()).unsubscribe;\n  });\n  return resultStream;\n};\n\nvar containsDuplicateDeps = function (observables) {\n  var state = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  var checkObservable = function (obs) {\n    if (_.contains(state, obs)) {\n      return true;\n    } else {\n      var deps = obs.internalDeps();\n      if (deps.length) {\n        state.push(obs);\n        return _.any(deps, checkObservable);\n      } else {\n        state.push(obs);\n        return false;\n      }\n    }\n  };\n\n  return _.any(observables, checkObservable);\n};\n\nvar constantToFunction = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else {\n    return _.always(f);\n  }\n};\n\nBacon.groupSimultaneous = function () {\n  for (var _len5 = arguments.length, streams = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n    streams[_key5] = arguments[_key5];\n  }\n\n  if (streams.length === 1 && isArray(streams[0])) {\n    streams = streams[0];\n  }\n  var sources = (function () {\n    var result = [];\n    for (var i = 0, s; i < streams.length; i++) {\n      s = streams[i];\n      result.push(new BufferingSource(s));\n    }\n    return result;\n  })();\n  return withDesc(new Bacon.Desc(Bacon, \"groupSimultaneous\", streams), Bacon.when(sources, function () {\n    for (var _len6 = arguments.length, xs = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n      xs[_key6] = arguments[_key6];\n    }\n\n    return xs;\n  }));\n};\n\nfunction PropertyDispatcher(property, subscribe, handleEvent) {\n  Dispatcher.call(this, subscribe, handleEvent);\n  this.property = property;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.current = None;\n  this.currentValueRootId = undefined;\n  this.propertyEnded = false;\n}\n\ninherit(PropertyDispatcher, Dispatcher);\nextend(PropertyDispatcher.prototype, {\n  push: function (event) {\n    if (event.isEnd()) {\n      this.propertyEnded = true;\n    }\n    if (event.hasValue()) {\n      this.current = new Some(event);\n      this.currentValueRootId = UpdateBarrier.currentEventId();\n    }\n    return Dispatcher.prototype.push.call(this, event);\n  },\n\n  maybeSubSource: function (sink, reply) {\n    if (reply === Bacon.noMore) {\n      return nop;\n    } else if (this.propertyEnded) {\n      sink(endEvent());\n      return nop;\n    } else {\n      return Dispatcher.prototype.subscribe.call(this, sink);\n    }\n  },\n\n  subscribe: function (sink) {\n    var _this3 = this;\n\n    var initSent = false;\n\n    var reply = Bacon.more;\n\n    if (this.current.isDefined && (this.hasSubscribers() || this.propertyEnded)) {\n      var dispatchingId = UpdateBarrier.currentEventId();\n      var valId = this.currentValueRootId;\n      if (!this.propertyEnded && valId && dispatchingId && dispatchingId !== valId) {\n        UpdateBarrier.whenDoneWith(this.property, function () {\n          if (_this3.currentValueRootId === valId) {\n            return sink(initialEvent(_this3.current.get().value()));\n          }\n        });\n\n        return this.maybeSubSource(sink, reply);\n      } else {\n        UpdateBarrier.inTransaction(undefined, this, function () {\n          reply = sink(initialEvent(this.current.get().value()));\n          return reply;\n        }, []);\n        return this.maybeSubSource(sink, reply);\n      }\n    } else {\n      return this.maybeSubSource(sink, reply);\n    }\n  }\n});\n\nfunction Property(desc, subscribe, handler) {\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new PropertyDispatcher(this, subscribe, handler);\n  registerObs(this);\n}\n\ninherit(Property, Observable);\nextend(Property.prototype, {\n  _isProperty: true,\n\n  changes: function () {\n    var _this4 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"changes\", []), function (sink) {\n      return _this4.dispatcher.subscribe(function (event) {\n        if (!event.isInitial()) {\n          return sink(event);\n        }\n      });\n    });\n  },\n\n  withHandler: function (handler) {\n    return new Property(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  },\n\n  toProperty: function () {\n    assertNoArguments(arguments);\n    return this;\n  },\n\n  toEventStream: function () {\n    var _this5 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"toEventStream\", []), function (sink) {\n      return _this5.dispatcher.subscribe(function (event) {\n        if (event.isInitial()) {\n          event = event.toNext();\n        }\n        return sink(event);\n      });\n    });\n  }\n});\n\nBacon.Property = Property;\n\nBacon.constant = function (value) {\n  return new Property(new Bacon.Desc(Bacon, \"constant\", [value]), function (sink) {\n    sink(initialEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.fromBinder = function (binder) {\n  var eventTransformer = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromBinder\", [binder, eventTransformer]);\n  return new EventStream(desc, function (sink) {\n    var unbound = false;\n    var shouldUnbind = false;\n    var unbind = function () {\n      if (!unbound) {\n        if (typeof unbinder !== \"undefined\" && unbinder !== null) {\n          unbinder();\n          return unbound = true;\n        } else {\n          return shouldUnbind = true;\n        }\n      }\n    };\n    var unbinder = binder(function () {\n      var ref;\n\n      for (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n        args[_key7] = arguments[_key7];\n      }\n\n      var value = eventTransformer.apply(this, args);\n      if (!(isArray(value) && ((ref = _.last(value)) != null ? ref._isEvent : undefined))) {\n        value = [value];\n      }\n      var reply = Bacon.more;\n      for (var i = 0, event; i < value.length; i++) {\n        event = value[i];\n        reply = sink(event = toEvent(event));\n        if (reply === Bacon.noMore || event.isEnd()) {\n          unbind();\n          return reply;\n        }\n      }\n      return reply;\n    });\n    if (shouldUnbind) {\n      unbind();\n    }\n    return unbind;\n  });\n};\n\nBacon.Observable.prototype.map = function (p) {\n  for (var _len8 = arguments.length, args = Array(_len8 > 1 ? _len8 - 1 : 0), _key8 = 1; _key8 < _len8; _key8++) {\n    args[_key8 - 1] = arguments[_key8];\n  }\n\n  return convertArgsToFunction(this, p, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n      return this.push(event.fmap(f));\n    }));\n  });\n};\n\nvar argumentsToObservables = function (args) {\n  if (isArray(args[0])) {\n    return args[0];\n  } else {\n    return Array.prototype.slice.call(args);\n  }\n};\n\nvar argumentsToObservablesAndFunction = function (args) {\n  if (_.isFunction(args[0])) {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 1)), args[0]];\n  } else {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 0, args.length - 1)), _.last(args)];\n  }\n};\n\nBacon.combineAsArray = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    var sources = [];\n    for (var i = 0; i < streams.length; i++) {\n      var stream = isObservable(streams[i]) ? streams[i] : Bacon.constant(streams[i]);\n      sources.push(new Source(stream, true));\n    }\n    return withDesc(new Bacon.Desc(Bacon, \"combineAsArray\", streams), Bacon.when(sources, function () {\n      for (var _len9 = arguments.length, xs = Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n        xs[_key9] = arguments[_key9];\n      }\n\n      return xs;\n    }).toProperty());\n  } else {\n    return Bacon.constant([]);\n  }\n};\n\nBacon.onValues = function () {\n  return Bacon.combineAsArray(Array.prototype.slice.call(arguments, 0, arguments.length - 1)).onValues(arguments[arguments.length - 1]);\n};\n\nBacon.combineWith = function () {\n  var _argumentsToObservablesAndFunction = argumentsToObservablesAndFunction(arguments);\n\n  var streams = _argumentsToObservablesAndFunction[0];\n  var f = _argumentsToObservablesAndFunction[1];\n\n  var desc = new Bacon.Desc(Bacon, \"combineWith\", [f].concat(streams));\n  return withDesc(desc, Bacon.combineAsArray(streams).map(function (values) {\n    return f.apply(undefined, values);\n  }));\n};\n\nBacon.Observable.prototype.combine = function (other, f) {\n  var combinator = toCombinator(f);\n  var desc = new Bacon.Desc(this, \"combine\", [other, f]);\n  return withDesc(desc, Bacon.combineAsArray(this, other).map(function (values) {\n    return combinator(values[0], values[1]);\n  }));\n};\n\nBacon.Observable.prototype.withStateMachine = function (initState, f) {\n  var state = initState;\n  var desc = new Bacon.Desc(this, \"withStateMachine\", [initState, f]);\n  return withDesc(desc, this.withHandler(function (event) {\n    var fromF = f(state, event);\n    var newState = fromF[0];\n    var outputs = fromF[1];\n\n    state = newState;\n    var reply = Bacon.more;\n    for (var i = 0, output; i < outputs.length; i++) {\n      output = outputs[i];\n      reply = this.push(output);\n      if (reply === Bacon.noMore) {\n        return reply;\n      }\n    }\n    return reply;\n  }));\n};\n\nvar equals = function (a, b) {\n  return a === b;\n};\n\nvar isNone = function (object) {\n  return typeof object !== \"undefined\" && object !== null ? object._isNone : false;\n};\n\nBacon.Observable.prototype.skipDuplicates = function () {\n  var isEqual = arguments.length <= 0 || arguments[0] === undefined ? equals : arguments[0];\n\n  var desc = new Bacon.Desc(this, \"skipDuplicates\", []);\n  return withDesc(desc, this.withStateMachine(None, function (prev, event) {\n    if (!event.hasValue()) {\n      return [prev, [event]];\n    } else if (event.isInitial() || isNone(prev) || !isEqual(prev.get(), event.value())) {\n      return [new Some(event.value()), [event]];\n    } else {\n      return [prev, []];\n    }\n  }));\n};\n\nBacon.Observable.prototype.awaiting = function (other) {\n  var desc = new Bacon.Desc(this, \"awaiting\", [other]);\n  return withDesc(desc, Bacon.groupSimultaneous(this, other).map(function (values) {\n    return values[1].length === 0;\n  }).toProperty(false).skipDuplicates());\n};\n\nBacon.Observable.prototype.not = function () {\n  return withDesc(new Bacon.Desc(this, \"not\", []), this.map(function (x) {\n    return !x;\n  }));\n};\n\nBacon.Property.prototype.and = function (other) {\n  return withDesc(new Bacon.Desc(this, \"and\", [other]), this.combine(other, function (x, y) {\n    return x && y;\n  }));\n};\n\nBacon.Property.prototype.or = function (other) {\n  return withDesc(new Bacon.Desc(this, \"or\", [other]), this.combine(other, function (x, y) {\n    return x || y;\n  }));\n};\n\nBacon.scheduler = {\n  setTimeout: function (f, d) {\n    return setTimeout(f, d);\n  },\n  setInterval: function (f, i) {\n    return setInterval(f, i);\n  },\n  clearInterval: function (id) {\n    return clearInterval(id);\n  },\n  clearTimeout: function (id) {\n    return clearTimeout(id);\n  },\n  now: function () {\n    return new Date().getTime();\n  }\n};\n\nBacon.EventStream.prototype.bufferWithTime = function (delay) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithTime\", [delay]), this.bufferWithTimeOrCount(delay, Number.MAX_VALUE));\n};\n\nBacon.EventStream.prototype.bufferWithCount = function (count) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithCount\", [count]), this.bufferWithTimeOrCount(undefined, count));\n};\n\nBacon.EventStream.prototype.bufferWithTimeOrCount = function (delay, count) {\n  var flushOrSchedule = function (buffer) {\n    if (buffer.values.length === count) {\n      return buffer.flush();\n    } else if (delay !== undefined) {\n      return buffer.schedule();\n    }\n  };\n  var desc = new Bacon.Desc(this, \"bufferWithTimeOrCount\", [delay, count]);\n  return withDesc(desc, this.buffer(delay, flushOrSchedule, flushOrSchedule));\n};\n\nBacon.EventStream.prototype.buffer = function (delay) {\n  var onInput = arguments.length <= 1 || arguments[1] === undefined ? nop : arguments[1];\n  var onFlush = arguments.length <= 2 || arguments[2] === undefined ? nop : arguments[2];\n\n  var buffer = {\n    scheduled: null,\n    end: undefined,\n    values: [],\n    flush: function () {\n      if (this.scheduled) {\n        Bacon.scheduler.clearTimeout(this.scheduled);\n        this.scheduled = null;\n      }\n      if (this.values.length > 0) {\n        var valuesToPush = this.values;\n        this.values = [];\n        var reply = this.push(nextEvent(valuesToPush));\n        if (this.end != null) {\n          return this.push(this.end);\n        } else if (reply !== Bacon.noMore) {\n          return onFlush(this);\n        }\n      } else {\n        if (this.end != null) {\n          return this.push(this.end);\n        }\n      }\n    },\n    schedule: function () {\n      var _this6 = this;\n\n      if (!this.scheduled) {\n        return this.scheduled = delay(function () {\n          return _this6.flush();\n        });\n      }\n    }\n  };\n  var reply = Bacon.more;\n  if (!_.isFunction(delay)) {\n    var delayMs = delay;\n    delay = function (f) {\n      return Bacon.scheduler.setTimeout(f, delayMs);\n    };\n  }\n  return withDesc(new Bacon.Desc(this, \"buffer\", []), this.withHandler(function (event) {\n    var _this7 = this;\n\n    buffer.push = function (event) {\n      return _this7.push(event);\n    };\n    if (event.isError()) {\n      reply = this.push(event);\n    } else if (event.isEnd()) {\n      buffer.end = event;\n      if (!buffer.scheduled) {\n        buffer.flush();\n      }\n    } else {\n      buffer.values.push(event.value());\n\n      onInput(buffer);\n    }\n    return reply;\n  }));\n};\n\nBacon.Observable.prototype.filter = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len10 = arguments.length, args = Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n    args[_key10 - 1] = arguments[_key10];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"filter\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.once = function (value) {\n  return new EventStream(new Desc(Bacon, \"once\", [value]), function (sink) {\n    sink(toEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.EventStream.prototype.concat = function (right) {\n  var left = this;\n  return new EventStream(new Bacon.Desc(left, \"concat\", [right]), function (sink) {\n    var unsubRight = nop;\n    var unsubLeft = left.dispatcher.subscribe(function (e) {\n      if (e.isEnd()) {\n        unsubRight = right.toEventStream().dispatcher.subscribe(sink);\n        return unsubRight;\n      } else {\n        return sink(e);\n      }\n    });\n    return function () {\n      return unsubLeft(), unsubRight();\n    };\n  });\n};\n\nBacon.Property.prototype.concat = function (right) {\n  return addPropertyInitValueToStream(this, this.changes().concat(right));\n};\n\nBacon.concatAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"concatAll\", streams), _.fold(_.tail(streams), _.head(streams).toEventStream(), function (a, b) {\n      return a.concat(b);\n    }));\n  } else {\n    return Bacon.never();\n  }\n};\n\nvar addPropertyInitValueToStream = function (property, stream) {\n  var justInitValue = new EventStream(describe(property, \"justInitValue\"), function (sink) {\n    var value = undefined;\n    var unsub = property.dispatcher.subscribe(function (event) {\n      if (!event.isEnd()) {\n        value = event;\n      }\n      return Bacon.noMore;\n    });\n    UpdateBarrier.whenDoneWith(justInitValue, function () {\n      if (typeof value !== \"undefined\" && value !== null) {\n        sink(value);\n      }\n      return sink(endEvent());\n    });\n    return unsub;\n  });\n  return justInitValue.concat(stream).toProperty();\n};\n\nBacon.Observable.prototype.flatMap = function () {\n  return flatMap_(this, makeSpawner(arguments));\n};\n\nBacon.Observable.prototype.flatMapFirst = function () {\n  return flatMap_(this, makeSpawner(arguments), true);\n};\n\nvar makeSpawner = function (args) {\n  if (args.length === 1 && isObservable(args[0])) {\n    return _.always(args[0]);\n  } else {\n    return makeFunctionArgs(args);\n  }\n};\n\nvar makeObservable = function (x) {\n  if (isObservable(x)) {\n    return x;\n  } else {\n    return Bacon.once(x);\n  }\n};\n\nvar flatMap_ = function (root, f, firstOnly, limit) {\n  var rootDep = [root];\n  var childDeps = [];\n  var desc = new Bacon.Desc(root, \"flatMap\" + (firstOnly ? \"First\" : \"\"), [f]);\n  var result = new EventStream(desc, function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var queue = [];\n    var spawn = function (event) {\n      var child = makeObservable(f(event.value()));\n      childDeps.push(child);\n      return composite.add(function (unsubAll, unsubMe) {\n        return child.dispatcher.subscribe(function (event) {\n          if (event.isEnd()) {\n            _.remove(child, childDeps);\n            checkQueue();\n            checkEnd(unsubMe);\n            return Bacon.noMore;\n          } else {\n            if (typeof event !== \"undefined\" && event !== null ? event._isInitial : undefined) {\n              event = event.toNext();\n            }\n            var reply = sink(event);\n            if (reply === Bacon.noMore) {\n              unsubAll();\n            }\n            return reply;\n          }\n        });\n      });\n    };\n    var checkQueue = function () {\n      var event = queue.shift();\n      if (event) {\n        return spawn(event);\n      }\n    };\n    var checkEnd = function (unsub) {\n      unsub();\n      if (composite.empty()) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (__, unsubRoot) {\n      return root.dispatcher.subscribe(function (event) {\n        if (event.isEnd()) {\n          return checkEnd(unsubRoot);\n        } else if (event.isError()) {\n          return sink(event);\n        } else if (firstOnly && composite.count() > 1) {\n          return Bacon.more;\n        } else {\n          if (composite.unsubscribed) {\n            return Bacon.noMore;\n          }\n          if (limit && composite.count() > limit) {\n            return queue.push(event);\n          } else {\n            return spawn(event);\n          }\n        }\n      });\n    });\n    return composite.unsubscribe;\n  });\n  result.internalDeps = function () {\n    if (childDeps.length) {\n      return rootDep.concat(childDeps);\n    } else {\n      return rootDep;\n    }\n  };\n  return result;\n};\n\nBacon.Observable.prototype.flatMapWithConcurrencyLimit = function (limit) {\n  for (var _len11 = arguments.length, args = Array(_len11 > 1 ? _len11 - 1 : 0), _key11 = 1; _key11 < _len11; _key11++) {\n    args[_key11 - 1] = arguments[_key11];\n  }\n\n  var desc = new Bacon.Desc(this, \"flatMapWithConcurrencyLimit\", [limit].concat(args));\n  return withDesc(desc, flatMap_(this, makeSpawner(args), false, limit));\n};\n\nBacon.Observable.prototype.flatMapConcat = function () {\n  var desc = new Bacon.Desc(this, \"flatMapConcat\", Array.prototype.slice.call(arguments, 0));\n  return withDesc(desc, this.flatMapWithConcurrencyLimit.apply(this, [1].concat(_slice.call(arguments))));\n};\n\nBacon.later = function (delay, value) {\n  return withDesc(new Bacon.Desc(Bacon, \"later\", [delay, value]), Bacon.fromBinder(function (sink) {\n    var sender = function () {\n      return sink([value, endEvent()]);\n    };\n    var id = Bacon.scheduler.setTimeout(sender, delay);\n    return function () {\n      return Bacon.scheduler.clearTimeout(id);\n    };\n  }));\n};\n\nBacon.Observable.prototype.bufferingThrottle = function (minimumInterval) {\n  var desc = new Bacon.Desc(this, \"bufferingThrottle\", [minimumInterval]);\n  return withDesc(desc, this.flatMapConcat(function (x) {\n    return Bacon.once(x).concat(Bacon.later(minimumInterval).filter(false));\n  }));\n};\n\nBacon.Property.prototype.bufferingThrottle = function () {\n  return Bacon.Observable.prototype.bufferingThrottle.apply(this, arguments).toProperty();\n};\n\nfunction Bus() {\n  if (!(this instanceof Bus)) {\n    return new Bus();\n  }\n\n  this.unsubAll = _.bind(this.unsubAll, this);\n  this.subscribeAll = _.bind(this.subscribeAll, this);\n  this.guardedSink = _.bind(this.guardedSink, this);\n\n  this.sink = undefined;\n  this.subscriptions = [];\n  this.ended = false;\n  EventStream.call(this, new Bacon.Desc(Bacon, \"Bus\", []), this.subscribeAll);\n}\n\ninherit(Bus, EventStream);\nextend(Bus.prototype, {\n  unsubAll: function () {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (typeof sub.unsub === \"function\") {\n        sub.unsub();\n      }\n    }\n  },\n\n  subscribeAll: function (newSink) {\n    if (this.ended) {\n      newSink(endEvent());\n    } else {\n      this.sink = newSink;\n      var iterable = cloneArray(this.subscriptions);\n      for (var i = 0, subscription; i < iterable.length; i++) {\n        subscription = iterable[i];\n        this.subscribeInput(subscription);\n      }\n    }\n    return this.unsubAll;\n  },\n\n  guardedSink: function (input) {\n    var _this8 = this;\n\n    return function (event) {\n      if (event.isEnd()) {\n        _this8.unsubscribeInput(input);\n        return Bacon.noMore;\n      } else {\n        return _this8.sink(event);\n      }\n    };\n  },\n\n  subscribeInput: function (subscription) {\n    subscription.unsub = subscription.input.dispatcher.subscribe(this.guardedSink(subscription.input));\n    return subscription.unsub;\n  },\n\n  unsubscribeInput: function (input) {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (sub.input === input) {\n        if (typeof sub.unsub === \"function\") {\n          sub.unsub();\n        }\n        this.subscriptions.splice(i, 1);\n        return;\n      }\n    }\n  },\n\n  plug: function (input) {\n    var _this9 = this;\n\n    assertObservable(input);\n    if (this.ended) {\n      return;\n    }\n    var sub = { input: input };\n    this.subscriptions.push(sub);\n    if (typeof this.sink !== \"undefined\") {\n      this.subscribeInput(sub);\n    }\n    return function () {\n      return _this9.unsubscribeInput(input);\n    };\n  },\n\n  end: function () {\n    this.ended = true;\n    this.unsubAll();\n    if (typeof this.sink === \"function\") {\n      return this.sink(endEvent());\n    }\n  },\n\n  push: function (value) {\n    if (!this.ended && typeof this.sink === \"function\") {\n      var rootPush = !this.pushing;\n      if (!rootPush) {\n        if (!this.pushQueue) this.pushQueue = [];\n        this.pushQueue.push(value);\n\n        return;\n      }\n      this.pushing = true;\n      try {\n        return this.sink(nextEvent(value));\n      } finally {\n        if (rootPush && this.pushQueue) {\n          var i = 0;\n          while (i < this.pushQueue.length) {\n            var value = this.pushQueue[i];\n            this.sink(nextEvent(value));\n            i++;\n          }\n          this.pushQueue = null;\n        }\n        this.pushing = false;\n      }\n    }\n  },\n\n  error: function (error) {\n    if (typeof this.sink === \"function\") {\n      return this.sink(new Error(error));\n    }\n  }\n});\n\nBacon.Bus = Bus;\n\nvar liftCallback = function (desc, wrapped) {\n  return withMethodCallSupport(function (f) {\n    var stream = partiallyApplied(wrapped, [function (values, callback) {\n      return f.apply(undefined, values.concat([callback]));\n    }]);\n\n    for (var _len12 = arguments.length, args = Array(_len12 > 1 ? _len12 - 1 : 0), _key12 = 1; _key12 < _len12; _key12++) {\n      args[_key12 - 1] = arguments[_key12];\n    }\n\n    return withDesc(new Bacon.Desc(Bacon, desc, [f].concat(args)), Bacon.combineAsArray(args).flatMap(stream));\n  });\n};\n\nBacon.fromCallback = liftCallback(\"fromCallback\", function (f) {\n  for (var _len13 = arguments.length, args = Array(_len13 > 1 ? _len13 - 1 : 0), _key13 = 1; _key13 < _len13; _key13++) {\n    args[_key13 - 1] = arguments[_key13];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (value) {\n    return [value, endEvent()];\n  });\n});\n\nBacon.fromNodeCallback = liftCallback(\"fromNodeCallback\", function (f) {\n  for (var _len14 = arguments.length, args = Array(_len14 > 1 ? _len14 - 1 : 0), _key14 = 1; _key14 < _len14; _key14++) {\n    args[_key14 - 1] = arguments[_key14];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (error, value) {\n    if (error) {\n      return [new Error(error), endEvent()];\n    }\n    return [value, endEvent()];\n  });\n});\n\nBacon.combineTemplate = function (template) {\n  function current(ctxStack) {\n    return ctxStack[ctxStack.length - 1];\n  }\n  function setValue(ctxStack, key, value) {\n    current(ctxStack)[key] = value;\n    return value;\n  }\n  function applyStreamValue(key, index) {\n    return function (ctxStack, values) {\n      setValue(ctxStack, key, values[index]);\n    };\n  }\n  function constantValue(key, value) {\n    return function (ctxStack) {\n      setValue(ctxStack, key, value);\n    };\n  }\n\n  function mkContext(template) {\n    return isArray(template) ? [] : {};\n  }\n\n  function pushContext(key, value) {\n    return function (ctxStack) {\n      var newContext = mkContext(value);\n      setValue(ctxStack, key, newContext);\n      ctxStack.push(newContext);\n    };\n  }\n\n  function containsObservables(value) {\n    if (isObservable(value)) {\n      return true;\n    } else if (value && (value.constructor == Object || value.constructor == Array)) {\n      for (var key in value) {\n        if (Object.prototype.hasOwnProperty.call(value, key)) {\n          var child = value[key];\n          if (containsObservables(child)) return true;\n        }\n      }\n    }\n  }\n\n  function compile(key, value) {\n    if (isObservable(value)) {\n      streams.push(value);\n      funcs.push(applyStreamValue(key, streams.length - 1));\n    } else if (containsObservables(value)) {\n      var popContext = function (ctxStack) {\n        ctxStack.pop();\n      };\n      funcs.push(pushContext(key, value));\n      compileTemplate(value);\n      funcs.push(popContext);\n    } else {\n      funcs.push(constantValue(key, value));\n    }\n  }\n\n  function combinator(values) {\n    var rootContext = mkContext(template);\n    var ctxStack = [rootContext];\n    for (var i = 0, f; i < funcs.length; i++) {\n      f = funcs[i];\n      f(ctxStack, values);\n    }\n    return rootContext;\n  }\n\n  function compileTemplate(template) {\n    _.each(template, compile);\n  }\n\n  var funcs = [];\n  var streams = [];\n\n  var resultProperty = containsObservables(template) ? (compileTemplate(template), Bacon.combineAsArray(streams).map(combinator)) : Bacon.constant(template);\n\n  return withDesc(new Bacon.Desc(Bacon, \"combineTemplate\", [template]), resultProperty);\n};\n\nBacon.Observable.prototype.mapEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      this.push(nextEvent(f(event)));\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.skipErrors = function () {\n  return withDesc(new Bacon.Desc(this, \"skipErrors\", []), this.withHandler(function (event) {\n    if (event.isError()) {\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.takeUntil = function (stopper) {\n  var endMarker = {};\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), Bacon.groupSimultaneous(this.mapEnd(endMarker), stopper.skipErrors()).withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      var _event$value = event.value();\n\n      var data = _event$value[0];\n      var stopper = _event$value[1];\n\n      if (stopper.length) {\n        return this.push(endEvent());\n      } else {\n        var reply = Bacon.more;\n        for (var i = 0, value; i < data.length; i++) {\n          value = data[i];\n          if (value === endMarker) {\n            reply = this.push(endEvent());\n          } else {\n            reply = this.push(nextEvent(value));\n          }\n        }\n        return reply;\n      }\n    }\n  }));\n};\n\nBacon.Property.prototype.takeUntil = function (stopper) {\n  var changes = this.changes().takeUntil(stopper);\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), addPropertyInitValueToStream(this, changes));\n};\n\nBacon.Observable.prototype.flatMapLatest = function () {\n  var f = makeSpawner(arguments);\n  var stream = this.toEventStream();\n  return withDesc(new Bacon.Desc(this, \"flatMapLatest\", [f]), stream.flatMap(function (value) {\n    return makeObservable(f(value)).takeUntil(stream);\n  }));\n};\n\nBacon.Property.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, addPropertyInitValueToStream(this, f(this.changes())));\n};\n\nBacon.EventStream.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, f(this));\n};\n\nBacon.Observable.prototype.delay = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"delay\", [delay]), function (changes) {\n    return changes.flatMap(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounce = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounce\", [delay]), function (changes) {\n    return changes.flatMapLatest(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounceImmediate = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounceImmediate\", [delay]), function (changes) {\n    return changes.flatMapFirst(function (value) {\n      return Bacon.once(value).concat(Bacon.later(delay).filter(false));\n    });\n  });\n};\n\nBacon.Observable.prototype.decode = function (cases) {\n  return withDesc(new Bacon.Desc(this, \"decode\", [cases]), this.combine(Bacon.combineTemplate(cases), function (key, values) {\n    return values[key];\n  }));\n};\n\nBacon.Observable.prototype.scan = function (seed, f) {\n  var _this10 = this;\n\n  var resultProperty;\n  f = toCombinator(f);\n  var acc = toOption(seed);\n  var initHandled = false;\n  var subscribe = function (sink) {\n    var initSent = false;\n    var unsub = nop;\n    var reply = Bacon.more;\n    var sendInit = function () {\n      if (!initSent) {\n        return acc.forEach(function (value) {\n          initSent = initHandled = true;\n          reply = sink(new Initial(function () {\n            return value;\n          }));\n          if (reply === Bacon.noMore) {\n            unsub();\n            unsub = nop;\n            return unsub;\n          }\n        });\n      }\n    };\n    unsub = _this10.dispatcher.subscribe(function (event) {\n      if (event.hasValue()) {\n        if (initHandled && event.isInitial()) {\n          return Bacon.more;\n        } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = initHandled = true;\n            var prev = acc.getOrElse(undefined);\n            var next = f(prev, event.value());\n\n            acc = new Some(next);\n            return sink(event.apply(function () {\n              return next;\n            }));\n          }\n      } else {\n        if (event.isEnd()) {\n          reply = sendInit();\n        }\n        if (reply !== Bacon.noMore) {\n          return sink(event);\n        }\n      }\n    });\n    UpdateBarrier.whenDoneWith(resultProperty, sendInit);\n    return unsub;\n  };\n  resultProperty = new Property(new Bacon.Desc(this, \"scan\", [seed, f]), subscribe);\n  return resultProperty;\n};\n\nBacon.Observable.prototype.diff = function (start, f) {\n  f = toCombinator(f);\n  return withDesc(new Bacon.Desc(this, \"diff\", [start, f]), this.scan([start], function (prevTuple, next) {\n    return [next, f(prevTuple[0], next)];\n  }).filter(function (tuple) {\n    return tuple.length === 2;\n  }).map(function (tuple) {\n    return tuple[1];\n  }));\n};\n\nBacon.Observable.prototype.doAction = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doAction\", [f]), this.withHandler(function (event) {\n    if (event.hasValue()) {\n      f(event.value());\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      f();\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      f(event.error);\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doLog = function () {\n  for (var _len15 = arguments.length, args = Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n    args[_key15] = arguments[_key15];\n  }\n\n  return withDesc(new Bacon.Desc(this, \"doLog\", args), this.withHandler(function (event) {\n    if (typeof console !== \"undefined\" && console !== null && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.endOnError = function (f) {\n  if (!(typeof f !== \"undefined\" && f !== null)) {\n    f = true;\n  }\n\n  for (var _len16 = arguments.length, args = Array(_len16 > 1 ? _len16 - 1 : 0), _key16 = 1; _key16 < _len16; _key16++) {\n    args[_key16 - 1] = arguments[_key16];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"endOnError\", []), this.withHandler(function (event) {\n      if (event.isError() && f(event.error)) {\n        this.push(event);\n        return this.push(endEvent());\n      } else {\n        return this.push(event);\n      }\n    }));\n  });\n};\n\nObservable.prototype.errors = function () {\n  return withDesc(new Bacon.Desc(this, \"errors\", []), this.filter(function () {\n    return false;\n  }));\n};\n\nBacon.Observable.prototype.take = function (count) {\n  if (count <= 0) {\n    return Bacon.never();\n  }\n  return withDesc(new Bacon.Desc(this, \"take\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      count--;\n      if (count > 0) {\n        return this.push(event);\n      } else {\n        if (count === 0) {\n          this.push(event);\n        }\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }\n  }));\n};\n\nBacon.Observable.prototype.first = function () {\n  return withDesc(new Bacon.Desc(this, \"first\", []), this.take(1));\n};\n\nBacon.Observable.prototype.mapError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      return this.push(nextEvent(f(event.error)));\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.flatMapError = function (fn) {\n  var desc = new Bacon.Desc(this, \"flatMapError\", [fn]);\n  return withDesc(desc, this.mapError(function (err) {\n    return new Error(err);\n  }).flatMap(function (x) {\n    if (x instanceof Error) {\n      return fn(x.error);\n    } else {\n      return Bacon.once(x);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.flatScan = function (seed, f) {\n  var current = seed;\n  return this.flatMapConcat(function (next) {\n    return makeObservable(f(current, next)).doAction(function (updated) {\n      return current = updated;\n    });\n  }).toProperty(seed);\n};\n\nBacon.EventStream.prototype.sampledBy = function (sampler, combinator) {\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), this.toProperty().sampledBy(sampler, combinator));\n};\n\nBacon.Property.prototype.sampledBy = function (sampler, combinator) {\n  var lazy = false;\n  if (typeof combinator !== \"undefined\" && combinator !== null) {\n    combinator = toCombinator(combinator);\n  } else {\n    lazy = true;\n    combinator = function (f) {\n      return f.value();\n    };\n  }\n  var thisSource = new Source(this, false, lazy);\n  var samplerSource = new Source(sampler, true, lazy);\n  var stream = Bacon.when([thisSource, samplerSource], combinator);\n  var result = sampler._isProperty ? stream.toProperty() : stream;\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), result);\n};\n\nBacon.Property.prototype.sample = function (interval) {\n  return withDesc(new Bacon.Desc(this, \"sample\", [interval]), this.sampledBy(Bacon.interval(interval, {})));\n};\n\nBacon.Observable.prototype.map = function (p) {\n  if (p && p._isProperty) {\n    return p.sampledBy(this, former);\n  } else {\n    for (var _len17 = arguments.length, args = Array(_len17 > 1 ? _len17 - 1 : 0), _key17 = 1; _key17 < _len17; _key17++) {\n      args[_key17 - 1] = arguments[_key17];\n    }\n\n    return convertArgsToFunction(this, p, args, function (f) {\n      return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n        return this.push(event.fmap(f));\n      }));\n    });\n  }\n};\n\nBacon.Observable.prototype.fold = function (seed, f) {\n  return withDesc(new Bacon.Desc(this, \"fold\", [seed, f]), this.scan(seed, f).sampledBy(this.filter(false).mapEnd().toProperty()));\n};\n\nObservable.prototype.reduce = Observable.prototype.fold;\n\nvar eventMethods = [[\"addEventListener\", \"removeEventListener\"], [\"addListener\", \"removeListener\"], [\"on\", \"off\"], [\"bind\", \"unbind\"]];\n\nvar findHandlerMethods = function (target) {\n  var pair;\n  for (var i = 0; i < eventMethods.length; i++) {\n    pair = eventMethods[i];\n    var methodPair = [target[pair[0]], target[pair[1]]];\n    if (methodPair[0] && methodPair[1]) {\n      return methodPair;\n    }\n  }\n  for (var j = 0; j < eventMethods.length; j++) {\n    pair = eventMethods[j];\n    var addListener = target[pair[0]];\n    if (addListener) {\n      return [addListener, function () {}];\n    }\n  }\n  throw new Error(\"No suitable event methods in \" + target);\n};\n\nBacon.fromEventTarget = function (target, eventName, eventTransformer) {\n  var _findHandlerMethods = findHandlerMethods(target);\n\n  var sub = _findHandlerMethods[0];\n  var unsub = _findHandlerMethods[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromEvent\", [target, eventName]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    sub.call(target, eventName, handler);\n    return function () {\n      return unsub.call(target, eventName, handler);\n    };\n  }, eventTransformer));\n};\n\nBacon.fromEvent = Bacon.fromEventTarget;\n\nBacon.fromPoll = function (delay, poll) {\n  var desc = new Bacon.Desc(Bacon, \"fromPoll\", [delay, poll]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    var id = Bacon.scheduler.setInterval(handler, delay);\n    return function () {\n      return Bacon.scheduler.clearInterval(id);\n    };\n  }, poll));\n};\n\nfunction valueAndEnd(value) {\n  return [value, endEvent()];\n}\n\nBacon.fromPromise = function (promise, abort) {\n  var eventTransformer = arguments.length <= 2 || arguments[2] === undefined ? valueAndEnd : arguments[2];\n\n  return withDesc(new Bacon.Desc(Bacon, \"fromPromise\", [promise]), Bacon.fromBinder(function (handler) {\n    var bound = promise.then(handler, function (e) {\n      return handler(new Error(e));\n    });\n    if (bound && typeof bound.done === \"function\") {\n      bound.done();\n    }\n\n    if (abort) {\n      return function () {\n        if (typeof promise.abort === \"function\") {\n          return promise.abort();\n        }\n      };\n    } else {\n      return function () {};\n    }\n  }, eventTransformer));\n};\n\nBacon.Observable.prototype.groupBy = function (keyF) {\n  var limitF = arguments.length <= 1 || arguments[1] === undefined ? Bacon._.id : arguments[1];\n\n  var streams = {};\n  var src = this;\n  return src.filter(function (x) {\n    return !streams[keyF(x)];\n  }).map(function (x) {\n    var key = keyF(x);\n    var similar = src.filter(function (x) {\n      return keyF(x) === key;\n    });\n    var data = Bacon.once(x).concat(similar);\n    var limited = limitF(data, x).withHandler(function (event) {\n      this.push(event);\n      if (event.isEnd()) {\n        return delete streams[key];\n      }\n    });\n    streams[key] = limited;\n    return limited;\n  });\n};\n\nBacon.fromArray = function (values) {\n  assertArray(values);\n  if (!values.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"fromArray\", values), Bacon.never());\n  } else {\n    var i = 0;\n    var stream = new EventStream(new Bacon.Desc(Bacon, \"fromArray\", [values]), function (sink) {\n      var unsubd = false;\n      var reply = Bacon.more;\n      var pushing = false;\n      var pushNeeded = false;\n      function push() {\n        pushNeeded = true;\n        if (pushing) {\n          return;\n        }\n        pushing = true;\n        while (pushNeeded) {\n          pushNeeded = false;\n          if (reply !== Bacon.noMore && !unsubd) {\n            var value = values[i++];\n            reply = sink(toEvent(value));\n            if (reply !== Bacon.noMore) {\n              if (i === values.length) {\n                sink(endEvent());\n              } else {\n                UpdateBarrier.afterTransaction(stream, push);\n              }\n            }\n          }\n        }\n        pushing = false;\n        return pushing;\n      };\n\n      push();\n      return function () {\n        unsubd = true;\n        return unsubd;\n      };\n    });\n    return stream;\n  }\n};\n\nBacon.EventStream.prototype.holdWhen = function (valve) {\n  var onHold = false;\n  var bufferedValues = [];\n  var src = this;\n  var srcIsEnded = false;\n  return new EventStream(new Bacon.Desc(this, \"holdWhen\", [valve]), function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var subscribed = false;\n    var endIfBothEnded = function (unsub) {\n      if (typeof unsub === \"function\") {\n        unsub();\n      }\n      if (composite.empty() && subscribed) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (unsubAll, unsubMe) {\n      return valve.subscribeInternal(function (event) {\n        if (event.hasValue()) {\n          onHold = event.value();\n          if (!onHold) {\n            var toSend = bufferedValues;\n            bufferedValues = [];\n            return (function () {\n              var result = [];\n              for (var i = 0, value; i < toSend.length; i++) {\n                value = toSend[i];\n                result.push(sink(nextEvent(value)));\n              }\n              if (srcIsEnded) {\n                result.push(sink(endEvent()));\n                unsubMe();\n              }\n              return result;\n            })();\n          }\n        } else if (event.isEnd()) {\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    composite.add(function (unsubAll, unsubMe) {\n      return src.subscribeInternal(function (event) {\n        if (onHold && event.hasValue()) {\n          return bufferedValues.push(event.value());\n        } else if (event.isEnd() && bufferedValues.length) {\n          srcIsEnded = true;\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    subscribed = true;\n    endIfBothEnded();\n    return composite.unsubscribe;\n  });\n};\n\nBacon.interval = function (delay) {\n  var value = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  return withDesc(new Bacon.Desc(Bacon, \"interval\", [delay, value]), Bacon.fromPoll(delay, function () {\n    return nextEvent(value);\n  }));\n};\n\nBacon.$ = {};\nBacon.$.asEventStream = function (eventName, selector, eventTransformer) {\n  var _this11 = this;\n\n  if (_.isFunction(selector)) {\n    eventTransformer = selector;\n    selector = undefined;\n  }\n\n  return withDesc(new Bacon.Desc(this.selector || this, \"asEventStream\", [eventName]), Bacon.fromBinder(function (handler) {\n    _this11.on(eventName, selector, handler);\n    return function () {\n      return _this11.off(eventName, selector, handler);\n    };\n  }, eventTransformer));\n};\n\nif (typeof jQuery !== \"undefined\" && jQuery) {\n  jQuery.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nif (typeof Zepto !== \"undefined\" && Zepto) {\n  Zepto.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nBacon.Observable.prototype.last = function () {\n  var lastEvent;\n\n  return withDesc(new Bacon.Desc(this, \"last\", []), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      if (lastEvent) {\n        this.push(lastEvent);\n      }\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      lastEvent = event;\n    }\n  }));\n};\n\nBacon.Observable.prototype.log = function () {\n  for (var _len18 = arguments.length, args = Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n    args[_key18] = arguments[_key18];\n  }\n\n  this.subscribe(function (event) {\n    if (typeof console !== \"undefined\" && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n  });\n  return this;\n};\n\nBacon.EventStream.prototype.merge = function (right) {\n  assertEventStream(right);\n  var left = this;\n  return withDesc(new Bacon.Desc(left, \"merge\", [right]), Bacon.mergeAll(this, right));\n};\n\nBacon.mergeAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return new EventStream(new Bacon.Desc(Bacon, \"mergeAll\", streams), function (sink) {\n      var ends = 0;\n      var smartSink = function (obs) {\n        return function (unsubBoth) {\n          return obs.dispatcher.subscribe(function (event) {\n            if (event.isEnd()) {\n              ends++;\n              if (ends === streams.length) {\n                return sink(endEvent());\n              } else {\n                return Bacon.more;\n              }\n            } else {\n              var reply = sink(event);\n              if (reply === Bacon.noMore) {\n                unsubBoth();\n              }\n              return reply;\n            }\n          });\n        };\n      };\n      var sinks = _.map(smartSink, streams);\n      return new Bacon.CompositeUnsubscribe(sinks).unsubscribe;\n    });\n  } else {\n    return Bacon.never();\n  }\n};\n\nBacon.repeatedly = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"repeatedly\", [delay, values]), Bacon.fromPoll(delay, function () {\n    return values[index++ % values.length];\n  }));\n};\n\nBacon.repeat = function (generator) {\n  var index = 0;\n  return Bacon.fromBinder(function (sink) {\n    var flag = false;\n    var reply = Bacon.more;\n    var unsub = function () {};\n    function handleEvent(event) {\n      if (event.isEnd()) {\n        if (!flag) {\n          return flag = true;\n        } else {\n          return subscribeNext();\n        }\n      } else {\n        return reply = sink(event);\n      }\n    };\n    function subscribeNext() {\n      var next;\n      flag = true;\n      while (flag && reply !== Bacon.noMore) {\n        next = generator(index++);\n        flag = false;\n        if (next) {\n          unsub = next.subscribeInternal(handleEvent);\n        } else {\n          sink(endEvent());\n        }\n      }\n      return flag = true;\n    };\n    subscribeNext();\n    return function () {\n      return unsub();\n    };\n  });\n};\n\nBacon.retry = function (options) {\n  if (!_.isFunction(options.source)) {\n    throw new Exception(\"'source' option has to be a function\");\n  }\n  var source = options.source;\n  var retries = options.retries || 0;\n  var retriesDone = 0;\n  var delay = options.delay || function () {\n    return 0;\n  };\n  var isRetryable = options.isRetryable || function () {\n    return true;\n  };\n  var finished = false;\n  var error = null;\n\n  return withDesc(new Bacon.Desc(Bacon, \"retry\", [options]), Bacon.repeat(function (count) {\n    function valueStream() {\n      return source(count).endOnError().withHandler(function (event) {\n        if (event.isError()) {\n          error = event;\n          if (!(isRetryable(error.error) && (retries === 0 || retriesDone < retries))) {\n            finished = true;\n            return this.push(event);\n          }\n        } else {\n          if (event.hasValue()) {\n            error = null;\n            finished = true;\n          }\n          return this.push(event);\n        }\n      });\n    }\n\n    if (finished) {\n      return null;\n    } else if (error) {\n      var context = {\n        error: error.error,\n        retriesDone: retriesDone\n      };\n      var pause = Bacon.later(delay(context)).filter(false);\n      retriesDone++;\n      return pause.concat(Bacon.once().flatMap(valueStream));\n    } else {\n      return valueStream();\n    }\n  }));\n};\n\nBacon.sequentially = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"sequentially\", [delay, values]), Bacon.fromPoll(delay, function () {\n    var value = values[index++];\n    if (index < values.length) {\n      return value;\n    } else if (index === values.length) {\n      return [value, endEvent()];\n    } else {\n      return endEvent();\n    }\n  }));\n};\n\nBacon.Observable.prototype.skip = function (count) {\n  return withDesc(new Bacon.Desc(this, \"skip\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else if (count > 0) {\n      count--;\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.skipUntil = function (starter) {\n  var started = starter.take(1).map(true).toProperty(false);\n  return withDesc(new Bacon.Desc(this, \"skipUntil\", [starter]), this.filter(started));\n};\n\nBacon.EventStream.prototype.skipWhile = function (f) {\n  assertObservableIsProperty(f);\n  var ok = false;\n\n  for (var _len19 = arguments.length, args = Array(_len19 > 1 ? _len19 - 1 : 0), _key19 = 1; _key19 < _len19; _key19++) {\n    args[_key19 - 1] = arguments[_key19];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"skipWhile\", [f]), this.withHandler(function (event) {\n      if (ok || !event.hasValue() || !f(event.value())) {\n        if (event.hasValue()) {\n          ok = true;\n        }\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.slidingWindow = function (n) {\n  var minValues = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n  return withDesc(new Bacon.Desc(this, \"slidingWindow\", [n, minValues]), this.scan([], function (window, value) {\n    return window.concat([value]).slice(-n);\n  }).filter(function (values) {\n    return values.length >= minValues;\n  }));\n};\n\nvar spies = [];\nvar registerObs = function (obs) {\n  if (spies.length) {\n    if (!registerObs.running) {\n      try {\n        registerObs.running = true;\n        spies.forEach(function (spy) {\n          spy(obs);\n        });\n      } finally {\n        delete registerObs.running;\n      }\n    }\n  }\n};\n\nBacon.spy = function (spy) {\n  return spies.push(spy);\n};\n\nBacon.Property.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), this.scan(seed, function (prev, next) {\n    return next;\n  }));\n};\n\nBacon.EventStream.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), Bacon.once(seed).concat(this));\n};\n\nBacon.Observable.prototype.takeWhile = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len20 = arguments.length, args = Array(_len20 > 1 ? _len20 - 1 : 0), _key20 = 1; _key20 < _len20; _key20++) {\n    args[_key20 - 1] = arguments[_key20];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"takeWhile\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.throttle = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"throttle\", [delay]), function (changes) {\n    return changes.bufferWithTime(delay).map(function (values) {\n      return values[values.length - 1];\n    });\n  });\n};\n\nObservable.prototype.firstToPromise = function (PromiseCtr) {\n  var _this12 = this;\n\n  if (typeof PromiseCtr !== \"function\") {\n    if (typeof Promise === \"function\") {\n      PromiseCtr = Promise;\n    } else {\n      throw new Exception(\"There isn't default Promise, use shim or parameter\");\n    }\n  }\n\n  return new PromiseCtr(function (resolve, reject) {\n    return _this12.subscribe(function (event) {\n      if (event.hasValue()) {\n        resolve(event.value());\n      }\n      if (event.isError()) {\n        reject(event.error);\n      }\n\n      return Bacon.noMore;\n    });\n  });\n};\n\nObservable.prototype.toPromise = function (PromiseCtr) {\n  return this.last().firstToPromise(PromiseCtr);\n};\n\nBacon[\"try\"] = function (f) {\n  return function (value) {\n    try {\n      return Bacon.once(f(value));\n    } catch (e) {\n      return new Bacon.Error(e);\n    }\n  };\n};\n\nBacon.update = function (initial) {\n  function lateBindFirst(f) {\n    return function () {\n      for (var _len22 = arguments.length, args = Array(_len22), _key22 = 0; _key22 < _len22; _key22++) {\n        args[_key22] = arguments[_key22];\n      }\n\n      return function (i) {\n        return f.apply(undefined, [i].concat(args));\n      };\n    };\n  }\n\n  for (var _len21 = arguments.length, patterns = Array(_len21 > 1 ? _len21 - 1 : 0), _key21 = 1; _key21 < _len21; _key21++) {\n    patterns[_key21 - 1] = arguments[_key21];\n  }\n\n  var i = patterns.length - 1;\n  while (i > 0) {\n    if (!(patterns[i] instanceof Function)) {\n      patterns[i] = _.always(patterns[i]);\n    }\n    patterns[i] = lateBindFirst(patterns[i]);\n    i = i - 2;\n  }\n  return withDesc(new Bacon.Desc(Bacon, \"update\", [initial].concat(patterns)), Bacon.when.apply(Bacon, patterns).scan(initial, function (x, f) {\n    return f(x);\n  }));\n};\n\nBacon.zipAsArray = function () {\n  for (var _len23 = arguments.length, args = Array(_len23), _key23 = 0; _key23 < _len23; _key23++) {\n    args[_key23] = arguments[_key23];\n  }\n\n  var streams = argumentsToObservables(args);\n  return withDesc(new Bacon.Desc(Bacon, \"zipAsArray\", streams), Bacon.zipWith(streams, function () {\n    for (var _len24 = arguments.length, xs = Array(_len24), _key24 = 0; _key24 < _len24; _key24++) {\n      xs[_key24] = arguments[_key24];\n    }\n\n    return xs;\n  }));\n};\n\nBacon.zipWith = function () {\n  for (var _len25 = arguments.length, args = Array(_len25), _key25 = 0; _key25 < _len25; _key25++) {\n    args[_key25] = arguments[_key25];\n  }\n\n  var observablesAndFunction = argumentsToObservablesAndFunction(args);\n  var streams = observablesAndFunction[0];\n  var f = observablesAndFunction[1];\n\n  streams = _.map(function (s) {\n    return s.toEventStream();\n  }, streams);\n  return withDesc(new Bacon.Desc(Bacon, \"zipWith\", [f].concat(streams)), Bacon.when(streams, f));\n};\n\nBacon.Observable.prototype.zip = function (other, f) {\n  return withDesc(new Bacon.Desc(this, \"zip\", [other]), Bacon.zipWith([this, other], f || Array));\n};\n\nfunction ESObservable(observable) {\n  this.observable = observable;\n}\n\nESObservable.prototype.subscribe = function (observerOrOnNext, onError, onComplete) {\n  var observer = typeof observerOrOnNext === 'function' ? { next: observerOrOnNext, error: onError, complete: onComplete } : observerOrOnNext;\n  var subscription = {\n    closed: false,\n    unsubscribe: function () {\n      subscription.closed = true;\n      cancel();\n    }\n  };\n\n  var cancel = this.observable.subscribe(function (event) {\n    if (event.isError()) {\n      if (observer.error) observer.error(event.error);\n      subscription.unsubscribe();\n    } else if (event.isEnd()) {\n      subscription.closed = true;\n      if (observer.complete) observer.complete();\n    } else if (observer.next) {\n      observer.next(event.value());\n    }\n  });\n  return subscription;\n};\n\nESObservable.prototype[symbol('observable')] = function () {\n  return this;\n};\n\nBacon.Observable.prototype.toESObservable = function () {\n  return new ESObservable(this);\n};\n\nBacon.Observable.prototype[symbol('observable')] = Bacon.Observable.prototype.toESObservable;\n\nBacon.fromESObservable = function (_observable) {\n  var observable;\n  if (_observable[symbol(\"observable\")]) {\n    observable = _observable[symbol(\"observable\")]();\n  } else {\n    observable = _observable;\n  }\n\n  var desc = new Bacon.Desc(Bacon, \"fromESObservable\", [observable]);\n  return new Bacon.EventStream(desc, function (sink) {\n    var cancel = observable.subscribe({\n      error: function () {\n        sink(new Bacon.Error());\n        sink(new Bacon.End());\n      },\n      next: function (value) {\n        sink(new Bacon.Next(value, true));\n      },\n      complete: function () {\n        sink(new Bacon.End());\n      }\n    });\n\n    if (cancel.unsubscribe) {\n      return function () {\n        cancel.unsubscribe();\n      };\n    } else {\n      return cancel;\n    }\n  });\n};\n\nif (typeof define !== \"undefined\" && define !== null && define.amd != null) {\n  define([], function () {\n    return Bacon;\n  });\n  if (typeof this !== \"undefined\" && this !== null) {\n    this.Bacon = Bacon;\n  }\n} else if (typeof module !== \"undefined\" && module !== null && module.exports != null) {\n  module.exports = Bacon;\n  Bacon.Bacon = Bacon;\n} else {\n    this.Bacon = Bacon;\n  }\n}).call(this);\n"],"sourceRoot":""}