{"version":3,"sources":["file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/url.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/index.ts","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/util/match.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/bms/headers.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/bms/objects.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/time-signatures/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/delay@5.0.0/node_modules/delay/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/audio/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/clock.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/game-timer.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/dual-input.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/omni-input-plugin.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/game-controller.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/loaders/loadImage.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/loaders/game-loader.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/loaders/multitasker.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneProgressBar.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneProgress.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneSongInfo.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingScene.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/query-flags.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/Progress.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/observable.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/callbacks.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/audio-context/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/now.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/bytes@3.1.2/node_modules/bytes/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/addUnprefixed.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Scene.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/sampling-master/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/url@0.11.0/node_modules/url/url.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/resource-logging.ts","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/libarchive.js@1.3.0/node_modules/libarchive.js/src/compressed-file.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/libarchive.js@1.3.0/node_modules/libarchive.js/src/libarchive.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/unarchiver.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/custom-song-resources.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/sampling-master/ogg.ts","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/GameShellScene.scss?86a3","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/GameShellScene.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/touch3d.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/benchmark.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/GameShellScene.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/scene-manager/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/reader/index.web.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/reader/getReaderOptionsFromFilename.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/compiler/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/reader/types.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/speedcore/segment.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/notes/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/notes/note.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/notes/channels.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/timing/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/song-info/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/keysounds/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/positioning/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/spacing/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/BemuseTestMode.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/webpack@4.46.0/node_modules/webpack/buildin/amd-define.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/webpack@4.46.0/node_modules/webpack/buildin/amd-options.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/BMSNotechartLoader.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/types.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/logger/index.ts","file:///home/runner/work/bemuse/bemuse/packages/bmson/lib/legacy.js","file:///home/runner/work/bemuse/bemuse/packages/bmson/lib/utils.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/player.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/player-stats.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/note-area.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/Gauge.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/formatTime.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/punycode@1.4.1/node_modules/punycode/punycode.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/midi.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/axis-logic.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/omni-input/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/control.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/index.ts","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/bms/chart.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/path-browserify@0.0.1/node_modules/path-browserify/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/bemuse-package.ts","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/timesynchro@1.0.1/node_modules/timesynchro/client.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/timesynchro@1.0.1/node_modules/timesynchro/timesync.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/keysound-cache/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss?0b11","file:///home/runner/work/bemuse/bemuse/bemuse/src/devtools/ui/BenchmarkPanel.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/player-state.ts","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/keycode@2.2.1/node_modules/keycode/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/player-display.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/p-map@4.0.0/node_modules/p-map/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/aggregate-error@3.1.0/node_modules/aggregate-error/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/indent-string@4.0.0/node_modules/indent-string/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/clean-stack@2.2.0/node_modules/clean-stack/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/dnd-resources.ts","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/classnames@2.3.2/node_modules/classnames/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/url@0.11.0/node_modules/url/util.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/querystring-es3@0.2.1/node_modules/querystring-es3/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/querystring-es3@0.2.1/node_modules/querystring-es3/decode.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/querystring-es3@0.2.1/node_modules/querystring-es3/encode.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/resolveRelativeResource.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/keysound-cache/createKeysoundCache.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/audio/wave-factory.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Scene.scss?9dd2","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Scene.scss","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/speedcore/index.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/index.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/BmsonNotechartLoader.js","file:///home/runner/work/bemuse/bemuse/packages/bmson/lib/index.js","file:///home/runner/work/bemuse/bemuse/packages/bmson/lib/types.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/game.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/audio/player-audio.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/state/index.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/input/touch-plugin.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/game-display.scss?12b6","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/game-display.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/background/default.jpg","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/touch-escape.png","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/touch-replay.png","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/display/touch-fullscreen.png","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/screenfull@3.3.3/node_modules/screenfull/dist/screenfull.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/loaders/samples-loader.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/judgments.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/formatters.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/baconjs@0.7.95/node_modules/baconjs/dist/Bacon.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/read-blob.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/util/lodash.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/utils.ts","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/images/bg/a.jpg","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/game-scene.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingScene.scss?e8ab","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingScene.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneProgress.scss?47c9","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneProgress.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneProgressBar.scss?560d","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneProgressBar.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneSongInfo.scss?c09f","file:///home/runner/work/bemuse/bemuse/bemuse/src/game/ui/LoadingSceneSongInfo.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/download.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/main-element.js"],"names":["URLResource","constructor","url","read","progress","this","as","async","Promise","resolve","name","URLResources","base","path","split","map","part","encodeURIComponent","join","URL","href","Object","defineProperty","exports","value","match","text","matched","when","pattern","callback","else","BMSHeaders","_data","_dataAll","prototype","each","i","get","toLowerCase","getAll","set","key","push","BMSObjects","_objects","add","object","channel","length","test","measure","fraction","all","slice","allSorted","list","sort","a","b","TimeSignatures","_values","getBeats","measureToBeat","sum","createAbortError","error","Error","createDelay","clearTimeout","defaultClear","setTimeout","willResolve","ms","signal","aborted","reject","timeoutId","settle","rejectFn","clear","signalListener","delayPromise","removeEventListener","addEventListener","once","createWithTimers","clearAndSet","delay","range","minimum","maximum","options","Math","floor","random","randomInteger","module","default","game","samples","master","volume","soundVolume","_master","_context","audioContext","_players","Map","players","player","destroy","unmute","context","update","t","state","playerAudio","audio","_offset","_sum","realTime","now","delta","currentTime","shift","time","clock","input","_clock","_input","_now","synchronized","_lastRecordedTimeSinceStart","startTime","_pauseAtTimerValue","Infinity","_unpausedTimeSinceStart","_unpausedTimerValue","readyFraction","gettingStarted","started","_checkStartGame","_calculateTime","_getWait","ceil","pow","timeSinceStart","projectedTimerValue","min","pauseAt","timerValueToPause","DualInput","last","output","combine","window","exclusive","continuous","sensitivity","kbm","keyboard","scratch","isBtn8Free","values","indexOf","isBtn9Free","data","result","p1_1","p1_2","p1_3","p1_4","p1_5","p1_6","p1_7","p1_SC","p1_speedup","p1_speeddown","start","select","dispose","display","_audioInputLatency","audioInputLatency","_game","_display","_audio","_timer","_state","_promise","_resolvePromise","setEscapeHandler","_quitGame","setReplayHandler","_replayGame","initializeBenchmark","initializeTestModeHooks","promise","latestGameTime","_latestGameTime","_handleEscape","use","stopped","frame","_update","requestAnimationFrame","_endGameLoop","onKeyDown","e","keyCode","preventDefault","stopPropagation","finally","finished","replay","A","enabled","benchmark","_instance","_renderer","BemuseTestMode","interval","setInterval","clearInterval","unpause","getScore","stats","score","assets","filename","file","then","asset","arrayBuffer","Blob","blob","createObjectURL","src","image","Image","onload","onerror","load","spec","bms","songId","tasks","running","taskList","task","dependencies","f","run","deps","concat","getTaskStatuses","progressText","toString","bar","status","taskToWatch","watch","Scintillator","getSkinUrl","displayMode","skin","Context","touchEventTarget","current","loader","arraybuffer","notechart","eyecatchImageUrl","resolveRelativeResource","eyecatchImage","backImageUrl","backgroundImage","audioLoadProgress","audioDecodeProgress","videoUrl","includes","resolveUrl","video","document","createElement","canPlayType","onProgress","buffered","duration","report","end","finish","onCanPlayThrough","onError","n","element","offset","videoOffset","console","warn","preload","backgroundImagePromise","receiveSongId","loadFiles","Component","render","className","style","width","props","propTypes","oneOfType","string","number","isRequired","renderItem","round","extra","componentDidMount","_unsubscribe","forceUpdate","componentWillUnmount","song","genre","title","subtitles","artist","subartists","shape","arrayOf","difficulty","level","Scene","ref","eyecatchImagePromise","findDOMNode","refs","eyecatch","appendChild","registerTeardownCallback","scene","classList","func","shouldShowOptions","BEMUSE_SHOW_OPTIONS","shouldEnableBenchmark","BEMUSE_BENCHMARK","shouldDisableFullScreen","BEMUSE_NO_FULLSCREEN","shouldShowAbout","BEMUSE_SHOW_ABOUT","shouldShowModeSelect","BEMUSE_SHOW_MODE_SELECT","isTitleDisplayMode","BEMUSE_TITLE_DISPLAY","Progress","undefined","total","_observable","notify","formatter","_callbacks","_value","call","init","_nextId","args","callbacks","id","AudioContext","latencyHint","Log","BemuseLogger","forModule","performance","Date","synchronize","server","onResult","err","info","o","parse","format","formatThousandsRegExp","formatDecimalsRegExp","kb","mb","gb","tb","pb","parseRegExp","Number","isFinite","mag","abs","thousandsSeparator","unitSeparator","decimalPlaces","fixedDecimals","Boolean","unit","str","toFixed","replace","s","val","isNaN","floatValue","results","exec","parseFloat","parseInt","addUnprefixed","prefix","parts","onDragEnter","children","node","FADE_LENGTH","dummyAudioTag","needsVorbisDecoder","SoundGroup","samplingMaster","_gain","createGain","gain","connect","destination","disconnect","Sample","audioBuffer","_buffer","play","PlayInstance","buffer","source","createBufferSource","onended","stop","group","_source","TEST_node","max","startOffset","fadeIn","fadeOutAt","setValueAtTime","linearRampToValueAtTime","_startPlaying","_stoppedPlaying","onstop","bad","playbackRate","unmuteAudio","ctx","osc","createOscillator","frequency","resume","resumeContext","catch","_audioContext","_samples","_groups","_instances","Set","_destination","_destroyed","sample","instance","decode","blobOrArrayBuffer","_coerceToArrayBuffer","_decodeAudio","blobOrArrayBufferOrAudioBuffer","numberOfChannels","ArrayBuffer","byteLength","view","Uint8Array","decodeAudioData","delete","punycode","util","Url","protocol","slashes","auth","host","port","hostname","hash","search","query","pathname","urlParse","relative","resolveObject","obj","isString","protocolPattern","portPattern","simplePathPattern","unwise","autoEscape","nonHostChars","hostEndingChars","hostnamePartPattern","hostnamePartStart","unsafeProtocol","hostlessProtocol","slashedProtocol","querystring","parseQueryString","slashesDenoteHost","isObject","u","TypeError","queryIndex","splitter","uSplit","rest","trim","simplePath","substr","proto","lowerProto","atSign","hostEnd","hec","lastIndexOf","decodeURIComponent","parseHost","ipv6Hostname","hostparts","l","newpart","j","k","charCodeAt","validParts","notHost","bit","unshift","toASCII","p","h","ae","esc","escape","qm","keys","stringify","charAt","rel","tkeys","tk","tkey","rkeys","rk","rkey","v","relPath","isSourceAbs","isRelAbs","mustEndAbs","removeAllDots","srcPath","psychotic","pop","isNullOrUndefined","authInHost","isNull","hasTrailingSlash","up","splice","isAbsolute","ResourceLogging","loggingFunction","log","setLoggingFunction","fn","forEach","CompressedFile","size","archiveRef","_name","_size","_path","_archiveRef","extract","extractSingleFile","static","_options","workerUrl","open","_worker","Worker","_workerMsg","bind","_content","_processed","_file","_postMessage","type","msg","hasEncryptedData","usePassword","archivePassword","passphrase","getFilesObject","entry","target","prop","_getProp","fileName","_cloneContent","getFilesArray","_objectToArray","File","fileData","extractFiles","extractCallback","terminate","files","cur","prev","postMessage","_msgHandler","ARCHIVE_REGEXP","DROPBOX_REGEXP","provider","_logging","_files","getFiles","fileEntry","out","archive","extracted","traverse","tree","unarchive","unarchiveIfNeeded","fileList","downloadFileEntryFromURL","lastTime","download","decoderPromise","limit","decodeOGG","stbvorbis","ns","eval","buffers","sampleRate","totalLength","eof","decodedChunks","createBuffer","channels","Array","fill","_","ch","ChannelDataWriter","getChannelData","chunk","audioSamples","channelIndex","write","doDecodeOGG","__createBinding","create","m","k2","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","__exportStar","hasOwnProperty","__values","Symbol","iterator","next","done","__importDefault","mod","Notechart","lodash_1","invariant_1","playerOptions","_this","bmsNotes","notes","timing","keysounds","songInfo","positioning","spacing","barLines","images","expertJudgmentWindow","_a","landmineNotes","_preTransform","_timing","_positioning","_spacing","_keysounds","_duration","_notes","_generatePlayableNotesFromBMS","_landmines","_autos","_generateAutoKeysoundEventsFromBMS","_barLines","_generateBarLineEvents","_generateKeysoundFiles","_infos","note","_getNoteInfo","_songInfo","_images","background","beatToSeconds","beat","beatToPosition","position","secondsToBeat","seconds","secondsToPosition","bpmAtBeat","scrollSpeedAtBeat","speed","spacingAtBeat","factor","getKeyMode","e_1","usedColumns","_b","_c","column","e_1_1","return","chain","e_4","bmsNotes_1","bmsNotes_1_1","e_4_1","getKeys","assign","columnsToShift_1","shiftNote","amount","index","newIndex","newColumn","nextId","filter","_generateEvent","keysound","keysoundStart","keysoundEnd","_updateDuration","endBeat","_generateLandminesFromBMS","event","e_2","e_3","autos","_d","array","array_1","array_1_1","event_","e_3_1","e_2_1","from","beats","combos","content","transform","locals","config","getRow","excess","theta","pointX","cos","pointY","sin","projection","y","PLAY_AREA_WIDTH","getTouchedColumn","x","mid","row","x0","x1","pos","String","super","renderTable","bench","stat","align","handleInteraction","setState","show","onClick","onTouchStart","Stat","count","average","hist","lastSec","secAvg","wrap","apply","arguments","lines","div","setAttribute","body","handleDrop","nativeEvent","resources","resource","code","handleItemClick","onSelect","handleClear","selectedResource","any","submit","bindOption","binder","handleDragOver","dropzone","handleSelectFile","onDragOver","onDrop","onSubmit","disabled","onChange","placement","checked","main","loadSpec","latency","autoplay","SC","SC2","displayShell","assetsUrl","metadata","getSong","LoadingScene","controller","_transitioning","_stack","_transitionTo","previousScene","currentScene","getNextScene","currentSceneInstance","teardown","parentNode","removeChild","detach","currentElement","ReactScene","ReactSceneContainer","container","clonedElement","cloneElement","elementToDisplay","unmountComponentAtNode","getReaderOptionsFromFilename","readAsync","chardet","_i","charset","forceEncoding","detect","reader","FileReader","readAsText","getReaderOptionsFromFilename_1","compile","match_1","chart_1","matchers","if","endif","timeSignature","header","dtx","chart","BMSChart","rng","matcher","randomStack","skipStack","headerSentences","channelSentences","controlSentences","skippedSentences","malformedSentences","warnings","line","eachLine","lineNumber","flow","skipped","timeSignatures","items","objects","handleChannelSentence","headers","message","Segment","data_structure_1","dx","__setModuleDefault","__importStar","Notes","note_1","ChannelMapping","Note","fromBMSChart","mapping","CHANNEL_MAPPING","IIDX_P1","BMSNoteBuilder","build","_chart","_mapping","_activeLN","_lastNote","_lnObj","_channelMapping","_handle","_handleNormalNote","toUpperCase","_handleLongNote","_normalizeChannel","_getBeat","_getColumn","maybe","IIDX_DP_LANDMINE","IIDX_P1_LANDMINE","IIDX_DP","D1","D2","D3","D4","D5","D8","D9","D6","E1","E2","E3","E4","E5","E8","E9","E6","Timing","speedcore_1","precedence","bpm","initialBPM","actions","segments","inclusive","action","stopBeats","_speedcore","Speedcore","_eventBeats","uniq","segmentAtX","getEventBeats","SongInfo","extractSubtitle","Keysounds","_map","Positioning","previous","Spacing","_enabled","_lifecycleHandler","enableTestMode","overlay","innerHTML","setGameLifecycleHandler","handler","isTestModeEnabled","__webpack_amd_options__","BMS","__1","getJudgmentWindowFromBMS","rank","generateBarLinesFromBMS","currentBeat","currentMeasure","double","moduleName","bindLogger","toJSON","__read","r","ar","__spreadArray","to","pack","_slicesForNotesAndTiming","beatForLoc","timingInfoForBmson","barLinesForBmson","utils","bmson","sortBy","initBPM","bpmNotes","stopNotes","slicesForNotesAndTiming","beatForPulse","restart","notes_1","notes_1_1","c","lastAdded","soundTime","mustAdd","_e","has","autoplayEnabled","autosound","laneCover","gauge","tutorial","columns","getAccuracyScore","accuracy","getComboScore","totalCombo","totalNotes","combo","maxCombo","rawSumJudgmentWeight","rawTotalComboScore","_calculateRawTotalComboScore","_remainingMaxPossibleRawComboScore","rawSumComboScore","counts","numJudgments","poor","_log","deltas","accuracyScore","comboScore","maxPossibleScore","maxPossibleAccuracyScore","maxPossibleComboScore","remainingJudgments","maxPossibleAccuracy","maxPossibleRawComboScore","currentAccuracy","character","handleJudgment","judgment","rawComboScore","_calculateRawComboScore","_recordLog","handleDelta","_getLogCharacter","lower","upper","getVisibleNotes","headroom","entity","head","tail","height","getVisibleBarLines","getGauge","gaugeType","primary","secondary","playerState","getHope","max1","max2","hopeS","hopeA","shouldDisplay","getPrimary","getSecondary","getExtra","hopeGauge","root","nodeType","freeGlobal","global","self","maxInt","regexPunycode","regexNonASCII","regexSeparators","errors","stringFromCharCode","fromCharCode","RangeError","mapDomain","ucs2decode","counter","ucs2encode","digitToBasic","digit","flag","adapt","numPoints","firstTime","baseMinusTMin","basic","oldi","w","baseMinusT","codePoint","inputLength","bias","encode","handledCPCount","basicLength","q","currentValue","handledCPCountPlusOne","qMinusT","observeMidiAccess","access","fromBinder","sink","inputs","Next","outputs","onstatechange","never","fromEvent","fromPromise","navigator","requestMIDIAccess","flatMap","flatMapError","stack","doLog","AxisLogic","charge","active","positive","axis","threshold","immediateOutput","win","_window","_exclusive","_continuousAxis","setGamepadSensitivity","_disposables","listen","_handleKeyDown","_handleKeyUp","onValue","_handleMIDIMessage","_status","_axis","which","handleNote","bend","_updateGamepads","nav","gamepads","getGamepads","webkitGetGamepads","gamepad","_updateGamepad","buttons","button","axes","axisName","_deadzone","_sensitivity","_analogThreshold","setGamepadContinuousAxisEnabled","handle","diff","difference","fromArray","knownMidiIds","getName","capitalize","midiNote","subject","eventName","listener","changed","justPressed","_controls","_plugins","changes","control","plugin","controlName","union","headers_1","objects_1","time_signatures_1","normalizeArray","allowAboveRoot","xs","res","resolvedPath","resolvedAbsolute","process","cwd","normalize","trailingSlash","paths","arr","fromParts","toParts","samePartsLength","outputParts","sep","delimiter","dirname","hasRoot","matchedSlash","basename","ext","extname","startDot","startPart","preDotState","len","BemusePackageFileResource","getBlob","Ref","_basePromise","loadPayload","getPayload","metadataLength","_getMetadata","_base","_metadataFilename","JSON","_getRefs","_getFileMap","location","fallback","_fallback","_fallbackPattern","fallbackPattern","metadataFilename","simultaneous","resourcePromise","nextProgress","timesync","callback2","ws","WebSocket","clocks","emit","send","getTime","onmessage","fields","convert","onclose","t1","t2","t3","t4","hp","NoteStatus","notifications","sounds","judgments","tainted","_gameTime","_pinching","_columns","_noteBufferByColumn","groupBy","mapValues","startIndex","getNoteStatus","_noteResult","_judge","gameTime","_rawInput","_updateInputColumnMap","_judgeNotes","_updateSpeed","Unjudged","getNoteJudgment","getPlayerInput","_judgeColumn","_modifySpeed","pinch","pinching","direction","_shouldAutoplay","BEMUSE_AUTOPLAY","judgedNote","autoPlayed","_shouldJudge","shouldBreak","_judgeNote","freestyleNote","_getFreestyleNote","_isSandwiched","_getClosestNote","minBy","every","adjacentColumn","some","missed","hit","noteEnd","lifted","passed","isDown","isUp","Judged","Active","_setJudgment","searchInput","hasKeyCode","charCode","names","foundNamedKey","codes","aliases","isEventKey","nameOrCode","alias","skinData","_currentSpeed","_player","_noteArea","_stateful","_defaultData","key_mode","lane_lift","lane_press","_gauge","_touch3dMode","touch3dMode","noteArea","stateful","entities","getUpperBound","putNote","noteY","scale","columnIndex","areaWidth","xOffset","desiredWidth","longNoteStep","updateVisibleNotes","updateBarLines","updateInput","notification","deviationMode","updateJudgment","updateGauge","updateExplode","getCount","AggregateError","iterable","mapper","concurrency","stopOnError","isSafeInteger","isRejected","isIterableDone","resolvingCount","currentIndex","nextItem","indentString","cleanStack","isArray","_errors","indent","includeEmptyLines","regex","repeat","os","extractPathRegex","pathRegex","homeDir","homedir","pretty","pathMatches","p1","DndResources","dataTransfer","types","getData","startsWith","item","readItem","addFile","webkitGetAsEntry","readEntry","getAsFile","isFile","readFile","isDirectory","readDirectory","dir","entries","createReader","readMore","readEntries","getFilesFromEvent","hasOwn","classNames","classes","arg","argType","inner","qs","eq","regexp","maxKeys","kstr","vstr","idx","stringifyPrimitive","objectKeys","ks","resolveRelativeResources","dirName","DirectoryResources","_lastSongId","nextSongId","isEmpty","isCached","soundName","cache","_exclusiveInstances","_group","playAuto","_play","playNote","playFree","_stopOldExclusiveSound","segment_1","_segments","_reached","targetFn","segment","_segmentAt","X","segmentAtT","T","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","rejected","__generator","g","label","sent","trys","ops","verb","op","NotechartLoader","BMSNotechartLoader","BmsonNotechartLoader","coerceToBuffer","bufferOrArrayBuffer","Buffer","isBuffer","loadBmson","loadBMS","readerOptions","compileResult","Reader","Compiler","getExpertJudgmentWindowForBmson","judgeRank","judge_rank","songInfoForBmson","musicalScoreForBmson","stuff","eyecatch_image","back_image","keysForBmson","hasScratch","beatForPulseForBmson","legacy","version","init_bpm","bpm_events","stop_events","soundChannelsForBmson","sound_channels","soundChannel","bmsonInfo","chart_name","subtitle","getSubtitles","timingForBmson","nextKeysoundNumber","soundChannels","soundChannels_1","soundChannels_1_1","name_1","soundChannelNotes","sortedNotes","keysoundNumber","keysoundId","padStart","slices","sortedNotes_1","sortedNotes_1_1","getColumn","notesDataAndKeysoundsDataForBmsonAndTiming","legacy_1","resolution","soundChannels_2","soundChannels_2_1","e_5","e_6","hasKeys","hasSecondPlayer","hasDeluxeKeys","soundChannels_3","soundChannels_3_1","notes_2","notes_2_1","e_6_1","e_5_1","notecharts","autoplayer","waveFactory","_waveFactory","_played","_autosound","_playAutokeysounds","_playAutosounds","_handleSoundNotifications","auto","autosounds","_hitNote","soundNotifications","_breakNote","timer","BUTTONS","StatsRecorder","BEMUSE_TOUCH_STATS","record","localStorage","scratchStartY","scratchY","getInput","getScratch","_expand","getBounds","contains","getButton","bounds","getPinch","pinchThreshold","statsRecorder","lane","rectangle","newRect","clone","createTouchButton","onclick","_wrapper","_createWrapper","panelPlacement","infoPanelPosition","_createTouchEscapeButton","_createFullScreenButton","_escapeHintShown","escapeHandler","_onEscape","replayHandler","_onReplay","_started","gameState","_getData","_updateStatefulData","_synchronizeVideo","_synchronizeTutorialEscapeHint","_video","_videoStarted","_videoOffset","_escapeHint","_getReady","_getSongTime","playerDisplay","playerData","$wrapper","attr","append","find","addClass","appendTo","touchButtons","wrapper","addTouchButton","escapeHint","textContent","request","isCommonjs","keyboardAllowed","Element","fnMap","ret","eventNameMap","change","fullscreenchange","fullscreenerror","screenfull","elem","requestFullscreen","documentElement","userAgent","ALLOW_KEYBOARD_INPUT","exit","exitFullscreen","toggle","isFullscreen","onchange","on","off","raw","defineProperties","fullscreenElement","fullscreenEnabled","keysoundCache","_assets","_keysoundCache","loadProgress","decodeProgress","ondecode","_loadSample","fromPairs","audioBufferPromise","_getFile","_decode","Judgment","UNJUDGED","MISSED","Missed","NORMAL_TIMEGATES","timegate","endTimegate","TRANSITIONAL_BEGINNER_LV5_TIMEGATES","TRANSITIONAL_BEGINNER_LV4_TIMEGATES","TRANSITIONAL_BEGINNER_LV3_TIMEGATES","ABSOLUTE_BEGINNER_TIMEGATES","FixedTimegatesJudge","timegates","getTimegates","_noteTime","TutorialJudge","noteTime","NORMAL_JUDGE","getJudgeForNotechart","insane","judgeTimeWith","judge","judgeTime","judgeEndTime","isBad","breaksCombo","weight","BYTES_FORMATTER","PERCENTAGE_FORMATTER","EXTRA_FORMATTER","_slice","Bacon","Exception","nop","former","assert","condition","assertObservableIsProperty","_isObservable","_isProperty","assertFunction","isFunction","isObservable","assertNoArguments","extend","inherit","child","parent","hasProp","ctor","symbol","indexWhere","always","negate","empty","filtered","toArray","without","remove","fold","seed","ys","cached","None","_isNone","me","recursionDepth","UpdateBarrier","rootEvent","waiterObs","waiters","aftersStack","aftersStackHeight","flushed","ensureStackHeight","afterTransaction","obs","stackIndexForThisObs","containsObs","processAfters","aftersList","stackSizeAtStart","topOfStack","topAfters","_topAfters$index","after","callSuccess","flushWaiters","obsId","obsWaiters","flushDepsOf","dep","internalDeps","whenDoneWith","hasWaiters","inTransaction","flush","currentEventId","wrappedSubscribe","unsubd","shouldUnsub","doUnsub","unsub","dispatcher","subscribe","noMore","Source","sync","lazy","queue","ConsumingSource","BufferingSource","Desc","method","_isSource","markEnded","ended","consume","mayHave","hasAtLeast","flatten","isTrigger","_isEventStream","fromObservable","_isDesc","findDeps","describe","_len","_key","withDesc","withMethodCallSupport","wrapped","_len2","_key2","methodName","makeFunctionArgs","makeFunction_","partiallyApplied","applied","_len3","_key3","toFieldExtractor","partFuncs","fieldValue","toSimpleExtractor","isFieldKey","_len4","_key4","makeFunction","convertArgsToFunction","sampled","sampledBy","_ref","_ref2","toCombinator","toFieldKey","left","right","Some","_isSome","getOrElse","isDefined","inspect","toOption","more","eventIdCounter","Event","valueF","eager","_isNext","valueInternal","Initial","End","_isEvent","isEvent","isEnd","isInitial","isNext","isError","hasValue","fmap","_isInitial","toNext","initialEvent","nextEvent","endEvent","toEvent","idCounter","registerObs","Observable","initialDesc","CompositeUnsubscribe","ss","unsubscribe","unsubscribed","subscriptions","starting","Dispatcher","_subscribe","_handleEvent","handleEvent","pushing","prevError","unsubSrc","EventStream","subscribeInternal","onValues","onEnd","withDescription","subscription","_this2","hasSubscribers","removeSub","pushIt","pushToSubscriptions","tmp","sub","unsubscribeFromSource","toProperty","initValue_","initValue","disp","Property","initSent","subbed","reply","sendInit","toEventStream","withHandler","usage","sources","pats","patterns","patSources","constantToFunction","pat","ixs","triggerFound","ix","needsBarrier","containsDuplicateDeps","resultStream","triggers","ends","i1","cannotSync","cannotMatch","nonFlattened","trigger","unsubAll","flushLater","flushWhileTriggers","events","i2","_p","observables","checkObservable","PropertyDispatcher","property","currentValueRootId","propertyEnded","groupSimultaneous","_len5","streams","_key5","_len6","_key6","maybeSubSource","_this3","dispatchingId","valId","_this4","_this5","constant","eventTransformer","unbound","shouldUnbind","unbind","unbinder","_len7","_key7","_len8","_key8","argumentsToObservables","argumentsToObservablesAndFunction","combineAsArray","stream","_len9","_key9","combineWith","_argumentsToObservablesAndFunction","other","combinator","withStateMachine","initState","fromF","newState","equals","isNone","skipDuplicates","isEqual","awaiting","not","and","or","scheduler","d","bufferWithTime","bufferWithTimeOrCount","MAX_VALUE","bufferWithCount","flushOrSchedule","schedule","onInput","onFlush","scheduled","valuesToPush","_this6","delayMs","_this7","_len10","_key10","unsubRight","unsubLeft","addPropertyInitValueToStream","concatAll","justInitValue","flatMap_","makeSpawner","flatMapFirst","makeObservable","firstOnly","rootDep","childDeps","composite","spawn","unsubMe","checkQueue","checkEnd","__","unsubRoot","Bus","subscribeAll","guardedSink","flatMapWithConcurrencyLimit","_len11","_key11","flatMapConcat","later","bufferingThrottle","minimumInterval","newSink","subscribeInput","_this8","unsubscribeInput","plug","_this9","assertObservable","rootPush","pushQueue","liftCallback","_len12","_key12","fromCallback","_len13","_key13","fromNodeCallback","_len14","_key14","combineTemplate","template","setValue","ctxStack","mkContext","containsObservables","funcs","applyStreamValue","newContext","pushContext","compileTemplate","constantValue","resultProperty","rootContext","mapEnd","skipErrors","takeUntil","stopper","endMarker","_event$value","flatMapLatest","delayChanges","debounce","debounceImmediate","cases","scan","_this10","acc","initHandled","prevTuple","tuple","doAction","doEnd","doError","_len15","_key15","endOnError","_len16","_key16","take","first","mapError","flatScan","updated","sampler","thisSource","samplerSource","_len17","_key17","reduce","eventMethods","valueAndEnd","fromEventTarget","_findHandlerMethods","pair","methodPair","addListener","findHandlerMethods","fromPoll","poll","abort","bound","keyF","limitF","similar","limited","assertArray","pushNeeded","holdWhen","valve","onHold","bufferedValues","srcIsEnded","subscribed","endIfBothEnded","toSend","$","asEventStream","selector","_this11","jQuery","Zepto","lastEvent","_len18","_key18","merge","assertEventStream","mergeAll","sinks","unsubBoth","repeatedly","subscribeNext","retry","retries","retriesDone","isRetryable","valueStream","pause","sequentially","skip","skipUntil","starter","skipWhile","ok","_len19","_key19","slidingWindow","minValues","spies","spy","ESObservable","observable","startWith","takeWhile","_len20","_key20","throttle","firstToPromise","PromiseCtr","_this12","toPromise","initial","lateBindFirst","_len22","_key22","_len21","_key21","Function","zipAsArray","_len23","_key23","zipWith","_len24","_key24","_len25","_key25","observablesAndFunction","zip","observerOrOnNext","onComplete","observer","complete","closed","cancel","toESObservable","fromESObservable","readAsArrayBuffer","lodash_uniq_1","lodash_map_1","lodash_values_1","lodash_assign_1","fixed","loaded","atomic","hasByteLength","wrapPromise","GameScene","disableContextMenu","resize","innerWidth","innerHeight","yOffset","marginTop","showCanvas","getRetryDelay","shouldGiveUp","xh","XMLHttpRequest","responseType","response","onprogress","waitMs","querySelector"],"mappings":";yFACA,sDAIO,MAAMA,EACXC,YAAoBC,GAAA,KAAAA,KAAc,CAClCC,KAAKC,GACH,OAAO,YAASC,KAAKH,KAAKI,GAAG,cAAeF,EAC9C,CAEAG,mBACE,OAAOC,QAAQC,QAAQJ,KAAKH,IAC9B,CAEIQ,WACF,OAAO,mBAASL,KAAKH,IACvB,EAGK,MAAMS,EACXV,YAAmBW,GAAA,KAAAA,MAAY,CAC/BL,WAAWG,GACT,MAAMG,EAAOH,EACVI,MAAM,KACNC,KAAKC,GAASC,mBAAmBD,KACjCE,KAAK,KACR,OAAO,IAAIlB,EAAY,IAAImB,IAAIN,EAAMR,KAAKO,MAAMQ,KAClD,EAGa,K,mCC/Bf,aAGe,MAAQ,C,mCCFvBC,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQE,WAAQ,EAqBhBF,EAAQE,MApBR,SAAeC,GACX,IAAIC,GAAU,EACd,MAAO,CACHC,KAAM,SAAUC,EAASC,GACrB,GAAIH,EACA,OAAOtB,KACX,IAAIoB,EAAQC,EAAKD,MAAMI,GAKvB,OAJIJ,IACAE,GAAU,EACVG,EAASL,IAENpB,IACX,EACA0B,KAAM,SAAUD,GACZ,GAAIH,EACA,OAAOtB,KACXyB,GACJ,EAER,C,mCCrBAT,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQS,gBAAa,EAkBrB,IAAIA,EAA4B,WAC5B,SAASA,IACL3B,KAAK4B,MAAQ,CAAC,EACd5B,KAAK6B,SAAW,CAAC,CACrB,CAoCA,OA/BAF,EAAWG,UAAUC,KAAO,SAAUN,GAClC,IAAK,IAAIO,KAAKhC,KAAK4B,MACfH,EAASO,EAAGhC,KAAK4B,MAAMI,GAE/B,EAMAL,EAAWG,UAAUG,IAAM,SAAU5B,GACjC,OAAOL,KAAK4B,MAAMvB,EAAK6B,cAC3B,EAMAP,EAAWG,UAAUK,OAAS,SAAU9B,GACpC,OAAOL,KAAK6B,SAASxB,EAAK6B,cAC9B,EAMAP,EAAWG,UAAUM,IAAM,SAAU/B,EAAMc,GACvC,IAAIkB,EAAMhC,EAAK6B,cACflC,KAAK4B,MAAMS,GAAOlB,GACjBnB,KAAK6B,SAASQ,KAASrC,KAAK6B,SAASQ,GAAO,KAAKC,KAAKnB,EAC3D,EACOQ,CACX,CAzC+B,GA0C/BT,EAAQS,WAAaA,C,mCC7DrBX,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQqB,gBAAa,EAIrB,IAAIA,EAA4B,WAC5B,SAASA,IACLvC,KAAKwC,SAAW,EACpB,CAqCA,OA9BAD,EAAWT,UAAUW,IAAM,SAAUC,GACjC,GAAuB,OAAnBA,EAAOC,QACP,IAAK,IAAIX,EAAI,EAAGA,EAAIhC,KAAKwC,SAASI,OAAQZ,IAAK,CAC3C,IAAIa,EAAO7C,KAAKwC,SAASR,GACzB,GAAIa,EAAKF,UAAYD,EAAOC,SACxBE,EAAKC,UAAYJ,EAAOI,SACxBD,EAAKE,WAAaL,EAAOK,SAEzB,YADA/C,KAAKwC,SAASR,GAAKU,EAG3B,CAEJ1C,KAAKwC,SAASF,KAAKI,EACvB,EAIAH,EAAWT,UAAUkB,IAAM,WACvB,OAAOhD,KAAKwC,SAASS,OACzB,EAIAV,EAAWT,UAAUoB,UAAY,WAC7B,IAAIC,EAAOnD,KAAKgD,MAIhB,OAHAG,EAAKC,MAAK,SAAUC,EAAGC,GACnB,OAAOD,EAAEP,QAAUO,EAAEN,UAAYO,EAAER,QAAUQ,EAAEP,SACnD,IACOI,CACX,EACOZ,CACX,CAzC+B,GA0C/BrB,EAAQqB,WAAaA,C,mCC/CrBvB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQqC,oBAAiB,EAyCzB,IAAIA,EAAgC,WAChC,SAASA,IACLvD,KAAKwD,QAAU,CAAC,CACpB,CA6CA,OArCAD,EAAezB,UAAUM,IAAM,SAAUU,EAAS3B,GAC9CnB,KAAKwD,QAAQV,GAAW3B,CAC5B,EAOAoC,EAAezB,UAAUG,IAAM,SAAUa,GACrC,OAAO9C,KAAKwD,QAAQV,IAAY,CACpC,EASAS,EAAezB,UAAU2B,SAAW,SAAUX,GAC1C,OAA2B,EAApB9C,KAAKiC,IAAIa,EACpB,EASAS,EAAezB,UAAU4B,cAAgB,SAAUZ,EAASC,GAExD,IADA,IAAIY,EAAM,EACD3B,EAAI,EAAGA,EAAIc,EAASd,IACzB2B,GAAO3D,KAAKyD,SAASzB,GACzB,OAAO2B,EAAM3D,KAAKyD,SAASX,GAAWC,CAC1C,EACOQ,CACX,CAjDmC,GAkDnCrC,EAAQqC,eAAiBA,C,mCC1FzB,MAEMK,EAAmB,KACxB,MAAMC,EAAQ,IAAIC,MAAM,iBAExB,OADAD,EAAMxD,KAAO,aACNwD,CAAK,EAGPE,EAAc,EAAEC,aAAcC,EAAcC,WAAY9B,EAAK+B,iBAAiB,CAACC,GAAKjD,QAAOkD,UAAU,CAAC,KAC3G,GAAIA,GAAUA,EAAOC,QACpB,OAAOnE,QAAQoE,OAAOX,KAGvB,IAAIY,EACAC,EACAC,EACJ,MAAMC,EAAQV,GAAgBD,aAExBY,EAAiB,KACtBD,EAAMH,GACNE,EAASd,IAAmB,EASvBiB,EAAe,IAAI1E,SAAQ,CAACC,EAASmE,KAC1CE,EAAS,KANLJ,GACHA,EAAOS,oBAAoB,QAASF,GAOhCT,EACH/D,EAAQe,GAERoD,EAAOpD,EACR,EAGDuD,EAAWH,EACXC,GAAapC,GAAO8B,YAAYO,EAAQL,EAAG,IAa5C,OAVIC,GACHA,EAAOU,iBAAiB,QAASH,EAAgB,CAACI,MAAM,IAGzDH,EAAaF,MAAQ,KACpBA,EAAMH,GACNA,EAAY,KACZC,GAAQ,EAGFI,CAAY,EAGdI,EAAmBC,IACxB,MAAMC,EAAQpB,EAAY,IAAImB,EAAaf,aAAa,IAGxD,OAFAgB,EAAMZ,OAASR,EAAY,IAAImB,EAAaf,aAAa,IACzDgB,EAAMC,MAAQ,CAACC,EAASC,EAASC,IAAYJ,EA3DxB,EAACE,EAASC,IAAYE,KAAKC,MAAOD,KAAKE,UAAYJ,EAAUD,EAAU,GAAMA,GA2D/CM,CAAcN,EAASC,GAAUC,GAC7EJ,CAAK,EAGPA,EAAQF,IACdE,EAAMF,iBAAmBA,EAEzBW,EAAO1E,QAAUiE,EAEjBS,EAAO1E,QAAQ2E,QAAUV,C,gLCrCV,MAhCR,MACLvF,aAAY,KAAEkG,EAAI,QAAEC,EAAO,OAAEC,IAC3B,MAAMC,EAASH,EAAKP,QAAQW,YAC5BlG,KAAKmG,QAAUH,EACfhG,KAAKoG,SAAWJ,EAAOK,aACvBrG,KAAKsG,SAAW,IAAIC,IAClBT,EAAKU,QAAQ9F,KAAK+F,GAAW,CAC3BA,EACA,IAAI,IAAY,CAAEA,SAAQV,UAASC,SAAQC,cAGjD,CAEAS,UACE1G,KAAKmG,QAAQO,SACf,CAEAC,SACE3G,KAAKmG,QAAQQ,QACf,CAEIC,cACF,OAAO5G,KAAKoG,QACd,CAEAS,OAAOC,EAAGC,GACR,IAAK,MAAON,EAAQO,KAAgBhH,KAAKsG,SACvCU,EAAYH,OAAOC,EAAGC,EAAMN,OAAOA,GAEvC,G,kBCOa,MAzBR,MACL7G,YAAYqH,GACVA,EAAMN,SAEN3G,KAAKoG,SAAWa,EAAML,QACtB5G,KAAKkH,QAAU,GACflH,KAAKmH,KAAO,EACZnH,KAAK6G,QACP,CAGAA,SACE,MAAMO,EAAW,OAAAC,EAAA,KAAQ,IACnBC,EAAQF,EAAWpH,KAAKoG,SAASmB,YAGvC,IAFAvH,KAAKkH,QAAQ5E,KAAKgF,GAClBtH,KAAKmH,MAAQG,EACNtH,KAAKkH,QAAQtE,OAAS,IAC3B5C,KAAKmH,MAAQnH,KAAKkH,QAAQM,QAI5BxH,KAAKyH,KAAOL,EAAWpH,KAAKmH,KAAOnH,KAAKkH,QAAQtE,MAClD,G,kBCqDa,MAnFR,MACLhD,YAAY8H,EAAOC,GACjB3H,KAAK4H,OAASF,EACd1H,KAAK6H,OAASF,EACd3H,KAAK8H,KAAOT,EAAA,EAAIU,eAChB/H,KAAKgI,4BAA8B,EACnChI,KAAKiI,UAAY,KACjBjI,KAAKkI,mBAAqBC,IAC1BnI,KAAKoI,wBAA0B,EAC/BpI,KAAKqI,oBAAsB,EAC3BrI,KAAKsI,cAAgB,EACrBtI,KAAKuI,gBAAiB,CACxB,CAGIC,cACF,OAA0B,OAAnBxI,KAAKiI,SACd,CAGApB,SACE7G,KAAKyI,kBAELzI,KAAKyH,KAAOzH,KAAK0I,gBACnB,CAEAD,kBACMzI,KAAKwI,UACLxI,KAAK6H,OAAO5F,IAAI,SAASd,QAC3BnB,KAAKuI,gBAAiB,GAEpBvI,KAAKuI,iBAAmBvI,KAAK6H,OAAO5F,IAAI,SAASd,QACnDnB,KAAKiI,UAAYjI,KAAK4H,OAAOH,KAAOzH,KAAK2I,YAEtC3I,KAAKwI,UAORxI,KAAKsI,cAAgB,EAAItI,KAAK2I,YAElC,CAEAA,WACE,MAAM7B,EAAI9G,KAAK8H,OAAS,IACxB,OAAOtC,KAAKoD,KAAK9B,GAAKA,CACxB,CAEA4B,iBAME,IAAIpB,EAA2B,OAAnBtH,KAAKiI,UAAqB,EAAIjI,KAAK4H,OAAOH,KAAOzH,KAAKiI,UAElE,GADIX,EAAQ,IAAGA,EAAQ,GACnBA,EAAQ,EACV,OAAQ9B,KAAKqD,IAAIvB,EAAO,GAAK,GAAK,EAAI,EAAI,GACrC,CACL,MAAMwB,EAAiBxB,EAAQ,GAAK,GACpCtH,KAAKgI,4BAA8Bc,EACnC,MAAMC,EACJ/I,KAAKqI,qBACJS,EAAiB9I,KAAKoI,yBACzB,OAAO5C,KAAKwD,IAAID,EAAqB/I,KAAKkI,mB,CAE9C,CAEAe,QAAQC,GAEJlJ,KAAKqI,qBACFrI,KAAKgI,4BAA8BhI,KAAKoI,0BAC3CpI,KAAKkI,qBAELlI,KAAKqI,oBAAsBrI,KAAKkI,mBAChClI,KAAKoI,wBAA0BpI,KAAKgI,6BAEtChI,KAAKkI,mBAAqBgB,CAC5B,G,SCrFK,MAAMC,EAAb,cAOU,KAAAxB,MAAQ,CAAC,EAAG,GACZ,KAAAyB,KAAO,EACP,KAAAC,OAAS,CAwBnB,CAtBSC,WAAW3B,GAChB,IAAK,IAAI3F,EAAI,EAAGA,EAAI,IAAKA,EACnB2F,EAAM3F,IAAMhC,KAAK2H,MAAM3F,IAAM,GAC/BhC,KAAK2H,MAAM3F,GAAK,EAChBhC,KAAKoJ,KAAOpH,IACF2F,EAAM3F,IAAMhC,KAAK2H,MAAM3F,GAAK,EACtChC,KAAK2H,MAAM3F,IAAM,EACRhC,KAAK2H,MAAM3F,GAAK,GAAM,IAC/BhC,KAAK2H,MAAM3F,IAAM,GAYrB,OARsB,IAAlBhC,KAAK2H,MAAM,IAA8B,IAAlB3H,KAAK2H,MAAM,KACpC3H,KAAKqJ,OAAuB,IAAdrJ,KAAKoJ,KAAa,GAAK,GAGnCpJ,KAAK2H,MAAM3H,KAAKoJ,OAAS,IAC3BpJ,KAAKqJ,OAAS,GAGTrJ,KAAKqJ,MACd,EC4Ba,MAzDf,SAAyBvD,GACvB,MAAM6B,EAAQ,IAAI,IAAU4B,OAAQ,CAClCC,WAAW,EACXC,WAAY3D,EAAKU,QAAQ,GAAGjB,QAAQoC,MAAM8B,WAC1CC,YAAa5D,EAAKU,QAAQ,GAAGjB,QAAQoC,MAAM+B,cAEvCC,EAAM7D,EAAKU,QAAQ,GAAGjB,QAAQoC,MAAMiC,SACpCC,EAAU,IAAIV,EAIdW,EAAa9I,OAAO+I,OAAOJ,GAAKK,QAAQ,sBAAwB,EAChEC,EAAajJ,OAAO+I,OAAOJ,GAAKK,QAAQ,sBAAwB,EAEtE,MAAO,CACL3J,KAAM,eACN4B,MACE,MAAMiI,EAAOvC,EAAMd,SAEbsD,EAAS,CACbC,KAAMF,EAAKP,EAAI,IAAQ,MACvBU,KAAMH,EAAKP,EAAI,IAAQ,MACvBW,KAAMJ,EAAKP,EAAI,IAAQ,MACvBY,KAAML,EAAKP,EAAI,IAAQ,MACvBa,KAAMN,EAAKP,EAAI,IAAQ,MACvBc,KAAMP,EAAKP,EAAI,IAAQ,MACvBe,KAAMR,EAAKP,EAAI,IAAQ,MACvBgB,MAAOd,EAAQP,QACbY,EAAKP,EAAQ,IAAK,MAClBO,EAAKP,EAAS,KAAK,OAErBiB,WAAYV,EAAK,IACjBW,aAAcX,EAAK,IACnBY,MAAOZ,EAAK,KAAQD,GAAcC,EAAK,sBACvCa,OAAQb,EAAK,KAAQJ,GAAcI,EAAK,uBAe1C,OAbIC,EAAc,OAAKA,EAAe,WAElCA,EAAa,MACbA,EAAa,MACbA,EAAa,MACbA,EAAa,QAEbA,EAAqB,cAAI,IAEvBA,EAAa,MAAKA,EAAa,MAAKA,EAAa,QACnDA,EAAmB,YAAI,IAGpBA,CACT,EACAzD,UACEiB,EAAMqD,SACR,EAEJ,E,kBCoIe,MAlLR,MACLpL,aAAY,KAAEkG,EAAI,QAAEmF,EAAO,MAAEhE,IAC3BjH,KAAKkL,mBAAqBpF,EAAKP,QAAQ4F,kBACvCnL,KAAKoL,MAAQtF,EACb9F,KAAKqL,SAAWJ,EAChBjL,KAAKsL,OAASrE,EACdjH,KAAK4H,OAAS,IAAI,EAAM5H,KAAKsL,QAC7BtL,KAAK6H,OAAS,IAAI,IAClB7H,KAAKuL,OAAS,IAAI,EAAUvL,KAAK4H,OAAQ5H,KAAK6H,QAC9C7H,KAAKwL,OAAS,IAAI,IAAU1F,GAC5B9F,KAAKyL,SAAW,IAAItL,SAASC,GAAaJ,KAAK0L,gBAAkBtL,IACjEJ,KAAKqL,SAASM,kBAAiB,IAAM3L,KAAK4L,cAC1C5L,KAAKqL,SAASQ,kBAAiB,IAAM7L,KAAK8L,gBAC1C9L,KAAK+L,sBACL/L,KAAKgM,yBACP,CAEIlG,WACF,OAAO9F,KAAKoL,KACd,CAEIH,cACF,OAAOjL,KAAKqL,QACd,CAEIpE,YACF,OAAOjH,KAAKsL,MACd,CAEIW,cACF,OAAOjM,KAAKyL,QACd,CAEI1E,YACF,OAAO/G,KAAKwL,MACd,CAEIU,qBACF,OAAOlM,KAAKmM,eACd,CAGArB,QACE9K,KAAKoM,gBACLpM,KAAKqL,SAASP,QACd9K,KAAK6H,OAAOwE,IAAI,IAAI,EAAgBrM,KAAKoL,QACzCpL,KAAK6H,OAAOwE,IAAI,IAAI,IAAYrM,KAAKqL,SAASzE,UAC9C,IAAI0F,GAAU,EACd,MAAMC,EAAQ,KACRD,IACJtM,KAAKwM,UACLC,sBAAsBF,GAAM,EAE9BE,sBAAsBF,GACtBvM,KAAK0M,aAAe,IAAOJ,GAAU,CACvC,CAGAF,gBACE,MAAMO,EAAaC,IACE,KAEfA,EAAEC,SACJD,EAAEE,iBACFF,EAAEG,kBACF/M,KAAK4L,aAJQ,MAKJgB,EAAEC,UACXD,EAAEE,iBACFF,EAAEG,kBACF/M,KAAK8L,c,EAGTvC,OAAOxE,iBAAiB,UAAW4H,GAAW,GAC9C3M,KAAKyL,SAASuB,SAAQ,WACpBzD,OAAOzE,oBAAoB,UAAW6H,GAAW,EACnD,GACF,CAEAf,YACE5L,KAAK0L,gBAAgB,CAAEuB,UAAU,EAAOC,QAAQ,GAClD,CAEApB,cACE9L,KAAK0L,gBAAgB,CAAEuB,UAAU,EAAOC,QAAQ,GAClD,CAGAxG,UACE1G,KAAK0M,eACL1M,KAAKsL,OAAO5E,UACZ1G,KAAK6H,OAAOnB,UACZ1G,KAAKqL,SAAS3E,SAChB,CAEA8F,UA2BExM,KAAK4H,OAAOf,SACZ7G,KAAK6H,OAAOhB,SACZ7G,KAAKuL,OAAO1E,SACZ,MAAMC,EAAI9G,KAAKuL,OAAO9D,KAChB0F,EAAInN,KAAKkL,mBACflL,KAAKmM,gBAAkBrF,EACvB9G,KAAKwL,OAAO3E,OAAOC,EAAIqG,EAAGnN,KAAK6H,OAAQ7H,KAAKuL,QAC5CvL,KAAKsL,OAAOzE,OAAOC,EAAG9G,KAAKwL,QAC3BxL,KAAKqL,SAASxE,OAAOC,EAAIqG,EAAGnN,KAAKwL,QAC7BxL,KAAKwL,OAAOyB,UAAYjN,KAAK0L,kBAC/B1L,KAAK0L,gBAAgB,CAAEuB,UAAU,IACjCjN,KAAK0L,gBAAkB,KAE3B,CAEAK,sBACO,IAAMqB,UACX,IAAMC,UAAU,SAAUrN,KAAM,WAChC,IAAMqN,UAAU,eAAgBrN,KAAK6H,OAAQ,UAC7C,IAAMwF,UAAU,eAAgBrN,KAAKwL,OAAQ,UAC7C,IAAM6B,UAAU,eAAgBrN,KAAKsL,OAAQ,UAC7C,IAAM+B,UAAU,iBAAkBrN,KAAKqL,SAAU,UACjD,IAAMgC,UAAU,kBAAmBrN,KAAKqL,SAAU,YAClD,IAAMgC,UAAU,eAAgBrN,KAAKqL,SAASjF,SAASkH,UAAW,QAClE,IAAMD,UACJ,iBACArN,KAAKqL,SAASjF,SAASmH,UACvB,UAEJ,CAEAvB,0BACOwB,EAAA,qBACLA,EAAA,wBAAuC,CACrCvE,QAAUnC,IACR9G,KAAKuL,OAAOtC,QAAQnC,GACb,IAAI3G,SAASC,IAClB,MAAMqN,EAAWC,aAAY,KACvB1N,KAAKuL,OAAO9D,MAAQX,IACtB6G,cAAcF,GACdrN,I,GAEF,KAGNwN,QAAS,KACP5N,KAAKuL,OAAOtC,QAAQd,IAAS,EAE/B0F,SAAU,KACR,MAAM9G,EAAQ/G,KAAKwL,OAEnB,OADoBzE,EAAMN,OAAOM,EAAMjB,KAAKU,QAAQ,IACjCsH,MAAMC,KAAK,GAGpC,G,kBC1Ka,MAjBR,SAAmBC,EAAQC,GAChC,OAAOD,EACJE,KAAKD,GACLE,MAAMC,GAAUA,EAAMtO,SACtBqO,MAAME,GAAgB,IAAIC,KAAK,CAACD,MAChCF,MAAMI,GAASzN,IAAI0N,gBAAgBD,KACnCJ,MACEM,GACC,IAAItO,SAAQ,CAACC,EAASmE,KACpB,MAAMmK,EAAQ,IAAIC,MAClBD,EAAME,OAAS,IAAMxO,EAAQsO,GAC7BA,EAAMG,QAAUtK,EAChBmK,EAAMD,IAAMA,CAAG,KAGzB,E,SCqCO,SAASK,EAAKC,GACnB,MAAMf,EAASe,EAAKf,OACdgB,EAAMD,EAAKC,IACXC,EAASF,EAAKE,OAEpB,OCrDK,SAAexN,GACpB,MAAMyN,EAAQ,CAAC,EACTC,EAAU,CAAC,EACXC,EAAW,GAEjB,SAASC,EAAKhP,EAAMgB,EAAMiO,EAAcC,GACtC,MAAMxP,EAAW,IAAI,IACjBsB,GAAM+N,EAAS9M,KAAK,CAAEjB,OAAMtB,aAChCmP,EAAM7O,GAAQ,WACZ,OAAOF,QAAQ6C,IAAIsM,EAAa5O,IAAI8O,IAAMrB,MAAMsB,GAC9CF,KAAKE,EAAKC,OAAO,CAAC3P,MAEtB,CACF,CAQA,SAASyP,EAAInP,GACX,OAAO8O,EAAQ9O,KAAU8O,EAAQ9O,GAAQ6O,EAAM7O,KACjD,CAEA,SAASsP,IACP,OAAOP,EAAS1O,KAAKoG,IACZ,CACLzF,KAAMyF,EAAEzF,KACRtB,SAAU+G,EAAE/G,SAASA,SACrB6P,aAAc9I,EAAE/G,SAAS8P,cAG/B,CAdAR,EAAKS,IAJL,SAAazO,EAAMtB,GACjBqP,EAAS9M,KAAK,CAAEjB,OAAMtB,YACxB,EAkBA,MAAMkM,EAAUxK,EAAS4N,EAAMG,GACzBO,EAAS,IAAI,IAAWJ,KACxB9I,EAAS,oBAAS,WACtBkJ,EAAO5O,MAAQwO,GACjB,GAAG,IAEH,IAAK,MAAMK,KAAeZ,EACxBY,EAAYjQ,SAASkQ,MAAMpJ,GAG7B,MAAO,CAAEqI,MAAOa,EAAQ9D,QAASA,EAAShK,IAAKuN,EACjD,CDOS,EAAyC,SAAUH,EAAMG,GAC9DH,EAAK,eAAgB,sBAAuB,IAAI,SAAUtP,GACxD,OAAO,YACLA,EACA,sDAEJ,IAEAsP,EACE,OACA,eACA,CAAC,iBACD,SAAUa,EAAcnQ,GACtB,OAAOmQ,EAAapB,KAClBoB,EAAaC,WAAW,CACtBC,YAAarB,EAAKqB,cAEpBrQ,EAEJ,IAGFsP,EACE,cACA,KACA,CAAC,eAAgB,SACjB,SAAUa,EAAcG,GACtB,OAAO,IAAIH,EAAaI,QAAQD,EAAM,CAAEE,iBAAkBhH,QAC5D,IAGEyE,EAAOjO,WACLiO,EAAOjO,SAASyQ,SAClBnB,EAAKS,IAAI,kBAAmB9B,EAAOjO,SAASyQ,SAE1CxC,EAAOjO,SAASiD,KAClBqM,EAAKS,IAAI,wBAAyB9B,EAAOjO,SAASiD,MAItDqM,EAAK,YAAa,WAAaN,EAAKC,IAAI3O,KAAM,IAAIH,MAAOH,IACvD,MAAM0Q,EAAS,IAAI,IACbC,QAAoB1B,EAAIlP,KAAKC,GACnC,OAAO0Q,EAAO3B,KAAK4B,EAAa3B,EAAKC,IAAKD,EAAKxJ,QAAQiB,QAAQ,GAAG,IAGpE6I,EAAK,gBAAiB,KAAM,CAAC,cAAc,SAAUsB,GACnD,GAAI5B,EAAK6B,iBAAkB,CACzB,MAAOrQ,EAAM0N,GAAY,OAAA4C,EAAA,GACvB7C,EACAe,EAAK6B,kBAEP,OAAO,EAAUrQ,EAAM0N,E,CAEzB,OAAO,EAAUD,EAAQ2C,EAAUG,cACrC,IAEAzB,EAAK,kBAAmB,KAAM,CAAC,cAAc,SAAUsB,GACrD,GAAI5B,EAAKgC,aAAc,CACrB,MAAOxQ,EAAM0N,GAAY,OAAA4C,EAAA,GACvB7C,EACAe,EAAKgC,cAEP,OAAO,EAAUxQ,EAAM0N,E,CAEzB,OAAO,EAAUD,EAAQ2C,EAAUK,gBACrC,IAEA,MAAMC,EAAoB,IAAI,IACxBC,EAAsB,IAAI,IA4GhC,OA1GA7B,EAAKS,IAAI,gBAAiBmB,GAC1B5B,EAAKS,IAAI,iBAAkBoB,GAE3B7B,EAAK,iBAAkB,KAAM,IAAInP,SACxB,IAAI,MAGbmP,EACE,QACAN,EAAKoC,SAAW,gBAAkB,KAClC,CAAC,cACDjR,eAAgByQ,EAAW5Q,GACzB,IAAKgP,EAAKoC,SAAU,OAAOhR,QAAQC,QAAQ,MAC3C,IAAI+Q,EAAWpC,EAAKoC,SACpB,IAAKA,EAASC,SAAS,OAAQ,CAE7B,MAAO7Q,EAAM0N,GAAY,OAAA4C,EAAA,GAAyB7C,EAAQmD,GACpDjD,QAAa3N,EAAK2N,KAAKD,GAC7BkD,QAAiBjD,EAAKmD,Y,CAExB,OAAO,IAAIlR,SAAQ,CAACC,EAASmE,KAC3B,MAAM+M,EAAQC,SAASC,cAAc,SACrC,IAAKF,EAAMG,YAAY,cAAe,OAAOrR,EAAQ,MASrD,SAASsR,IACHJ,EAAMK,UAAYL,EAAMK,SAAS/O,QAAU0O,EAAMM,UACnD7R,EAAS8R,OACPP,EAAMK,SAASG,IAAI,GAAKR,EAAMK,SAAS7G,MAAM,GAC7CwG,EAAMM,SAGZ,CACA,SAASG,IACPT,EAAMxM,oBAAoB,WAAY4M,GAAY,GAClDJ,EAAMxM,oBAAoB,iBAAkBkN,GAAkB,GAC9DV,EAAMxM,oBAAoB,QAASmN,GAAS,GAC5CX,EAAMxM,oBAAoB,QAASmN,GAAS,EAC9C,CACA,SAASD,IACPD,IACA,MAAMG,EAAIZ,EAAMM,UAAY,IAC5B7R,EAAS8R,OAAOK,EAAGA,GACnB9R,EAAQ,CAAE+R,QAASb,EAAOc,OAAQrD,EAAKsD,aACzC,CACA,SAASJ,IACPF,IACAO,QAAQC,KAAK,sCACbnS,EAAQ,KACV,CAhCAkR,EAAM7C,IAAM0C,EACZG,EAAMkB,QAAU,OAChBlB,EAAMvM,iBAAiB,WAAY2M,GAAY,GAC/CJ,EAAMvM,iBAAiB,iBAAkBiN,GAAkB,GAC3DV,EAAMvM,iBAAiB,QAASkN,GAAS,GACzCX,EAAMvM,iBAAiB,QAASkN,GAAS,GACzCX,EAAMxC,MA0BN,GAEJ,IAGFO,EAAK,OAAQ,KAAM,CAAC,cAAcnP,MAAOyQ,GAChC,IAAI,IAAK,CAACA,GAAY5B,EAAKxJ,WAGpC8J,EACE,cACA,KACA,CAAC,OAAQ,cAAe,UACxBnP,MAAO4F,EAAMc,EAAS0K,IACb,IAAI,IAAY,CACrBxL,OACAc,UACA6L,uBAAwBjD,EAAI,mBAC5B8B,YAKNjC,EAAK,UAAW,KAAM,CAAC,iBAAkB,SAAS,SAAUrJ,EAAQF,GAClE,IAAc4M,cAAczD,GAE5B,OADsB,IAAI,IAAcjB,EAAQhI,GAC3B2M,UACnB7M,EAAKC,QACLkL,EACAC,EAEJ,IAEA7B,EACE,YACA,KACA,CAAC,OAAQ,UAAW,mBACpBnP,MAAO4F,EAAMC,EAASC,IACb,IAAI,EAAU,CAAEF,OAAMC,UAASC,aAI1CqJ,EACE,iBACA,KACA,CAAC,OAAQ,cAAe,cACxBnP,MAAO4F,EAAMmF,EAAShE,IACb,IAAI,EAAe,CAAEnB,OAAMmF,UAAShE,YAIxCuI,EAAI,iBACb,GACF,C,6KExOe,MAAM,UAAgC,IAAMoD,UAKzDC,SACE,OACE,yBAAKC,UAAU,2BACb,yBACEA,UAAU,8BACVC,MAAO,CAAEC,MAAOhT,KAAKiT,MAAMD,SAInC,EAbO,EAAAE,UAAY,CACjBF,MAAO,IAAUG,UAAU,CAAC,IAAUC,OAAQ,IAAUC,SAASC,YCAtD,MAAM,UAA6B,IAAMV,UAAxD,c,oBAaE,KAAAW,WAAa,EAAGlS,OAAMuO,eAAc7P,eAClC,MAAMiT,EAAQxN,KAAKgO,MAAiB,IAAXzT,GAAkB,GAAG8P,WAAa,IACrD4D,EAAQ7D,EAAe,KAAKA,KAAkB,GACpD,OACE,yBAAKvN,IAAKhB,EAAMyR,UAAU,6BACxB,kBAAC,EAAuB,CAACE,MAAOA,IAC/B3R,EACD,0BAAMyR,UAAU,8BAA8BW,GAEjD,CAUL,CA3BEZ,SACE,OACE,yBAAKC,UAAU,wBACZ9S,KAAKiT,MAAM/D,MAAM/N,MAAMT,KAAK2O,GAASrP,KAAKuT,WAAWlE,KAG5D,CAcAqE,oBACE1T,KAAK2T,aAAe3T,KAAKiT,MAAM/D,MAAMe,OAAM,IAAMjQ,KAAK4T,eACxD,CAEAC,uBACE7T,KAAK2T,cACP,EA9BO,EAAAT,UAAY,CACjBhE,MAAO,IAAUxM,Q,oBCFN,MAAM,UAA6B,IAAMkQ,UAatDC,SACE,MAAMiB,EAAO9T,KAAKiT,MAAMa,KACxB,OACE,yBAAKhB,UAAU,wBACb,yBAAKA,UAAU,8BAA8BgB,EAAKC,OAClD,yBAAKjB,UAAU,8BAA8BgB,EAAKE,OAChD,cAME,KALAF,EAAKG,UAAUvT,KAAKW,GAClB,yBAAKgB,IAAKhB,EAAMyR,UAAU,iCACvBzR,KAIT,yBAAKyR,UAAU,+BAA+BgB,EAAKI,QAClDJ,EAAKK,WAAWzT,KAAKW,GACpB,yBAAKgB,IAAKhB,EAAMyR,UAAU,kCACvBzR,KAKX,EAjCO,EAAA6R,UAAY,CACjBY,KAAM,IAAUM,MAAM,CACpBJ,MAAO,IAAUZ,OACjBc,OAAQ,IAAUd,OAClBW,MAAO,IAAUX,OACjBa,UAAW,IAAUI,QAAQ,IAAUjB,QACvCe,WAAY,IAAUE,QAAQ,IAAUjB,QACxCkB,WAAY,IAAUjB,OACtBkB,MAAO,IAAUlB,SAChBC,YCLQ,MAAM,UAAqB,IAAMV,UAgB9CC,SACE,OACE,kBAAC2B,EAAA,EAAK,CAAC1B,UAAU,eAAe2B,IAAI,SAClC,yBAAK3B,UAAU,qBAAqB2B,IAAI,aACxC,yBAAK3B,UAAU,qBACb,kBAAC,EAAoB,CAACgB,KAAM9T,KAAKiT,MAAMa,QAEzC,kBAAC,EAAoB,CAAC5E,MAAOlP,KAAKiT,MAAM/D,QACxC,yBAAK4D,UAAU,uBACf,yBAAKA,UAAU,uBAGrB,CAEAY,oBACM1T,KAAKiT,MAAMyB,sBACb1U,KAAKiT,MAAMyB,qBAAqBvG,MAAMO,IACpC,IAASiG,YAAY3U,KAAK4U,KAAKC,UAAUC,YAAYpG,EAAM,IAG/D1O,KAAKiT,MAAM8B,0BAAyB,KAClC,IAASJ,YAAY3U,KAAK4U,KAAKI,OAAOC,UAAUxS,IAAI,cAC7C,IAAM,OAEjB,EAvCO,EAAAyQ,UAAY,CACjBY,KAAM,IAAUM,MAAM,CACpBJ,MAAO,IAAUZ,OACjBc,OAAQ,IAAUd,OAClBW,MAAO,IAAUX,OACjBa,UAAW,IAAUI,QAAQ,IAAUjB,QACvCe,WAAY,IAAUE,QAAQ,IAAUjB,QACxCkB,WAAY,IAAUjB,OACtBkB,MAAO,IAAUlB,SAEnBnE,MAAO,IAAUxM,OACjBgS,qBAAsB,IAAUhS,OAChCqS,yBAA0B,IAAUG,K,mCCxBxC,uNAEO,SAASC,IACd,MAAqC,MAA9B,IAAMC,mBACf,CAEO,SAASC,IACd,MAAkC,MAA3B,IAAMC,gBACf,CAEO,SAASC,IACd,MAAsC,MAA/B,IAAMC,oBACf,CAEO,SAASC,IACd,MAAmC,MAA5B,IAAMC,iBACf,CAEO,SAASC,IACd,MAAyC,MAAlC,IAAMC,uBACf,CAEO,SAASC,IACd,MAAsC,MAA/B,IAAMC,oBACf,C,mCCxBA,+CAYO,MAAMC,EAAb,cAES,KAAAvF,aAA8BwF,EAE9B,KAAAC,WAA4BD,EAQ3B,KAAAE,YAAc,IAAI,GA+C5B,CA3CErE,OAAOrB,EAAiByF,EAAexC,GACrCzT,KAAKwQ,QAAUA,EACfxQ,KAAKiW,MAAQA,EACbjW,KAAKyT,MAAQA,EACbzT,KAAKkW,YAAYC,QACnB,CASAlG,MAAMV,GAEJ,OADAA,EAAEvP,MACKA,KAAKkW,YAAYjG,OAAM,IAAMV,EAAEvP,OACxC,CAKID,eACF,OAAIC,KAAKiW,YAA0BD,IAAjBhW,KAAKwQ,SAA0C,OAAjBxQ,KAAKwQ,QAC5CxQ,KAAKwQ,QAAUxQ,KAAKiW,MAEpB,IAEX,CAMApG,WACE,YAAuBmG,IAAnBhW,KAAKoW,UACApW,KAAKoW,UAAUpW,MACK,OAAlBA,KAAKD,SACPC,KAAKwQ,QAAU,MAAQxQ,KAAKiW,MAE5B,EAEX,E,mCCtEF,aA8Be,IA1BR,MAGLrW,YAAYuB,GAFJ,KAAAkV,WAAa,IAAI,IAGvBrW,KAAKsW,OAASnV,CAChB,CAEIA,YACF,OAAOnB,KAAKsW,MACd,CAEInV,UAAMA,GACRnB,KAAKsW,OAASnV,EACdnB,KAAKmW,OAAOhV,EACd,CAEAgV,OAAOhV,GACLnB,KAAKqW,WAAWE,KAAKpV,EACvB,CAEA8O,MAAMV,GAEJ,YADoByG,IAAhBhW,KAAKsW,QAAsB/G,EAAEvP,KAAKsW,QAC/BtW,KAAKqW,WAAW5T,IAAI8M,EAC7B,E,mCCYa,IAhCR,MAGL3P,YAAY4W,GACV,GAHM,KAAAH,WAAkD,CAAC,EACnD,KAAAI,QAAU,EAEI,mBAATD,EACTxW,KAAKyC,IAAI+T,QACJ,GAAoB,iBAATA,GAAqBA,GAAQA,EAAK5T,OAClD,IAAK,IAAIZ,EAAI,EAAGA,EAAIwU,EAAK5T,OAAQZ,IAAKhC,KAAKyC,IAAI+T,EAAKxU,GAExD,CAKAuU,QAAQG,GACN,MAAMC,EAAY3W,KAAKqW,WACvB,IAAK,MAAMO,KAAMD,EACfA,EAAUC,MAAOF,EAErB,CAMAjU,IAAIhB,GACF,MAAMmV,EAAK5W,KAAKyW,UAEhB,OADAzW,KAAKqW,WAAWO,GAAMnV,EACf,WAAazB,KAAKqW,WAAWO,EACtC,E,mCCpCa,QAAIC,aAAa,CAC9BC,YAAa,e,oCCDf,kCAKA,MAAMC,EAAMC,EAAaC,UAAU,eAEnC,IAAI5P,EACA+K,EAAS,EAGX/K,EADEkC,OAAO2N,aAAiD,mBAA3B3N,OAAO2N,YAAY7P,IAC5C,IAAMkC,OAAO2N,YAAY7P,MAEzB,IAAM8P,KAAK9P,MAGnBA,EAAI+P,YAAc,SAAUC,GAE1B,SAASC,EAASnN,GAIhBiI,EAASjI,EAASgN,KAAK9P,MAAQA,GACjC,CANA,IAAKgQ,GAOL,SAAkBE,EAAKpN,GACjBoN,EACFR,EAAIlT,MAAM,4BAA8B0T,IAExCD,EAASnN,GACT4M,EAAIS,KAAK,kDAAoDpF,GAEjE,GAduBkF,EAezB,EAEAjQ,EAAIU,aAAe,WACjB,MAAM0P,EAAIrF,EACV,MAAO,IAAM/K,IAAQoQ,CACvB,EAGe,K,uDC1Bf7R,EAAO1E,QAuCP,SAAeC,EAAOoE,GACpB,GAAqB,iBAAVpE,EACT,OAAOuW,EAAMvW,GAGf,GAAqB,iBAAVA,EACT,OAAOwW,EAAOxW,EAAOoE,GAGvB,OAAO,IACT,EAhDAK,EAAO1E,QAAQyW,OAASA,EACxB/R,EAAO1E,QAAQwW,MAAQA,EAOvB,IAAIE,EAAwB,wBAExBC,EAAuB,wBAEvBnX,EAAM,CACR4C,EAAI,EACJwU,GAAI,KACJC,GAAI,GAAK,GACTC,GAAI,GAAK,GACTC,GAAIzS,KAAKqD,IAAI,KAAM,GACnBqP,GAAI1S,KAAKqD,IAAI,KAAM,IAGjBsP,EAAc,gDA+ClB,SAASR,EAAOxW,EAAOoE,GACrB,IAAK6S,OAAOC,SAASlX,GACnB,OAAO,KAGT,IAAImX,EAAM9S,KAAK+S,IAAIpX,GACfqX,EAAsBjT,GAAWA,EAAQiT,oBAAuB,GAChEC,EAAiBlT,GAAWA,EAAQkT,eAAkB,GACtDC,EAAiBnT,QAAqCyQ,IAA1BzQ,EAAQmT,cAA+BnT,EAAQmT,cAAgB,EAC3FC,EAAgBC,QAAQrT,GAAWA,EAAQoT,eAC3CE,EAAQtT,GAAWA,EAAQsT,MAAS,GAEnCA,GAASnY,EAAImY,EAAK3W,iBAEnB2W,EADEP,GAAO5X,EAAIwX,GACN,KACEI,GAAO5X,EAAIuX,GACb,KACEK,GAAO5X,EAAIsX,GACb,KACEM,GAAO5X,EAAIqX,GACb,KACEO,GAAO5X,EAAIoX,GACb,KAEA,KAIX,IACIgB,GADM3X,EAAQT,EAAImY,EAAK3W,gBACb6W,QAAQL,GActB,OAZKC,IACHG,EAAMA,EAAIE,QAAQnB,EAAsB,OAGtCW,IACFM,EAAMA,EAAIrY,MAAM,KAAKC,KAAI,SAAUuY,EAAGjX,GACpC,OAAa,IAANA,EACHiX,EAAED,QAAQpB,EAAuBY,GACjCS,CACN,IAAGpY,KAAK,MAGHiY,EAAML,EAAgBI,CAC/B,CAaA,SAASnB,EAAMwB,GACb,GAAmB,iBAARA,IAAqBC,MAAMD,GACpC,OAAOA,EAGT,GAAmB,iBAARA,EACT,OAAO,KAIT,IACIE,EADAC,EAAUlB,EAAYmB,KAAKJ,GAE3BL,EAAO,IAYX,OAVKQ,GAMHD,EAAaG,WAAWF,EAAQ,IAChCR,EAAOQ,EAAQ,GAAGnX,gBALlBkX,EAAaI,SAASN,EAAK,IAC3BL,EAAO,KAOLM,MAAMC,GACD,KAGF5T,KAAKC,MAAM/E,EAAImY,GAAQO,EAChC,C,mCCzKO,SAASK,EACdC,EACArZ,EACAoB,GAEA,GAAIpB,EAAKe,MAAM,4BAEb,YADAK,EAASpB,GAGX,MAAMsZ,GAASD,EAASrZ,GAAMI,MAAM,KACpC,IAAK,IAAIuB,EAAI,EAAGA,EAAI2X,EAAM/W,OAAQZ,IAChCP,EAASkY,EAAM1W,MAAMjB,GAAGnB,KAAK,KAEjC,CAbA,iC,mCCAA,gGAMe,MAAM2T,UAAc,IAAM5B,UAOvCC,SACE,OACE,yBACEC,UAAW,IAAE,QAAS9S,KAAKiT,MAAMH,WACjC8G,YAAa5Z,KAAKiT,MAAM2G,aAEvB5Z,KAAKiT,MAAM4G,SAGlB,EAfO,EAAA3G,UAAY,CACjBJ,UAAW,IAAUM,OACrByG,SAAU,IAAUC,KACpBF,YAAa,IAAU1E,K,mCCV3B,kGAIO,MAAM6E,EAAc,KAErBC,EAAgBzI,SAASC,cAAc,SAQ7C,MAAMyI,GAAsBD,EAAcvI,YACxC,8BA4HK,MAAMyI,EACXta,YAAYua,GAAgB,OAAElU,GAAW,CAAC,GACxCjG,KAAKmG,QAAUgU,EACfna,KAAKoa,MAAQpa,KAAKmG,QAAQE,aAAagU,aACzB,MAAVpU,IAAgBjG,KAAKoa,MAAME,KAAKnZ,MAAQ8E,GAC5CjG,KAAKoa,MAAMG,QAAQva,KAAKmG,QAAQqU,YAClC,CAEIA,kBACF,OAAOxa,KAAKoa,KACd,CAEA1T,UACE1G,KAAKoa,MAAMK,aACXza,KAAKoa,MAAQ,IACf,EAOK,MAAMM,EACX9a,YAAYua,EAA2CQ,GACrD3a,KAAKmG,QAAUgU,EACfna,KAAK4a,QAAUD,CACjB,CAGAE,KAAK1V,EAAOI,GACV,OAAO,IAAIuV,EAAa9a,KAAKmG,QAASnG,KAAK4a,QAASzV,EAAOI,EAC7D,CAGAmB,UACE1G,KAAKmG,QAAU,KACfnG,KAAK4a,QAAU,IACjB,CAEIhJ,eACF,OAAO5R,KAAK4a,QAAQhJ,QACtB,EAQK,MAAMkJ,EACXlb,YAAYua,EAAgBY,EAAQ5V,EAAOI,EAAU,CAAC,GACpDJ,EAAQA,GAAS,EACjBnF,KAAKmG,QAAUgU,EAGf,MAAMvT,EAAUuT,EAAe9T,aACzB2U,EAASpU,EAAQqU,qBACvBD,EAAOD,OAASA,EAChBC,EAAOE,QAAU,IAAMlb,KAAKmb,OAC5B,MAAMb,EAAO1T,EAAQyT,aACrBW,EAAOT,QAAQD,GACf,MAAME,EACJjV,EAAQuU,MACPvU,EAAQ6V,OAAS7V,EAAQ6V,MAAMZ,aAChCL,EAAeK,YACjBF,EAAKC,QAAQC,GACbxa,KAAKqb,QAAUL,EACfhb,KAAKoa,MAAQpa,KAAKsb,UAAYhB,EAG9B,MAAMrS,EAAa9C,EAAYK,KAAK+V,IAAI,EAAG3U,EAAQW,YAAcpC,GAAtC,EACrBqW,EAAcjW,EAAQuF,OAAS,EAC/B2Q,EAASD,EAAc,EAC7B,IAAIE,GAAY,EAIhB,GAHID,GACFnB,EAAKA,KAAKqB,eAAe,EAAG,QAEV3F,IAAhBzQ,EAAQuM,IAAmB,CAC7B,MAAMF,EAAWpM,KAAK+V,IAAIhW,EAAQuM,IAAM0J,EAAa,GACrDR,EAAOlQ,MAAM7C,EAAWuT,EAAa5J,EAAWmI,GAChD2B,EAAY9U,EAAQW,YAAcpC,EAAQyM,C,MAE1CoJ,EAAOlQ,MAAM7C,EAAWuT,GAEtBC,IACFnB,EAAKA,KAAKqB,eAAe,EAAG/U,EAAQW,YAAcpC,GAClDmV,EAAKA,KAAKsB,wBACR,EACAhV,EAAQW,YAAcpC,EAAQ4U,KAGhB,IAAd2B,IACFpB,EAAKA,KAAKqB,eAAe,EAAGD,GAC5BpB,EAAKA,KAAKsB,wBAAwB,EAAGF,EAAY3B,IAEnD/Z,KAAKmG,QAAQ0V,cAAc7b,KAC7B,CAGAmb,OACOnb,KAAKqb,UACVrb,KAAKqb,QAAQF,KAAK,GAClBnb,KAAKqb,QAAQZ,aACbza,KAAKoa,MAAMK,aACXza,KAAKqb,QAAU,KACfrb,KAAKoa,MAAQ,KACbpa,KAAKmG,QAAQ2V,gBAAgB9b,MACzBA,KAAK+b,QAAQ/b,KAAK+b,SACxB,CAIAC,MACOhc,KAAKqb,UACVrb,KAAKqb,QAAQY,aAAa9a,MACxBqE,KAAKE,SAAW,GAAMF,KAAKqD,IAAI,EAAG,EAAI,IAAMrD,KAAKqD,IAAI,GAAI,EAAI,IACjE,CAGAnC,UACE1G,KAAKmb,MACP,EAeK,SAASe,EAAYC,EAAM,KAGhC,MAAM7B,EAAO6B,EAAI9B,aACX+B,EAAMD,EAAIE,mBAChBD,EAAIE,UAAUnb,MAAQ,IACtBib,EAAItR,MAAMqR,EAAI5U,YAAc,IAC5B6U,EAAIjB,KAAKgB,EAAI5U,YAAc,IAC3B+S,EAAKC,QAAQ4B,EAAI3B,aACjBF,EAAKG,aAOPva,eAA6Bic,GAC3B,OAAOA,EAAII,QACb,CAPEC,CAAcL,GAAKM,OAAO7P,IACxB0F,QAAQzO,MAAM,+CAAgD+I,EAAE,GAEpE,CA1Be,IAhPR,MACLhN,YAAYyG,GACVrG,KAAK0c,cAAgBrW,GAAgB,IACrCrG,KAAK2c,SAAW,GAChB3c,KAAK4c,QAAU,GACf5c,KAAK6c,WAAa,IAAIC,IACtB9c,KAAK+c,aAAe/c,KAAK0c,cAAclC,WACzC,CAKA7T,SACEuV,EAAYlc,KAAK0c,cACnB,CAGIrW,mBACF,OAAOrG,KAAK0c,aACd,CAGIlC,kBACF,OAAOxa,KAAK+c,YACd,CAIIxV,kBACF,OAAOvH,KAAK0c,cAAcnV,WAC5B,CAGAb,UACE,IAAI1G,KAAKgd,WAAT,CACAhd,KAAKgd,YAAa,EAClB,IAAK,MAAMC,KAAUjd,KAAK2c,SAAUM,EAAOvW,UAC3C,IAAK,MAAMwW,KAAYld,KAAK6c,WAAYK,EAASxW,UACjD1G,KAAK2c,SAAW,KAChB3c,KAAK6c,WAAa,IALS,CAM7B,CAIAM,OAAOC,GACL,OAAOpd,KAAKqd,qBAAqBD,GAAmBjP,MAAME,GACxDrO,KAAKsd,aAAajP,IAEtB,CAGA4O,OAAOM,GAQL,MAP2B,KACrBA,EAA+BC,iBAC1Brd,QAAQC,QAAQmd,GAEhBvd,KAAKmd,OAAOI,GAJI,GAODpP,MAAMwM,IAC9B,GAAI3a,KAAKgd,WAAY,MAAM,IAAIlZ,MAAM,qCACrC,MAAMmZ,EAAS,IAAIvC,EAAO1a,KAAM2a,GAEhC,OADA3a,KAAK2c,SAASra,KAAK2a,GACZA,CAAM,GAEjB,CAEA7B,MAAM7V,GACJ,MAAM6V,EAAQ,IAAIlB,EAAWla,KAAMuF,GAEnC,OADAvF,KAAK4c,QAAQta,KAAK8Y,GACXA,CACT,CAEAiC,qBAAqBD,GACnB,OAAIA,aAA6BK,YACxBtd,QAAQC,QAAQgd,GAEhB,YAASA,GAAmBnd,GAAG,cAE1C,CAEAqd,aAAajP,GACX,OAAO,IAAIlO,SAAQ,CAACC,EAASmE,KAC3B,GAAI0V,GAAsB5L,EAAYqP,WAAa,EAAG,CACpD,MAAMC,EAAO,IAAIC,WAAWvP,EAAa,EAAG,GAC5C,GACc,KAAZsP,EAAK,IACO,MAAZA,EAAK,IACO,MAAZA,EAAK,IACO,KAAZA,EAAK,GAEL,OAAOvd,EAAQ,YAAUJ,KAAKqG,aAAcgI,G,CAGhDrO,KAAKqG,aAAawX,gBAChBxP,GACA,SAAgCsM,GAC9Bva,EAAQua,EACV,IACA,SAAgC/N,GAC9BrI,EAAO,IAAIT,MAAM,2BAA6B8I,GAChD,GACD,GAEL,CAEAiP,cAAcqB,GACZld,KAAK6c,WAAWpa,IAAIya,EACtB,CAEApB,gBAAgBoB,GACdld,KAAK6c,WAAWiB,OAAOZ,EACzB,E,mCChHF,IAAIa,EAAW,EAAQ,KACnBC,EAAO,EAAQ,KASnB,SAASC,IACPje,KAAKke,SAAW,KAChBle,KAAKme,QAAU,KACfne,KAAKoe,KAAO,KACZpe,KAAKqe,KAAO,KACZre,KAAKse,KAAO,KACZte,KAAKue,SAAW,KAChBve,KAAKwe,KAAO,KACZxe,KAAKye,OAAS,KACdze,KAAK0e,MAAQ,KACb1e,KAAK2e,SAAW,KAChB3e,KAAKQ,KAAO,KACZR,KAAKe,KAAO,IACd,CApBAG,EAAQwW,MAAQkH,EAChB1d,EAAQd,QA0ZR,SAAoB4a,EAAQ6D,GAC1B,OAAOD,EAAS5D,GAAQ,GAAO,GAAM5a,QAAQye,EAC/C,EA3ZA3d,EAAQ4d,cAiaR,SAA0B9D,EAAQ6D,GAChC,OAAK7D,EACE4D,EAAS5D,GAAQ,GAAO,GAAM8D,cAAcD,GAD/BA,CAEtB,EAnaA3d,EAAQyW,OAsVR,SAAmBoH,GAKbf,EAAKgB,SAASD,KAAMA,EAAMH,EAASG,IACvC,OAAMA,aAAed,EACdc,EAAIpH,SADuBsG,EAAInc,UAAU6V,OAAOpB,KAAKwI,EAE9D,EA5VA7d,EAAQ+c,IAAMA,EAqBd,IAAIgB,EAAkB,oBAClBC,EAAc,WAGdC,EAAoB,qCAOpBC,EAAS,CAAC,IAAK,IAAK,IAAK,KAAM,IAAK,KAAK1P,OAHhC,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,KAAM,KAAM,OAM/C2P,EAAa,CAAC,KAAM3P,OAAO0P,GAK3BE,EAAe,CAAC,IAAK,IAAK,IAAK,IAAK,KAAK5P,OAAO2P,GAChDE,EAAkB,CAAC,IAAK,IAAK,KAE7BC,EAAsB,yBACtBC,EAAoB,+BAEpBC,EAAiB,CACf,YAAc,EACd,eAAe,GAGjBC,EAAmB,CACjB,YAAc,EACd,eAAe,GAGjBC,EAAkB,CAChB,MAAQ,EACR,OAAS,EACT,KAAO,EACP,QAAU,EACV,MAAQ,EACR,SAAS,EACT,UAAU,EACV,QAAQ,EACR,WAAW,EACX,SAAS,GAEXC,EAAc,EAAQ,KAE1B,SAASjB,EAAS/e,EAAKigB,EAAkBC,GACvC,GAAIlgB,GAAOme,EAAKgC,SAASngB,IAAQA,aAAeoe,EAAK,OAAOpe,EAE5D,IAAIogB,EAAI,IAAIhC,EAEZ,OADAgC,EAAEvI,MAAM7X,EAAKigB,EAAkBC,GACxBE,CACT,CAEAhC,EAAInc,UAAU4V,MAAQ,SAAS7X,EAAKigB,EAAkBC,GACpD,IAAK/B,EAAKgB,SAASnf,GACjB,MAAM,IAAIqgB,UAAU,gDAAkDrgB,GAMxE,IAAIsgB,EAAatgB,EAAImK,QAAQ,KACzBoW,GACqB,IAAhBD,GAAqBA,EAAatgB,EAAImK,QAAQ,KAAQ,IAAM,IACjEqW,EAASxgB,EAAIY,MAAM2f,GAEvBC,EAAO,GAAKA,EAAO,GAAGrH,QADL,MACyB,KAG1C,IAAIsH,EAFJzgB,EAAMwgB,EAAOxf,KAAKuf,GAQlB,GAFAE,EAAOA,EAAKC,QAEPR,GAA+C,IAA1BlgB,EAAIY,MAAM,KAAKmC,OAAc,CAErD,IAAI4d,EAAarB,EAAkB7F,KAAKgH,GACxC,GAAIE,EAeF,OAdAxgB,KAAKQ,KAAO8f,EACZtgB,KAAKe,KAAOuf,EACZtgB,KAAK2e,SAAW6B,EAAW,GACvBA,EAAW,IACbxgB,KAAKye,OAAS+B,EAAW,GAEvBxgB,KAAK0e,MADHoB,EACWD,EAAYnI,MAAM1X,KAAKye,OAAOgC,OAAO,IAErCzgB,KAAKye,OAAOgC,OAAO,IAEzBX,IACT9f,KAAKye,OAAS,GACdze,KAAK0e,MAAQ,CAAC,GAET1e,IAEX,CAEA,IAAI0gB,EAAQzB,EAAgB3F,KAAKgH,GACjC,GAAII,EAAO,CAET,IAAIC,GADJD,EAAQA,EAAM,IACSxe,cACvBlC,KAAKke,SAAWyC,EAChBL,EAAOA,EAAKG,OAAOC,EAAM9d,OAC3B,CAMA,GAAImd,GAAqBW,GAASJ,EAAKlf,MAAM,wBAAyB,CACpE,IAAI+c,EAAgC,OAAtBmC,EAAKG,OAAO,EAAG,IACzBtC,GAAauC,GAASf,EAAiBe,KACzCJ,EAAOA,EAAKG,OAAO,GACnBzgB,KAAKme,SAAU,EAEnB,CAEA,IAAKwB,EAAiBe,KACjBvC,GAAYuC,IAAUd,EAAgBc,IAAU,CAmBnD,IADA,IASItC,EAAMwC,EATNC,GAAW,EACN7e,EAAI,EAAGA,EAAIud,EAAgB3c,OAAQZ,IAAK,EAElC,KADT8e,EAAMR,EAAKtW,QAAQuV,EAAgBvd,QACP,IAAb6e,GAAkBC,EAAMD,KACzCA,EAAUC,EACd,EAgBgB,KATdF,GAFe,IAAbC,EAEOP,EAAKS,YAAY,KAIjBT,EAAKS,YAAY,IAAKF,MAM/BzC,EAAOkC,EAAKrd,MAAM,EAAG2d,GACrBN,EAAOA,EAAKrd,MAAM2d,EAAS,GAC3B5gB,KAAKoe,KAAO4C,mBAAmB5C,IAIjCyC,GAAW,EACX,IAAS7e,EAAI,EAAGA,EAAIsd,EAAa1c,OAAQZ,IAAK,CAC5C,IAAI8e,GACS,KADTA,EAAMR,EAAKtW,QAAQsV,EAAatd,QACJ,IAAb6e,GAAkBC,EAAMD,KACzCA,EAAUC,EACd,EAEiB,IAAbD,IACFA,EAAUP,EAAK1d,QAEjB5C,KAAKqe,KAAOiC,EAAKrd,MAAM,EAAG4d,GAC1BP,EAAOA,EAAKrd,MAAM4d,GAGlB7gB,KAAKihB,YAILjhB,KAAKue,SAAWve,KAAKue,UAAY,GAIjC,IAAI2C,EAAoC,MAArBlhB,KAAKue,SAAS,IACe,MAA5Cve,KAAKue,SAASve,KAAKue,SAAS3b,OAAS,GAGzC,IAAKse,EAEH,IADA,IAAIC,EAAYnhB,KAAKue,SAAS9d,MAAM,MACpB2gB,GAAPpf,EAAI,EAAOmf,EAAUve,QAAQZ,EAAIof,EAAGpf,IAAK,CAChD,IAAIrB,EAAOwgB,EAAUnf,GACrB,GAAKrB,IACAA,EAAKS,MAAMoe,GAAsB,CAEpC,IADA,IAAI6B,EAAU,GACLC,EAAI,EAAGC,EAAI5gB,EAAKiC,OAAQ0e,EAAIC,EAAGD,IAClC3gB,EAAK6gB,WAAWF,GAAK,IAIvBD,GAAW,IAEXA,GAAW1gB,EAAK2gB,GAIpB,IAAKD,EAAQjgB,MAAMoe,GAAsB,CACvC,IAAIiC,EAAaN,EAAUle,MAAM,EAAGjB,GAChC0f,EAAUP,EAAUle,MAAMjB,EAAI,GAC9B2f,EAAMhhB,EAAKS,MAAMqe,GACjBkC,IACFF,EAAWnf,KAAKqf,EAAI,IACpBD,EAAQE,QAAQD,EAAI,KAElBD,EAAQ9e,SACV0d,EAAO,IAAMoB,EAAQ7gB,KAAK,KAAOyf,GAEnCtgB,KAAKue,SAAWkD,EAAW5gB,KAAK,KAChC,KACF,CACF,CACF,CAGEb,KAAKue,SAAS3b,OAjND,IAkNf5C,KAAKue,SAAW,GAGhBve,KAAKue,SAAWve,KAAKue,SAASrc,cAG3Bgf,IAKHlhB,KAAKue,SAAWR,EAAS8D,QAAQ7hB,KAAKue,WAGxC,IAAIuD,EAAI9hB,KAAKse,KAAO,IAAMte,KAAKse,KAAO,GAClCyD,EAAI/hB,KAAKue,UAAY,GACzBve,KAAKqe,KAAO0D,EAAID,EAChB9hB,KAAKe,MAAQf,KAAKqe,KAId6C,IACFlhB,KAAKue,SAAWve,KAAKue,SAASkC,OAAO,EAAGzgB,KAAKue,SAAS3b,OAAS,GAC/C,MAAZ0d,EAAK,KACPA,EAAO,IAAMA,GAGnB,CAIA,IAAKZ,EAAeiB,GAKlB,IAAS3e,EAAI,EAAGof,EAAI/B,EAAWzc,OAAQZ,EAAIof,EAAGpf,IAAK,CACjD,IAAIggB,EAAK3C,EAAWrd,GACpB,IAA0B,IAAtBse,EAAKtW,QAAQgY,GAAjB,CAEA,IAAIC,EAAMrhB,mBAAmBohB,GACzBC,IAAQD,IACVC,EAAMC,OAAOF,IAEf1B,EAAOA,EAAK7f,MAAMuhB,GAAInhB,KAAKohB,EALjB,CAMZ,CAKF,IAAIzD,EAAO8B,EAAKtW,QAAQ,MACV,IAAVwU,IAEFxe,KAAKwe,KAAO8B,EAAKG,OAAOjC,GACxB8B,EAAOA,EAAKrd,MAAM,EAAGub,IAEvB,IAAI2D,EAAK7B,EAAKtW,QAAQ,KAoBtB,IAnBY,IAARmY,GACFniB,KAAKye,OAAS6B,EAAKG,OAAO0B,GAC1BniB,KAAK0e,MAAQ4B,EAAKG,OAAO0B,EAAK,GAC1BrC,IACF9f,KAAK0e,MAAQmB,EAAYnI,MAAM1X,KAAK0e,QAEtC4B,EAAOA,EAAKrd,MAAM,EAAGkf,IACZrC,IAET9f,KAAKye,OAAS,GACdze,KAAK0e,MAAQ,CAAC,GAEZ4B,IAAMtgB,KAAK2e,SAAW2B,GACtBV,EAAgBe,IAChB3gB,KAAKue,WAAave,KAAK2e,WACzB3e,KAAK2e,SAAW,KAId3e,KAAK2e,UAAY3e,KAAKye,OAAQ,CAC5BqD,EAAI9hB,KAAK2e,UAAY,GAAzB,IACI1F,EAAIjZ,KAAKye,QAAU,GACvBze,KAAKQ,KAAOshB,EAAI7I,CAClB,CAIA,OADAjZ,KAAKe,KAAOf,KAAK2X,SACV3X,IACT,EAaAie,EAAInc,UAAU6V,OAAS,WACrB,IAAIyG,EAAOpe,KAAKoe,MAAQ,GACpBA,IAEFA,GADAA,EAAOxd,mBAAmBwd,IACdpF,QAAQ,OAAQ,KAC5BoF,GAAQ,KAGV,IAAIF,EAAWle,KAAKke,UAAY,GAC5BS,EAAW3e,KAAK2e,UAAY,GAC5BH,EAAOxe,KAAKwe,MAAQ,GACpBH,GAAO,EACPK,EAAQ,GAER1e,KAAKqe,KACPA,EAAOD,EAAOpe,KAAKqe,KACVre,KAAKue,WACdF,EAAOD,IAAwC,IAAhCpe,KAAKue,SAASvU,QAAQ,KACjChK,KAAKue,SACL,IAAMve,KAAKue,SAAW,KACtBve,KAAKse,OACPD,GAAQ,IAAMre,KAAKse,OAInBte,KAAK0e,OACLV,EAAKgC,SAAShgB,KAAK0e,QACnB1d,OAAOohB,KAAKpiB,KAAK0e,OAAO9b,SAC1B8b,EAAQmB,EAAYwC,UAAUriB,KAAK0e,QAGrC,IAAID,EAASze,KAAKye,QAAWC,GAAU,IAAMA,GAAW,GAsBxD,OApBIR,GAAoC,MAAxBA,EAASuC,QAAQ,KAAYvC,GAAY,KAIrDle,KAAKme,WACHD,GAAY0B,EAAgB1B,MAAuB,IAATG,GAC9CA,EAAO,MAAQA,GAAQ,IACnBM,GAAmC,MAAvBA,EAAS2D,OAAO,KAAY3D,EAAW,IAAMA,IACnDN,IACVA,EAAO,IAGLG,GAA2B,MAAnBA,EAAK8D,OAAO,KAAY9D,EAAO,IAAMA,GAC7CC,GAA+B,MAArBA,EAAO6D,OAAO,KAAY7D,EAAS,IAAMA,GAOhDP,EAAWG,GALlBM,EAAWA,EAAS3F,QAAQ,SAAS,SAAS5X,GAC5C,OAAOR,mBAAmBQ,EAC5B,MACAqd,EAASA,EAAOzF,QAAQ,IAAK,QAEgBwF,CAC/C,EAMAP,EAAInc,UAAU1B,QAAU,SAASye,GAC/B,OAAO7e,KAAK8e,cAAcF,EAASC,GAAU,GAAO,IAAOlH,QAC7D,EAOAsG,EAAInc,UAAUgd,cAAgB,SAASD,GACrC,GAAIb,EAAKgB,SAASH,GAAW,CAC3B,IAAI0D,EAAM,IAAItE,EACdsE,EAAI7K,MAAMmH,GAAU,GAAO,GAC3BA,EAAW0D,CACb,CAIA,IAFA,IAAIpY,EAAS,IAAI8T,EACbuE,EAAQxhB,OAAOohB,KAAKpiB,MACfyiB,EAAK,EAAGA,EAAKD,EAAM5f,OAAQ6f,IAAM,CACxC,IAAIC,EAAOF,EAAMC,GACjBtY,EAAOuY,GAAQ1iB,KAAK0iB,EACtB,CAOA,GAHAvY,EAAOqU,KAAOK,EAASL,KAGD,KAAlBK,EAAS9d,KAEX,OADAoJ,EAAOpJ,KAAOoJ,EAAOwN,SACdxN,EAIT,GAAI0U,EAASV,UAAYU,EAASX,SAAU,CAG1C,IADA,IAAIyE,EAAQ3hB,OAAOohB,KAAKvD,GACf+D,EAAK,EAAGA,EAAKD,EAAM/f,OAAQggB,IAAM,CACxC,IAAIC,EAAOF,EAAMC,GACJ,aAATC,IACF1Y,EAAO0Y,GAAQhE,EAASgE,GAC5B,CASA,OANIjD,EAAgBzV,EAAO+T,WACvB/T,EAAOoU,WAAapU,EAAOwU,WAC7BxU,EAAO3J,KAAO2J,EAAOwU,SAAW,KAGlCxU,EAAOpJ,KAAOoJ,EAAOwN,SACdxN,CACT,CAEA,GAAI0U,EAASX,UAAYW,EAASX,WAAa/T,EAAO+T,SAAU,CAS9D,IAAK0B,EAAgBf,EAASX,UAAW,CAEvC,IADA,IAAIkE,EAAOphB,OAAOohB,KAAKvD,GACdiE,EAAI,EAAGA,EAAIV,EAAKxf,OAAQkgB,IAAK,CACpC,IAAIvB,EAAIa,EAAKU,GACb3Y,EAAOoX,GAAK1C,EAAS0C,EACvB,CAEA,OADApX,EAAOpJ,KAAOoJ,EAAOwN,SACdxN,CACT,CAGA,GADAA,EAAO+T,SAAWW,EAASX,SACtBW,EAASR,MAASsB,EAAiBd,EAASX,UAS/C/T,EAAOwU,SAAWE,EAASF,aAT+B,CAE1D,IADA,IAAIoE,GAAWlE,EAASF,UAAY,IAAIle,MAAM,KACvCsiB,EAAQngB,UAAYic,EAASR,KAAO0E,EAAQvb,WAC9CqX,EAASR,OAAMQ,EAASR,KAAO,IAC/BQ,EAASN,WAAUM,EAASN,SAAW,IACzB,KAAfwE,EAAQ,IAAWA,EAAQnB,QAAQ,IACnCmB,EAAQngB,OAAS,GAAGmgB,EAAQnB,QAAQ,IACxCzX,EAAOwU,SAAWoE,EAAQliB,KAAK,IACjC,CAUA,GAPAsJ,EAAOsU,OAASI,EAASJ,OACzBtU,EAAOuU,MAAQG,EAASH,MACxBvU,EAAOkU,KAAOQ,EAASR,MAAQ,GAC/BlU,EAAOiU,KAAOS,EAAST,KACvBjU,EAAOoU,SAAWM,EAASN,UAAYM,EAASR,KAChDlU,EAAOmU,KAAOO,EAASP,KAEnBnU,EAAOwU,UAAYxU,EAAOsU,OAAQ,CACpC,IAAIqD,EAAI3X,EAAOwU,UAAY,GACvB1F,EAAI9O,EAAOsU,QAAU,GACzBtU,EAAO3J,KAAOshB,EAAI7I,CACpB,CAGA,OAFA9O,EAAOgU,QAAUhU,EAAOgU,SAAWU,EAASV,QAC5ChU,EAAOpJ,KAAOoJ,EAAOwN,SACdxN,CACT,CAEA,IAAI6Y,EAAe7Y,EAAOwU,UAA0C,MAA9BxU,EAAOwU,SAAS2D,OAAO,GACzDW,EACIpE,EAASR,MACTQ,EAASF,UAA4C,MAAhCE,EAASF,SAAS2D,OAAO,GAElDY,EAAcD,GAAYD,GACX7Y,EAAOkU,MAAQQ,EAASF,SACvCwE,EAAgBD,EAChBE,EAAUjZ,EAAOwU,UAAYxU,EAAOwU,SAASle,MAAM,MAAQ,GAE3D4iB,GADAN,EAAUlE,EAASF,UAAYE,EAASF,SAASle,MAAM,MAAQ,GACnD0J,EAAO+T,WAAa0B,EAAgBzV,EAAO+T,WA2B3D,GApBImF,IACFlZ,EAAOoU,SAAW,GAClBpU,EAAOmU,KAAO,KACVnU,EAAOkU,OACU,KAAf+E,EAAQ,GAAWA,EAAQ,GAAKjZ,EAAOkU,KACtC+E,EAAQxB,QAAQzX,EAAOkU,OAE9BlU,EAAOkU,KAAO,GACVQ,EAASX,WACXW,EAASN,SAAW,KACpBM,EAASP,KAAO,KACZO,EAASR,OACQ,KAAf0E,EAAQ,GAAWA,EAAQ,GAAKlE,EAASR,KACxC0E,EAAQnB,QAAQ/C,EAASR,OAEhCQ,EAASR,KAAO,MAElB6E,EAAaA,IAA8B,KAAfH,EAAQ,IAA4B,KAAfK,EAAQ,KAGvDH,EAEF9Y,EAAOkU,KAAQQ,EAASR,MAA0B,KAAlBQ,EAASR,KAC3BQ,EAASR,KAAOlU,EAAOkU,KACrClU,EAAOoU,SAAYM,EAASN,UAAkC,KAAtBM,EAASN,SAC/BM,EAASN,SAAWpU,EAAOoU,SAC7CpU,EAAOsU,OAASI,EAASJ,OACzBtU,EAAOuU,MAAQG,EAASH,MACxB0E,EAAUL,OAEL,GAAIA,EAAQngB,OAGZwgB,IAASA,EAAU,IACxBA,EAAQE,MACRF,EAAUA,EAAQ1T,OAAOqT,GACzB5Y,EAAOsU,OAASI,EAASJ,OACzBtU,EAAOuU,MAAQG,EAASH,WACnB,IAAKV,EAAKuF,kBAAkB1E,EAASJ,QAAS,CAInD,GAAI4E,EACFlZ,EAAOoU,SAAWpU,EAAOkU,KAAO+E,EAAQ5b,SAIpCgc,KAAarZ,EAAOkU,MAAQlU,EAAOkU,KAAKrU,QAAQ,KAAO,IAC1CG,EAAOkU,KAAK5d,MAAM,QAEjC0J,EAAOiU,KAAOoF,EAAWhc,QACzB2C,EAAOkU,KAAOlU,EAAOoU,SAAWiF,EAAWhc,SAW/C,OARA2C,EAAOsU,OAASI,EAASJ,OACzBtU,EAAOuU,MAAQG,EAASH,MAEnBV,EAAKyF,OAAOtZ,EAAOwU,WAAcX,EAAKyF,OAAOtZ,EAAOsU,UACvDtU,EAAO3J,MAAQ2J,EAAOwU,SAAWxU,EAAOwU,SAAW,KACpCxU,EAAOsU,OAAStU,EAAOsU,OAAS,KAEjDtU,EAAOpJ,KAAOoJ,EAAOwN,SACdxN,CACT,CAEA,IAAKiZ,EAAQxgB,OAWX,OARAuH,EAAOwU,SAAW,KAEdxU,EAAOsU,OACTtU,EAAO3J,KAAO,IAAM2J,EAAOsU,OAE3BtU,EAAO3J,KAAO,KAEhB2J,EAAOpJ,KAAOoJ,EAAOwN,SACdxN,EAcT,IARA,IAAIf,EAAOga,EAAQngB,OAAO,GAAG,GACzBygB,GACCvZ,EAAOkU,MAAQQ,EAASR,MAAQ+E,EAAQxgB,OAAS,KACxC,MAATwG,GAAyB,OAATA,IAA2B,KAATA,EAInCua,EAAK,EACA3hB,EAAIohB,EAAQxgB,OAAQZ,GAAK,EAAGA,IAEtB,OADboH,EAAOga,EAAQphB,IAEbohB,EAAQQ,OAAO5hB,EAAG,GACA,OAAToH,GACTga,EAAQQ,OAAO5hB,EAAG,GAClB2hB,KACSA,IACTP,EAAQQ,OAAO5hB,EAAG,GAClB2hB,KAKJ,IAAKT,IAAeC,EAClB,KAAOQ,IAAMA,EACXP,EAAQxB,QAAQ,OAIhBsB,GAA6B,KAAfE,EAAQ,IACpBA,EAAQ,IAA+B,MAAzBA,EAAQ,GAAGd,OAAO,IACpCc,EAAQxB,QAAQ,IAGd8B,GAAsD,MAAjCN,EAAQviB,KAAK,KAAK4f,QAAQ,IACjD2C,EAAQ9gB,KAAK,IAGf,IAUMkhB,EAVFK,EAA4B,KAAfT,EAAQ,IACpBA,EAAQ,IAA+B,MAAzBA,EAAQ,GAAGd,OAAO,GAGjCe,IACFlZ,EAAOoU,SAAWpU,EAAOkU,KAAOwF,EAAa,GACbT,EAAQxgB,OAASwgB,EAAQ5b,QAAU,IAI/Dgc,KAAarZ,EAAOkU,MAAQlU,EAAOkU,KAAKrU,QAAQ,KAAO,IAC1CG,EAAOkU,KAAK5d,MAAM,QAEjC0J,EAAOiU,KAAOoF,EAAWhc,QACzB2C,EAAOkU,KAAOlU,EAAOoU,SAAWiF,EAAWhc,UAyB/C,OArBA0b,EAAaA,GAAe/Y,EAAOkU,MAAQ+E,EAAQxgB,UAEhCihB,GACjBT,EAAQxB,QAAQ,IAGbwB,EAAQxgB,OAIXuH,EAAOwU,SAAWyE,EAAQviB,KAAK,MAH/BsJ,EAAOwU,SAAW,KAClBxU,EAAO3J,KAAO,MAMXwd,EAAKyF,OAAOtZ,EAAOwU,WAAcX,EAAKyF,OAAOtZ,EAAOsU,UACvDtU,EAAO3J,MAAQ2J,EAAOwU,SAAWxU,EAAOwU,SAAW,KACpCxU,EAAOsU,OAAStU,EAAOsU,OAAS,KAEjDtU,EAAOiU,KAAOS,EAAST,MAAQjU,EAAOiU,KACtCjU,EAAOgU,QAAUhU,EAAOgU,SAAWU,EAASV,QAC5ChU,EAAOpJ,KAAOoJ,EAAOwN,SACdxN,CACT,EAEA8T,EAAInc,UAAUmf,UAAY,WACxB,IAAI5C,EAAOre,KAAKqe,KACZC,EAAOY,EAAY5F,KAAK+E,GACxBC,IAEW,OADbA,EAAOA,EAAK,MAEVte,KAAKse,KAAOA,EAAKmC,OAAO,IAE1BpC,EAAOA,EAAKoC,OAAO,EAAGpC,EAAKzb,OAAS0b,EAAK1b,SAEvCyb,IAAMre,KAAKue,SAAWF,EAC5B,C,uLCztBe,MAAMyF,EAArB,cACU,KAAA/I,OAA0B,GAC1B,KAAAgJ,gBAAoC1iB,IACtCrB,KAAK+a,QAAQ/a,KAAK+a,OAAOzY,KAAKjB,EAAK,EAGlC,KAAA2iB,IAAwB3iB,IAC7BrB,KAAK+jB,gBAAgB1iB,EAAK,EAG5B,KAAA4iB,mBAAsBC,IACpBlkB,KAAK+jB,gBAAkBG,EACnBlkB,KAAK+a,SACP/a,KAAK+a,OAAOoJ,SAAS9iB,GAAS6iB,EAAG7iB,KACjCrB,KAAK+a,OAAS,K,CAGpB,ECfO,MAAMqJ,EAETxkB,YAAYS,EAAKgkB,EAAK7jB,EAAK8jB,GACvBtkB,KAAKukB,MAAQlkB,EACbL,KAAKwkB,MAAQH,EACbrkB,KAAKykB,MAAQjkB,EACbR,KAAK0kB,YAAcJ,CACvB,CAKIjkB,WACA,OAAOL,KAAKukB,KAChB,CAIIF,WACA,OAAOrkB,KAAKwkB,KAChB,CAMAG,UACI,OAAO3kB,KAAK0kB,YAAYE,kBAAkB5kB,KAAKykB,MACnD,EC7BG,MAAM,EAMTI,YAAYtf,EAAU,CAAC,GAKnB,OAJA,EAAQuf,SAAW,CACfC,UAAW,8BACRxf,GAEA,EAAQuf,QACnB,CAQAD,YAAY3W,EAAM3I,EAAU,MACxBA,EAAYA,GACA,EAAQuf,UACR,EAAQtO,QAAUlE,QAAQC,KAAK,6CAA8C,EAAQuS,UAEjG,OADa,IAAI,EAAQ5W,EAAK3I,GAClByf,MAChB,CAOAplB,YAAYsO,EAAK3I,GACbvF,KAAKilB,QAAU,IAAIC,OAAO3f,EAAQwf,WAClC/kB,KAAKilB,QAAQlgB,iBAAiB,UAAW/E,KAAKmlB,WAAWC,KAAKplB,OAC9DA,KAAKqW,WAAa,GAClBrW,KAAKqlB,SAAW,CAAC,EACjBrlB,KAAKslB,WAAa,EAClBtlB,KAAKulB,MAAQrX,CACjB,CAMAhO,aAMI,aALMF,KAAKwlB,aAAa,CAACC,KAAM,UAAS,CAACrlB,EAAQmE,EAAOmhB,KACnC,UAAbA,EAAID,MACJrlB,GACJ,UAESJ,KAAKwlB,aAAa,CAACC,KAAM,OAAQvX,KAAMlO,KAAKulB,QAAQ,CAACnlB,EAAQmE,EAAOmhB,KAC7D,WAAbA,EAAID,MACHrlB,EAAQJ,KACZ,GAER,CAMA2lB,mBACI,OAAO3lB,KAAKwlB,aAAa,CAACC,KAAM,qBAC5B,CAACrlB,EAAQmE,EAAOmhB,KACK,sBAAbA,EAAID,MACJrlB,EAAQslB,EAAI3V,OAChB,GAGZ,CAKA6V,YAAYC,GACR,OAAO7lB,KAAKwlB,aAAa,CAACC,KAAM,iBAAkBK,WAAYD,IAC1D,CAACzlB,EAAQmE,EAAOmhB,KACK,sBAAbA,EAAID,MACJrlB,EAAQslB,EAAI3V,OAChB,GAGZ,CAMAgW,iBACI,OAAI/lB,KAAKslB,WAAa,EACXnlB,QAAQC,UAAU+N,MAAM,IAAMnO,KAAKqlB,WAEvCrlB,KAAKwlB,aAAa,CAACC,KAAM,eAAe,CAACrlB,EAAQmE,EAAOmhB,KAC3D,GAAiB,UAAbA,EAAID,KAAkB,CACtB,MAAMO,EAAQN,EAAIM,OACVC,EAAQC,GAASlmB,KAAKmmB,SAASnmB,KAAKqlB,SAASW,EAAMxlB,MAI3D,MAHmB,SAAfwlB,EAAMP,OACNQ,EAAOC,GAAQ,IAAI9B,EAAe4B,EAAMI,SAASJ,EAAM3B,KAAK2B,EAAMxlB,KAAKR,QAEpE,CACX,CAAuB,QAAb0lB,EAAID,OACVzlB,KAAKslB,WAAa,EAClBllB,EAAQJ,KAAKqmB,cAAcrmB,KAAKqlB,WACpC,GAER,CAEAiB,gBACI,OAAOtmB,KAAK+lB,iBAAiB5X,MAAO4Q,GACzB/e,KAAKumB,eAAexH,IAEnC,CAEA6F,kBAAkBqB,GACd,OAAOjmB,KAAKwlB,aAAa,CAACC,KAAM,sBAAuBQ,OAAQA,IAC3D,CAAC7lB,EAAQmE,EAAOmhB,KACZ,GAAiB,SAAbA,EAAID,KAAiB,CAIrBrlB,EAHa,IAAIomB,KAAK,CAACd,EAAIM,MAAMS,UAAWf,EAAIM,MAAMI,SAAU,CAC5DX,KAAM,6BAGd,IAGZ,CAOAiB,aAAaC,GACT,OAAI3mB,KAAKslB,WAAa,EACXnlB,QAAQC,UAAU+N,MAAM,IAAMnO,KAAKqlB,WAEvCrlB,KAAKwlB,aAAa,CAACC,KAAM,kBAAkB,CAACrlB,EAAQmE,EAAOmhB,KAC9D,GAAiB,UAAbA,EAAID,KAAkB,CACtB,MAAQQ,EAAQC,GAASlmB,KAAKmmB,SAASnmB,KAAKqlB,SAASK,EAAIM,MAAMxlB,MAY/D,MAXuB,SAAnBklB,EAAIM,MAAMP,OACVQ,EAAOC,GAAQ,IAAIM,KAAK,CAACd,EAAIM,MAAMS,UAAWf,EAAIM,MAAMI,SAAU,CAC9DX,KAAM,kCAEczP,IAApB2Q,GACAziB,WAAWyiB,EAAgBvB,KAAK,KAAK,CACjClX,KAAM+X,EAAOC,GACb1lB,KAAMklB,EAAIM,MAAMxlB,UAIrB,CACX,CAAuB,QAAbklB,EAAID,OACVzlB,KAAKslB,WAAa,EAClBtlB,KAAKilB,QAAQ2B,YACbxmB,EAAQJ,KAAKqmB,cAAcrmB,KAAKqlB,WACpC,GAER,CAEAgB,cAActH,GACV,GAAIA,aAAeyH,MAAQzH,aAAeqF,GAA0B,OAARrF,EAAe,OAAOA,EAClF,MAAMtH,EAAI,CAAC,EACX,IAAK,MAAMyO,KAAQllB,OAAOohB,KAAKrD,GAC3BtH,EAAEyO,GAAQlmB,KAAKqmB,cAActH,EAAImH,IAErC,OAAOzO,CACX,CAEA8O,eAAexH,EAAIve,EAAO,IACtB,MAAMqmB,EAAQ,GACd,IAAK,MAAMxkB,KAAOrB,OAAOohB,KAAKrD,GACtBA,EAAI1c,aAAgBmkB,MAAQzH,EAAI1c,aAAgB+hB,GAA+B,OAAbrF,EAAI1c,GACtEwkB,EAAMvkB,KAAK,CACP4L,KAAM6Q,EAAI1c,IAAQA,EAClB7B,KAAMA,IAGVqmB,EAAMvkB,QAAStC,KAAKumB,eAAexH,EAAI1c,GAAK,GAAG7B,IAAO6B,OAG9D,OAAOwkB,CACX,CAEAV,SAASpH,EAAIve,GACT,MAAMmZ,EAAQnZ,EAAKC,MAAM,KACM,KAA3BkZ,EAAMA,EAAM/W,OAAQ,IAAY+W,EAAM2J,MAC1C,IAAIwD,EAAM/H,EAAKgI,EAAO,KACtB,IAAK,MAAMpmB,KAAQgZ,EACfmN,EAAInmB,GAAQmmB,EAAInmB,IAAS,CAAC,EAC1BomB,EAAOD,EACPA,EAAMA,EAAInmB,GAEd,MAAO,CAAEomB,EAAMpN,EAAMA,EAAM/W,OAAO,GACtC,CAEA4iB,aAAaE,EAAIjkB,GAEb,OADAzB,KAAKilB,QAAQ+B,YAAYtB,GAClB,IAAIvlB,SAAQ,CAACC,EAAQmE,KACxBvE,KAAKqW,WAAW/T,KAAMtC,KAAKinB,YAAY7B,KAAKplB,KAAKyB,EAASrB,EAAQmE,GAAS,GAEnF,CAEA0iB,YAAYxlB,EAASrB,EAAQmE,EAAOmhB,GAChC,GAAiB,SAAbA,EAAID,KACJlhB,EAAO,sBACL,IAAiB,UAAbmhB,EAAID,KAGV,OAAOhkB,EAASrB,EAAQmE,EAAOmhB,GAF/BnhB,EAAOmhB,EAAI7hB,MAGf,CACJ,CAEAshB,YAAYjb,KAAMwb,KAEDjkB,EADIzB,KAAKqW,WAAWrW,KAAKqW,WAAWzT,OAAQ,IACnC8iB,IAElB1lB,KAAKqW,WAAWiN,KAExB,E,aC1NJ,EAAQ9M,KAAK,CACXuO,UAAW,sD,6BCQN,MAAMmC,EAAiB,yCAGxBC,EACJ,4FAaK,MAAM,EAKXvnB,YAAYwnB,GAJJ,KAAAC,SAAW,IAAIvD,EAEhB,KAAAG,mBAAqBjkB,KAAKqnB,SAASpD,mBAGxCjkB,KAAKsnB,OAASnnB,QAAQC,QAAQgnB,EAASG,SAASvnB,KAAKqnB,SAASrD,MAAM7V,MACjE0Y,GAyCA3mB,eACL2mB,EACA7C,GAEA,GAAqB,IAAjB6C,EAAMjkB,OAAc,OAAOikB,EAC/B,MAAMW,EAAYX,EAAM,GACxB,IAAKW,EAAUnnB,KAAKe,MAAM8lB,GACxB,OAAOL,EAGT,OADA7C,EAAI,2CD/EC9jB,eAAyBgO,GAC9B,MAAMuZ,EAAmB,GACnBC,QAAgB,EAAQ1C,KAAK9W,GAC7ByZ,QAAkBD,EAAQhB,eAC1BkB,EAAW,CAACC,EAAWnO,EAAS,MACpC,IAAK,MAAMrX,KAAOrB,OAAOohB,KAAKyF,GACxBA,EAAKxlB,aAAgBmkB,KACvB,OAAA/M,EAAA,GAAcC,EAAQrX,GAAMhC,IAC1BonB,EAAInlB,KAAK,CAAEjC,OAAM6N,KAAM2Z,EAAKxlB,IAAO,IAE5BwlB,EAAKxlB,IAA6B,iBAAdwlB,EAAKxlB,IAClCulB,EAASC,EAAKxlB,GAAMqX,EAASrX,EAAM,I,EAKzC,OADAulB,EAASD,GACFF,CACT,CC+DSK,CAAUN,EAAUtZ,KAC7B,CApDiB6Z,CAAkBlB,EAAO7mB,KAAKqnB,SAASrD,MAEtD,CAEA9V,KAAK7N,GACH,OAAOL,KAAKsnB,OAAOnZ,MAAK,SAAU0Y,GAChC,IAAK,MAAM3Y,KAAQ2Y,EACjB,GAAI3Y,EAAK7N,KAAK6B,gBAAkB7B,EAAK6B,cACnC,OAAO,IAAI,EAAagM,EAAKA,MAGjC,MAAM,IAAIpK,MAAM,kBAAoBzD,EACtC,GACF,CAEI2nB,eACF,OAAO7nB,QAAQC,QAAQJ,KAAKsnB,QAAQnZ,MAAM9K,GAAMA,EAAE3C,KAAK6O,GAAMA,EAAElP,QACjE,EAGK,MAAM,EACXT,YAAoB2lB,GAAA,KAAAA,OAAc,CAClCzlB,KAAKC,GACH,OAAO,IACLA,EACA,YAASC,KAAKulB,OAAOtlB,GAAG,eAE5B,CAEAoR,aACE,OAAOlR,QAAQC,QAAQU,IAAI0N,gBAAgBxO,KAAKulB,OAClD,CAEIllB,WACF,OAAOL,KAAKulB,MAAMllB,IACpB,EAsBKH,eAAe+nB,EACpBpoB,EACAmkB,GAEA,MAAM3jB,EAAOR,EACVmZ,QAAQ,SAAU,IAClBvY,MAAM,KACN6iB,MAGGliB,EAAQvB,EAAIuB,MAAM+lB,GACpB/lB,IACFvB,EAAM,qCAAqCuB,EAAM,MAAMA,EAAM,MAG/D,MAAMrB,EAAW,IAAI,IACrB,IAAImoB,EAAW,EACfnoB,EAASkQ,OAAM,KACTkH,KAAK9P,MAAQ6gB,EAAW,MAC5BlE,EAAI,gBAAgBjkB,KACpBmoB,EAAW/Q,KAAK9P,MAAK,IAGvB,MAAO,CAAEhH,OAAM6N,WADI,OAAAia,EAAA,GAAStoB,GAAKI,GAAG,OAAQF,GAE9C,C,mCCtHA,+CAaA,IAAIqoB,EAEJ,MAAMC,EAfN,MAec,GAAO,GAoBdnoB,eAAeooB,EACpBjiB,EACAgI,GAEA,MAAMka,QArBDH,IACHA,EAAiB,mCAIdja,MAAMqa,GAAOA,EAAG3iB,UAChBsI,MAAMM,IAEE,EAAIga,MAAMha,EAAM,iBAGtB2Z,GAWP,OAAOC,GAAM,IAGf,SACEE,EACAliB,EACAgI,GAEA,OAAO,IAAIlO,SAAqB,CAACC,EAASmE,KACxC,MAAMmkB,EAA4B,GAClC,IACIC,EADAC,EAAc,EAElBL,EAAUpL,OAAO9O,GAAa,SAAUzB,GAMtC,GALIA,EAAE1C,OACJye,EAAa/b,EAAE+b,WACfD,EAAQpmB,KAAKsK,EAAE1C,MACf0e,GAAehc,EAAE1C,KAAK,GAAGtH,QAEvBgK,EAAE/I,MAAO,CACX,MAAMA,EACJ+I,EAAE/I,iBAAiBC,MAAQ8I,EAAE/I,MAAQ,uBAAuB+I,EAAE/I,QAChEU,EAAOV,E,CAEL+I,EAAEic,KACJzoB,EAMRF,eACEmG,EACAyiB,EACAlmB,EACA+lB,GAEA,IAAK/lB,EAAQ,MAAM,IAAIkB,MAAM,iCAC7B,IAAK6kB,EAAY,MAAM,IAAI7kB,MAAM,sCACjC,MAAM0Z,EAAmBsL,EAAc,GAAGlmB,OACpC+X,EAActU,EAAa0iB,aAC/BvL,EACA5a,EACA+lB,GAEIK,EAAgCC,MAAMtO,EAAY6C,kBACrD0L,KAAK,MACLxoB,KAAI,CAACyoB,EAAGC,IAAO,IAAIC,EAAkB1O,EAAY2O,eAAeF,MACnE,IAAK,MAAMG,KAAST,EAClBS,EAAMpF,SAAQ,CAACqF,EAAcC,KAC3BT,EAASS,GAAcC,MAAMF,EAAa,IAG9C,OAAO7O,CACT,CA7BgBoO,CAAa1iB,EAAcqiB,EAASE,EAAaD,GAE7D,GAAE,GAEN,CA5BqBgB,CAAYpB,EAAWliB,EAAcgI,IAC1D,CAsDA,MAAMgb,EAEJzpB,YAAoBsK,GAAA,KAAAA,OADZ,KAAAkI,OAAS,CACwB,CACzCsX,MAAMF,GAEJ,MAAM,OAAEpX,EAAM,KAAElI,GAASlK,KACzB,IAAK,IAAIgC,EAAI,EAAGA,EAAIwnB,EAAa5mB,OAAQZ,IACvCkI,EAAKlI,EAAIoQ,GAAUoX,EAAaxnB,GAElChC,KAAKoS,QAAUoX,EAAa5mB,MAC9B,E,mCCxGF,IAAIgnB,EAAmB5pB,MAAQA,KAAK4pB,kBAAqB5oB,OAAO6oB,OAAS,SAAUpS,EAAGqS,EAAGvI,EAAGwI,QAC7E/T,IAAP+T,IAAkBA,EAAKxI,GAC3B,IAAIyI,EAAOhpB,OAAOipB,yBAAyBH,EAAGvI,GACzCyI,KAAS,QAASA,GAAQF,EAAEI,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMpoB,IAAK,WAAa,OAAO6nB,EAAEvI,EAAI,IAE5DvgB,OAAOC,eAAewW,EAAGsS,EAAIC,EAChC,EAAI,SAAUvS,EAAGqS,EAAGvI,EAAGwI,QACT/T,IAAP+T,IAAkBA,EAAKxI,GAC3B9J,EAAEsS,GAAMD,EAAEvI,EACb,GACG+I,EAAgBtqB,MAAQA,KAAKsqB,cAAiB,SAASR,EAAG5oB,GAC1D,IAAK,IAAI4gB,KAAKgI,EAAa,YAANhI,GAAoB9gB,OAAOc,UAAUyoB,eAAehU,KAAKrV,EAAS4gB,IAAI8H,EAAgB1oB,EAAS4oB,EAAGhI,EAC3H,EACI0I,EAAYxqB,MAAQA,KAAKwqB,UAAa,SAAS/S,GAC/C,IAAIwB,EAAsB,mBAAXwR,QAAyBA,OAAOC,SAAUZ,EAAI7Q,GAAKxB,EAAEwB,GAAIjX,EAAI,EAC5E,GAAI8nB,EAAG,OAAOA,EAAEvT,KAAKkB,GACrB,GAAIA,GAAyB,iBAAbA,EAAE7U,OAAqB,MAAO,CAC1C+nB,KAAM,WAEF,OADIlT,GAAKzV,GAAKyV,EAAE7U,SAAQ6U,OAAI,GACrB,CAAEtW,MAAOsW,GAAKA,EAAEzV,KAAM4oB,MAAOnT,EACxC,GAEJ,MAAM,IAAIyI,UAAUjH,EAAI,0BAA4B,kCACxD,EACI4R,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ6pB,eAAY,EACpB,IAAIC,EAAWH,EAAgB,EAAQ,KACnCI,EAAcJ,EAAgB,EAAQ,KAC1CP,EAAa,EAAQ,KAAYppB,GAKjC,IAAI6pB,EAA2B,WAC3B,SAASA,EAAU7gB,EAAMghB,QACC,IAAlBA,IAA4BA,EAAgB,CAAC,GACjD,IAAIC,EAAQnrB,KACRorB,EAAWlhB,EAAKmhB,MAAOC,EAASphB,EAAKohB,OAAQC,EAAYrhB,EAAKqhB,UAAWC,EAAWthB,EAAKshB,SAAUC,EAAcvhB,EAAKuhB,YAAaC,EAAUxhB,EAAKwhB,QAASC,EAAWzhB,EAAKyhB,SAAUC,EAAS1hB,EAAK0hB,OAAQC,EAAuB3hB,EAAK2hB,qBAAsBC,EAAK5hB,EAAK6hB,cAAeA,OAAuB,IAAPD,EAAgB,GAAKA,GAC/T,EAAIb,EAAYplB,SAASulB,EAAU,0BACnC,EAAIH,EAAYplB,SAASylB,EAAQ,2BACjC,EAAIL,EAAYplB,SAAS0lB,EAAW,8BACpC,EAAIN,EAAYplB,SAAS2lB,EAAU,6BACnC,EAAIP,EAAYplB,SAAS4lB,EAAa,gCACtC,EAAIR,EAAYplB,SAAS6lB,EAAS,4BAClC,EAAIT,EAAYplB,SAAS8lB,EAAU,4BACnC3rB,KAAK6rB,qBAAuBA,EAC5BT,EAAWprB,KAAKgsB,cAAcZ,EAAUF,GACxClrB,KAAKisB,QAAUX,EACftrB,KAAKksB,aAAeT,EACpBzrB,KAAKmsB,SAAWT,EAChB1rB,KAAKosB,WAAab,EAClBvrB,KAAKqsB,UAAY,EACjBrsB,KAAKssB,OAAStsB,KAAKusB,8BAA8BnB,GACjDprB,KAAKwsB,WAAaxsB,KAAKusB,8BAA8BR,GACrD/rB,KAAKysB,OAASzsB,KAAK0sB,mCAAmCtB,GACtDprB,KAAK2sB,UAAY3sB,KAAK4sB,uBAAuBjB,GAC7C3rB,KAAK2c,SAAW3c,KAAK6sB,uBAAuBtB,GAC5CvrB,KAAK8sB,OAAS,IAAIvmB,IAAIvG,KAAKssB,OAAO5rB,KAAI,SAAUqsB,GAAQ,MAAO,CAACA,EAAM5B,EAAM6B,aAAaD,GAAQ,KACjG/sB,KAAKitB,UAAYzB,EACjBxrB,KAAKktB,QAAUtB,CACnB,CAwUA,OAvUA5qB,OAAOC,eAAe8pB,EAAUjpB,UAAW,QAAS,CAIhDG,IAAK,WACD,OAAOjC,KAAKssB,MAChB,EACAjC,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,YAAa,CAIpDG,IAAK,WACD,OAAOjC,KAAKwsB,UAChB,EACAnC,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,QAAS,CAIhDG,IAAK,WACD,OAAOjC,KAAKysB,MAChB,EACApC,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,UAAW,CAIlDG,IAAK,WACD,OAAOjC,KAAK2c,QAChB,EACA0N,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,YAAa,CAIpDG,IAAK,WACD,OAAOjC,KAAKosB,WAAWppB,KAC3B,EACAqnB,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,WAAY,CAInDG,IAAK,WACD,OAAOjC,KAAK2sB,SAChB,EACAtC,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,UAAW,CAIlDG,IAAK,WACD,MAAO,CAAC,KAAM,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,IAChD,EACAooB,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,WAAY,CAInDG,IAAK,WACD,OAAOjC,KAAKqsB,SAChB,EACAhC,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,WAAY,CAInDG,IAAK,WACD,OAAOjC,KAAKitB,SAChB,EACA5C,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,gBAAiB,CAIxDG,IAAK,WACD,OAAQjC,KAAKktB,SAAWltB,KAAKktB,QAAQrY,UAAa,oBACtD,EACAwV,YAAY,EACZD,cAAc,IAElBppB,OAAOC,eAAe8pB,EAAUjpB,UAAW,kBAAmB,CAI1DG,IAAK,WACD,OAAQjC,KAAKktB,SAAWltB,KAAKktB,QAAQC,YAAe,gBACxD,EACA9C,YAAY,EACZD,cAAc,IAKlBW,EAAUjpB,UAAU0V,KAAO,SAAUuV,GACjC,OAAO/sB,KAAK8sB,OAAO7qB,IAAI8qB,EAC3B,EAIAhC,EAAUjpB,UAAUsrB,cAAgB,SAAUC,GAC1C,OAAOrtB,KAAKisB,QAAQmB,cAAcC,EACtC,EAIAtC,EAAUjpB,UAAUwrB,eAAiB,SAAUD,GAC3C,OAAOrtB,KAAKksB,aAAaqB,SAASF,EACtC,EAIAtC,EAAUjpB,UAAU4B,cAAgB,SAAUZ,GAC1C,OAAQ9C,KAAK2sB,UAAU7pB,IAAY9C,KAAK2sB,UAAU3sB,KAAK2sB,UAAU/pB,OAAS,IAAIyqB,IAClF,EAIAtC,EAAUjpB,UAAU0rB,cAAgB,SAAUC,GAC1C,OAAOztB,KAAKisB,QAAQuB,cAAcC,EACtC,EAIA1C,EAAUjpB,UAAU4rB,kBAAoB,SAAUD,GAC9C,OAAOztB,KAAKstB,eAAettB,KAAKwtB,cAAcC,GAClD,EAIA1C,EAAUjpB,UAAU6rB,UAAY,SAAUN,GACtC,OAAOrtB,KAAKisB,QAAQ0B,UAAUN,EAClC,EAIAtC,EAAUjpB,UAAU8rB,kBAAoB,SAAUP,GAC9C,OAAOrtB,KAAKksB,aAAa2B,MAAMR,EACnC,EAIAtC,EAAUjpB,UAAUgsB,cAAgB,SAAUT,GAC1C,OAAOrtB,KAAKmsB,SAAS4B,OAAOV,EAChC,EAMAtC,EAAUjpB,UAAUksB,WAAa,SAAUnkB,GACvC,IAAIokB,EAAKnC,EACLoC,EAAc,CAAC,EACnB,IACI,IAAK,IAAIC,EAAK3D,EAASxqB,KAAKqrB,OAAQ+C,EAAKD,EAAGxD,QAASyD,EAAGxD,KAAMwD,EAAKD,EAAGxD,OAAQ,CAE1EuD,EADWE,EAAGjtB,MACGktB,SAAU,CAC/B,CAQJ,CANA,MAAOC,GAASL,EAAM,CAAEpqB,MAAOyqB,EAAS,CACxC,QACI,IACQF,IAAOA,EAAGxD,OAASkB,EAAKqC,EAAGI,SAASzC,EAAGvV,KAAK4X,EAEhB,CAApC,QAAU,GAAIF,EAAK,MAAMA,EAAIpqB,KAAO,CACxC,CACA,OAAgB,QAAZgG,GAAsBqkB,EAAY,IAASA,EAAY,MAE3C,SAAZrkB,GAAuBqkB,EAAY,IAASA,EAAY,MAE5C,UAAZrkB,GAAwBqkB,EAAY,IAASA,EAAY,IAEtD,KALI,IAMf,EACAnD,EAAUjpB,UAAUkqB,cAAgB,SAAUZ,EAAUF,GACpD,IAAIsD,EAAQxD,EAASnlB,QAAQ2oB,MAAMpD,GAC/BhJ,EAwIZ,SAAiBgJ,GACb,IAAIqD,EAAK3C,EACT,IACI,IAAK,IAAI4C,EAAalE,EAASY,GAAWuD,EAAeD,EAAW/D,QAASgE,EAAa/D,KAAM+D,EAAeD,EAAW/D,OAAQ,CAC9H,IAAIoC,EAAO4B,EAAaxtB,MACxB,GAAoB,MAAhB4rB,EAAKsB,QAAkC,MAAhBtB,EAAKsB,OAC5B,MAAO,IAEf,CAQJ,CANA,MAAOO,GAASH,EAAM,CAAE5qB,MAAO+qB,EAAS,CACxC,QACI,IACQD,IAAiBA,EAAa/D,OAASkB,EAAK4C,EAAWH,SAASzC,EAAGvV,KAAKmY,EAE5C,CAApC,QAAU,GAAID,EAAK,MAAMA,EAAI5qB,KAAO,CACxC,CACA,MAAO,IACX,CA1JmBgrB,CAAQzD,GAWnB,GAV8B,QAA1BF,EAAcrhB,UACd2kB,EAAQA,EAAM9tB,KAAI,SAAUqsB,GACxB,OAAIA,EAAKsB,QAA0B,OAAhBtB,EAAKsB,OACbrtB,OAAO8tB,OAAO,CAAC,EAAG/B,EAAM,CAAEsB,OAAQ,OAGlCtB,CAEf,KAES,OAAT3K,EAAe,CACf,IAAI2M,EAAmB,CAAC,IAAK,IAAK,IAAK,IAAK,IAAK,IAAK,KAClDC,EAAY,SAAUC,GAAU,OAAO,SAAUlC,GACjD,GAAIA,EAAKsB,OAAQ,CACb,IAAIa,EAAQH,EAAiB/kB,QAAQ+iB,EAAKsB,QAC1C,GAAIa,GAAS,EAAG,CACZ,IAAIC,EAAWD,EAAQD,GACvB,EAAIhE,EAAYplB,SAASspB,EAAWJ,EAAiBnsB,OAAQ,yDAC7D,IAAIwsB,EAAYL,EAAiBI,GACjC,OAAOnuB,OAAO8tB,OAAO,CAAC,EAAG/B,EAAM,CAAEsB,OAAQe,GAC7C,CACJ,CACA,OAAOrC,CACX,CAAG,EAC2B,QAA1B7B,EAAcrhB,QACd2kB,EAAQA,EAAM9tB,IAAIsuB,EAAU,IAEG,UAA1B9D,EAAcrhB,UACnB2kB,EAAQA,EAAM9tB,IAAIsuB,EAAU,IAEpC,CACA,OAAOR,EAAMrtB,OACjB,EACA4pB,EAAUjpB,UAAUyqB,8BAAgC,SAAUnB,GAC1D,IAAID,EAAQnrB,KACRqvB,EAAS,EACb,OAAOjE,EACFkE,QAAO,SAAUvC,GAAQ,OAAOA,EAAKsB,MAAQ,IAC7C3tB,KAAI,SAAUqsB,GACf,IAAIhe,EAAOoc,EAAMoE,eAAexC,EAAKM,MAcrC,OAbAte,EAAK6H,GAAKyY,IACVtgB,EAAKsf,OAAStB,EAAKsB,OACnBtf,EAAKygB,SAAWzC,EAAKyC,SACrBzgB,EAAK0gB,cAAgB1C,EAAK0C,cAC1B1gB,EAAK2gB,YAAc3C,EAAK2C,YACxBvE,EAAMwE,gBAAgB5gB,QACDiH,IAAjB+W,EAAK6C,SACL7gB,EAAK+C,IAAMqZ,EAAMoE,eAAexC,EAAK6C,SACrCzE,EAAMwE,gBAAgB5gB,EAAK+C,MAG3B/C,EAAK+C,SAAMkE,EAERjH,CACX,GACJ,EACAgc,EAAUjpB,UAAU+tB,0BAA4B,SAAUzE,GACtD,IAAID,EAAQnrB,KACRqvB,EAAS,EACb,OAAOjE,EACFkE,QAAO,SAAUvC,GAAQ,OAAOA,EAAKsB,MAAQ,IAC7C3tB,KAAI,SAAUqsB,GACf,IAAIhe,EAAOoc,EAAMoE,eAAexC,EAAKM,MAIrC,OAHAte,EAAK6H,GAAKyY,IACVtgB,EAAKsf,OAAStB,EAAKsB,OACnBlD,EAAMwE,gBAAgB5gB,GACfA,CACX,GACJ,EACAgc,EAAUjpB,UAAU6tB,gBAAkB,SAAUG,GACxCA,EAAMroB,KAAOzH,KAAKqsB,YAClBrsB,KAAKqsB,UAAYyD,EAAMroB,KAC/B,EACAsjB,EAAUjpB,UAAU4qB,mCAAqC,SAAUtB,GAC/D,IAAID,EAAQnrB,KACZ,OAAOorB,EACFkE,QAAO,SAAUvC,GAAQ,OAAQA,EAAKsB,MAAQ,IAC9C3tB,KAAI,SAAUqsB,GACf,IAAIhe,EAAOoc,EAAMoE,eAAexC,EAAKM,MAIrC,OAHAte,EAAKygB,SAAWzC,EAAKyC,SACrBzgB,EAAK0gB,cAAgB1C,EAAK0C,cAC1B1gB,EAAK2gB,YAAc3C,EAAK2C,YACjB3gB,CACX,GACJ,EACAgc,EAAUjpB,UAAU+qB,uBAAyB,SAAUtB,GACnD,IAAIwE,EAAKjE,EAAIkE,EAAK7B,EACd/rB,EAAM,IAAI0a,IACd,IACI,IAAK,IAAIsR,EAAK5D,EAAS,CAACxqB,KAAKqrB,MAAOrrB,KAAKiwB,QAASC,EAAK9B,EAAGzD,QAASuF,EAAGtF,KAAMsF,EAAK9B,EAAGzD,OAAQ,CACxF,IAAIwF,EAAQD,EAAG/uB,MACf,IACI,IAAK,IAAIivB,GAAWJ,OAAM,EAAQxF,EAAS2F,IAASE,EAAYD,EAAQzF,QAAS0F,EAAUzF,KAAMyF,EAAYD,EAAQzF,OAAQ,CACzH,IAAI2F,EAASD,EAAUlvB,MACnB+M,EAAOqd,EAAUtpB,IAAIquB,EAAOd,UAC5BthB,GACA9L,EAAIK,IAAIyL,EAChB,CAQJ,CANA,MAAOqiB,GAASP,EAAM,CAAEnsB,MAAO0sB,EAAS,CACxC,QACI,IACQF,IAAcA,EAAUzF,OAASuD,EAAKiC,EAAQ7B,SAASJ,EAAG5X,KAAK6Z,EAEnC,CAApC,QAAU,GAAIJ,EAAK,MAAMA,EAAInsB,KAAO,CACxC,CACJ,CAQJ,CANA,MAAO2sB,GAAST,EAAM,CAAElsB,MAAO2sB,EAAS,CACxC,QACI,IACQN,IAAOA,EAAGtF,OAASkB,EAAKsC,EAAGG,SAASzC,EAAGvV,KAAK6X,EAEhB,CAApC,QAAU,GAAI2B,EAAK,MAAMA,EAAIlsB,KAAO,CACxC,CACA,OAAOolB,MAAMwH,KAAKruB,EACtB,EACA2oB,EAAUjpB,UAAU8qB,uBAAyB,SAAU8D,GACnD,IAAIvF,EAAQnrB,KACZ,OAAO0wB,EAAMhwB,KAAI,SAAU2sB,GAAQ,OAAOlC,EAAMoE,eAAelC,EAAO,GAC1E,EACAtC,EAAUjpB,UAAUytB,eAAiB,SAAUlC,GAC3C,MAAO,CACHA,KAAMA,EACN5lB,KAAMzH,KAAKotB,cAAcC,GACzBE,SAAUvtB,KAAKstB,eAAeD,GAEtC,EACAtC,EAAUjpB,UAAUkrB,aAAe,SAAUD,GACzC,MAAO,CAAE4D,OAAQ5D,EAAKjb,IAAM,EAAI,EACpC,EACOiZ,CACX,CApW8B,GAqW9B7pB,EAAQ6pB,UAAYA,EACpB7pB,EAAQ2E,QAAUklB,C,uBC3YlB,IAAI6F,EAAU,EAAQ,MAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAAChrB,EAAO5D,EAAI4uB,EAAS,MAOhE,IAAIrrB,EAAU,CAAC,KAAM,EAErBA,UAPIsrB,UAQJtrB,gBAAqByQ,GAER,EAAQ,EAAR,CAAsH4a,EAASrrB,GAEzIqrB,EAAQE,SAAQlrB,EAAO1E,QAAU0vB,EAAQE,O,wBCjBlClrB,EAAO1E,QAAU,EAAQ,EAAR,EAA8H,IAKjJoB,KAAK,CAACsD,EAAO5D,EAAI,w8CAAy8C,I,mCCLl+C,sGAKA,MAAM+uB,EAEA,KAFAA,GAIC,IAJDA,EAMD,KANCA,EAQA,MARAA,EAUA,MAVAA,EAgBD,IAhBCA,EAkBD,GAeE,SAASC,EAAOzD,GACrB,MAAM0D,EAASzrB,KAAK+V,IAAI,EAAGgS,EAAW,GAClCA,EAAW,IAAGA,EAAW,GACzBA,EAAW,IAAGA,EAAW,GAC7B,MAAM2D,EAAQH,GAAaA,EAAYA,GAAaxD,EAC9C4D,EAASJ,EAAYvrB,KAAK4rB,IAAIF,GAASH,EACvCM,EAASN,EAAYvrB,KAAK8rB,IAAIJ,GAASH,EACvCQ,EAAaR,GAAYA,EAAWI,GAE1C,MAAO,CAAEK,EADOH,EAASE,EAAa,IACP,KAATN,EAAeM,aACvC,CAMO,MAAME,EAAkBV,EASxB,SAASW,EAAiBC,EAAGH,GAClC,IAEII,EACAC,EAHA7oB,EAAM,IACNuS,EAAM,EAGV,IAAK,IAAIvZ,EAAI,EAAGA,EAAI,EAAGA,IACrB4vB,GAAO5oB,EAAMuS,GAAO,EACpBsW,EAAMb,EAAOY,GACTC,EAAIL,EAAIA,EACVjW,EAAMqW,EAEN5oB,EAAM4oB,EAGV,GAAIA,EAAM,GAAK,OAAO,KACtB,MAAME,EAAK,IAAWD,EAAIN,YAAcR,EAClCgB,EAAK,IAAWF,EAAIN,WAAaR,EACvC,IAAIiB,EAAMxsB,KAAKC,OAAQksB,EAAIG,IAAOC,EAAKD,GAAO,GAC9C,OAAIE,IAAQ,GAAKA,GAAO,GAClBA,EAAM,IAAGA,EAAM,GACfA,EAAM,IAAGA,EAAM,GACZC,OAAOD,EAAM,IAEf,IACT,C,qHCnFe,MAAM,UAAuB,IAAMpf,UAKhDhT,YAAYqT,GACVif,MAAMjf,GA+BR,KAAAkf,YAAc,KACZ,MAAMrkB,EAAQ9N,KAAKiT,MAAMmf,MAAMtkB,MAC/B,OACE,+BACE,+BACG9M,OAAOohB,KAAKtU,GAAOpN,KAAK2B,IACvB,MAAMgwB,EAAOvkB,EAAMzL,GACnB,OACE,4BACE,4BACE,gCAASA,IAEX,wBAAIiwB,MAAM,SAAS,GAAKD,GAE3B,KAIR,EAGH,KAAAE,kBAAqB3lB,IACnBA,EAAEE,iBACFF,EAAEG,kBACF/M,KAAKwyB,SAAS,CAAEC,MAAOzyB,KAAK+G,MAAM0rB,MAAO,EAtDzCzyB,KAAK+G,MAAQ,CACX0rB,MAAM,EACNpxB,KAAM,MAEV,CAEAwR,SACE,OACE,yBACEC,UAAU,iBACV4f,QAAS1yB,KAAKuyB,kBACdI,aAAc3yB,KAAKuyB,mBAElBvyB,KAAK+G,MAAM0rB,KACV,iCACE,8CACA,6BACCzyB,KAAKmyB,eAEN,uBAKV,CAEAze,oBACEhG,aAAY,IAAM1N,KAAK4T,eAAe,IACxC,ECjCF,SAASgf,IACP,IAAIjvB,EAAM,EACNkvB,EAAQ,EACRC,EAAU,EACd,MAAMC,EAAO,GACb,IAAIC,EAAU,EACVC,EAAS,EACb,MAAO,CACL3wB,KAAM,SAAUgF,GACd,MAAMR,EAAI,OAAAO,EAAA,KAMV,IALA1D,GAAO2D,EACPurB,GAAS,EACTC,EAAUnvB,EAAMkvB,EAChBG,GAAW1rB,EACXyrB,EAAKzwB,KAAK,CAAEgF,QAAOG,KAAMX,IAClBisB,EAAK,IAAMA,EAAK,GAAGtrB,KAAOX,EAAI,KACnCksB,GAAWD,EAAKvrB,QAAQF,MAE1B2rB,EAASD,EAAUD,EAAKnwB,MAC1B,EACAiN,SAAQ,IACC8H,EAAOmb,GAAW,MAAQnb,EAAOsb,GAG9C,CAEA,SAAStb,EAAOga,GACd,OAAOA,EAAE5Y,QAAQ,GAAK,IACxB,CD7BS,EAAA7F,UAAY,CACjBkf,MAAO,IAAU1vB,QCwEN,IAAA6G,OAAO+L,iBAAmB,cACrC,IA3CJ,WACE,MAAMxH,EAAQ,CAAC,EACTskB,EAAQ,CACZhlB,SAAS,EACTU,QACAolB,KAAI,CAAClf,EAAOzE,IACH,WACL,MAAMzE,EAAQ,OAAAzD,EAAA,KACd,IACE,OAAOkI,EAAE4jB,MAAMnzB,KAAMozB,U,SAErB,MAAMrhB,EAAS,OAAA1K,EAAA,MACFyG,EAAMkG,KAAWlG,EAAMkG,GAAS,IAAI4e,EAAK5e,KACjD1R,KAAKyP,EAASjH,E,CAEvB,EAEFuC,UAAU2G,EAAO+K,EAAK1e,GACpB0e,EAAI1e,GAAQL,KAAKkzB,KAAKlf,EAAO+K,EAAI1e,GACnC,EACAwP,WACE,MAAMwjB,EAAQ,GAId,OAHAryB,OAAOohB,KAAKtU,GAAOqW,SAAQ,SAAU9hB,GACnCgxB,EAAM/wB,KAAK,KAAOD,EAAM,KAAOyL,EAAMzL,GACvC,IACOgxB,EAAMxyB,KAAK,KACpB,GAEIyyB,EAAM/hB,SAASC,cAAc,OAInC,OAHA8hB,EAAIC,aAAa,QAAS,oDAC1BhiB,SAASiiB,KAAK1e,YAAYwe,GAC1B,IAASzgB,OAAO,kBAAC,EAAc,CAACuf,MAAOA,IAAWkB,GAC3ClB,CACT,EAWI,IATJ,WACE,MAAO,CACLhlB,SAAS,EACT8lB,KAAM,CAAClf,EAAOzE,IAAMA,EAExB,C,sLCrEA,MAAM,UAA4B,IAAMqD,UAMtChT,YAAYqT,GACVif,MAAMjf,GA4CR,KAAAwgB,WAAc7mB,IACZA,EAAEE,iBACF,MAAMgjB,EAAQljB,EAAE8mB,YACVC,EAAY,IAAI,IAAa7D,GACnC6D,EAAU3L,SACP7Z,MAAMhL,GACEA,EAAKmsB,QAAQrhB,GAAa,oBAAoBpL,KAAKoL,OAE3DvN,KAAKL,GACJszB,EAAUzlB,KAAK7N,GAAM8N,MAAMylB,IAAa,CAAGvzB,OAAMuzB,iBAElDzlB,MAAMa,IACLhP,KAAKwyB,SAAS,CAAE3L,MAAO7X,EAAK2kB,UAAWA,GAAY,IAEpDlX,OAAOlF,IACN,KAA6B,cAAzBA,EAAI3X,YAAYS,KACZ,IAAIyD,MAAM,mBAAqB8I,EAAEinB,MAEjCtc,C,GAER,EAGN,KAAAuc,gBAAmB5lB,GACV,KACLlO,KAAKiT,MAAM8gB,SAAS/zB,KAAK+G,MAAM4sB,UAAWzlB,EAAK0lB,SAAS,EAI5D,KAAAI,YAAc,KACZh0B,KAAKiT,MAAM8gB,SAAS,KAAM,KAAK,EAzE/B/zB,KAAK+G,MAAQ,CACX8f,MAAO,GAEX,CAEAhU,SACE,MAAMgU,EAAQ7mB,KAAK+G,MAAM8f,MACzB,OACE,yBAAK/T,UAAU,aACZ+T,EAAMjkB,OACL,4BACGikB,EAAMnmB,KAAKwN,GACV,4BACE,uBACEnN,KAAK,gBACL2xB,QAAS1yB,KAAK8zB,gBACdhhB,UAAW,IAAE,CACX,YAAa5E,EAAK0lB,WAAa5zB,KAAKiT,MAAMghB,oBAG3C/lB,EAAK7N,SAIXL,KAAKiT,MAAMghB,iBACV,4BACE,uBAAGlzB,KAAK,gBAAgB2xB,QAAS1yB,KAAKg0B,aAAW,UAIjD,MAGN,yBAAKlhB,UAAU,kB,uBAEb,6B,iCAMV,EAhDO,EAAAI,UAAY,CACjB+gB,iBAAkB,IAAUC,IAC5BH,SAAU,IAAU7e,MAkFT,MAAM,UAAuB,IAAMtC,UAMhDhT,YAAYqT,GACVif,MAAMjf,GAkFR,KAAAkhB,OAAUvnB,IACRA,EAAEE,iBACF9M,KAAKiT,MAAM4H,KAAK7a,KAAK+G,MAAMxB,QAAQ,EAGrC,KAAA6uB,WAAcC,GACJvE,IACNuE,EAAOr0B,KAAK+G,MAAMxB,QAASuqB,EAAM7J,OAAO9kB,OACxCnB,KAAK4T,aAAa,EAItB,KAAA0gB,eAAkB1nB,IAChBA,EAAEE,gBAAgB,EAGpB,KAAA2mB,WAAc7mB,IACZA,EAAEE,iBACF9M,KAAK4U,KAAK2f,SAASd,WAAW7mB,EAAE,EAGlC,KAAA4nB,iBAAmB,CAACb,EAAWC,KAC7B5zB,KAAKwyB,SAAS,CACZjtB,QAASvE,OAAO8tB,OAAO9uB,KAAK+G,MAAMxB,QAAS,CAAEouB,YAAWC,eAE1D5zB,KAAK4T,aAAa,EA1GlB5T,KAAK+G,MAAQ,CACXxB,QAASvF,KAAKiT,MAAM1N,QAExB,CAEAsN,SACE,MAAMtN,EAAUvF,KAAK+G,MAAMxB,QAC3B,OACE,yBACEuN,UAAU,iBACV2hB,WAAYz0B,KAAKs0B,eACjBI,OAAQ10B,KAAKyzB,YAEb,iDACA,qFACA,0BAAMkB,SAAU30B,KAAKm0B,QACnB,yBAAKrhB,UAAU,QACb,+BACE,0BAAMA,UAAU,SAAO,YACvB,2BACE2S,KAAK,OACLmP,SAAUrvB,EAAQquB,SAClBiB,SAAU70B,KAAKo0B,YAAW,CAAC3c,EAAGqL,IAAOrL,EAAE5X,IAAMijB,IAC7C3hB,MAAOoE,EAAQ1F,QAIrB,yBAAKiT,UAAU,QACb,+BACE,0BAAMA,UAAU,SAAO,6BACvB,kBAAC,EAAmB,CAClB2B,IAAI,WACJwf,iBAAkB1uB,EAAQquB,SAC1BG,SAAU/zB,KAAKw0B,qBAIrB,yBAAK1hB,UAAU,QACb,+BACE,0BAAMA,UAAU,SAAO,uBACvB,2BACE2S,KAAK,OACLoP,SAAU70B,KAAKo0B,YACb,CAAC3c,EAAGqL,IAAOrL,EAAE3R,KAAKqF,kBAAoB2X,IAExC3hB,MAAOoE,EAAQO,KAAKqF,sBAI1B,yBAAK2H,UAAU,QACb,+BACE,0BAAMA,UAAU,SAAO,aACvB,2BACE2S,KAAK,OACLoP,SAAU70B,KAAKo0B,YAAW,CAAC3c,EAAGqL,IAAOrL,EAAEjR,QAAQ,GAAGqnB,MAAQ/K,IAC1D3hB,MAAOoE,EAAQiB,QAAQ,GAAGqnB,UAIhC,yBAAK/a,UAAU,SACb,yCACC,CAAC,OAAQ,SAAU,SAASpS,KAAKo0B,GAChC,+BACE,2BACErP,KAAK,QACLtkB,MAAO2zB,EACPD,SAAU70B,KAAKo0B,YACb,CAAC3c,EAAGqL,IAAOrL,EAAEjR,QAAQ,GAAGsuB,UAAYhS,IAEtCiS,QAASxvB,EAAQiB,QAAQ,GAAGsuB,YAAcA,IAE5C,0BAAMhiB,UAAU,SAASgiB,OAI/B,4BAAQrP,KAAK,UAAQ,SAI7B,EAtFO,EAAAvS,UAAY,CACjB3N,QAAS,IAAU7C,OACnBmY,KAAM,IAAU3F,M,kECjFbhV,eAAe80B,IAEpBzrB,OAAOxE,iBAAiB,cAAc,SAAS4B,IAC7C,YAAY,KACZ4C,OAAOzE,oBAAoB,aAAc6B,EAC3C,IAEA,MA2DMsuB,QA/CU/0B,iBACd,MAAMyJ,GAAO+U,EAAA,EAAM9U,UAAY,IAAInJ,MAAM,KAAKC,KAAKixB,IAAOA,IAC1D,IAAIpsB,EAAU,CACZ1F,IAAK6e,EAAA,EAAM1P,KAAO,kCAClBlJ,KAAM,CACJqF,mBAAoBuT,EAAA,EAAMwW,SAAW,GAEvC1uB,QAAS,CACP,CACEqnB,OAAQnP,EAAA,EAAMmP,OAAS,EACvBsH,WAAYzW,EAAA,EAAMyW,SAClBL,UAAW,SACXjrB,QAAS6U,EAAA,EAAM7U,SAAW,OAC1BlC,MAAO,CACLiC,SAAU,CACR,EAAGD,EAAI,IAAM,GACb,EAAGA,EAAI,IAAM,GACb,EAAGA,EAAI,IAAM,GACb,EAAGA,EAAI,IAAM,GACb,EAAGA,EAAI,IAAM,GACb,EAAGA,EAAI,IAAM,GACb,EAAGA,EAAI,IAAM,GACbyrB,GAAIzrB,EAAI,IAAM,GACd0rB,IAAK1rB,EAAI,IAAM,QAMzBpE,QAzCmB,SAAUA,GAC7B,OAAO,IAAIpF,SAAQ,SAAUC,GAC3B,MAAM4U,EAAQ,IAAMxD,cAAc,EAAgB,CAChDjM,QAASA,EACTsV,KAAM,SAAU3Q,GACd9J,EAAQ8J,EACV,IAEF,IAAce,QAAQ+J,EACxB,GACF,CA+BkBsgB,CAAa/vB,GAC7B,MAAM1F,EAAM0F,EAAQ1F,IACd01B,EAAY,qBAAW11B,EAAK,WAQlC,MAAO,CACLmP,IAAKzJ,EAAQquB,UAAY,IAAI,IAAY/zB,GACzCmO,OAAQzI,EAAQouB,WAAa,IAAI,IAAuB4B,GACxDC,SAVe,CACfxhB,MAAO,UACPC,UAAW,GACXC,OAAQ,GACRH,MAAO,GACPI,WAAY,IAMZ5O,QAASvE,OAAO8tB,OAAO,CAAC,EAAGvpB,EAAQO,KAAM,CAAEU,QAASjB,EAAQiB,UAEhE,CAEuBivB,IACjB,MAAEvmB,EAAK,QAAEjD,GAAY,OAAgBgpB,SACrC,IAAchqB,QAClB,IAAMuG,cAAckkB,EAAA,EAAc,CAChCxmB,MAAOA,EACP4E,KAAMmhB,EAASO,YAGnB,MAAMG,QAAmB1pB,QACnB,IAAchB,QAAQ,IAAI,IAAU0qB,EAAW1qB,UACrD0qB,EAAW7qB,OACb,C,mCC3FA,8CAoGO,MAAMoS,EAAW,IArEjB,MACLtd,cACEI,KAAK41B,gBAAiB,EACtB51B,KAAK61B,OAAS,EAChB,CAIA5qB,QAAQ+J,GACN,OAAOhV,KAAK81B,eAAc,IACjB9gB,GAEX,CAGA1S,KAAK0S,GACH,MAAM+gB,EAAgB/1B,KAAKg2B,aAC3B,OAAOh2B,KAAK81B,eAAc,KACxB91B,KAAK61B,OAAOvzB,KAAKyzB,GACV/gB,IAEX,CAGAsO,MACE,OAAOtjB,KAAK81B,eAAc,IACjB91B,KAAK61B,OAAOvS,OAEvB,CAEApjB,oBAAoB+1B,GAClB,GAAIj2B,KAAK41B,eAAgB,MAAM,IAAI9xB,MAAM,2BACzC,IACE9D,KAAK41B,gBAAiB,EAGlB51B,KAAKk2B,6BACD/1B,QAAQC,QAAQJ,KAAKk2B,qBAAqBC,YAyBxD,SAAgBhkB,GACVA,GAAWA,EAAQikB,aAAe,KACpC,IAAKC,YAAYlkB,EAErB,CA5BQmkB,CAAOt2B,KAAKu2B,iBAId,IAAIvhB,EAAQihB,IAGS,mBAAVjhB,IACTA,EAAQ,IAAIwhB,EAAWxhB,EAAOhV,KAAKy2B,sBAIrC,MAAMtkB,EAAUZ,SAASC,cAAc,OACvCW,EAAQW,UAAY,uBACpB,IAAKgC,YAAY3C,GACjBnS,KAAKu2B,eAAiBpkB,EACtBnS,KAAKg2B,aAAehhB,EACpBhV,KAAKk2B,qBAAuBlhB,EAAM7C,E,SAElCnS,KAAK41B,gBAAiB,C,CAE1B,GAcF,SAASY,EAAWrkB,EAASskB,GAC3B,OAAO,SAAqBC,GAC1B,IAAIP,EAAWj2B,YACf,MAAMy2B,EAAgB,IAAMC,aAAazkB,EAAS,CAChD6C,MAAO7C,EACP4C,yBAA2BtT,IACzB00B,EAAW10B,CAAQ,IAGjBo1B,EAAmBJ,EACvB,kBAACA,EAAmB,KAAEE,GACpB,EAIJ,OADA,IAAS9jB,OAAOgkB,EAAkBH,GAC3B,CACLx2B,iBACE,IACE,aAAai2B,G,SAEb,IAASW,uBAAuBJ,E,CAEpC,EAEJ,CACF,CA3Be,K,mCCrGf11B,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ61B,6BAA+B71B,EAAQ81B,UAAY91B,EAAQpB,UAAO,EAC1E,IAAIm3B,EAAU,EAAQ,KAItB/1B,EAAQpB,KAHR,SAAcib,GACV,MAAM,IAAIjX,MAAM,2CACpB,EAqBA5C,EAAQ81B,UAnBR,WAEI,IADA,IAAItgB,EAAO,GACFwgB,EAAK,EAAGA,EAAK9D,UAAUxwB,OAAQs0B,IACpCxgB,EAAKwgB,GAAM9D,UAAU8D,GAEzB,IAAInc,EAASrE,EAAK,GACdnR,EAAUmR,EAAK,GACfygB,EAAW5xB,GAAWA,EAAQ6xB,eAAkBH,EAAQI,OAAOtc,GACnE,OAAO,IAAI5a,SAAQ,SAAUC,EAASmE,GAClC,IAAI+yB,EAAS,IAAIC,WACjBD,EAAO1oB,OAAS,WACZxO,EAAQk3B,EAAOntB,OACnB,EACAmtB,EAAOzoB,QAAU,WACbtK,EAAO,IAAIT,MAAM,kBACrB,EACAwzB,EAAOE,WAAW,IAAIlpB,KAAK,CAACyM,IAAUoc,EAC1C,GACJ,EAEA,IAAIM,EAAiC,EAAQ,KAC7Cz2B,OAAOC,eAAeC,EAAS,+BAAgC,CAAEmpB,YAAY,EAAMpoB,IAAK,WAAc,OAAOw1B,EAA+BV,4BAA8B,G,mCC5B1K/1B,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ61B,kCAA+B,EAkBvC71B,EAAQ61B,6BAbR,SAAsC9oB,GAClC,IAAImpB,EAUJ,OATInpB,EAAS7M,MAAM,mBACfg2B,EAAgB,aAEhBnpB,EAAS7M,MAAM,qBACfg2B,EAAgB,UAEhBnpB,EAAS7M,MAAM,mBACfg2B,EAAgB,SAEb,CAAEA,cAAeA,EAC5B,C,mCClBAp2B,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQw2B,aAAU,EAIlB,IAAIC,EAAU,EAAQ,KAClBC,EAAU,EAAQ,IAClBC,EAAW,CACX7oB,IAAK,CACDtJ,OAAQ,qBACRoyB,GAAI,iBACJC,MAAO,YACPC,cAAe,sBACfr1B,QAAS,sCACTs1B,OAAQ,0BAEZC,IAAK,CACDxyB,OAAQ,qBACRoyB,GAAI,iBACJC,MAAO,YACPC,cAAe,yBACfr1B,QAAS,yCACTs1B,OAAQ,4BAuGhB/2B,EAAQw2B,QA9FR,SAAiBr2B,EAAMkE,GACnBA,EAAUA,GAAW,CAAC,EACtB,IAAI4yB,EAAQ,IAAIP,EAAQQ,SACpBC,EAAM9yB,EAAQ8yB,KACd,SAAU9c,GACN,OAAO,EAAI/V,KAAKC,MAAMD,KAAKE,SAAW6V,EAC1C,EACA+c,EAAW/yB,EAAQoS,QAAUkgB,EAAStyB,EAAQoS,SAAYkgB,EAAS7oB,IACnEupB,EAAc,GACdC,EAAY,EAAC,GACbruB,EAAS,CACTsuB,gBAAiB,EACjBC,iBAAkB,EAClBC,iBAAkB,EAClBC,iBAAkB,EAClBC,mBAAoB,EAIpBV,MAAOA,EAIPW,SAAU,IA6Cd,OA2BJ,SAAkBz3B,EAAMI,GACpBJ,EACKZ,MAAM,cACNC,KAAI,SAAUq4B,GACf,OAAOA,EAAKxY,MAChB,IACK4D,SAAQ,SAAU4U,EAAM7J,GACzBztB,EAASs3B,EAAM7J,EAAQ,EAC3B,GACJ,CA/EI8J,CAAS33B,GAAM,SAAUA,EAAM43B,GAC3B,IAAIC,GAAO,EACX,GAAuB,MAAnB73B,EAAKihB,OAAO,MAEhB,EAAIqV,EAAQv2B,OAAOC,GACdE,KAAK+2B,EAAQ5yB,QAAQ,SAAUokB,GAChC3f,EAAOwuB,kBAAoB,EAC3BJ,EAAYj2B,KAAK+1B,GAAKvO,EAAE,IAC5B,IACKvoB,KAAK+2B,EAAQR,IAAI,SAAUhO,GAC5B3f,EAAOwuB,kBAAoB,EAC3BH,EAAUl2B,KAAKi2B,EAAYA,EAAY31B,OAAS,MAAQknB,EAAE,GAC9D,IACKvoB,KAAK+2B,EAAQP,OAAO,SAAUjO,GAC/B3f,EAAOwuB,kBAAoB,EAC3BH,EAAUlV,KACd,IACK5hB,MAAK,WACNw3B,GAAO,CACX,KACIA,GAAJ,CAEA,IAAIC,EAAUX,EAAUA,EAAU51B,OAAS,IAC3C,EAAI+0B,EAAQv2B,OAAOC,GACdE,KAAK+2B,EAAQN,eAAe,SAAUlO,GACvC3f,EAAOuuB,kBAAoB,EACtBS,GACDhB,EAAMiB,eAAeh3B,KAAK0nB,EAAE,IAAKA,EAAE,GAC3C,IACKvoB,KAAK+2B,EAAQ31B,SAAS,SAAUmnB,GACjC3f,EAAOuuB,kBAAoB,EACtBS,GAab,SAA+Br2B,EAASH,EAASyQ,EAAQ6lB,GACrD,IAAII,EAAQ7zB,KAAKC,MAAM2N,EAAOxQ,OAAS,GACvC,GAAc,IAAVy2B,EACA,OACJ,IAAK,IAAIr3B,EAAI,EAAGA,EAAIq3B,EAAOr3B,IAAK,CAC5B,IAAIb,EAAQiS,EAAOqN,OAAW,EAAJze,EAAO,GAC7Be,EAAWf,EAAIq3B,EACL,OAAVl4B,GAEJg3B,EAAMmB,QAAQ72B,IAAI,CACdK,QAASA,EACTC,SAAUA,EACV5B,MAAOA,EACPwB,QAASA,EACTs2B,WAAYA,GAEpB,CACJ,CA7BYM,EAAuBzP,EAAE,GAAIA,EAAE,GAAIA,EAAE,GAAImP,EACjD,IACK13B,KAAK+2B,EAAQL,QAAQ,SAAUnO,GAChC3f,EAAOsuB,iBAAmB,EACrBU,GACDhB,EAAMqB,QAAQp3B,IAAI0nB,EAAE,GAAIA,EAAE,GAClC,IACKpoB,MAAK,YAuBd,SAAcu3B,EAAYQ,GACtBtvB,EAAO2uB,SAASx2B,KAAK,CACjB22B,WAAYA,EACZQ,QAASA,GAEjB,CA3BQlnB,CAAK0mB,EAAY,kBACrB,GApBU,CAqBd,IACO9uB,CAyBX,C,mCC5HAnJ,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,G,mCCAtD,IAAI0pB,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQw4B,aAAU,EAClB,IAAIC,EAAmB9O,EAAgB,EAAQ,MAC/C3pB,EAAQw4B,SAAU,EAAIC,EAAiB9zB,SAAS,CAC5CiB,EAAG,SACH6qB,EAAG,SACHiI,GAAI,U,mCCTR,IAAIhQ,EAAmB5pB,MAAQA,KAAK4pB,kBAAqB5oB,OAAO6oB,OAAS,SAAUpS,EAAGqS,EAAGvI,EAAGwI,QAC7E/T,IAAP+T,IAAkBA,EAAKxI,GAC3B,IAAIyI,EAAOhpB,OAAOipB,yBAAyBH,EAAGvI,GACzCyI,KAAS,QAASA,GAAQF,EAAEI,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMpoB,IAAK,WAAa,OAAO6nB,EAAEvI,EAAI,IAE5DvgB,OAAOC,eAAewW,EAAGsS,EAAIC,EAChC,EAAI,SAAUvS,EAAGqS,EAAGvI,EAAGwI,QACT/T,IAAP+T,IAAkBA,EAAKxI,GAC3B9J,EAAEsS,GAAMD,EAAEvI,EACb,GACGsY,EAAsB75B,MAAQA,KAAK65B,qBAAwB74B,OAAO6oB,OAAS,SAAUpS,EAAGqL,GACxF9hB,OAAOC,eAAewW,EAAG,UAAW,CAAE4S,YAAY,EAAMlpB,MAAO2hB,GAClE,EAAI,SAASrL,EAAGqL,GACbrL,EAAW,QAAIqL,CACnB,GACIgX,EAAgB95B,MAAQA,KAAK85B,cAAiB,SAAUhP,GACxD,GAAIA,GAAOA,EAAIZ,WAAY,OAAOY,EAClC,IAAI3gB,EAAS,CAAC,EACd,GAAW,MAAP2gB,EAAa,IAAK,IAAIvJ,KAAKuJ,EAAe,YAANvJ,GAAmBvgB,OAAOc,UAAUyoB,eAAehU,KAAKuU,EAAKvJ,IAAIqI,EAAgBzf,EAAQ2gB,EAAKvJ,GAEtI,OADAsY,EAAmB1vB,EAAQ2gB,GACpB3gB,CACX,EACI0gB,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ64B,WAAQ,EAChB,IAAIC,EAAS,EAAQ,KACjB/O,EAAcJ,EAAgB,EAAQ,KACtCoP,EAAiBH,EAAa,EAAQ,MACtClC,EAAU,EAAQ,IA0BlBmC,EAAuB,WAIvB,SAASA,EAAM1O,GACXA,EAAMlH,QAAQ6V,EAAOE,MACrBl6B,KAAKssB,OAASjB,CAClB,CA2BA,OAtBA0O,EAAMj4B,UAAU+wB,MAAQ,WACpB,OAAO7yB,KAAKssB,OAAO1pB,MACvB,EAIAm3B,EAAMj4B,UAAUkB,IAAM,WAClB,OAAOhD,KAAKssB,OAAOrpB,OACvB,EAMA82B,EAAMI,aAAe,SAAUhC,EAAO5yB,GAC7BqyB,EAAQQ,SAEb,IAAIgC,GADJ70B,EAAUA,GAAW,CAAC,GACA60B,SAAWL,EAAMM,gBAAgBC,QAEvD,OADc,IAAIC,EAAepC,EAAO,CAAEiC,QAASA,IACpCI,OACnB,EACAT,EAAMM,gBAAkBJ,EACjBF,CACX,CAnC0B,GAoC1B74B,EAAQ64B,MAAQA,EAChB,IAAIQ,EAAgC,WAChC,SAASA,EAAepC,EAAO5yB,GAC3BvF,KAAKy6B,OAAStC,GACd,EAAIlN,EAAYplB,SAASN,EAAQ60B,QAAS,6BAC1C,EAAInP,EAAYplB,SAAoC,iBAApBN,EAAQ60B,QAAsB,kCAC9Dp6B,KAAK06B,SAAWn1B,EAAQ60B,QACxBp6B,KAAKssB,OAAS,GACdtsB,KAAK26B,UAAY,CAAC,EAClB36B,KAAK46B,UAAY,CAAC,EAClB56B,KAAK66B,QAAU76B,KAAKy6B,OAAOjB,QAAQv3B,IAAI,UAAY,IAAIC,cACvDlC,KAAK86B,gBAAkB96B,KAAK06B,SAC5B16B,KAAKwC,SAAWxC,KAAKy6B,OAAOnB,QAAQp2B,WACxC,CAwEA,OAvEAq3B,EAAez4B,UAAU04B,MAAQ,WAC7B,IAAIrP,EAAQnrB,KAIZ,OAHAA,KAAKwC,SAAS2hB,SAAQ,SAAUzhB,GAC5ByoB,EAAM4P,QAAQr4B,EAClB,IACO,IAAIq3B,EAAM/5B,KAAKssB,OAC1B,EACAiO,EAAez4B,UAAUi5B,QAAU,SAAUr4B,GACzC,GAAuB,OAAnBA,EAAOC,QACP3C,KAAKg7B,kBAAkBt4B,QAGvB,OAAQA,EAAOC,QAAQ2f,OAAO,GAAG2Y,eAC7B,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACDj7B,KAAKg7B,kBAAkBt4B,GACvB,MACJ,IAAK,IACL,IAAK,IACD1C,KAAKk7B,gBAAgBx4B,GAIrC,EACA63B,EAAez4B,UAAUk5B,kBAAoB,SAAUt4B,GACnD,IAAIC,EAAU3C,KAAKm7B,kBAAkBz4B,EAAOC,SACxC0qB,EAAOrtB,KAAKo7B,SAAS14B,GACzB,GAAIA,EAAOvB,MAAMe,gBAAkBlC,KAAK66B,OAChC76B,KAAK46B,UAAUj4B,KACf3C,KAAK46B,UAAUj4B,GAASitB,QAAUvC,OAGrC,CACD,IAAIN,EAAO,CACPM,KAAMA,EACNuC,aAAS5Z,EACTwZ,SAAU9sB,EAAOvB,MACjBktB,OAAQruB,KAAKq7B,WAAW14B,IAE5B3C,KAAK46B,UAAUj4B,GAAWoqB,EAC1B/sB,KAAKssB,OAAOhqB,KAAKyqB,EACrB,CACJ,EACAwN,EAAez4B,UAAUo5B,gBAAkB,SAAUx4B,GACjD,IAAIC,EAAU3C,KAAKm7B,kBAAkBz4B,EAAOC,SACxC0qB,EAAOrtB,KAAKo7B,SAAS14B,GACzB,GAAI1C,KAAK26B,UAAUh4B,GAAU,CACzB,IAAIoqB,EAAO/sB,KAAK26B,UAAUh4B,GAC1BoqB,EAAK6C,QAAUvC,EACfrtB,KAAKssB,OAAOhqB,KAAKyqB,UACV/sB,KAAK26B,UAAUh4B,EAC1B,MAEI3C,KAAK26B,UAAUh4B,GAAW,CACtB0qB,KAAMA,EACNmC,SAAU9sB,EAAOvB,MACjBktB,OAAQruB,KAAKq7B,WAAW14B,GAGpC,EACA43B,EAAez4B,UAAUs5B,SAAW,SAAU14B,GAC1C,OAAO1C,KAAKy6B,OAAO/2B,cAAchB,EAAOI,QAASJ,EAAOK,SAC5D,EACAw3B,EAAez4B,UAAUu5B,WAAa,SAAU14B,GAC5C,OAAO3C,KAAK86B,gBAAgBn4B,EAChC,EACA43B,EAAez4B,UAAUq5B,kBAAoB,SAAUx4B,GACnD,OAAOA,EAAQqW,QAAQ,KAAM,KAAKA,QAAQ,KAAM,IACpD,EACOuhB,CACX,CArFmC,E,mCC9FnC,IAAI1P,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQg5B,UAAO,EACf,IAAIP,EAAmB9O,EAAgB,EAAQ,MAC/C3pB,EAAQg5B,MAAO,EAAIP,EAAiB9zB,SAAS,CACzCwnB,KAAM,SACNuC,QAAS+J,EAAiB9zB,QAAQy1B,MAAM,UACxCjN,OAAQsL,EAAiB9zB,QAAQy1B,MAAM,UACvC9L,SAAU,U,mCCVdxuB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQq6B,iBAAmBr6B,EAAQs6B,iBAAmBt6B,EAAQu6B,QAAUv6B,EAAQo5B,aAAU,EAC1Fp5B,EAAQo5B,QAAU,CACd,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,MAEVp5B,EAAQu6B,QAAU,CACd,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,IACN,GAAM,KACN,GAAM,IACN,GAAM,IACN,GAAM,KACN,GAAM,KACN,GAAM,KACN,GAAM,KACN,GAAM,KACN,GAAM,OAEVv6B,EAAQs6B,iBAAmB,CACvBE,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,MAER/6B,EAAQq6B,iBAAmB,CACvBG,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,IACJC,GAAI,KACJC,GAAI,IACJC,GAAI,IACJC,GAAI,KACJC,GAAI,KACJC,GAAI,KACJC,GAAI,KACJC,GAAI,KACJC,GAAI,M,mCCxDRz7B,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQw7B,YAAS,EACjB,IAAIC,EAAc,EAAQ,IACtB3R,EAAW,EAAQ,IACnB4M,EAAU,EAAQ,IAClBgF,EAAa,CAAEC,IAAK,EAAG1hB,KAAM,GAW7BuhB,EAAwB,WAQxB,SAASA,EAAOI,EAAYC,GACxB,IAAIh2B,EAAQ,CAAE81B,IAAKC,EAAYzP,KAAM,EAAGI,QAAS,GAC7CuP,EAAW,GACfA,EAAS16B,KAAK,CACVwE,EAAG,EACH6qB,EAAG,EACHiI,GAAI7yB,EAAM81B,IAAM,GAChBA,IAAK91B,EAAM81B,IACXI,WAAW,KAEfF,EAAUA,EAAQ95B,SACVG,MAAK,SAAUC,EAAGC,GACtB,OAAOD,EAAEgqB,KAAO/pB,EAAE+pB,MAAQuP,EAAWv5B,EAAEoiB,MAAQmX,EAAWt5B,EAAEmiB,KAChE,IACAsX,EAAQ5Y,SAAQ,SAAU+Y,GACtB,IAAI7P,EAAO6P,EAAO7P,KACdI,EAAU1mB,EAAM0mB,QAAiC,IAArBJ,EAAOtmB,EAAMsmB,MAActmB,EAAM81B,IACjE,OAAQK,EAAOzX,MACX,IAAK,MACD1e,EAAM81B,IAAMK,EAAOL,IACnBG,EAAS16B,KAAK,CACVwE,EAAG2mB,EACHkE,EAAGtE,EACHuM,GAAI7yB,EAAM81B,IAAM,GAChBA,IAAK91B,EAAM81B,IACXI,WAAW,IAEf,MACJ,IAAK,OACDD,EAAS16B,KAAK,CACVwE,EAAG2mB,EACHkE,EAAGtE,EACHuM,GAAI,EACJiD,IAAK91B,EAAM81B,IACXI,WAAW,IAEfxP,GAAsC,IAAzByP,EAAOC,WAAa,GAAWp2B,EAAM81B,IAClDG,EAAS16B,KAAK,CACVwE,EAAG2mB,EACHkE,EAAGtE,EACHuM,GAAI7yB,EAAM81B,IAAM,GAChBA,IAAK91B,EAAM81B,IACXI,WAAW,IAEf,MACJ,QACI,MAAM,IAAIn5B,MAAM,gCAExBiD,EAAMsmB,KAAOA,EACbtmB,EAAM0mB,QAAUA,CACpB,IACAztB,KAAKo9B,WAAa,IAAIT,EAAYU,UAAUL,GAC5Ch9B,KAAKs9B,aAAc,EAAItS,EAASuS,OAAM,EAAIvS,EAAStqB,KAAKq8B,GAAS,SAAUG,GAAU,OAAOA,EAAO7P,IAAM,IAC7G,CAsDA,OAjDAqP,EAAO56B,UAAUsrB,cAAgB,SAAUC,GACvC,OAAOrtB,KAAKo9B,WAAWt2B,EAAEumB,EAC7B,EAKAqP,EAAO56B,UAAU0rB,cAAgB,SAAUC,GACvC,OAAOztB,KAAKo9B,WAAWzL,EAAElE,EAC7B,EAKAiP,EAAO56B,UAAU6rB,UAAY,SAAUN,GACnC,OAAOrtB,KAAKo9B,WAAWI,WAAWnQ,GAAMwP,GAC5C,EAIAH,EAAO56B,UAAU27B,cAAgB,WAC7B,OAAOz9B,KAAKs9B,WAChB,EAKAZ,EAAOvC,aAAe,SAAUhC,GACvBP,EAAQQ,SACb,IAAI2E,EAAU,GAkBd,OAjBA5E,EAAMmB,QAAQt2B,MAAMmhB,SAAQ,SAAUzhB,GAClC,IAAIm6B,EACAxP,EAAO8K,EAAMz0B,cAAchB,EAAOI,QAASJ,EAAOK,UACtD,GAAuB,OAAnBL,EAAOC,QACPk6B,EAAMrjB,SAAS9W,EAAOvB,MAAO,IAC7B47B,EAAQz6B,KAAK,CAAEmjB,KAAM,MAAO4H,KAAMA,EAAMwP,IAAKA,SAE5C,GAAuB,OAAnBn6B,EAAOC,QACZk6B,GAAO1E,EAAMqB,QAAQv3B,IAAI,MAAQS,EAAOvB,OACnCgY,MAAM0jB,IACPE,EAAQz6B,KAAK,CAAEmjB,KAAM,MAAO4H,KAAMA,EAAMwP,IAAKA,SAEhD,GAAuB,OAAnBn6B,EAAOC,QAAkB,CAC9B,IAAIw6B,GAAahF,EAAMqB,QAAQv3B,IAAI,OAASS,EAAOvB,OAAS,GAC5D47B,EAAQz6B,KAAK,CAAEmjB,KAAM,OAAQ4H,KAAMA,EAAM8P,UAAWA,GACxD,CACJ,IACO,IAAIT,GAAQvE,EAAMqB,QAAQv3B,IAAI,QAAU,GAAI86B,EACvD,EACOL,CACX,CApH2B,GAqH3Bx7B,EAAQw7B,OAASA,C,mCCrIjB17B,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQw8B,cAAW,EACnB,IAAI/F,EAAU,EAAQ,KAClB3M,EAAW,EAAQ,IACnB4M,EAAU,EAAQ,IA0BlB8F,EAA0B,WAK1B,SAASA,EAASlmB,GAEdxX,KAAKgU,MAAQ,WAEbhU,KAAKkU,OAAS,YAEdlU,KAAK+T,MAAQ,WAOb/T,KAAKiU,UAAY,GAKjBjU,KAAKmU,WAAa,GAalBnU,KAAKsU,WAAa,EAKlBtU,KAAKuU,MAAQ,EACTiD,IACA,EAAIwT,EAAS8D,QAAQ9uB,KAAMwX,EACnC,CA2CA,OAtCAkmB,EAASvD,aAAe,SAAUhC,GACzBP,EAAQQ,SACb,IAAI5gB,EAAO,CAAC,EACRxD,EAAQmkB,EAAMqB,QAAQv3B,IAAI,SAC1BiS,EAASikB,EAAMqB,QAAQv3B,IAAI,UAC3B8R,EAAQokB,EAAMqB,QAAQv3B,IAAI,SAC1BqS,GAAc6jB,EAAMqB,QAAQv3B,IAAI,eAAiB,EACjDsS,GAAS4jB,EAAMqB,QAAQv3B,IAAI,cAAgB,EAC3CgS,EAAYkkB,EAAMqB,QAAQr3B,OAAO,YACjCgS,EAAagkB,EAAMqB,QAAQr3B,OAAO,aACtC,GAAqB,iBAAV6R,IAAuBC,EAAW,CACzC,IAAI0pB,EAAkB,SAAU7T,GAC5B9V,EAAQ8V,EAAE,GACV7V,EAAY,CAAC6V,EAAE,GACnB,GACA,EAAI6N,EAAQv2B,OAAO4S,GACdzS,KAAK,qBAAsBo8B,GAC3Bp8B,KAAK,qBAAsBo8B,GAC3Bp8B,KAAK,uBAAwBo8B,GAC7Bp8B,KAAK,uBAAwBo8B,GAC7Bp8B,KAAK,qBAAsBo8B,EACpC,CAeA,OAdI3pB,IACAwD,EAAKxD,MAAQA,GACbE,IACAsD,EAAKtD,OAASA,GACdH,IACAyD,EAAKzD,MAAQA,GACbE,IACAuD,EAAKvD,UAAYA,GACjBE,IACAqD,EAAKrD,WAAaA,GAClBG,IACAkD,EAAKlD,WAAaA,GAClBC,IACAiD,EAAKjD,MAAQA,GACV,IAAImpB,EAASlmB,EACxB,EACOkmB,CACX,CAxF6B,GAyF7Bx8B,EAAQw8B,SAAWA,C,mCCrHnB18B,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ08B,eAAY,EACpB,IAAI5S,EAAW,EAAQ,IACnB4M,EAAU,EAAQ,IAwBlBgG,EAA2B,WAC3B,SAASA,EAAUl9B,GACfV,KAAK69B,KAAOn9B,CAChB,CAwCA,OAlCAk9B,EAAU97B,UAAUG,IAAM,SAAU2U,GAChC,OAAO5W,KAAK69B,KAAKjnB,EAAG1U,cACxB,EAKA07B,EAAU97B,UAAU+kB,MAAQ,WACxB,OAAO,EAAImE,EAASuS,OAAM,EAAIvS,EAASjhB,QAAQ/J,KAAK69B,MACxD,EAOAD,EAAU97B,UAAUkB,IAAM,WACtB,OAAOhD,KAAK69B,IAChB,EAKAD,EAAUzD,aAAe,SAAUhC,GAC1BP,EAAQQ,SACb,IAAI13B,EAAM,CAAC,EAOX,OANAy3B,EAAMqB,QAAQz3B,MAAK,SAAU1B,EAAMc,GAC/B,IAAIC,EAAQf,EAAKe,MAAM,gBAClBA,IAELV,EAAIU,EAAM,GAAGc,eAAiBf,EAClC,IACO,IAAIy8B,EAAUl9B,EACzB,EACOk9B,CACX,CA5C8B,GA6C9B18B,EAAQ08B,UAAYA,C,mCC1EpB58B,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ48B,iBAAc,EACtB,IAAInB,EAAc,EAAQ,IACtB/E,EAAU,EAAQ,IAQlBkG,EAA6B,WAK7B,SAASA,EAAYd,GACjBh9B,KAAKo9B,WAAa,IAAIT,EAAYU,UAAUL,EAChD,CAoDA,OA/CAc,EAAYh8B,UAAU+rB,MAAQ,SAAUR,GACpC,OAAOrtB,KAAKo9B,WAAWxD,GAAGvM,EAC9B,EAKAyQ,EAAYh8B,UAAUyrB,SAAW,SAAUF,GACvC,OAAOrtB,KAAKo9B,WAAWzL,EAAEtE,EAC7B,EAKAyQ,EAAY3D,aAAe,SAAUhC,GAC5BP,EAAQQ,SACb,IAAI4E,EAAW,GACXrL,EAAI,EA4BR,OA3BAqL,EAAS16B,KAAK,CACVwE,EAAG,EACH6qB,EAAGA,EACHiI,GAAI,EACJqD,WAAW,IAEf9E,EAAMmB,QAAQp2B,YAAYihB,SAAQ,SAAUzhB,GACxC,GAAuB,OAAnBA,EAAOC,QAAkB,CACzB,IAAI0qB,EAAO8K,EAAMz0B,cAAchB,EAAOI,QAASJ,EAAOK,UAClD62B,GAAMzB,EAAMqB,QAAQv3B,IAAI,SAAWS,EAAOvB,OAC9C,GAAIgY,MAAMygB,GACN,OACJ,IAAImE,EAAWf,EAASA,EAASp6B,OAAS,GAC1C+uB,IAAMtE,EAAO0Q,EAASj3B,GAAKi3B,EAASnE,GACvB,IAATvM,GAAkC,IAApB2P,EAASp6B,OACvBo6B,EAAS,GAAGpD,GAAKA,EAGjBoD,EAAS16B,KAAK,CACVwE,EAAGumB,EACHsE,EAAGA,EACHiI,GAAIA,EACJqD,WAAW,GAGvB,CACJ,IACO,IAAIa,EAAYd,EAC3B,EACOc,CACX,CA5DgC,GA6DhC58B,EAAQ48B,YAAcA,C,mCCxEtB98B,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ88B,aAAU,EAClB,IAAIrB,EAAc,EAAQ,IACtB/E,EAAU,EAAQ,IASlBoG,EAAyB,WAIzB,SAASA,EAAQhB,GACTA,EAASp6B,OAAS,IAClB5C,KAAKo9B,WAAa,IAAIT,EAAYU,UAAUL,GAEpD,CAiEA,OA5DAgB,EAAQl8B,UAAUisB,OAAS,SAAUV,GACjC,OAAIrtB,KAAKo9B,WACEp9B,KAAKo9B,WAAWzL,EAAEtE,GAGlB,CAEf,EAsBA2Q,EAAQ7D,aAAe,SAAUhC,GACxBP,EAAQQ,SACb,IAAI4E,EAAW,GA2Bf,OA1BA7E,EAAMmB,QAAQp2B,YAAYihB,SAAQ,SAAUzhB,GACxC,GAAuB,OAAnBA,EAAOC,QAAkB,CACzB,IAAI0qB,EAAO8K,EAAMz0B,cAAchB,EAAOI,QAASJ,EAAOK,UAClDgrB,GAAUoK,EAAMqB,QAAQv3B,IAAI,QAAUS,EAAOvB,OACjD,GAAIgY,MAAM4U,GACN,OACJ,GAAIiP,EAASp6B,OAAS,EAAG,CACrB,IAAIm7B,EAAWf,EAASA,EAASp6B,OAAS,GAC1Cm7B,EAASnE,IAAM7L,EAASgQ,EAASpM,IAAMtE,EAAO0Q,EAASj3B,EAC3D,CACAk2B,EAAS16B,KAAK,CACVwE,EAAGumB,EACHsE,EAAG5D,EACH6L,GAAI,EACJqD,WAAW,GAEnB,CACJ,IACID,EAASp6B,OAAS,GAClBo6B,EAASpb,QAAQ,CACb9a,EAAG,EACH6qB,EAAGqL,EAAS,GAAGrL,EACfiI,GAAI,EACJqD,WAAW,IAGZ,IAAIe,EAAQhB,EACvB,EACOgB,CACX,CA1E4B,GA2E5B98B,EAAQ88B,QAAUA,C,mCCxFlB,6RAAIC,GAAW,EAEXC,EAAoB,CAEtBj1B,QAAQnC,GACN,MAAM,IAAIhD,MAAM,iDAClB,EAEA8J,UACE,MAAM,IAAI9J,MAAM,mDAClB,EAEA+J,WACE,MAAM,IAAI/J,MAAM,qDAClB,GAcK,SAASq6B,IACd,IAAKF,EAAU,CACbA,GAAW,EACX3rB,QAAQ0R,IAAI,8BACZ,MAAMoa,EAAU7sB,SAASC,cAAc,OACvC4sB,EAAQ7K,aACN,QACA,0SAaF6K,EAAQC,UAAY,0GAIpB9sB,SAASiiB,KAAK1e,YAAYspB,E,CAE9B,CAQO,SAASE,EAAwBC,GACtCjsB,QAAQ0R,IAAI,2DACZka,EAAoBK,CACtB,CAKO,SAASC,IACd,QAASP,CACX,CAQO,SAASh1B,EAAQnC,GACtB,OAAOo3B,EAAkBj1B,QAAQnC,EACnC,CAKO,SAAS8G,IACd,OAAOswB,EAAkBtwB,SAC3B,CAKO,SAASC,IACd,OAAOqwB,EAAkBrwB,UAC3B,C,oBChGAjI,EAAO1E,QAAU,WAChB,MAAM,IAAI4C,MAAM,iCACjB,C,qBCFA,YACA8B,EAAO1E,QAAUu9B,C,mDCAjB,IAAI7U,EAAmB5pB,MAAQA,KAAK4pB,kBAAqB5oB,OAAO6oB,OAAS,SAAUpS,EAAGqS,EAAGvI,EAAGwI,QAC7E/T,IAAP+T,IAAkBA,EAAKxI,GAC3B,IAAIyI,EAAOhpB,OAAOipB,yBAAyBH,EAAGvI,GACzCyI,KAAS,QAASA,GAAQF,EAAEI,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMpoB,IAAK,WAAa,OAAO6nB,EAAEvI,EAAI,IAE5DvgB,OAAOC,eAAewW,EAAGsS,EAAIC,EAChC,EAAI,SAAUvS,EAAGqS,EAAGvI,EAAGwI,QACT/T,IAAP+T,IAAkBA,EAAKxI,GAC3B9J,EAAEsS,GAAMD,EAAEvI,EACb,GACGsY,EAAsB75B,MAAQA,KAAK65B,qBAAwB74B,OAAO6oB,OAAS,SAAUpS,EAAGqL,GACxF9hB,OAAOC,eAAewW,EAAG,UAAW,CAAE4S,YAAY,EAAMlpB,MAAO2hB,GAClE,EAAI,SAASrL,EAAGqL,GACbrL,EAAW,QAAIqL,CACnB,GACIgX,EAAgB95B,MAAQA,KAAK85B,cAAiB,SAAUhP,GACxD,GAAIA,GAAOA,EAAIZ,WAAY,OAAOY,EAClC,IAAI3gB,EAAS,CAAC,EACd,GAAW,MAAP2gB,EAAa,IAAK,IAAIvJ,KAAKuJ,EAAe,YAANvJ,GAAmBvgB,OAAOc,UAAUyoB,eAAehU,KAAKuU,EAAKvJ,IAAIqI,EAAgBzf,EAAQ2gB,EAAKvJ,GAEtI,OADAsY,EAAmB1vB,EAAQ2gB,GACpB3gB,CACX,EACI0gB,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQi5B,kBAAe,EACvB,IAAIuE,EAAM5E,EAAa,EAAQ,KAC3B9O,EAAWH,EAAgB,EAAQ,KACnC8T,EAAM9T,EAAgB,EAAQ,MAgClC,SAAS+T,EAAyB5vB,GAE9B,IAAI6vB,GAAQ7vB,EAAIwqB,QAAQv3B,IAAI,SAAW,EACvC,OAAa,IAAT48B,EACO,CAAC,EAAG,IACF,IAATA,EACO,CAAC,GAAI,IACH,IAATA,EACO,CAAC,GAAI,IACT,CAAC,GAAI,GAChB,CACA,SAASC,EAAwB1T,EAAUpc,GACvC,IAAIuM,EAAMyP,EAASnlB,QAAQ0V,IAAI6P,EAAS1qB,KAAI,SAAUqsB,GAAQ,OAAOA,EAAK6C,SAAW7C,EAAKM,IAAM,MAAO,EACnG1B,EAAW,CAAC,GACZoT,EAAc,EACdC,EAAiB,EACrB,GACID,GAAe/vB,EAAIoqB,eAAe31B,SAASu7B,GAC3CA,GAAkB,EAClBrT,EAASrpB,KAAKy8B,SACTA,GAAexjB,GACxB,OAAOoQ,CACX,CAvBAzqB,EAAQi5B,aA7BR,SAAsBnrB,EAAKkc,GACvB,IAAIG,EAAQqT,EAAI3E,MAAMI,aAAanrB,EAAK,CACpCorB,QAASlP,EAAc+T,OACjBP,EAAI3E,MAAMM,gBAAgBoB,QAC1BiD,EAAI3E,MAAMM,gBAAgBC,UACjCt3B,MAWCkH,EAAO,CACPmhB,MAAOA,EACPU,cAZgB2S,EAAI3E,MAAMI,aAAanrB,EAAK,CAC5CorB,QAASlP,EAAc+T,OACjBP,EAAI3E,MAAMM,gBAAgBkB,iBAC1BmD,EAAI3E,MAAMM,gBAAgBmB,mBACjCx4B,MASCsoB,OARSoT,EAAIhC,OAAOvC,aAAanrB,GASjCuc,UARYmT,EAAId,UAAUzD,aAAanrB,GASvCwc,SARWkT,EAAIhB,SAASvD,aAAanrB,GASrCyc,YARciT,EAAIZ,YAAY3D,aAAanrB,GAS3C0c,QARUgT,EAAIV,QAAQ7D,aAAanrB,GASnC2c,SAAUmT,EAAwBzT,EAAOrc,GACzC6c,qBAAsB+S,EAAyB5vB,IAEnD,OAAO,IAAI2vB,EAAI94B,QAAQqE,EAAMghB,EACjC,C,mCC5DAlqB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,G,mCCD/C,SAAS8V,EAAUioB,GACxB,MAAO,CACL1nB,KAAM2nB,EAAWD,EAAY,QAC7B3sB,KAAM4sB,EAAWD,EAAY,QAC7Br7B,MAAOs7B,EAAWD,EAAY,SAElC,CAEA,SAASC,EAAWD,EAAoB3qB,GACtC,MAAO,IAAImC,KACTpE,QAAQ0R,IACN,KAAI,IAAI7M,MAAOioB,cAAcF,OAAgB3qB,MAAU,EAAQ,KAAQoD,UAClEjB,KAEN,CAEL,CAhBA,gD,mCCCA,IAAIkT,EAAmB5pB,MAAQA,KAAK4pB,kBAAqB5oB,OAAO6oB,OAAS,SAAUpS,EAAGqS,EAAGvI,EAAGwI,QAC7E/T,IAAP+T,IAAkBA,EAAKxI,GAC3B,IAAIyI,EAAOhpB,OAAOipB,yBAAyBH,EAAGvI,GACzCyI,KAAS,QAASA,GAAQF,EAAEI,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMpoB,IAAK,WAAa,OAAO6nB,EAAEvI,EAAI,IAE5DvgB,OAAOC,eAAewW,EAAGsS,EAAIC,EAChC,EAAI,SAAUvS,EAAGqS,EAAGvI,EAAGwI,QACT/T,IAAP+T,IAAkBA,EAAKxI,GAC3B9J,EAAEsS,GAAMD,EAAEvI,EACb,GACGsY,EAAsB75B,MAAQA,KAAK65B,qBAAwB74B,OAAO6oB,OAAS,SAAUpS,EAAGqL,GACxF9hB,OAAOC,eAAewW,EAAG,UAAW,CAAE4S,YAAY,EAAMlpB,MAAO2hB,GAClE,EAAI,SAASrL,EAAGqL,GACbrL,EAAW,QAAIqL,CACnB,GACIgX,EAAgB95B,MAAQA,KAAK85B,cAAiB,SAAUhP,GACxD,GAAIA,GAAOA,EAAIZ,WAAY,OAAOY,EAClC,IAAI3gB,EAAS,CAAC,EACd,GAAW,MAAP2gB,EAAa,IAAK,IAAIvJ,KAAKuJ,EAAe,YAANvJ,GAAmBvgB,OAAOc,UAAUyoB,eAAehU,KAAKuU,EAAKvJ,IAAIqI,EAAgBzf,EAAQ2gB,EAAKvJ,GAEtI,OADAsY,EAAmB1vB,EAAQ2gB,GACpB3gB,CACX,EACIk1B,EAAUr/B,MAAQA,KAAKq/B,QAAW,SAAU5nB,EAAGvF,GAC/C,IAAI4X,EAAsB,mBAAXW,QAAyBhT,EAAEgT,OAAOC,UACjD,IAAKZ,EAAG,OAAOrS,EACf,IAAmB6nB,EAAY1yB,EAA3B5K,EAAI8nB,EAAEvT,KAAKkB,GAAO8nB,EAAK,GAC3B,IACI,WAAc,IAANrtB,GAAgBA,KAAM,MAAQotB,EAAIt9B,EAAE2oB,QAAQC,MAAM2U,EAAGj9B,KAAKg9B,EAAEn+B,MAQxE,CANA,MAAO0C,GAAS+I,EAAI,CAAE/I,MAAOA,EAAS,CACtC,QACI,IACQy7B,IAAMA,EAAE1U,OAASd,EAAI9nB,EAAU,SAAI8nB,EAAEvT,KAAKvU,EAElB,CAAhC,QAAU,GAAI4K,EAAG,MAAMA,EAAE/I,KAAO,CACpC,CACA,OAAO07B,CACX,EACIC,EAAiBx/B,MAAQA,KAAKw/B,eAAkB,SAAUC,EAAIhP,EAAMiP,GACpE,GAAIA,GAA6B,IAArBtM,UAAUxwB,OAAc,IAAK,IAA4B28B,EAAxBv9B,EAAI,EAAGof,EAAIqP,EAAK7tB,OAAYZ,EAAIof,EAAGpf,KACxEu9B,GAAQv9B,KAAKyuB,IACR8O,IAAIA,EAAKtW,MAAMnnB,UAAUmB,MAAMsT,KAAKka,EAAM,EAAGzuB,IAClDu9B,EAAGv9B,GAAKyuB,EAAKzuB,IAGrB,OAAOy9B,EAAG/vB,OAAO6vB,GAAMtW,MAAMnnB,UAAUmB,MAAMsT,KAAKka,GACtD,EACI5F,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQy+B,yBAA2Bz+B,EAAQ0+B,WAAa1+B,EAAQ2+B,mBAAqB3+B,EAAQ4+B,sBAAmB,EAChH,IAAI9U,EAAWH,EAAgB,EAAQ,KACnCkV,EAAQjG,EAAa,EAAQ,MAiCjC,SAAS8F,EAAWpO,GAChB,OAAOA,EAAI,GACf,CAxBAtwB,EAAQ4+B,iBAVR,SAA0BE,GACtB,IAAI3M,EAAQ2M,EAAM3M,MAClB,OAAO,EAAIrI,EAASnlB,SAASwtB,GACxB3yB,KAAI,SAAUorB,GAEf,OAAO8T,EADC9T,EAAG0F,EAEf,IACKyO,SACA9+B,OACT,EAsBAD,EAAQ2+B,mBApBR,SAA4BG,GACxB,MAAO,CACHlD,WAAYkD,EAAMxoB,KAAK0oB,QACvBnD,QAASyC,EAAcA,EAAc,GAAIH,GAAQW,EAAMG,UAAY,IAAIz/B,KAAI,SAAUorB,GACjF,IAAI0F,EAAI1F,EAAG0F,EAAG1O,EAAIgJ,EAAGhJ,EACrB,MAAO,CACH2C,KAAM,MACN4H,KAAMuS,EAAWpO,GACjBqL,IAAK/Z,EAEb,MAAK,GAAQuc,GAAQW,EAAMI,WAAa,IAAI1/B,KAAI,SAAUorB,GACtD,IAAI0F,EAAI1F,EAAG0F,EAAG1O,EAAIgJ,EAAGhJ,EACrB,MAAO,CACH2C,KAAM,OACN4H,KAAMuS,EAAWpO,GACjB2L,UAAWyC,EAAWp6B,KAAKC,MAAMqd,IAEzC,MAAK,GAEb,EAKA5hB,EAAQ0+B,WAAaA,EAMrB1+B,EAAQy+B,yBALR,SAAiCtU,EAAOC,GACpC,OAAOyU,EAAMM,wBAAwBhV,EAAOC,EAAQ,CAChDgV,aAAcV,GAEtB,C,mCC/FA,IAAIpV,EAAYxqB,MAAQA,KAAKwqB,UAAa,SAAS/S,GAC/C,IAAIwB,EAAsB,mBAAXwR,QAAyBA,OAAOC,SAAUZ,EAAI7Q,GAAKxB,EAAEwB,GAAIjX,EAAI,EAC5E,GAAI8nB,EAAG,OAAOA,EAAEvT,KAAKkB,GACrB,GAAIA,GAAyB,iBAAbA,EAAE7U,OAAqB,MAAO,CAC1C+nB,KAAM,WAEF,OADIlT,GAAKzV,GAAKyV,EAAE7U,SAAQ6U,OAAI,GACrB,CAAEtW,MAAOsW,GAAKA,EAAEzV,KAAM4oB,MAAOnT,EACxC,GAEJ,MAAM,IAAIyI,UAAUjH,EAAI,0BAA4B,kCACxD,EACIomB,EAAUr/B,MAAQA,KAAKq/B,QAAW,SAAU5nB,EAAGvF,GAC/C,IAAI4X,EAAsB,mBAAXW,QAAyBhT,EAAEgT,OAAOC,UACjD,IAAKZ,EAAG,OAAOrS,EACf,IAAmB6nB,EAAY1yB,EAA3B5K,EAAI8nB,EAAEvT,KAAKkB,GAAO8nB,EAAK,GAC3B,IACI,WAAc,IAANrtB,GAAgBA,KAAM,MAAQotB,EAAIt9B,EAAE2oB,QAAQC,MAAM2U,EAAGj9B,KAAKg9B,EAAEn+B,MAQxE,CANA,MAAO0C,GAAS+I,EAAI,CAAE/I,MAAOA,EAAS,CACtC,QACI,IACQy7B,IAAMA,EAAE1U,OAASd,EAAI9nB,EAAU,SAAI8nB,EAAEvT,KAAKvU,EAElB,CAAhC,QAAU,GAAI4K,EAAG,MAAMA,EAAE/I,KAAO,CACpC,CACA,OAAO07B,CACX,EACIC,EAAiBx/B,MAAQA,KAAKw/B,eAAkB,SAAUC,EAAIhP,EAAMiP,GACpE,GAAIA,GAA6B,IAArBtM,UAAUxwB,OAAc,IAAK,IAA4B28B,EAAxBv9B,EAAI,EAAGof,EAAIqP,EAAK7tB,OAAYZ,EAAIof,EAAGpf,KACxEu9B,GAAQv9B,KAAKyuB,IACR8O,IAAIA,EAAKtW,MAAMnnB,UAAUmB,MAAMsT,KAAKka,EAAM,EAAGzuB,IAClDu9B,EAAGv9B,GAAKyuB,EAAKzuB,IAGrB,OAAOy9B,EAAG/vB,OAAO6vB,GAAMtW,MAAMnnB,UAAUmB,MAAMsT,KAAKka,GACtD,EACI5F,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQm/B,6BAA0B,EAClC,IAAIrV,EAAWH,EAAgB,EAAQ,KAyEvC3pB,EAAQm/B,wBA9DR,SAAiChV,EAAOC,EAAQ/lB,GAC5C,IAAI0oB,EAAKnC,EAAIiE,EAAK5B,EACdmS,EAAe/6B,EAAQ+6B,aACvBt9B,EAAM,IAAI8Z,IACVjC,EAAO,IAAIiC,IACXyjB,EAAU,IAAIzjB,IAClB,IACI,IAAK,IAAI0jB,EAAUhW,EAASa,GAAQoV,EAAYD,EAAQ7V,QAAS8V,EAAU7V,KAAM6V,EAAYD,EAAQ7V,OAAQ,CACzG,IAAIyD,EAAKqS,EAAUt/B,MAAOwwB,EAAIvD,EAAGuD,EAAGH,EAAIpD,EAAGoD,EAAGkP,EAAItS,EAAGsS,EACrD19B,EAAIP,IAAI+uB,GACJG,GACA9W,EAAKpY,IAAI+uB,GAERkP,GACDH,EAAQ99B,IAAI+uB,EAEpB,CAQJ,CANA,MAAOlD,GAASL,EAAM,CAAEpqB,MAAOyqB,EAAS,CACxC,QACI,IACQmS,IAAcA,EAAU7V,OAASkB,EAAK0U,EAAQjS,SAASzC,EAAGvV,KAAKiqB,EAEnC,CAApC,QAAU,GAAIvS,EAAK,MAAMA,EAAIpqB,KAAO,CACxC,CACA,IAGI,EACA88B,EAJAx2B,EAAS,IAAI5D,IACbq6B,EAAY,KACZC,GAAU,EAGd,IACI,IAAK,IAAI3Q,EAAK1F,EAASQ,EAASnlB,QAAQo6B,OAAOT,EAAc,GAAIH,EAAOr8B,IAAM,KAAU89B,EAAK5Q,EAAGvF,QAASmW,EAAGlW,KAAMkW,EAAK5Q,EAAGvF,OAAQ,CAC1H6G,EAAIsP,EAAG3/B,MAAX,IACI2F,EAAIwkB,EAAO8B,cAAckT,EAAa9O,IAQ1C,GAPkB,OAAdoP,GAAsBL,EAAQQ,IAAIvP,GAClCoP,EAAY,EAGZA,GAAa95B,EAAI,EAEL+5B,GAAWhmB,EAAKkmB,IAAIvP,IAAM+O,EAAQQ,IAAIvP,GACvC,CACPmP,IAAcJ,EAAQQ,IAAIvP,KAC1BmP,EAAUjR,YAAckR,GAE5B,IAAI7hB,EAAM,CAAE0Q,cAAemR,EAAWlR,iBAAa1Z,GACnD7L,EAAO/H,IAAIovB,EAAGzS,GACd4hB,EAAY5hB,CAChB,CACA8hB,EAAUhmB,EAAKkmB,IAAIvP,GACnB,EAAK1qB,CACT,CAQJ,CANA,MAAO0pB,GAAST,EAAM,CAAElsB,MAAO2sB,EAAS,CACxC,QACI,IACQsQ,IAAOA,EAAGlW,OAASuD,EAAK+B,EAAG3B,SAASJ,EAAG5X,KAAK2Z,EAEhB,CAApC,QAAU,GAAIH,EAAK,MAAMA,EAAIlsB,KAAO,CACxC,CACA,OAAOsG,CACX,C,mCCtCe,IA1BR,MAELvK,YACkB+Q,EACA0C,EAChB9N,GAFgB,KAAAoL,YACA,KAAA0C,SAGhBrT,KAAKuF,QAAU,CACby7B,kBAAmBz7B,EAAQy7B,gBAC3BC,YAAa17B,EAAQ07B,UACrBpT,OAAQtoB,EAAQsoB,MAChBiH,UAAWvvB,EAAQuvB,WAAa,SAChCjrB,QAAStE,EAAQsE,SAAW,OAC5BlC,MAAOpC,EAAQoC,MACfu5B,YAAa37B,EAAQ27B,WAAa,GAClCC,MAAO57B,EAAQ47B,MACfC,WAAY77B,EAAQ67B,SAExB,CAGIC,cACF,OAAOrhC,KAAK2Q,UAAU0wB,OACxB,E,mCCzEF,6BAKA,MAAMC,EAAoBC,GAAqB/7B,KAAKC,MAAiB,IAAX87B,GACpDC,EAAgB,CAAC79B,EAAasS,IAClCzQ,KAAKC,MAAa,MAAN9B,EAAesS,GAiKd,IA/JR,MAgBLrW,YAAY+Q,GACV3Q,KAAKyhC,WAAa,IAAE9wB,EAAU0a,OAC3B3qB,KAAKqsB,GAASpc,EAAU6G,KAAKuV,GAAO4D,SACpChtB,MACH3D,KAAK0hC,WAAa/wB,EAAU0a,MAAMzoB,OAClC5C,KAAK2hC,MAAQ,EACb3hC,KAAK4hC,SAAW,EAChB5hC,KAAK6hC,qBAAuB,EAC5B7hC,KAAK8hC,mBAAqB9hC,KAAK+hC,6BAA6B/hC,KAAKyhC,YACjEzhC,KAAKgiC,mCAAqChiC,KAAK8hC,mBAC/C9hC,KAAKiiC,iBAAmB,EACxBjiC,KAAKkiC,OAAS,CAAE,CAAC,KAAmB,EAAG,EAAK,EAAG,EAAK,EAAG,EAAK,EAAG,EAAK,GACpEliC,KAAKmiC,aAAe,EACpBniC,KAAKoiC,MAAO,EACZpiC,KAAKqiC,KAAO,GACZriC,KAAKsiC,OAAS,EAChB,CAEIv0B,YAEF,OAAO/N,KAAKuiC,cAAgBviC,KAAKwiC,UAEnC,CAEID,oBACF,OAAOjB,EAAiBthC,KAAKuhC,SAC/B,CAEIiB,iBACF,OAAOhB,EAAcxhC,KAAKiiC,iBAAkBjiC,KAAK8hC,mBACnD,CAEIW,uBACF,OAAOziC,KAAK0iC,yBAA2B1iC,KAAK2iC,qBAC9C,CAEID,+BACF,MAAME,EAAqB5iC,KAAKyhC,WAAazhC,KAAKmiC,aAG5CU,GADJ7iC,KAAK6hC,qBAAuB,IAAiB,GAAKe,IAE1B,IAAiB,GAAK5iC,KAAKyhC,YACrD,OAAOH,EAAiBuB,EAC1B,CAEIF,4BACF,MAAMG,EACJ9iC,KAAKiiC,iBAAmBjiC,KAAKgiC,mCAC/B,OAAOR,EAAcsB,EAA0B9iC,KAAK8hC,mBACtD,CAEIP,eACF,OAAOvhC,KAAK6hC,sBAAwB,IAAiB,GAAK7hC,KAAKyhC,WACjE,CAEIsB,sBACF,OACE/iC,KAAK6hC,sBAAwB,IAAiB,GAAK7hC,KAAKmiC,cAAgB,EAE5E,CAEIne,UACF,OAAOhkB,KAAKqiC,KACT3hC,KAAI,EAAGsiC,YAAWnQ,WAAY,GAAGA,EAAQ,EAAIA,EAAQ,KAAKmQ,MAC1DniC,KAAK,GACV,CAEAoiC,eAAeC,GAGb,GAFAljC,KAAKkiC,OAAOgB,IAAa,EACzBljC,KAAKmiC,cAAgB,EACjB,IAAsBe,GAAW,CACnC,MAAMN,EAAqB5iC,KAAKyhC,WAAazhC,KAAKmiC,aAClDniC,KAAK2hC,MAAQ,EACb3hC,KAAKoiC,MAAO,EACZpiC,KAAKgiC,mCACHhiC,KAAK+hC,6BAA6Ba,E,KAC/B,CACL5iC,KAAK2hC,OAAS,EACd,MAAMwB,EAAgBnjC,KAAKojC,wBAAwBpjC,KAAK2hC,OACxD3hC,KAAKiiC,kBAAoBkB,EACzBnjC,KAAKgiC,oCAAsCmB,EAC3CnjC,KAAKoiC,MAAO,C,CAEdpiC,KAAK6hC,sBAAwB,IAAiBqB,GAC1CljC,KAAK2hC,MAAQ3hC,KAAK4hC,WACpB5hC,KAAK4hC,SAAW5hC,KAAK2hC,OAEvB3hC,KAAKqjC,WAAWH,EAClB,CAEAI,YAAYh8B,GACVtH,KAAKsiC,OAAOhgC,KAAKgF,EACnB,CAEQy6B,6BAA6B9rB,GACnC,IAAItS,EAAM,EACV,IAAK,IAAI3B,EAAI,EAAGA,GAAKiU,EAAOjU,IAC1B2B,GAAO3D,KAAKojC,wBAAwBphC,GAEtC,OAAO2B,CACT,CAEQy/B,wBAAwBphC,GAE9B,OAAU,IAANA,EAAgB,EAChBA,EAAI,GAAW,EACfA,EAAI,GAAW,EACfA,EAAI,GAAW,EACfA,EAAI,IAAY,EACb,CAET,CAEQqhC,WAAWH,GACjB,MAAMF,EAAYhjC,KAAKujC,iBAAiBL,GACpCF,IAEqB,IAArBhjC,KAAKqiC,KAAKz/B,QACV5C,KAAKqiC,KAAKriC,KAAKqiC,KAAKz/B,OAAS,GAAGogC,YAAcA,EAE9ChjC,KAAKqiC,KAAK//B,KAAK,CAAE0gC,YAAWnQ,MAAO,IAEnC7yB,KAAKqiC,KAAKriC,KAAKqiC,KAAKz/B,OAAS,GAAGiwB,OAAS,EAG/C,CAEQ0Q,iBAAiBL,GACvB,OAAQA,GACN,KAAK,EACH,MAAO,IACT,KAAK,EACH,MAAO,IACT,KAAK,EACH,MAAO,IACT,KAAK,EACH,MAAO,IACT,KAAK,IACH,MAAO,IAEb,E,mCCrKF,qBA2CA,SAAS1R,EAAEgS,EAAOC,EAAOzR,GACvB,OAAO,GAAKA,EAAMwR,IAAUC,EAAQD,EACtC,CAEA,SAASjW,EAASuC,GAChB,OAAOA,EAAMvC,QACf,CARe,IAvCR,MACL3tB,YAAYyrB,EAAOM,GACjB3rB,KAAKssB,OAAS,IAAE2T,OAAO5U,EAAOkC,GAC9BvtB,KAAK2sB,UAAY,IAAEhB,GAAUjrB,IAAI,YAAYu/B,SAAS9+B,OACxD,CAEAuiC,gBAAgBF,EAAOC,EAAOE,GAC5B,MAAMlc,EAAM,GACN4D,EAAQrrB,KAAKssB,OACdqX,IAAUA,EAAW,GAC1B,IAAK,IAAI3hC,EAAI,EAAGA,EAAIqpB,EAAMzoB,OAAQZ,IAAK,CACrC,MAAM+qB,EAAO1B,EAAMrpB,GAInB,GAHgB+qB,EAAKjb,MACfib,EAAKQ,SAAWkW,GAAS1W,EAAKjb,IAAIyb,SAAWiW,EAAQG,KACrD5W,EAAKQ,SAAWkW,GAAS1W,EAAKQ,SAAWiW,EAAQG,GAC1C,CACX,MAAMC,EAAS,CAAE7W,KAAMA,GACvB,GAAKA,EAAKjb,IAEH,CACL,MAAM+xB,EAAOrS,EAAEgS,EAAOC,EAAO1W,EAAKQ,UAC5BuW,EAAOtS,EAAEgS,EAAOC,EAAO1W,EAAKjb,IAAIyb,UACtCqW,EAAOpS,EAAIhsB,KAAKwD,IAAI66B,EAAMC,GAC1BF,EAAOG,OAASv+B,KAAK+S,IAAIsrB,EAAOC,E,MALhCF,EAAOpS,EAAIA,EAAEgS,EAAOC,EAAO1W,EAAKQ,UAOlC9F,EAAInlB,KAAKshC,E,EAGb,OAAOnc,CACT,CAEAuc,mBAAmBR,EAAOC,EAAOE,GAE/B,OADKA,IAAUA,EAAW,GACnB3jC,KAAK2sB,UACT2C,QAAQ0C,GAAQwR,EAAQG,GAAY3R,GAAOA,GAAOyR,IAClD/iC,KAAKsxB,IAAQ,CAAGpb,GAAIob,EAAKR,EAAGA,EAAEgS,EAAOC,EAAOzR,MACjD,E,mCCtCK,SAASiS,EAASC,GACvB,MAAkB,SAAdA,EAwBN,WACE,IAAIC,EACAC,EACA3wB,EACJ,MAAO,CACL5M,OAAOw9B,GACL,MAAMv2B,EAAQu2B,EAAYv2B,MACpB/N,EAAW+N,EAAMq0B,aAAer0B,EAAM2zB,WACtC6C,EAAU,CAACt7B,EAAKu7B,EAAMC,KAC1B,MAAMjpB,EAAMgpB,GAAQC,EAAOD,GAAQxkC,EAC7B0iC,EAAmB30B,EAAM20B,iBAC/B,OAAOj9B,KAAK+V,IAAI,GAAIknB,EAAmBz5B,IAAQuS,EAAMvS,GAAK,EAEtDy7B,EAA0C,GAAlCH,EAAQ,IAAQ,OAAQ,MAGtC,GAFAH,EAAU3+B,KAAKwD,IAAI,EAAGy7B,GACtBhxB,EAAQjO,KAAK+V,IAAI,EAAG/V,KAAKwD,IAAI,EAAGy7B,EAAQ,IACpCA,EAAQ,EACVL,EAAY,MACP,CACL,MAAMM,EAAQJ,EAAQ,KAAQ,IAAQ,KACtCF,EAAYM,C,CAEhB,EACAC,cAAa,IACJR,EAAU,GAAKC,EAAY,EAEpCQ,WAAU,IACDT,EAETU,aAAY,IACHT,EAETU,SAAQ,IACCrxB,EAGb,CA3DWsxB,GAMF,CACLl+B,SAAU,EACV89B,cAAa,KACJ,EAETC,WAAU,IACD,EAETC,aAAY,IACH,EAETC,SAAQ,IACC,EAfb,CALA,iC,mCCKe,IALR,SAAoBrX,GACzB,MAAMxU,EAAIzT,KAAKC,MAAMgoB,EAAU,IAC/B,OAAOjoB,KAAKC,MAAMgoB,EAAU,IAAM,KAAOxU,EAAI,GAAK,IAAM,IAAMA,CAChE,C,uBCHA,qBACE,SAAS+rB,GAGsC9jC,GAC9CA,EAAQ+jC,SACoCr/B,GAC5CA,EAAOq/B,SAHT,IAIIC,EAA8B,iBAAVC,GAAsBA,EAE7CD,EAAWC,SAAWD,GACtBA,EAAW37B,SAAW27B,GACtBA,EAAWE,KAUZ,IAAIrnB,EAGJsnB,EAAS,WAGT9kC,EAAO,GAUP+kC,EAAgB,QAChBC,EAAgB,eAChBC,EAAkB,4BAGlBC,EAAS,CACR,SAAY,kDACZ,YAAa,iDACb,gBAAiB,iBAKlBhgC,EAAQD,KAAKC,MACbigC,EAAqBzT,OAAO0T,aAa5B,SAAS9hC,EAAM4hB,GACd,MAAM,IAAImgB,WAAWH,EAAOhgB,GAC7B,CAUA,SAAS/kB,EAAIyvB,EAAOjM,GAGnB,IAFA,IAAIthB,EAASutB,EAAMvtB,OACfuH,EAAS,GACNvH,KACNuH,EAAOvH,GAAUshB,EAAGiM,EAAMvtB,IAE3B,OAAOuH,CACR,CAYA,SAAS07B,EAAUzyB,EAAQ8Q,GAC1B,IAAIvK,EAAQvG,EAAO3S,MAAM,KACrB0J,EAAS,GAWb,OAVIwP,EAAM/W,OAAS,IAGlBuH,EAASwP,EAAM,GAAK,IACpBvG,EAASuG,EAAM,IAMTxP,EADOzJ,GAFd0S,EAASA,EAAO4F,QAAQwsB,EAAiB,MACrB/kC,MAAM,KACAyjB,GAAIrjB,KAAK,IAEpC,CAeA,SAASilC,EAAW1yB,GAMnB,IALA,IAGIjS,EACAsS,EAJApK,EAAS,GACT08B,EAAU,EACVnjC,EAASwQ,EAAOxQ,OAGbmjC,EAAUnjC,IAChBzB,EAAQiS,EAAOoO,WAAWukB,OACb,OAAU5kC,GAAS,OAAU4kC,EAAUnjC,EAG3B,QAAX,OADb6Q,EAAQL,EAAOoO,WAAWukB,OAEzB18B,EAAO/G,OAAe,KAARnB,IAAkB,KAAe,KAARsS,GAAiB,QAIxDpK,EAAO/G,KAAKnB,GACZ4kC,KAGD18B,EAAO/G,KAAKnB,GAGd,OAAOkI,CACR,CAUA,SAAS28B,EAAW7V,GACnB,OAAOzvB,EAAIyvB,GAAO,SAAShvB,GAC1B,IAAIkI,EAAS,GAOb,OANIlI,EAAQ,QAEXkI,GAAUq8B,GADVvkC,GAAS,SAC8B,GAAK,KAAQ,OACpDA,EAAQ,MAAiB,KAARA,GAElBkI,GAAUq8B,EAAmBvkC,EAE9B,IAAGN,KAAK,GACT,CAmCA,SAASolC,EAAaC,EAAOC,GAG5B,OAAOD,EAAQ,GAAK,IAAMA,EAAQ,MAAgB,GAARC,IAAc,EACzD,CAOA,SAASC,EAAM9+B,EAAO++B,EAAWC,GAChC,IAAI/kB,EAAI,EAGR,IAFAja,EAAQg/B,EAAY7gC,EAAM6B,EA1LpB,KA0LoCA,GAAS,EACnDA,GAAS7B,EAAM6B,EAAQ++B,GACO/+B,EAAQi/B,IAA2BhlB,GAAKhhB,EACrE+G,EAAQ7B,EAAM6B,EA3KA/G,IA6Kf,OAAOkF,EAAM8b,EAAI,GAAsBja,GAASA,EAhM1C,IAiMP,CASA,SAAS6V,EAAOxV,GAEf,IAEI8f,EAIA+e,EACAllB,EACA4N,EACAuX,EACAC,EACAnlB,EACA2kB,EACAp/B,EAEA6/B,EArEiBC,EAsDjBv9B,EAAS,GACTw9B,EAAcl/B,EAAM/E,OAEpBZ,EAAI,EACJkQ,EA7MM,IA8MN40B,EA/MS,GAoOb,KALAN,EAAQ7+B,EAAMoZ,YA7NH,MA8NC,IACXylB,EAAQ,GAGJllB,EAAI,EAAGA,EAAIklB,IAASllB,EAEpB3Z,EAAM6Z,WAAWF,IAAM,KAC1Bzd,EAAM,aAEPwF,EAAO/G,KAAKqF,EAAM6Z,WAAWF,IAM9B,IAAK4N,EAAQsX,EAAQ,EAAIA,EAAQ,EAAI,EAAGtX,EAAQ2X,GAAwC,CAOvF,IAAKJ,EAAOzkC,EAAG0kC,EAAI,EAAGnlB,EAAIhhB,EAErB2uB,GAAS2X,GACZhjC,EAAM,mBAGPqiC,GAxGmBU,EAwGEj/B,EAAM6Z,WAAW0N,MAvGxB,GAAK,GACb0X,EAAY,GAEhBA,EAAY,GAAK,GACbA,EAAY,GAEhBA,EAAY,GAAK,GACbA,EAAY,GAEbrmC,IAgGQA,GAAQ2lC,EAAQzgC,GAAO4/B,EAASrjC,GAAK0kC,KACjD7iC,EAAM,YAGP7B,GAAKkkC,EAAQQ,IAGTR,GAFJp/B,EAAIya,GAAKulB,EAvQL,EAuQoBvlB,GAAKulB,EAtQzB,MAsQ8CvlB,EAAIulB,IAbHvlB,GAAKhhB,EAoBpDmmC,EAAIjhC,EAAM4/B,GADdsB,EAAapmC,EAAOuG,KAEnBjD,EAAM,YAGP6iC,GAAKC,EAKNG,EAAOV,EAAMpkC,EAAIykC,EADjBhf,EAAMpe,EAAOzG,OAAS,EACc,GAAR6jC,GAIxBhhC,EAAMzD,EAAIylB,GAAO4d,EAASnzB,GAC7BrO,EAAM,YAGPqO,GAAKzM,EAAMzD,EAAIylB,GACfzlB,GAAKylB,EAGLpe,EAAOua,OAAO5hB,IAAK,EAAGkQ,EAEvB,CAEA,OAAO8zB,EAAW38B,EACnB,CASA,SAAS09B,EAAOp/B,GACf,IAAIuK,EACA5K,EACA0/B,EACAC,EACAH,EACAxlB,EACAwI,EACAod,EACA3lB,EACAza,EACAqgC,EAGAN,EAEAO,EACAT,EACAU,EANAh+B,EAAS,GAoBb,IARAw9B,GAHAl/B,EAAQm+B,EAAWn+B,IAGC/E,OAGpBsP,EAvUU,IAwUV5K,EAAQ,EACRw/B,EA1Ua,GA6URxlB,EAAI,EAAGA,EAAIulB,IAAevlB,GAC9B6lB,EAAex/B,EAAM2Z,IACF,KAClBjY,EAAO/G,KAAKojC,EAAmByB,IAejC,IAXAH,EAAiBC,EAAc59B,EAAOzG,OAMlCqkC,GACH59B,EAAO/G,KAzVG,KA6VJ0kC,EAAiBH,GAAa,CAIpC,IAAK/c,EAAIub,EAAQ/jB,EAAI,EAAGA,EAAIulB,IAAevlB,GAC1C6lB,EAAex/B,EAAM2Z,KACDpP,GAAKi1B,EAAerd,IACvCA,EAAIqd,GAcN,IAPIrd,EAAI5X,EAAIzM,GAAO4/B,EAAS/9B,IAD5B8/B,EAAwBJ,EAAiB,KAExCnjC,EAAM,YAGPyD,IAAUwiB,EAAI5X,GAAKk1B,EACnBl1B,EAAI4X,EAECxI,EAAI,EAAGA,EAAIulB,IAAevlB,EAO9B,IANA6lB,EAAex/B,EAAM2Z,IAEFpP,KAAO5K,EAAQ+9B,GACjCxhC,EAAM,YAGHsjC,GAAgBj1B,EAAG,CAEtB,IAAKg1B,EAAI5/B,EAAOia,EAAIhhB,IAEf2mC,GADJpgC,EAAIya,GAAKulB,EAlYP,EAkYsBvlB,GAAKulB,EAjY3B,MAiYgDvlB,EAAIulB,IADTvlB,GAAKhhB,EAKlD8mC,EAAUH,EAAIpgC,EACd6/B,EAAapmC,EAAOuG,EACpBuC,EAAO/G,KACNojC,EAAmBO,EAAan/B,EAAIugC,EAAUV,EAAY,KAE3DO,EAAIzhC,EAAM4hC,EAAUV,GAGrBt9B,EAAO/G,KAAKojC,EAAmBO,EAAaiB,EAAG,KAC/CJ,EAAOV,EAAM9+B,EAAO8/B,EAAuBJ,GAAkBC,GAC7D3/B,EAAQ,IACN0/B,CACH,GAGC1/B,IACA4K,CAEH,CACA,OAAO7I,EAAOxI,KAAK,GACpB,CA2CAkd,EAAW,CAMV,QAAW,QAQX,KAAQ,CACP,OAAU+nB,EACV,OAAUE,GAEX,OAAU7oB,EACV,OAAU4pB,EACV,QA/BD,SAAiBp/B,GAChB,OAAOk+B,EAAUl+B,GAAO,SAASyL,GAChC,OAAOmyB,EAAc1iC,KAAKuQ,GACvB,OAAS2zB,EAAO3zB,GAChBA,CACJ,GACD,EA0BC,UAnDD,SAAmBzL,GAClB,OAAOk+B,EAAUl+B,GAAO,SAASyL,GAChC,OAAOkyB,EAAcziC,KAAKuQ,GACvB+J,EAAO/J,EAAOnQ,MAAM,GAAGf,eACvBkR,CACJ,GACD,QA0DE,KAFD,aACC,OAAO2K,CACP,+BAgBH,CAnhBC,E,+PCCD,SAASupB,EAAkBC,GACzB,OAAO,IAAMC,YAAYC,IACvB,IAAK,MAAMnpB,KAAQipB,EAAOG,OAAO39B,SAC/B09B,EAAK,IAAI,IAAME,KAAKrpB,IAEtB,IAAK,MAAMA,KAAQipB,EAAOK,QAAQ79B,SAChC09B,EAAK,IAAI,IAAME,KAAKrpB,IAEtBipB,EAAOM,cAAiBj7B,IACtB66B,EAAK,IAAI,IAAME,KAAK/6B,EAAE0R,MAAM,CAC7B,GAEL,CAiBA,SAAS,EAAgBA,GACvB,MAAkB,UAAdA,EAAKmH,KAAyB,IAAMqiB,QACjC,IAAMC,UAAUzpB,EAAM,cAC/B,CAEe,MAbR,WACL,OAAO,IAAM0pB,YAPRC,UAAUC,kBAGRD,UAAUC,oBAFR/nC,QAAQoE,OAAO,IAAIT,MAAM,2BAO/BqkC,QAAQb,GACRc,cAAcx7B,IAAO0F,QAAQC,KAAK,cAAe3F,EAAEy7B,OAAQ,IAAMP,WACjEK,QAAQ,GACRG,MAAM,iBACX,EC7BO,MAAMC,EAAb,cACU,KAAAptB,KAAO,EACP,KAAAqtB,OAAS,EACT,KAAAzK,UAA2B,EAC3B,KAAA0K,QAAS,EACT,KAAAC,UAAW,CA+CrB,CA7CS7hC,OAAO8hC,EAAcC,EAAoB,GAC9C,IAAsB,IAAlB5oC,KAAK+9B,SAEP,OADA/9B,KAAK+9B,SAAW4K,EACT,EAGT,GAAI3oC,KAAK+9B,WAAa4K,EAAM,CAC1B,IAAIrhC,EAAQqhC,EAAO3oC,KAAK+9B,SACpBz2B,EAAQ,EACVA,GAAS,MACAA,GAAS,IAClBA,GAAS,OAGX,MAAMuhC,EAAkBvhC,EAAQ,EAE5BtH,KAAKyoC,QAAUzoC,KAAK0oC,WAAaG,GACnC7oC,KAAK0oC,SAAWG,EAChB7oC,KAAKyoC,QAAS,EACdzoC,KAAKwoC,OAAS,GACJxoC,KAAKyoC,UACK,IAAhBzoC,KAAKwoC,QAAgBxoC,KAAKmb,MAAQytB,KACpC5oC,KAAKwoC,QAAUhjC,KAAKoD,KAAKpD,KAAK+S,IAAIjR,GAAS,MAGzCtH,KAAKwoC,QAAU,IACjBxoC,KAAKyoC,QAAS,EACdzoC,KAAK0oC,SAAWG,IAIpB7oC,KAAKmb,KAAO,EACZnb,KAAK+9B,SAAW4K,C,CAWlB,OARI3oC,KAAKmb,KAAmB,EAAZytB,IACd5oC,KAAKyoC,QAAS,EACdzoC,KAAKwoC,OAAS,EACdxoC,KAAKmb,KAAO,GAGdnb,KAAKmb,MAAQ,EAENnb,KAAKyoC,OAAUzoC,KAAK0oC,SAAW,GAAK,EAAK,CAClD,ECvBK,MAAM,EACX9oC,YAAYkpC,EAAMv/B,OAAQhE,EAAU,CAAC,GACnC,MAAM,GAASA,EAAQ,UAAY,KACnCvF,KAAK+oC,QAAUD,EACf9oC,KAAKgpC,aAAezjC,EAAQiE,UAC5BxJ,KAAKipC,kBAAoB1jC,EAAQkE,WACjCzJ,KAAKkpC,sBAAsB3jC,EAAQmE,aAAe,GAElD1J,KAAKmpC,aAAe,CAClBC,EAAON,EAAK,WAAYl8B,GAAM5M,KAAKqpC,eAAez8B,KAClDw8B,EAAON,EAAK,SAAUl8B,GAAM5M,KAAKspC,aAAa18B,KAC9C,EAAM28B,SAAS38B,GAAM5M,KAAKwpC,mBAAmB58B,MAE/C5M,KAAKypC,QAAU,CAAC,EAChBzpC,KAAK0pC,MAAQ,CAAC,CAChB,CAEAL,eAAez8B,GACb5M,KAAKypC,QAAQ,GAAG78B,EAAE+8B,UAAW,EACzB3pC,KAAKgpC,YAAYp8B,EAAEE,gBACzB,CAEAw8B,aAAa18B,GACX5M,KAAKypC,QAAQ,GAAG78B,EAAE+8B,UAAW,CAC/B,CAEAH,mBAAmB58B,GACjB,IAAKA,IAAMA,EAAE1C,KAAM,OACnB,MAAMA,EAAO0C,EAAE1C,KACTwP,EAAS,QAAQ9M,EAAEqZ,OAAOrP,MAAkB,GAAZhK,EAAE1C,KAAK,KACvC0/B,EAAc7iC,IAClB/G,KAAKypC,QAAQ,GAAG/vB,UAAexP,EAAK,MAAQnD,CAAK,EAEnD,GAAyB,MAAV,IAAVmD,EAAK,IAER0/B,GAAW,QACN,GAAyB,MAAV,IAAV1/B,EAAK,IAEXA,EAAK,GAAK,EAEZ0/B,GAAW,GAGXA,GAAW,QAER,GAAyB,MAAV,IAAV1/B,EAAK,IAEC,KAAZA,EAAK,GAEPlK,KAAKypC,QAAQ,GAAG/vB,aAAoBxP,EAAK,IAAM,GAC1B,IAAZA,EAAK,KAEdlK,KAAKypC,QAAQ,GAAG/vB,SAAgBxP,EAAK,IAAM,SAExC,GAAyB,MAAV,IAAVA,EAAK,IAAqB,CAEpC,MAAM2/B,EAAO3/B,EAAK,GAAMA,EAAK,IAAM,EACnClK,KAAKypC,QAAQ,GAAG/vB,cAAqBmwB,GAAQ,KAC7C7pC,KAAKypC,QAAQ,GAAG/vB,gBAAuBmwB,EAAO,I,CAElD,CAEAC,kBACE,MAAMC,EAAM/pC,KAAK+oC,QAAQd,UACnB+B,EAAWD,EAAIE,YACjBF,EAAIE,cACJF,EAAIG,kBACJH,EAAIG,oBACJ,GACJ,GAAKF,EACL,IAAK,IAAIhoC,EAAI,EAAGA,EAAIgoC,EAASpnC,OAAQZ,IAAK,CACxC,MAAMmoC,EAAUH,EAAShoC,GACrBmoC,GACFnqC,KAAKoqC,eAAeD,E,CAG1B,CAEAC,eAAeD,GACb,MAAMzwB,EAAS,WAAWywB,EAAQjb,QAClC,IAAK,IAAIltB,EAAI,EAAGA,EAAImoC,EAAQE,QAAQznC,OAAQZ,IAAK,CAC/C,MAAMsoC,EAASH,EAAQE,QAAQroC,GAC/BhC,KAAKypC,QAAQ,GAAG/vB,YAAiB1X,KAAOsoC,GAAUA,EAAOnpC,OAAS,E,CAEpE,IAAK,IAAIa,EAAI,EAAGA,EAAImoC,EAAQI,KAAK3nC,OAAQZ,IAAK,CAC5C,MAAMwoC,EAAW,GAAG9wB,UAAe1X,IACnC,IAAI2mC,EAAOwB,EAAQI,KAAKvoC,GAEpBhC,KAAKipC,kBACqB,MAAxBjpC,KAAK0pC,MAAMc,KACbxqC,KAAK0pC,MAAMc,GAAY,IAAIjC,GAE7BI,EAAO3oC,KAAK0pC,MAAMc,GAAU3jC,OAAO8hC,IAGrC3oC,KAAKypC,QAAQ,GAAGe,cAAuB7B,GAAQ3oC,KAAKyqC,UACpDzqC,KAAKypC,QAAQ,GAAGe,cAAuB7B,IAAS3oC,KAAKyqC,S,CAEzD,CAEA5jC,SAEE,OADA7G,KAAK8pC,kBACE9pC,KAAKypC,OACd,CAEAP,sBAAsBx/B,GACpB1J,KAAK0qC,aAAehhC,EACpB1J,KAAKyqC,UAAsC,KAAzB,EAAIzqC,KAAK0qC,cACvB1qC,KAAKyqC,UAAY,MAAMzqC,KAAKyqC,UAAY,KAC5CzqC,KAAK2qC,iBAAmB,GAAyB,EAApB3qC,KAAK0qC,YACpC,CAEAE,gCAAgCx9B,GAC9BpN,KAAKipC,gBAAkB77B,CACzB,CAEApC,UACE,IAAK,MAAMA,KAAWhL,KAAKmpC,aACzBn+B,GAEJ,EAKK,SAAS,EAAKrD,EAAQ,IAAI,EAAamhC,EAAMv/B,QAClD,OAAO,EACL,IAAMi+B,YAAYC,IAChB,MAAMoD,EAAS/B,EAAIp7B,aAAY,KAC7B+5B,EAAK,IAAI,IAAME,KAAKhgC,EAAMd,UAAU,GACnC,IACH,MAAO,IAAMiiC,EAAIn7B,cAAck9B,EAAO,IAG5C,CAEO,SAAS,EAAgB,GAC9B,OAAO,EACJnqC,KAAKmG,GAAW7F,OAAOohB,KAAKvb,GAAQyoB,QAAQjtB,GAAQwE,EAAOxE,OAC3DyoC,KAAK,IAAI,CAAC/M,EAAUvtB,IAAY,IAAEu6B,WAAWv6B,EAASutB,KACtDoK,SAAShY,GAAU,IAAM6a,UAAU7a,IACxC,CAEe,MAEf,MAAM8a,EAAe,CAAC,EAEf,SAASC,EAAQ7oC,GACtB,IAAKA,EACH,OAAO,IAAE8oC,WAAW,KAAS9oC,IAE/B,CACE,MAAMjB,EAAQiB,EAAIjB,MAAM,uCACxB,GAAIA,EACF,MAAO,MAAMA,EAAM,UAAUA,EAAM,OACpB,aAAbA,EAAM,GAAoB,IAAM,M,CAItC,CACE,MAAMA,EAAQiB,EAAIjB,MAAM,kCACxB,GAAIA,EACF,MAAO,MAAMA,EAAM,SAASA,EAAM,I,CAGtC,CACE,MAAMA,EAAQiB,EAAIjB,MAAM,6BACxB,GAAIA,EAAO,CACT,MAAMkf,EAAOlf,EAAM,GAAGX,MAAM,KACtBmW,EAAKxV,EAAM,GAIXsY,EAAS,OAFbuxB,EAAar0B,KACZq0B,EAAar0B,GAAM5V,OAAOohB,KAAK6oB,GAAcroC,OAAS,SACZxB,EAAM,GAAK,IACxD,GAAgB,SAAZkf,EAAK,GAAe,CACtB,MAAM8qB,GAAY9qB,EAAK,GAiBvB,MAAO,GAAG5G,KAhBK,CACb,IACA,KACA,IACA,KACA,IACA,IACA,KACA,IACA,KACA,IACA,KACA,KAEsB0xB,EAAW,MACpB5lC,KAAKC,MAAM2lC,EAAW,IAAM,G,CAG7C,GAAgB,UAAZ9qB,EAAK,GACP,MAAO,GAAG5G,UAA2B,OAAZ4G,EAAK,GAAc,IAAM,MAEpD,GAAgB,YAAZA,EAAK,GAAkB,MAAO,UAClC,GAAgB,QAAZA,EAAK,GAAc,MAAO,K,EAGlC,MAAO,GAAG2R,OAAO5vB,GAAK2W,QAAQ,MAAO,OACvC,CAEA,SAASowB,EAAOiC,EAASC,EAAWC,GAElC,OADAF,EAAQtmC,iBAAiBumC,EAAWC,GAC7B,WACLF,EAAQvmC,oBAAoBwmC,EAAWC,EACzC,CACF,C,mCCrOe,MARR,MAAP,cACS,KAAApqC,MAAQ,EACR,KAAAqqC,SAAU,CAInB,CAHMC,kBACF,OAAOzrC,KAAKwrC,SAAWxrC,KAAKmB,KAC9B,G,0BCwEa,IA9DR,MAAP,cACU,KAAAuqC,UAAY,IAAInlC,IAChB,KAAAolC,SAA8C,EA0DxD,CAzDE9kC,SACE,MAAM+kC,EAAU,IAAIrlC,IACpB,IAAK,MAAOlG,EAAMwrC,KAAY7rC,KAAK0rC,UAEjCG,EAAQL,SAAU,EAEpB,IAAK,MAAMM,KAAU9rC,KAAK2rC,SACxB,IAAK,MAAOtrC,EAAMc,KAAU2qC,EAAO7pC,MACjC2pC,EAAQxpC,IAAI/B,EAAMc,GAGtB,IAAK,MAAOd,EAAMc,KAAUyqC,EAAS,CACnC,MAAMC,EAAU7rC,KAAKiC,IAAI5B,GACrBwrC,EAAQ1qC,QAAUA,IACpB0qC,EAAQL,SAAU,EAClBK,EAAQ1qC,MAAQA,E,CAGtB,CAEAuF,UACE,IAAK,MAAMolC,KAAU9rC,KAAK2rC,SACxBG,EAAOplC,SAEX,CAEAzE,IAAI8pC,GAIF,OAHK/rC,KAAK0rC,UAAU3K,IAAIgL,IACtB/rC,KAAK0rC,UAAUtpC,IAAI2pC,EAAa,IAAI,GAE/B/rC,KAAK0rC,UAAUzpC,IAAI8pC,EAC5B,CAEA1/B,IAAIy/B,GACF,MAAM/kC,EAAmC,CAAC,EACpC1G,EAAO,SAAWyrC,EAAOzrC,KAC/BL,KAAK2rC,SAASrpC,KAAK,CACjBL,IAAK,IAAMixB,KAAK7yB,GAAM,WACpB,MAAMonB,EAAMqkB,EAAO7pC,MACb6oC,EAAO,GACb,IAAK,MAAMzoC,KAAO,IAAE2pC,MAAM,IAAE5pB,KAAKqF,GAAM,IAAErF,KAAKrb,IAAS,CACrD,MAAMqC,GAAQrC,EAAM1E,IAAQ,EACtBmO,GAAWiX,EAAIplB,IAAQ,EACzB+G,IAASoH,GAASs6B,EAAKxoC,KAAK,CAACD,EAAKmO,IACtCzJ,EAAM1E,GAAOmO,C,CAEf,OAAOs6B,CACT,IACApkC,QAAO,IACyB,mBAAnBolC,EAAOplC,SACTolC,EAAOplC,WAMtB,E,kCCzEF1F,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQk3B,cAAW,EACnB,IAAI6T,EAAY,EAAQ,KACpBC,EAAY,EAAQ,KACpBC,EAAoB,EAAQ,KAa5B/T,EAA0B,WAC1B,SAASA,IAILp4B,KAAKw5B,QAAU,IAAIyS,EAAUtqC,WAI7B3B,KAAKs5B,QAAU,IAAI4S,EAAU3pC,WAI7BvC,KAAKo5B,eAAiB,IAAI+S,EAAkB5oC,cAChD,CAWA,OAHA60B,EAASt2B,UAAU4B,cAAgB,SAAUZ,EAASC,GAClD,OAAO/C,KAAKo5B,eAAe11B,cAAcZ,EAASC,EACtD,EACOq1B,CACX,CA1B6B,GA2B7Bl3B,EAAQk3B,SAAWA,C,sBC7CnB,YA4BA,SAASgU,EAAezyB,EAAO0yB,GAG7B,IADA,IAAI1oB,EAAK,EACA3hB,EAAI2X,EAAM/W,OAAS,EAAGZ,GAAK,EAAGA,IAAK,CAC1C,IAAIoH,EAAOuQ,EAAM3X,GACJ,MAAToH,EACFuQ,EAAMiK,OAAO5hB,EAAG,GACE,OAAToH,GACTuQ,EAAMiK,OAAO5hB,EAAG,GAChB2hB,KACSA,IACThK,EAAMiK,OAAO5hB,EAAG,GAChB2hB,IAEJ,CAGA,GAAI0oB,EACF,KAAO1oB,IAAMA,EACXhK,EAAMiI,QAAQ,MAIlB,OAAOjI,CACT,CAyOA,SAAS2V,EAAQgd,EAAI/8B,GACjB,GAAI+8B,EAAGhd,OAAQ,OAAOgd,EAAGhd,OAAO/f,GAEhC,IADA,IAAIg9B,EAAM,GACDvqC,EAAI,EAAGA,EAAIsqC,EAAG1pC,OAAQZ,IACvBuN,EAAE+8B,EAAGtqC,GAAIA,EAAGsqC,IAAKC,EAAIjqC,KAAKgqC,EAAGtqC,IAErC,OAAOuqC,CACX,CA5OArrC,EAAQd,QAAU,WAIhB,IAHA,IAAIosC,EAAe,GACfC,GAAmB,EAEdzqC,EAAIoxB,UAAUxwB,OAAS,EAAGZ,IAAM,IAAMyqC,EAAkBzqC,IAAK,CACpE,IAAIxB,EAAQwB,GAAK,EAAKoxB,UAAUpxB,GAAK0qC,EAAQC,MAG7C,GAAoB,iBAATnsC,EACT,MAAM,IAAI0f,UAAU,6CACV1f,IAIZgsC,EAAehsC,EAAO,IAAMgsC,EAC5BC,EAAsC,MAAnBjsC,EAAK8hB,OAAO,GACjC,CAUA,OAASmqB,EAAmB,IAAM,KAJlCD,EAAeJ,EAAe9c,EAAOkd,EAAa/rC,MAAM,MAAM,SAASqhB,GACrE,QAASA,CACX,KAAK2qB,GAAkB5rC,KAAK,OAE6B,GAC3D,EAIAK,EAAQ0rC,UAAY,SAASpsC,GAC3B,IAAIqjB,EAAa3iB,EAAQ2iB,WAAWrjB,GAChCqsC,EAAqC,MAArBpsB,EAAOjgB,GAAO,GAclC,OAXAA,EAAO4rC,EAAe9c,EAAO9uB,EAAKC,MAAM,MAAM,SAASqhB,GACrD,QAASA,CACX,KAAK+B,GAAYhjB,KAAK,OAERgjB,IACZrjB,EAAO,KAELA,GAAQqsC,IACVrsC,GAAQ,MAGFqjB,EAAa,IAAM,IAAMrjB,CACnC,EAGAU,EAAQ2iB,WAAa,SAASrjB,GAC5B,MAA0B,MAAnBA,EAAK8hB,OAAO,EACrB,EAGAphB,EAAQL,KAAO,WACb,IAAIisC,EAAQ7jB,MAAMnnB,UAAUmB,MAAMsT,KAAK6c,UAAW,GAClD,OAAOlyB,EAAQ0rC,UAAUtd,EAAOwd,GAAO,SAAShrB,EAAGoN,GACjD,GAAiB,iBAANpN,EACT,MAAM,IAAI5B,UAAU,0CAEtB,OAAO4B,CACT,IAAGjhB,KAAK,KACV,EAKAK,EAAQ2d,SAAW,SAAS4R,EAAMgP,GAIhC,SAASlf,EAAKwsB,GAEZ,IADA,IAAIjiC,EAAQ,EACLA,EAAQiiC,EAAInqC,QACE,KAAfmqC,EAAIjiC,GADiBA,KAK3B,IADA,IAAIgH,EAAMi7B,EAAInqC,OAAS,EAChBkP,GAAO,GACK,KAAbi7B,EAAIj7B,GADOA,KAIjB,OAAIhH,EAAQgH,EAAY,GACjBi7B,EAAI9pC,MAAM6H,EAAOgH,EAAMhH,EAAQ,EACxC,CAhBA2lB,EAAOvvB,EAAQd,QAAQqwB,GAAMhQ,OAAO,GACpCgf,EAAKv+B,EAAQd,QAAQq/B,GAAIhf,OAAO,GAsBhC,IALA,IAAIusB,EAAYzsB,EAAKkQ,EAAKhwB,MAAM,MAC5BwsC,EAAU1sB,EAAKkf,EAAGh/B,MAAM,MAExBmC,EAAS4C,KAAKwD,IAAIgkC,EAAUpqC,OAAQqqC,EAAQrqC,QAC5CsqC,EAAkBtqC,EACbZ,EAAI,EAAGA,EAAIY,EAAQZ,IAC1B,GAAIgrC,EAAUhrC,KAAOirC,EAAQjrC,GAAI,CAC/BkrC,EAAkBlrC,EAClB,KACF,CAGF,IAAImrC,EAAc,GAClB,IAASnrC,EAAIkrC,EAAiBlrC,EAAIgrC,EAAUpqC,OAAQZ,IAClDmrC,EAAY7qC,KAAK,MAKnB,OAFA6qC,EAAcA,EAAYz9B,OAAOu9B,EAAQhqC,MAAMiqC,KAE5BrsC,KAAK,IAC1B,EAEAK,EAAQksC,IAAM,IACdlsC,EAAQmsC,UAAY,IAEpBnsC,EAAQosC,QAAU,SAAU9sC,GAE1B,GADoB,iBAATA,IAAmBA,GAAc,IACxB,IAAhBA,EAAKoC,OAAc,MAAO,IAK9B,IAJA,IAAIixB,EAAOrzB,EAAKghB,WAAW,GACvB+rB,EAAmB,KAAT1Z,EACV/hB,GAAO,EACP07B,GAAe,EACVxrC,EAAIxB,EAAKoC,OAAS,EAAGZ,GAAK,IAAKA,EAEtC,GAAa,MADb6xB,EAAOrzB,EAAKghB,WAAWxf,KAEnB,IAAKwrC,EAAc,CACjB17B,EAAM9P,EACN,KACF,OAGFwrC,GAAe,EAInB,OAAa,IAAT17B,EAAmBy7B,EAAU,IAAM,IACnCA,GAAmB,IAARz7B,EAGN,IAEFtR,EAAKyC,MAAM,EAAG6O,EACvB,EAgCA5Q,EAAQusC,SAAW,SAAUjtC,EAAMktC,GACjC,IAAIn+B,EA/BN,SAAkB/O,GACI,iBAATA,IAAmBA,GAAc,IAE5C,IAGIwB,EAHA8I,EAAQ,EACRgH,GAAO,EACP07B,GAAe,EAGnB,IAAKxrC,EAAIxB,EAAKoC,OAAS,EAAGZ,GAAK,IAAKA,EAClC,GAA2B,KAAvBxB,EAAKghB,WAAWxf,IAGhB,IAAKwrC,EAAc,CACjB1iC,EAAQ9I,EAAI,EACZ,KACF,OACkB,IAAT8P,IAGX07B,GAAe,EACf17B,EAAM9P,EAAI,GAId,OAAa,IAAT8P,EAAmB,GAChBtR,EAAKyC,MAAM6H,EAAOgH,EAC3B,CAKU27B,CAASjtC,GAIjB,OAHIktC,GAAOn+B,EAAEkR,QAAQ,EAAIitB,EAAI9qC,UAAY8qC,IACvCn+B,EAAIA,EAAEkR,OAAO,EAAGlR,EAAE3M,OAAS8qC,EAAI9qC,SAE1B2M,CACT,EAEArO,EAAQysC,QAAU,SAAUntC,GACN,iBAATA,IAAmBA,GAAc,IAQ5C,IAPA,IAAIotC,GAAY,EACZC,EAAY,EACZ/7B,GAAO,EACP07B,GAAe,EAGfM,EAAc,EACT9rC,EAAIxB,EAAKoC,OAAS,EAAGZ,GAAK,IAAKA,EAAG,CACzC,IAAI6xB,EAAOrzB,EAAKghB,WAAWxf,GAC3B,GAAa,KAAT6xB,GASS,IAAT/hB,IAGF07B,GAAe,EACf17B,EAAM9P,EAAI,GAEC,KAAT6xB,GAEkB,IAAd+Z,EACFA,EAAW5rC,EACY,IAAhB8rC,IACPA,EAAc,IACK,IAAdF,IAGTE,GAAe,QArBb,IAAKN,EAAc,CACjBK,EAAY7rC,EAAI,EAChB,KACF,CAoBN,CAEA,OAAkB,IAAd4rC,IAA4B,IAAT97B,GAEH,IAAhBg8B,GAEgB,IAAhBA,GAAqBF,IAAa97B,EAAM,GAAK87B,IAAaC,EAAY,EACjE,GAEFrtC,EAAKyC,MAAM2qC,EAAU97B,EAC9B,EAYA,IAAI2O,EAA6B,MAApB,KAAKA,QAAQ,GACpB,SAAU3H,EAAKhO,EAAOijC,GAAO,OAAOj1B,EAAI2H,OAAO3V,EAAOijC,EAAK,EAC3D,SAAUj1B,EAAKhO,EAAOijC,GAEpB,OADIjjC,EAAQ,IAAGA,EAAQgO,EAAIlW,OAASkI,GAC7BgO,EAAI2H,OAAO3V,EAAOijC,EAC7B,C,sDC5SJ,yEAsHA,MAAMC,EACJpuC,YACU+zB,EACAlf,EACQpU,GAFR,KAAAszB,YACA,KAAAlf,MACQ,KAAApU,MACf,CAEHP,KAAKC,GACH,OAAO,IACLA,EACAC,KAAK2zB,UACFsa,QAAQjuC,KAAKyU,KACbtG,MAAMI,GAAS,YAASA,GAAMtO,GAAG,iBAExC,CAEAC,mBACE,MAAMqO,QAAavO,KAAK2zB,UAAUsa,QAAQjuC,KAAKyU,KAC/C,OAAO3T,IAAI0N,gBAAgBD,EAC7B,EAGF,MAAM2/B,EAGJtuC,YACU+zB,EACR5kB,GADQ,KAAA4kB,YAGR3zB,KAAKmuC,aAAexa,EAAUpzB,KAAK2N,KAAKa,EAAKvO,KAC/C,CAEAsO,OACE,OACE9O,KAAKyL,WACJzL,KAAKyL,SAAWzL,KAAK2zB,UAAUya,YAAYpuC,KAAKmuC,cAErD,EAKFjuC,eAAemuC,EAAW9/B,GAExB,GAAc,qBADM,YAASA,EAAKtL,MAAM,EAAG,KAAKhD,GAAG,QAEjD,MAAM,IAAI6D,MAAM,wBAElB,MAAMiX,QAAe,YAASxM,EAAKtL,MAAM,GAAI,KAAKhD,GAAG,eAC/CkwB,EAAQ,IAAIvS,WAAW7C,GAGvBuzB,EADJne,EAAM,IAAMA,EAAM,IAAM,IAAMA,EAAM,IAAM,KAAOA,EAAM,IAAM,IAE/D,OAAO5hB,EAAKtL,MAAM,GAAKqrC,EACzB,CAbe,IA9IR,MAcL1uC,YACEW,EACAgF,EAII,CAAC,GAXA,KAAAxF,SAAW,CAChBiD,IAAK,IAAI,IACTwN,QAAS,IAAI,KA0CP,KAAA+9B,aAAe,IAAEvpC,MAAK9E,UAC5B,MAAMgO,QAAalO,KAAKwuC,MAAMtgC,KAAKlO,KAAKyuC,mBAClCvkC,QAAagE,EAAKpO,OAClBuB,QAAa,IAAIiN,KAAK,CAACpE,IAAO7I,OACpC,OAAOqtC,KAAKh3B,MAAMrW,EAAyB,IAGrC,KAAAstC,SAAW,IAAE3pC,MAAK9E,gBACDF,KAAKuuC,gBACZ35B,KAAKlU,KAAKqO,GAAS,IAAIm/B,EAAIluC,KAAM+O,OAG3C,KAAA6/B,YAAc,IAAE5pC,MAAK9E,UAC3B,MAAMs1B,QAAiBx1B,KAAKuuC,eACtB1nB,EAAQ,IAAItgB,IAClB,IAAK,MAAM2H,KAAQsnB,EAAS3O,MAC1BA,EAAMzkB,IAAI8L,EAAK7N,KAAK6B,cAAegM,GAErC,OAAO2Y,CAAK,IAjDQ,iBAATtmB,IACTA,EAAO,IAAI,IAAa,IAAIO,IAAIP,EAAMsuC,SAAS9tC,QAGjD,MAAM+tC,EACwB,iBAArBvpC,EAAQupC,SACX,IAAI,IAAa,IAAIhuC,IAAIyE,EAAQupC,SAAUD,SAAS9tC,OACpDwE,EAAQupC,SAEd9uC,KAAKwuC,MAAQjuC,EACbP,KAAK+uC,UAAYD,EACjB9uC,KAAKgvC,iBAAmBzpC,EAAQ0pC,gBAChCjvC,KAAKyuC,kBAAoBlpC,EAAQ2pC,kBAAoB,gBAErD,MAAMC,EAAe,IAA2BnvC,KAAKD,SAASyQ,SAM9DxQ,KAAKouC,YAAc,IACjBpuC,KAAKD,SAASiD,IACd,IAAO,GAAIosC,GACTA,EACGjhC,MAAMylB,GAAaA,EAAS9zB,KATd,MACnB,MAAMC,EAAW,IAAI,IAErB,OADAovC,EAAa1sC,IAAI1C,GACVA,CAAQ,EAMuBsvC,MACjClhC,MAAME,GAAgB,IAAIC,KAAK,CAACD,MAChCF,KAAKkgC,KAGd,CAuBI9tC,WACF,OAAOP,KAAKwuC,KACd,CAEAtuC,WAAWG,GACT,MACM6N,SADgBlO,KAAK4uC,eACN3sC,IAAI5B,EAAK6B,eAC9B,GAAIgM,EACF,OAAO,IAAI8/B,EAA0BhuC,KAAMkO,EAAKuG,IAAKvG,EAAK7N,MACrD,GACLL,KAAK+uC,WACL/uC,KAAKgvC,kBACLhvC,KAAKgvC,iBAAiBnsC,KAAKxC,GAE3B,OAAOL,KAAK+uC,UAAU7gC,KAAK7N,GAE3B,MAAM,IAAIyD,MAAM,mBAAqBzD,EAEzC,CAEAH,eAAegvB,EAAOpkB,EAAOgH,IAC3B,MACM2C,SADazU,KAAK2uC,YACPzf,GAEjB,aADsBza,EAAI3F,QACX7L,MAAM6H,EAAOgH,EAC9B,E,sBClHF,IAAIw9B,EAAW,EAAQ,KACvB1pC,EAAO1E,QAEP,SAAcrB,EAAK4B,EAAU8tC,GAC3B,IAAIC,EAAK,IAAIC,UAAU5vC,GACnB6vC,EAAS,GAcb,SAASC,IACP,IACEH,EAAGI,KAAK,IAAK,IAAIz4B,MAAO04B,UAG1B,CAFE,MAAOjjC,GAET,CACF,CAnBA4iC,EAAGM,UAAY,SAASljC,GAoBxB,IAAiBvL,EACX0uC,EACA1sC,EACAC,EACAo9B,EAvBU,KAAV9zB,EAAE1C,MACJylC,IAEE/iC,EAAE1C,KAAKF,QAAQ,MAAQ,IAgBZ3I,EAfLuL,EAAE1C,KAgBR6lC,EAAS1uC,EAAKZ,MAAM,KACpB4C,GAAK0sC,EAAO,GACZzsC,GAAKysC,EAAO,GACZrP,GAAI,IAAIvpB,MAAO04B,UACfxsC,GAAKq9B,GAAGgP,EAAOptC,KAAKgtC,EAASU,QAAQ,CAAC3sC,EAAGC,EAAGA,EAAGo9B,KAC/CgP,EAAO9sC,QAAU,GACf2sC,GAAWA,EAAUD,EAASl9B,OAAOs9B,IArBzCC,IAEJ,EACAH,EAAGS,QAAU,WACX,OAAIP,EAAO9sC,OAAS,EAAUnB,EAAS,IAAIqC,MAAM,uBAC1CrC,EAAS,KAAM6tC,EAASl9B,OAAOs9B,GACxC,CAkBF,C,oBCpCAxuC,EAAQ8uC,QAAU,SAAiB7f,GACjC,IAAI+f,EAAK/f,EAAM,GACXggB,EAAKhgB,EAAM,GACXigB,EAAKjgB,EAAM,GACXkgB,EAAKlgB,EAAM,GACf,MAAO,CACL/d,QAAU+9B,EAAKD,GAAOE,EAAKC,IAAO,EAClClrC,MAASkrC,EAAKH,GAAOE,EAAKD,GAE9B,EAEAjvC,EAAQkR,OAAS,SAAgBs9B,IAC/BA,EAASA,EAAOzsC,SACTG,MAAK,SAASC,EAAGC,GACtB,OAAOD,EAAE+O,OAAS9O,EAAE8O,MACtB,KACAs9B,EAASA,EAAOzsC,MAAM,EAAGysC,EAAO9sC,OAAS,IAClCQ,MAAK,SAASC,EAAGC,GACtB,OAAOD,EAAE8B,MAAQ7B,EAAE6B,KACrB,IAGA,IAFA,IAAIxB,EAAM,EAAGkvB,EAAQ,EACjByd,EAAK9qC,KAAKoD,KAAK8mC,EAAO9sC,OAAS,GAC1BZ,EAAI,EAAGA,EAAI0tC,EAAO9sC,SACrB8sC,EAAO1tC,GAAGmD,MAAQuqC,EAAO,GAAGvqC,OAAOmrC,IAC5B,IAAPA,GAF6BtuC,IAGjC2B,GAAO+rC,EAAO1tC,GAAGoQ,OACjBygB,GAAS,EAEX,OAAOlvB,EAAMkvB,CACf,C,mCC9BA,aAEe,iB,sBCDf,IAAIjC,EAAU,EAAQ,KAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAAChrB,EAAO5D,EAAI4uB,EAAS,MAOhE,IAAIrrB,EAAU,CAAC,KAAM,EAErBA,UAPIsrB,UAQJtrB,gBAAqByQ,GAER,EAAQ,EAAR,CAAsH4a,EAASrrB,GAEzIqrB,EAAQE,SAAQlrB,EAAO1E,QAAU0vB,EAAQE,O,uBCjBlClrB,EAAO1E,QAAU,EAAQ,EAAR,EAA8H,IAKjJoB,KAAK,CAACsD,EAAO5D,EAAI,wIAAyI,I,mCCLlK,IAyBKuuC,EAzBL,oDAyBA,SAAKA,GAEH,kBAEA,sBAEA,iBACD,CAPD,CAAKA,MAAU,KA0UA,IAlTR,MAuBL3wC,YAA4B6G,GAuQ9B,IAAoBM,EAvQU,KAAAN,SAlBrB,KAAA+pC,cAVA,CAAEC,OAAQ,GAAIC,UAAW,IAczB,KAAAzjC,UAAW,EAEX,KAAA0jC,SAAU,EACV,KAAAhpC,MAA8B,IAAIpB,IAOjC,KAAAqqC,UAAY,EAEZ,KAAAC,UAAqD,KAG3D7wC,KAAK8wC,SAAWrqC,EAAO46B,QACvBrhC,KAAK+wC,oBAAsB,IAAEtqC,EAAOkK,UAAU0a,OAC3C4U,QAAQ/tB,GAAMA,EAAEzK,OAChBupC,SAAS9+B,GAAMA,EAAEmc,SACjB4iB,WAkQalqC,EAlQQ/G,KAmQnB,SAAqBqrB,GAC1B,IAAI6lB,EAAa,EACjB,MAAO,CACL7lB,QACI6lB,iBACF,OAAOA,CACT,EACArqC,SACE,KACEqqC,EAAa7lB,EAAMzoB,QACwB,WAA3CmE,EAAMoqC,cAAc9lB,EAAM6lB,KAE1BA,GAAc,CAElB,EAEJ,IAlRK/vC,QACHnB,KAAKoxC,YAAc,IAAI7qC,IACvBvG,KAAKqsB,UAAY5lB,EAAOkK,UAAUiB,SAClC5R,KAAKqxC,OAAS,YAAqB5qC,EAAOkK,UAAW,CACnDywB,SAAU36B,EAAOlB,QAAQ67B,WAE3BphC,KAAK8N,MAAQ,IAAI,IAAYrH,EAAOkK,WACpC3Q,KAAK6tB,MAAQpnB,EAAOlB,QAAQsoB,KAC9B,CAKAhnB,OAAOyqC,EAAkB3pC,GACvB3H,KAAK4wC,UAAYU,EACjBtxC,KAAKuxC,UAAY5pC,EACjB3H,KAAKwwC,cAlDA,CAAEC,OAAQ,GAAIC,UAAW,IAmD9B1wC,KAAKwxC,wBACLxxC,KAAKyxC,cACLzxC,KAAK0xC,eACDJ,EAAWtxC,KAAKqsB,UAAY,IAAGrsB,KAAKiN,UAAW,EACrD,CAEAkkC,cAAcpkB,GACZ,MAAM5iB,EAASnK,KAAKoxC,YAAYnvC,IAAI8qB,GACpC,OAAK5iB,EACEA,EAAO4F,OADMwgC,EAAWoB,QAEjC,CAEAC,gBAAgB7kB,GACd,MAAM5iB,EAASnK,KAAKoxC,YAAYnvC,IAAI8qB,GACpC,OAAK5iB,EACEA,EAAO+4B,SADM,IAASyO,QAE/B,CAEAE,eAAehG,GACb,OAAO7rC,KAAKuxC,UAAWtvC,IAAI,IAAIjC,KAAKyG,OAAO4M,UAAUw4B,IACvD,CAEA2F,wBACExxC,KAAK2H,MAAQ,IAAIpB,IACfvG,KAAK8wC,SAASpwC,KAAK2tB,GAAW,CAACA,EAAQruB,KAAK6xC,eAAexjB,MAE/D,CAEAojB,cACE,IAAK,MAAMpjB,KAAUruB,KAAK8wC,SAAU,CAClC,MAAM/1B,EAAS/a,KAAK+wC,oBAAoB1iB,GACxC,GAAItT,EAAQ,CACV,MAAM8wB,EAAU7rC,KAAK2H,MAAM1F,IAAIosB,GAC/BruB,KAAK8xC,aAAa/2B,EAAQ8wB,EAASxd,GACnCtT,EAAOlU,Q,EAGb,CAEA6qC,eACM1xC,KAAK6xC,eAAe,WAAWpG,aACjCzrC,KAAK+xC,aAAa,GAEhB/xC,KAAK6xC,eAAe,aAAapG,aACnCzrC,KAAK+xC,cAAc,GAErB,MAAMC,EAAQhyC,KAAK6xC,eAAe,SAAS1wC,MAM3C,GALI6wC,IAAUhyC,KAAK6wC,UACjB7wC,KAAK6wC,UAAY,CAAE/lC,MAAOknC,EAAOnkB,MAAO7tB,KAAK6tB,OACnCmkB,IACVhyC,KAAK6wC,UAAY,MAEfmB,GAAShyC,KAAK6wC,UAAW,CAC3B,MAAMoB,EAAWjyC,KAAK6wC,UAChBhjB,EAASokB,EAASpkB,MAAQmkB,EAASC,EAASnnC,MAClD9K,KAAK6tB,MAAQroB,KAAK+V,IAAI,GAAK/V,KAAKgO,MAAc,GAARqa,GAAc,G,CAExD,CAEAkkB,aAAaG,GACX,MAAMjjB,EAASjvB,KAAKuxC,UAAWtvC,IAAI,UAAUd,MACzC,GACAnB,KAAK6tB,MAAQ,GACb,GACA,GACJ7tB,KAAK6tB,OAASqkB,EAAYjjB,EACtBjvB,KAAK6tB,MAAQ,KAAK7tB,KAAK6tB,MAAQ,GACrC,CAEAskB,kBACE,OAAOnyC,KAAKyG,OAAOlB,QAAQy7B,mBAuKnBz3B,OAAe6oC,eAtKzB,CAEAN,aAAa/2B,EAAoB8wB,EAAkBxd,GACjD,IAAIgkB,EACAnP,EACJ,MAAM7X,EAAQtQ,EAAOsQ,MACrB,IAAIinB,GAAa,EACjB,IAAK,IAAItwC,EAAI+Y,EAAOm2B,WAAYlvC,EAAIqpB,EAAMzoB,OAAQZ,IAAK,CACrD,MAAM+qB,EAAO1B,EAAMrpB,GACnB,GAAIhC,KAAKuyC,aAAaxlB,EAAM8e,EAAS9wB,GAAS,CAC5C,MAAMy3B,EAA2C,WAA7BxyC,KAAKmxC,cAAcpkB,GAMvC,GALAslB,EAAatlB,EACbmW,EAAWljC,KAAKyyC,WAAW1lB,GACvB/sB,KAAKmyC,oBACPG,GAAa,GAEXE,EAAa,K,EAGrB,GAAI3G,EAAQJ,aAAe6G,EACzB,GAAID,GAA0B,MAAZnP,EAChBljC,KAAKwwC,cAAcC,OAAQnuC,KAAK,CAC9ByqB,KAAMslB,EACN5sB,KAAM,MACNyd,SAAUA,QAEP,CACL,MAAMwP,EAAgB1yC,KAAK2yC,kBAAkBtnB,GAC7C,GAAIqnB,EAAe,EAEmB,OAAlC1yC,KAAKyG,OAAOlB,QAAQuvB,YACnB90B,KAAK4yC,cAAcvkB,KAEpBruB,KAAKwwC,cAAcC,OAAQnuC,KAAK,CAC9ByqB,KAAM2lB,EACNjtB,KAAM,Q,EAMlB,CAEAotB,gBAAgBxnB,GACd,OAAO,IAAEynB,MAAMznB,GAAQ0B,GAASvnB,KAAK+S,IAAIvY,KAAK4wC,UAAY7jB,EAAKtlB,OACjE,CAEAkrC,kBAAkBtnB,GAChB,OAAO,IAAEynB,MAAMznB,GAAQ0B,GACJvnB,KAAK+S,IAAIvY,KAAK4wC,UAAY7jB,EAAKtlB,OAChCzH,KAAK4wC,UAAY7jB,EAAKtlB,KAAO,EAAI,IAAU,IAG/D,CAEAmrC,cAAcvkB,GACZ,MAAM+L,EAAuC,CAC3C,EAAK,CAAC,IAAK,KACX,EAAK,CAAC,IAAK,KACX,EAAK,CAAC,IAAK,KACX,EAAK,CAAC,IAAK,KACX,EAAK,CAAC,IAAK,MAEb,QAAKA,EAAQ/L,IACN+L,EAAQ/L,GAAQ0kB,OAAOC,IAC5B,MAAMj4B,EAAS/a,KAAK+wC,oBAAoBiC,GACxC,QAAKj4B,GACEA,EAAOsQ,MAAM4nB,MACjBlmB,GAASvnB,KAAK+S,IAAIvY,KAAK4wC,UAAY7jB,EAAKtlB,MAAQ,IAClD,GAEL,CAEA8qC,aAAaxlB,EAAgB8e,EAAkB9wB,GAC7C,MAAMhL,EAAS/P,KAAKmxC,cAAcpkB,GAClC,GAAe,aAAXhd,EAAuB,CACzB,GAAI/P,KAAKmyC,mBAAqBnyC,KAAK4wC,WAAa7jB,EAAKtlB,KAEnD,OADAzH,KAAK2wC,SAAU,GACR,EAET,MAAMzN,EAAW,YAAUljC,KAAK4wC,UAAW7jB,EAAKtlB,KAAMzH,KAAKqxC,QACrD6B,EAAShQ,IAAa,IAC5B,IAAIiQ,EAAMjQ,EAAW,GAAK2I,EAAQL,SAAWK,EAAQ1qC,MAIrD,OAHI,YAAM+hC,IAAaljC,KAAK6yC,gBAAgB93B,EAAOsQ,SAAW0B,IAC5DomB,GAAM,GAEDD,GAAUC,C,CACZ,GAAe,WAAXpjC,EAAqB,CAC9B,MAAMqjC,EAAUrmB,EAAKjb,KAAO,KAAU,EAAO,uBAC7C,GAAI9R,KAAKmyC,mBAAqBnyC,KAAK4wC,WAAawC,EAAQ3rC,KAEtD,OADAzH,KAAK2wC,SAAU,GACR,EAET,MACMuC,EADW,YAAalzC,KAAK4wC,UAAWwC,EAAQ3rC,KAAMzH,KAAKqxC,UACrC,IACtBgC,EAASxH,EAAQL,QACjB3hC,EAA0B,OAAhBkjB,EAAKsB,OACfilB,EAAStzC,KAAK4wC,WAAawC,EAAQ3rC,KACzC,OAAOyrC,GAAUG,GAAWxpC,GAAWypC,C,CAEvC,OAAO,CAEX,CAEAb,WAAW1lB,GACT,IAAIzlB,EAAQtH,KAAK4wC,UAAY7jB,EAAKtlB,KAC9By7B,EAAW,YAAUljC,KAAK4wC,UAAW7jB,EAAKtlB,KAAMzH,KAAKqxC,QACrDlnC,EAASnK,KAAKoxC,YAAYnvC,IAAI8qB,GAClC,MAAMwmB,GAAUppC,GAA4B,aAAlBA,EAAO4F,OAC3ByjC,EAAOrpC,GAA4B,WAAlBA,EAAO4F,OAI9B,GAHI/P,KAAKmyC,mBAAqBjP,GAAY,IACxCA,EAAW,GAETnW,EAAKjb,KACP,GAAIyhC,EAAQ,CACV,MAAMxjC,EACJmzB,IAAa,IAASqN,EAAWkD,OAASlD,EAAWmD,OACnDxQ,IAAa,KAEfljC,KAAK2zC,aAAazQ,EAAU57B,EAAOylB,EAAKsB,QAE1ClkB,EAAS,CAAE4F,SAAQmzB,WAAU57B,Q,MACxB,GAAIksC,EAAM,CACf,MAAM3pC,EAA0B,OAAhBkjB,EAAKsB,OACrB/mB,EAAQtH,KAAK4wC,UAAY7jB,EAAKjb,IAAIrK,KAClCy7B,EACE,YAAaljC,KAAK4wC,UAAW7jB,EAAKjb,IAAIrK,KAAMzH,KAAKqxC,SAAW,IAC1DxnC,GAAWvC,EAAQ,IAAG47B,EAAW,GACrC/4B,EAAS,CAAE4F,OAAQwgC,EAAWkD,OAAQvQ,WAAU57B,Q,OAGlD6C,EAAS,CAAE4F,OAAQwgC,EAAWkD,OAAQvQ,WAAU57B,SAQlD,GANI47B,IAAa,KACfljC,KAAKwwC,cAAcC,OAAOnuC,KAAK,CAAEyqB,OAAMtH,KAAM,UAE3C8tB,GAAUrQ,IAAa,KACzBljC,KAAK8N,MAAMw1B,YAAYh8B,IAEpB6C,EACH,MAAM,IAAIrG,MAAM,qDAElB,IAAKo/B,EACH,MAAM,IAAIp/B,MACR,4DAKJ,OAFA9D,KAAKoxC,YAAYhvC,IAAI2qB,EAAM5iB,GAC3BnK,KAAK2zC,aAAazQ,EAAU57B,EAAOylB,EAAKsB,QACjC6U,CACT,CAEAyQ,aAAazQ,EAA0B57B,EAAe+mB,GACpDruB,KAAK8N,MAAMm1B,eAAeC,GAC1B,MAAM1rB,EAAO,CAAE0rB,WAAUvB,MAAO3hC,KAAK8N,MAAM6zB,MAAOr6B,QAAO+mB,UACzDruB,KAAKwwC,cAAcE,UAAUpuC,KAAKkV,EACpC,E,oBCvTF,SAAS3K,EAAQ+mC,GAEf,GAAIA,GAAe,iBAAoBA,EAAa,CAClD,IAAIC,EAAaD,EAAYjK,OAASiK,EAAY/mC,SAAW+mC,EAAYE,SACrED,IAAYD,EAAcC,EAChC,CAGA,GAAI,iBAAoBD,EAAa,OAAOG,EAAMH,GAGlD,IAOII,EAPAv1B,EAASwT,OAAO2hB,GAIpB,OADII,EAAgBC,EAAMx1B,EAAOvc,gBACP8xC,GAGtBA,EAAgBE,EAAQz1B,EAAOvc,kBAIb,IAAlBuc,EAAO7b,OAAqB6b,EAAO+C,WAAW,QAAlD,EAGF,CAUA3U,EAAQsnC,WAAa,SAAoBrkB,EAAOskB,GAC9C,GAAItkB,GAAS,iBAAoBA,EAAO,CACtC,IAAIjjB,EAAUijB,EAAM6Z,OAAS7Z,EAAMjjB,SAAWijB,EAAMgkB,SACpD,GAAIjnC,QAA6C,OAAO,EACxD,GAA0B,iBAAfunC,EAAyB,CAElC,IAIIJ,EAHJ,GADIA,EAAgBC,EAAMG,EAAWlyC,eAChB,OAAO8xC,IAAkBnnC,EAI9C,GADImnC,EAAgBE,EAAQE,EAAWlyC,eAClB,OAAO8xC,IAAkBnnC,CAChD,MAAO,GAA0B,iBAAfunC,EAChB,OAAOA,IAAevnC,EAExB,OAAO,CACT,CACF,EAUA,IAAIonC,GARJ/yC,EAAU0E,EAAO1E,QAAU2L,GAQPgnB,KAAO3yB,EAAQ+yC,MAAQ,CACzC,UAAa,EACb,IAAO,EACP,MAAS,GACT,MAAS,GACT,KAAQ,GACR,IAAO,GACP,cAAe,GACf,YAAa,GACb,IAAO,GACP,MAAS,GACT,UAAW,GACX,YAAa,GACb,IAAO,GACP,KAAQ,GACR,KAAQ,GACR,GAAM,GACN,MAAS,GACT,KAAQ,GACR,OAAU,GACV,OAAU,GACV,QAAW,GACX,eAAgB,GAChB,gBAAiB,GACjB,WAAY,IACZ,WAAY,IACZ,WAAY,IACZ,WAAY,IACZ,WAAY,IACZ,WAAY,IACZ,cAAe,IACf,cAAe,IACf,gBAAiB,IACjB,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,IAAK,IACL,KAAM,IACN,IAAK,IACL,IAAK,KAKHC,EAAUhzC,EAAQgzC,QAAU,CAC9B,QAAW,GACX,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAK,GACL,IAAO,GACP,QAAW,GACX,OAAU,GACV,MAAS,GACT,MAAS,GACT,KAAQ,GACR,OAAU,GACV,OAAU,GACV,IAAO,GACP,SAAY,GACZ,KAAQ,GACR,KAAQ,GACR,IAAO,GACP,IAAO,GACP,IAAO,IAQT,IAAKlyC,EAAI,GAAIA,EAAI,IAAKA,IAAKiyC,EAAMhiB,OAAO0T,aAAa3jC,IAAMA,EAAI,GAG/D,IAAK,IAAIA,EAAI,GAAIA,EAAI,GAAIA,IAAKiyC,EAAMjyC,EAAI,IAAMA,EAG9C,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKiyC,EAAM,IAAIjyC,GAAKA,EAAI,IAG5C,IAAKA,EAAI,EAAGA,EAAI,GAAIA,IAAKiyC,EAAM,UAAUjyC,GAAKA,EAAI,GAQlD,IAAI+xC,EAAQ7yC,EAAQ6yC,MAAQ7yC,EAAQ8S,MAAQ,CAAC,EAG7C,IAAKhS,KAAKiyC,EAAOF,EAAME,EAAMjyC,IAAMA,EAGnC,IAAK,IAAIqyC,KAASH,EAChBD,EAAMI,GAASH,EAAQG,E,mCC7KzB,uCAiOe,IA5NR,MACLz0C,YAAY6G,EAAQ6tC,GAClBt0C,KAAKu0C,cAAgB,EACrBv0C,KAAKw0C,QAAU/tC,EACfzG,KAAKy0C,UAAY,IAAI,IACnBhuC,EAAOkK,UAAU0a,MACjB5kB,EAAOkK,UAAUgb,UAEnB3rB,KAAK00C,UAAY,CAAC,EAClB10C,KAAK20C,aAAe,CAClB7f,UAAWruB,EAAOlB,QAAQuvB,UAC1BjrB,QAASpD,EAAOlB,QAAQsE,QACxB+qC,SAAUnuC,EAAOkK,UAAUqd,WAAWvnB,EAAOlB,QAAQsE,SACrDgrC,UAAWrvC,KAAK+V,IAAI,GAAI9U,EAAOlB,QAAQ27B,WACvC4T,WAAYtvC,KAAK+V,IAAI,EAAG9U,EAAOlB,QAAQ27B,YAEzClhC,KAAK+0C,OAAS,YAAStuC,EAAOlB,QAAQ47B,OACtCnhC,KAAKg1C,aAAwC,YAAzBV,EAASlkC,WAC/B,CAEAvJ,OAAOY,EAAM6pC,EAAUjN,GACrB,MAAM4Q,EAAcj1C,KAAKg1C,aACnBvuC,EAASzG,KAAKw0C,QACdU,EAAWl1C,KAAKy0C,UAChBU,EAAWn1C,KAAK00C,UAChBrnB,EAAO5mB,EAAOkK,UAAU6c,cAAc8jB,GACtC/jB,EAAW9mB,EAAOkK,UAAU2c,eAAeD,GAC3C3B,EAAUjlB,EAAOkK,UAAUmd,cAAcT,GACzCnjB,EAAOlJ,OAAO8tB,OAAO,CAAC,EAAG9uB,KAAK20C,cAC9BryC,EAAO,CAACD,EAAKlB,KAAW+I,EAAK7H,KAAS6H,EAAK7H,GAAO,KAAKC,KAAKnB,GAC5DggC,EAAQnhC,KAAK+0C,OAEnB/0C,KAAKu0C,gBAAkBlQ,EAAYxW,MAAQ7tB,KAAKu0C,eAAiB,EACjE,MAAM1mB,EAAQ7tB,KAAKu0C,cAAgB7oB,EAwBjCxhB,EAAKmjB,KAAOA,EAWd,WACE,MAAM+nB,EAAWF,EAASxR,gBAAgBnW,EAAU8nB,IAAiB,GACrE,GAAIJ,EAAa,CACf,MAAMK,EAAU,CAAC1+B,EAAI2+B,EAAOlnB,EAAQmnB,EAAQ,KAC1C,MAAM3jB,EAAM,IAAe0jB,EAAQ,KAC7BE,GAAepnB,IAAW,EAC1BqnB,EAAY,IACZC,EACJ9jB,EAAIN,WAAamkB,GAAc,GAAKD,EAAc,IAAQ,EAAI,GAC1DG,EAAgB/jB,EAAIN,WAAaikB,EAAQE,EAAY,EAAK,EAChEpzC,EAAK,UAAU+rB,IAAU,CACvBhsB,IAAKuU,EACL4a,EAAGK,EAAIL,EACPG,EAAGgkB,EAAU,IACb3iC,MAAO4iC,GACP,EAEEC,EAAe,EAAI,IACzB,IAAK,MAAMjS,KAAUwR,EAAU,CAC7B,MAAMroB,EAAO6W,EAAO7W,KACdsB,EAAStB,EAAKsB,OACpB,GAAIuV,EAAOG,OAAQ,CACjB,IAAIrD,EAAI,EACR,MAAM51B,EAAQ84B,EAAOpS,EAAIoS,EAAOG,OAChC,IACE,IAAI/hC,EACF8I,EACAtF,KAAK+V,IACH,EACA/V,KAAKC,OAAOqF,EAAQ,GAAK+qC,GAAgBA,GAE7C7zC,GAAK,GAAKA,GAAK4hC,EAAOpS,EACtBxvB,GAAK6zC,EAELP,EAAQvoB,EAAKnW,GAAK,IAAM8pB,IAAK1+B,EAAGqsB,EAAQ,IAE1CinB,EAAQvoB,EAAKnW,GAAIgtB,EAAOpS,EAAIoS,EAAOG,OAAQ1V,E,KAEH,WAApCgW,EAAY8M,cAAcpkB,IAC5BuoB,EAAQvoB,EAAKnW,GAAIgtB,EAAOpS,EAAGnD,E,OAKjC,IAAK,MAAMuV,KAAUwR,EAAU,CAC7B,MAAMroB,EAAO6W,EAAO7W,KACdsB,EAAStB,EAAKsB,OACpB,GAAIuV,EAAOG,OAAQ,CACjB,MAAMb,EAAWmB,EAAYuN,gBAAgB7kB,GACvChd,EAASs0B,EAAY8M,cAAcpkB,GACzCzqB,EAAK,YAAY+rB,IAAU,CACzBhsB,IAAK0qB,EAAKnW,GACV4a,EAAGoS,EAAOpS,EACVuS,OAAQH,EAAOG,OACf0E,OAAqB,IAAbvF,GAAkBA,IAAa,IACvCgQ,OAAmB,WAAXnjC,GAAuBmzB,IAAa,K,KAGN,WAApCmB,EAAY8M,cAAcpkB,IAC5BzqB,EAAK,QAAQ+rB,IAAU,CACrBhsB,IAAK0qB,EAAKnW,GACV4a,EAAGoS,EAAOpS,G,CAMtB,CAnGAskB,GAqGA,WACE,MAAMV,EAAWF,EAASlR,mBAAmBzW,EAAU8nB,IAAiB,GACxE,IAAK,MAAMzR,KAAUwR,EACnB,GAAIH,EAAa,CACf,MAAMpjB,EAAM,IAAe+R,EAAOpS,EAAI,KACtClvB,EAAK,aAAc,CACjBD,IAAKuhC,EAAOhtB,GACZ4a,EAAGK,EAAIL,EACPG,EAAGE,EAAIN,YAAc,IAA0B,IAC/Cve,MAAO6e,EAAIN,WAAa,IAA0B,G,MAGpDjvB,EAAK,WAAY,CAAED,IAAKuhC,EAAOhtB,GAAI4a,EAAGoS,EAAOpS,GAGnD,CAnHAukB,GAqHA,WACE,MAAMpuC,EAAQ08B,EAAY18B,MAC1B,IAAK,MAAM0mB,KAAU5nB,EAAO46B,QAAS,CACnC,MAAMwK,EAAUlkC,EAAM1F,IAAIosB,GAC1BnkB,EAAK,GAAGmkB,YAAqC,IAAlBwd,EAAQ1qC,MAAc,EAAI,EACjD0qC,EAAQL,UACY,IAAlBK,EAAQ1qC,MACVg0C,EAAS,GAAG9mB,UAAiB5mB,EAE7B0tC,EAAS,GAAG9mB,QAAe5mB,E,CAInC,CAjIAuuC,GAmIA,WACE,MAAMxF,EAAgBnM,EAAYmM,cAAcE,UAC1CuF,EAAezF,EAAcA,EAAc5tC,OAAS,GAC1D,GAAIqzC,EAAc,CAChB,MAAM51C,GACuB,IAA3B41C,EAAa/S,SAAkB,SAAW,GAAG+S,EAAa/S,WAC5DiS,EAAS,SAAS90C,KAAUoH,EAC5B,MAAMyuC,GACuB,IAA3BD,EAAa/S,UAA6C,IAA1B+S,EAAa/S,SACzC,OACA+S,EAAa3uC,MAAQ,EACrB,OACA2uC,EAAa3uC,MAAQ,EACrB,QACA,OACN6tC,EAAS,mBAAmBe,KAAmBzuC,EAC/C0tC,EAAgB,MAAIc,EAAatU,K,CAEnCz3B,EAAY,MAAIm6B,EAAYv2B,MAAMC,KACpC,CArJAooC,GAuJA,WACEhV,EAAMt6B,OAAOw9B,GACTlD,EAAMwD,gBACHwQ,EAAsB,cAAGA,EAAsB,YAAI1tC,GAEpD0tC,EAAsB,cACnBA,EAAqB,aAAGA,EAAqB,WAAI1tC,IAG1DyC,EAAoB,cAAIi3B,EAAMyD,aAC9B16B,EAAsB,gBAAIi3B,EAAM0D,eAChC36B,EAAkB,YAAIi3B,EAAM2D,UAC9B,CAlKAsR,GAoKA,WACE,MAAM5F,EAAgBnM,EAAYmM,cAAcE,UAChD,IAAK,IAAI1uC,EAAI,EAAGA,EAAIwuC,EAAc5tC,OAAQZ,IAAK,CAC7C,MAAMi0C,EAAezF,EAAcxuC,GAC9B,YAAYi0C,EAAa/S,YAC5BiS,EAAS,GAAGc,EAAa5nB,kBAAoB5mB,E,CAGnD,CA3KA4uC,GAEAnsC,EAAY,MAAIm6B,EAAYxW,MAAM9U,QAAQ,GAAK,IAC/C7O,EAAa,OAAIosC,EAAS,GAC1BpsC,EAAa,OAAIosC,EAAS,GAC1BpsC,EAAa,OAAIosC,EAAS,GAC1BpsC,EAAa,OAAIosC,EAAS,GAC1BpsC,EAAkB,YAAIosC,EAAS,KAC/BpsC,EAAe,UAgBsC,KAA1Cm6B,EAAYv2B,MAAMi1B,iBAAmB,IAAUhqB,QAAQ,GAAK,IAfvE,MAAM8jB,EAAMp2B,EAAOkK,UAAUgd,UAAUN,GAIvC,OAHAnjB,EAAU,IAAI2yB,EAAM,EAAI,GAAKr3B,KAAKgO,MAAMqpB,GAAO,KAAS,GAExD77B,OAAO8tB,OAAO5kB,EAAMirC,GACbjrC,EAMP,SAASosC,EAASpT,GAChB,OAAOmB,EAAYv2B,MAAMo0B,QAAUmC,EAAYv2B,MAAMo0B,OAAOgB,EAC9D,CAwJA,SAASmS,IACP,OAAO9nB,EAAW,EAAIM,CACxB,CACF,E,mCC7NF,MAAM0oB,EAAiB,EAAQ,KAE/B3wC,EAAO1E,QAAUhB,MAChBs2C,EACAC,GAECC,cAAcvuC,IACdwuC,eAAc,GACX,CAAC,IAEE,IAAIx2C,SAAQ,CAACC,EAASmE,KAC5B,GAAsB,mBAAXkyC,EACV,MAAM,IAAIv2B,UAAU,+BAGrB,IAAO9H,OAAOw+B,cAAcF,IAAgBA,IAAgBvuC,OAAauuC,GAAe,GACvF,MAAM,IAAIx2B,UAAU,kFAAkFw2B,eAAyBA,MAGhI,MAAMvsC,EAAS,GACTs7B,EAAS,GACT/a,EAAW8rB,EAAS/rB,OAAOC,YACjC,IAAImsB,GAAa,EACbC,GAAiB,EACjBC,EAAiB,EACjBC,EAAe,EAEnB,MAAMrsB,EAAO,KACZ,GAAIksB,EACH,OAGD,MAAMI,EAAWvsB,EAASC,OACpBuE,EAAQ8nB,EAGd,GAFAA,IAEIC,EAASrsB,KAWZ,OAVAksB,GAAiB,OAEM,IAAnBC,IACEJ,GAAiC,IAAlBlR,EAAO7iC,OAG1BxC,EAAQ+J,GAFR5F,EAAO,IAAIgyC,EAAe9Q,MAS7BsR,IAEA,WACC,IACC,MAAM5kC,QAAgB8kC,EAAS91C,MAC/BgJ,EAAO+kB,SAAeunB,EAAOtkC,EAAS+c,GACtC6nB,IACApsB,GAUD,CATE,MAAO9mB,GACJ8yC,GACHE,GAAa,EACbtyC,EAAOV,KAEP4hC,EAAOnjC,KAAKuB,GACZkzC,IACApsB,IAEF,CACA,EAhBD,EAgBI,EAGL,IAAK,IAAI3oB,EAAI,EAAGA,EAAI00C,IACnB/rB,KAEImsB,GAH4B90C,KAMjC,G,mCC7EF,MAAMk1C,EAAe,EAAQ,KACvBC,EAAa,EAAQ,KAI3B,MAAMZ,UAAuBzyC,MAC5BlE,YAAY6lC,GACX,IAAKxc,MAAMmuB,QAAQ3R,GAClB,MAAM,IAAIvlB,UAAU,6CAA6CulB,GAgBlE,IAAIhM,GAbJgM,EAAS,IAAIA,GAAQ/kC,KAAImD,GACpBA,aAAiBC,MACbD,EAGM,OAAVA,GAAmC,iBAAVA,EAErB7C,OAAO8tB,OAAO,IAAIhrB,MAAMD,EAAM41B,SAAU51B,GAGzC,IAAIC,MAAMD,MAIhBnD,KAAImD,GAE0B,iBAAhBA,EAAMwkC,MAAwC8O,EAAWtzC,EAAMwkC,OAxBvCrvB,QAAQ,gDAAiD,IAwBRiZ,OAAOpuB,KAE9FhD,KAAK,MACP44B,EAAU,KAAOyd,EAAazd,EAAS,GACvCvH,MAAMuH,GAENz5B,KAAKK,KAAO,iBAEZW,OAAOC,eAAejB,KAAM,UAAW,CAACmB,MAAOskC,GAChD,CAEA,EAAGhb,OAAOC,YACT,IAAK,MAAM7mB,KAAS7D,KAAKq3C,cAClBxzC,CAER,EAGD+B,EAAO1E,QAAUq1C,C,mCC5CjB3wC,EAAO1E,QAAU,CAACkS,EAAQyf,EAAQ,EAAGttB,KAOpC,GANAA,EAAU,CACT+xC,OAAQ,IACRC,mBAAmB,KAChBhyC,GAGkB,iBAAX6N,EACV,MAAM,IAAI8M,UACT,uDAAuD9M,OAIzD,GAAqB,iBAAVyf,EACV,MAAM,IAAI3S,UACT,uDAAuD2S,OAIzD,GAA8B,iBAAnBttB,EAAQ+xC,OAClB,MAAM,IAAIp3B,UACT,gEAAgE3a,EAAQ+xC,YAI1E,GAAc,IAAVzkB,EACH,OAAOzf,EAGR,MAAMokC,EAAQjyC,EAAQgyC,kBAAoB,MAAQ,cAElD,OAAOnkC,EAAO4F,QAAQw+B,EAAOjyC,EAAQ+xC,OAAOG,OAAO5kB,GAAO,C,mCChC3D,MAAM6kB,EAAK,EAAQ,KAEbC,EAAmB,0BACnBC,EAAY,+GACZC,OAAgC,IAAfH,EAAGI,QAA0B,GAAKJ,EAAGI,UAE5DlyC,EAAO1E,QAAU,CAACmnC,EAAO9iC,KACxBA,EAAUvE,OAAO8tB,OAAO,CAACipB,QAAQ,GAAQxyC,GAElC8iC,EAAMrvB,QAAQ,MAAO,KAC1BvY,MAAM,MACN6uB,QAAOyJ,IACP,MAAMif,EAAcjf,EAAK33B,MAAMu2C,GAC/B,GAAoB,OAAhBK,IAAyBA,EAAY,GACxC,OAAO,EAGR,MAAM52C,EAAQ42C,EAAY,GAG1B,OACC52C,EAAMgQ,SAAS,2CACfhQ,EAAMgQ,SAAS,8CAKRwmC,EAAU/0C,KAAKzB,EAAM,IAE7BkuB,QAAOyJ,GAAwB,KAAhBA,EAAKxY,SACpB7f,KAAIq4B,GACAxzB,EAAQwyC,OACJhf,EAAK/f,QAAQ2+B,GAAkB,CAAC7tB,EAAGmuB,IAAOnuB,EAAE9Q,QAAQi/B,EAAIA,EAAGj/B,QAAQ6+B,EAAS,QAG7E9e,IAEPl4B,KAAK,M,uDCtCR,sBAiBO,MAAMq3C,UACH,IAGRt4C,YAAYkwB,GACVoC,MAAM,CACJ3K,SAAWvD,GAOjB9jB,eACE4vB,EACA9L,GAEA,MAAMyD,EAAmB,GACnB0wB,EAAeroB,EAAMqoB,aAC3B,IAAKA,EACH,MAAM,IAAIr0C,MAAM,2CAElB,GAAIq0C,EAAaC,MAAMpuC,QAAQ,kBAAoB,EAAG,CACpD,MAAMnK,EAAMs4C,EACTE,QAAQ,iBACR53C,MAAM,cACN6uB,QAAQxoB,GAAMA,IAAMA,EAAEwxC,WAAW,OAAM,GAC1C,GAAI,IAAez1C,KAAKhD,GAAOA,EAAImZ,QAAQ,SAAU,KAEnD,OADAgL,EAAI,qDACG,OAAO,YAAyBnkB,EAAKmkB,G,MAEzC,GAAIm0B,EAAa9e,MACtB,IAAK,MAAMkf,KAAQtvB,MAAMwH,KAAK0nB,EAAa9e,aACnCmf,EAASD,QAEZ,GAAIJ,EAAatxB,MACtB,IAAK,MAAM3Y,KAAQ+a,MAAMwH,KAAK0nB,EAAatxB,OACzC4xB,EAAQvqC,GAGZ,OAAOuZ,EAEPvnB,eAAes4C,EAASD,GACtB,MAAMvyB,EAAQuyB,EAAKG,kBAAoBH,EAAKG,mBAC5C,GAAI1yB,QACI2yB,EAAU3yB,OACX,CACL,MAAM9X,EAAOqqC,EAAKK,WAAaL,EAAKK,YAChC1qC,GAAMuqC,EAAQvqC,E,CAEtB,CAEA,SAASyqC,EAAU3yB,EAAYtM,EAAS,IACtC,OAAIsM,EAAM6yB,OACDC,EAAS9yB,EAAOtM,GACdsM,EAAM+yB,YACRC,EAAchzB,EAAOtM,QADvB,CAGT,CAEAxZ,eAAe44C,EAAS9yB,EAAYtM,EAAS,IAC3C,MAAMxL,QAAa,IAAI/N,SAAc,CAACC,EAASmE,KAC7CyhB,EAAM9X,KAAK9N,EAASmE,EAAO,IAG7B,OADAk0C,EAAQvqC,EAAMwL,GACPxL,CACT,CAEAhO,eAAe84C,EAAcC,EAAUv/B,EAAS,IAC9C,MAAMw/B,EAAiB,GACjB5hB,EAAS2hB,EAAIE,eACbC,EAAW,IACf,IAAIj5C,SAAa,CAACC,EAASmE,KACzB+yB,EAAO+hB,YAAYj5C,EAASmE,EAAO,IAEvC,OAAS,CACP,MAAM8U,QAAgB+/B,IACtB,IAAK//B,GAA8B,IAAnBA,EAAQzW,OAAc,MACtCs2C,EAAQ52C,QAAQ2mB,MAAMwH,KAAKpX,G,CAE7B,IAAK,MAAM2M,KAASkzB,QACZP,EAAU3yB,EAAOtM,EAASu/B,EAAI54C,KAAO,IAE/C,CAEA,SAASo4C,EAAQvqC,EAAYwL,EAAS,IAChCxL,GACF,YAAcwL,EAAQxL,EAAK7N,MAAOA,IAChConB,EAAInlB,KAAK,CAAEjC,OAAM6N,QAAO,GAG9B,CACF,CAtFyBorC,CAAkBxpB,EAAO9L,IAEhD,EAGa,K,qBC5Bf,OAOC,WACA,aAEA,IAAIu1B,EAAS,CAAC,EAAEhvB,eAGhB,SAASivB,IAGR,IAFA,IAAIC,EAAU,GAELz3C,EAAI,EAAGA,EAAIoxB,UAAUxwB,OAAQZ,IAAK,CAC1C,IAAI03C,EAAMtmB,UAAUpxB,GACpB,GAAK03C,EAAL,CAEA,IAAIC,SAAiBD,EAErB,GAAgB,WAAZC,GAAoC,WAAZA,EAC3BF,EAAQn3C,KAAKo3C,QACP,GAAIzwB,MAAMmuB,QAAQsC,IACxB,GAAIA,EAAI92C,OAAQ,CACf,IAAIg3C,EAAQJ,EAAWrmB,MAAM,KAAMumB,GAC/BE,GACHH,EAAQn3C,KAAKs3C,EAEf,OACM,GAAgB,WAAZD,EAAsB,CAChC,GAAID,EAAI7pC,WAAa7O,OAAOc,UAAU+N,WAAa6pC,EAAI7pC,SAASA,WAAWuB,SAAS,iBAAkB,CACrGqoC,EAAQn3C,KAAKo3C,EAAI7pC,YACjB,QACD,CAEA,IAAK,IAAIxN,KAAOq3C,EACXH,EAAOhjC,KAAKmjC,EAAKr3C,IAAQq3C,EAAIr3C,IAChCo3C,EAAQn3C,KAAKD,EAGhB,CAxBkB,CAyBnB,CAEA,OAAOo3C,EAAQ54C,KAAK,IACrB,CAEqC+E,EAAO1E,SAC3Cs4C,EAAW3zC,QAAU2zC,EACrB5zC,EAAO1E,QAAUs4C,QAKhB,KAFwB,EAAF,WACtB,OAAOA,CACP,UAFoB,OAEpB,YAIH,CApDA,E,mCCLA5zC,EAAO1E,QAAU,CACf8d,SAAU,SAAS06B,GACjB,MAAuB,iBAAV,CACf,EACA15B,SAAU,SAAS05B,GACjB,MAAuB,iBAAV,GAA8B,OAARA,CACrC,EACAj2B,OAAQ,SAASi2B,GACf,OAAe,OAARA,CACT,EACAn2B,kBAAmB,SAASm2B,GAC1B,OAAc,MAAPA,CACT,E,mCCZFx4C,EAAQic,OAASjc,EAAQwW,MAAQ,EAAQ,KACzCxW,EAAQ6lC,OAAS7lC,EAAQmhB,UAAY,EAAQ,I,mCCuB7C,SAASkI,EAAexL,EAAKmH,GAC3B,OAAOllB,OAAOc,UAAUyoB,eAAehU,KAAKwI,EAAKmH,EACnD,CAEAtgB,EAAO1E,QAAU,SAAS24C,EAAIzM,EAAK0M,EAAIv0C,GACrC6nC,EAAMA,GAAO,IACb0M,EAAKA,GAAM,IACX,IAAI/6B,EAAM,CAAC,EAEX,GAAkB,iBAAP86B,GAAiC,IAAdA,EAAGj3C,OAC/B,OAAOmc,EAGT,IAAIg7B,EAAS,MACbF,EAAKA,EAAGp5C,MAAM2sC,GAEd,IAAI4M,EAAU,IACVz0C,GAAsC,iBAApBA,EAAQy0C,UAC5BA,EAAUz0C,EAAQy0C,SAGpB,IAAIjM,EAAM8L,EAAGj3C,OAETo3C,EAAU,GAAKjM,EAAMiM,IACvBjM,EAAMiM,GAGR,IAAK,IAAIh4C,EAAI,EAAGA,EAAI+rC,IAAO/rC,EAAG,CAC5B,IAEIi4C,EAAMC,EAAM34B,EAAGuB,EAFf6O,EAAIkoB,EAAG73C,GAAGgX,QAAQ+gC,EAAQ,OAC1BI,EAAMxoB,EAAE3nB,QAAQ8vC,GAGhBK,GAAO,GACTF,EAAOtoB,EAAElR,OAAO,EAAG05B,GACnBD,EAAOvoB,EAAElR,OAAO05B,EAAM,KAEtBF,EAAOtoB,EACPuoB,EAAO,IAGT34B,EAAIP,mBAAmBi5B,GACvBn3B,EAAI9B,mBAAmBk5B,GAElB3vB,EAAexL,EAAKwC,GAEd61B,EAAQr4B,EAAIwC,IACrBxC,EAAIwC,GAAGjf,KAAKwgB,GAEZ/D,EAAIwC,GAAK,CAACxC,EAAIwC,GAAIuB,GAJlB/D,EAAIwC,GAAKuB,CAMb,CAEA,OAAO/D,CACT,EAEA,IAAIq4B,EAAUnuB,MAAMmuB,SAAW,SAAU9K,GACvC,MAA8C,mBAAvCtrC,OAAOc,UAAU+N,SAAS0G,KAAK+1B,EACxC,C,mCC5DA,IAAI8N,EAAqB,SAASt3B,GAChC,cAAeA,GACb,IAAK,SACH,OAAOA,EAET,IAAK,UACH,OAAOA,EAAI,OAAS,QAEtB,IAAK,SACH,OAAOzK,SAASyK,GAAKA,EAAI,GAE3B,QACE,MAAO,GAEb,EAEAld,EAAO1E,QAAU,SAAS6d,EAAKquB,EAAK0M,EAAIz5C,GAOtC,OANA+sC,EAAMA,GAAO,IACb0M,EAAKA,GAAM,IACC,OAAR/6B,IACFA,OAAM/I,GAGW,iBAAR+I,EACFre,EAAI25C,EAAWt7B,IAAM,SAASwC,GACnC,IAAI+4B,EAAK15C,mBAAmBw5C,EAAmB74B,IAAMu4B,EACrD,OAAI1C,EAAQr4B,EAAIwC,IACP7gB,EAAIqe,EAAIwC,IAAI,SAASuB,GAC1B,OAAOw3B,EAAK15C,mBAAmBw5C,EAAmBt3B,GACpD,IAAGjiB,KAAKusC,GAEDkN,EAAK15C,mBAAmBw5C,EAAmBr7B,EAAIwC,IAE1D,IAAG1gB,KAAKusC,GAIL/sC,EACEO,mBAAmBw5C,EAAmB/5C,IAASy5C,EAC/Cl5C,mBAAmBw5C,EAAmBr7B,IAF3B,EAGpB,EAEA,IAAIq4B,EAAUnuB,MAAMmuB,SAAW,SAAU9K,GACvC,MAA8C,mBAAvCtrC,OAAOc,UAAU+N,SAAS0G,KAAK+1B,EACxC,EAEA,SAAS5rC,EAAK4rC,EAAI/8B,GAChB,GAAI+8B,EAAG5rC,IAAK,OAAO4rC,EAAG5rC,IAAI6O,GAE1B,IADA,IAAIg9B,EAAM,GACDvqC,EAAI,EAAGA,EAAIsqC,EAAG1pC,OAAQZ,IAC7BuqC,EAAIjqC,KAAKiN,EAAE+8B,EAAGtqC,GAAIA,IAEpB,OAAOuqC,CACT,CAEA,IAAI8N,EAAar5C,OAAOohB,MAAQ,SAAUrD,GACxC,IAAIwtB,EAAM,GACV,IAAK,IAAIlqC,KAAO0c,EACV/d,OAAOc,UAAUyoB,eAAehU,KAAKwI,EAAK1c,IAAMkqC,EAAIjqC,KAAKD,GAE/D,OAAOkqC,CACT,C,mCCnFA,+CAEO,SAASgO,EACdh6C,EACAV,GAGA,GAAIA,EAAIuR,SAAS,OACf,MAAO,CAAC,IAAI,IAAa,IAAItQ,IAAIjB,IAAOA,EAAIY,MAAM,KAAKwC,OAAO,GAAG,IAGnE,MAAM0W,EAAQ9Z,EAAIY,MAAM,KACxB,IAAI+P,EAAUjQ,EACd,KAAOoZ,EAAM/W,OAAS,GAAG,CACvB,MAAM43C,EAAU7gC,EAAMnS,QACtBgJ,EAAU,IAAIiqC,EAAmBjqC,EAASgqC,E,CAE5C,MAAO,CAAChqC,EAASmJ,EAAM,GACzB,CAEO,MAAM8gC,EACX76C,YAAoBW,EAA0Bi6C,GAA1B,KAAAj6C,OAA0B,KAAAi6C,SAAkB,CAEhEt6C,WAAW+N,GACT,OAAOjO,KAAKO,KAAK2N,KAAK,GAAGlO,KAAKw6C,WAAWvsC,IAC3C,E,mCC1BF,qBA4Be,IA1BR,WACL,MAAMvN,EAAM,IAAI6F,IAChB,IAAIm0C,EACJ,MAAO,CACLhoC,cAAcioC,GACRD,IAAgBC,IAClBD,EAAcC,EACdj6C,EAAIiE,QAER,EACAi2C,QAAO,IACe,IAAbl6C,EAAI2jB,KAEbw2B,SAASC,GACAp6C,EAAIqgC,IAAI+Z,GAEjBC,MAAMD,EAAWngC,GACf,IAAU+/B,EAAa,oCACvBh6C,EAAI0B,IAAI04C,EAAWngC,EACrB,EACA1Y,IAAI64C,GACKp6C,EAAIuB,IAAI64C,GAGrB,C,mCCyBe,IAnDR,MACLl7C,YAAYoG,EAAQD,EAASrF,GAAK,OAAEuF,GAAW,CAAC,GAC9CjG,KAAKmG,QAAUH,EACfhG,KAAK2c,SAAW5W,EAChB/F,KAAK69B,KAAOn9B,EACZV,KAAKg7C,oBAAsB,IAAIz0C,IAC/BvG,KAAKi7C,OAASj7C,KAAKmG,QAAQiV,MAAM,CAAEnV,UACrC,CAGAi1C,SAASnuB,EAAM5nB,EAAOlC,GACpB,OAAOjD,KAAKm7C,MAAM,CAAEpuB,OAAM5nB,QAAOqE,WAAW,EAAMvG,SACpD,CAIAm4C,SAASruB,EAAM5nB,EAAOlC,GACpB,OAAOjD,KAAKm7C,MAAM,CAAEpuB,OAAM5nB,QAAOqE,WAAW,EAAMvG,SACpD,CAGAo4C,SAAStuB,EAAM5nB,EAAOlC,GACpB,OAAOjD,KAAKm7C,MAAM,CAAEpuB,OAAM5nB,MAAO,EAAGqE,WAAW,EAAOvG,SACxD,CAGAk4C,OAAM,KAAEpuB,EAAI,MAAE5nB,EAAK,UAAEqE,IACnB,MAAMgmB,EAAWzC,EAAKyC,SAClBhmB,GAAWxJ,KAAKs7C,uBAAuB9rB,EAAUrqB,GACrD,MAAM8I,EAAWjO,KAAK69B,KAAKrO,EAASttB,eACpC,IAAK+L,EAAU,OAAO,KACtB,MAAMgP,EAASjd,KAAK2c,SAAS1O,GAC7B,IAAKgP,EAAQ,OAAO,KACpB,MAAMC,EAAWD,EAAOpC,KAAK1V,EAAO,CAClC2F,MAAOiiB,EAAK0C,cACZ3d,IAAKib,EAAK2C,YACVtU,MAAOpb,KAAKi7C,SAGd,OADIzxC,GAAWxJ,KAAKg7C,oBAAoB54C,IAAIotB,EAAUtS,GAC/CA,CACT,CAEAo+B,uBAAuB9rB,EAAUrqB,GAC/B,MAAM+X,EAAWld,KAAKg7C,oBAAoB/4C,IAAIutB,GAC1CtS,IACFhZ,YAAW,IAAMgZ,EAAS/B,QAAgB,IAARhW,GAClCnF,KAAKg7C,oBAAoBl9B,OAAO0R,GAEpC,E,sBC/CF,IAAIoB,EAAU,EAAQ,KAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAAChrB,EAAO5D,EAAI4uB,EAAS,MAOhE,IAAIrrB,EAAU,CAAC,KAAM,EAErBA,UAPIsrB,UAQJtrB,gBAAqByQ,GAER,EAAQ,EAAR,CAAmH4a,EAASrrB,GAEtIqrB,EAAQE,SAAQlrB,EAAO1E,QAAU0vB,EAAQE,O,uBCjBlClrB,EAAO1E,QAAU,EAAQ,EAAR,EAA2H,IAK9IoB,KAAK,CAACsD,EAAO5D,EAAI,gcAAuc,I,kCCJhehB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQm8B,eAAY,EACpB,IAAIke,EAAY,EAAQ,KAkEpBle,EAA2B,WAI3B,SAASA,EAAUL,GACfA,EAAS7Y,QAAQo3B,EAAU7hB,SAC3B15B,KAAKw7C,UAAYxe,CACrB,CA4CA,OA3CAK,EAAUv7B,UAAU25C,SAAW,SAAUvsB,EAAOwsB,EAAUnuB,GACtD,GAAI2B,GAASlvB,KAAKw7C,UAAU54C,OACxB,OAAO,EACX,IAAI+4C,EAAU37C,KAAKw7C,UAAUtsB,GACzBjJ,EAASy1B,EAASC,GACtB,OAAOA,EAAQ1e,UAAY1P,GAAYtH,EAASsH,EAAWtH,CAC/D,EACAoX,EAAUv7B,UAAU85C,WAAa,SAAUF,EAAUnuB,GACjD,IAAK,IAAIvrB,EAAI,EAAGA,EAAIhC,KAAKw7C,UAAU54C,OAAQZ,IACvC,IAAKhC,KAAKy7C,SAASz5C,EAAI,EAAG05C,EAAUnuB,GAChC,OAAOvtB,KAAKw7C,UAAUx5C,GAE9B,MAAM,IAAI8B,MAAM,2EACpB,EACAu5B,EAAUv7B,UAAU07B,WAAa,SAAU7L,GACvC,OAAO3xB,KAAK47C,WAAWC,EAAGlqB,EAC9B,EACA0L,EAAUv7B,UAAUg6C,WAAa,SAAUh1C,GACvC,OAAO9G,KAAK47C,WAAWG,EAAGj1C,EAC9B,EAIAu2B,EAAUv7B,UAAUgF,EAAI,SAAU6qB,GAC9B,IAAIgqB,EAAU37C,KAAKw9B,WAAW7L,GAC9B,OAAOgqB,EAAQ70C,GAAK6qB,EAAIgqB,EAAQhqB,IAAMgqB,EAAQ/hB,IAAM,EACxD,EAKAyD,EAAUv7B,UAAU6vB,EAAI,SAAU7qB,GAC9B,IAAI60C,EAAU37C,KAAK87C,WAAWh1C,GAC9B,OAAO60C,EAAQhqB,GAAK7qB,EAAI60C,EAAQ70C,GAAK60C,EAAQ/hB,EACjD,EAKAyD,EAAUv7B,UAAU83B,GAAK,SAAU9yB,GAE/B,OADc9G,KAAK87C,WAAWh1C,GACf8yB,EACnB,EACOyD,CACX,CApD8B,GAqD9Bn8B,EAAQm8B,UAAYA,EACpB,IAAI0e,EAAI,SAAUJ,GAAW,OAAOA,EAAQ70C,CAAG,EAC3C+0C,EAAI,SAAUF,GAAW,OAAOA,EAAQhqB,CAAG,C,oCC5H/C,YACA,IAAI/H,EAAmB5pB,MAAQA,KAAK4pB,kBAAqB5oB,OAAO6oB,OAAS,SAAUpS,EAAGqS,EAAGvI,EAAGwI,QAC7E/T,IAAP+T,IAAkBA,EAAKxI,GAC3B,IAAIyI,EAAOhpB,OAAOipB,yBAAyBH,EAAGvI,GACzCyI,KAAS,QAASA,GAAQF,EAAEI,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMpoB,IAAK,WAAa,OAAO6nB,EAAEvI,EAAI,IAE5DvgB,OAAOC,eAAewW,EAAGsS,EAAIC,EAChC,EAAI,SAAUvS,EAAGqS,EAAGvI,EAAGwI,QACT/T,IAAP+T,IAAkBA,EAAKxI,GAC3B9J,EAAEsS,GAAMD,EAAEvI,EACb,GACGsY,EAAsB75B,MAAQA,KAAK65B,qBAAwB74B,OAAO6oB,OAAS,SAAUpS,EAAGqL,GACxF9hB,OAAOC,eAAewW,EAAG,UAAW,CAAE4S,YAAY,EAAMlpB,MAAO2hB,GAClE,EAAI,SAASrL,EAAGqL,GACbrL,EAAW,QAAIqL,CACnB,GACIgX,EAAgB95B,MAAQA,KAAK85B,cAAiB,SAAUhP,GACxD,GAAIA,GAAOA,EAAIZ,WAAY,OAAOY,EAClC,IAAI3gB,EAAS,CAAC,EACd,GAAW,MAAP2gB,EAAa,IAAK,IAAIvJ,KAAKuJ,EAAe,YAANvJ,GAAmBvgB,OAAOc,UAAUyoB,eAAehU,KAAKuU,EAAKvJ,IAAIqI,EAAgBzf,EAAQ2gB,EAAKvJ,GAEtI,OADAsY,EAAmB1vB,EAAQ2gB,GACpB3gB,CACX,EACI6xC,EAAah8C,MAAQA,KAAKg8C,WAAc,SAAUC,EAASC,EAAYC,EAAGC,GAE1E,OAAO,IAAKD,IAAMA,EAAIh8C,WAAU,SAAUC,EAASmE,GAC/C,SAAS83C,EAAUl7C,GAAS,IAAMm7C,EAAKF,EAAUzxB,KAAKxpB,GAAkC,CAAvB,MAAOyL,GAAKrI,EAAOqI,EAAI,CAAE,CAC1F,SAAS2vC,EAASp7C,GAAS,IAAMm7C,EAAKF,EAAiB,MAAEj7C,GAAkC,CAAvB,MAAOyL,GAAKrI,EAAOqI,EAAI,CAAE,CAC7F,SAAS0vC,EAAKnyC,GAJlB,IAAehJ,EAIagJ,EAAOygB,KAAOxqB,EAAQ+J,EAAOhJ,QAJ1CA,EAIyDgJ,EAAOhJ,MAJhDA,aAAiBg7C,EAAIh7C,EAAQ,IAAIg7C,GAAE,SAAU/7C,GAAWA,EAAQe,EAAQ,KAIjBgN,KAAKkuC,EAAWE,EAAW,CAC7GD,GAAMF,EAAYA,EAAUjpB,MAAM8oB,EAASC,GAAc,KAAKvxB,OAClE,GACJ,EACI6xB,EAAex8C,MAAQA,KAAKw8C,aAAgB,SAAUP,EAASzoB,GAC/D,IAAsGjkB,EAAGiiB,EAAG1qB,EAAG21C,EAA3GtzB,EAAI,CAAEuzB,MAAO,EAAGC,KAAM,WAAa,GAAW,EAAP71C,EAAE,GAAQ,MAAMA,EAAE,GAAI,OAAOA,EAAE,EAAI,EAAG81C,KAAM,GAAIC,IAAK,IAChG,OAAOJ,EAAI,CAAE9xB,KAAMmyB,EAAK,GAAI,MAASA,EAAK,GAAI,OAAUA,EAAK,IAAwB,mBAAXryB,SAA0BgyB,EAAEhyB,OAAOC,UAAY,WAAa,OAAO1qB,IAAM,GAAIy8C,EACvJ,SAASK,EAAK5qC,GAAK,OAAO,SAAU4Q,GAAK,OACzC,SAAci6B,GACV,GAAIxtC,EAAG,MAAM,IAAI2Q,UAAU,mCAC3B,KAAOiJ,OACH,GAAI5Z,EAAI,EAAGiiB,IAAM1qB,EAAY,EAARi2C,EAAG,GAASvrB,EAAU,OAAIurB,EAAG,GAAKvrB,EAAS,SAAO1qB,EAAI0qB,EAAU,SAAM1qB,EAAEyP,KAAKib,GAAI,GAAKA,EAAE7G,SAAW7jB,EAAIA,EAAEyP,KAAKib,EAAGurB,EAAG,KAAKnyB,KAAM,OAAO9jB,EAE3J,OADI0qB,EAAI,EAAG1qB,IAAGi2C,EAAK,CAAS,EAARA,EAAG,GAAQj2C,EAAE3F,QACzB47C,EAAG,IACP,KAAK,EAAG,KAAK,EAAGj2C,EAAIi2C,EAAI,MACxB,KAAK,EAAc,OAAX5zB,EAAEuzB,QAAgB,CAAEv7C,MAAO47C,EAAG,GAAInyB,MAAM,GAChD,KAAK,EAAGzB,EAAEuzB,QAASlrB,EAAIurB,EAAG,GAAIA,EAAK,CAAC,GAAI,SACxC,KAAK,EAAGA,EAAK5zB,EAAE0zB,IAAIv5B,MAAO6F,EAAEyzB,KAAKt5B,MAAO,SACxC,QACI,KAAMxc,EAAIqiB,EAAEyzB,MAAM91C,EAAIA,EAAElE,OAAS,GAAKkE,EAAEA,EAAElE,OAAS,KAAkB,IAAVm6C,EAAG,IAAsB,IAAVA,EAAG,IAAW,CAAE5zB,EAAI,EAAG,QAAU,CAC3G,GAAc,IAAV4zB,EAAG,MAAcj2C,GAAMi2C,EAAG,GAAKj2C,EAAE,IAAMi2C,EAAG,GAAKj2C,EAAE,IAAM,CAAEqiB,EAAEuzB,MAAQK,EAAG,GAAI,KAAO,CACrF,GAAc,IAAVA,EAAG,IAAY5zB,EAAEuzB,MAAQ51C,EAAE,GAAI,CAAEqiB,EAAEuzB,MAAQ51C,EAAE,GAAIA,EAAIi2C,EAAI,KAAO,CACpE,GAAIj2C,GAAKqiB,EAAEuzB,MAAQ51C,EAAE,GAAI,CAAEqiB,EAAEuzB,MAAQ51C,EAAE,GAAIqiB,EAAE0zB,IAAIv6C,KAAKy6C,GAAK,KAAO,CAC9Dj2C,EAAE,IAAIqiB,EAAE0zB,IAAIv5B,MAChB6F,EAAEyzB,KAAKt5B,MAAO,SAEtBy5B,EAAKvpB,EAAKjd,KAAK0lC,EAAS9yB,GAC1B,MAAOvc,GAAKmwC,EAAK,CAAC,EAAGnwC,GAAI4kB,EAAI,CAAG,CAAE,QAAUjiB,EAAIzI,EAAI,CAAG,CACzD,GAAY,EAARi2C,EAAG,GAAQ,MAAMA,EAAG,GAAI,MAAO,CAAE57C,MAAO47C,EAAG,GAAKA,EAAG,QAAK,EAAQnyB,MAAM,EAC9E,CAtBgD0xB,CAAK,CAACpqC,EAAG4Q,GAAK,CAAG,CAuBrE,EACA9hB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ87C,qBAAkB,EAC1B,IAAIte,EAAM5E,EAAa,EAAQ,KAC3BmjB,EAAqBnjB,EAAa,EAAQ,MAC1CojB,EAAuBpjB,EAAa,EAAQ,MAC5CqjB,EAAiB,SAAUC,GAC3B,OAAOC,EAAOC,SAASF,GACjBA,EACAC,EAAO5sB,KAAK,IAAI7S,WAAWw/B,GACrC,EACIJ,EAAiC,WACjC,SAASA,IACT,CAsCA,OArCAA,EAAgBl7C,UAAUgN,KAAO,SAAU4B,EAAakjB,EAAUruB,GAC9D,OAAIquB,EAASvzB,KAAKe,MAAM,aACbpB,KAAKu9C,UAAU7sC,EAAakjB,EAAUruB,GAGtCvF,KAAKw9C,QAAQ9sC,EAAakjB,EAAUruB,EAEnD,EACAy3C,EAAgBl7C,UAAU07C,QAAU,SAAU9sC,EAAakjB,EAAUruB,GACjE,OAAOy2C,EAAUh8C,UAAM,OAAQ,GAAQ,WACnC,IAAI+a,EAAQ0iC,EAAeziC,EAAQ0iC,EAAevlB,EAClD,OAAOqkB,EAAYx8C,MAAM,SAAU8rB,GAC/B,OAAQA,EAAG4wB,OACP,KAAK,EAGD,OAFA3hC,EAASoiC,EAAezsC,GACxB+sC,EAAgB/e,EAAIif,OAAO5mB,6BAA6BnD,EAASvzB,MAC1D,CAAC,EAAaq+B,EAAIif,OAAO3mB,UAAUjc,EAAQ0iC,IACtD,KAAK,EAKD,OAJAziC,EAAS8Q,EAAG6wB,OACZe,EAAgBhf,EAAIkf,SAASlmB,QAAQ1c,GACrCmd,EAAQulB,EAAcvlB,MAEf,CAAC,EADI8kB,EAAmB9iB,aAAahC,EAAO5yB,IAG/D,GACJ,GACJ,EACAy3C,EAAgBl7C,UAAUy7C,UAAY,SAAU7sC,EAAakjB,EAAUruB,GACnE,OAAOy2C,EAAUh8C,UAAM,OAAQ,GAAQ,WACnC,IAAI+a,EAAQC,EACZ,OAAOwhC,EAAYx8C,MAAM,SAAU8rB,GAG/B,OAFA/Q,EAASoiC,EAAezsC,GACxBsK,EAASD,EAAOlL,SAAS,SAClB,CAAC,EAAcqtC,EAAqBpuC,KAAKkM,EAAQzV,GAC5D,GACJ,GACJ,EACOy3C,CACX,CAzCoC,GA0CpC97C,EAAQ87C,gBAAkBA,EAC1B97C,EAAQ2E,QAAUm3C,C,6DChHlB,IAAIpzB,EAAmB5pB,MAAQA,KAAK4pB,kBAAqB5oB,OAAO6oB,OAAS,SAAUpS,EAAGqS,EAAGvI,EAAGwI,QAC7E/T,IAAP+T,IAAkBA,EAAKxI,GAC3B,IAAIyI,EAAOhpB,OAAOipB,yBAAyBH,EAAGvI,GACzCyI,KAAS,QAASA,GAAQF,EAAEI,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMpoB,IAAK,WAAa,OAAO6nB,EAAEvI,EAAI,IAE5DvgB,OAAOC,eAAewW,EAAGsS,EAAIC,EAChC,EAAI,SAAUvS,EAAGqS,EAAGvI,EAAGwI,QACT/T,IAAP+T,IAAkBA,EAAKxI,GAC3B9J,EAAEsS,GAAMD,EAAEvI,EACb,GACGsY,EAAsB75B,MAAQA,KAAK65B,qBAAwB74B,OAAO6oB,OAAS,SAAUpS,EAAGqL,GACxF9hB,OAAOC,eAAewW,EAAG,UAAW,CAAE4S,YAAY,EAAMlpB,MAAO2hB,GAClE,EAAI,SAASrL,EAAGqL,GACbrL,EAAW,QAAIqL,CACnB,GACIgX,EAAgB95B,MAAQA,KAAK85B,cAAiB,SAAUhP,GACxD,GAAIA,GAAOA,EAAIZ,WAAY,OAAOY,EAClC,IAAI3gB,EAAS,CAAC,EACd,GAAW,MAAP2gB,EAAa,IAAK,IAAIvJ,KAAKuJ,EAAe,YAANvJ,GAAmBvgB,OAAOc,UAAUyoB,eAAehU,KAAKuU,EAAKvJ,IAAIqI,EAAgBzf,EAAQ2gB,EAAKvJ,GAEtI,OADAsY,EAAmB1vB,EAAQ2gB,GACpB3gB,CACX,EACI0gB,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ4N,UAAO,EACf,IAAIkxB,EAAQlG,EAAa,EAAQ,MAC7B4E,EAAM5E,EAAa,EAAQ,KAC3B6E,EAAM9T,EAAgB,EAAQ,MA0BlC,SAASgzB,EAAgC3zC,GACrC,IAAI4zC,GACK5zC,EAAKsN,MAELtN,EAAKsN,KAAKumC,aAEP7zC,EAAKsN,KAAKumC,YAHP,KAIR,IACP,MAAO,CAAC,GAAKD,EAAW,GAAKA,EACjC,CAVA58C,EAAQ4N,KAxBR,SAAckM,EAAQkQ,GAClB,IAAIhhB,EAAOwkC,KAAKh3B,MAAMsD,GAClBwQ,EAAWwU,EAAMge,iBAAiB9zC,GAClC6D,EAAQiyB,EAAMie,qBAAqB/zC,EAAM,CACzC+0B,OAAQ/T,EAAc+T,SAEtBtT,EAAWqU,EAAMF,iBAAiB51B,GAClCg0C,EAAQ,CACR7yB,MAAOtd,EAAMsd,MAAMroB,MACnBsoB,OAAQvd,EAAMud,OACdC,UAAWxd,EAAMwd,UACjBC,SAAUA,EACVC,YAAa,IAAIiT,EAAIZ,YAAY,CAAC,CAAEh3B,EAAG,EAAG6qB,EAAG,EAAGiI,GAAI,EAAGqD,WAAW,KAClEvR,QAAS,IAAIgT,EAAIV,QAAQ,IACzBrS,SAAUA,EACVC,OAAQ,CAEJ/W,SAAU3K,EAAKsN,KAAK2mC,eACpBhxB,WAAYjjB,EAAKsN,KAAK4mC,YAE1BvyB,qBAAsBgyB,EAAgC3zC,IAE1D,OAAO,IAAIy0B,EAAI94B,QAAQq4C,EAAOhzB,EAClC,C,mCCtDA,IAAItB,EAAmB5pB,MAAQA,KAAK4pB,kBAAqB5oB,OAAO6oB,OAAS,SAAUpS,EAAGqS,EAAGvI,EAAGwI,QAC7E/T,IAAP+T,IAAkBA,EAAKxI,GAC3B,IAAIyI,EAAOhpB,OAAOipB,yBAAyBH,EAAGvI,GACzCyI,KAAS,QAASA,GAAQF,EAAEI,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMpoB,IAAK,WAAa,OAAO6nB,EAAEvI,EAAI,IAE5DvgB,OAAOC,eAAewW,EAAGsS,EAAIC,EAChC,EAAI,SAAUvS,EAAGqS,EAAGvI,EAAGwI,QACT/T,IAAP+T,IAAkBA,EAAKxI,GAC3B9J,EAAEsS,GAAMD,EAAEvI,EACb,GACGsY,EAAsB75B,MAAQA,KAAK65B,qBAAwB74B,OAAO6oB,OAAS,SAAUpS,EAAGqL,GACxF9hB,OAAOC,eAAewW,EAAG,UAAW,CAAE4S,YAAY,EAAMlpB,MAAO2hB,GAClE,EAAI,SAASrL,EAAGqL,GACbrL,EAAW,QAAIqL,CACnB,GACIgX,EAAgB95B,MAAQA,KAAK85B,cAAiB,SAAUhP,GACxD,GAAIA,GAAOA,EAAIZ,WAAY,OAAOY,EAClC,IAAI3gB,EAAS,CAAC,EACd,GAAW,MAAP2gB,EAAa,IAAK,IAAIvJ,KAAKuJ,EAAe,YAANvJ,GAAmBvgB,OAAOc,UAAUyoB,eAAehU,KAAKuU,EAAKvJ,IAAIqI,EAAgBzf,EAAQ2gB,EAAKvJ,GAEtI,OADAsY,EAAmB1vB,EAAQ2gB,GACpB3gB,CACX,EACImgB,EAAgBtqB,MAAQA,KAAKsqB,cAAiB,SAASR,EAAG5oB,GAC1D,IAAK,IAAI4gB,KAAKgI,EAAa,YAANhI,GAAoB9gB,OAAOc,UAAUyoB,eAAehU,KAAKrV,EAAS4gB,IAAI8H,EAAgB1oB,EAAS4oB,EAAGhI,EAC3H,EACIud,EAAUr/B,MAAQA,KAAKq/B,QAAW,SAAU5nB,EAAGvF,GAC/C,IAAI4X,EAAsB,mBAAXW,QAAyBhT,EAAEgT,OAAOC,UACjD,IAAKZ,EAAG,OAAOrS,EACf,IAAmB6nB,EAAY1yB,EAA3B5K,EAAI8nB,EAAEvT,KAAKkB,GAAO8nB,EAAK,GAC3B,IACI,WAAc,IAANrtB,GAAgBA,KAAM,MAAQotB,EAAIt9B,EAAE2oB,QAAQC,MAAM2U,EAAGj9B,KAAKg9B,EAAEn+B,MAQxE,CANA,MAAO0C,GAAS+I,EAAI,CAAE/I,MAAOA,EAAS,CACtC,QACI,IACQy7B,IAAMA,EAAE1U,OAASd,EAAI9nB,EAAU,SAAI8nB,EAAEvT,KAAKvU,EAElB,CAAhC,QAAU,GAAI4K,EAAG,MAAMA,EAAE/I,KAAO,CACpC,CACA,OAAO07B,CACX,EACIC,EAAiBx/B,MAAQA,KAAKw/B,eAAkB,SAAUC,EAAIhP,EAAMiP,GACpE,GAAIA,GAA6B,IAArBtM,UAAUxwB,OAAc,IAAK,IAA4B28B,EAAxBv9B,EAAI,EAAGof,EAAIqP,EAAK7tB,OAAYZ,EAAIof,EAAGpf,KACxEu9B,GAAQv9B,KAAKyuB,IACR8O,IAAIA,EAAKtW,MAAMnnB,UAAUmB,MAAMsT,KAAKka,EAAM,EAAGzuB,IAClDu9B,EAAGv9B,GAAKyuB,EAAKzuB,IAGrB,OAAOy9B,EAAG/vB,OAAO6vB,GAAMtW,MAAMnnB,UAAUmB,MAAMsT,KAAKka,GACtD,EACIjG,EAAYxqB,MAAQA,KAAKwqB,UAAa,SAAS/S,GAC/C,IAAIwB,EAAsB,mBAAXwR,QAAyBA,OAAOC,SAAUZ,EAAI7Q,GAAKxB,EAAEwB,GAAIjX,EAAI,EAC5E,GAAI8nB,EAAG,OAAOA,EAAEvT,KAAKkB,GACrB,GAAIA,GAAyB,iBAAbA,EAAE7U,OAAqB,MAAO,CAC1C+nB,KAAM,WAEF,OADIlT,GAAKzV,GAAKyV,EAAE7U,SAAQ6U,OAAI,GACrB,CAAEtW,MAAOsW,GAAKA,EAAEzV,KAAM4oB,MAAOnT,EACxC,GAEJ,MAAM,IAAIyI,UAAUjH,EAAI,0BAA4B,kCACxD,EACI4R,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQm9C,aAAen9C,EAAQo9C,WAAap9C,EAAQq9C,qBAAuBr9C,EAAQy+B,yBAA2Bz+B,EAAQ+8C,qBAAuB/8C,EAAQ2+B,mBAAqB3+B,EAAQ4+B,iBAAmB5+B,EAAQ88C,sBAAmB,EAChO,IAAIhzB,EAAWH,EAAgB,EAAQ,KACnC6T,EAAM5E,EAAa,EAAQ,KAC3B0kB,EAAS1kB,EAAa,EAAQ,MAC9BiG,EAAQjG,EAAa,EAAQ,MAwDjC,SAAS+F,EAAmBG,GACxB,IAAKA,EAAMye,QACP,OAAOD,EAAO3e,mBAAmBG,GACrC,IAAIM,EAAeie,EAAqBve,GACxC,MAAO,CACHlD,WAAYkD,EAAMxoB,KAAKknC,SACvB3hB,QAASyC,EAAcA,EAAc,GAAIH,GAAQW,EAAM2e,YAAc,IAAIj+C,KAAI,SAAUorB,GACnF,IAAI0F,EAAI1F,EAAG0F,EAAGqL,EAAM/Q,EAAG+Q,IACvB,MAAO,CACHpX,KAAM,MACN4H,KAAMiT,EAAa9O,GACnBqL,IAAKA,EAEb,MAAK,GAAQwC,GAAQW,EAAM4e,aAAe,IAAIl+C,KAAI,SAAUorB,GACxD,IAAI0F,EAAI1F,EAAG0F,EAAG5f,EAAWka,EAAGla,SAC5B,MAAO,CACH6T,KAAM,OACN4H,KAAMiT,EAAa9O,GACnB2L,UAAWmD,EAAa96B,KAAKC,MAAMmM,IAE3C,MAAK,GAEb,CAmCA,SAASitC,EAAsB7e,GAC3B,OAAOA,EAAMye,QACPze,EAAM8e,eACN9e,EAAM+e,YAChB,CApHAz0B,EAAa,EAAQ,KAAYppB,GAgCjCA,EAAQ88C,iBA5BR,SAA0Bhe,GACtB,IAAIgf,EAAYhf,EAAMxoB,KAClBA,EAAO,CAAC,EAYZ,OAXIwnC,EAAUhrC,QACVwD,EAAKxD,MAAQgrC,EAAUhrC,OACvBgrC,EAAU9qC,SACVsD,EAAKtD,OAAS8qC,EAAU9qC,QACxB8qC,EAAUjrC,QACVyD,EAAKzD,MAAQirC,EAAUjrC,OACvBirC,EAAUzqC,QACViD,EAAKjD,MAAQyqC,EAAUzqC,OAC3BiD,EAAKvD,UAIL,WACI,IAAK+rB,EAAMye,QACP,MAAO,CAAC,yBACZ,IAAIxqC,EAAY,GACZ+qC,EAAUC,YAA8C,iBAAzBD,EAAUC,YACzChrC,EAAU3R,KAAK08C,EAAUC,YAEzBD,EAAUE,UAA0C,iBAAvBF,EAAUE,UACvCjrC,EAAU3R,KAAK6wB,MAAMlf,EAAWurB,EAAc,GAAIH,EAAO2f,EAAUE,SAASz+C,MAAM,QAAQ,IAE9F,OAAOwT,CACX,CAfiBkrC,GACbH,EAAU7qC,aACVqD,EAAKrD,WAAa6qC,EAAU7qC,YACzB,IAAIuqB,EAAIhB,SAASlmB,EAa5B,EAkBAtW,EAAQ4+B,iBAbR,SAA0BE,GACtB,IAAKA,EAAMye,QACP,OAAOD,EAAO1e,iBAAiBE,GACnC,IAAIM,EAAeie,EAAqBve,GACpC3M,EAAQ2M,EAAM3M,MAClB,OAAO,EAAIrI,EAASnlB,SAASwtB,GACxB3yB,KAAI,SAAUorB,GACf,IAAI0F,EAAI1F,EAAG0F,EACX,OAAO8O,EAAa9O,EACxB,IACKyO,SACA9+B,OACT,EA8BAD,EAAQ2+B,mBAAqBA,EAiC7B3+B,EAAQ+8C,qBApBR,SAA8Bje,EAAOz6B,QACjB,IAAZA,IAAsBA,EAAU,CAAC,GACrC,IAAI+lB,EAVR,SAAwB0U,GACpB,IAAIlU,EAAK+T,EAAmBG,GAAQlD,EAAahR,EAAGgR,WAAYC,EAAUjR,EAAGiR,QAC7E,OAAO,IAAI2B,EAAIhC,OAAOI,EAAYC,EACtC,CAOiBqiB,CAAepf,GACxBlU,EAuBR,SAAoDkU,EAAO1U,EAAQ/lB,GAC/D,IAAI0oB,EAAKnC,EAAIiE,EAAK5B,EACdkxB,EAAqB,EACrB/e,EAAeie,EAAqBve,GACpC3U,EAAQ,GACRE,EAAY,CAAC,EACb+zB,EAAgBT,EAAsB7e,GAC1C,GAAIsf,EACA,IACI,IAAK,IAAIC,EAAkB/0B,EAAS80B,GAAgBE,EAAoBD,EAAgB50B,QAAS60B,EAAkB50B,KAAM40B,EAAoBD,EAAgB50B,OAAQ,CACjK,IAAIyD,EAAKoxB,EAAkBr+C,MAAOs+C,EAASrxB,EAAG/tB,KAAMq/C,EAAoBtxB,EAAG/C,MACvEs0B,EAAc30B,EAASnlB,QAAQo6B,OAAOyf,EAAmB,KACzDE,EAAiBP,IACjBQ,EAAa70B,EAASnlB,QAAQi6C,SAAS,GAAKF,EAAgB,EAAG,KAC/DG,EAAShgB,EAAMM,wBAAwBqf,EAAmBp0B,EAAQ,CAClEgV,aAAcA,IAElB/U,EAAUs0B,GAAcJ,EACxB,IACI,IAAK,IAAIO,GAAiBjwB,OAAM,EAAQvF,EAASm1B,IAAeM,EAAkBD,EAAcr1B,QAASs1B,EAAgBr1B,KAAMq1B,EAAkBD,EAAcr1B,OAAQ,CACnK,IAAIuF,EAAK+vB,EAAgB9+C,MAAOwwB,EAAIzB,EAAGyB,EAAGH,EAAItB,EAAGsB,EAAGpQ,EAAI8O,EAAG9O,EACvD2L,EAAO,CACPsB,OAAQ6xB,EAAUvuB,EAAGpsB,GACrB8nB,KAAMiT,EAAa9O,GACnBhC,SAAUqwB,EACVjwB,aAAS5Z,GAEToL,EAAI,IACJ2L,EAAK6C,QAAU0Q,EAAa9O,EAAIpQ,IAEpC,IAAIne,EAAQ88C,EAAO99C,IAAIuvB,GACnBvuB,IACAjC,OAAO8tB,OAAO/B,EAAM9pB,GACpBooB,EAAM/oB,KAAKyqB,GAEnB,CAQJ,CANA,MAAOyD,GAAST,EAAM,CAAElsB,MAAO2sB,EAAS,CACxC,QACI,IACQyvB,IAAoBA,EAAgBr1B,OAASuD,EAAK6xB,EAAczxB,SAASJ,EAAG5X,KAAKypC,EAErD,CAApC,QAAU,GAAIjwB,EAAK,MAAMA,EAAIlsB,KAAO,CACxC,CACJ,CAQJ,CANA,MAAOyqB,GAASL,EAAM,CAAEpqB,MAAOyqB,EAAS,CACxC,QACI,IACQkxB,IAAsBA,EAAkB50B,OAASkB,EAAKyzB,EAAgBhxB,SAASzC,EAAGvV,KAAKgpC,EAE3D,CAApC,QAAU,GAAItxB,EAAK,MAAMA,EAAIpqB,KAAO,CACxC,CAEJ,MAAO,CAAEwnB,MAAOA,EAAOE,UAAWA,EACtC,CA9Ea40B,CAA2CngB,EAAO1U,EAAQ/lB,GAAU8lB,EAAQS,EAAGT,MAAOE,EAAYO,EAAGP,UAC9G,MAAO,CAIHD,OAAQA,EAIRD,MAAO,IAAIqT,EAAI3E,MAAM1O,GAKrBE,UAAW,IAAImT,EAAId,UAAUrS,GAErC,EA+DA,IAAI60B,EAAW,EAAQ,KAEvB,SAAS7B,EAAqBve,GAC1B,IAAKA,EAAMye,QACP,OAAOD,EAAO5e,WAClB,IAAIygB,EAAcrgB,EAAMxoB,MAAQwoB,EAAMxoB,KAAK6oC,YAAe,IAC1D,OAAO,SAAU7uB,GAAK,OAAOA,EAAI6uB,CAAY,CACjD,CAEA,SAASH,EAAUvuB,EAAGpsB,GAClB,OAAQosB,GACJ,KAAK,EACD,MAAO,IACX,KAAK,EACD,MAAO,IACX,KAAK,EACD,MAAO,IACX,KAAK,EACD,MAAO,IACX,KAAK,EACD,MAAO,IACX,KAAK,EACD,MAAO,IACX,KAAK,EACD,MAAO,IACX,KAAK,EACD,MAAO,KAEf,GAAIpsB,EAAQ05B,OACR,OAAQtN,GACJ,KAAK,EACD,MAAO,IACX,KAAK,GACD,MAAO,IACX,KAAK,GACD,MAAO,KACX,KAAK,GACD,MAAO,KACX,KAAK,GACD,MAAO,KACX,KAAK,GACD,MAAO,KACX,KAAK,GACD,MAAO,KACX,KAAK,GACD,MAAO,MAIvB,CAhDA3wB,OAAOC,eAAeC,EAAS,2BAA4B,CAAEmpB,YAAY,EAAMpoB,IAAK,WAAc,OAAOm+C,EAASzgB,wBAA0B,IAO5Iz+B,EAAQq9C,qBAAuBA,EA8E/Br9C,EAAQo9C,WAjCR,SAAoBte,GAChB,IAAIhQ,EAAKlE,EAAI2C,EAAKN,EACdmxB,EAAgBT,EAAsB7e,GAC1C,GAAIsf,EACA,IACI,IAAK,IAAIgB,EAAkB91B,EAAS80B,GAAgBiB,EAAoBD,EAAgB31B,QAAS41B,EAAkB31B,KAAM21B,EAAoBD,EAAgB31B,OAAQ,CACjK,IAAIU,EAAQk1B,EAAkBp/C,MAAMkqB,MACpC,IACI,IAAK,IAAImV,GAAW/R,OAAM,EAAQjE,EAASa,IAASoV,EAAYD,EAAQ7V,QAAS8V,EAAU7V,KAAM6V,EAAYD,EAAQ7V,OAAQ,CACzH,IAAIgH,EAAI8O,EAAUt/B,MAAMwwB,EACxB,GAAU,IAANA,GAAiB,KAANA,EACX,OAAO,CACf,CAQJ,CANA,MAAO/C,GAASH,EAAM,CAAE5qB,MAAO+qB,EAAS,CACxC,QACI,IACQ6R,IAAcA,EAAU7V,OAASuD,EAAKqS,EAAQjS,SAASJ,EAAG5X,KAAKiqB,EAEnC,CAApC,QAAU,GAAI/R,EAAK,MAAMA,EAAI5qB,KAAO,CACxC,CACJ,CAQJ,CANA,MAAO0sB,GAASP,EAAM,CAAEnsB,MAAO0sB,EAAS,CACxC,QACI,IACQgwB,IAAsBA,EAAkB31B,OAASkB,EAAKw0B,EAAgB/xB,SAASzC,EAAGvV,KAAK+pC,EAE3D,CAApC,QAAU,GAAItwB,EAAK,MAAMA,EAAInsB,KAAO,CACxC,CAEJ,OAAO,CACX,EAmDA3C,EAAQm9C,aA9CR,SAAsBre,GAClB,IAAIwgB,EAAK10B,EAAI20B,EAAKtyB,EACdmxB,EAAgBT,EAAsB7e,GACtC0gB,GAAU,EACVC,GAAkB,EAClBC,GAAgB,EACpB,GAAItB,EACA,IACI,IAAK,IAAIuB,EAAkBr2B,EAAS80B,GAAgBwB,EAAoBD,EAAgBl2B,QAASm2B,EAAkBl2B,KAAMk2B,EAAoBD,EAAgBl2B,OAAQ,CACjK,IAAIU,EAAQy1B,EAAkB3/C,MAAMkqB,MACpC,IACI,IAAK,IAAI01B,GAAWN,OAAM,EAAQj2B,EAASa,IAAS21B,EAAYD,EAAQp2B,QAASq2B,EAAUp2B,KAAMo2B,EAAYD,EAAQp2B,OAAQ,CACzH,IAAIgH,EAAIqvB,EAAU7/C,MAAMwwB,EACxB+uB,GAAU,EACN/uB,GAAK,IAAMA,GAAK,KAChBgvB,GAAkB,GACZ,IAANhvB,GAAiB,IAANA,GAAiB,KAANA,GAAkB,KAANA,IAClCivB,GAAgB,EACxB,CAQJ,CANA,MAAOK,GAASR,EAAM,CAAE58C,MAAOo9C,EAAS,CACxC,QACI,IACQD,IAAcA,EAAUp2B,OAASuD,EAAK4yB,EAAQxyB,SAASJ,EAAG5X,KAAKwqC,EAEnC,CAApC,QAAU,GAAIN,EAAK,MAAMA,EAAI58C,KAAO,CACxC,CACJ,CAQJ,CANA,MAAOq9C,GAASV,EAAM,CAAE38C,MAAOq9C,EAAS,CACxC,QACI,IACQJ,IAAsBA,EAAkBl2B,OAASkB,EAAK+0B,EAAgBtyB,SAASzC,EAAGvV,KAAKsqC,EAE3D,CAApC,QAAU,GAAIL,EAAK,MAAMA,EAAI38C,KAAO,CACxC,CAEJ,OAAK68C,EAEDC,EACOC,EAAgB,MAAQ,MAGxBA,EAAgB,KAAO,KALvB,OAOf,C,mCCzXA5/C,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,G,mCCHtD,aA4Ce,IA7BR,MAILvB,YACEuhD,EACgB57C,GAAA,KAAAA,UAEhBvF,KAAKwG,QAAUjB,EAAQiB,QAAQ9F,KAAI,SAAUwqB,EAAegE,GAK1D,OAJAhE,EAAgBlqB,OAAO8tB,OAAO,CAAC,EAAG5D,EAAe,CAC/C+V,UAAW17B,EAAQ4F,mBAAqB,IACxCi2B,SAAU77B,EAAQ67B,WAEb,IAAI,IAAO+f,EAAWjyB,GAAQA,EAAQ,EAAGhE,EAClD,GACF,CAGInlB,cACF,MAAM3D,EAAM,IAAI0a,IAChB,IAAK,MAAMrW,KAAUzG,KAAKwG,QACxB,IAAK,MAAMyW,KAAUxW,EAAOkK,UAAU5K,QACpC3D,EAAIK,IAAIwa,GAGZ,OAAOgM,MAAMwH,KAAKruB,EACpB,E,mCCzCF,sCAKA,SAASg/C,EAAWjxB,GAClBA,EAAQ,IAAE8P,OAAO9P,EAAO,QACxB,IAAInuB,EAAI,EACR,MAAO,CACL2oB,KAAKljB,GACH,MAAMggB,EAAM,GACZ,KAAOzlB,EAAImuB,EAAMvtB,QAAU6E,GAAQ0oB,EAAMnuB,GAAGyF,KAAMzF,IAChDylB,EAAInlB,KAAK6tB,EAAMnuB,IAEjB,OAAOylB,CACT,EAEJ,CAsEe,IApER,MACL7nB,aAAY,OAAE6G,EAAM,QAAEV,EAAO,OAAEC,EAAM,YAAEq7C,EAAW,OAAEp7C,IAClD,MAAM0K,EAAYlK,EAAOkK,UACzB3Q,KAAKshD,aACHD,GACA,IAAI,IAAYr7C,EAAQD,EAAS4K,EAAU4a,UAAW,CAAEtlB,WAC1DjG,KAAKysB,OAAS20B,EAAWzwC,EAAUsf,OACnCjwB,KAAKssB,OAAS80B,EAAWzwC,EAAU0a,OACnCrrB,KAAKuhD,QAAU,IAAIh7C,IACnBvG,KAAKwhD,aAAe/6C,EAAOlB,QAAQ07B,SACrC,CAEAp6B,OAAOY,EAAMV,GACX/G,KAAKyhD,mBAAmBh6C,GACxBzH,KAAK0hD,gBAAgBj6C,EAAMV,GAC3B/G,KAAK2hD,0BAA2B56C,GAASA,EAAMypC,cAAcC,QAAW,GAC1E,CAEAgR,mBAAmBh6C,GACjB,IAAK,MAAMm6C,KAAQ5hD,KAAKysB,OAAO9B,KAAKljB,EAAO,EAAI,IAC7CzH,KAAKshD,aAAapG,SAAS0G,EAAMA,EAAKn6C,KAAOA,EAEjD,CAEAi6C,gBAAgBj6C,EAAMV,GACpB,MAAM86C,EAAa7hD,KAAKssB,OAAO3B,KAAKljB,EAAO,EAAI,IACzC26B,EAAOr7B,GAASA,EAAM+G,MAAMs0B,KAElC,GADmBpiC,KAAKwhD,aAAepf,EAEvC,IAAK,MAAMrV,KAAQ80B,EACjB7hD,KAAK8hD,SAAS/0B,EAAMA,EAAKtlB,KAAOA,EAEpC,CAEAk6C,0BAA0BI,GACxB,IAAK,MAAM9L,KAAgB8L,EAAoB,CAC7C,MAAM,KAAEt8B,EAAI,KAAEsH,GAASkpB,EACV,QAATxwB,EACFzlB,KAAK8hD,SAAS/0B,EAAM,EAAGkpB,EAAa/S,UAClB,UAATzd,EACTzlB,KAAKgiD,WAAWj1B,GACE,SAATtH,GACTzlB,KAAKshD,aAAajG,SAAStuB,EAAM,E,CAGvC,CAEA+0B,SAAS/0B,EAAM5nB,EAAO+9B,GACpB,IAAIhmB,EAAWld,KAAKuhD,QAAQt/C,IAAI8qB,GAC3B7P,IACHA,EAAWld,KAAKshD,aAAalG,SAASruB,EAAM5nB,GAC5CnF,KAAKuhD,QAAQn/C,IAAI2qB,EAAM7P,IAErBA,GACE,YAAMgmB,IACRhmB,EAASlB,KAGf,CAEAgmC,WAAWj1B,GACT,MAAM7P,EAAWld,KAAKuhD,QAAQt/C,IAAI8qB,GAC9B7P,GACFA,EAAS/B,MAEb,E,mCCpFF,8BAmDe,IA5CR,MAYLvb,YAA4BkG,GAAA,KAAAA,OAVrB,KAAAwC,cAAgB,EAEhB,KAAAC,gBAAiB,EAEjB,KAAAC,SAAU,EAEV,KAAAyE,UAAW,EAKhBjN,KAAKsG,SAAW,IAAIC,IAClBT,EAAKU,QAAQ9F,KAAK+F,GAAW,CAACA,EAAQ,IAAI,IAAYA,MAE1D,CAEAI,OAAOyqC,EAAkB3pC,EAAkBs6C,GACzC,IAAIh1C,GAAW,EACf,IAAK,MAAOxG,EAAQ49B,KAAgBrkC,KAAKsG,SACvC+9B,EAAYx9B,OAAOyqC,EAAU3pC,GACxB08B,EAAYp3B,WAAUA,GAAW,GAGxCjN,KAAKsI,cAAgB25C,EAAM35C,cAC3BtI,KAAKuI,eAAiB05C,EAAM15C,eAC5BvI,KAAKwI,QAAUy5C,EAAMz5C,QACrBxI,KAAKiN,SAAWA,CAClB,CAEAxG,OAAOqb,GAEL,OADoB9hB,KAAKsG,SAASrE,IAAI6f,IAGpC,KACE,EACA,2DACAA,EAAEzO,OAGR,E,mCChDF,sBAIA,MAAM6uC,EAAU,CACd,OACA,OACA,OACA,OACA,OACA,OACA,OACA,SAKF,SAASC,IACP,MAAMr0C,EAAQ,GAEd,OADAvE,OAAO64C,mBAAmB9/C,KAAKwL,GACxB,CACLu0C,OAAO16C,GACL,IAAK,MAAM,EAAEgqB,EAAC,EAAEH,KAAO7pB,EACrBmG,EAAMxL,KAAK,CAAEqvB,EAAGnsB,KAAKgO,MAAMme,GAAIH,EAAGhsB,KAAKgO,MAAMge,IAEjD,EACA5G,OACM9c,EAAMlL,SACR0/C,aAA2B,aAAI5T,KAAKrsB,UAAU9Y,OAAO64C,oBAEzD,EAEJ,CAjBA74C,OAAO64C,mBAAqB,GAmIb,IAhHR,SAAqBx7C,GAC1B,IAAI27C,EAAgB,KAChBC,EAAW,KACf,MAAMC,EAAW,IAAMvvB,KAAK,iBAuC5B,WACE,OAAOtsB,EAAQe,KACjB,IAxCM+6C,EAAa,IAAMxvB,KAAK,kBAqD9B,SAAqBvrB,GACnB,MAAM2xB,EAAU1yB,EAAQgO,KAAY,MACpC,IAAK0kB,EAAS,OAAO,EACrBkpB,EAAW,KACX,IAAK,MAAM1gC,KAAKna,EAAO,CACrB,IAAK,MAAMjF,KAAU42B,EACnB,GAAIqpB,EAAQjgD,EAAOkgD,YAAa,IAAIC,SAAS/gC,EAAE6P,EAAG7P,EAAE0P,GAAI,CACtDgxB,EAAW1gC,EAAE0P,EACb,K,CAGJ,GAAiB,OAAbgxB,EACF,K,CAGJ,GAAiB,OAAbA,EAEF,OADAD,EAAgB,KACT,EAEa,OAAlBA,IACFA,EAAgBC,GAEdA,EAAWD,EAAgB,GAC7BA,EAAgBC,EAAW,GAClBA,EAAWD,EAAgB,KACpCA,EAAgBC,EAAW,IAE7B,OAAOA,EAAWD,EAAgB,GAC7B,EACDC,EAAWD,EAAgB,EAC3B,EACA,CACN,IApFMO,EAAY,IAAM5vB,KAAK,iBAwC7B,SAAoBvrB,EAAO2iC,GACzB,MAAMhR,EAAU1yB,EAAQgO,KAAK01B,GAC7B,GAAIhR,EACF,IAAK,MAAM52B,KAAU42B,EAAS,CAC5B,MAAMypB,EAASJ,EAAQjgD,EAAOkgD,aAC9B,IAAK,MAAM9gC,KAAKna,EACd,GAAIo7C,EAAOF,SAAS/gC,EAAE6P,EAAG7P,EAAE0P,GAAI,OAAO,C,CAI5C,OAAO,CACT,IAlDMwxB,EAAW,IAAM9vB,KAAK,iBAoF5B,SAAmBvrB,GACjB,IAAItE,EAAI,KACJC,EAAI,KACR,IAAK,MAAMwe,KAAKna,EACd,GAAIma,EAAE0P,EAAIyxB,EACR,GAAU,OAAN5/C,EACFA,EAAIye,EAAE0P,MACD,IAAU,OAANluB,EAGT,OAAO,EAFPA,EAAIwe,EAAE0P,C,CAMZ,OAAU,OAANnuB,GAAoB,OAANC,EACTkC,KAAK+S,IAAIlV,EAAIC,GAEb,CAEX,IAtGM4/C,EAAgB,IAAIf,EACpBlN,EAA+C,YAAjCruC,EAAQ0tC,SAASlkC,YAC/B6yC,EAAiBhO,EAAc,IAAe,IAAKzjB,EAAI,IAC7D,MAAO,CACLnxB,KAAM,cACN4B,MACE,MAAM0F,EAAQ86C,IACRp5C,EAAS,CAAC,EACZ,IAAM+D,UAAS,IAAMU,MAAM,iBAAmB,GAAKnG,EAAM/E,QAC7DsgD,EAAcb,OAAO16C,GACrB0B,EAAc,MAAIq5C,EAAW/6C,GAC7B,IAAK,MAAM2iC,KAAU4X,EACnB74C,EAAOihC,GAAUwY,EAAUn7C,EAAO2iC,GAEpC,GAAI2K,EACF,IAAK,MAAMnzB,KAAKna,EAAO,CACrB,MAAMw7C,EAAO,IAAyBrhC,EAAE6P,EAAG7P,EAAE0P,GACzC2xB,IAAM95C,EAAO,MAAQ85C,GAAQ,E,CAIrC,OADA95C,EAAiB,SAAI25C,EAASr7C,GACvB0B,CACT,EACA3C,UACEw8C,EAAct4B,MAChB,GAEF,SAAS+3B,EAAQS,EAAWn0B,EAAS,GACnC,MAAMo0B,EAAUD,EAAUE,QAK1B,OAJAD,EAAQ1xB,GAAK1C,EACbo0B,EAAQ7xB,GAAKvC,EACbo0B,EAAQrwC,OAAkB,EAATic,EACjBo0B,EAAQtf,QAAmB,EAAT9U,EACXo0B,CACT,CAqEF,C,mCChJA,yEAsMA,SAASE,EAAkB7wB,EAAS5f,GAClC,MAAMw3B,EAAS/4B,SAASC,cAAc,UAatC,OAZA84B,EAAOvlC,iBACL,cACC6H,IACCA,EAAEG,iBAAiB,IAErB,GAEFu9B,EAAOkZ,QAAW52C,IAChBA,EAAEE,iBACF4lB,GAAS,EAEX4X,EAAOx3B,UAAYA,EACZw3B,CACT,CAEe,IA9MR,MACL1qC,aAAY,KAAEkG,EAAI,QAAEc,EAAO,uBAAE6L,EAAsB,MAAEnB,IACnDtR,KAAKoL,MAAQtF,EACb9F,KAAKoG,SAAWQ,EAChB,MAAM0tC,EAAW1tC,EAAQ0tC,SACzBt0C,KAAKsG,SAAW,IAAIC,IAClBT,EAAKU,QAAQ9F,KAAK+F,GAAW,CAC3BA,EACA,IAAI,IAAcA,EAAQ6tC,OAG9Bt0C,KAAK00C,UAAY,CAAC,EAClB10C,KAAKyjD,SAAWzjD,KAAK0jD,eAAe,CAClCjxC,yBACAnB,QACAqyC,eAAgB79C,EAAKU,QAAQ,GAAGjB,QAAQuvB,UACxC8uB,kBAAmBtP,EAASsP,oBAE9B5jD,KAAK6jD,2BACL7jD,KAAK8jD,0BACL9jD,KAAK+jD,kBAAmB,CAC1B,CAEAp4C,iBAAiBq4C,GACfhkD,KAAKikD,UAAYD,CACnB,CAEAn4C,iBAAiBq4C,GACflkD,KAAKmkD,UAAYD,CACnB,CAEAp5C,QACE9K,KAAKokD,UAAW,IAAIjtC,MAAO04B,UAC3B,MAAMppC,EAASzG,KAAKoL,MAAM5E,QAAQ,GAC5BglB,EAAW/kB,EAAOkK,UAAU6a,SAC5B9R,EAASjT,EAAOlB,QAAQy7B,gBAAkB,cAAgB,GAChEhhC,KAAK00C,UAAsB,WAAIh7B,EAAS8R,EAASxX,MACjDhU,KAAK00C,UAAuB,YAAIlpB,EAAStX,OACzClU,KAAKqsB,UAAY5lB,EAAOkK,UAAUiB,QACpC,CAEAlL,UACE1G,KAAKoG,SAASM,SAChB,CAEAG,OAAOyqC,EAAU+S,GACf,MAAM58C,IAAQ,IAAI0P,MAAO04B,UAAY7vC,KAAKokD,UAAY,IAChDl6C,EAAOlK,KAAKskD,SAAS78C,EAAM6pC,EAAU+S,GAC3CrkD,KAAKukD,oBAAoB98C,EAAM6pC,EAAU+S,GACzCrkD,KAAKoG,SAASyM,OAAO7R,OAAO8tB,OAAO,CAAC,EAAG9uB,KAAK00C,UAAWxqC,IACvDlK,KAAKwkD,kBAAkBlT,GACvBtxC,KAAKykD,+BAA+BnT,EACtC,CAEAkT,kBAAkBlT,GACZtxC,KAAK0kD,SAAW1kD,KAAK2kD,eAAiBrT,GAAYtxC,KAAK4kD,eACzD5kD,KAAK0kD,OAAOz+C,OAAS,EACrBjG,KAAK0kD,OAAO7pC,OACZ7a,KAAK0kD,OAAOzvC,UAAUxS,IAAI,cAC1BzC,KAAK2kD,eAAgB,EAEzB,CAEAF,+BAA+BnT,GAC7B,GAAItxC,KAAKoL,MAAM7F,QAAQ67B,SAAU,CAG7BkQ,GAFqC,gBAGpCtxC,KAAK+jD,mBAEN/jD,KAAK+jD,kBAAmB,EACxB/jD,KAAK6kD,YAAY5vC,UAAUxS,IAAI,Y,CAGrC,CAEA6hD,SAAS78C,EAAM6pC,EAAU+S,GACvB,MAAMn6C,EAAO,CAAC,EACdA,EAAe,SAAIlK,KAAKoL,MAAM7F,QAAQ67B,SAAW,MAAQ,KACzDl3B,EAAQ,EAAIzC,EACZyC,EAAe,SAAIonC,EACnBpnC,EAAY,MAAIlK,KAAK8kD,UAAUT,GAC/Bn6C,EAAgB,UAAIlK,KAAK+kD,aAAazT,GACtC,IAAK,MAAO7qC,EAAQu+C,KAAkBhlD,KAAKsG,SAAU,CACnD,MAAM+9B,EAAcggB,EAAU59C,OAAOA,GAC/Bw+C,EAAaD,EAAcn+C,OAAOY,EAAM6pC,EAAUjN,GACxD,IAAK,MAAMhiC,KAAO4iD,EAChB/6C,EAAK,IAAIzD,EAAO4M,UAAUhR,KAAS4iD,EAAW5iD,E,CAGlD,OAAO6H,CACT,CAEAq6C,oBAAoB98C,EAAM6pC,EAAU+S,GAClC,MAAMn6C,EAAOlK,KAAK00C,eACM1+B,IAApB9L,EAAc,SAAmBm6C,EAAU77C,UAC7C0B,EAAc,QAAIzC,QAEWuO,IAA3B9L,EAAqB,gBAAmBm6C,EAAU97C,iBACpD2B,EAAqB,eAAIzC,EAE7B,CAEAs9C,aAAazT,GACX,OACE,YAAW9rC,KAAKwD,IAAIhJ,KAAKqsB,UAAW7mB,KAAK+V,IAAI,EAAG+1B,KAChD,MACA,YAAWtxC,KAAKqsB,UAEpB,CAEAy4B,UAAUT,GACR,MAAM90C,EAAI80C,EAAU/7C,cACpB,OAAOiH,EAAI,GAAM/J,KAAKqD,IAAI,GAAK0G,EAAI,IAAO,GAAK,GAAK,CACtD,CAEAm0C,gBAAe,uBACbjxC,EAAsB,MACtBnB,EAAK,eACLqyC,EAAc,kBACdC,IAEA,MAAMsB,EAAW,IAAE,oCAChBC,KAAK,uBAAwBxB,GAC7BwB,KAAK,2BAA4BvB,GACjCwB,OAAO,sDACPA,OAAOplD,KAAK2d,MAWf,OAVIlL,GACFtS,QAAQC,QAAQqS,GAAwBtE,MAAMO,GAC5Cw2C,EAASG,KAAK,kBAAkBD,OAAO12C,KAGvC4C,IACFtR,KAAK0kD,OAASpzC,EAAMa,QACpBnS,KAAK4kD,aAAetzC,EAAMc,OAC1B,IAAEd,EAAMa,SAASmzC,SAAS,0BAA0BC,SAASL,IAExDA,EAAS,EAClB,CAEArB,2BACE,MAAM2B,EAAej0C,SAASC,cAAc,OAC5Cg0C,EAAa1yC,UAAY,sCACzB9S,KAAKylD,QAAQ3wC,YAAY0wC,GACzBA,EAAavwC,UAAUxS,IAAI,cAC3B,MAAMijD,EAAiB,CAAC5yC,EAAW4f,KACjC,MAAM4X,EAASiZ,EAAkB7wB,EAAS5f,GAC1C0yC,EAAa1wC,YAAYw1B,EAAO,EAElCob,EAAe,qCAAqC,IAAM1lD,KAAKikD,cAC/DyB,EAAe,qCAAqC,IAAM1lD,KAAKmkD,cAE/D,MAAMwB,EAAap0C,SAASC,cAAc,OAC1Cm0C,EAAWC,YAAc,0CACzBD,EAAW7yC,UAAY,4BACvB9S,KAAK6kD,YAAcc,EACnBH,EAAa1wC,YAAY6wC,EAC3B,CAEA7B,0BACE,GAAI,gBAA8B,IAAW12C,QAC3C,OAEF,MAAMo4C,EAAej0C,SAASC,cAAc,OAC5Cg0C,EAAa1yC,UAAY,kDACzB9S,KAAKylD,QAAQ3wC,YAAY0wC,GACzB,MAGMlb,EAASiZ,GAHC,KACd,IAAWsC,SAAS,GAIpB,yCAEFL,EAAa1wC,YAAYw1B,EAC3B,CAEI1jC,cACF,OAAO5G,KAAKoG,QACd,CAEIuX,WACF,OAAO3d,KAAKoG,SAASuX,IACvB,CAEI8nC,cACF,OAAOzlD,KAAKyjD,QACd,E,sBClMF,IAAI7yB,EAAU,EAAQ,KAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAAChrB,EAAO5D,EAAI4uB,EAAS,MAOhE,IAAIrrB,EAAU,CAAC,KAAM,EAErBA,UAPIsrB,UAQJtrB,gBAAqByQ,GAER,EAAQ,EAAR,CAAsH4a,EAASrrB,GAEzIqrB,EAAQE,SAAQlrB,EAAO1E,QAAU0vB,EAAQE,O,sBCjB5C,IAAI5O,EAAS,EAAQ,IACXtc,EAAO1E,QAAU,EAAQ,EAAR,EAA8H,IAKjJoB,KAAK,CAACsD,EAAO5D,EAAI,+OAAiPkgB,EAAO,EAAQ,MAA+B,4vEAA8vEA,EAAO,EAAQ,MAAyB,uFAAyFA,EAAO,EAAQ,MAAyB,2FAA6FA,EAAO,EAAQ,MAA6B,u5DAA05D,I,sBCNlwJtc,EAAO1E,QAAU,IAA0B,4C,oBCA3C0E,EAAO1E,QAAU,whC,oBCAjB0E,EAAO1E,QAAU,o9C,oBCAjB0E,EAAO1E,QAAU,wjC,uBCKjB,WACC,aAEA,IAAIqQ,EAA6B,oBAAXhI,aAAqD,IAApBA,OAAOgI,SAA2BhI,OAAOgI,SAAW,CAAC,EACxGu0C,EAA8ClgD,EAAO1E,QACrD6kD,EAAqC,oBAAZC,SAA2B,yBAA0BA,QAE9E9hC,EAAK,WAsDR,IArDA,IAAIhL,EAEA+sC,EAAQ,CACX,CACC,oBACA,iBACA,oBACA,oBACA,mBACA,mBAGD,CACC,0BACA,uBACA,0BACA,0BACA,yBACA,yBAID,CACC,0BACA,yBACA,iCACA,yBACA,yBACA,yBAGD,CACC,uBACA,sBACA,uBACA,uBACA,sBACA,sBAED,CACC,sBACA,mBACA,sBACA,sBACA,qBACA,sBAIEjkD,EAAI,EACJof,EAAI6kC,EAAMrjD,OACVsjD,EAAM,CAAC,EAEJlkD,EAAIof,EAAGpf,IAEb,IADAkX,EAAM+sC,EAAMjkD,KACDkX,EAAI,KAAM3H,EAAU,CAC9B,IAAKvP,EAAI,EAAGA,EAAIkX,EAAItW,OAAQZ,IAC3BkkD,EAAID,EAAM,GAAGjkD,IAAMkX,EAAIlX,GAExB,OAAOkkD,CACR,CAGD,OAAO,CACP,CAjEQ,GAmELC,EAAe,CAClBC,OAAQliC,EAAGmiC,iBACXxiD,MAAOqgB,EAAGoiC,iBAGPC,EAAa,CAChBV,QAAS,SAAUW,GAClB,IAAIX,EAAU3hC,EAAGuiC,kBAEjBD,EAAOA,GAAQj1C,EAASm1C,gBAMpB,oCAAoC7jD,KAAKolC,UAAU0e,WACtDH,EAAKX,KAELW,EAAKX,GAASE,EAAkBC,QAAQY,qBAAuB,CAAC,EAElE,EACAC,KAAM,WACLt1C,EAAS2S,EAAG4iC,iBACb,EACAC,OAAQ,SAAUP,GACbxmD,KAAKgnD,aACRhnD,KAAK6mD,OAEL7mD,KAAK6lD,QAAQW,EAEf,EACAS,SAAU,SAAUxlD,GACnBzB,KAAKknD,GAAG,SAAUzlD,EACnB,EACAoN,QAAS,SAAUpN,GAClBzB,KAAKknD,GAAG,QAASzlD,EAClB,EACAylD,GAAI,SAAUp3B,EAAOruB,GACpB,IAAI6pC,EAAY6a,EAAar2B,GACzBwb,GACH/5B,EAASxM,iBAAiBumC,EAAW7pC,GAAU,EAEjD,EACA0lD,IAAK,SAAUr3B,EAAOruB,GACrB,IAAI6pC,EAAY6a,EAAar2B,GACzBwb,GACH/5B,EAASzM,oBAAoBwmC,EAAW7pC,GAAU,EAEpD,EACA2lD,IAAKljC,GAGDA,GAULljB,OAAOqmD,iBAAiBd,EAAY,CACnCS,aAAc,CACb/kD,IAAK,WACJ,OAAO2W,QAAQrH,EAAS2S,EAAGojC,mBAC5B,GAEDn1C,QAAS,CACRkY,YAAY,EACZpoB,IAAK,WACJ,OAAOsP,EAAS2S,EAAGojC,kBACpB,GAEDl6C,QAAS,CACRid,YAAY,EACZpoB,IAAK,WAEJ,OAAO2W,QAAQrH,EAAS2S,EAAGqjC,mBAC5B,KAIEzB,EACHlgD,EAAO1E,QAAUqlD,EAEjBh9C,OAAOg9C,WAAaA,GAjChBT,EACHlgD,EAAO1E,SAAU,EAEjBqI,OAAOg9C,YAAa,CAgCtB,CAlKD,E,mCCLA,gEAqEe,IA/DR,MACL3mD,YAAYoO,EAAQhI,GAAQ,cAAEwhD,EAAgB,KAAyB,CAAC,GACtExnD,KAAKynD,QAAUz5C,EACfhO,KAAKmG,QAAUH,EACfhG,KAAK0nD,eAAiBF,CACxB,CAEA70C,UAAUkU,EAAO8gC,EAAcC,GAC7B,MAAMh5C,EAAS,IAAoBiY,EAAMjkB,OAAQ+kD,GAC3CE,EAAW,IAAoBhhC,EAAMjkB,OAAQglD,GAQnD,OADIA,IAAgBA,EAAexxC,UAAY,KACxC,IAAKyQ,GAPExmB,GACZ,IAAIF,SAASC,IACXqM,uBAAsB,KACpBrM,EAAQJ,KAAK8nD,YAAYznD,EAAMuO,EAAQi5C,GAAU,GACjD,KAGmB,CAAEnR,YAAa,KAAMvoC,MAAM4+B,GAClD,IAAEA,GAAKzd,SAASy4B,YAAY5mD,SAEhC,CAEAjB,kBAAkBG,EAAMuO,EAAQi5C,GAC9B,MAAMG,EAAqB,WACzB,GAAIhoD,KAAK0nD,eAAe7M,SAASx6C,GAAO,CACtC,MAAM06C,QAAc/6C,KAAK0nD,eAAezlD,IAAI5B,GAG5C,OAFAuO,EAAOvO,GACPwnD,EAASxnD,GACF06C,C,CAET,MAAM7sC,QAAalO,KAAKioD,SAAS5nD,GAC3B0a,QAAe7M,EAAKpO,OAC1B8O,EAAOvO,GACP,MAAMsa,QAAoB3a,KAAKkoD,QAAQntC,GAGvC,OAFA/a,KAAK0nD,eAAe3M,MAAM16C,EAAMsa,GAChCktC,EAASxnD,GACFsa,CACR,EAd0B,GAe3B,IACE,MAAMA,QAAoBqtC,EAEpB/qC,QAAejd,KAAKmG,QAAQ8W,OAAOtC,GACzC,MAAO,CAACta,EAAM4c,E,CACd,MAAOrQ,GAEP,OADA0F,QAAQzO,MAAM,4BAA8BxD,EAAMuM,GAC3C,I,CAEX,CAEAs7C,QAAQntC,GACN,OAAO/a,KAAKmG,QAAQgX,OAAOpC,EAC7B,CAEAktC,SAAS5nD,GAEP,OADAA,EAAOA,EAAK2Y,QAAQ,MAAO,KACpBhZ,KAAKynD,QACTv5C,KAAK7N,EAAK2Y,QAAQ,SAAU,SAC5ByD,OAAM,IAAMzc,KAAKynD,QAAQv5C,KAAK7N,EAAK2Y,QAAQ,SAAU,WACrDyD,OAAM,IAAMzc,KAAKynD,QAAQv5C,KAAK7N,EAAK2Y,QAAQ,SAAU,WACrDyD,OAAM,IAAMzc,KAAKynD,QAAQv5C,KAAK7N,IACnC,E,kCClEF,sTAGY8nD,EAHZ,kBAGA,SAAYA,GACV,wBACA,2BACA,+BACA,yBACA,mBACA,wBACD,CAPD,CAAYA,MAAQ,KAWb,MAAMC,EAAWD,EAASxW,SACpB0W,EAASF,EAASG,OAUzBC,EAA8B,CAClC,CAAEpnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,KACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,IACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,GAAKC,YAAa,IACxC,CAAEtnD,MAAO,EAAGqnD,SAAU,GAAKC,YAAa,KAEpCC,EAAiD,CACrD,CAAEvnD,MAAO,EAAGqnD,SAAU,KAAOC,YAAa,MAC1C,CAAEtnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,KACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,IACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,GAAKC,YAAa,KAEpCE,EAAiD,CACrD,CAAExnD,MAAO,EAAGqnD,SAAU,KAAOC,YAAa,MAC1C,CAAEtnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,KACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,IACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,GAAKC,YAAa,KAEpCG,EAAiD,CACrD,CAAEznD,MAAO,EAAGqnD,SAAU,KAAOC,YAAa,MAC1C,CAAEtnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,KACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,IACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,GAAKC,YAAa,KAEpCI,EAAyC,CAC7C,CAAE1nD,MAAO,EAAGqnD,SAAU,KAAOC,YAAa,MAC1C,CAAEtnD,MAAO,EAAGqnD,SAAU,GAAKC,YAAa,KACxC,CAAEtnD,MAAO,EAAGqnD,SAAU,IAAMC,YAAa,IACzC,CAAEtnD,MAAO,EAAGqnD,SAAU,GAAKC,YAAa,KAQ1C,MAAMK,EACJlpD,YAAoBmpD,GAAA,KAAAA,WAAuB,CAC3CC,aAAapY,EAA0BqY,GACrC,OAAOjpD,KAAK+oD,SACd,EAGF,MAAMG,EACJF,aAAapY,EAA0BuY,GACrC,OAAKA,GAAYA,EAAW,IACnBN,EAEAN,CAEX,EAGF,MAAMa,EAAe,IAAIN,EAAoBP,GAEtC,SAASc,EACd14C,GACA,SAAEywB,GAAW,IAEb,MAAM5pB,EAAO7G,EAAU6a,SACjB89B,EAAS9xC,EAAKlD,YAAc,EAClC,OAAI8sB,EACK,IAAI8nB,EAETI,EACKF,EAEU,IAAf5xC,EAAKjD,OAA8B,IAAfiD,EAAKjD,MACpB,IAAIu0C,EAAoBD,GAEd,IAAfrxC,EAAKjD,MACA,IAAIu0C,EAAoBF,GAEd,IAAfpxC,EAAKjD,MACA,IAAIu0C,EAAoBH,GAEd,IAAfnxC,EAAKjD,MACA,IAAIu0C,EAAoBJ,GAE1BU,CACT,CAYO,SAASG,EAAch6C,GAC5B,OAAO,SACL+hC,EACA6X,EACAK,EAAgBJ,GAEhB,MAAML,EAAYS,EAAMR,aAAa1X,EAAU6X,GACzC7hD,EAAQ9B,KAAK+S,IAAI+4B,EAAW6X,GAClC,IAAK,IAAInnD,EAAI,EAAGA,EAAI+mD,EAAUnmD,OAAQZ,IACpC,GAAIsF,EAAQiI,EAAEw5C,EAAU/mD,IAAK,OAAO+mD,EAAU/mD,GAAGb,MAEnD,OAAOmwC,EAAW6X,EAAWf,EAAWC,CAC1C,CACF,CAEO,MAAMoB,EAAYF,GAAeziD,GAAMA,EAAE0hD,WACnCkB,EAAeH,GAAeziD,GAAMA,EAAE2hD,cAE5C,SAASD,EAAStlB,EAAoBsmB,EAAQJ,GACnD,OAAO,IAAE/D,KAAKmE,EAAMR,aAAa,KAAM,MAAO,CAAE7nD,MAAO+hC,IAAaslB,QACtE,CAEO,SAASmB,EAAMzmB,GACpB,OAAOA,GAAY,CACrB,CAEO,SAAS0mB,EAAY1mB,GAC1B,OAAOA,IAAamlB,GAAUsB,EAAMzmB,EACtC,CAGO,SAAS2mB,EAAO3mB,GACrB,OAAiB,IAAbA,EAAuB,IACV,IAAbA,EAAuB,GACV,IAAbA,EAAuB,GACpB,CACT,C,kCCzJA,4HAEA,MAAMhQ,EAAQ3jB,GAAOxP,GAAmC,OAAtBA,EAASA,SAAoBwP,EAAExP,GAAY,GAGhE+pD,EAAkB52B,GAC5BnzB,GAAa,IAAMA,EAASyQ,SAAW,MAAQ,IAAMzQ,EAASkW,SAIpD8zC,EAAuB72B,GACjCnzB,IAAeA,EAASyQ,QAAUzQ,EAASkW,MAAS,KAAK8C,QAAQ,GAAK,MAI5DixC,EAAkB92B,GAAMnzB,GAAaA,EAAS0T,MAAQ,I,sBCfnE,gCACA,IAAIw2C,EAAShhC,MAAMnnB,UAAUmB,MACzBinD,EAAQ,CACVr6C,SAAU,WACR,MAAO,OACT,EAGFq6C,QAAgB,UAEZC,GAAa,MAAOhlB,EAA4CA,EAASnlC,MAAM8D,MAC/EsmD,EAAM,WAAa,EAInBC,EAAS,SAAU14B,EAAGxI,GACxB,OAAOwI,CACT,EAII24B,EAAS,SAAU7wB,EAAS8wB,GAC9B,IAAKA,EACH,MAAM,IAAIJ,EAAU1wB,EAExB,EACI+wB,EAA6B,SAAU74B,GACzC,IAAU,MAALA,EAAYA,EAAE84B,mBAAgB,MAAkB,MAAL94B,EAAYA,EAAE+4B,iBAAc,GAC1E,MAAM,IAAIP,EAAU,kCAAoCx4B,EAE5D,EAYIg5B,EAAiB,SAAUp7C,GAC7B,OAAO+6C,EAAO,oBAAsB/6C,EAAG4Z,EAAEyhC,WAAWr7C,GACtD,EACI6nC,EAAUnuB,MAAMmuB,SAAW,SAAU9K,GACvC,OAAOA,aAAcrjB,KACvB,EACI4hC,EAAe,SAAUl5B,GAC3B,OAAOA,GAAKA,EAAE84B,aAChB,EAMIK,EAAoB,SAAUp0C,GAChC,OAAO4zC,EAAO,yBAA0C,IAAhB5zC,EAAK9T,OAC/C,EAOImoD,EAAS,SAAU9kC,GAErB,IADA,IAAIrjB,EAASwwB,UAAUxwB,OACdZ,EAAI,EAAG,EAAIY,EAASZ,EAAIY,EAASZ,EAAIY,EAAQ,EAAIA,EAASZ,IAAMA,IACvE,IAAK,IAAIkkB,KAAQkN,UAAUpxB,GACzBikB,EAAOC,GAAQkN,UAAUpxB,GAAGkkB,GAGhC,OAAOD,CACT,EAEI+kC,EAAU,SAAUC,EAAOC,GAC7B,IAAIC,EAAU,CAAG,EAAE5gC,eACf6gC,EAAO,WAAa,EAGxB,IAAK,IAAI/oD,KAFT+oD,EAAKtpD,UAAYopD,EAAOppD,UACxBmpD,EAAMnpD,UAAY,IAAIspD,EACNF,EACVC,EAAQ50C,KAAK20C,EAAQ7oD,KACvB4oD,EAAM5oD,GAAO6oD,EAAO7oD,IAGxB,OAAO4oD,CACT,EAEII,EAAS,SAAUhpD,GACrB,MAAsB,oBAAXooB,QAA0BA,OAAOpoB,GACnCooB,OAAOpoB,GACa,oBAAXooB,QAAmD,mBAAlBA,OAAY,IACtDA,OAAOpoB,GAAOooB,OAAY,IAAEpoB,GAE5B,KAAOA,CAElB,EAEI8mB,EAAI,CACNnf,QACMif,MAAMnnB,UAAUkI,QACX,SAAUsiC,EAAI3a,GACnB,OAAO2a,EAAGtiC,QAAQ2nB,EACpB,EAEO,SAAU2a,EAAI3a,GACnB,IAAK,IAAI3vB,EAAI,EAAMA,EAAIsqC,EAAG1pC,OAAQZ,IAEhC,GAAI2vB,IADA2a,EAAGtqC,GAEL,OAAOA,EAGX,OAAQ,CACV,EAGJspD,WAAY,SAAUhf,EAAI/8B,GACxB,IAAK,IAAIvN,EAAI,EAAMA,EAAIsqC,EAAG1pC,OAAQZ,IAEhC,GAAIuN,EADA+8B,EAAGtqC,IAEL,OAAOA,EAGX,OAAQ,CACV,EACA6hC,KAAM,SAAUyI,GACd,OAAOA,EAAG,EACZ,EACAif,OAAQ,SAAU55B,GAChB,OAAO,WACL,OAAOA,CACT,CACF,EACA65B,OAAQ,SAAUj8C,GAChB,OAAO,SAAUoiB,GACf,OAAQpiB,EAAEoiB,EACZ,CACF,EACA85B,MAAO,SAAUnf,GACf,OAAqB,IAAdA,EAAG1pC,MACZ,EACAkhC,KAAM,SAAUwI,GACd,OAAOA,EAAGrpC,MAAM,EAAGqpC,EAAG1pC,OACxB,EACA0sB,OAAQ,SAAU/f,EAAG+8B,GAEnB,IADA,IACgB3a,EADZ+5B,EAAW,GACN1pD,EAAI,EAAMA,EAAIsqC,EAAG1pC,OAAQZ,IAE5BuN,EADJoiB,EAAI2a,EAAGtqC,KAEL0pD,EAASppD,KAAKqvB,GAGlB,OAAO+5B,CACT,EACAhrD,IAAK,SAAU6O,EAAG+8B,GAChB,OAAO,WAEL,IADA,IACgB3a,EADZxnB,EAAS,GACJnI,EAAI,EAAMA,EAAIsqC,EAAG1pC,OAAQZ,IAChC2vB,EAAI2a,EAAGtqC,GACPmI,EAAO7H,KAAKiN,EAAEoiB,IAEhB,OAAOxnB,CACR,CAPM,EAQT,EACApI,KAAM,SAAUuqC,EAAI/8B,GAClB,IAAK,IAAIlN,KAAOiqC,EAAI,CAClB,GAAItrC,OAAOc,UAAUyoB,eAAehU,KAAK+1B,EAAIjqC,GAE3CkN,EAAElN,EADUiqC,EAAGjqC,GAGnB,CACF,EACAspD,QAAS,SAAUrf,GACjB,OAAO8K,EAAQ9K,GAAMA,EAAK,CAACA,EAC7B,EACAuW,SAAU,SAAUvW,EAAI3a,GACtB,OAA6B,IAAtBxI,EAAEnf,QAAQsiC,EAAI3a,EACvB,EACA/a,GAAI,SAAU+a,GACZ,OAAOA,CACT,EACAvoB,KAAM,SAAUkjC,GACd,OAAOA,EAAGA,EAAG1pC,OAAS,EACxB,EACAI,IAAK,SAAUspC,GAGb,IAFA,IAAI/8B,EAAI6jB,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmBjK,EAAEvS,GAAKwc,UAAU,GAEtEpxB,EAAI,EAAMA,EAAIsqC,EAAG1pC,OAAQZ,IAEhC,IAAKuN,EADD+8B,EAAGtqC,IAEL,OAAO,EAGX,OAAO,CACT,EACAkyB,IAAK,SAAUoY,GAGb,IAFA,IAAI/8B,EAAI6jB,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmBjK,EAAEvS,GAAKwc,UAAU,GAEtEpxB,EAAI,EAAMA,EAAIsqC,EAAG1pC,OAAQZ,IAEhC,GAAIuN,EADA+8B,EAAGtqC,IAEL,OAAO,EAGX,OAAO,CACT,EACA4pD,QAAS,SAAUj6B,EAAG2a,GACpB,OAAOnjB,EAAEmG,QAAO,SAAUkC,GACxB,OAAOA,IAAMG,CACf,GAAG2a,EACL,EACAuf,OAAQ,SAAUl6B,EAAG2a,GACnB,IAAItqC,EAAImnB,EAAEnf,QAAQsiC,EAAI3a,GACtB,GAAI3vB,GAAK,EACP,OAAOsqC,EAAG1oB,OAAO5hB,EAAG,EAExB,EACA8pD,KAAM,SAAUxf,EAAIyf,EAAMx8C,GACxB,IAAK,IAAIvN,EAAI,EAAMA,EAAIsqC,EAAG1pC,OAAQZ,IAEhC+pD,EAAOx8C,EAAEw8C,EADLzf,EAAGtqC,IAGT,OAAO+pD,CACT,EACA5jB,QAAS,SAAU54B,EAAG+8B,GACpB,OAAOnjB,EAAE2iC,KAAKxf,EAAI,IAAI,SAAU0f,EAAIr6B,GAClC,OAAOq6B,EAAGt8C,OAAOH,EAAEoiB,GACrB,GACF,EACAs6B,OAAQ,SAAU18C,GAChB,IAAIpO,EAAQ+qD,EACZ,OAAO,WAKL,OAJI,MAAO/qD,EAA0CA,EAAMgrD,aAAUn2C,KACnE7U,EAAQoO,IACRA,OAAIyG,GAEC7U,CACT,CACF,EACAikB,KAAM,SAAUlB,EAAIkoC,GAClB,OAAO,WACL,OAAOloC,EAAGiP,MAAMi5B,EAAIh5B,UACtB,CACF,EACAw3B,WAAY,SAAUr7C,GACpB,MAAoB,mBAANA,CAChB,EACAM,SAAU,SAAUkP,GAClB,IAAe1c,EAAKlB,EAChBgqD,EAAU,CAAG,EAAE5gC,eACnB,IAEE,OADA8hC,IACW,MAAPttC,EACK,YACEoK,EAAEyhC,WAAW7rC,GACf,WACEq4B,EAAQr4B,GACbstC,EAAiB,EACZ,OAEF,IAAMljC,EAAEzoB,IAAIyoB,EAAEtZ,SAAUkP,GAAKlP,WAAa,IACC,OAAjC,MAAPkP,EAAcA,EAAIlP,cAAW,IAAmBkP,EAAIlP,WAAa7O,OAAOc,UAAU+N,SACrFkP,EAAIlP,WACa,iBAARkP,EACZstC,EAAiB,EACZ,OAkBF,IAhBK,WACV,IAAIhzC,EAAU,GACd,IAAKhX,KAAO0c,EACLosC,EAAQ50C,KAAKwI,EAAK1c,KACvBlB,EAAQ,WACN,IAAI0C,EACJ,IACE,OAAOkb,EAAI1c,EAGb,CAFE,MAAOwB,GACP,OAAOA,CACT,CACD,CAPO,GAQRwV,EAAQ/W,KAAK6mB,EAAEtZ,SAASxN,GAAO,IAAM8mB,EAAEtZ,SAAS1O,KAElD,OAAOkY,CACR,CAfW,GAgBa,IAElB0F,CAIX,CAFE,QACAstC,GACF,CACF,GAGEA,EAAiB,EAErBnC,EAAM/gC,EAAIA,EAEV,IAAImjC,EAAgBpC,EAAMoC,cAAgB,WACxC,IAAIC,EACAC,EAAY,GACZC,EAAU,CAAC,EACXC,EAAc,GACdC,EAAoB,EACpBC,EAAU,CAAC,EAEf,SAASC,EAAkB9qC,GACrBA,GAAK4qC,IACJD,EAAY3qC,EAAI,KACnB2qC,EAAY3qC,EAAI,GAAK,CAAC,GAAI,IAE5B4qC,EAAoB5qC,EACtB,CAEA,IAAI+qC,EAAmB,SAAUC,EAAKx9C,GACpC,IAAIg9C,IAAaG,EAAY9pD,OAezB,OAAO2M,IAdTs9C,EAAkB,GAElB,IADA,IAAIG,EAAuB,EACpBA,EAAuBL,EAAoB,IAC5CM,EAAYF,EAAKL,EAAYM,GAAsB,KAGvDA,IAEkBN,EAAYM,GAAsB,GACxC1qD,KAAK,CAACyqD,EAAKx9C,IACpBg9C,GACHW,GAKN,EAEA,SAASD,EAAYF,EAAKI,GACxB,IAAK,IAAInrD,EAAI,EAAGA,EAAImrD,EAAWvqD,OAAQZ,IACrC,GAAImrD,EAAWnrD,GAAG,GAAG4U,IAAMm2C,EAAIn2C,GAAI,OAAO,EAE5C,OAAO,CACT,CAEA,SAASs2C,IACP,IAAIE,EAAmBT,EACvB,GAAKS,EACL,KAAOT,GAAqBS,GAAkB,CAC5C,IAAIC,EAAaX,EAAYC,EAAoB,GACjD,IAAKU,EAAY,MAAM,IAAIvpD,EAAM,yBAA2BupD,GAC5D,IAAIC,EAAYD,EAAW,GACvBn+B,EAAQm+B,EAAW,GAEvB,KAAIn+B,EAAQo+B,EAAU1qD,QAoBf,CACHyqD,EAAW,GAAK,GAChBA,EAAW,GAAK,EAChB,KACF,CAvBA,IAAIE,EAAmBD,EAAUp+B,GAE7Bs+B,GADMD,EAAiB,GACfA,EAAiB,IAE7BF,EAAW,KACXR,EAAkBF,EAAoB,GACtC,IAAIc,GAAc,EAClB,IAGE,IAFAD,IACAC,GAAc,EACPd,EAAoBS,GAAoE,GAAhDV,EAAYC,EAAoB,GAAG,GAAG/pD,QACnF+pD,GAOJ,CALE,QACKc,IACHf,EAAc,GACdC,EAAoB,EAExB,CAMJ,CACF,CAEA,IAqBIe,EAAe,SAAUx+B,EAAOzf,GAClC,IAAIs9C,EAAMP,EAAUt9B,GAChBy+B,EAAQZ,EAAIn2C,GACZg3C,EAAanB,EAAQkB,GACzBnB,EAAU5oC,OAAOsL,EAAO,UACjBu9B,EAAQkB,GACXl+C,GAAQ+8C,EAAU5pD,OAAS,GAC7BirD,EAAYd,GAEd,IAAK,IAAI/qD,EAAI,EAAMA,EAAI4rD,EAAWhrD,OAAQZ,KACxCuN,EAAIq+C,EAAW5rD,KAGnB,EAEI6rD,EAAc,SAAUd,GAC1B,IAAIH,EAAQG,EAAIn2C,IAAhB,CAEA,IADA,IACgBk3C,EADZr+C,EAAOs9C,EAAIgB,eACN/rD,EAAI,EAAQA,EAAIyN,EAAK7M,OAAQZ,IAGpC,GAFA8rD,EAAMr+C,EAAKzN,GACX6rD,EAAYC,GACRrB,EAAQqB,EAAIl3C,IAAK,CACnB,IAAIsY,EAAQ/F,EAAEnf,QAAQwiD,EAAWsB,GACjCJ,EAAax+B,GAAO,EACtB,CAEF09B,EAAQG,EAAIn2C,KAAM,CAVS,CAW7B,EAsDA,MAAO,CAAEo3C,aAtGU,SAAUjB,EAAKx9C,GAChC,GAAIg9C,EAAW,CACb,IAAIqB,EAAanB,EAAQM,EAAIn2C,IAC7B,OAAK,MAAQg3C,GACXA,EAAanB,EAAQM,EAAIn2C,IAAM,CAACrH,GACzBi9C,EAAUlqD,KAAKyqD,IAEfa,EAAWtrD,KAAKiN,EAE3B,CACE,OAAOA,GAEX,EA0FqC0+C,WAJpB,WACf,OAAOzB,EAAU5pD,OAAS,CAC5B,EAE6DsrD,cApDzC,SAAUp+B,EAAOlpB,EAAS2I,EAAGmH,GAC/C,GAAI61C,EACF,OAAOh9C,EAAE4jB,MAAMvsB,EAAS8P,GAExB61C,EAAYz8B,EACZ,IACE,IAAI3lB,EAASoF,EAAE4jB,MAAMvsB,EAAS8P,IA1CxB,WACV,KAAO81C,EAAU5pD,OAAS,GACxB8qD,EAAa,GAAG,GAElBd,EAAU,CAAC,CACb,CAuCMuB,EAIF,CAHE,QACA5B,OAAYv2C,EACZk3C,GACF,CACA,OAAO/iD,CAEX,EAqC2FikD,eAnCtE,WACnB,OAAO7B,EAAYA,EAAU31C,QAAKZ,CACpC,EAiC2Hq4C,iBA/BpG,SAAUtB,EAAKtlB,GACpC,IAAI6mB,GAAS,EACTC,GAAc,EACdC,EAAU,WAEZ,OADAD,GAAc,CAEhB,EACIE,EAAQ,WAEV,OADAH,GAAS,EACFE,GACT,EAcA,OAbAA,EAAUzB,EAAI2B,WAAWC,WAAU,SAAU7+B,GAC3C,OAAOg9B,EAAiBC,GAAK,WAC3B,IAAKuB,GACS7mB,EAAK3X,KACHo6B,EAAM0E,OAClB,OAAOH,GAGb,GACF,IACIF,GACFC,IAEKC,CACT,EAM+J3B,iBAAkBA,EAClL,CAvLyC,GAyL1C,SAAS+B,EAAO9B,EAAK+B,GACnB,IAAIC,IAAO37B,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,KAA2BA,UAAU,GAEnFpzB,KAAK+sD,IAAMA,EACX/sD,KAAK8uD,KAAOA,EACZ9uD,KAAK+uD,KAAOA,EACZ/uD,KAAKgvD,MAAQ,EACf,CAmCA,SAASC,IACPJ,EAAO17B,MAAMnzB,KAAMozB,UACrB,CAmBA,SAAS87B,EAAgBnC,GACvB8B,EAAOt4C,KAAKvW,KAAM+sD,GAAK,EACzB,CAuCA,SAASoC,EAAKvoD,EAASwoD,EAAQ14C,GAC7B1W,KAAK4G,QAAUA,EACf5G,KAAKovD,OAASA,EACdpvD,KAAK0W,KAAOA,CACd,CAnGAq0C,EAAO8D,EAAO/sD,UAAW,CACvButD,WAAW,EAEXV,UAAW,SAAUlnB,GACnB,OAAOznC,KAAK+sD,IAAI2B,WAAWC,UAAUlnB,EACvC,EACA53B,SAAU,WACR,OAAO7P,KAAK+sD,IAAIl9C,UAClB,EACAy/C,UAAW,WAET,OADAtvD,KAAKuvD,OAAQ,GACN,CACT,EACAC,QAAS,WACP,OAAIxvD,KAAK+uD,KACA,CAAE5tD,MAAOgoB,EAAEoiC,OAAOvrD,KAAKgvD,MAAM,KAE7BhvD,KAAKgvD,MAAM,EAEtB,EACA1sD,KAAM,SAAUqvB,GAEd,OADA3xB,KAAKgvD,MAAQ,CAACr9B,GACP,CAACA,EACV,EACA89B,QAAS,WACP,OAAO,CACT,EACAC,WAAY,WACV,OAAO1vD,KAAKgvD,MAAMpsD,MACpB,EACA+sD,SAAS,IAOX3E,EAAQiE,EAAiBJ,GACzB9D,EAAOkE,EAAgBntD,UAAW,CAChC0tD,QAAS,WACP,OAAOxvD,KAAKgvD,MAAMxnD,OACpB,EACAlF,KAAM,SAAUqvB,GACd,OAAO3xB,KAAKgvD,MAAM1sD,KAAKqvB,EACzB,EACA89B,QAAS,SAAU/uB,GACjB,OAAQ1gC,KAAKuvD,OAASvvD,KAAKgvD,MAAMpsD,QAAU89B,CAC7C,EACAgvB,WAAY,SAAUhvB,GACpB,OAAO1gC,KAAKgvD,MAAMpsD,QAAU89B,CAC9B,EACAivB,SAAS,IAOX3E,EAAQkE,EAAiBL,GACzB9D,EAAOmE,EAAgBptD,UAAW,CAChC0tD,QAAS,WACP,IAAIzlD,EAAS/J,KAAKgvD,MAElB,OADAhvD,KAAKgvD,MAAQ,GACN,CACL7tD,MAAO,WACL,OAAO4I,CACT,EAEJ,EACAzH,KAAM,SAAUqvB,GACd,OAAO3xB,KAAKgvD,MAAM1sD,KAAKqvB,EAAExwB,QAC3B,EACAuuD,WAAY,WACV,OAAO,CACT,IAGFb,EAAOe,UAAY,SAAU32C,GAC3B,OAAS,MAALA,EAAYA,EAAEo2C,eAAY,GACrBp2C,EAAE61C,KAEG,MAAL71C,EAAYA,EAAE42C,oBAAiB,CAE1C,EAEAhB,EAAOiB,eAAiB,SAAU72C,GAChC,OAAS,MAALA,EAAYA,EAAEo2C,eAAY,GACrBp2C,GACO,MAALA,EAAYA,EAAEyxC,iBAAc,GAC9B,IAAImE,EAAO51C,GAAG,GAEd,IAAIg2C,EAAgBh2C,GAAG,EAElC,EAQA8xC,EAAOoE,EAAKrtD,UAAW,CACrBiuD,SAAS,EACTtgD,KAAM,WAIJ,OAHKzP,KAAKisD,SACRjsD,KAAKisD,OAAS+D,EAAS,CAAChwD,KAAK4G,SAAS8I,OAAO1P,KAAK0W,QAE7C1W,KAAKisD,MACd,EACAp8C,SAAU,WACR,OAAOsZ,EAAEtZ,SAAS7P,KAAK4G,SAAW,IAAMuiB,EAAEtZ,SAAS7P,KAAKovD,QAAU,IAAMjmC,EAAEzoB,IAAIyoB,EAAEtZ,SAAU7P,KAAK0W,MAAQ,GACzG,IAGF,IAAIu5C,EAAW,SAAUrpD,EAASwoD,GAChC,IAAI36C,EAAM7N,GAAWwoD,EACrB,GAAI36C,GAAOA,EAAIs7C,QACb,OAAOnpD,GAAWwoD,EAElB,IAAK,IAAIc,EAAO98B,UAAUxwB,OAAQ8T,EAAOuS,MAAMinC,EAAO,EAAIA,EAAO,EAAI,GAAIC,EAAO,EAAGA,EAAOD,EAAMC,IAC9Fz5C,EAAKy5C,EAAO,GAAK/8B,UAAU+8B,GAG7B,OAAO,IAAIhB,EAAKvoD,EAASwoD,EAAQ14C,EAErC,EAEI05C,EAAW,SAAUpmC,EAAM+iC,GAE7B,OADAA,EAAI/iC,KAAOA,EACJ+iC,CACT,EAEIiD,EAAW,SAAUr+B,GACvB,OAAIylB,EAAQzlB,GACHxI,EAAEgf,QAAQ6nB,EAAUr+B,GAClBk5B,EAAal5B,GACf,CAACA,IACC,MAAOA,EAAkCA,EAAE09B,eAAYr5C,GACzD,CAAC2b,EAAEo7B,KAEH,EAEX,EAEA7C,EAAMiF,KAAOA,EACbjF,EAAMiF,KAAK1D,MAAQ,IAAIvB,EAAMiF,KAAK,GAAI,GAAI,IAE1C,IAAIkB,EAAwB,SAAUC,GACpC,OAAO,SAAU/gD,GACf,IAAK,IAAIghD,EAAQn9B,UAAUxwB,OAAQ8T,EAAOuS,MAAMsnC,EAAQ,EAAIA,EAAQ,EAAI,GAAIC,EAAQ,EAAGA,EAAQD,EAAOC,IACpG95C,EAAK85C,EAAQ,GAAKp9B,UAAUo9B,GAG9B,GAAiB,iBAANjhD,GAAkBmH,EAAK9T,OAAQ,CACxC,IAAIgE,EAAU2I,EACVkhD,EAAa/5C,EAAK,GACtBnH,EAAI,WACF,OAAO3I,EAAQ6pD,GAAYt9B,MAAMvsB,EAASwsB,UAC5C,EACA1c,EAAOA,EAAKzT,MAAM,EACpB,CACA,OAAOqtD,EAAQn9B,WAAMnd,EAAW,CAACzG,GAAGG,OAAOgH,GAC7C,CACF,EAEIg6C,EAAmB,SAAUh6C,GAE/B,OADAA,EAAOuS,MAAMnnB,UAAUmB,MAAMsT,KAAKG,GAC3Bi6C,EAAcx9B,WAAMnd,EAAWU,EACxC,EAEIk6C,EAAmB,SAAUrhD,EAAGshD,GAClC,OAAO,WACL,IAAK,IAAIC,EAAQ19B,UAAUxwB,OAAQ8T,EAAOuS,MAAM6nC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IAChFr6C,EAAKq6C,GAAS39B,UAAU29B,GAG1B,OAAOxhD,EAAE4jB,WAAMnd,EAAW66C,EAAQnhD,OAAOgH,GAC3C,CACF,EAmBIs6C,EAAmB,SAAUzhD,EAAGmH,GAClC,IAAIiD,EAAQpK,EAAEtM,MAAM,GAAGxC,MAAM,KACzBwwD,EAAY9nC,EAAEzoB,IAnBI,SAAUgW,GAChC,OAAO,SAAUrU,GACf,OAAO,SAAUlB,GACf,GAAK,MAAQA,EAAb,CAGE,IAAI+vD,EAAa/vD,EAAMkB,GACvB,OAAI8mB,EAAEyhC,WAAWsG,GACRA,EAAW/9B,MAAMhyB,EAAOuV,GAExBw6C,CAEX,CACF,CACF,CACF,CAIwBC,CAAkBz6C,GAAOiD,GAC/C,OAAO,SAAUxY,GACf,IAAK,IAAIa,EAAI,EAAMA,EAAIivD,EAAUruD,OAAQZ,IAEvCb,GADAoO,EAAI0hD,EAAUjvD,IACJb,GAEZ,OAAOA,CACT,CACF,EAEIiwD,EAAa,SAAU7hD,GACzB,MAAoB,iBAANA,GAAkBA,EAAE3M,OAAS,GAAqB,MAAhB2M,EAAE+S,OAAO,EAC3D,EAEIquC,EAAgBN,GAAsB,SAAU9gD,GAClD,IAAK,IAAI8hD,EAAQj+B,UAAUxwB,OAAQ8T,EAAOuS,MAAMooC,EAAQ,EAAIA,EAAQ,EAAI,GAAIC,EAAQ,EAAGA,EAAQD,EAAOC,IACpG56C,EAAK46C,EAAQ,GAAKl+B,UAAUk+B,GAG9B,OAAInoC,EAAEyhC,WAAWr7C,GACXmH,EAAK9T,OACAguD,EAAiBrhD,EAAGmH,GAEpBnH,EAEA6hD,EAAW7hD,GACbyhD,EAAiBzhD,EAAGmH,GAEpByS,EAAEoiC,OAAOh8C,EAEpB,IAEIgiD,EAAe,SAAUhiD,EAAGmH,GAC9B,OAAOi6C,EAAcx9B,WAAMnd,EAAW,CAACzG,GAAGG,OAAOgH,GACnD,EAEI86C,EAAwB,SAAUzE,EAAKx9C,EAAGmH,EAAM04C,GAClD,GAAI,MAAO7/C,EAAkCA,EAAEm7C,iBAAc10C,EAAW,CACtE,IAAIy7C,EAAUliD,EAAEmiD,UAAU3E,GAAK,SAAUjrC,EAAG7I,GAC1C,MAAO,CAAC6I,EAAG7I,EACb,IACA,OAAOm2C,EAAO74C,KAAKk7C,GAAS,SAAUE,GACpC,IAAI7vC,EAAI6vC,EAAK,GACLA,EAAK,GACb,OAAO7vC,CACT,IAAGphB,KAAI,SAAUkxD,GACPA,EAAM,GAEd,OADQA,EAAM,EAEhB,GACF,CAEE,OADAriD,EAAIgiD,EAAahiD,EAAGmH,GACb04C,EAAO74C,KAAKw2C,EAAKx9C,EAE5B,EAEIsiD,EAAe,SAAUtiD,GAC3B,GAAI4Z,EAAEyhC,WAAWr7C,GACf,OAAOA,EACF,GAAI6hD,EAAW7hD,GAAI,CACxB,IAAIlN,EAAMyvD,EAAWviD,GACrB,OAAO,SAAUwiD,EAAMC,GACrB,OAAOD,EAAK1vD,GAAK2vD,EACnB,CACF,CACE,MAAM,IAAI7H,EAAU,kCAAoC56C,EAE5D,EAEIuiD,EAAa,SAAUviD,GACzB,OAAOA,EAAEtM,MAAM,EACjB,EAEA,SAASgvD,EAAK9wD,GACZnB,KAAKmB,MAAQA,CACf,CAEA4pD,EAAOkH,EAAKnwD,UAAW,CACrBowD,SAAS,EACTC,UAAW,WACT,OAAOnyD,KAAKmB,KACd,EACAc,IAAK,WACH,OAAOjC,KAAKmB,KACd,EACAmuB,OAAQ,SAAU/f,GAChB,OAAIA,EAAEvP,KAAKmB,OACF,IAAI8wD,EAAKjyD,KAAKmB,OAEd+qD,CAEX,EACAxrD,IAAK,SAAU6O,GACb,OAAO,IAAI0iD,EAAK1iD,EAAEvP,KAAKmB,OACzB,EACAgjB,QAAS,SAAU5U,GACjB,OAAOA,EAAEvP,KAAKmB,MAChB,EACAixD,WAAW,EACXzG,QAAS,WACP,MAAO,CAAC3rD,KAAKmB,MACf,EACAkxD,QAAS,WACP,MAAO,QAAUryD,KAAKmB,MAAQ,GAChC,EACA0O,SAAU,WACR,OAAO7P,KAAKqyD,SACd,IAGF,IAAInG,EAAO,CACTC,SAAS,EACTgG,UAAW,SAAUhxD,GACnB,OAAOA,CACT,EACAmuB,OAAQ,WACN,OAAO48B,CACT,EACAxrD,IAAK,WACH,OAAOwrD,CACT,EACA/nC,QAAS,WAAa,EACtBiuC,WAAW,EACXzG,QAAS,WACP,MAAO,EACT,EACA0G,QAAS,WACP,MAAO,MACT,EACAxiD,SAAU,WACR,OAAO7P,KAAKqyD,SACd,GAGEC,EAAW,SAAUxvC,GACvB,OAAK,MAAOA,EAAkCA,EAAEovC,aAAUl8C,KAAe,MAAO8M,EAAkCA,EAAEqpC,aAAUn2C,GACrH8M,EAEA,IAAImvC,EAAKnvC,EAEpB,EAEAonC,EAAM0E,OAAS,YACf1E,EAAMqI,KAAO,SAEb,IAAIC,EAAiB,EAErB,SAASC,IACPzyD,KAAK4W,KAAO47C,CACd,CA+BA,SAAS7qB,EAAK+qB,EAAQC,GACpB,KAAM3yD,gBAAgB2nC,GACpB,OAAO,IAAIA,EAAK+qB,EAAQC,GAG1BF,EAAMl8C,KAAKvW,OAEN2yD,GAASxpC,EAAEyhC,WAAW8H,KAAsB,MAAVA,EAAiBA,EAAOE,aAAU,IACvE5yD,KAAK0yD,OAASA,EACd1yD,KAAK6yD,mBAAgB,IAErB7yD,KAAK0yD,YAAS,EACd1yD,KAAK6yD,cAAgBH,EAEzB,CAmDA,SAASI,EAAQJ,EAAQC,GACvB,KAAM3yD,gBAAgB8yD,GACpB,OAAO,IAAIA,EAAQJ,EAAQC,GAE7BhrB,EAAKpxB,KAAKvW,KAAM0yD,EAAQC,EAC1B,CAiBA,SAASI,IACP,KAAM/yD,gBAAgB+yD,GACpB,OAAO,IAAIA,EAEbN,EAAMl8C,KAAKvW,KACb,CAgBA,SAAS8D,EAAMD,GACb,KAAM7D,gBAAgB8D,GACpB,OAAO,IAAIA,EAAMD,GAEnB7D,KAAK6D,MAAQA,EACb4uD,EAAMl8C,KAAKvW,KACb,CA/IAyyD,EAAM3wD,UAAUkxD,UAAW,EAC3BP,EAAM3wD,UAAUmxD,QAAU,WACxB,OAAO,CACT,EACAR,EAAM3wD,UAAUoxD,MAAQ,WACtB,OAAO,CACT,EACAT,EAAM3wD,UAAUqxD,UAAY,WAC1B,OAAO,CACT,EACAV,EAAM3wD,UAAUsxD,OAAS,WACvB,OAAO,CACT,EACAX,EAAM3wD,UAAUuxD,QAAU,WACxB,OAAO,CACT,EACAZ,EAAM3wD,UAAUwxD,SAAW,WACzB,OAAO,CACT,EACAb,EAAM3wD,UAAUwtB,OAAS,WACvB,OAAO,CACT,EACAmjC,EAAM3wD,UAAUuwD,QAAU,WACxB,OAAOryD,KAAK6P,UACd,EACA4iD,EAAM3wD,UAAUkiB,IAAM,WACpB,OAAOhkB,KAAK6P,UACd,EAkBAm7C,EAAQrjB,EAAM8qB,GAEd9qB,EAAK7lC,UAAUsxD,OAAS,WACtB,OAAO,CACT,EACAzrB,EAAK7lC,UAAUwxD,SAAW,WACxB,OAAO,CACT,EACA3rB,EAAK7lC,UAAUX,MAAQ,WACrB,IAAIsT,EAQJ,OAP2B,OAAtBA,EAAMzU,KAAK0yD,QAAkBj+C,EAAIm+C,aAAU,IAC9C5yD,KAAK6yD,cAAgB7yD,KAAK0yD,OAAOvxD,QACjCnB,KAAK0yD,YAAS,GACL1yD,KAAK0yD,SACd1yD,KAAK6yD,cAAgB7yD,KAAK0yD,SAC1B1yD,KAAK0yD,YAAS,GAET1yD,KAAK6yD,aACd,EAEAlrB,EAAK7lC,UAAUyxD,KAAO,SAAUhkD,GAC9B,IAAIugB,EAAO3uB,EACX,OAAInB,KAAK6yD,eACP1xD,EAAQnB,KAAK6yD,cACN7yD,KAAKmzB,OAAM,WAChB,OAAO5jB,EAAEpO,EACX,MAEA2uB,EAAQ9vB,KACDA,KAAKmzB,OAAM,WAChB,OAAO5jB,EAAEugB,EAAM3uB,QACjB,IAEJ,EAEAwmC,EAAK7lC,UAAUqxB,MAAQ,SAAUhyB,GAC/B,OAAO,IAAIwmC,EAAKxmC,EAClB,EACAwmC,EAAK7lC,UAAUwtB,OAAS,SAAU/f,GAChC,OAAOA,EAAEvP,KAAKmB,QAChB,EACAwmC,EAAK7lC,UAAU+N,SAAW,WACxB,OAAOsZ,EAAEtZ,SAAS7P,KAAKmB,QACzB,EACAwmC,EAAK7lC,UAAUkiB,IAAM,WACnB,OAAOhkB,KAAKmB,OACd,EACAwmC,EAAK7lC,UAAU8wD,SAAU,EASzB5H,EAAQ8H,EAASnrB,GACjBmrB,EAAQhxD,UAAU0xD,YAAa,EAC/BV,EAAQhxD,UAAUqxD,UAAY,WAC5B,OAAO,CACT,EACAL,EAAQhxD,UAAUsxD,OAAS,WACzB,OAAO,CACT,EACAN,EAAQhxD,UAAUqxB,MAAQ,SAAUhyB,GAClC,OAAO,IAAI2xD,EAAQ3xD,EACrB,EACA2xD,EAAQhxD,UAAU2xD,OAAS,WACzB,OAAO,IAAI9rB,EAAK3nC,KAClB,EASAgrD,EAAQ+H,EAAKN,GACbM,EAAIjxD,UAAUoxD,MAAQ,WACpB,OAAO,CACT,EACAH,EAAIjxD,UAAUyxD,KAAO,WACnB,OAAOvzD,IACT,EACA+yD,EAAIjxD,UAAUqxB,MAAQ,WACpB,OAAOnzB,IACT,EACA+yD,EAAIjxD,UAAU+N,SAAW,WACvB,MAAO,OACT,EAUAm7C,EAAQlnD,EAAO2uD,GACf3uD,EAAMhC,UAAUuxD,QAAU,WACxB,OAAO,CACT,EACAvvD,EAAMhC,UAAUyxD,KAAO,WACrB,OAAOvzD,IACT,EACA8D,EAAMhC,UAAUqxB,MAAQ,WACtB,OAAOnzB,IACT,EACA8D,EAAMhC,UAAU+N,SAAW,WACzB,MAAO,WAAasZ,EAAEtZ,SAAS7P,KAAK6D,MACtC,EAEAqmD,EAAMuI,MAAQA,EACdvI,EAAM4I,QAAUA,EAChB5I,EAAMviB,KAAOA,EACbuiB,EAAM6I,IAAMA,EACZ7I,EAAMpmD,MAAQA,EAEd,IAAI4vD,EAAe,SAAUvyD,GAC3B,OAAO,IAAI2xD,EAAQ3xD,GAAO,EAC5B,EACIwyD,EAAY,SAAUxyD,GACxB,OAAO,IAAIwmC,EAAKxmC,GAAO,EACzB,EACIyyD,EAAW,WACb,OAAO,IAAIb,CACb,EACIc,EAAU,SAAUliC,GACtB,OAAIA,GAAKA,EAAEqhC,SACFrhC,EAEAgiC,EAAUhiC,EAErB,EAEImiC,EAAY,EACZC,EAAc,WAAa,EAE/B,SAASC,GAAWhqC,GAClBhqB,KAAKgqB,KAAOA,EACZhqB,KAAK4W,KAAOk9C,EACZ9zD,KAAKi0D,YAAcj0D,KAAKgqB,IAC1B,CA+EA,SAASkqC,KACP,IAAIC,EAAK/gC,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmB,GAAKA,UAAU,GAE9EpzB,KAAKo0D,YAAcjrC,EAAE/D,KAAKplB,KAAKo0D,YAAap0D,MAC5CA,KAAKq0D,cAAe,EACpBr0D,KAAKs0D,cAAgB,GACrBt0D,KAAKu0D,SAAW,GAChB,IAAK,IAAWt7C,EAAPjX,EAAI,EAAMA,EAAImyD,EAAGvxD,OAAQZ,IAChCiX,EAAIk7C,EAAGnyD,GACPhC,KAAKyC,IAAIwW,EAEb,CAmEA,SAASu7C,GAAWC,EAAYC,GAC9B10D,KAAKy0D,WAAaA,EAClBz0D,KAAK00D,aAAeA,EACpB10D,KAAK2uD,UAAYxlC,EAAE/D,KAAKplB,KAAK2uD,UAAW3uD,MACxCA,KAAK20D,YAAcxrC,EAAE/D,KAAKplB,KAAK20D,YAAa30D,MAC5CA,KAAK40D,SAAU,EACf50D,KAAKuvD,OAAQ,EACbvvD,KAAK60D,eAAY7+C,EACjBhW,KAAK80D,cAAW9+C,EAChBhW,KAAKs0D,cAAgB,GACrBt0D,KAAKgvD,MAAQ,EACf,CA2GA,SAAS+F,GAAY/qC,EAAM2kC,EAAWpwB,GACpC,KAAMv+B,gBAAgB+0D,IACpB,OAAO,IAAIA,GAAY/qC,EAAM2kC,EAAWpwB,GAEtCpV,EAAEyhC,WAAW5gC,KACfuU,EAAUowB,EACVA,EAAY3kC,EACZA,EAAOmlC,EAAK1D,OAEduI,GAAWz9C,KAAKvW,KAAMgqB,GACtB2gC,EAAegE,GACf3uD,KAAK0uD,WAAa,IAAI8F,GAAW7F,EAAWpwB,GAC5Cw1B,EAAY/zD,KACd,CA9RA+qD,EAAOiJ,GAAWlyD,UAAW,CAC3B2oD,eAAe,EAEfkE,UAAW,SAAUlnB,GACnB,OAAO6kB,EAAc+B,iBAAiBruD,KAAMynC,EAC9C,EAEAutB,kBAAmB,SAAUvtB,GAC3B,OAAOznC,KAAK0uD,WAAWC,UAAUlnB,EACnC,EAEA8B,QAAS,WACP,IAAIh6B,EAAImhD,EAAiBt9B,WACzB,OAAOpzB,KAAK2uD,WAAU,SAAU7+B,GAC9B,GAAIA,EAAMwjC,WACR,OAAO/jD,EAAEugB,EAAM3uB,QAEnB,GACF,EAEA8zD,SAAU,SAAU1lD,GAClB,OAAOvP,KAAKupC,SAAQ,SAAU7yB,GAC5B,OAAOnH,EAAE4jB,WAAMnd,EAAWU,EAC5B,GACF,EAEAzE,QAAS,WACP,IAAI1C,EAAImhD,EAAiBt9B,WACzB,OAAOpzB,KAAK2uD,WAAU,SAAU7+B,GAC9B,GAAIA,EAAMujC,UACR,OAAO9jD,EAAEugB,EAAMjsB,MAEnB,GACF,EAEAqxD,MAAO,WACL,IAAI3lD,EAAImhD,EAAiBt9B,WACzB,OAAOpzB,KAAK2uD,WAAU,SAAU7+B,GAC9B,GAAIA,EAAMojC,QACR,OAAO3jD,GAEX,GACF,EAEAlP,KAAM,SAAUA,GAEd,OADAL,KAAKukB,MAAQlkB,EACNL,IACT,EAEAm1D,gBAAiB,WAEf,OADAn1D,KAAKgqB,KAAOimC,EAAS98B,WAAMnd,EAAWod,WAC/BpzB,IACT,EAEA6P,SAAU,WACR,OAAI7P,KAAKukB,MACAvkB,KAAKukB,MAELvkB,KAAKgqB,KAAKna,UAErB,EAEAJ,KAAM,WACJ,OAAOzP,KAAKgqB,KAAKva,MACnB,EAEAs+C,aAAc,WACZ,OAAO/tD,KAAKi0D,YAAYxkD,MAC1B,IAGFukD,GAAWlyD,UAAUgtB,OAASklC,GAAWlyD,UAAUynC,QACnDyqB,GAAWlyD,UAAUqiB,QAAU6vC,GAAWlyD,UAAUynC,QACpDyqB,GAAWlyD,UAAUuwD,QAAU2B,GAAWlyD,UAAU+N,SAEpDq6C,EAAM8J,WAAaA,GAenBjJ,EAAOmJ,GAAqBpyD,UAAW,CACrCW,IAAK,SAAU2yD,GACb,IAAIC,EAASr1D,KAEb,IAAIA,KAAKq0D,aAAT,CAGA,IAAI9E,GAAQ,EACRd,EAAQrE,EACZpqD,KAAKu0D,SAASjyD,KAAK8yD,GAgBnB,OAPA3G,EAAQ2G,EAAap1D,KAAKo0D,aARZ,WACZ,IAAIiB,EAAOhB,aAKX,OAFA9E,GAAQ,EACR8F,EAAOxJ,OAAO4C,GACPtlC,EAAE0iC,OAAOuJ,EAAcC,EAAOd,SACvC,IAEMv0D,KAAKq0D,cAAgB9E,EAGzBd,IAFAzuD,KAAKs0D,cAAchyD,KAAKmsD,GAI1BtlC,EAAE0iC,OAAOuJ,EAAcp1D,KAAKu0D,UACrB9F,CAnBP,CAoBF,EAEA5C,OAAQ,SAAU4C,GAChB,IAAIzuD,KAAKq0D,aAGT,YAA4Cr+C,IAAxCmT,EAAE0iC,OAAO4C,EAAOzuD,KAAKs0D,eAChB7F,SADT,CAGF,EAEA2F,YAAa,WACX,IAAIp0D,KAAKq0D,aAAT,CAGAr0D,KAAKq0D,cAAe,EAEpB,IADA,IAAI7d,EAAWx2C,KAAKs0D,cACXtyD,EAAI,EAAGA,EAAIw0C,EAAS5zC,OAAQZ,IACnCw0C,EAASx0C,KAIX,OAFAhC,KAAKs0D,cAAgB,GACrBt0D,KAAKu0D,SAAW,GACT,EARP,CASF,EAEA1hC,MAAO,WACL,OAAI7yB,KAAKq0D,aACA,EAEFr0D,KAAKs0D,cAAc1xD,OAAS5C,KAAKu0D,SAAS3xD,MACnD,EAEA6oD,MAAO,WACL,OAAwB,IAAjBzrD,KAAK6yB,OACd,IAGFq3B,EAAMgK,qBAAuBA,GAe7BM,GAAW1yD,UAAUwzD,eAAiB,WACpC,OAAOt1D,KAAKs0D,cAAc1xD,OAAS,CACrC,EAEA4xD,GAAW1yD,UAAUyzD,UAAY,SAAUH,GAEzC,OADAp1D,KAAKs0D,cAAgBnrC,EAAEyiC,QAAQwJ,EAAcp1D,KAAKs0D,eAC3Ct0D,KAAKs0D,aACd,EAEAE,GAAW1yD,UAAUQ,KAAO,SAAUwtB,GAIpC,OAHIA,EAAMojC,UACRlzD,KAAKuvD,OAAQ,GAERjD,EAAc4B,cAAcp+B,EAAO9vB,KAAMA,KAAKw1D,OAAQ,CAAC1lC,GAChE,EAEA0kC,GAAW1yD,UAAU2zD,oBAAsB,SAAU3lC,GACnD,IAGE,IAFA,IAAI4lC,EAAM11D,KAAKs0D,cACXvmB,EAAM2nB,EAAI9yD,OACLZ,EAAI,EAAGA,EAAI+rC,EAAK/rC,IAAK,CAC5B,IAAI2zD,EAAMD,EAAI1zD,IACF2zD,EAAIluB,KAAK3X,KACPo6B,EAAM0E,QAAU9+B,EAAMojC,UAClClzD,KAAKu1D,UAAUI,EAEnB,CACA,OAAO,CAKT,CAJE,MAAO9xD,GAGP,MAFA7D,KAAK40D,SAAU,EACf50D,KAAKgvD,MAAQ,GACPnrD,CACR,CACF,EAEA2wD,GAAW1yD,UAAU0zD,OAAS,SAAU1lC,GACtC,GAAK9vB,KAAK40D,QAsBR,OADA50D,KAAKgvD,MAAM1sD,KAAKwtB,GACTo6B,EAAMqI,KArBb,GAAIziC,IAAU9vB,KAAK60D,UAAnB,CASA,IANI/kC,EAAMujC,YACRrzD,KAAK60D,UAAY/kC,GAEnB9vB,KAAK40D,SAAU,EACf50D,KAAKy1D,oBAAoB3lC,GACzB9vB,KAAK40D,SAAU,EACR50D,KAAKgvD,MAAMpsD,QAChBktB,EAAQ9vB,KAAKgvD,MAAMxnD,QACnBxH,KAAKsC,KAAKwtB,GAEZ,OAAI9vB,KAAKs1D,iBACApL,EAAMqI,MAEbvyD,KAAK41D,wBACE1L,EAAM0E,OAff,CAqBJ,EAEA4F,GAAW1yD,UAAU6yD,YAAc,SAAU7kC,GAC3C,OAAI9vB,KAAK00D,aACA10D,KAAK00D,aAAa5kC,GAElB9vB,KAAKsC,KAAKwtB,EAErB,EAEA0kC,GAAW1yD,UAAU8zD,sBAAwB,WACvC51D,KAAK80D,UACP90D,KAAK80D,WAEP90D,KAAK80D,cAAW9+C,CAClB,EAEAw+C,GAAW1yD,UAAU6sD,UAAY,SAAUlnB,GACzC,IAAI2tB,EAcgBjqC,EAbpB,OAAInrB,KAAKuvD,OACP9nB,EAAKmsB,KACExJ,IAEPO,EAAeljB,GACf2tB,EAAe,CACb3tB,KAAMA,GAERznC,KAAKs0D,cAAchyD,KAAK8yD,GACU,IAA9Bp1D,KAAKs0D,cAAc1xD,SACrB5C,KAAK80D,SAAW90D,KAAKy0D,WAAWz0D,KAAK20D,aACrChK,EAAe3qD,KAAK80D,WAEJ3pC,EAOfnrB,KANM,WAEL,GADAmrB,EAAMoqC,UAAUH,IACXjqC,EAAMmqC,iBACT,OAAOnqC,EAAMyqC,uBAEjB,EAGN,EAEA1L,EAAMsK,WAAaA,GAiBnBxJ,EAAQ+J,GAAaf,IACrBjJ,EAAOgK,GAAYjzD,UAAW,CAC5B+tD,gBAAgB,EAEhBgG,WAAY,SAAUC,GACpB,IAAIC,EAAiC,IAArB3iC,UAAUxwB,OAAespD,EAAOoG,GAAS,WACvD,OAAOwD,CACT,IACIE,EAAOh2D,KAAK0uD,WACZ1kC,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,aAAc,CAAC81D,IAC/C,OAAO,IAAIG,GAASjsC,GAAM,SAAUyd,GAClC,IAAIyuB,GAAW,EACXC,GAAS,EACT1H,EAAQrE,EACRgM,EAAQlM,EAAMqI,KACd8D,EAAW,WACb,IAAKH,EACH,OAAOH,EAAU5xC,SAAQ,SAAUhjB,GAGjC,GAFA+0D,GAAW,GACXE,EAAQ3uB,EAAK,IAAIqrB,EAAQ3xD,OACX+oD,EAAM0E,OAGlB,OAFAH,IACAA,EAAQrE,EACDA,CAEX,GAEJ,EA4BA,OA1BAqE,EAAQuH,EAAKrH,WAAU,SAAU7+B,GAC/B,OAAIA,EAAMwjC,WACJxjC,EAAMqjC,cAAgBgD,GACxBJ,EAAY,IAAI9D,GAAK,WACnB,OAAOniC,EAAM3uB,OACf,IACO+oD,EAAMqI,OAERziC,EAAMqjC,aACTkD,IAEFH,GAAW,EACXH,EAAY,IAAI9D,EAAKniC,GACd2X,EAAK3X,KAGVA,EAAMojC,UACRkD,EAAQC,KAEND,IAAUlM,EAAM0E,OACXnnB,EAAK3X,QADd,EAIJ,IACAqmC,GAAS,EACTE,IACO5H,CACT,GACF,EAEA6H,cAAe,WACb,OAAOt2D,IACT,EAEAu2D,YAAa,SAAUh4B,GACrB,OAAO,IAAIw2B,GAAY,IAAI7K,EAAMiF,KAAKnvD,KAAM,cAAe,CAACu+B,IAAWv+B,KAAK0uD,WAAWC,UAAWpwB,EACpG,IAGF2rB,EAAM6K,YAAcA,GAEpB7K,EAAMpiB,MAAQ,WACZ,OAAO,IAAIitB,GAAY9E,EAAS/F,EAAO,UAAU,SAAUziB,GAEzD,OADAA,EAAKmsB,KACExJ,CACT,GACF,EAEAF,EAAM3oD,KAAO,WACX,GAAyB,IAArB6xB,UAAUxwB,OACZ,OAAOsnD,EAAMpiB,QAEf,IAAIiG,EAAM3a,UAAUxwB,OAChB4zD,EAAQ,gEAEZlM,EAAOkM,EAAOzoB,EAAM,GAAM,GAK1B,IAJA,IAAI0oB,EAAU,GACVC,EAAO,GACP10D,EAAI,EACJ20D,EAAW,GACR30D,EAAI+rC,GAAK,CACd4oB,EAAS30D,GAAKoxB,UAAUpxB,GACxB20D,EAAS30D,EAAI,GAAKoxB,UAAUpxB,EAAI,GAKhC,IAJA,IAIgBiX,EAJZ29C,EAAaztC,EAAEwiC,QAAQv4B,UAAUpxB,IACjCuN,EAAIsnD,GAAmBzjC,UAAUpxB,EAAI,IACrC80D,EAAM,CAAEvnD,EAAGA,EAAGwnD,IAAK,IACnBC,GAAe,EACV11C,EAAI,EAAMA,EAAIs1C,EAAWh0D,OAAQ0e,IAAK,CAC7CrI,EAAI29C,EAAWt1C,GACf,IAAI4N,EAAQ/F,EAAEnf,QAAQysD,EAASx9C,GAC1B+9C,IACHA,EAAenI,EAAOe,UAAU32C,IAE9BiW,EAAQ,IACVunC,EAAQn0D,KAAK2W,GACbiW,EAAQunC,EAAQ7zD,OAAS,GAE3B,IAAK,IAAWq0D,EAAP11C,EAAI,EAAOA,EAAIu1C,EAAIC,IAAIn0D,OAAQ2e,KACtC01C,EAAKH,EAAIC,IAAIx1C,IACN2N,QAAUA,GACf+nC,EAAGpkC,QAGPikC,EAAIC,IAAIz0D,KAAK,CAAE4sB,MAAOA,EAAO2D,MAAO,GACtC,CAEAy3B,EAAO,oCAAqC0M,IAAiBJ,EAAWh0D,QAEpEg0D,EAAWh0D,OAAS,GACtB8zD,EAAKp0D,KAAKw0D,GAEZ90D,GAAQ,CACV,CAEA,IAAKy0D,EAAQ7zD,OACX,OAAOsnD,EAAMpiB,QAGf2uB,EAAUttC,EAAEzoB,IAAImuD,EAAOiB,eAAgB2G,GACvC,IAAIS,EAAe/tC,EAAE+K,IAAIuiC,GAAS,SAAUx9C,GAC1C,OAAOA,EAAE02C,OACX,KAAMwH,GAAsBhuC,EAAEzoB,KAAI,SAAUuY,GAC1C,OAAOA,EAAE8zC,GACX,GAAG0J,IAECzsC,EAAO,IAAIkgC,EAAMiF,KAAKjF,EAAO,OAAQyM,GACrCS,EAAe,IAAIrC,GAAY/qC,GAAM,SAAUyd,GACjD,IAAI4vB,EAAW,GACXC,GAAO,EACPl2D,EAAQ,SAAU0gB,GACpB,IAAK,IAAY9f,EAARu1D,EAAK,EAAMA,EAAKz1C,EAAEi1C,IAAIn0D,OAAQ20D,IAErC,GADAv1D,EAAI8f,EAAEi1C,IAAIQ,IACLd,EAAQz0D,EAAEktB,OAAOwgC,WAAW1tD,EAAE6wB,OACjC,OAAO,EAGX,OAAO,CACT,EACI2kC,EAAa,SAAUx8C,GACzB,OAAQA,EAAO8zC,MAAQ9zC,EAAOu0C,KAChC,EACIkI,EAAc,SAAU31C,GAC1B,IAAK,IAAY9f,EAARu1D,EAAK,EAAMA,EAAKz1C,EAAEi1C,IAAIn0D,OAAQ20D,IAErC,GADAv1D,EAAI8f,EAAEi1C,IAAIQ,IACLd,EAAQz0D,EAAEktB,OAAOugC,QAAQztD,EAAE6wB,OAC9B,OAAO,CAGb,EACI6kC,EAAe,SAAUC,GAC3B,OAAQA,EAAQ38C,OAAO20C,OACzB,EACIhvD,EAAO,SAAUqa,GACnB,OAAO,SAAU48C,GACf,IAAIC,EAAa,WACf,OAAOvL,EAAc0B,aAAaoJ,EAAcjJ,EAClD,EACI2J,EAAqB,WACvB,KAAIT,EAASz0D,OAAS,GAuCpB,OAAOsnD,EAAMqI,KApCb,IAFA,IAEiBzwC,EAFbs0C,EAAQlM,EAAMqI,KACdoF,EAAUN,EAAS/zC,MACdi0C,EAAK,EAAMA,EAAKb,EAAK9zD,OAAQ20D,IAEpC,GADAz1C,EAAI40C,EAAKa,GACLn2D,EAAM0gB,GAAI,CACZ,IAAIi2C,EAAS,WAEX,IADA,IACiB/1D,EADbmI,EAAS,GACJ6tD,EAAK,EAAMA,EAAKl2C,EAAEi1C,IAAIn0D,OAAQo1D,IACrCh2D,EAAI8f,EAAEi1C,IAAIiB,GACV7tD,EAAO7H,KAAKm0D,EAAQz0D,EAAEktB,OAAOsgC,WAE/B,OAAOrlD,CACR,CAPY,GAyBb,OAjBAisD,EAAQ3uB,EAAKkwB,EAAQ/qD,EAAEumB,OAAM,WAC3B,IAAI8kC,EAEAluD,EAAS,WAEX,IADA,IACiB+lB,EADb3lB,EAAS,GACJ6tD,EAAK,EAAUA,EAAKD,EAAOn1D,OAAQo1D,IAC1CloC,EAAQioC,EAAOC,GACf7tD,EAAO7H,KAAKwtB,EAAM3uB,SAEpB,OAAOgJ,CACR,CAPY,GASb,OAAQ8tD,EAAKn2C,GAAGvS,EAAE4jB,MAAM8kC,EAAIluD,EAC9B,KACIstD,EAASz0D,SACXy0D,EAAWluC,EAAEmG,OAAOooC,EAAcL,IAEhCjB,IAAUlM,EAAM0E,OACXwH,EAEA0B,GAEX,CAKN,EACI3J,EAAQ,WACV,IAAIiI,EAAQ0B,IAWZ,OAVIR,IACEnuC,EAAEnmB,IAAIyzD,EAASe,IAAeruC,EAAEnmB,IAAI0zD,EAAMe,MAC5CrB,EAAQlM,EAAM0E,OACdnnB,EAAKmsB,MAGLwC,IAAUlM,EAAM0E,QAClBgJ,IAGKxB,CACT,EACA,OAAOp7C,EAAO2zC,WAAU,SAAU/hD,GAChC,GAAIA,EAAEsmD,QACJoE,GAAO,EACPt8C,EAAOs0C,YACPuI,SACK,GAAIjrD,EAAEymD,UACX,IAAI+C,EAAQ3uB,EAAK76B,QAEjBoO,EAAO1Y,KAAKsK,GACRoO,EAAO8zC,OACTuI,EAAS/0D,KAAK,CAAE0Y,OAAQA,EAAQpO,EAAGA,IAC/BsqD,GAAgB5K,EAAc2B,aAChC4J,IAEA1J,KAON,OAHIiI,IAAUlM,EAAM0E,QAClBgJ,IAEKxB,GAASlM,EAAMqI,IACxB,GACF,CACF,EAEA,OAAO,IAAIrI,EAAMgK,qBAAqB,WAEpC,IADA,IACiBj7C,EADb9O,EAAS,GACJotD,EAAK,EAAMA,EAAKd,EAAQ7zD,OAAQ20D,IACvCt+C,EAAIw9C,EAAQc,GACZptD,EAAO7H,KAAK3B,EAAKsY,IAEnB,OAAO9O,CACR,CAPqC,IAOhCiqD,WACR,IACA,OAAOgD,CACT,EAEA,IAAID,GAAwB,SAAUe,GACpC,IAAInxD,EAAQqsB,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmB,GAAKA,UAAU,GAE7E+kC,EAAkB,SAAUpL,GAC9B,GAAI5jC,EAAE05B,SAAS97C,EAAOgmD,GACpB,OAAO,EAEP,IAAIt9C,EAAOs9C,EAAIgB,eACf,OAAIt+C,EAAK7M,QACPmE,EAAMzE,KAAKyqD,GACJ5jC,EAAE+K,IAAIzkB,EAAM0oD,KAEnBpxD,EAAMzE,KAAKyqD,IACJ,EAGb,EAEA,OAAO5jC,EAAE+K,IAAIgkC,EAAaC,EAC5B,EAEItB,GAAqB,SAAUtnD,GACjC,OAAI4Z,EAAEyhC,WAAWr7C,GACRA,EAEA4Z,EAAEoiC,OAAOh8C,EAEpB,EA2BA,SAAS6oD,GAAmBC,EAAU1J,EAAWgG,GAC/CH,GAAWj+C,KAAKvW,KAAM2uD,EAAWgG,GACjC30D,KAAKq4D,SAAWA,EAChBr4D,KAAK2uD,UAAYxlC,EAAE/D,KAAKplB,KAAK2uD,UAAW3uD,MACxCA,KAAKwQ,QAAU07C,EACflsD,KAAKs4D,wBAAqBtiD,EAC1BhW,KAAKu4D,eAAgB,CACvB,CAyDA,SAAStC,GAASjsC,EAAM2kC,EAAWpwB,GACjCy1B,GAAWz9C,KAAKvW,KAAMgqB,GACtB2gC,EAAegE,GACf3uD,KAAK0uD,WAAa,IAAI0J,GAAmBp4D,KAAM2uD,EAAWpwB,GAC1Dw1B,EAAY/zD,KACd,CA9FAkqD,EAAMsO,kBAAoB,WACxB,IAAK,IAAIC,EAAQrlC,UAAUxwB,OAAQ81D,EAAUzvC,MAAMwvC,GAAQE,EAAQ,EAAGA,EAAQF,EAAOE,IACnFD,EAAQC,GAASvlC,UAAUulC,GAGN,IAAnBD,EAAQ91D,QAAgBw0C,EAAQshB,EAAQ,MAC1CA,EAAUA,EAAQ,IAEpB,IAAIjC,EAAU,WAEZ,IADA,IACgBx9C,EADZ9O,EAAS,GACJnI,EAAI,EAAMA,EAAI02D,EAAQ91D,OAAQZ,IACrCiX,EAAIy/C,EAAQ12D,GACZmI,EAAO7H,KAAK,IAAI4sD,EAAgBj2C,IAElC,OAAO9O,CACR,CAPa,GAQd,OAAOimD,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,oBAAqBwO,GAAUxO,EAAM3oD,KAAKk1D,GAAS,WACvF,IAAK,IAAImC,EAAQxlC,UAAUxwB,OAAQ0pC,EAAKrjB,MAAM2vC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IAC9EvsB,EAAGusB,GAASzlC,UAAUylC,GAGxB,OAAOvsB,CACT,IACF,EAWA0e,EAAQoN,GAAoB5D,IAC5BzJ,EAAOqN,GAAmBt2D,UAAW,CACnCQ,KAAM,SAAUwtB,GAQd,OAPIA,EAAMojC,UACRlzD,KAAKu4D,eAAgB,GAEnBzoC,EAAMwjC,aACRtzD,KAAKwQ,QAAU,IAAIyhD,EAAKniC,GACxB9vB,KAAKs4D,mBAAqBhM,EAAc8B,kBAEnCoG,GAAW1yD,UAAUQ,KAAKiU,KAAKvW,KAAM8vB,EAC9C,EAEAgpC,eAAgB,SAAUrxB,EAAM2uB,GAC9B,OAAIA,IAAUlM,EAAM0E,OACXxE,EACEpqD,KAAKu4D,eACd9wB,EAAKmsB,KACExJ,GAEAoK,GAAW1yD,UAAU6sD,UAAUp4C,KAAKvW,KAAMynC,EAErD,EAEAknB,UAAW,SAAUlnB,GACnB,IAAIsxB,EAAS/4D,KAITo2D,EAAQlM,EAAMqI,KAElB,GAAIvyD,KAAKwQ,QAAQ4hD,YAAcpyD,KAAKs1D,kBAAoBt1D,KAAKu4D,eAAgB,CAC3E,IAAIS,EAAgB1M,EAAc8B,iBAC9B6K,EAAQj5D,KAAKs4D,mBACjB,OAAKt4D,KAAKu4D,eAAiBU,GAASD,GAAiBA,IAAkBC,GACrE3M,EAAc0B,aAAahuD,KAAKq4D,UAAU,WACxC,GAAIU,EAAOT,qBAAuBW,EAChC,OAAOxxB,EAAKisB,EAAaqF,EAAOvoD,QAAQvO,MAAMd,SAElD,IAEOnB,KAAK84D,eAAerxB,EAAM2uB,KAEjC9J,EAAc4B,mBAAcl4C,EAAWhW,MAAM,WAE3C,OADAo2D,EAAQ3uB,EAAKisB,EAAa1zD,KAAKwQ,QAAQvO,MAAMd,SAE/C,GAAG,IACInB,KAAK84D,eAAerxB,EAAM2uB,GAErC,CACE,OAAOp2D,KAAK84D,eAAerxB,EAAM2uB,EAErC,IAUFpL,EAAQiL,GAAUjC,IAClBjJ,EAAOkL,GAASn0D,UAAW,CACzB4oD,aAAa,EAEb9e,QAAS,WACP,IAAIstB,EAASl5D,KAEb,OAAO,IAAI+0D,GAAY,IAAI7K,EAAMiF,KAAKnvD,KAAM,UAAW,KAAK,SAAUynC,GACpE,OAAOyxB,EAAOxK,WAAWC,WAAU,SAAU7+B,GAC3C,IAAKA,EAAMqjC,YACT,OAAO1rB,EAAK3X,EAEhB,GACF,GACF,EAEAymC,YAAa,SAAUh4B,GACrB,OAAO,IAAI03B,GAAS,IAAI/L,EAAMiF,KAAKnvD,KAAM,cAAe,CAACu+B,IAAWv+B,KAAK0uD,WAAWC,UAAWpwB,EACjG,EAEAs3B,WAAY,WAEV,OADA/K,EAAkB13B,WACXpzB,IACT,EAEAs2D,cAAe,WACb,IAAI6C,EAASn5D,KAEb,OAAO,IAAI+0D,GAAY,IAAI7K,EAAMiF,KAAKnvD,KAAM,gBAAiB,KAAK,SAAUynC,GAC1E,OAAO0xB,EAAOzK,WAAWC,WAAU,SAAU7+B,GAI3C,OAHIA,EAAMqjC,cACRrjC,EAAQA,EAAM2jC,UAEThsB,EAAK3X,EACd,GACF,GACF,IAGFo6B,EAAM+L,SAAWA,GAEjB/L,EAAMkP,SAAW,SAAUj4D,GACzB,OAAO,IAAI80D,GAAS,IAAI/L,EAAMiF,KAAKjF,EAAO,WAAY,CAAC/oD,KAAS,SAAUsmC,GAGxE,OAFAA,EAAKisB,EAAavyD,IAClBsmC,EAAKmsB,KACExJ,CACT,GACF,EAEAF,EAAM1iB,WAAa,SAAUnT,GAC3B,IAAIglC,EAAmBjmC,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmBjK,EAAEvS,GAAKwc,UAAU,GAE1FpJ,EAAO,IAAIkgC,EAAMiF,KAAKjF,EAAO,aAAc,CAAC71B,EAAQglC,IACxD,OAAO,IAAItE,GAAY/qC,GAAM,SAAUyd,GACrC,IAAI6xB,GAAU,EACVC,GAAe,EACfC,EAAS,WACX,IAAKF,EACH,OAAI,MAAOG,GACTA,IACOH,GAAU,GAEVC,GAAe,CAG5B,EACIE,EAAWplC,GAAO,WAGpB,IAFA,IAAI5f,EAEKilD,EAAQtmC,UAAUxwB,OAAQ8T,EAAOuS,MAAMywC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IAChFjjD,EAAKijD,GAASvmC,UAAUumC,GAG1B,IAAIx4D,EAAQk4D,EAAiBlmC,MAAMnzB,KAAM0W,GACnC0gC,EAAQj2C,KAAoC,OAAxBsT,EAAM0U,EAAE/f,KAAKjI,IAAkBsT,EAAIu+C,cAAWh9C,KACtE7U,EAAQ,CAACA,IAGX,IADA,IACgB2uB,EADZsmC,EAAQlM,EAAMqI,KACTvwD,EAAI,EAAUA,EAAIb,EAAMyB,OAAQZ,IAGvC,GAFA8tB,EAAQ3uB,EAAMa,IACdo0D,EAAQ3uB,EAAK3X,EAAQ+jC,EAAQ/jC,OACfo6B,EAAM0E,QAAU9+B,EAAMojC,QAElC,OADAsG,IACOpD,EAGX,OAAOA,CACT,IAIA,OAHImD,GACFC,IAEKA,CACT,GACF,EAEAtP,EAAM8J,WAAWlyD,UAAUpB,IAAM,SAAUohB,GACzC,IAAK,IAAI83C,EAAQxmC,UAAUxwB,OAAQ8T,EAAOuS,MAAM2wC,EAAQ,EAAIA,EAAQ,EAAI,GAAIC,EAAQ,EAAGA,EAAQD,EAAOC,IACpGnjD,EAAKmjD,EAAQ,GAAKzmC,UAAUymC,GAG9B,OAAOrI,EAAsBxxD,KAAM8hB,EAAGpL,GAAM,SAAUnH,GACpD,OAAO6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,MAAO,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GAC3E,OAAO9vB,KAAKsC,KAAKwtB,EAAMyjC,KAAKhkD,GAC9B,IACF,GACF,EAEA,IAAIuqD,GAAyB,SAAUpjD,GACrC,OAAI0gC,EAAQ1gC,EAAK,IACRA,EAAK,GAELuS,MAAMnnB,UAAUmB,MAAMsT,KAAKG,EAEtC,EAEIqjD,GAAoC,SAAUrjD,GAChD,OAAIyS,EAAEyhC,WAAWl0C,EAAK,IACb,CAACojD,GAAuB7wC,MAAMnnB,UAAUmB,MAAMsT,KAAKG,EAAM,IAAKA,EAAK,IAEnE,CAACojD,GAAuB7wC,MAAMnnB,UAAUmB,MAAMsT,KAAKG,EAAM,EAAGA,EAAK9T,OAAS,IAAKumB,EAAE/f,KAAKsN,GAEjG,EAEAwzC,EAAM8P,eAAiB,WACrB,IAAItB,EAAUoB,GAAuB1mC,WACrC,GAAIslC,EAAQ91D,OAAQ,CAElB,IADA,IAAI6zD,EAAU,GACLz0D,EAAI,EAAGA,EAAI02D,EAAQ91D,OAAQZ,IAAK,CACvC,IAAIi4D,EAASpP,EAAa6N,EAAQ12D,IAAM02D,EAAQ12D,GAAKkoD,EAAMkP,SAASV,EAAQ12D,IAC5Ey0D,EAAQn0D,KAAK,IAAIusD,EAAOoL,GAAQ,GAClC,CACA,OAAO7J,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,iBAAkBwO,GAAUxO,EAAM3oD,KAAKk1D,GAAS,WACpF,IAAK,IAAIyD,EAAQ9mC,UAAUxwB,OAAQ0pC,EAAKrjB,MAAMixC,GAAQC,EAAQ,EAAGA,EAAQD,EAAOC,IAC9E7tB,EAAG6tB,GAAS/mC,UAAU+mC,GAGxB,OAAO7tB,CACT,IAAGupB,aACL,CACE,OAAO3L,EAAMkP,SAAS,GAE1B,EAEAlP,EAAM+K,SAAW,WACf,OAAO/K,EAAM8P,eAAe/wC,MAAMnnB,UAAUmB,MAAMsT,KAAK6c,UAAW,EAAGA,UAAUxwB,OAAS,IAAIqyD,SAAS7hC,UAAUA,UAAUxwB,OAAS,GACpI,EAEAsnD,EAAMkQ,YAAc,WAClB,IAAIC,EAAqCN,GAAkC3mC,WAEvEslC,EAAU2B,EAAmC,GAC7C9qD,EAAI8qD,EAAmC,GAEvCrwC,EAAO,IAAIkgC,EAAMiF,KAAKjF,EAAO,cAAe,CAAC36C,GAAGG,OAAOgpD,IAC3D,OAAOtI,EAASpmC,EAAMkgC,EAAM8P,eAAetB,GAASh4D,KAAI,SAAUqJ,GAChE,OAAOwF,EAAE4jB,WAAMnd,EAAWjM,EAC5B,IACF,EAEAmgD,EAAM8J,WAAWlyD,UAAUwH,QAAU,SAAUgxD,EAAO/qD,GACpD,IAAIgrD,EAAa1I,EAAatiD,GAC1Bya,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,UAAW,CAACs6D,EAAO/qD,IACnD,OAAO6gD,EAASpmC,EAAMkgC,EAAM8P,eAAeh6D,KAAMs6D,GAAO55D,KAAI,SAAUqJ,GACpE,OAAOwwD,EAAWxwD,EAAO,GAAIA,EAAO,GACtC,IACF,EAEAmgD,EAAM8J,WAAWlyD,UAAU04D,iBAAmB,SAAUC,EAAWlrD,GACjE,IAAIxI,EAAQ0zD,EACRzwC,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,mBAAoB,CAACy6D,EAAWlrD,IAChE,OAAO6gD,EAASpmC,EAAMhqB,KAAKu2D,aAAY,SAAUzmC,GAC/C,IAAI4qC,EAAQnrD,EAAExI,EAAO+oB,GACjB6qC,EAAWD,EAAM,GACjB9yB,EAAU8yB,EAAM,GAEpB3zD,EAAQ4zD,EAER,IADA,IACgBtxD,EADZ+sD,EAAQlM,EAAMqI,KACTvwD,EAAI,EAAWA,EAAI4lC,EAAQhlC,OAAQZ,IAG1C,GAFAqH,EAASu+B,EAAQ5lC,IACjBo0D,EAAQp2D,KAAKsC,KAAK+G,MACJ6gD,EAAM0E,OAClB,OAAOwH,EAGX,OAAOA,CACT,IACF,EAEA,IAAIwE,GAAS,SAAUv3D,EAAGC,GACxB,OAAOD,IAAMC,CACf,EAEIu3D,GAAS,SAAUn4D,GACrB,OAAO,MAAOA,GAA4CA,EAAOypD,OACnE,EAEAjC,EAAM8J,WAAWlyD,UAAUg5D,eAAiB,WAC1C,IAAIC,EAAU3nC,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmBwnC,GAASxnC,UAAU,GAEnFpJ,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,iBAAkB,IAClD,OAAOowD,EAASpmC,EAAMhqB,KAAKw6D,iBAAiBtO,GAAM,SAAUnlC,EAAM+I,GAChE,OAAKA,EAAMwjC,WAEAxjC,EAAMqjC,aAAe0H,GAAO9zC,KAAUg0C,EAAQh0C,EAAK9kB,MAAO6tB,EAAM3uB,SAClE,CAAC,IAAI8wD,EAAKniC,EAAM3uB,SAAU,CAAC2uB,IAE3B,CAAC/I,EAAM,IAJP,CAACA,EAAM,CAAC+I,GAMnB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAUk5D,SAAW,SAAUV,GAC9C,IAAItwC,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,WAAY,CAACs6D,IAC7C,OAAOlK,EAASpmC,EAAMkgC,EAAMsO,kBAAkBx4D,KAAMs6D,GAAO55D,KAAI,SAAUqJ,GACvE,OAA4B,IAArBA,EAAO,GAAGnH,MACnB,IAAGizD,YAAW,GAAOiF,iBACvB,EAEA5Q,EAAM8J,WAAWlyD,UAAUm5D,IAAM,WAC/B,OAAO7K,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,MAAO,IAAKA,KAAKU,KAAI,SAAUixB,GAClE,OAAQA,CACV,IACF,EAEAu4B,EAAM+L,SAASn0D,UAAUo5D,IAAM,SAAUZ,GACvC,OAAOlK,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,MAAO,CAACs6D,IAASt6D,KAAKsJ,QAAQgxD,GAAO,SAAU3oC,EAAGH,GACrF,OAAOG,GAAKH,CACd,IACF,EAEA04B,EAAM+L,SAASn0D,UAAUq5D,GAAK,SAAUb,GACtC,OAAOlK,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,KAAM,CAACs6D,IAASt6D,KAAKsJ,QAAQgxD,GAAO,SAAU3oC,EAAGH,GACpF,OAAOG,GAAKH,CACd,IACF,EAEA04B,EAAMkR,UAAY,CAChBl3D,WAAY,SAAUqL,EAAG8rD,GACvB,OAAOn3D,WAAWqL,EAAG8rD,EACvB,EACA3tD,YAAa,SAAU6B,EAAGvN,GACxB,OAAO0L,YAAY6B,EAAGvN,EACxB,EACA2L,cAAe,SAAUiJ,GACvB,OAAOjJ,cAAciJ,EACvB,EACA5S,aAAc,SAAU4S,GACtB,OAAO5S,aAAa4S,EACtB,EACAvP,IAAK,WACH,OAAO,IAAI8P,MAAO04B,SACpB,GAGFqa,EAAM6K,YAAYjzD,UAAUw5D,eAAiB,SAAUn2D,GACrD,OAAOirD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,iBAAkB,CAACmF,IAASnF,KAAKu7D,sBAAsBp2D,EAAOiT,OAAOojD,WAC5G,EAEAtR,EAAM6K,YAAYjzD,UAAU25D,gBAAkB,SAAU5oC,GACtD,OAAOu9B,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,kBAAmB,CAAC6yB,IAAS7yB,KAAKu7D,2BAAsBvlD,EAAW6c,GAC1G,EAEAq3B,EAAM6K,YAAYjzD,UAAUy5D,sBAAwB,SAAUp2D,EAAO0tB,GACnE,IAAI6oC,EAAkB,SAAU3gD,GAC9B,OAAIA,EAAOhR,OAAOnH,SAAWiwB,EACpB9X,EAAOozC,aACKn4C,IAAV7Q,EACF4V,EAAO4gD,gBADT,CAGT,EACI3xC,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,wBAAyB,CAACmF,EAAO0tB,IACjE,OAAOu9B,EAASpmC,EAAMhqB,KAAK+a,OAAO5V,EAAOu2D,EAAiBA,GAC5D,EAEAxR,EAAM6K,YAAYjzD,UAAUiZ,OAAS,SAAU5V,GAC7C,IAAIy2D,EAAUxoC,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmBg3B,EAAMh3B,UAAU,GAChFyoC,EAAUzoC,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmBg3B,EAAMh3B,UAAU,GAEhFrY,EAAS,CACX+gD,UAAW,KACXhqD,SAAKkE,EACLjM,OAAQ,GACRokD,MAAO,WAKL,GAJInuD,KAAK87D,YACP5R,EAAMkR,UAAUp3D,aAAahE,KAAK87D,WAClC97D,KAAK87D,UAAY,MAEf97D,KAAK+J,OAAOnH,OAAS,EAAG,CAC1B,IAAIm5D,EAAe/7D,KAAK+J,OACxB/J,KAAK+J,OAAS,GACd,IAAIqsD,EAAQp2D,KAAKsC,KAAKqxD,EAAUoI,IAChC,GAAgB,MAAZ/7D,KAAK8R,IACP,OAAO9R,KAAKsC,KAAKtC,KAAK8R,KACjB,GAAIskD,IAAUlM,EAAM0E,OACzB,OAAOiN,EAAQ77D,KAEnB,MACE,GAAgB,MAAZA,KAAK8R,IACP,OAAO9R,KAAKsC,KAAKtC,KAAK8R,IAG5B,EACA6pD,SAAU,WACR,IAAIK,EAASh8D,KAEb,IAAKA,KAAK87D,UACR,OAAO97D,KAAK87D,UAAY32D,GAAM,WAC5B,OAAO62D,EAAO7N,OAChB,GAEJ,GAEEiI,EAAQlM,EAAMqI,KAClB,IAAKppC,EAAEyhC,WAAWzlD,GAAQ,CACxB,IAAI82D,EAAU92D,EACdA,EAAQ,SAAUoK,GAChB,OAAO26C,EAAMkR,UAAUl3D,WAAWqL,EAAG0sD,EACvC,CACF,CACA,OAAO7L,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,SAAU,IAAKA,KAAKu2D,aAAY,SAAUzmC,GAC7E,IAAIosC,EAASl8D,KAiBb,OAfA+a,EAAOzY,KAAO,SAAUwtB,GACtB,OAAOosC,EAAO55D,KAAKwtB,EACrB,EACIA,EAAMujC,UACR+C,EAAQp2D,KAAKsC,KAAKwtB,GACTA,EAAMojC,SACfn4C,EAAOjJ,IAAMge,EACR/U,EAAO+gD,WACV/gD,EAAOozC,UAGTpzC,EAAOhR,OAAOzH,KAAKwtB,EAAM3uB,SAEzBy6D,EAAQ7gD,IAEHq7C,CACT,IACF,EAEAlM,EAAM8J,WAAWlyD,UAAUwtB,OAAS,SAAU/f,GAC5Ci7C,EAA2Bj7C,GAE3B,IAAK,IAAI4sD,EAAS/oC,UAAUxwB,OAAQ8T,EAAOuS,MAAMkzC,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1G1lD,EAAK0lD,EAAS,GAAKhpC,UAAUgpC,GAG/B,OAAO5K,EAAsBxxD,KAAMuP,EAAGmH,GAAM,SAAUnH,GACpD,OAAO6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,SAAU,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GAC9E,OAAIA,EAAMR,OAAO/f,GACRvP,KAAKsC,KAAKwtB,GAEVo6B,EAAMqI,IAEjB,IACF,GACF,EAEArI,EAAMllD,KAAO,SAAU7D,GACrB,OAAO,IAAI4zD,GAAY,IAAI5F,EAAKjF,EAAO,OAAQ,CAAC/oD,KAAS,SAAUsmC,GAGjE,OAFAA,EAAKosB,EAAQ1yD,IACbsmC,EAAKmsB,KACExJ,CACT,GACF,EAEAF,EAAM6K,YAAYjzD,UAAU4N,OAAS,SAAUsiD,GAC7C,IAAID,EAAO/xD,KACX,OAAO,IAAI+0D,GAAY,IAAI7K,EAAMiF,KAAK4C,EAAM,SAAU,CAACC,KAAS,SAAUvqB,GACxE,IAAI40B,EAAajS,EACbkS,EAAYvK,EAAKrD,WAAWC,WAAU,SAAU/hD,GAClD,OAAIA,EAAEsmD,QACJmJ,EAAarK,EAAMsE,gBAAgB5H,WAAWC,UAAUlnB,GAGjDA,EAAK76B,EAEhB,IACA,OAAO,WACL,OAAO0vD,IAAaD,GACtB,CACF,GACF,EAEAnS,EAAM+L,SAASn0D,UAAU4N,OAAS,SAAUsiD,GAC1C,OAAOuK,GAA6Bv8D,KAAMA,KAAK4rC,UAAUl8B,OAAOsiD,GAClE,EAEA9H,EAAMsS,UAAY,WAChB,IAAI9D,EAAUoB,GAAuB1mC,WACrC,OAAIslC,EAAQ91D,OACHwtD,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,YAAawO,GAAUvvC,EAAE2iC,KAAK3iC,EAAE2a,KAAK40B,GAAUvvC,EAAE0a,KAAK60B,GAASpC,iBAAiB,SAAUjzD,EAAGC,GACjI,OAAOD,EAAEqM,OAAOpM,EAClB,KAEO4mD,EAAMpiB,OAEjB,EAEA,IAAIy0B,GAA+B,SAAUlE,EAAU4B,GACrD,IAAIwC,EAAgB,IAAI1H,GAAY9E,EAASoI,EAAU,kBAAkB,SAAU5wB,GACjF,IAAItmC,OAAQ6U,EACRy4C,EAAQ4J,EAAS3J,WAAWC,WAAU,SAAU7+B,GAIlD,OAHKA,EAAMojC,UACT/xD,EAAQ2uB,GAEHo6B,EAAM0E,MACf,IAOA,OANAtC,EAAc0B,aAAayO,GAAe,WAIxC,OAHI,MAAOt7D,GACTsmC,EAAKtmC,GAEAsmC,EAAKmsB,IACd,IACOnF,CACT,IACA,OAAOgO,EAAc/sD,OAAOuqD,GAAQpE,YACtC,EAEA3L,EAAM8J,WAAWlyD,UAAUqmC,QAAU,WACnC,OAAOu0B,GAAS18D,KAAM28D,GAAYvpC,WACpC,EAEA82B,EAAM8J,WAAWlyD,UAAU86D,aAAe,WACxC,OAAOF,GAAS18D,KAAM28D,GAAYvpC,YAAY,EAChD,EAEA,IAAIupC,GAAc,SAAUjmD,GAC1B,OAAoB,IAAhBA,EAAK9T,QAAgBioD,EAAan0C,EAAK,IAClCyS,EAAEoiC,OAAO70C,EAAK,IAEdg6C,EAAiBh6C,EAE5B,EAEImmD,GAAiB,SAAUlrC,GAC7B,OAAIk5B,EAAal5B,GACRA,EAEAu4B,EAAMllD,KAAK2sB,EAEtB,EAEI+qC,GAAW,SAAU13B,EAAMz1B,EAAGutD,EAAWz0C,GAC3C,IAAI00C,EAAU,CAAC/3B,GACXg4B,EAAY,GAEZ7yD,EAAS,IAAI4qD,GADN,IAAI7K,EAAMiF,KAAKnqB,EAAM,WAAa83B,EAAY,QAAU,IAAK,CAACvtD,KACtC,SAAUk4B,GAC3C,IAAIw1B,EAAY,IAAI/I,GAChBlF,EAAQ,GACRkO,EAAQ,SAAUptC,GACpB,IAAIm7B,EAAQ4R,GAAettD,EAAEugB,EAAM3uB,UAEnC,OADA67D,EAAU16D,KAAK2oD,GACRgS,EAAUx6D,KAAI,SAAUm1D,EAAUuF,GACvC,OAAOlS,EAAMyD,WAAWC,WAAU,SAAU7+B,GAC1C,GAAIA,EAAMojC,QAIR,OAHA/pC,EAAE0iC,OAAOZ,EAAO+R,GAChBI,IACAC,EAASF,GACFjT,EAAM0E,QAET,MAAO9+B,EAA0CA,EAAM0jC,gBAAax9C,KACtE8Z,EAAQA,EAAM2jC,UAEhB,IAAI2C,EAAQ3uB,EAAK3X,GAIjB,OAHIsmC,IAAUlM,EAAM0E,QAClBgJ,IAEKxB,CAEX,GACF,GACF,EACIgH,EAAa,WACf,IAAIttC,EAAQk/B,EAAMxnD,QAClB,GAAIsoB,EACF,OAAOotC,EAAMptC,EAEjB,EACIutC,EAAW,SAAU5O,GAEvB,GADAA,IACIwO,EAAUxR,QACZ,OAAOhkB,EAAKmsB,IAEhB,EAqBA,OApBAqJ,EAAUx6D,KAAI,SAAU66D,EAAIC,GAC1B,OAAOv4B,EAAK0pB,WAAWC,WAAU,SAAU7+B,GACzC,OAAIA,EAAMojC,QACDmK,EAASE,GACPztC,EAAMujC,UACR5rB,EAAK3X,GACHgtC,GAAaG,EAAUpqC,QAAU,EACnCq3B,EAAMqI,KAET0K,EAAU5I,aACLnK,EAAM0E,OAEXvmC,GAAS40C,EAAUpqC,QAAUxK,EACxB2mC,EAAM1sD,KAAKwtB,GAEXotC,EAAMptC,EAGnB,GACF,IACOmtC,EAAU7I,WACnB,IAQA,OAPAjqD,EAAO4jD,aAAe,WACpB,OAAIiP,EAAUp6D,OACLm6D,EAAQrtD,OAAOstD,GAEfD,CAEX,EACO5yD,CACT,EAuCA,SAASqzD,KACP,KAAMx9D,gBAAgBw9D,IACpB,OAAO,IAAIA,GAGbx9D,KAAK43D,SAAWzuC,EAAE/D,KAAKplB,KAAK43D,SAAU53D,MACtCA,KAAKy9D,aAAet0C,EAAE/D,KAAKplB,KAAKy9D,aAAcz9D,MAC9CA,KAAK09D,YAAcv0C,EAAE/D,KAAKplB,KAAK09D,YAAa19D,MAE5CA,KAAKynC,UAAOzxB,EACZhW,KAAKs0D,cAAgB,GACrBt0D,KAAKuvD,OAAQ,EACbwF,GAAYx+C,KAAKvW,KAAM,IAAIkqD,EAAMiF,KAAKjF,EAAO,MAAO,IAAKlqD,KAAKy9D,aAChE,CAlDAvT,EAAM8J,WAAWlyD,UAAU67D,4BAA8B,SAAUt1C,GACjE,IAAK,IAAIu1C,EAASxqC,UAAUxwB,OAAQ8T,EAAOuS,MAAM20C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1GnnD,EAAKmnD,EAAS,GAAKzqC,UAAUyqC,GAG/B,IAAI7zC,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,8BAA+B,CAACqoB,GAAO3Y,OAAOgH,IAC9E,OAAO05C,EAASpmC,EAAM0yC,GAAS18D,KAAM28D,GAAYjmD,IAAO,EAAO2R,GACjE,EAEA6hC,EAAM8J,WAAWlyD,UAAUg8D,cAAgB,WACzC,IAAI9zC,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,gBAAiBipB,MAAMnnB,UAAUmB,MAAMsT,KAAK6c,UAAW,IACvF,OAAOg9B,EAASpmC,EAAMhqB,KAAK29D,4BAA4BxqC,MAAMnzB,KAAM,CAAC,GAAG0P,OAAOu6C,EAAO1zC,KAAK6c,aAC5F,EAEA82B,EAAM6T,MAAQ,SAAU54D,EAAOhE,GAC7B,OAAOivD,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,QAAS,CAAC/kD,EAAOhE,IAAS+oD,EAAM1iB,YAAW,SAAUC,GACzF,IAGI7wB,EAAKszC,EAAMkR,UAAUl3D,YAHZ,WACX,OAAOujC,EAAK,CAACtmC,EAAOyyD,KACtB,GAC4CzuD,GAC5C,OAAO,WACL,OAAO+kD,EAAMkR,UAAUp3D,aAAa4S,EACtC,CACF,IACF,EAEAszC,EAAM8J,WAAWlyD,UAAUk8D,kBAAoB,SAAUC,GACvD,IAAIj0C,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,oBAAqB,CAACi+D,IACtD,OAAO7N,EAASpmC,EAAMhqB,KAAK89D,eAAc,SAAUnsC,GACjD,OAAOu4B,EAAMllD,KAAK2sB,GAAGjiB,OAAOw6C,EAAM6T,MAAME,GAAiB3uC,QAAO,GAClE,IACF,EAEA46B,EAAM+L,SAASn0D,UAAUk8D,kBAAoB,WAC3C,OAAO9T,EAAM8J,WAAWlyD,UAAUk8D,kBAAkB7qC,MAAMnzB,KAAMozB,WAAWyiC,YAC7E,EAiBA7K,EAAQwS,GAAKzI,IACbhK,EAAOyS,GAAI17D,UAAW,CACpB81D,SAAU,WAER,IADA,IACgBjC,EADZnf,EAAWx2C,KAAKs0D,cACXtyD,EAAI,EAAQA,EAAIw0C,EAAS5zC,OAAQZ,IAEf,mBADzB2zD,EAAMnf,EAASx0C,IACAysD,OACbkH,EAAIlH,OAGV,EAEAgP,aAAc,SAAUS,GACtB,GAAIl+D,KAAKuvD,MACP2O,EAAQtK,SACH,CACL5zD,KAAKynC,KAAOy2B,EAEZ,IADA,IACgB9I,EADZ5e,EAAsBx2C,KAAKs0D,cAluEzBrxD,MAAM,GAmuEHjB,EAAI,EAAiBA,EAAIw0C,EAAS5zC,OAAQZ,IACjDozD,EAAe5e,EAASx0C,GACxBhC,KAAKm+D,eAAe/I,EAExB,CACA,OAAOp1D,KAAK43D,QACd,EAEA8F,YAAa,SAAU/1D,GACrB,IAAIy2D,EAASp+D,KAEb,OAAO,SAAU8vB,GACf,OAAIA,EAAMojC,SACRkL,EAAOC,iBAAiB12D,GACjBuiD,EAAM0E,QAENwP,EAAO32B,KAAK3X,EAEvB,CACF,EAEAquC,eAAgB,SAAU/I,GAExB,OADAA,EAAa3G,MAAQ2G,EAAaztD,MAAM+mD,WAAWC,UAAU3uD,KAAK09D,YAAYtI,EAAaztD,QACpFytD,EAAa3G,KACtB,EAEA4P,iBAAkB,SAAU12D,GAE1B,IADA,IACgBguD,EADZnf,EAAWx2C,KAAKs0D,cACXtyD,EAAI,EAAQA,EAAIw0C,EAAS5zC,OAAQZ,IAExC,IADA2zD,EAAMnf,EAASx0C,IACP2F,QAAUA,EAKhB,MAJyB,mBAAdguD,EAAIlH,OACbkH,EAAIlH,aAENzuD,KAAKs0D,cAAc1wC,OAAO5hB,EAAG,EAInC,EAEAs8D,KAAM,SAAU32D,GACd,IAAI42D,EAASv+D,KAGb,GA7vEmB,SAAU8vB,GAC/B,KAAe,MAATA,EAAgBA,EAAM26B,mBAAgB,GAC1C,MAAM,IAAIN,EAAU,uBAAyBr6B,EAEjD,CAwvEI0uC,CAAiB72D,IACb3H,KAAKuvD,MAAT,CAGA,IAAIoG,EAAM,CAAEhuD,MAAOA,GAKnB,OAJA3H,KAAKs0D,cAAchyD,KAAKqzD,QACC,IAAd31D,KAAKynC,MACdznC,KAAKm+D,eAAexI,GAEf,WACL,OAAO4I,EAAOF,iBAAiB12D,EACjC,CARA,CASF,EAEAmK,IAAK,WAGH,GAFA9R,KAAKuvD,OAAQ,EACbvvD,KAAK43D,WACoB,mBAAd53D,KAAKynC,KACd,OAAOznC,KAAKynC,KAAKmsB,IAErB,EAEAtxD,KAAM,SAAUnB,GACd,IAAKnB,KAAKuvD,OAA8B,mBAAdvvD,KAAKynC,KAAqB,CAClD,IAAIg3B,GAAYz+D,KAAK40D,QACrB,IAAK6J,EAIH,OAHKz+D,KAAK0+D,YAAW1+D,KAAK0+D,UAAY,SACtC1+D,KAAK0+D,UAAUp8D,KAAKnB,GAItBnB,KAAK40D,SAAU,EACf,IACE,OAAO50D,KAAKynC,KAAKksB,EAAUxyD,GAY7B,CAXE,QACA,GAAIs9D,GAAYz+D,KAAK0+D,UAAW,CAE9B,IADA,IAAI18D,EAAI,EACDA,EAAIhC,KAAK0+D,UAAU97D,QAAQ,CAC5BzB,EAAQnB,KAAK0+D,UAAU18D,GAC3BhC,KAAKynC,KAAKksB,EAAUxyD,IACpBa,GACF,CACAhC,KAAK0+D,UAAY,IACnB,CACA1+D,KAAK40D,SAAU,CACjB,CACF,CACF,EAEA/wD,MAAO,SAAUA,GACf,GAAyB,mBAAd7D,KAAKynC,KACd,OAAOznC,KAAKynC,KAAK,IAAI3jC,EAAMD,GAE/B,IAGFqmD,EAAMsT,IAAMA,GAEZ,IAAImB,GAAe,SAAU30C,EAAMsmC,GACjC,OAAOD,GAAsB,SAAU9gD,GAKrC,IAJA,IAAI0qD,EAASrJ,EAAiBN,EAAS,CAAC,SAAUvmD,EAAQtI,GACxD,OAAO8N,EAAE4jB,WAAMnd,EAAWjM,EAAO2F,OAAO,CAACjO,IAC3C,IAESm9D,EAASxrC,UAAUxwB,OAAQ8T,EAAOuS,MAAM21C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1GnoD,EAAKmoD,EAAS,GAAKzrC,UAAUyrC,GAG/B,OAAOzO,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAOlgC,EAAM,CAACza,GAAGG,OAAOgH,IAAQwzC,EAAM8P,eAAetjD,GAAMyxB,QAAQ8xB,GACpG,GACF,EAEA/P,EAAM4U,aAAeH,GAAa,gBAAgB,SAAUpvD,GAC1D,IAAK,IAAIwvD,EAAS3rC,UAAUxwB,OAAQ8T,EAAOuS,MAAM81C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1GtoD,EAAKsoD,EAAS,GAAK5rC,UAAU4rC,GAG/B,OAAO9U,EAAM1iB,YAAW,SAAUjJ,GAEhC,OADAgzB,EAAahiD,EAAGmH,EAAhB66C,CAAsBhzB,GACf6rB,CACT,IAAG,SAAUjpD,GACX,MAAO,CAACA,EAAOyyD,IACjB,GACF,IAEA1J,EAAM+U,iBAAmBN,GAAa,oBAAoB,SAAUpvD,GAClE,IAAK,IAAI2vD,EAAS9rC,UAAUxwB,OAAQ8T,EAAOuS,MAAMi2C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1GzoD,EAAKyoD,EAAS,GAAK/rC,UAAU+rC,GAG/B,OAAOjV,EAAM1iB,YAAW,SAAUjJ,GAEhC,OADAgzB,EAAahiD,EAAGmH,EAAhB66C,CAAsBhzB,GACf6rB,CACT,IAAG,SAAUvmD,EAAO1C,GAClB,OAAI0C,EACK,CAAC,IAAIC,EAAMD,GAAQ+vD,KAErB,CAACzyD,EAAOyyD,IACjB,GACF,IAEA1J,EAAMkV,gBAAkB,SAAUC,GAIhC,SAASC,EAASC,EAAUl9D,EAAKlB,GAE/B,OALF,SAAiBo+D,GACf,OAAOA,EAASA,EAAS38D,OAAS,EACpC,CAEE4N,CAAQ+uD,IAAUl9D,GAAOlB,EAClBA,CACT,CAYA,SAASq+D,EAAUH,GACjB,OAAOjoB,EAAQioB,GAAY,GAAK,CAAC,CACnC,CAUA,SAASI,EAAoBt+D,GAC3B,GAAI0pD,EAAa1pD,GACf,OAAO,EACF,GAAIA,IAAUA,EAAMvB,aAAeoB,QAAUG,EAAMvB,aAAeqpB,OACvE,IAAK,IAAI5mB,KAAOlB,EAAO,CACrB,GAAIH,OAAOc,UAAUyoB,eAAehU,KAAKpV,EAAOkB,GAE9C,GAAIo9D,EADQt+D,EAAMkB,IACc,OAAO,CAE3C,CAEJ,CAEA,SAASq1B,EAAQr1B,EAAKlB,GACpB,GAAI0pD,EAAa1pD,GACfu3D,EAAQp2D,KAAKnB,GACbu+D,EAAMp9D,KAvCV,SAA0BD,EAAK6sB,GAC7B,OAAO,SAAUqwC,EAAUx1D,GACzBu1D,EAASC,EAAUl9D,EAAK0H,EAAOmlB,GACjC,CACF,CAmCeywC,CAAiBt9D,EAAKq2D,EAAQ91D,OAAS,SAC7C,GAAI68D,EAAoBt+D,GAAQ,CAIrCu+D,EAAMp9D,KA7BV,SAAqBD,EAAKlB,GACxB,OAAO,SAAUo+D,GACf,IAAIK,EAAaJ,EAAUr+D,GAC3Bm+D,EAASC,EAAUl9D,EAAKu9D,GACxBL,EAASj9D,KAAKs9D,EAChB,CACF,CAuBeC,CAAYx9D,EAAKlB,IAC5B2+D,EAAgB3+D,GAChBu+D,EAAMp9D,MALW,SAAUi9D,GACzBA,EAASj8C,KACX,GAIF,MACEo8C,EAAMp9D,KA3CV,SAAuBD,EAAKlB,GAC1B,OAAO,SAAUo+D,GACfD,EAASC,EAAUl9D,EAAKlB,EAC1B,CACF,CAuCe4+D,CAAc19D,EAAKlB,GAElC,CAYA,SAAS2+D,EAAgBT,GACvBl2C,EAAEpnB,KAAKs9D,EAAU3nC,EACnB,CAEA,IAAIgoC,EAAQ,GACRhH,EAAU,GAEVsH,EAAiBP,EAAoBJ,IAAaS,EAAgBT,GAAWnV,EAAM8P,eAAetB,GAASh4D,KAjB/G,SAAoBqJ,GAGlB,IAFA,IAAIk2D,EAAcT,EAAUH,GACxBE,EAAW,CAACU,GACPj+D,EAAI,EAAMA,EAAI09D,EAAM98D,OAAQZ,KACnCuN,EAAImwD,EAAM19D,IACRu9D,EAAUx1D,GAEd,OAAOk2D,CACT,KASkI/V,EAAMkP,SAASiG,GAEjJ,OAAOjP,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,kBAAmB,CAACmV,IAAYW,EACxE,EAEA9V,EAAM8J,WAAWlyD,UAAUo+D,OAAS,WAClC,IAAI3wD,EAAImhD,EAAiBt9B,WACzB,OAAOg9B,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,SAAU,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GAC9E,OAAIA,EAAMojC,SACRlzD,KAAKsC,KAAKqxD,EAAUpkD,EAAEugB,KACtB9vB,KAAKsC,KAAKsxD,KACH1J,EAAM0E,QAEN5uD,KAAKsC,KAAKwtB,EAErB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAUq+D,WAAa,WACtC,OAAO/P,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,aAAc,IAAKA,KAAKu2D,aAAY,SAAUzmC,GACjF,OAAIA,EAAMujC,UACDnJ,EAAMqI,KAENvyD,KAAKsC,KAAKwtB,EAErB,IACF,EAEAo6B,EAAM6K,YAAYjzD,UAAUs+D,UAAY,SAAUC,GAChD,IAAIC,EAAY,CAAC,EACjB,OAAOlQ,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAACqgE,IAAWnW,EAAMsO,kBAAkBx4D,KAAKkgE,OAAOI,GAAYD,EAAQF,cAAc5J,aAAY,SAAUzmC,GACxJ,GAAKA,EAAMwjC,WAEJ,CACL,IAAIiN,EAAezwC,EAAM3uB,QAErB+I,EAAOq2D,EAAa,GAGxB,GAFcA,EAAa,GAEf39D,OACV,OAAO5C,KAAKsC,KAAKsxD,KAGjB,IADA,IACgBzyD,EADZi1D,EAAQlM,EAAMqI,KACTvwD,EAAI,EAAUA,EAAIkI,EAAKtH,OAAQZ,IAGpCo0D,GAFFj1D,EAAQ+I,EAAKlI,MACCs+D,EACJtgE,KAAKsC,KAAKsxD,KAEV5zD,KAAKsC,KAAKqxD,EAAUxyD,IAGhC,OAAOi1D,CAEX,CArBE,OAAOp2D,KAAKsC,KAAKwtB,EAsBrB,IACF,EAEAo6B,EAAM+L,SAASn0D,UAAUs+D,UAAY,SAAUC,GAC7C,IAAIz0B,EAAU5rC,KAAK4rC,UAAUw0B,UAAUC,GACvC,OAAOjQ,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAACqgE,IAAW9D,GAA6Bv8D,KAAM4rC,GACnG,EAEAse,EAAM8J,WAAWlyD,UAAU0+D,cAAgB,WACzC,IAAIjxD,EAAIotD,GAAYvpC,WAChB6mC,EAASj6D,KAAKs2D,gBAClB,OAAOlG,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,gBAAiB,CAACuP,IAAK0qD,EAAO9xB,SAAQ,SAAUhnC,GACnF,OAAO07D,GAAettD,EAAEpO,IAAQi/D,UAAUnG,EAC5C,IACF,EAEA/P,EAAM+L,SAASn0D,UAAU2+D,aAAe,SAAUz2C,EAAMza,GACtD,OAAO6gD,EAASpmC,EAAMuyC,GAA6Bv8D,KAAMuP,EAAEvP,KAAK4rC,YAClE,EAEAse,EAAM6K,YAAYjzD,UAAU2+D,aAAe,SAAUz2C,EAAMza,GACzD,OAAO6gD,EAASpmC,EAAMza,EAAEvP,MAC1B,EAEAkqD,EAAM8J,WAAWlyD,UAAUqD,MAAQ,SAAUA,GAC3C,OAAOnF,KAAKygE,aAAa,IAAIvW,EAAMiF,KAAKnvD,KAAM,QAAS,CAACmF,KAAS,SAAUymC,GACzE,OAAOA,EAAQzD,SAAQ,SAAUhnC,GAC/B,OAAO+oD,EAAM6T,MAAM54D,EAAOhE,EAC5B,GACF,GACF,EAEA+oD,EAAM8J,WAAWlyD,UAAU4+D,SAAW,SAAUv7D,GAC9C,OAAOnF,KAAKygE,aAAa,IAAIvW,EAAMiF,KAAKnvD,KAAM,WAAY,CAACmF,KAAS,SAAUymC,GAC5E,OAAOA,EAAQ40B,eAAc,SAAUr/D,GACrC,OAAO+oD,EAAM6T,MAAM54D,EAAOhE,EAC5B,GACF,GACF,EAEA+oD,EAAM8J,WAAWlyD,UAAU6+D,kBAAoB,SAAUx7D,GACvD,OAAOnF,KAAKygE,aAAa,IAAIvW,EAAMiF,KAAKnvD,KAAM,oBAAqB,CAACmF,KAAS,SAAUymC,GACrF,OAAOA,EAAQgxB,cAAa,SAAUz7D,GACpC,OAAO+oD,EAAMllD,KAAK7D,GAAOuO,OAAOw6C,EAAM6T,MAAM54D,GAAOmqB,QAAO,GAC5D,GACF,GACF,EAEA46B,EAAM8J,WAAWlyD,UAAUqb,OAAS,SAAUyjD,GAC5C,OAAOxQ,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,SAAU,CAAC4gE,IAAS5gE,KAAKsJ,QAAQ4gD,EAAMkV,gBAAgBwB,IAAQ,SAAUv+D,EAAK0H,GACjH,OAAOA,EAAO1H,EAChB,IACF,EAEA6nD,EAAM8J,WAAWlyD,UAAU++D,KAAO,SAAU9U,EAAMx8C,GAChD,IAEIywD,EAFAc,EAAU9gE,KAGduP,EAAIsiD,EAAatiD,GACjB,IAAIwxD,EAAMzO,EAASvG,GACfiV,GAAc,EAkDlB,OADAhB,EAAiB,IAAI/J,GAAS,IAAI/L,EAAMiF,KAAKnvD,KAAM,OAAQ,CAAC+rD,EAAMx8C,KAhDlD,SAAUk4B,GACxB,IAAIyuB,GAAW,EACXzH,EAAQrE,EACRgM,EAAQlM,EAAMqI,KACd8D,EAAW,WACb,IAAKH,EACH,OAAO6K,EAAI58C,SAAQ,SAAUhjB,GAK3B,GAJA+0D,EAAW8K,GAAc,GACzB5K,EAAQ3uB,EAAK,IAAIqrB,GAAQ,WACvB,OAAO3xD,CACT,QACc+oD,EAAM0E,OAGlB,OAFAH,IACAA,EAAQrE,CAGZ,GAEJ,EA4BA,OA3BAqE,EAAQqS,EAAQpS,WAAWC,WAAU,SAAU7+B,GAC7C,GAAIA,EAAMwjC,WAAY,CACpB,GAAI0N,GAAelxC,EAAMqjC,YACvB,OAAOjJ,EAAMqI,KAENziC,EAAMqjC,aACTkD,IAEFH,EAAW8K,GAAc,EACzB,IAAIj6C,EAAOg6C,EAAI5O,eAAUn8C,GACrB2U,EAAOpb,EAAEwX,EAAM+I,EAAM3uB,SAGzB,OADA4/D,EAAM,IAAI9O,EAAKtnC,GACR8c,EAAK3X,EAAMqD,OAAM,WACtB,OAAOxI,CACT,IAEN,CAIE,GAHImF,EAAMojC,UACRkD,EAAQC,KAEND,IAAUlM,EAAM0E,OAClB,OAAOnnB,EAAK3X,EAGlB,IACAw8B,EAAc0B,aAAagS,EAAgB3J,GACpC5H,CACT,GAGF,EAEAvE,EAAM8J,WAAWlyD,UAAUgpC,KAAO,SAAUhgC,EAAOyE,GAEjD,OADAA,EAAIsiD,EAAatiD,GACV6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,OAAQ,CAAC8K,EAAOyE,IAAKvP,KAAK6gE,KAAK,CAAC/1D,IAAQ,SAAUm2D,EAAWt2C,GAChG,MAAO,CAACA,EAAMpb,EAAE0xD,EAAU,GAAIt2C,GAChC,IAAG2E,QAAO,SAAU4xC,GAClB,OAAwB,IAAjBA,EAAMt+D,MACf,IAAGlC,KAAI,SAAUwgE,GACf,OAAOA,EAAM,EACf,IACF,EAEAhX,EAAM8J,WAAWlyD,UAAUq/D,SAAW,WACpC,IAAI5xD,EAAImhD,EAAiBt9B,WACzB,OAAOg9B,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,WAAY,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GAIhF,OAHIA,EAAMwjC,YACR/jD,EAAEugB,EAAM3uB,SAEHnB,KAAKsC,KAAKwtB,EACnB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAUs/D,MAAQ,WACjC,IAAI7xD,EAAImhD,EAAiBt9B,WACzB,OAAOg9B,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,QAAS,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GAI7E,OAHIA,EAAMojC,SACR3jD,IAEKvP,KAAKsC,KAAKwtB,EACnB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAUu/D,QAAU,WACnC,IAAI9xD,EAAImhD,EAAiBt9B,WACzB,OAAOg9B,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,UAAW,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GAI/E,OAHIA,EAAMujC,WACR9jD,EAAEugB,EAAMjsB,OAEH7D,KAAKsC,KAAKwtB,EACnB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAUwmC,MAAQ,WACjC,IAAK,IAAIg5B,EAASluC,UAAUxwB,OAAQ8T,EAAOuS,MAAMq4C,GAASC,EAAS,EAAGA,EAASD,EAAQC,IACrF7qD,EAAK6qD,GAAUnuC,UAAUmuC,GAG3B,OAAOnR,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,QAAS0W,GAAO1W,KAAKu2D,aAAY,SAAUzmC,GAI9E,MAHuB,oBAAZxd,SAAuC,OAAZA,SAA2C,mBAAhBA,QAAQ0R,KACvE1R,QAAQ0R,IAAImP,MAAM7gB,QAASoE,EAAKhH,OAAO,CAACogB,EAAM9L,SAEzChkB,KAAKsC,KAAKwtB,EACnB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAU0/D,WAAa,SAAUjyD,GAC3C,MAAQA,IACXA,GAAI,GAGN,IAAK,IAAIkyD,EAASruC,UAAUxwB,OAAQ8T,EAAOuS,MAAMw4C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1GhrD,EAAKgrD,EAAS,GAAKtuC,UAAUsuC,GAG/B,OAAOlQ,EAAsBxxD,KAAMuP,EAAGmH,GAAM,SAAUnH,GACpD,OAAO6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,aAAc,IAAKA,KAAKu2D,aAAY,SAAUzmC,GACjF,OAAIA,EAAMujC,WAAa9jD,EAAEugB,EAAMjsB,QAC7B7D,KAAKsC,KAAKwtB,GACH9vB,KAAKsC,KAAKsxD,MAEV5zD,KAAKsC,KAAKwtB,EAErB,IACF,GACF,EAEAkkC,GAAWlyD,UAAU2jC,OAAS,WAC5B,OAAO2qB,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,SAAU,IAAKA,KAAKsvB,QAAO,WAC9D,OAAO,CACT,IACF,EAEA46B,EAAM8J,WAAWlyD,UAAU6/D,KAAO,SAAU9uC,GAC1C,OAAIA,GAAS,EACJq3B,EAAMpiB,QAERsoB,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,OAAQ,CAAC6yB,IAAS7yB,KAAKu2D,aAAY,SAAUzmC,GAChF,OAAKA,EAAMwjC,aAGTzgC,EACY,EACH7yB,KAAKsC,KAAKwtB,IAEH,IAAV+C,GACF7yB,KAAKsC,KAAKwtB,GAEZ9vB,KAAKsC,KAAKsxD,KACH1J,EAAM0E,QAVR5uD,KAAKsC,KAAKwtB,EAarB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAU8/D,MAAQ,WACjC,OAAOxR,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,QAAS,IAAKA,KAAK2hE,KAAK,GAC/D,EAEAzX,EAAM8J,WAAWlyD,UAAU+/D,SAAW,WACpC,IAAItyD,EAAImhD,EAAiBt9B,WACzB,OAAOg9B,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,WAAY,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GAChF,OAAIA,EAAMujC,UACDrzD,KAAKsC,KAAKqxD,EAAUpkD,EAAEugB,EAAMjsB,SAE5B7D,KAAKsC,KAAKwtB,EAErB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAUsmC,aAAe,SAAUlkB,GAClD,IAAI8F,EAAO,IAAIkgC,EAAMiF,KAAKnvD,KAAM,eAAgB,CAACkkB,IACjD,OAAOksC,EAASpmC,EAAMhqB,KAAK6hE,UAAS,SAAUtqD,GAC5C,OAAO,IAAIzT,EAAMyT,EACnB,IAAG4wB,SAAQ,SAAUxW,GACnB,OAAIA,aAAa7tB,EACRogB,EAAGyN,EAAE9tB,OAELqmD,EAAMllD,KAAK2sB,EAEtB,IACF,EAEAu4B,EAAM6K,YAAYjzD,UAAUggE,SAAW,SAAU/V,EAAMx8C,GACrD,IAAIiB,EAAUu7C,EACd,OAAO/rD,KAAK89D,eAAc,SAAUnzC,GAClC,OAAOkyC,GAAettD,EAAEiB,EAASma,IAAOw2C,UAAS,SAAUY,GACzD,OAAOvxD,EAAUuxD,CACnB,GACF,IAAGlM,WAAW9J,EAChB,EAEA7B,EAAM6K,YAAYjzD,UAAU4vD,UAAY,SAAUsQ,EAASzH,GACzD,OAAOnK,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAACgiE,EAASzH,IAAcv6D,KAAK61D,aAAanE,UAAUsQ,EAASzH,GACjH,EAEArQ,EAAM+L,SAASn0D,UAAU4vD,UAAY,SAAUsQ,EAASzH,GACtD,IAAIxL,GAAO,EACP,MAAOwL,EACTA,EAAa1I,EAAa0I,IAE1BxL,GAAO,EACPwL,EAAa,SAAUhrD,GACrB,OAAOA,EAAEpO,OACX,GAEF,IAAI8gE,EAAa,IAAIpT,EAAO7uD,MAAM,EAAO+uD,GACrCmT,EAAgB,IAAIrT,EAAOmT,GAAS,EAAMjT,GAC1CkL,EAAS/P,EAAM3oD,KAAK,CAAC0gE,EAAYC,GAAgB3H,GACjDpwD,EAAS63D,EAAQtX,YAAcuP,EAAOpE,aAAeoE,EACzD,OAAO7J,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAACgiE,EAASzH,IAAcpwD,EAC5E,EAEA+/C,EAAM+L,SAASn0D,UAAUmb,OAAS,SAAUxP,GAC1C,OAAO2iD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,SAAU,CAACyN,IAAYzN,KAAK0xD,UAAUxH,EAAMz8C,SAASA,EAAU,CAAC,IACvG,EAEAy8C,EAAM8J,WAAWlyD,UAAUpB,IAAM,SAAUohB,GACzC,GAAIA,GAAKA,EAAE4oC,YACT,OAAO5oC,EAAE4vC,UAAU1xD,KAAMqqD,GAEzB,IAAK,IAAI8X,EAAS/uC,UAAUxwB,OAAQ8T,EAAOuS,MAAMk5C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1G1rD,EAAK0rD,EAAS,GAAKhvC,UAAUgvC,GAG/B,OAAO5Q,EAAsBxxD,KAAM8hB,EAAGpL,GAAM,SAAUnH,GACpD,OAAO6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,MAAO,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GAC3E,OAAO9vB,KAAKsC,KAAKwtB,EAAMyjC,KAAKhkD,GAC9B,IACF,GAEJ,EAEA26C,EAAM8J,WAAWlyD,UAAUgqD,KAAO,SAAUC,EAAMx8C,GAChD,OAAO6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,OAAQ,CAAC+rD,EAAMx8C,IAAKvP,KAAK6gE,KAAK9U,EAAMx8C,GAAGmiD,UAAU1xD,KAAKsvB,QAAO,GAAO4wC,SAASrK,cACpH,EAEA7B,GAAWlyD,UAAUugE,OAASrO,GAAWlyD,UAAUgqD,KAEnD,IAAIwW,GAAe,CAAC,CAAC,mBAAoB,uBAAwB,CAAC,cAAe,kBAAmB,CAAC,KAAM,OAAQ,CAAC,OAAQ,WAgD5H,SAASC,GAAYphE,GACnB,MAAO,CAACA,EAAOyyD,IACjB,CA7BA1J,EAAMsY,gBAAkB,SAAUv8C,EAAQqlB,EAAW+tB,GACnD,IAAIoJ,EApBmB,SAAUx8C,GAEjC,IADA,IAAIy8C,EACK1gE,EAAI,EAAGA,EAAIsgE,GAAa1/D,OAAQZ,IAAK,CAE5C,IAAI2gE,EAAa,CAAC18C,GADlBy8C,EAAOJ,GAAatgE,IACU,IAAKikB,EAAOy8C,EAAK,KAC/C,GAAIC,EAAW,IAAMA,EAAW,GAC9B,OAAOA,CAEX,CACA,IAAK,IAAIrhD,EAAI,EAAGA,EAAIghD,GAAa1/D,OAAQ0e,IAAK,CAE5C,IAAIshD,EAAc38C,GADlBy8C,EAAOJ,GAAahhD,IACU,IAC9B,GAAIshD,EACF,MAAO,CAACA,EAAa,WAAa,EAEtC,CACA,MAAM,IAAI9+D,EAAM,gCAAkCmiB,EACpD,CAG4B48C,CAAmB58C,GAEzC0vC,EAAM8M,EAAoB,GAC1BhU,EAAQgU,EAAoB,GAE5Bz4C,EAAO,IAAIkgC,EAAMiF,KAAKjF,EAAO,YAAa,CAACjkC,EAAQqlB,IACvD,OAAO8kB,EAASpmC,EAAMkgC,EAAM1iB,YAAW,SAAUjJ,GAE/C,OADAo3B,EAAIp/C,KAAK0P,EAAQqlB,EAAW/M,GACrB,WACL,OAAOkwB,EAAMl4C,KAAK0P,EAAQqlB,EAAW/M,EACvC,CACF,GAAG86B,GACL,EAEAnP,EAAMniB,UAAYmiB,EAAMsY,gBAExBtY,EAAM4Y,SAAW,SAAU39D,EAAO49D,GAChC,IAAI/4C,EAAO,IAAIkgC,EAAMiF,KAAKjF,EAAO,WAAY,CAAC/kD,EAAO49D,IACrD,OAAO3S,EAASpmC,EAAMkgC,EAAM1iB,YAAW,SAAUjJ,GAC/C,IAAI3nB,EAAKszC,EAAMkR,UAAU1tD,YAAY6wB,EAASp5B,GAC9C,OAAO,WACL,OAAO+kD,EAAMkR,UAAUztD,cAAciJ,EACvC,CACF,GAAGmsD,GACL,EAMA7Y,EAAMliB,YAAc,SAAU/7B,EAAS+2D,GACrC,IAAI3J,EAAmBjmC,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmBmvC,GAAcnvC,UAAU,GAErG,OAAOg9B,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,cAAe,CAACj+C,IAAWi+C,EAAM1iB,YAAW,SAAUjJ,GAC1F,IAAI0kC,EAAQh3D,EAAQkC,KAAKowB,GAAS,SAAU3xB,GAC1C,OAAO2xB,EAAQ,IAAIz6B,EAAM8I,GAC3B,IAKA,OAJIq2D,GAA+B,mBAAfA,EAAMr4C,MACxBq4C,EAAMr4C,OAGJo4C,EACK,WACL,GAA6B,mBAAlB/2D,EAAQ+2D,MACjB,OAAO/2D,EAAQ+2D,OAEnB,EAEO,WAAa,CAExB,GAAG3J,GACL,EAEAnP,EAAM8J,WAAWlyD,UAAUkvC,QAAU,SAAUkyB,GAC7C,IAAIC,EAAS/vC,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmB82B,EAAM/gC,EAAEvS,GAAKwc,UAAU,GAEtFslC,EAAU,CAAC,EACXjqD,EAAMzO,KACV,OAAOyO,EAAI6gB,QAAO,SAAUqC,GAC1B,OAAQ+mC,EAAQwK,EAAKvxC,GACvB,IAAGjxB,KAAI,SAAUixB,GACf,IAAItvB,EAAM6gE,EAAKvxC,GACXyxC,EAAU30D,EAAI6gB,QAAO,SAAUqC,GACjC,OAAOuxC,EAAKvxC,KAAOtvB,CACrB,IACI6H,EAAOggD,EAAMllD,KAAK2sB,GAAGjiB,OAAO0zD,GAC5BC,EAAUF,EAAOj5D,EAAMynB,GAAG4kC,aAAY,SAAUzmC,GAElD,GADA9vB,KAAKsC,KAAKwtB,GACNA,EAAMojC,QACR,cAAcwF,EAAQr2D,EAE1B,IAEA,OADAq2D,EAAQr2D,GAAOghE,EACRA,CACT,GACF,EAEAnZ,EAAMlf,UAAY,SAAUjhC,GAE1B,GAv2FgB,SAAUuiC,GAC1B,IAAK8K,EAAQ9K,GACX,MAAM,IAAI6d,EAAU,kBAAoB7d,EAE5C,CAk2FEg3B,CAAYv5D,GACPA,EAAOnH,OAEL,CACL,IAAIZ,EAAI,EACJi4D,EAAS,IAAIlF,GAAY,IAAI7K,EAAMiF,KAAKjF,EAAO,YAAa,CAACngD,KAAU,SAAU09B,GACnF,IAAI6mB,GAAS,EACT8H,EAAQlM,EAAMqI,KACdqC,GAAU,EACV2O,GAAa,EA0BjB,OAzBA,SAASjhE,IAEP,GADAihE,GAAa,GACT3O,EAAJ,CAIA,IADAA,GAAU,EACH2O,GAEL,GADAA,GAAa,EACTnN,IAAUlM,EAAM0E,SAAWN,EAAQ,CACrC,IAAIntD,EAAQ4I,EAAO/H,MACnBo0D,EAAQ3uB,EAAKosB,EAAQ1yD,OACP+oD,EAAM0E,SACd5sD,IAAM+H,EAAOnH,OACf6kC,EAAKmsB,KAELtH,EAAcQ,iBAAiBmN,EAAQ33D,GAG7C,CAGF,OADAsyD,GAAU,CAhBV,CAkBF,CAEAtyD,GACO,WAEL,OADAgsD,GAAS,CAEX,CACF,IACA,OAAO2L,CACT,CAvCE,OAAO7J,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,YAAangD,GAASmgD,EAAMpiB,QAwCtE,EAEAoiB,EAAM6K,YAAYjzD,UAAU0hE,SAAW,SAAUC,GAC/C,IAAIC,GAAS,EACTC,EAAiB,GACjBl1D,EAAMzO,KACN4jE,GAAa,EACjB,OAAO,IAAI7O,GAAY,IAAI7K,EAAMiF,KAAKnvD,KAAM,WAAY,CAACyjE,KAAS,SAAUh8B,GAC1E,IAAIw1B,EAAY,IAAI/I,GAChB2P,GAAa,EACbC,EAAiB,SAAUrV,GAI7B,GAHqB,mBAAVA,GACTA,IAEEwO,EAAUxR,SAAWoY,EACvB,OAAOp8B,EAAKmsB,IAEhB,EA0CA,OAzCAqJ,EAAUx6D,KAAI,SAAUm1D,EAAUuF,GAChC,OAAOsG,EAAMzO,mBAAkB,SAAUllC,GACvC,IAAIA,EAAMwjC,WAkBH,OAAIxjC,EAAMojC,QACR4Q,EAAe3G,GAEf11B,EAAK3X,GAnBZ,KADA4zC,EAAS5zC,EAAM3uB,SACF,CACX,IAAI4iE,EAASJ,EAEb,OADAA,EAAiB,GACV,WAEL,IADA,IACgBxiE,EADZgJ,EAAS,GACJnI,EAAI,EAAUA,EAAI+hE,EAAOnhE,OAAQZ,IACxCb,EAAQ4iE,EAAO/hE,GACfmI,EAAO7H,KAAKmlC,EAAKksB,EAAUxyD,KAM7B,OAJIyiE,IACFz5D,EAAO7H,KAAKmlC,EAAKmsB,MACjBuJ,KAEKhzD,CACR,CAXM,EAYT,CAMJ,GACF,IACA8yD,EAAUx6D,KAAI,SAAUm1D,EAAUuF,GAChC,OAAO1uD,EAAIumD,mBAAkB,SAAUllC,GACrC,OAAI4zC,GAAU5zC,EAAMwjC,WACXqQ,EAAerhE,KAAKwtB,EAAM3uB,SACxB2uB,EAAMojC,SAAWyQ,EAAe/gE,QACzCghE,GAAa,EACNE,EAAe3G,IAEf11B,EAAK3X,EAEhB,GACF,IACA+zC,GAAa,EACbC,IACO7G,EAAU7I,WACnB,GACF,EAEAlK,EAAMz8C,SAAW,SAAUtI,GACzB,IAAIhE,EAAQiyB,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmB,CAAC,EAAIA,UAAU,GAEjF,OAAOg9B,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,WAAY,CAAC/kD,EAAOhE,IAAS+oD,EAAM4Y,SAAS39D,GAAO,WACvF,OAAOwuD,EAAUxyD,EACnB,IACF,EAEA+oD,EAAM8Z,EAAI,CAAC,EACX9Z,EAAM8Z,EAAEC,cAAgB,SAAU34B,EAAW44B,EAAU7K,GACrD,IAAI8K,EAAUnkE,KAOd,OALImpB,EAAEyhC,WAAWsZ,KACf7K,EAAmB6K,EACnBA,OAAWluD,GAGNo6C,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAKkkE,UAAYlkE,KAAM,gBAAiB,CAACsrC,IAAa4e,EAAM1iB,YAAW,SAAUjJ,GAE9G,OADA4lC,EAAQjd,GAAG5b,EAAW44B,EAAU3lC,GACzB,WACL,OAAO4lC,EAAQhd,IAAI7b,EAAW44B,EAAU3lC,EAC1C,CACF,GAAG86B,GACL,EAEsB,oBAAX+K,QAA0BA,SACnCA,OAAOlgD,GAAG+/C,cAAgB/Z,EAAM8Z,EAAEC,eAGf,oBAAVI,OAAyBA,QAClCA,MAAMngD,GAAG+/C,cAAgB/Z,EAAM8Z,EAAEC,eAGnC/Z,EAAM8J,WAAWlyD,UAAUsH,KAAO,WAChC,IAAIk7D,EAEJ,OAAOlU,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,OAAQ,IAAKA,KAAKu2D,aAAY,SAAUzmC,GAC3E,GAAIA,EAAMojC,QAKR,OAJIoR,GACFtkE,KAAKsC,KAAKgiE,GAEZtkE,KAAKsC,KAAKsxD,KACH1J,EAAM0E,OAEb0V,EAAYx0C,CAEhB,IACF,EAEAo6B,EAAM8J,WAAWlyD,UAAUkiB,IAAM,WAC/B,IAAK,IAAIugD,EAASnxC,UAAUxwB,OAAQ8T,EAAOuS,MAAMs7C,GAASC,EAAS,EAAGA,EAASD,EAAQC,IACrF9tD,EAAK8tD,GAAUpxC,UAAUoxC,GAQ3B,OALAxkE,KAAK2uD,WAAU,SAAU7+B,GACA,oBAAZxd,SAAkD,mBAAhBA,QAAQ0R,KACnD1R,QAAQ0R,IAAImP,MAAM7gB,QAASoE,EAAKhH,OAAO,CAACogB,EAAM9L,QAElD,IACOhkB,IACT,EAEAkqD,EAAM6K,YAAYjzD,UAAU2iE,MAAQ,SAAUzS,IAjiGtB,SAAUliC,GAChC,KAAe,MAATA,EAAgBA,EAAM+/B,oBAAiB,GAC3C,MAAM,IAAI1F,EAAU,wBAA0Br6B,EAElD,CA8hGE40C,CAAkB1S,GAElB,OAAO5B,EAAS,IAAIlG,EAAMiF,KADfnvD,KAC0B,QAAS,CAACgyD,IAAS9H,EAAMya,SAAS3kE,KAAMgyD,GAC/E,EAEA9H,EAAMya,SAAW,WACf,IAAIjM,EAAUoB,GAAuB1mC,WACrC,OAAIslC,EAAQ91D,OACH,IAAImyD,GAAY,IAAI7K,EAAMiF,KAAKjF,EAAO,WAAYwO,IAAU,SAAUjxB,GAC3E,IAAI6vB,EAAO,EAqBPsN,EAAQz7C,EAAEzoB,KApBE,SAAUqsD,GACxB,OAAO,SAAU8X,GACf,OAAO9X,EAAI2B,WAAWC,WAAU,SAAU7+B,GACxC,GAAIA,EAAMojC,QAER,QADAoE,IACaoB,EAAQ91D,OACZ6kC,EAAKmsB,KAEL1J,EAAMqI,KAGf,IAAI6D,EAAQ3uB,EAAK3X,GAIjB,OAHIsmC,IAAUlM,EAAM0E,QAClBiW,IAEKzO,CAEX,GACF,CACF,GAC6BsC,GAC7B,OAAO,IAAIxO,EAAMgK,qBAAqB0Q,GAAOxQ,WAC/C,IAEOlK,EAAMpiB,OAEjB,EAEAoiB,EAAM4a,WAAa,SAAU3/D,EAAO4E,GAClC,IAAImlB,EAAQ,EACZ,OAAOkhC,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,aAAc,CAAC/kD,EAAO4E,IAAUmgD,EAAM4Y,SAAS39D,GAAO,WAC1F,OAAO4E,EAAOmlB,IAAUnlB,EAAOnH,OACjC,IACF,EAEAsnD,EAAMzS,OAAS,SAAU2E,GACvB,IAAIltB,EAAQ,EACZ,OAAOg7B,EAAM1iB,YAAW,SAAUC,GAChC,IAAItB,GAAO,EACPiwB,EAAQlM,EAAMqI,KACd9D,EAAQ,WAAa,EACzB,SAASkG,EAAY7kC,GACnB,OAAIA,EAAMojC,QACH/sB,EAGI4+B,IAFA5+B,GAAO,EAKTiwB,EAAQ3uB,EAAK3X,EAExB,CACA,SAASi1C,IACP,IAAIp6C,EAEJ,IADAwb,GAAO,EACAA,GAAQiwB,IAAUlM,EAAM0E,QAC7BjkC,EAAOyxB,EAAUltB,KACjBiX,GAAO,EACHxb,EACF8jC,EAAQ9jC,EAAKqqC,kBAAkBL,GAE/BltB,EAAKmsB,KAGT,OAAOztB,GAAO,CAChB,CAEA,OADA4+B,IACO,WACL,OAAOtW,GACT,CACF,GACF,EAEAvE,EAAM8a,MAAQ,SAAUz/D,GACtB,IAAK4jB,EAAEyhC,WAAWrlD,EAAQyV,QACxB,MAAM,IAAImvC,EAAU,wCAEtB,IAAInvC,EAASzV,EAAQyV,OACjBiqD,EAAU1/D,EAAQ0/D,SAAW,EAC7BC,EAAc,EACd//D,EAAQI,EAAQJ,OAAS,WAC3B,OAAO,CACT,EACIggE,EAAc5/D,EAAQ4/D,aAAe,WACvC,OAAO,CACT,EACIl4D,GAAW,EACXpJ,EAAQ,KAEZ,OAAOusD,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,QAAS,CAAC3kD,IAAW2kD,EAAMzS,QAAO,SAAU5kB,GAChF,SAASuyC,IACP,OAAOpqD,EAAO6X,GAAO2uC,aAAajL,aAAY,SAAUzmC,GACtD,OAAIA,EAAMujC,UAEF8R,GADNthE,EAAQisB,GACgBjsB,SAAuB,IAAZohE,GAAiBC,EAAcD,QAAlE,GACEh4D,GAAW,EACJjN,KAAKsC,KAAKwtB,KAGfA,EAAMwjC,aACRzvD,EAAQ,KACRoJ,GAAW,GAENjN,KAAKsC,KAAKwtB,GAErB,GACF,CAEA,GAAI7iB,EACF,OAAO,KACF,GAAIpJ,EAAO,CAChB,IAAI+C,EAAU,CACZ/C,MAAOA,EAAMA,MACbqhE,YAAaA,GAEXG,EAAQnb,EAAM6T,MAAM54D,EAAMyB,IAAU0oB,QAAO,GAE/C,OADA41C,IACOG,EAAM31D,OAAOw6C,EAAMllD,OAAOmjC,QAAQi9B,GAC3C,CACE,OAAOA,GAEX,IACF,EAEAlb,EAAMob,aAAe,SAAUngE,EAAO4E,GACpC,IAAImlB,EAAQ,EACZ,OAAOkhC,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,eAAgB,CAAC/kD,EAAO4E,IAAUmgD,EAAM4Y,SAAS39D,GAAO,WAC5F,IAAIhE,EAAQ4I,EAAOmlB,KACnB,OAAIA,EAAQnlB,EAAOnH,OACVzB,EACE+tB,IAAUnlB,EAAOnH,OACnB,CAACzB,EAAOyyD,KAERA,GAEX,IACF,EAEA1J,EAAM8J,WAAWlyD,UAAUyjE,KAAO,SAAU1yC,GAC1C,OAAOu9B,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,OAAQ,CAAC6yB,IAAS7yB,KAAKu2D,aAAY,SAAUzmC,GAChF,OAAKA,EAAMwjC,YAEAzgC,EAAQ,GACjBA,IACOq3B,EAAMqI,MAHNvyD,KAAKsC,KAAKwtB,EAOrB,IACF,EAEAo6B,EAAM6K,YAAYjzD,UAAU0jE,UAAY,SAAUC,GAChD,IAAIj9D,EAAUi9D,EAAQ9D,KAAK,GAAGjhE,KAAI,GAAMm1D,YAAW,GACnD,OAAOzF,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAACylE,IAAWzlE,KAAKsvB,OAAO9mB,GAC5E,EAEA0hD,EAAM6K,YAAYjzD,UAAU4jE,UAAY,SAAUn2D,GAChDi7C,EAA2Bj7C,GAG3B,IAFA,IAAIo2D,GAAK,EAEAC,EAASxyC,UAAUxwB,OAAQ8T,EAAOuS,MAAM28C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1GnvD,EAAKmvD,EAAS,GAAKzyC,UAAUyyC,GAG/B,OAAOrU,EAAsBxxD,KAAMuP,EAAGmH,GAAM,SAAUnH,GACpD,OAAO6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GACjF,OAAI61C,GAAO71C,EAAMwjC,YAAe/jD,EAAEugB,EAAM3uB,SAM/B+oD,EAAMqI,MALTziC,EAAMwjC,aACRqS,GAAK,GAEA3lE,KAAKsC,KAAKwtB,GAIrB,IACF,GACF,EAEAo6B,EAAM8J,WAAWlyD,UAAUgkE,cAAgB,SAAU5zD,GACnD,IAAI6zD,EAAY3yC,UAAUxwB,QAAU,QAAsBoT,IAAjBod,UAAU,GAAmB,EAAIA,UAAU,GAEpF,OAAOg9B,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,gBAAiB,CAACkS,EAAG6zD,IAAa/lE,KAAK6gE,KAAK,IAAI,SAAUt3D,EAAQpI,GACrG,OAAOoI,EAAOmG,OAAO,CAACvO,IAAQ8B,OAAOiP,EACvC,IAAGod,QAAO,SAAUvlB,GAClB,OAAOA,EAAOnH,QAAUmjE,CAC1B,IACF,EAEA,IAAIC,GAAQ,GACRjS,EAAc,SAAUhH,GAC1B,GAAIiZ,GAAMpjE,SACHmxD,EAAY5kD,QACf,IACE4kD,EAAY5kD,SAAU,EACtB62D,GAAM7hD,SAAQ,SAAU8hD,GACtBA,EAAIlZ,EACN,GAGF,CAFE,eACOgH,EAAY5kD,OACrB,CAGN,EAkJA,SAAS+2D,GAAaC,GACpBnmE,KAAKmmE,WAAaA,CACpB,CAlJAjc,EAAM+b,IAAM,SAAUA,GACpB,OAAOD,GAAM1jE,KAAK2jE,EACpB,EAEA/b,EAAM+L,SAASn0D,UAAUskE,UAAY,SAAUra,GAC7C,OAAOqE,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAAC+rD,IAAQ/rD,KAAK6gE,KAAK9U,GAAM,SAAUhlC,EAAM4D,GACzF,OAAOA,CACT,IACF,EAEAu/B,EAAM6K,YAAYjzD,UAAUskE,UAAY,SAAUra,GAChD,OAAOqE,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAAC+rD,IAAQ7B,EAAMllD,KAAK+mD,GAAMr8C,OAAO1P,MACrF,EAEAkqD,EAAM8J,WAAWlyD,UAAUukE,UAAY,SAAU92D,GAC/Ci7C,EAA2Bj7C,GAE3B,IAAK,IAAI+2D,EAASlzC,UAAUxwB,OAAQ8T,EAAOuS,MAAMq9C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC1G7vD,EAAK6vD,EAAS,GAAKnzC,UAAUmzC,GAG/B,OAAO/U,EAAsBxxD,KAAMuP,EAAGmH,GAAM,SAAUnH,GACpD,OAAO6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,YAAa,CAACuP,IAAKvP,KAAKu2D,aAAY,SAAUzmC,GACjF,OAAIA,EAAMR,OAAO/f,GACRvP,KAAKsC,KAAKwtB,IAEjB9vB,KAAKsC,KAAKsxD,KACH1J,EAAM0E,OAEjB,IACF,GACF,EAEA1E,EAAM8J,WAAWlyD,UAAU0kE,SAAW,SAAUrhE,GAC9C,OAAOnF,KAAKygE,aAAa,IAAIvW,EAAMiF,KAAKnvD,KAAM,WAAY,CAACmF,KAAS,SAAUymC,GAC5E,OAAOA,EAAQ0vB,eAAen2D,GAAOzE,KAAI,SAAUqJ,GACjD,OAAOA,EAAOA,EAAOnH,OAAS,EAChC,GACF,GACF,EAEAoxD,GAAWlyD,UAAU2kE,eAAiB,SAAUC,GAC9C,IAAIC,EAAU3mE,KAEd,GAA0B,mBAAf0mE,EAA2B,CACpC,GAAuB,mBAAZvmE,QAGT,MAAM,IAAIgqD,EAAU,sDAFpBuc,EAAavmE,OAIjB,CAEA,OAAO,IAAIumE,GAAW,SAAUtmE,EAASmE,GACvC,OAAOoiE,EAAQhY,WAAU,SAAU7+B,GAQjC,OAPIA,EAAMwjC,YACRlzD,EAAQ0vB,EAAM3uB,SAEZ2uB,EAAMujC,WACR9uD,EAAOurB,EAAMjsB,OAGRqmD,EAAM0E,MACf,GACF,GACF,EAEAoF,GAAWlyD,UAAU8kE,UAAY,SAAUF,GACzC,OAAO1mE,KAAKoJ,OAAOq9D,eAAeC,EACpC,EAEAxc,EAAW,IAAI,SAAU36C,GACvB,OAAO,SAAUpO,GACf,IACE,OAAO+oD,EAAMllD,KAAKuK,EAAEpO,GAGtB,CAFE,MAAOyL,GACP,OAAO,IAAIs9C,EAAMpmD,MAAM8I,EACzB,CACF,CACF,EAEAs9C,EAAMrjD,OAAS,SAAUggE,GACvB,SAASC,EAAcv3D,GACrB,OAAO,WACL,IAAK,IAAIw3D,EAAS3zC,UAAUxwB,OAAQ8T,EAAOuS,MAAM89C,GAASC,EAAS,EAAGA,EAASD,EAAQC,IACrFtwD,EAAKswD,GAAU5zC,UAAU4zC,GAG3B,OAAO,SAAUhlE,GACf,OAAOuN,EAAE4jB,WAAMnd,EAAW,CAAChU,GAAG0N,OAAOgH,GACvC,CACF,CACF,CAEA,IAAK,IAAIuwD,EAAS7zC,UAAUxwB,OAAQ+zD,EAAW1tC,MAAMg+C,EAAS,EAAIA,EAAS,EAAI,GAAIC,EAAS,EAAGA,EAASD,EAAQC,IAC9GvQ,EAASuQ,EAAS,GAAK9zC,UAAU8zC,GAInC,IADA,IAAIllE,EAAI20D,EAAS/zD,OAAS,EACnBZ,EAAI,GACH20D,EAAS30D,aAAcmlE,WAC3BxQ,EAAS30D,GAAKmnB,EAAEoiC,OAAOoL,EAAS30D,KAElC20D,EAAS30D,GAAK8kE,EAAcnQ,EAAS30D,IACrCA,GAAQ,EAEV,OAAOouD,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,SAAU,CAAC2c,GAASn3D,OAAOinD,IAAYzM,EAAM3oD,KAAK4xB,MAAM+2B,EAAOyM,GAAUkK,KAAKgG,GAAS,SAAUl1C,EAAGpiB,GACxI,OAAOA,EAAEoiB,EACX,IACF,EAEAu4B,EAAMkd,WAAa,WACjB,IAAK,IAAIC,EAASj0C,UAAUxwB,OAAQ8T,EAAOuS,MAAMo+C,GAASC,EAAS,EAAGA,EAASD,EAAQC,IACrF5wD,EAAK4wD,GAAUl0C,UAAUk0C,GAG3B,IAAI5O,EAAUoB,GAAuBpjD,GACrC,OAAO05C,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,aAAcwO,GAAUxO,EAAMqd,QAAQ7O,GAAS,WACnF,IAAK,IAAI8O,EAASp0C,UAAUxwB,OAAQ0pC,EAAKrjB,MAAMu+C,GAASC,EAAS,EAAGA,EAASD,EAAQC,IACnFn7B,EAAGm7B,GAAUr0C,UAAUq0C,GAGzB,OAAOn7B,CACT,IACF,EAEA4d,EAAMqd,QAAU,WACd,IAAK,IAAIG,EAASt0C,UAAUxwB,OAAQ8T,EAAOuS,MAAMy+C,GAASC,EAAS,EAAGA,EAASD,EAAQC,IACrFjxD,EAAKixD,GAAUv0C,UAAUu0C,GAG3B,IAAIC,EAAyB7N,GAAkCrjD,GAC3DgiD,EAAUkP,EAAuB,GACjCr4D,EAAIq4D,EAAuB,GAK/B,OAHAlP,EAAUvvC,EAAEzoB,KAAI,SAAUuY,GACxB,OAAOA,EAAEq9C,eACX,GAAGoC,GACItI,EAAS,IAAIlG,EAAMiF,KAAKjF,EAAO,UAAW,CAAC36C,GAAGG,OAAOgpD,IAAWxO,EAAM3oD,KAAKm3D,EAASnpD,GAC7F,EAEA26C,EAAM8J,WAAWlyD,UAAU+lE,IAAM,SAAUvN,EAAO/qD,GAChD,OAAO6gD,EAAS,IAAIlG,EAAMiF,KAAKnvD,KAAM,MAAO,CAACs6D,IAASpQ,EAAMqd,QAAQ,CAACvnE,KAAMs6D,GAAQ/qD,GAAK0Z,OAC1F,EAMAi9C,GAAapkE,UAAU6sD,UAAY,SAAUmZ,EAAkB71D,EAAS81D,GACtE,IAAIC,EAAuC,mBAArBF,EAAkC,CAAEn9C,KAAMm9C,EAAkBjkE,MAAOoO,EAASg2D,SAAUF,GAAeD,EACvH1S,EAAe,CACjB8S,QAAQ,EACR9T,YAAa,WACXgB,EAAa8S,QAAS,EACtBC,GACF,GAGEA,EAASnoE,KAAKmmE,WAAWxX,WAAU,SAAU7+B,GAC3CA,EAAMujC,WACJ2U,EAASnkE,OAAOmkE,EAASnkE,MAAMisB,EAAMjsB,OACzCuxD,EAAahB,eACJtkC,EAAMojC,SACfkC,EAAa8S,QAAS,EAClBF,EAASC,UAAUD,EAASC,YACvBD,EAASr9C,MAClBq9C,EAASr9C,KAAKmF,EAAM3uB,QAExB,IACA,OAAOi0D,CACT,EAEA8Q,GAAapkE,UAAUupD,EAAO,eAAiB,WAC7C,OAAOrrD,IACT,EAEAkqD,EAAM8J,WAAWlyD,UAAUsmE,eAAiB,WAC1C,OAAO,IAAIlC,GAAalmE,KAC1B,EAEAkqD,EAAM8J,WAAWlyD,UAAUupD,EAAO,eAAiBnB,EAAM8J,WAAWlyD,UAAUsmE,eAE9Ele,EAAMme,iBAAmB,SAAUnyD,GACjC,IAAIiwD,EAEFA,EADEjwD,EAAYm1C,EAAO,eACRn1C,EAAYm1C,EAAO,iBAEnBn1C,EAGf,IAAI8T,EAAO,IAAIkgC,EAAMiF,KAAKjF,EAAO,mBAAoB,CAACic,IACtD,OAAO,IAAIjc,EAAM6K,YAAY/qC,GAAM,SAAUyd,GAC3C,IAAI0gC,EAAShC,EAAWxX,UAAU,CAChC9qD,MAAO,WACL4jC,EAAK,IAAIyiB,EAAMpmD,OACf2jC,EAAK,IAAIyiB,EAAM6I,IACjB,EACApoC,KAAM,SAAUxpB,GACdsmC,EAAK,IAAIyiB,EAAMviB,KAAKxmC,GAAO,GAC7B,EACA8mE,SAAU,WACRxgC,EAAK,IAAIyiB,EAAM6I,IACjB,IAGF,OAAIoV,EAAO/T,YACF,WACL+T,EAAO/T,aACT,EAEO+T,CAEX,GACF,EAEgD,OAAX,QAAiC,MAAd,aAGrD,KAFU,EAAF,WACP,OAAOje,CACR,UAFM,OAEN,aACG,MAAOlqD,OACTA,KAAKkqD,MAAQA,IAEsC,OAAXtkD,GAAqC,MAAlBA,EAAO1E,SACpE0E,EAAO1E,QAAUgpD,EACjBA,EAAMA,MAAQA,GAEZlqD,KAAKkqD,MAAQA,CAEhB,GAAE3zC,KAAKvW,K,8DC3/GO,IASR,SAAkBuO,GACvB,MAAO,CACLtO,GAAGwlB,GACM,IAAItlB,SAAQ,SAAUC,EAASmE,GACpC,MAAM+yB,EAAS,IAAIC,WAOnB,OANAD,EAAO1oB,OAAS,WACdxO,EAAQk3B,EAAOntB,OACjB,EACAmtB,EAAOzoB,QAAU,WACftK,EAAO,IAAIT,MAAM,4BACnB,EACQ2hB,GACN,IAAK,cACH6R,EAAOgxC,kBAAkB/5D,GACzB,MACF,IAAK,OACH+oB,EAAOE,WAAWjpB,GAGxB,IAGN,C,kCC9BA,IAAIsc,EAAmB7qB,MAAQA,KAAK6qB,iBAAoB,SAAUC,GAC9D,OAAQA,GAAOA,EAAIZ,WAAcY,EAAM,CAAE,QAAWA,EACxD,EACA9pB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ4tB,OAAS5tB,EAAQ6I,OAAS7I,EAAQR,IAAMQ,EAAQq8B,UAAO,EAE/D,IAAIgrC,EAAgB19C,EAAgB,EAAQ,MAC5C3pB,EAAQq8B,KAAOgrC,EAAc1iE,QAC7B,IAAI2iE,EAAe39C,EAAgB,EAAQ,MAC3C3pB,EAAQR,IAAM8nE,EAAa3iE,QAC3B,IAAI4iE,EAAkB59C,EAAgB,EAAQ,MAC9C3pB,EAAQ6I,OAAS0+D,EAAgB5iE,QACjC,IAAI6iE,EAAkB79C,EAAgB,EAAQ,MAC9C3pB,EAAQ4tB,OAAS45C,EAAgB7iE,O,kCCdjC,sLAQO,SAAS8iE,EAAM1yD,EAAelW,GACnC,IAAKA,EAAU,MAAO,OACtB,IAAI6oE,EAAS,EAEb,OADA7oE,EAAS8R,OAAO,EAAGoE,GACXxC,GAAe1T,EAAS8R,SAAS+2D,EAAQ3yD,EAAOxC,EAC1D,CAKOvT,eAAe2oE,EACpB9oE,EACAkM,GAEA,IAAKlM,EAAU,OAAOkM,EACtB,MAAM/B,QAAa/J,QAAQC,QAAQ6L,GAOnC,OAEF,SAAuB/B,GACrB,OAAOA,GAAQA,EAAKwT,UACtB,CAVMorD,CAAc5+D,GAIhBnK,EAAS8R,OAAO,EAAG,IAHnB9R,EAASqW,UAAY,IACrBrW,EAAS8R,OAAO3H,EAAKwT,WAAYxT,EAAKwT,aAIjCxT,CACT,CASO,SAAS6+D,EACdhpE,EACAwP,GAEA,IAAIiB,EAAU,EACVyF,EAAQ,EACZ,OAAO/V,kBAA8BwW,GACnC3W,EAAS8R,OAAOrB,IAAWyF,GAC3B,MAAMiwC,QAAY32C,EAAE4jB,MAAMnzB,KAAM0W,GAEhC,OADA3W,EAAS8R,SAASrB,EAASyF,GACpBiwC,CACT,CACF,CAEO,SAAS9gC,EAAKqL,EAAgBgP,GACnC,OAAOhP,EAAKxgB,OAAM,IAAMwvB,EAAG5tB,OAAO4e,EAAKjgB,QAAUigB,EAAKxa,MAAQwa,EAAKhd,QACrE,CAKO,SAAS07B,EAAalpB,GAC3B,MAAM+oC,EAAoB,GAC1B,IAAIx+C,EACA4jD,EAAmC,KACvC,SAASvtD,IACH2J,GACFyV,EAAOpU,OAAOrB,EAAQA,QAAUA,EAAQyF,MAAQzF,EAAQiD,OAEtDu7C,EAAMpsD,OAAS,KAAO4N,GAAWA,EAAQzQ,UAAa,IAI5D,SAAcA,GACZ,GAAIyQ,IAAYzQ,EACd,OAEEq0D,IACFA,IACAA,EAAc,MAEhB5jD,EAAUzQ,EACNyQ,IACF4jD,EAAc5jD,EAAQP,MAAMpJ,GAEhC,CAfIue,CAAK4pC,EAAMxnD,QAEf,CAcA,MAAO,CACL/E,IAAI1C,GACFivD,EAAM1sD,KAAKvC,GACX8G,GACF,EAEJ,C,kCC/BA,IAAI+iB,EAAmB5pB,MAAQA,KAAK4pB,kBAAqB5oB,OAAO6oB,OAAS,SAAUpS,EAAGqS,EAAGvI,EAAGwI,QAC7E/T,IAAP+T,IAAkBA,EAAKxI,GAC3B,IAAIyI,EAAOhpB,OAAOipB,yBAAyBH,EAAGvI,GACzCyI,KAAS,QAASA,GAAQF,EAAEI,WAAaF,EAAKG,UAAYH,EAAKI,gBAClEJ,EAAO,CAAEK,YAAY,EAAMpoB,IAAK,WAAa,OAAO6nB,EAAEvI,EAAI,IAE5DvgB,OAAOC,eAAewW,EAAGsS,EAAIC,EAChC,EAAI,SAAUvS,EAAGqS,EAAGvI,EAAGwI,QACT/T,IAAP+T,IAAkBA,EAAKxI,GAC3B9J,EAAEsS,GAAMD,EAAEvI,EACb,GACGsY,EAAsB75B,MAAQA,KAAK65B,qBAAwB74B,OAAO6oB,OAAS,SAAUpS,EAAGqL,GACxF9hB,OAAOC,eAAewW,EAAG,UAAW,CAAE4S,YAAY,EAAMlpB,MAAO2hB,GAClE,EAAI,SAASrL,EAAGqL,GACbrL,EAAW,QAAIqL,CACnB,GACIgX,EAAgB95B,MAAQA,KAAK85B,cAAiB,SAAUhP,GACxD,GAAIA,GAAOA,EAAIZ,WAAY,OAAOY,EAClC,IAAI3gB,EAAS,CAAC,EACd,GAAW,MAAP2gB,EAAa,IAAK,IAAIvJ,KAAKuJ,EAAe,YAANvJ,GAAmBvgB,OAAOc,UAAUyoB,eAAehU,KAAKuU,EAAKvJ,IAAIqI,EAAgBzf,EAAQ2gB,EAAKvJ,GAEtI,OADAsY,EAAmB1vB,EAAQ2gB,GACpB3gB,CACX,EACImgB,EAAgBtqB,MAAQA,KAAKsqB,cAAiB,SAASR,EAAG5oB,GAC1D,IAAK,IAAI4gB,KAAKgI,EAAa,YAANhI,GAAoB9gB,OAAOc,UAAUyoB,eAAehU,KAAKrV,EAAS4gB,IAAI8H,EAAgB1oB,EAAS4oB,EAAGhI,EAC3H,EACA9gB,OAAOC,eAAeC,EAAS,aAAc,CAAEC,OAAO,IACtDD,EAAQ08C,SAAW18C,EAAQy8C,YAAS,EACpC,IAAIA,EAAS7jB,EAAa,EAAQ,MAClC54B,EAAQy8C,OAASA,EACjB,IAAIC,EAAW9jB,EAAa,EAAQ,MACpC54B,EAAQ08C,SAAWA,EACnBtzB,EAAa,EAAQ,KAAmBppB,GACxCopB,EAAa,EAAQ,IAAgBppB,GACrCopB,EAAa,EAAQ,KAAkBppB,GACvCopB,EAAa,EAAQ,KAAkBppB,GACvCopB,EAAa,EAAQ,IAAgBppB,GACrCopB,EAAa,EAAQ,KAAsBppB,GAC3CopB,EAAa,EAAQ,KAAYppB,GACjCopB,EAAa,EAAQ,KAAappB,GAClCopB,EAAa,EAAQ,KAAgBppB,GACrCopB,EAAa,EAAQ,KAAgBppB,GACrCopB,EAAa,EAAQ,KAAkBppB,GACvCopB,EAAa,EAAQ,KAAcppB,E,sBCxGnC0E,EAAO1E,QAAU,IAA0B,4C,mCCA3C,uDAEe,SAAS8nE,EAAU/9D,GAChC,OAAO,SAAUyrB,GACf,MAAM6H,EAAU,KAAM,EAGtB,OAFA,IAAEh1B,QAAQ29C,GAAG,aAAc3oB,GAU/B,SAAoBtzB,EAASyrB,GAC3B,MAAM,KAAE/Y,EAAI,QAAE8nC,GAAYx6C,GACpB,MAAE+H,EAAK,OAAE+wB,GAAWpmB,EAG1B,SAASsrD,IACPvyC,EAAU5xB,oBAAoB,aAAcmkE,GAC5CvyC,EAAU3xB,iBAAiB,eAAgB6H,IACzCA,EAAEE,gBAAgB,GAEtB,CAKA,SAASo8D,IACP,MAAM1zB,EAAQhwC,KAAKwD,IACjBO,OAAO4/D,WAAan2D,EACpBzJ,OAAO6/D,YAAcrlC,GAEvBpmB,EAAK5K,MAAMC,MAAQxN,KAAKgO,MAAMR,EAAQwiC,GAAS,KAC/C73B,EAAK5K,MAAMgxB,OAASv+B,KAAKgO,MAAMuwB,EAASyR,GAAS,KACjDiQ,EAAQ1yC,MAAMC,MAAQxN,KAAKgO,MAAMR,EAAQwiC,GAAS,KAClDiQ,EAAQ1yC,MAAMgxB,OAASv+B,KAAKgO,MAAMuwB,EAASyR,GAAS,KACpD,MAAM6zB,GAAW9/D,OAAO6/D,YAAcrlC,EAASyR,GAAS,EACxDiQ,EAAQ1yC,MAAMu2D,UAAY9jE,KAAKgO,MAAM61D,GAAW,IAClD,CAvBA3yC,EAAU5hB,YAAY2wC,GACtB/uB,EAAU3xB,iBAAiB,aAAckkE,GAQzCC,IACA,IAAE3/D,QAAQ29C,GAAG,SAAUgiB,EAgBzB,CAtCIK,CAAWt+D,EAASyrB,GACb,CACLP,WACE,IAAE5sB,QAAQ49C,IAAI,aAAc5oB,EAC9B,EAEJ,CACF,C,sBCZA,IAAI3N,EAAU,EAAQ,KAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAAChrB,EAAO5D,EAAI4uB,EAAS,MAOhE,IAAIrrB,EAAU,CAAC,KAAM,EAErBA,UAPIsrB,UAQJtrB,gBAAqByQ,GAER,EAAQ,EAAR,CAAsH4a,EAASrrB,GAEzIqrB,EAAQE,SAAQlrB,EAAO1E,QAAU0vB,EAAQE,O,sBCjB5C,IAAI5O,EAAS,EAAQ,IACXtc,EAAO1E,QAAU,EAAQ,EAAR,EAA8H,IAKjJoB,KAAK,CAACsD,EAAO5D,EAAI,yDAA6DkgB,EAAO,EAAQ,MAAgC,8sHAA+sH,I,sBCLp1H,IAAI0O,EAAU,EAAQ,KAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAAChrB,EAAO5D,EAAI4uB,EAAS,MAOhE,IAAIrrB,EAAU,CAAC,KAAM,EAErBA,UAPIsrB,UAQJtrB,gBAAqByQ,GAER,EAAQ,EAAR,CAAsH4a,EAASrrB,GAEzIqrB,EAAQE,SAAQlrB,EAAO1E,QAAU0vB,EAAQE,O,uBCjBlClrB,EAAO1E,QAAU,EAAQ,EAAR,EAA8H,IAKjJoB,KAAK,CAACsD,EAAO5D,EAAI,+UAAkV,I,sBCJ3W,IAAI4uB,EAAU,EAAQ,KAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAAChrB,EAAO5D,EAAI4uB,EAAS,MAOhE,IAAIrrB,EAAU,CAAC,KAAM,EAErBA,UAPIsrB,UAQJtrB,gBAAqByQ,GAER,EAAQ,EAAR,CAAsH4a,EAASrrB,GAEzIqrB,EAAQE,SAAQlrB,EAAO1E,QAAU0vB,EAAQE,O,uBCjBlClrB,EAAO1E,QAAU,EAAQ,EAAR,EAA8H,IAKjJoB,KAAK,CAACsD,EAAO5D,EAAI,iNAAoN,I,sBCJ7O,IAAI4uB,EAAU,EAAQ,KAEA,iBAAZA,IAAsBA,EAAU,CAAC,CAAChrB,EAAO5D,EAAI4uB,EAAS,MAOhE,IAAIrrB,EAAU,CAAC,KAAM,EAErBA,UAPIsrB,UAQJtrB,gBAAqByQ,GAER,EAAQ,EAAR,CAAsH4a,EAASrrB,GAEzIqrB,EAAQE,SAAQlrB,EAAO1E,QAAU0vB,EAAQE,O,uBCjBlClrB,EAAO1E,QAAU,EAAQ,EAAR,EAA8H,IAKjJoB,KAAK,CAACsD,EAAO5D,EAAI,khBAAqhB,I,kCCL9iB,8BAuDe,IA5CR,SACLnC,GACA,cAAE2pE,EAAgB,KAAM,IAAuB,IAAhBhkE,KAAKE,WAAoB,CAAC,GAEzD,MAAO,CACLxF,SAASulB,EAAM1lB,GACb,IAAI0pE,GAAe,EACnB,IAAK,IAAIznE,EAAI,GAAKA,IAChB,IACE,aASK,IAAI7B,SAAQ,CAACC,EAASmE,KAC3B,MAAMmlE,EAAK,IAAIC,eACfD,EAAG1kD,KAAK,MAAOnlB,GAAK,GACpB6pE,EAAGE,aAAenkD,EAClBikD,EAAG96D,OAAS,KACS,MAAd86D,EAAG35D,OACN3P,EAAQspE,EAAGG,WAEQ,MAAdH,EAAG35D,QAAiC,MAAd25D,EAAG35D,SAC5B05D,GAAe,GAEjBllE,EAAO,IAAIT,MAAM,sBAAsBjE,WAAa6pE,EAAG35D,W,EAG3D25D,EAAG76D,QAAU,IAAMtK,EAAO,IAAIT,MAAM,sBAAsBjE,MACtDE,IACFA,EAASqW,UAAY,IACrBszD,EAAGI,WAAcl9D,GAAM7M,EAAS8R,OAAOjF,EAAEg8D,OAAQh8D,EAAEqJ,QAErDyzD,EAAG95B,KAAK,KAAK,G,CA3Bb,MAAO/rC,GAEP,GADAyO,QAAQzO,MAAM,sBAAsBhE,cAAgBmC,KAAM6B,GACtD7B,GAAK,GAAKynE,EAAc,MAAM5lE,EAClC,MAAMkmE,EAASP,UACT,IAAMO,E,CA0BlB,EAEJ,C,kCCrDe,IAAAx4D,SAASy4D,cAAc,c","file":"build/game-ae640be6156d4d9e8e48.js","sourcesContent":["import Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\nimport { basename } from 'path'\nimport { IResource, IResources } from './types'\n\nexport class URLResource implements IResource {\n  constructor(private url: string) {}\n  read(progress: Progress) {\n    return download(this.url).as('arraybuffer', progress)\n  }\n\n  async resolveUrl() {\n    return Promise.resolve(this.url)\n  }\n\n  get name() {\n    return basename(this.url)\n  }\n}\n\nexport class URLResources implements IResources {\n  constructor(public base: URL) {}\n  async file(name: string): Promise<IResource> {\n    const path = name\n      .split('/')\n      .map((part) => encodeURIComponent(part))\n      .join('/')\n    return new URLResource(new URL(path, this.base).href)\n  }\n}\n\nexport default URLResource\n","// !! avoid external dependencies since this is used in boot script!\n\nimport { Progress } from './Progress'\nexport default Progress\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.match = void 0;\nfunction match(text) {\n    var matched = false;\n    return {\n        when: function (pattern, callback) {\n            if (matched)\n                return this;\n            var match = text.match(pattern);\n            if (match) {\n                matched = true;\n                callback(match);\n            }\n            return this;\n        },\n        else: function (callback) {\n            if (matched)\n                return this;\n            callback();\n        },\n    };\n}\nexports.match = match;\n//# sourceMappingURL=match.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSHeaders = void 0;\n/**\n * A BMSHeader holds the header information in a BMS file, such as\n * `#TITLE`, `#ARTIST`, or `#BPM`.\n *\n * You get retrieve a header using the `get()` method:\n *\n * ```js\n * chart.headers.get('title')\n * ```\n *\n * For some header fields that may contain multiple values, such as `#SUBTITLE`,\n * you can get them all using `getAll()`:\n *\n * ```js\n * chart.headers.getAll()\n * ```\n */\nvar BMSHeaders = /** @class */ (function () {\n    function BMSHeaders() {\n        this._data = {};\n        this._dataAll = {};\n    }\n    /**\n     * Iterates through each header field using a callback function.\n     * @param callback will be called for each header field\n     */\n    BMSHeaders.prototype.each = function (callback) {\n        for (var i in this._data) {\n            callback(i, this._data[i]);\n        }\n    };\n    /**\n     * Retrieves the header fields latest value.\n     * @param name fields name\n     * @return the fields latest value\n     */\n    BMSHeaders.prototype.get = function (name) {\n        return this._data[name.toLowerCase()];\n    };\n    /**\n     * Retrieves the header fields values.\n     * This is useful when a header field is specified multiple times.\n     * @param name fields name\n     */\n    BMSHeaders.prototype.getAll = function (name) {\n        return this._dataAll[name.toLowerCase()];\n    };\n    /**\n     * Sets the header fields value.\n     * @param name fields name\n     * @param value fields value\n     */\n    BMSHeaders.prototype.set = function (name, value) {\n        var key = name.toLowerCase();\n        this._data[key] = value;\n        (this._dataAll[key] || (this._dataAll[key] = [])).push(value);\n    };\n    return BMSHeaders;\n}());\nexports.BMSHeaders = BMSHeaders;\n//# sourceMappingURL=headers.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSObjects = void 0;\n/**\n * BMSObjects holds a collection of objects inside a BMS notechart.\n */\nvar BMSObjects = /** @class */ (function () {\n    function BMSObjects() {\n        this._objects = [];\n    }\n    /**\n     * Adds a new object to this collection.\n     * If an object already exists on the same channel and position,\n     * the object is replaced (except for autokeysound tracks).\n     * @param object the object to add\n     */\n    BMSObjects.prototype.add = function (object) {\n        if (object.channel !== '01') {\n            for (var i = 0; i < this._objects.length; i++) {\n                var test = this._objects[i];\n                if (test.channel === object.channel &&\n                    test.measure === object.measure &&\n                    test.fraction === object.fraction) {\n                    this._objects[i] = object;\n                    return;\n                }\n            }\n        }\n        this._objects.push(object);\n    };\n    /**\n     * Returns an array of all objects.\n     */\n    BMSObjects.prototype.all = function () {\n        return this._objects.slice();\n    };\n    /**\n     * Returns a sorted array of all objects.\n     */\n    BMSObjects.prototype.allSorted = function () {\n        var list = this.all();\n        list.sort(function (a, b) {\n            return a.measure + a.fraction - (b.measure + b.fraction);\n        });\n        return list;\n    };\n    return BMSObjects;\n}());\nexports.BMSObjects = BMSObjects;\n//# sourceMappingURL=objects.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TimeSignatures = void 0;\n/**\n * A TimeSignatures is a collection of time signature values\n * index by measure number.\n *\n * The measure number starts from 0.\n * By default, each measure has a measure size of 1\n * (which represents the common 4/4 time signature)\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #00102:0.75\n * #00103:1.25\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can access the {TimeSignatures} object:\n *\n * ```js\n * var timeSignatures = bmsChart.timeSignatures\n * ```\n *\n * Note that you can also use the constructor\n * to create a {TimeSignatures} from scratch.\n *\n * One of the most useful use case of this class\n * is to convert the measure and fraction into beat number.\n *\n * ```js\n * timeSignatures.measureToBeat(0, 0.000) // =>  0.0\n * timeSignatures.measureToBeat(0, 0.500) // =>  2.0\n * timeSignatures.measureToBeat(1, 0.000) // =>  4.0\n * timeSignatures.measureToBeat(1, 0.500) // =>  5.5\n * timeSignatures.measureToBeat(2, 0.000) // =>  7.0\n * timeSignatures.measureToBeat(2, 0.500) // =>  9.5\n * timeSignatures.measureToBeat(3, 0.000) // => 12.0\n * ```\n */\nvar TimeSignatures = /** @class */ (function () {\n    function TimeSignatures() {\n        this._values = {};\n    }\n    /**\n     * Sets the size of a specified measure.\n     * @param measure the measure number, starting from 0\n     * @param value the measure size.\n     *  For example, a size of 1.0 represents a common 4/4 time signature,\n     *  whereas a size of 0.75 represents the 3/4 or 6/8 time signature.\n     */\n    TimeSignatures.prototype.set = function (measure, value) {\n        this._values[measure] = value;\n    };\n    /**\n     * Retrieves the size of a specified measure.\n     * @param measure representing the measure number.\n     * @returns the size of the measure.\n     *  By default, a measure has a size of 1.\n     */\n    TimeSignatures.prototype.get = function (measure) {\n        return this._values[measure] || 1;\n    };\n    /**\n     * Retrieves the number of beats in a specified measure.\n     *\n     * Since one beat is equivalent to a quarter note in 4/4 time signature,\n     * this is equivalent to `(timeSignatures.get(measure) * 4)`.\n     * @param measure representing the measure number.\n     * @returns the size of the measure in beats.\n     */\n    TimeSignatures.prototype.getBeats = function (measure) {\n        return this.get(measure) * 4;\n    };\n    /**\n     * Converts a measure number and a fraction inside that measure\n     * into the beat number.\n     *\n     * @param measure the measure number.\n     * @param fraction the fraction of a measure,\n     * @returns the number of beats since measure 0.\n     */\n    TimeSignatures.prototype.measureToBeat = function (measure, fraction) {\n        var sum = 0;\n        for (var i = 0; i < measure; i++)\n            sum += this.getBeats(i);\n        return sum + this.getBeats(measure) * fraction;\n    };\n    return TimeSignatures;\n}());\nexports.TimeSignatures = TimeSignatures;\n//# sourceMappingURL=index.js.map","'use strict';\n\n// From https://github.com/sindresorhus/random-int/blob/c37741b56f76b9160b0b63dae4e9c64875128146/index.js#L13-L15\nconst randomInteger = (minimum, maximum) => Math.floor((Math.random() * (maximum - minimum + 1)) + minimum);\n\nconst createAbortError = () => {\n\tconst error = new Error('Delay aborted');\n\terror.name = 'AbortError';\n\treturn error;\n};\n\nconst createDelay = ({clearTimeout: defaultClear, setTimeout: set, willResolve}) => (ms, {value, signal} = {}) => {\n\tif (signal && signal.aborted) {\n\t\treturn Promise.reject(createAbortError());\n\t}\n\n\tlet timeoutId;\n\tlet settle;\n\tlet rejectFn;\n\tconst clear = defaultClear || clearTimeout;\n\n\tconst signalListener = () => {\n\t\tclear(timeoutId);\n\t\trejectFn(createAbortError());\n\t};\n\n\tconst cleanup = () => {\n\t\tif (signal) {\n\t\t\tsignal.removeEventListener('abort', signalListener);\n\t\t}\n\t};\n\n\tconst delayPromise = new Promise((resolve, reject) => {\n\t\tsettle = () => {\n\t\t\tcleanup();\n\t\t\tif (willResolve) {\n\t\t\t\tresolve(value);\n\t\t\t} else {\n\t\t\t\treject(value);\n\t\t\t}\n\t\t};\n\n\t\trejectFn = reject;\n\t\ttimeoutId = (set || setTimeout)(settle, ms);\n\t});\n\n\tif (signal) {\n\t\tsignal.addEventListener('abort', signalListener, {once: true});\n\t}\n\n\tdelayPromise.clear = () => {\n\t\tclear(timeoutId);\n\t\ttimeoutId = null;\n\t\tsettle();\n\t};\n\n\treturn delayPromise;\n};\n\nconst createWithTimers = clearAndSet => {\n\tconst delay = createDelay({...clearAndSet, willResolve: true});\n\tdelay.reject = createDelay({...clearAndSet, willResolve: false});\n\tdelay.range = (minimum, maximum, options) => delay(randomInteger(minimum, maximum), options);\n\treturn delay;\n};\n\nconst delay = createWithTimers();\ndelay.createWithTimers = createWithTimers;\n\nmodule.exports = delay;\n// TODO: Remove this for the next major release\nmodule.exports.default = delay;\n","import PlayerAudio from './player-audio'\n\nexport class GameAudio {\n  constructor({ game, samples, master }) {\n    const volume = game.options.soundVolume\n    this._master = master\n    this._context = master.audioContext\n    this._players = new Map(\n      game.players.map((player) => [\n        player,\n        new PlayerAudio({ player, samples, master, volume }),\n      ])\n    )\n  }\n\n  destroy() {\n    this._master.destroy()\n  }\n\n  unmute() {\n    this._master.unmute()\n  }\n\n  get context() {\n    return this._context\n  }\n\n  update(t, state) {\n    for (const [player, playerAudio] of this._players) {\n      playerAudio.update(t, state.player(player))\n    }\n  }\n}\n\nexport default GameAudio\n","import now from 'bemuse/utils/now'\n\n// The game clock provides a high-accuracy time source for the game.\n//\n// We want our timing to be based on audio. If the audio lags, the time\n// clock should lag with the audio as well, in order to keep the game\n// time in sync with the background audio.\n//\n// But there is a problem on some browsers (Android):\n// ``AudioContext.currentTime`` is not precise. Therefore, we take the\n// average of the offset between system time (which is more precise)\n// and the audio time to compute a high-precision-and-accuracy time.\n//\nexport class Clock {\n  constructor(audio) {\n    audio.unmute() // kick start the currentTime of audio context\n\n    this._context = audio.context\n    this._offset = []\n    this._sum = 0\n    this.update()\n  }\n\n  // Updates the clock. This method should be called every frame.\n  update() {\n    const realTime = now() / 1000\n    const delta = realTime - this._context.currentTime\n    this._offset.push(delta)\n    this._sum += delta\n    while (this._offset.length > 60) {\n      this._sum -= this._offset.shift()\n    }\n\n    // The clock's time value, in seconds.\n    this.time = realTime - this._sum / this._offset.length\n  }\n}\n\nexport default Clock\n","import now from 'bemuse/utils/now'\n\n// The game timer keeps track of song progression in-game.\n// This class should be tied to the AudioContext.\n//\nexport class GameTimer {\n  constructor(clock, input) {\n    this._clock = clock\n    this._input = input\n    this._now = now.synchronized()\n    this._lastRecordedTimeSinceStart = 0\n    this.startTime = null\n    this._pauseAtTimerValue = Infinity\n    this._unpausedTimeSinceStart = 0\n    this._unpausedTimerValue = 0\n    this.readyFraction = 0\n    this.gettingStarted = false\n  }\n\n  // True if the game is started, false otherwise.\n  get started() {\n    return this.startTime !== null\n  }\n\n  // Updates the timer. This method should be called once in the game loop.\n  update() {\n    this._checkStartGame()\n    // The time, in seconds, since the start of the game.\n    this.time = this._calculateTime()\n  }\n\n  _checkStartGame() {\n    if (this.started) return\n    if (this._input.get('start').value) {\n      this.gettingStarted = true\n    }\n    if (this.gettingStarted && !this._input.get('start').value) {\n      this.startTime = this._clock.time + this._getWait()\n    }\n    if (!this.started) {\n      // The number in range 0...1 representing the progression in this second.\n      // When player presses the \"Start\" button, the game will wait for the\n      // next second before actually starting the game.\n      // Since the clock is synchronized globally, if player presses start\n      // in the same second, the game will start at the same time.\n      //\n      this.readyFraction = 1 - this._getWait()\n    }\n  }\n\n  _getWait() {\n    const t = this._now() / 1000\n    return Math.ceil(t) - t\n  }\n\n  _calculateTime() {\n    // When initializing the game, we suspend the timer at -0.333 seconds.\n    // Then, when the player starts the game, we slowly accelerate such that\n    // after 1 second, the timer approaches 0 seconds at normal speed.\n    // This is accomplished using some magic formula ;).\n    //\n    let delta = this.startTime === null ? 0 : this._clock.time - this.startTime\n    if (delta < 0) delta = 0\n    if (delta < 1) {\n      return (Math.pow(delta, 6) - 1) / 6 - 1 / 30\n    } else {\n      const timeSinceStart = delta - 31 / 30\n      this._lastRecordedTimeSinceStart = timeSinceStart\n      const projectedTimerValue =\n        this._unpausedTimerValue +\n        (timeSinceStart - this._unpausedTimeSinceStart)\n      return Math.min(projectedTimerValue, this._pauseAtTimerValue)\n    }\n  }\n\n  pauseAt(timerValueToPause) {\n    if (\n      this._unpausedTimerValue +\n        (this._lastRecordedTimeSinceStart - this._unpausedTimeSinceStart) >=\n      this._pauseAtTimerValue\n    ) {\n      this._unpausedTimerValue = this._pauseAtTimerValue\n      this._unpausedTimeSinceStart = this._lastRecordedTimeSinceStart\n    }\n    this._pauseAtTimerValue = timerValueToPause\n  }\n}\n\nexport default GameTimer\n","export class DualInput {\n  /*\n    A helper class for mapping two boolean inputs to a single integer output.\n    This provide robust and responsive output when quickly firing two inputs alternatively.\n  */\n\n  // input states -1: up, 0: off, 1: down, 2: hold\n  private input = [0, 0]\n  private last = 0\n  private output = 0\n\n  public combine(...input: [boolean, boolean]) {\n    for (let i = 0; i < 2; ++i) {\n      if (input[i] && this.input[i] <= 0) {\n        this.input[i] = 1\n        this.last = i\n      } else if (!input[i] && this.input[i] > 0) {\n        this.input[i] = -1\n      } else if (this.input[i] % 2 !== 0) {\n        this.input[i] += 1\n      }\n    }\n\n    if (this.input[0] === 1 || this.input[1] === 1) {\n      this.output = this.last === 0 ? 1 : -1\n    }\n\n    if (this.input[this.last] <= 0) {\n      this.output = 0\n    }\n\n    return this.output\n  }\n}\n","import { OmniInput } from 'bemuse/omni-input'\nimport { DualInput } from './dual-input'\n\nfunction OmniInputPlugin(game) {\n  const input = new OmniInput(window, {\n    exclusive: true,\n    continuous: game.players[0].options.input.continuous,\n    sensitivity: game.players[0].options.input.sensitivity,\n  })\n  const kbm = game.players[0].options.input.keyboard\n  const scratch = new DualInput()\n\n  // Don't use Btn8 or Btn9 if they are binded\n  // TODO: make start and select button bindable\n  const isBtn8Free = Object.values(kbm).indexOf('gamepad.0.button.8') < 0\n  const isBtn9Free = Object.values(kbm).indexOf('gamepad.0.button.9') < 0\n\n  return {\n    name: 'GameKBPlugin',\n    get() {\n      const data = input.update()\n\n      const result = {\n        p1_1: data[kbm['1'] || '83'],\n        p1_2: data[kbm['2'] || '68'],\n        p1_3: data[kbm['3'] || '70'],\n        p1_4: data[kbm['4'] || '32'],\n        p1_5: data[kbm['5'] || '74'],\n        p1_6: data[kbm['6'] || '75'],\n        p1_7: data[kbm['7'] || '76'],\n        p1_SC: scratch.combine(\n          data[kbm['SC'] || '65'],\n          data[kbm['SC2'] || '16']\n        ),\n        p1_speedup: data[38],\n        p1_speeddown: data[40],\n        start: data[13] || (isBtn9Free && data['gamepad.0.button.9']),\n        select: data[18] || (isBtn8Free && data['gamepad.0.button.8']),\n      }\n      if (result['start'] || result['select']) {\n        if (\n          result['p1_1'] ||\n          result['p1_3'] ||\n          result['p1_5'] ||\n          result['p1_7']\n        ) {\n          result['p1_speeddown'] = true\n        }\n        if (result['p1_2'] || result['p1_4'] || result['p1_6']) {\n          result['p1_speedup'] = true\n        }\n      }\n      return result\n    },\n    destroy() {\n      input.dispose()\n    },\n  }\n}\n\nexport default OmniInputPlugin\n","import * as BemuseTestMode from 'bemuse/devtools/BemuseTestMode'\n\nimport Clock from './clock'\nimport GameInput from './input'\nimport GameState from './state'\nimport GameTimer from './game-timer'\nimport OmniInputPlugin from './input/omni-input-plugin'\nimport TouchPlugin from './input/touch-plugin'\nimport bench from 'bemuse/devtools/benchmark'\n\n// The GameController takes care of communications between each game\n// component, and takes care of the Game loop.\nexport class GameController {\n  constructor({ game, display, audio }) {\n    this._audioInputLatency = game.options.audioInputLatency\n    this._game = game\n    this._display = display\n    this._audio = audio\n    this._clock = new Clock(this._audio)\n    this._input = new GameInput()\n    this._timer = new GameTimer(this._clock, this._input)\n    this._state = new GameState(game)\n    this._promise = new Promise((resolve) => (this._resolvePromise = resolve))\n    this._display.setEscapeHandler(() => this._quitGame())\n    this._display.setReplayHandler(() => this._replayGame())\n    this.initializeBenchmark()\n    this.initializeTestModeHooks()\n  }\n\n  get game() {\n    return this._game\n  }\n\n  get display() {\n    return this._display\n  }\n\n  get audio() {\n    return this._audio\n  }\n\n  get promise() {\n    return this._promise\n  }\n\n  get state() {\n    return this._state\n  }\n\n  get latestGameTime() {\n    return this._latestGameTime\n  }\n\n  // Initializes the game components and kickstarts the game loop.\n  start() {\n    this._handleEscape()\n    this._display.start()\n    this._input.use(new OmniInputPlugin(this._game))\n    this._input.use(new TouchPlugin(this._display.context))\n    let stopped = false\n    const frame = () => {\n      if (stopped) return\n      this._update()\n      requestAnimationFrame(frame)\n    }\n    requestAnimationFrame(frame)\n    this._endGameLoop = () => (stopped = true)\n  }\n\n  // Exits the game when escape is pressed.\n  _handleEscape() {\n    const onKeyDown = (e) => {\n      const ESCAPE_KEY = 27\n      const F1_KEY = 112\n      if (e.keyCode === ESCAPE_KEY) {\n        e.preventDefault()\n        e.stopPropagation()\n        this._quitGame()\n      } else if (e.keyCode === F1_KEY) {\n        e.preventDefault()\n        e.stopPropagation()\n        this._replayGame()\n      }\n    }\n    window.addEventListener('keydown', onKeyDown, true)\n    this._promise.finally(function () {\n      window.removeEventListener('keydown', onKeyDown, true)\n    })\n  }\n\n  _quitGame() {\n    this._resolvePromise({ finished: false, replay: false })\n  }\n\n  _replayGame() {\n    this._resolvePromise({ finished: false, replay: true })\n  }\n\n  // Destroy the game.\n  destroy() {\n    this._endGameLoop()\n    this._audio.destroy()\n    this._input.destroy()\n    this._display.destroy()\n  }\n\n  _update() {\n    // >> game/loop\n    //\n    // Turn-Based Update Cycle\n    // -----------------------\n    // At each iteration of the game loop, each game component takes turn and\n    // update itself.  Each game component involved in this game loop should\n    // have a ``update(...)`` method, which takes care of updating itself.\n    // This is the only time the component will be mutable.\n    //\n    // Outside of the ``update`` method, a component should behave like an\n    // immutable object.  This allows us to have some sense of immutability\n    // without having to create new objects. See `the case for immutability`_.\n    //\n    // .. _the case for immutability: https://github.com/facebook/immutable-js/blob/d8d189ae7ea8965fee2ecc7320ebdc55e83eb6a1/README.md#the-case-for-immutability\n    //\n    // At each cycle, the following happens:\n    //\n    // - the Clock is updated to get the high-accuracy time\n    // - the Timer is updated to get the in-game time\n    // - the Input is updated to get button presses\n    // - the State is updated to react to button presses -- judging notes and\n    //   updating scores\n    // - the Audio is updated to emit sound based on the updated state\n    // - the Display is updated to render the game display based on the updated\n    //   state\n    //\n    this._clock.update()\n    this._input.update()\n    this._timer.update()\n    const t = this._timer.time\n    const A = this._audioInputLatency\n    this._latestGameTime = t\n    this._state.update(t - A, this._input, this._timer)\n    this._audio.update(t, this._state)\n    this._display.update(t - A, this._state)\n    if (this._state.finished && this._resolvePromise) {\n      this._resolvePromise({ finished: true })\n      this._resolvePromise = null\n    }\n  }\n\n  initializeBenchmark() {\n    if (!bench.enabled) return\n    bench.benchmark('update', this, '_update')\n    bench.benchmark('input_update', this._input, 'update')\n    bench.benchmark('state_update', this._state, 'update')\n    bench.benchmark('audio_update', this._audio, 'update')\n    bench.benchmark('display_update', this._display, 'update')\n    bench.benchmark('display_compute', this._display, '_getData')\n    bench.benchmark('display_push', this._display._context._instance, 'push')\n    bench.benchmark(\n      'display_render',\n      this._display._context._renderer,\n      'render'\n    )\n  }\n\n  initializeTestModeHooks() {\n    if (!BemuseTestMode.isTestModeEnabled()) return\n    BemuseTestMode.setGameLifecycleHandler({\n      pauseAt: (t) => {\n        this._timer.pauseAt(t)\n        return new Promise((resolve) => {\n          const interval = setInterval(() => {\n            if (this._timer.time >= t) {\n              clearInterval(interval)\n              resolve()\n            }\n          })\n        })\n      },\n      unpause: () => {\n        this._timer.pauseAt(Infinity)\n      },\n      getScore: () => {\n        const state = this._state\n        const playerState = state.player(state.game.players[0])\n        return playerState.stats.score\n      },\n    })\n  }\n}\n\nexport default GameController\n","export function loadImage(assets, filename) {\n  return assets\n    .file(filename)\n    .then((asset) => asset.read())\n    .then((arrayBuffer) => new Blob([arrayBuffer]))\n    .then((blob) => URL.createObjectURL(blob))\n    .then(\n      (src) =>\n        new Promise((resolve, reject) => {\n          const image = new Image()\n          image.onload = () => resolve(image)\n          image.onerror = reject\n          image.src = src\n        })\n    )\n}\n\nexport default loadImage\n","import NotechartLoader from 'bemuse-notechart/lib/loader'\nimport Progress from 'bemuse/progress'\nimport { atomic } from 'bemuse/progress/utils'\nimport SamplingMaster from 'bemuse/sampling-master'\nimport keysoundCache from 'bemuse/keysound-cache'\n\nimport * as Multitasker from './multitasker'\nimport Game, { GamePlayerOptionsInput } from '../game'\nimport GameAudio from '../audio'\nimport GameController from '../game-controller'\nimport GameDisplay from '../display'\nimport SamplesLoader from './samples-loader'\nimport loadImage from './loadImage'\nimport Notechart from 'bemuse-notechart'\nimport { IResources } from 'bemuse/resources/types'\nimport { resolveRelativeResources } from 'bemuse/resources/resolveRelativeResource'\n\ntype Tasks = {\n  Scintillator: TODO\n  Skin: TODO\n  SkinContext: TODO\n  Notechart: Notechart\n  EyecatchImage: HTMLImageElement\n  BackgroundImage: HTMLImageElement\n  SamplingMaster: SamplingMaster\n  Video: { element: HTMLVideoElement; offset: number } | null\n  Game: Game\n  GameDisplay: GameDisplay\n  Samples: TODO\n  GameAudio: GameAudio\n  GameController: GameController\n}\n\ntype Assets = IResources & {\n  progress?: {\n    current?: Progress\n    all?: Progress\n  }\n}\n\nexport type LoadSpec = {\n  assets: Assets\n  bms: TODO\n  songId: string\n  displayMode?: 'touch3d' | 'normal'\n  backImageUrl?: string\n  eyecatchImageUrl?: string\n  videoUrl?: string\n  videoOffset?: number\n  options: GamePlayerOptionsInput\n}\n\nexport function load(spec: LoadSpec) {\n  const assets = spec.assets\n  const bms = spec.bms\n  const songId = spec.songId\n\n  return Multitasker.start<Tasks, GameController>(function (task, run) {\n    task('Scintillator', 'Loading game engine', [], function (progress) {\n      return atomic(\n        progress,\n        import(/* webpackChunkName: 'gameEngine' */ 'bemuse/scintillator')\n      )\n    })\n\n    task(\n      'Skin',\n      'Loading skin',\n      ['Scintillator'],\n      function (Scintillator, progress) {\n        return Scintillator.load(\n          Scintillator.getSkinUrl({\n            displayMode: spec.displayMode,\n          }),\n          progress\n        )\n      }\n    )\n\n    task(\n      'SkinContext',\n      null,\n      ['Scintillator', 'Skin'],\n      function (Scintillator, skin) {\n        return new Scintillator.Context(skin, { touchEventTarget: window })\n      }\n    )\n\n    if (assets.progress) {\n      if (assets.progress.current) {\n        task.bar('Loading package', assets.progress.current)\n      }\n      if (assets.progress.all) {\n        task.bar('Loading song packages', assets.progress.all)\n      }\n    }\n\n    task('Notechart', 'Loading ' + spec.bms.name, [], async (progress) => {\n      const loader = new NotechartLoader()\n      const arraybuffer = await bms.read(progress)\n      return loader.load(arraybuffer, spec.bms, spec.options.players[0])\n    })\n\n    task('EyecatchImage', null, ['Notechart'], function (notechart) {\n      if (spec.eyecatchImageUrl) {\n        const [base, filename] = resolveRelativeResources(\n          assets,\n          spec.eyecatchImageUrl\n        )\n        return loadImage(base, filename)\n      }\n      return loadImage(assets, notechart.eyecatchImage)\n    })\n\n    task('BackgroundImage', null, ['Notechart'], function (notechart) {\n      if (spec.backImageUrl) {\n        const [base, filename] = resolveRelativeResources(\n          assets,\n          spec.backImageUrl\n        )\n        return loadImage(base, filename)\n      }\n      return loadImage(assets, notechart.backgroundImage)\n    })\n\n    const audioLoadProgress = new Progress()\n    const audioDecodeProgress = new Progress()\n\n    task.bar('Loading audio', audioLoadProgress)\n    task.bar('Decoding audio', audioDecodeProgress)\n\n    task('SamplingMaster', null, [], async () => {\n      return new SamplingMaster()\n    })\n\n    task(\n      'Video',\n      spec.videoUrl ? 'Loading video' : null,\n      ['Notechart'],\n      async function (notechart, progress) {\n        if (!spec.videoUrl) return Promise.resolve(null)\n        let videoUrl = spec.videoUrl\n        if (!videoUrl.includes('://')) {\n          // This is a relative URL, we need to load from assets.\n          const [base, filename] = resolveRelativeResources(assets, videoUrl)\n          const file = await base.file(filename)\n          videoUrl = await file.resolveUrl()\n        }\n        return new Promise((resolve, reject) => {\n          const video = document.createElement('video')\n          if (!video.canPlayType('video/webm')) return resolve(null)\n          video.src = videoUrl\n          video.preload = 'auto'\n          video.addEventListener('progress', onProgress, true)\n          video.addEventListener('canplaythrough', onCanPlayThrough, true)\n          video.addEventListener('error', onError, true)\n          video.addEventListener('abort', onError, true)\n          video.load()\n\n          function onProgress() {\n            if (video.buffered && video.buffered.length && video.duration) {\n              progress.report(\n                video.buffered.end(0) - video.buffered.start(0),\n                video.duration\n              )\n            }\n          }\n          function finish() {\n            video.removeEventListener('progress', onProgress, true)\n            video.removeEventListener('canplaythrough', onCanPlayThrough, true)\n            video.removeEventListener('error', onError, true)\n            video.removeEventListener('abort', onError, true)\n          }\n          function onCanPlayThrough() {\n            finish()\n            const n = video.duration || 100\n            progress.report(n, n)\n            resolve({ element: video, offset: spec.videoOffset! })\n          }\n          function onError() {\n            finish()\n            console.warn('Cannot load video... Just skip it!')\n            resolve(null)\n          }\n        })\n      }\n    )\n\n    task('Game', null, ['Notechart'], async (notechart) => {\n      return new Game([notechart], spec.options)\n    })\n\n    task(\n      'GameDisplay',\n      null,\n      ['Game', 'SkinContext', 'Video'],\n      async (game, context, video) => {\n        return new GameDisplay({\n          game,\n          context,\n          backgroundImagePromise: run('BackgroundImage'),\n          video,\n        })\n      }\n    )\n\n    task('Samples', null, ['SamplingMaster', 'Game'], function (master, game) {\n      keysoundCache.receiveSongId(songId)\n      const samplesLoader = new SamplesLoader(assets, master)\n      return samplesLoader.loadFiles(\n        game.samples,\n        audioLoadProgress,\n        audioDecodeProgress\n      )\n    })\n\n    task(\n      'GameAudio',\n      null,\n      ['Game', 'Samples', 'SamplingMaster'],\n      async (game, samples, master) => {\n        return new GameAudio({ game, samples, master })\n      }\n    )\n\n    task(\n      'GameController',\n      null,\n      ['Game', 'GameDisplay', 'GameAudio'],\n      async (game, display, audio) => {\n        return new GameController({ game, display, audio })\n      }\n    )\n\n    return run('GameController')\n  })\n}\n","import Observable from 'bemuse/utils/observable'\nimport Progress from 'bemuse/progress'\nimport { throttle } from 'lodash'\n\nexport function start(callback) {\n  const tasks = {}\n  const running = {}\n  const taskList = []\n\n  function task(name, text, dependencies, f) {\n    const progress = new Progress()\n    if (text) taskList.push({ text, progress })\n    tasks[name] = function () {\n      return Promise.all(dependencies.map(run)).then((deps) =>\n        f(...deps.concat([progress]))\n      )\n    }\n  }\n\n  function bar(text, progress) {\n    taskList.push({ text, progress })\n  }\n\n  task.bar = bar\n\n  function run(name) {\n    return running[name] || (running[name] = tasks[name]())\n  }\n\n  function getTaskStatuses() {\n    return taskList.map((t) => {\n      return {\n        text: t.text,\n        progress: t.progress.progress,\n        progressText: t.progress.toString(),\n      }\n    })\n  }\n\n  const promise = callback(task, run)\n  const status = new Observable(getTaskStatuses())\n  const update = throttle(function updateTaskStatuses() {\n    status.value = getTaskStatuses()\n  }, 16)\n\n  for (const taskToWatch of taskList) {\n    taskToWatch.progress.watch(update)\n  }\n\n  return { tasks: status, promise: promise, get: run }\n}\n","import './LoadingSceneProgressBar.scss'\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default class LoadingSceneProgressBar extends React.Component {\n  static propTypes = {\n    width: PropTypes.oneOfType([PropTypes.string, PropTypes.number]).isRequired,\n  }\n\n  render() {\n    return (\n      <div className='LoadingSceneProgressBar'>\n        <div\n          className='LoadingSceneProgressBarbar'\n          style={{ width: this.props.width }}\n        />\n      </div>\n    )\n  }\n}\n","import './LoadingSceneProgress.scss'\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport LoadingSceneProgressBar from './LoadingSceneProgressBar.jsx'\n\nexport default class LoadingSceneProgress extends React.Component {\n  static propTypes = {\n    tasks: PropTypes.object,\n  }\n\n  render() {\n    return (\n      <div className='LoadingSceneProgress'>\n        {this.props.tasks.value.map((task) => this.renderItem(task))}\n      </div>\n    )\n  }\n\n  renderItem = ({ text, progressText, progress }) => {\n    const width = Math.round(progress * 100 || 0).toString() + '%'\n    const extra = progressText ? ` (${progressText})` : ''\n    return (\n      <div key={text} className='LoadingSceneProgressitem'>\n        <LoadingSceneProgressBar width={width} />\n        {text}\n        <span className='LoadingSceneProgressextra'>{extra}</span>\n      </div>\n    )\n  }\n\n  componentDidMount() {\n    this._unsubscribe = this.props.tasks.watch(() => this.forceUpdate())\n  }\n\n  componentWillUnmount() {\n    this._unsubscribe()\n  }\n}\n","import './LoadingSceneSongInfo.scss'\n\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport { isTitleDisplayMode } from 'bemuse/devtools/query-flags'\n\nexport default class LoadingSceneSongInfo extends React.Component {\n  static propTypes = {\n    song: PropTypes.shape({\n      title: PropTypes.string,\n      artist: PropTypes.string,\n      genre: PropTypes.string,\n      subtitles: PropTypes.arrayOf(PropTypes.string),\n      subartists: PropTypes.arrayOf(PropTypes.string),\n      difficulty: PropTypes.number,\n      level: PropTypes.number,\n    }).isRequired,\n  }\n\n  render() {\n    const song = this.props.song\n    return (\n      <div className='LoadingSceneSongInfo'>\n        <div className='LoadingSceneSongInfogenre'>{song.genre}</div>\n        <div className='LoadingSceneSongInfotitle'>{song.title}</div>\n        {!isTitleDisplayMode()\n          ? song.subtitles.map((text) => (\n              <div key={text} className='LoadingSceneSongInfosubtitle'>\n                {text}\n              </div>\n            ))\n          : null}\n        <div className='LoadingSceneSongInfoartist'>{song.artist}</div>\n        {song.subartists.map((text) => (\n          <div key={text} className='LoadingSceneSongInfosubartist'>\n            {text}\n          </div>\n        ))}\n      </div>\n    )\n  }\n}\n","import './LoadingScene.scss'\n\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport Scene from 'bemuse/ui/Scene.jsx'\nimport delay from 'delay'\n\nimport LoadingSceneProgress from './LoadingSceneProgress.jsx'\nimport LoadingSceneSongInfo from './LoadingSceneSongInfo.jsx'\n\nexport default class LoadingScene extends React.Component {\n  static propTypes = {\n    song: PropTypes.shape({\n      title: PropTypes.string,\n      artist: PropTypes.string,\n      genre: PropTypes.string,\n      subtitles: PropTypes.arrayOf(PropTypes.string),\n      subartists: PropTypes.arrayOf(PropTypes.string),\n      difficulty: PropTypes.number,\n      level: PropTypes.number,\n    }),\n    tasks: PropTypes.object,\n    eyecatchImagePromise: PropTypes.object,\n    registerTeardownCallback: PropTypes.func,\n  }\n\n  render() {\n    return (\n      <Scene className='LoadingScene' ref='scene'>\n        <div className='LoadingSceneimage' ref='eyecatch' />\n        <div className='LoadingSceneinfo'>\n          <LoadingSceneSongInfo song={this.props.song} />\n        </div>\n        <LoadingSceneProgress tasks={this.props.tasks} />\n        <div className='LoadingSceneflash' />\n        <div className='LoadingScenecover' />\n      </Scene>\n    )\n  }\n\n  componentDidMount() {\n    if (this.props.eyecatchImagePromise) {\n      this.props.eyecatchImagePromise.then((image) => {\n        ReactDOM.findDOMNode(this.refs.eyecatch).appendChild(image)\n      })\n    }\n    this.props.registerTeardownCallback(() => {\n      ReactDOM.findDOMNode(this.refs.scene).classList.add('is-exiting')\n      return delay(500)\n    })\n  }\n}\n","import query from 'bemuse/utils/query'\n\nexport function shouldShowOptions() {\n  return query.BEMUSE_SHOW_OPTIONS === '1'\n}\n\nexport function shouldEnableBenchmark() {\n  return query.BEMUSE_BENCHMARK === '1'\n}\n\nexport function shouldDisableFullScreen() {\n  return query.BEMUSE_NO_FULLSCREEN === '1'\n}\n\nexport function shouldShowAbout() {\n  return query.BEMUSE_SHOW_ABOUT === '1'\n}\n\nexport function shouldShowModeSelect() {\n  return query.BEMUSE_SHOW_MODE_SELECT === '1'\n}\n\nexport function isTitleDisplayMode() {\n  return query.BEMUSE_TITLE_DISPLAY === '1'\n}\n","import Observable from 'bemuse/utils/observable'\n\ninterface IProgressFormatter {\n  (progress: Progress): string\n}\n\n/**\n * The Progress class represents the progress of an asynchronous operation.\n * It is inspired by C#'s IProgress interface.\n *\n * See: http://blogs.msdn.com/b/dotnet/archive/2012/06/06/async-in-4-5-enabling-progress-and-cancellation-in-async-apis.aspx\n */\nexport class Progress {\n  /** The current progress (out of `Progress#total`). */\n  public current: number | undefined = undefined\n  /** Total progress value */\n  public total: number | undefined = undefined\n  /** Some arbitrary information associated with this Progress. */\n  public extra: any\n  /**\n   * The formatter of this progress. This formatter will be used to compute\n   * the text representation of this progress (`Progress#toString`).\n   */\n  public formatter?: IProgressFormatter\n  private _observable = new Observable<void>()\n  /**\n   * Updates the progress.\n   */\n  report(current: number, total: number, extra?: any) {\n    this.current = current\n    this.total = total\n    this.extra = extra\n    this._observable.notify()\n  }\n\n  /**\n   * Attaches a progress listener function to this progress.\n   * The function `f` will be called immediately and synchronously upon watching,\n   * and will be called when the progress value is updated.\n   * @param f\n   * @returns a function that, when called, unsubscribes this listener.\n   */\n  watch(f: (progress: Progress) => void) {\n    f(this)\n    return this._observable.watch(() => f(this))\n  }\n\n  /**\n   * The current progress as a fraction (out of 1).\n   */\n  get progress() {\n    if (this.total && this.current !== undefined && this.current !== null) {\n      return this.current / this.total\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * Returns a string representation of this progress instance.\n   * This method is used for displaying the progress as a text.\n   */\n  toString() {\n    if (this.formatter !== undefined) {\n      return this.formatter(this)\n    } else if (this.progress !== null) {\n      return this.current + ' / ' + this.total\n    } else {\n      return ''\n    }\n  }\n}\n","// !! avoid external dependencies since this is used in boot script!\n\nimport Callbacks from 'bemuse/utils/callbacks'\n\nexport class Observable<T> {\n  private _callbacks = new Callbacks<[T]>()\n  private _value?: T\n  constructor(value?: T) {\n    this._value = value\n  }\n\n  get value() {\n    return this._value\n  }\n\n  set value(value) {\n    this._value = value\n    this.notify(value!)\n  }\n\n  notify(value: T) {\n    this._callbacks.call(value)\n  }\n\n  watch(f: (value: T) => void) {\n    if (this._value !== undefined) f(this._value)\n    return this._callbacks.add(f)\n  }\n}\n\nexport default Observable\n","// !! avoid external dependencies since this is used in boot script!\n\ntype CallbackEffect<T extends any[]> = (...args: T) => void\n\n/**\n * A utility class to hold a collection of callbacks.\n */\nexport class Callbacks<T extends any[]> {\n  private _callbacks: { [id: number]: CallbackEffect<T> } = {}\n  private _nextId = 1\n  constructor(init?: CallbackEffect<T>[] | CallbackEffect<T>) {\n    if (typeof init === 'function') {\n      this.add(init)\n    } else if (typeof init === 'object' && init && init.length) {\n      for (let i = 0; i < init.length; i++) this.add(init[i])\n    }\n  }\n\n  /**\n   * Calls all the callbacks.\n   */\n  call(...args: T) {\n    const callbacks = this._callbacks\n    for (const id in callbacks) {\n      callbacks[id](...args)\n    }\n  }\n\n  /**\n   * Adds a `callback` Function to this Callbacks collection.\n   * Returns a function that, when invoked, removes the inserted `callback` from the collection.\n   */\n  add(callback: CallbackEffect<T>) {\n    const id = this._nextId++\n    this._callbacks[id] = callback\n    return () => delete this._callbacks[id]\n  }\n}\n\nexport default Callbacks\n","export default new AudioContext({\n  latencyHint: 'interactive',\n})\n","// :doc:\n//\n// High-accuracy timer, optionally synchronized globally.\n\nimport sync from 'timesynchro'\nconst Log = BemuseLogger.forModule('timesynchro')\n\nlet now\nlet offset = 0\n\nif (window.performance && typeof window.performance.now === 'function') {\n  now = () => window.performance.now()\n} else {\n  now = () => Date.now()\n}\n\nnow.synchronize = function (server) {\n  sync(server, onFinish, onResult)\n  function onResult(result) {\n    // result + Date.now() = real time = now() + offset\n    // result + Date.now() = now() + offset\n    // offset = result + Date.now() - now()\n    offset = result + Date.now() - now()\n  }\n  function onFinish(err, result) {\n    if (err) {\n      Log.error('Cannot synchronize time: ' + err)\n    } else {\n      onResult(result)\n      Log.info('Synchronized time with global server! Offset = ' + offset)\n    }\n  }\n}\n\nnow.synchronized = function () {\n  const o = offset\n  return () => now() + o\n}\n\nexport { now }\nexport default now\n","/*!\n * bytes\n * Copyright(c) 2012-2014 TJ Holowaychuk\n * Copyright(c) 2015 Jed Watson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = bytes;\nmodule.exports.format = format;\nmodule.exports.parse = parse;\n\n/**\n * Module variables.\n * @private\n */\n\nvar formatThousandsRegExp = /\\B(?=(\\d{3})+(?!\\d))/g;\n\nvar formatDecimalsRegExp = /(?:\\.0*|(\\.[^0]+)0+)$/;\n\nvar map = {\n  b:  1,\n  kb: 1 << 10,\n  mb: 1 << 20,\n  gb: 1 << 30,\n  tb: Math.pow(1024, 4),\n  pb: Math.pow(1024, 5),\n};\n\nvar parseRegExp = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb|pb)$/i;\n\n/**\n * Convert the given value in bytes into a string or parse to string to an integer in bytes.\n *\n * @param {string|number} value\n * @param {{\n *  case: [string],\n *  decimalPlaces: [number]\n *  fixedDecimals: [boolean]\n *  thousandsSeparator: [string]\n *  unitSeparator: [string]\n *  }} [options] bytes options.\n *\n * @returns {string|number|null}\n */\n\nfunction bytes(value, options) {\n  if (typeof value === 'string') {\n    return parse(value);\n  }\n\n  if (typeof value === 'number') {\n    return format(value, options);\n  }\n\n  return null;\n}\n\n/**\n * Format the given value in bytes into a string.\n *\n * If the value is negative, it is kept as such. If it is a float,\n * it is rounded.\n *\n * @param {number} value\n * @param {object} [options]\n * @param {number} [options.decimalPlaces=2]\n * @param {number} [options.fixedDecimals=false]\n * @param {string} [options.thousandsSeparator=]\n * @param {string} [options.unit=]\n * @param {string} [options.unitSeparator=]\n *\n * @returns {string|null}\n * @public\n */\n\nfunction format(value, options) {\n  if (!Number.isFinite(value)) {\n    return null;\n  }\n\n  var mag = Math.abs(value);\n  var thousandsSeparator = (options && options.thousandsSeparator) || '';\n  var unitSeparator = (options && options.unitSeparator) || '';\n  var decimalPlaces = (options && options.decimalPlaces !== undefined) ? options.decimalPlaces : 2;\n  var fixedDecimals = Boolean(options && options.fixedDecimals);\n  var unit = (options && options.unit) || '';\n\n  if (!unit || !map[unit.toLowerCase()]) {\n    if (mag >= map.pb) {\n      unit = 'PB';\n    } else if (mag >= map.tb) {\n      unit = 'TB';\n    } else if (mag >= map.gb) {\n      unit = 'GB';\n    } else if (mag >= map.mb) {\n      unit = 'MB';\n    } else if (mag >= map.kb) {\n      unit = 'KB';\n    } else {\n      unit = 'B';\n    }\n  }\n\n  var val = value / map[unit.toLowerCase()];\n  var str = val.toFixed(decimalPlaces);\n\n  if (!fixedDecimals) {\n    str = str.replace(formatDecimalsRegExp, '$1');\n  }\n\n  if (thousandsSeparator) {\n    str = str.split('.').map(function (s, i) {\n      return i === 0\n        ? s.replace(formatThousandsRegExp, thousandsSeparator)\n        : s\n    }).join('.');\n  }\n\n  return str + unitSeparator + unit;\n}\n\n/**\n * Parse the string value into an integer in bytes.\n *\n * If no unit is given, it is assumed the value is in bytes.\n *\n * @param {number|string} val\n *\n * @returns {number|null}\n * @public\n */\n\nfunction parse(val) {\n  if (typeof val === 'number' && !isNaN(val)) {\n    return val;\n  }\n\n  if (typeof val !== 'string') {\n    return null;\n  }\n\n  // Test if the string passed is valid\n  var results = parseRegExp.exec(val);\n  var floatValue;\n  var unit = 'b';\n\n  if (!results) {\n    // Nothing could be extracted from the given string\n    floatValue = parseInt(val, 10);\n    unit = 'b'\n  } else {\n    // Retrieve the value and the unit\n    floatValue = parseFloat(results[1]);\n    unit = results[4].toLowerCase();\n  }\n\n  if (isNaN(floatValue)) {\n    return null;\n  }\n\n  return Math.floor(map[unit] * floatValue);\n}\n","export function addUnprefixed(\n  prefix: string,\n  name: string,\n  callback: (path: string) => void\n) {\n  if (name.match(/\\.(?:bms|bme|bml|bmson)/i)) {\n    callback(name)\n    return\n  }\n  const parts = (prefix + name).split('/')\n  for (let i = 0; i < parts.length; i++) {\n    callback(parts.slice(i).join('/'))\n  }\n}\n","import './Scene.scss'\n\nimport c from 'classnames'\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default class Scene extends React.Component {\n  static propTypes = {\n    className: PropTypes.string,\n    children: PropTypes.node,\n    onDragEnter: PropTypes.func,\n  }\n\n  render() {\n    return (\n      <div\n        className={c('Scene', this.props.className)}\n        onDragEnter={this.props.onDragEnter}\n      >\n        {this.props.children}\n      </div>\n    )\n  }\n}\n","import defaultAudioContext from 'bemuse/audio-context'\nimport readBlob from 'bemuse/utils/read-blob'\nimport { decodeOGG } from './ogg'\n\nexport const FADE_LENGTH = 0.001\n\nconst dummyAudioTag = document.createElement('audio')\n// Checks whether an audio format is supported.\nexport function canPlay(type) {\n  // We have a Vorbis audio decoder!\n  if (type === 'audio/ogg; codecs=\"vorbis\"') return true\n  return dummyAudioTag.canPlayType(type) === 'probably'\n}\n\nconst needsVorbisDecoder = !dummyAudioTag.canPlayType(\n  'audio/ogg; codecs=\"vorbis\"'\n)\n\n// The sampling master is a wrapper class around Web Audio API\n// that takes care of:\n//\n// - Decoding audio from an ArrayBuffer or Blob (resulting in a \"Sample\").\n// - Playing the `Sample` and managing its lifecycle.\nexport class SamplingMaster {\n  constructor(audioContext) {\n    this._audioContext = audioContext || defaultAudioContext\n    this._samples = []\n    this._groups = []\n    this._instances = new Set()\n    this._destination = this._audioContext.destination\n  }\n\n  // Connects a dummy node to the audio, thereby unmuting the audio system on\n  // iOS devices (which keeps the audio muted until a user interacts with the\n  // page).\n  unmute() {\n    unmuteAudio(this._audioContext)\n  }\n\n  // The underlying AudioContext.\n  get audioContext() {\n    return this._audioContext\n  }\n\n  // The audio destination.\n  get destination() {\n    return this._destination\n  }\n\n  // The current time\n  // See: https://webaudio.github.io/web-audio-api/#dom-baseaudiocontext-currenttime\n  get currentTime() {\n    return this._audioContext.currentTime\n  }\n\n  // Destroys this SamplingMaster, make it unusable.\n  destroy() {\n    if (this._destroyed) return\n    this._destroyed = true\n    for (const sample of this._samples) sample.destroy()\n    for (const instance of this._instances) instance.destroy()\n    this._samples = null\n    this._instances = null\n  }\n\n  // Decodes the audio data from a Blob or an ArrayBuffer.\n  // Returns an AudioBuffer which can be re-used in other sampling masters.\n  decode(blobOrArrayBuffer) {\n    return this._coerceToArrayBuffer(blobOrArrayBuffer).then((arrayBuffer) =>\n      this._decodeAudio(arrayBuffer)\n    )\n  }\n\n  // Creates a `Sample` from a Blob or an ArrayBuffer or an AudioBuffer.\n  sample(blobOrArrayBufferOrAudioBuffer) {\n    const audioBufferPromise = (() => {\n      if (blobOrArrayBufferOrAudioBuffer.numberOfChannels) {\n        return Promise.resolve(blobOrArrayBufferOrAudioBuffer)\n      } else {\n        return this.decode(blobOrArrayBufferOrAudioBuffer)\n      }\n    })()\n    return audioBufferPromise.then((audioBuffer) => {\n      if (this._destroyed) throw new Error('SamplingMaster already destroyed!')\n      const sample = new Sample(this, audioBuffer)\n      this._samples.push(sample)\n      return sample\n    })\n  }\n\n  group(options) {\n    const group = new SoundGroup(this, options)\n    this._groups.push(group)\n    return group\n  }\n\n  _coerceToArrayBuffer(blobOrArrayBuffer) {\n    if (blobOrArrayBuffer instanceof ArrayBuffer) {\n      return Promise.resolve(blobOrArrayBuffer)\n    } else {\n      return readBlob(blobOrArrayBuffer).as('arraybuffer')\n    }\n  }\n\n  _decodeAudio(arrayBuffer) {\n    return new Promise((resolve, reject) => {\n      if (needsVorbisDecoder && arrayBuffer.byteLength > 4) {\n        const view = new Uint8Array(arrayBuffer, 0, 4)\n        if (\n          view[0] === 0x4f &&\n          view[1] === 0x67 &&\n          view[2] === 0x67 &&\n          view[3] === 0x53\n        ) {\n          return resolve(decodeOGG(this.audioContext, arrayBuffer))\n        }\n      }\n      this.audioContext.decodeAudioData(\n        arrayBuffer,\n        function decodeAudioDataSuccess(audioBuffer) {\n          resolve(audioBuffer)\n        },\n        function decodeAudioDataFailure(e) {\n          reject(new Error('Unable to decode audio: ' + e))\n        }\n      )\n    })\n  }\n\n  _startPlaying(instance) {\n    this._instances.add(instance)\n  }\n\n  _stoppedPlaying(instance) {\n    this._instances.delete(instance)\n  }\n}\n\n// Sound group\nexport class SoundGroup {\n  constructor(samplingMaster, { volume } = {}) {\n    this._master = samplingMaster\n    this._gain = this._master.audioContext.createGain()\n    if (volume != null) this._gain.gain.value = volume\n    this._gain.connect(this._master.destination)\n  }\n\n  get destination() {\n    return this._gain\n  }\n\n  destroy() {\n    this._gain.disconnect()\n    this._gain = null\n  }\n}\n\n// The Sample is created by and belongs to the `SamplingMaster`.\n//\n// You don't invoke this constructor directly; it is invoked by\n// `SamplingMaster#create`.\nexport class Sample {\n  constructor(samplingMaster, /** @type {AudioBuffer} */ audioBuffer) {\n    this._master = samplingMaster\n    this._buffer = audioBuffer\n  }\n\n  // Plays the sample and returns the new PlayInstance.\n  play(delay, options) {\n    return new PlayInstance(this._master, this._buffer, delay, options)\n  }\n\n  // Destroys this sample, thereby making it unusable.\n  destroy() {\n    this._master = null\n    this._buffer = null\n  }\n\n  get duration() {\n    return this._buffer.duration\n  }\n}\n\n// When a `Sample` is played, a PlayInstance is created.\n// A PlayInstance may not be reused; after the sound finishes playing,\n// you have to invoke `Sample#play` again.\n//\n// You don't invoke this constructor directly; it is invoked by `Sample#play`.\nexport class PlayInstance {\n  constructor(samplingMaster, buffer, delay, options = {}) {\n    delay = delay || 0\n    this._master = samplingMaster\n\n    // Connect all the stuff...\n    const context = samplingMaster.audioContext\n    const source = context.createBufferSource()\n    source.buffer = buffer\n    source.onended = () => this.stop()\n    const gain = context.createGain()\n    source.connect(gain)\n    const destination =\n      options.node ||\n      (options.group && options.group.destination) ||\n      samplingMaster.destination\n    gain.connect(destination)\n    this._source = source\n    this._gain = this.TEST_node = gain\n\n    // Start the sound.\n    const startTime = !delay ? 0 : Math.max(0, context.currentTime + delay)\n    const startOffset = options.start || 0\n    const fadeIn = startOffset > 0\n    let fadeOutAt = false\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, 0)\n    }\n    if (options.end !== undefined) {\n      const duration = Math.max(options.end - startOffset, 0)\n      source.start(startTime, startOffset, duration + FADE_LENGTH)\n      fadeOutAt = context.currentTime + delay + duration\n    } else {\n      source.start(startTime, startOffset)\n    }\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, context.currentTime + delay)\n      gain.gain.linearRampToValueAtTime(\n        1,\n        context.currentTime + delay + FADE_LENGTH\n      )\n    }\n    if (fadeOutAt !== false) {\n      gain.gain.setValueAtTime(1, fadeOutAt)\n      gain.gain.linearRampToValueAtTime(0, fadeOutAt + FADE_LENGTH)\n    }\n    this._master._startPlaying(this)\n  }\n\n  // Stops the sample and disconnects the underlying Web Audio nodes.\n  stop() {\n    if (!this._source) return\n    this._source.stop(0)\n    this._source.disconnect()\n    this._gain.disconnect()\n    this._source = null\n    this._gain = null\n    this._master._stoppedPlaying(this)\n    if (this.onstop) this.onstop()\n  }\n\n  // Makes this PlayInstance sound off-pitch, as a result of badly hitting\n  // a note.\n  bad() {\n    if (!this._source) return\n    this._source.playbackRate.value =\n      Math.random() < 0.5 ? Math.pow(2, 1 / 24) : Math.pow(2, -1 / 24)\n  }\n\n  // Destroys this PlayInstance.\n  destroy() {\n    this.stop()\n  }\n}\n\nexport default SamplingMaster\n\n/**\n * Enables Web Audio on iOS. By default, on iOS, audio is disabled.\n * This function must be called before audio will start working. It must be\n * called as a response to some user interaction (e.g. touchstart).\n *\n * Also, theres now Chrome autoplay policy taking effect.\n * https://developers.google.com/web/updates/2017/09/autoplay-policy-changes\n *\n * @param {AudioContext} ctx The AudioContext to be unmuted.\n */\nexport function unmuteAudio(ctx = defaultAudioContext) {\n  // Perform some strange magic to unmute the audio on iOS devices.\n  // This code doesnt make sense at all, you know.\n  const gain = ctx.createGain()\n  const osc = ctx.createOscillator()\n  osc.frequency.value = 440\n  osc.start(ctx.currentTime + 0.1)\n  osc.stop(ctx.currentTime + 0.1)\n  gain.connect(ctx.destination)\n  gain.disconnect()\n\n  resumeContext(ctx).catch((e) => {\n    console.error('[sampling-master] Cannot resume AudioContext', e)\n  })\n}\n\nasync function resumeContext(ctx) {\n  return ctx.resume()\n}\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar punycode = require('punycode');\nvar util = require('./util');\n\nexports.parse = urlParse;\nexports.resolve = urlResolve;\nexports.resolveObject = urlResolveObject;\nexports.format = urlFormat;\n\nexports.Url = Url;\n\nfunction Url() {\n  this.protocol = null;\n  this.slashes = null;\n  this.auth = null;\n  this.host = null;\n  this.port = null;\n  this.hostname = null;\n  this.hash = null;\n  this.search = null;\n  this.query = null;\n  this.pathname = null;\n  this.path = null;\n  this.href = null;\n}\n\n// Reference: RFC 3986, RFC 1808, RFC 2396\n\n// define these here so at least they only have to be\n// compiled once on the first module load.\nvar protocolPattern = /^([a-z0-9.+-]+:)/i,\n    portPattern = /:[0-9]*$/,\n\n    // Special case for a simple path URL\n    simplePathPattern = /^(\\/\\/?(?!\\/)[^\\?\\s]*)(\\?[^\\s]*)?$/,\n\n    // RFC 2396: characters reserved for delimiting URLs.\n    // We actually just auto-escape these.\n    delims = ['<', '>', '\"', '`', ' ', '\\r', '\\n', '\\t'],\n\n    // RFC 2396: characters not allowed for various reasons.\n    unwise = ['{', '}', '|', '\\\\', '^', '`'].concat(delims),\n\n    // Allowed by RFCs, but cause of XSS attacks.  Always escape these.\n    autoEscape = ['\\''].concat(unwise),\n    // Characters that are never ever allowed in a hostname.\n    // Note that any invalid chars are also handled, but these\n    // are the ones that are *expected* to be seen, so we fast-path\n    // them.\n    nonHostChars = ['%', '/', '?', ';', '#'].concat(autoEscape),\n    hostEndingChars = ['/', '?', '#'],\n    hostnameMaxLen = 255,\n    hostnamePartPattern = /^[+a-z0-9A-Z_-]{0,63}$/,\n    hostnamePartStart = /^([+a-z0-9A-Z_-]{0,63})(.*)$/,\n    // protocols that can allow \"unsafe\" and \"unwise\" chars.\n    unsafeProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that never have a hostname.\n    hostlessProtocol = {\n      'javascript': true,\n      'javascript:': true\n    },\n    // protocols that always contain a // bit.\n    slashedProtocol = {\n      'http': true,\n      'https': true,\n      'ftp': true,\n      'gopher': true,\n      'file': true,\n      'http:': true,\n      'https:': true,\n      'ftp:': true,\n      'gopher:': true,\n      'file:': true\n    },\n    querystring = require('querystring');\n\nfunction urlParse(url, parseQueryString, slashesDenoteHost) {\n  if (url && util.isObject(url) && url instanceof Url) return url;\n\n  var u = new Url;\n  u.parse(url, parseQueryString, slashesDenoteHost);\n  return u;\n}\n\nUrl.prototype.parse = function(url, parseQueryString, slashesDenoteHost) {\n  if (!util.isString(url)) {\n    throw new TypeError(\"Parameter 'url' must be a string, not \" + typeof url);\n  }\n\n  // Copy chrome, IE, opera backslash-handling behavior.\n  // Back slashes before the query string get converted to forward slashes\n  // See: https://code.google.com/p/chromium/issues/detail?id=25916\n  var queryIndex = url.indexOf('?'),\n      splitter =\n          (queryIndex !== -1 && queryIndex < url.indexOf('#')) ? '?' : '#',\n      uSplit = url.split(splitter),\n      slashRegex = /\\\\/g;\n  uSplit[0] = uSplit[0].replace(slashRegex, '/');\n  url = uSplit.join(splitter);\n\n  var rest = url;\n\n  // trim before proceeding.\n  // This is to support parse stuff like \"  http://foo.com  \\n\"\n  rest = rest.trim();\n\n  if (!slashesDenoteHost && url.split('#').length === 1) {\n    // Try fast path regexp\n    var simplePath = simplePathPattern.exec(rest);\n    if (simplePath) {\n      this.path = rest;\n      this.href = rest;\n      this.pathname = simplePath[1];\n      if (simplePath[2]) {\n        this.search = simplePath[2];\n        if (parseQueryString) {\n          this.query = querystring.parse(this.search.substr(1));\n        } else {\n          this.query = this.search.substr(1);\n        }\n      } else if (parseQueryString) {\n        this.search = '';\n        this.query = {};\n      }\n      return this;\n    }\n  }\n\n  var proto = protocolPattern.exec(rest);\n  if (proto) {\n    proto = proto[0];\n    var lowerProto = proto.toLowerCase();\n    this.protocol = lowerProto;\n    rest = rest.substr(proto.length);\n  }\n\n  // figure out if it's got a host\n  // user@server is *always* interpreted as a hostname, and url\n  // resolution will treat //foo/bar as host=foo,path=bar because that's\n  // how the browser resolves relative URLs.\n  if (slashesDenoteHost || proto || rest.match(/^\\/\\/[^@\\/]+@[^@\\/]+/)) {\n    var slashes = rest.substr(0, 2) === '//';\n    if (slashes && !(proto && hostlessProtocol[proto])) {\n      rest = rest.substr(2);\n      this.slashes = true;\n    }\n  }\n\n  if (!hostlessProtocol[proto] &&\n      (slashes || (proto && !slashedProtocol[proto]))) {\n\n    // there's a hostname.\n    // the first instance of /, ?, ;, or # ends the host.\n    //\n    // If there is an @ in the hostname, then non-host chars *are* allowed\n    // to the left of the last @ sign, unless some host-ending character\n    // comes *before* the @-sign.\n    // URLs are obnoxious.\n    //\n    // ex:\n    // http://a@b@c/ => user:a@b host:c\n    // http://a@b?@c => user:a host:c path:/?@c\n\n    // v0.12 TODO(isaacs): This is not quite how Chrome does things.\n    // Review our test case against browsers more comprehensively.\n\n    // find the first instance of any hostEndingChars\n    var hostEnd = -1;\n    for (var i = 0; i < hostEndingChars.length; i++) {\n      var hec = rest.indexOf(hostEndingChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n\n    // at this point, either we have an explicit point where the\n    // auth portion cannot go past, or the last @ char is the decider.\n    var auth, atSign;\n    if (hostEnd === -1) {\n      // atSign can be anywhere.\n      atSign = rest.lastIndexOf('@');\n    } else {\n      // atSign must be in auth portion.\n      // http://a@b/c@d => host:b auth:a path:/c@d\n      atSign = rest.lastIndexOf('@', hostEnd);\n    }\n\n    // Now we have a portion which is definitely the auth.\n    // Pull that off.\n    if (atSign !== -1) {\n      auth = rest.slice(0, atSign);\n      rest = rest.slice(atSign + 1);\n      this.auth = decodeURIComponent(auth);\n    }\n\n    // the host is the remaining to the left of the first non-host char\n    hostEnd = -1;\n    for (var i = 0; i < nonHostChars.length; i++) {\n      var hec = rest.indexOf(nonHostChars[i]);\n      if (hec !== -1 && (hostEnd === -1 || hec < hostEnd))\n        hostEnd = hec;\n    }\n    // if we still have not hit it, then the entire thing is a host.\n    if (hostEnd === -1)\n      hostEnd = rest.length;\n\n    this.host = rest.slice(0, hostEnd);\n    rest = rest.slice(hostEnd);\n\n    // pull out port.\n    this.parseHost();\n\n    // we've indicated that there is a hostname,\n    // so even if it's empty, it has to be present.\n    this.hostname = this.hostname || '';\n\n    // if hostname begins with [ and ends with ]\n    // assume that it's an IPv6 address.\n    var ipv6Hostname = this.hostname[0] === '[' &&\n        this.hostname[this.hostname.length - 1] === ']';\n\n    // validate a little.\n    if (!ipv6Hostname) {\n      var hostparts = this.hostname.split(/\\./);\n      for (var i = 0, l = hostparts.length; i < l; i++) {\n        var part = hostparts[i];\n        if (!part) continue;\n        if (!part.match(hostnamePartPattern)) {\n          var newpart = '';\n          for (var j = 0, k = part.length; j < k; j++) {\n            if (part.charCodeAt(j) > 127) {\n              // we replace non-ASCII char with a temporary placeholder\n              // we need this to make sure size of hostname is not\n              // broken by replacing non-ASCII by nothing\n              newpart += 'x';\n            } else {\n              newpart += part[j];\n            }\n          }\n          // we test again with ASCII char only\n          if (!newpart.match(hostnamePartPattern)) {\n            var validParts = hostparts.slice(0, i);\n            var notHost = hostparts.slice(i + 1);\n            var bit = part.match(hostnamePartStart);\n            if (bit) {\n              validParts.push(bit[1]);\n              notHost.unshift(bit[2]);\n            }\n            if (notHost.length) {\n              rest = '/' + notHost.join('.') + rest;\n            }\n            this.hostname = validParts.join('.');\n            break;\n          }\n        }\n      }\n    }\n\n    if (this.hostname.length > hostnameMaxLen) {\n      this.hostname = '';\n    } else {\n      // hostnames are always lower case.\n      this.hostname = this.hostname.toLowerCase();\n    }\n\n    if (!ipv6Hostname) {\n      // IDNA Support: Returns a punycoded representation of \"domain\".\n      // It only converts parts of the domain name that\n      // have non-ASCII characters, i.e. it doesn't matter if\n      // you call it with a domain that already is ASCII-only.\n      this.hostname = punycode.toASCII(this.hostname);\n    }\n\n    var p = this.port ? ':' + this.port : '';\n    var h = this.hostname || '';\n    this.host = h + p;\n    this.href += this.host;\n\n    // strip [ and ] from the hostname\n    // the host field still retains them, though\n    if (ipv6Hostname) {\n      this.hostname = this.hostname.substr(1, this.hostname.length - 2);\n      if (rest[0] !== '/') {\n        rest = '/' + rest;\n      }\n    }\n  }\n\n  // now rest is set to the post-host stuff.\n  // chop off any delim chars.\n  if (!unsafeProtocol[lowerProto]) {\n\n    // First, make 100% sure that any \"autoEscape\" chars get\n    // escaped, even if encodeURIComponent doesn't think they\n    // need to be.\n    for (var i = 0, l = autoEscape.length; i < l; i++) {\n      var ae = autoEscape[i];\n      if (rest.indexOf(ae) === -1)\n        continue;\n      var esc = encodeURIComponent(ae);\n      if (esc === ae) {\n        esc = escape(ae);\n      }\n      rest = rest.split(ae).join(esc);\n    }\n  }\n\n\n  // chop off from the tail first.\n  var hash = rest.indexOf('#');\n  if (hash !== -1) {\n    // got a fragment string.\n    this.hash = rest.substr(hash);\n    rest = rest.slice(0, hash);\n  }\n  var qm = rest.indexOf('?');\n  if (qm !== -1) {\n    this.search = rest.substr(qm);\n    this.query = rest.substr(qm + 1);\n    if (parseQueryString) {\n      this.query = querystring.parse(this.query);\n    }\n    rest = rest.slice(0, qm);\n  } else if (parseQueryString) {\n    // no query string, but parseQueryString still requested\n    this.search = '';\n    this.query = {};\n  }\n  if (rest) this.pathname = rest;\n  if (slashedProtocol[lowerProto] &&\n      this.hostname && !this.pathname) {\n    this.pathname = '/';\n  }\n\n  //to support http.request\n  if (this.pathname || this.search) {\n    var p = this.pathname || '';\n    var s = this.search || '';\n    this.path = p + s;\n  }\n\n  // finally, reconstruct the href based on what has been validated.\n  this.href = this.format();\n  return this;\n};\n\n// format a parsed object into a url string\nfunction urlFormat(obj) {\n  // ensure it's an object, and not a string url.\n  // If it's an obj, this is a no-op.\n  // this way, you can call url_format() on strings\n  // to clean up potentially wonky urls.\n  if (util.isString(obj)) obj = urlParse(obj);\n  if (!(obj instanceof Url)) return Url.prototype.format.call(obj);\n  return obj.format();\n}\n\nUrl.prototype.format = function() {\n  var auth = this.auth || '';\n  if (auth) {\n    auth = encodeURIComponent(auth);\n    auth = auth.replace(/%3A/i, ':');\n    auth += '@';\n  }\n\n  var protocol = this.protocol || '',\n      pathname = this.pathname || '',\n      hash = this.hash || '',\n      host = false,\n      query = '';\n\n  if (this.host) {\n    host = auth + this.host;\n  } else if (this.hostname) {\n    host = auth + (this.hostname.indexOf(':') === -1 ?\n        this.hostname :\n        '[' + this.hostname + ']');\n    if (this.port) {\n      host += ':' + this.port;\n    }\n  }\n\n  if (this.query &&\n      util.isObject(this.query) &&\n      Object.keys(this.query).length) {\n    query = querystring.stringify(this.query);\n  }\n\n  var search = this.search || (query && ('?' + query)) || '';\n\n  if (protocol && protocol.substr(-1) !== ':') protocol += ':';\n\n  // only the slashedProtocols get the //.  Not mailto:, xmpp:, etc.\n  // unless they had them to begin with.\n  if (this.slashes ||\n      (!protocol || slashedProtocol[protocol]) && host !== false) {\n    host = '//' + (host || '');\n    if (pathname && pathname.charAt(0) !== '/') pathname = '/' + pathname;\n  } else if (!host) {\n    host = '';\n  }\n\n  if (hash && hash.charAt(0) !== '#') hash = '#' + hash;\n  if (search && search.charAt(0) !== '?') search = '?' + search;\n\n  pathname = pathname.replace(/[?#]/g, function(match) {\n    return encodeURIComponent(match);\n  });\n  search = search.replace('#', '%23');\n\n  return protocol + host + pathname + search + hash;\n};\n\nfunction urlResolve(source, relative) {\n  return urlParse(source, false, true).resolve(relative);\n}\n\nUrl.prototype.resolve = function(relative) {\n  return this.resolveObject(urlParse(relative, false, true)).format();\n};\n\nfunction urlResolveObject(source, relative) {\n  if (!source) return relative;\n  return urlParse(source, false, true).resolveObject(relative);\n}\n\nUrl.prototype.resolveObject = function(relative) {\n  if (util.isString(relative)) {\n    var rel = new Url();\n    rel.parse(relative, false, true);\n    relative = rel;\n  }\n\n  var result = new Url();\n  var tkeys = Object.keys(this);\n  for (var tk = 0; tk < tkeys.length; tk++) {\n    var tkey = tkeys[tk];\n    result[tkey] = this[tkey];\n  }\n\n  // hash is always overridden, no matter what.\n  // even href=\"\" will remove it.\n  result.hash = relative.hash;\n\n  // if the relative url is empty, then there's nothing left to do here.\n  if (relative.href === '') {\n    result.href = result.format();\n    return result;\n  }\n\n  // hrefs like //foo/bar always cut to the protocol.\n  if (relative.slashes && !relative.protocol) {\n    // take everything except the protocol from relative\n    var rkeys = Object.keys(relative);\n    for (var rk = 0; rk < rkeys.length; rk++) {\n      var rkey = rkeys[rk];\n      if (rkey !== 'protocol')\n        result[rkey] = relative[rkey];\n    }\n\n    //urlParse appends trailing / to urls like http://www.example.com\n    if (slashedProtocol[result.protocol] &&\n        result.hostname && !result.pathname) {\n      result.path = result.pathname = '/';\n    }\n\n    result.href = result.format();\n    return result;\n  }\n\n  if (relative.protocol && relative.protocol !== result.protocol) {\n    // if it's a known url protocol, then changing\n    // the protocol does weird things\n    // first, if it's not file:, then we MUST have a host,\n    // and if there was a path\n    // to begin with, then we MUST have a path.\n    // if it is file:, then the host is dropped,\n    // because that's known to be hostless.\n    // anything else is assumed to be absolute.\n    if (!slashedProtocol[relative.protocol]) {\n      var keys = Object.keys(relative);\n      for (var v = 0; v < keys.length; v++) {\n        var k = keys[v];\n        result[k] = relative[k];\n      }\n      result.href = result.format();\n      return result;\n    }\n\n    result.protocol = relative.protocol;\n    if (!relative.host && !hostlessProtocol[relative.protocol]) {\n      var relPath = (relative.pathname || '').split('/');\n      while (relPath.length && !(relative.host = relPath.shift()));\n      if (!relative.host) relative.host = '';\n      if (!relative.hostname) relative.hostname = '';\n      if (relPath[0] !== '') relPath.unshift('');\n      if (relPath.length < 2) relPath.unshift('');\n      result.pathname = relPath.join('/');\n    } else {\n      result.pathname = relative.pathname;\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    result.host = relative.host || '';\n    result.auth = relative.auth;\n    result.hostname = relative.hostname || relative.host;\n    result.port = relative.port;\n    // to support http.request\n    if (result.pathname || result.search) {\n      var p = result.pathname || '';\n      var s = result.search || '';\n      result.path = p + s;\n    }\n    result.slashes = result.slashes || relative.slashes;\n    result.href = result.format();\n    return result;\n  }\n\n  var isSourceAbs = (result.pathname && result.pathname.charAt(0) === '/'),\n      isRelAbs = (\n          relative.host ||\n          relative.pathname && relative.pathname.charAt(0) === '/'\n      ),\n      mustEndAbs = (isRelAbs || isSourceAbs ||\n                    (result.host && relative.pathname)),\n      removeAllDots = mustEndAbs,\n      srcPath = result.pathname && result.pathname.split('/') || [],\n      relPath = relative.pathname && relative.pathname.split('/') || [],\n      psychotic = result.protocol && !slashedProtocol[result.protocol];\n\n  // if the url is a non-slashed url, then relative\n  // links like ../.. should be able\n  // to crawl up to the hostname, as well.  This is strange.\n  // result.protocol has already been set by now.\n  // Later on, put the first path part into the host field.\n  if (psychotic) {\n    result.hostname = '';\n    result.port = null;\n    if (result.host) {\n      if (srcPath[0] === '') srcPath[0] = result.host;\n      else srcPath.unshift(result.host);\n    }\n    result.host = '';\n    if (relative.protocol) {\n      relative.hostname = null;\n      relative.port = null;\n      if (relative.host) {\n        if (relPath[0] === '') relPath[0] = relative.host;\n        else relPath.unshift(relative.host);\n      }\n      relative.host = null;\n    }\n    mustEndAbs = mustEndAbs && (relPath[0] === '' || srcPath[0] === '');\n  }\n\n  if (isRelAbs) {\n    // it's absolute.\n    result.host = (relative.host || relative.host === '') ?\n                  relative.host : result.host;\n    result.hostname = (relative.hostname || relative.hostname === '') ?\n                      relative.hostname : result.hostname;\n    result.search = relative.search;\n    result.query = relative.query;\n    srcPath = relPath;\n    // fall through to the dot-handling below.\n  } else if (relPath.length) {\n    // it's relative\n    // throw away the existing file, and take the new path instead.\n    if (!srcPath) srcPath = [];\n    srcPath.pop();\n    srcPath = srcPath.concat(relPath);\n    result.search = relative.search;\n    result.query = relative.query;\n  } else if (!util.isNullOrUndefined(relative.search)) {\n    // just pull out the search.\n    // like href='?foo'.\n    // Put this after the other two cases because it simplifies the booleans\n    if (psychotic) {\n      result.hostname = result.host = srcPath.shift();\n      //occationaly the auth can get stuck only in host\n      //this especially happens in cases like\n      //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n      var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                       result.host.split('@') : false;\n      if (authInHost) {\n        result.auth = authInHost.shift();\n        result.host = result.hostname = authInHost.shift();\n      }\n    }\n    result.search = relative.search;\n    result.query = relative.query;\n    //to support http.request\n    if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n      result.path = (result.pathname ? result.pathname : '') +\n                    (result.search ? result.search : '');\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  if (!srcPath.length) {\n    // no path at all.  easy.\n    // we've already handled the other stuff above.\n    result.pathname = null;\n    //to support http.request\n    if (result.search) {\n      result.path = '/' + result.search;\n    } else {\n      result.path = null;\n    }\n    result.href = result.format();\n    return result;\n  }\n\n  // if a url ENDs in . or .., then it must get a trailing slash.\n  // however, if it ends in anything else non-slashy,\n  // then it must NOT get a trailing slash.\n  var last = srcPath.slice(-1)[0];\n  var hasTrailingSlash = (\n      (result.host || relative.host || srcPath.length > 1) &&\n      (last === '.' || last === '..') || last === '');\n\n  // strip single dots, resolve double dots to parent dir\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = srcPath.length; i >= 0; i--) {\n    last = srcPath[i];\n    if (last === '.') {\n      srcPath.splice(i, 1);\n    } else if (last === '..') {\n      srcPath.splice(i, 1);\n      up++;\n    } else if (up) {\n      srcPath.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (!mustEndAbs && !removeAllDots) {\n    for (; up--; up) {\n      srcPath.unshift('..');\n    }\n  }\n\n  if (mustEndAbs && srcPath[0] !== '' &&\n      (!srcPath[0] || srcPath[0].charAt(0) !== '/')) {\n    srcPath.unshift('');\n  }\n\n  if (hasTrailingSlash && (srcPath.join('/').substr(-1) !== '/')) {\n    srcPath.push('');\n  }\n\n  var isAbsolute = srcPath[0] === '' ||\n      (srcPath[0] && srcPath[0].charAt(0) === '/');\n\n  // put the host back\n  if (psychotic) {\n    result.hostname = result.host = isAbsolute ? '' :\n                                    srcPath.length ? srcPath.shift() : '';\n    //occationaly the auth can get stuck only in host\n    //this especially happens in cases like\n    //url.resolveObject('mailto:local1@domain1', 'local2@domain2')\n    var authInHost = result.host && result.host.indexOf('@') > 0 ?\n                     result.host.split('@') : false;\n    if (authInHost) {\n      result.auth = authInHost.shift();\n      result.host = result.hostname = authInHost.shift();\n    }\n  }\n\n  mustEndAbs = mustEndAbs || (result.host && srcPath.length);\n\n  if (mustEndAbs && !isAbsolute) {\n    srcPath.unshift('');\n  }\n\n  if (!srcPath.length) {\n    result.pathname = null;\n    result.path = null;\n  } else {\n    result.pathname = srcPath.join('/');\n  }\n\n  //to support request.http\n  if (!util.isNull(result.pathname) || !util.isNull(result.search)) {\n    result.path = (result.pathname ? result.pathname : '') +\n                  (result.search ? result.search : '');\n  }\n  result.auth = relative.auth || result.auth;\n  result.slashes = result.slashes || relative.slashes;\n  result.href = result.format();\n  return result;\n};\n\nUrl.prototype.parseHost = function() {\n  var host = this.host;\n  var port = portPattern.exec(host);\n  if (port) {\n    port = port[0];\n    if (port !== ':') {\n      this.port = port.substr(1);\n    }\n    host = host.substr(0, host.length - port.length);\n  }\n  if (host) this.hostname = host;\n};\n","import { LoggingFunction } from './types'\n\nexport default class ResourceLogging {\n  private buffer: string[] | null = []\n  private loggingFunction: LoggingFunction = (text) => {\n    if (this.buffer) this.buffer.push(text)\n  }\n\n  public log: LoggingFunction = (text) => {\n    this.loggingFunction(text)\n  }\n\n  setLoggingFunction = (fn: LoggingFunction) => {\n    this.loggingFunction = fn\n    if (this.buffer) {\n      this.buffer.forEach((text) => fn(text))\n      this.buffer = null\n    }\n  }\n}\n","\r\n/**\r\n * Represents compressed file before extraction\r\n */\r\nexport class CompressedFile{\r\n\r\n    constructor(name,size,path,archiveRef){\r\n        this._name = name;\r\n        this._size = size;\r\n        this._path = path;\r\n        this._archiveRef = archiveRef;\r\n    }\r\n\r\n    /**\r\n     * file name\r\n     */\r\n    get name(){\r\n        return this._name;\r\n    }\r\n    /**\r\n     * file size\r\n     */\r\n    get size(){\r\n        return this._size;\r\n    }\r\n\r\n    /**\r\n     * Extract file from archive\r\n     * @returns {Promise<File>} extracted file\r\n     */\r\n    extract(){\r\n        return this._archiveRef.extractSingleFile(this._path);\r\n    }\r\n\r\n}","import { CompressedFile } from \"./compressed-file.js\";\r\n\r\n\r\nexport class Archive{\r\n\r\n    /**\r\n     * Initialize libarchivejs\r\n     * @param {Object} options \r\n     */\r\n    static init(options = {}){\r\n        Archive._options = {\r\n            workerUrl: '../dist/worker-bundle.js',\r\n            ...options\r\n        };\r\n        return Archive._options;\r\n    }\r\n\r\n    /**\r\n     * Creates new archive instance from browser native File object\r\n     * @param {File} file\r\n     * @param {object} options\r\n     * @returns {Archive}\r\n     */\r\n    static open(file, options = null){\r\n        options =   options || \r\n                    Archive._options || \r\n                    Archive.init() && console.warn('Automatically initializing using options: ', Archive._options);\r\n        const arch = new Archive(file,options);\r\n        return arch.open();\r\n    }\r\n\r\n    /**\r\n     * Create new archive\r\n     * @param {File} file \r\n     * @param {Object} options \r\n     */\r\n    constructor(file,options){\r\n        this._worker = new Worker(options.workerUrl);\r\n        this._worker.addEventListener('message', this._workerMsg.bind(this));\r\n        this._callbacks = [];\r\n        this._content = {};\r\n        this._processed = 0;\r\n        this._file = file;\r\n    }\r\n\r\n    /**\r\n     * Prepares file for reading\r\n     * @returns {Promise<Archive>} archive instance\r\n     */\r\n    async open(){\r\n        await this._postMessage({type: 'HELLO'},(resolve,reject,msg) => {\r\n            if( msg.type === 'READY' ){\r\n                resolve();\r\n            }\r\n        });\r\n        return await this._postMessage({type: 'OPEN', file: this._file}, (resolve,reject,msg) => {\r\n            if(msg.type === 'OPENED'){\r\n                resolve(this);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * detect if archive has encrypted data\r\n     * @returns {boolean|null} null if could not be determined\r\n     */\r\n    hasEncryptedData(){\r\n        return this._postMessage({type: 'CHECK_ENCRYPTION'}, \r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'ENCRYPTION_STATUS' ){\r\n                    resolve(msg.status);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set password to be used when reading archive\r\n     */\r\n    usePassword(archivePassword){\r\n        return this._postMessage({type: 'SET_PASSPHRASE', passphrase: archivePassword},\r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'PASSPHRASE_STATUS' ){\r\n                    resolve(msg.status);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns object containing directory structure and file information \r\n     * @returns {Promise<object>}\r\n     */\r\n    getFilesObject(){\r\n        if( this._processed > 0 ){\r\n            return Promise.resolve().then( () => this._content );\r\n        }\r\n        return this._postMessage({type: 'LIST_FILES'}, (resolve,reject,msg) => {\r\n            if( msg.type === 'ENTRY' ){\r\n                const entry = msg.entry;\r\n                const [ target, prop ] = this._getProp(this._content,entry.path);\r\n                if( entry.type === 'FILE' ){\r\n                    target[prop] = new CompressedFile(entry.fileName,entry.size,entry.path,this);                    \r\n                }\r\n                return true;\r\n            }else if( msg.type === 'END' ){\r\n                this._processed = 1;\r\n                resolve(this._cloneContent(this._content));\r\n            }\r\n        });\r\n    }\r\n\r\n    getFilesArray(){\r\n        return this.getFilesObject().then( (obj) => {\r\n            return this._objectToArray(obj);\r\n        });\r\n    }\r\n\r\n    extractSingleFile(target){\r\n        return this._postMessage({type: 'EXTRACT_SINGLE_FILE', target: target}, \r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'FILE' ){\r\n                    const file = new File([msg.entry.fileData], msg.entry.fileName, {\r\n                        type: 'application/octet-stream'\r\n                    });\r\n                    resolve(file);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns object containing directory structure and extracted File objects \r\n     * @param {Function} extractCallback\r\n     * \r\n     */\r\n    extractFiles(extractCallback){\r\n        if( this._processed > 1 ){\r\n            return Promise.resolve().then( () => this._content );\r\n        }\r\n        return this._postMessage({type: 'EXTRACT_FILES'}, (resolve,reject,msg) => {\r\n            if( msg.type === 'ENTRY' ){\r\n                const [ target, prop ] = this._getProp(this._content,msg.entry.path);\r\n                if( msg.entry.type === 'FILE' ){\r\n                    target[prop] = new File([msg.entry.fileData], msg.entry.fileName, {\r\n                        type: 'application/octet-stream'\r\n                    });\r\n                    if (extractCallback !== undefined) {\r\n                        setTimeout(extractCallback.bind(null,{\r\n                            file: target[prop],\r\n                            path: msg.entry.path,\r\n                        }));\r\n                    }\r\n                }\r\n                return true;\r\n            }else if( msg.type === 'END' ){\r\n                this._processed = 2;\r\n                this._worker.terminate();\r\n                resolve(this._cloneContent(this._content));\r\n            }\r\n        });\r\n    }\r\n\r\n    _cloneContent(obj){\r\n        if( obj instanceof File || obj instanceof CompressedFile || obj === null ) return obj;\r\n        const o = {};\r\n        for( const prop of Object.keys(obj) ){\r\n            o[prop] = this._cloneContent(obj[prop]);\r\n        }\r\n        return o;\r\n    }\r\n\r\n    _objectToArray(obj,path = ''){\r\n        const files = [];\r\n        for( const key of Object.keys(obj) ){\r\n            if( obj[key] instanceof File || obj[key] instanceof CompressedFile || obj[key] === null ){\r\n                files.push({\r\n                    file: obj[key] || key,\r\n                    path: path\r\n                });\r\n            }else{\r\n                files.push( ...this._objectToArray(obj[key],`${path}${key}/`) );\r\n            }\r\n        }\r\n        return files;\r\n    }\r\n\r\n    _getProp(obj,path){\r\n        const parts = path.split('/');\r\n        if( parts[parts.length -1] === '' ) parts.pop();\r\n        let cur = obj, prev = null;\r\n        for( const part of parts ){\r\n            cur[part] = cur[part] || {};\r\n            prev = cur;\r\n            cur = cur[part];\r\n        }\r\n        return [ prev, parts[parts.length-1] ];\r\n    }\r\n\r\n    _postMessage(msg,callback){\r\n        this._worker.postMessage(msg);\r\n        return new Promise((resolve,reject) => {\r\n            this._callbacks.push( this._msgHandler.bind(this,callback,resolve,reject) );\r\n        });\r\n    }\r\n\r\n    _msgHandler(callback,resolve,reject,msg){\r\n        if( msg.type === 'BUSY' ){\r\n            reject('worker is busy');\r\n        }else if( msg.type === 'ERROR' ){\r\n            reject(msg.error);\r\n        }else{\r\n            return callback(resolve,reject,msg);\r\n        }\r\n    }\r\n\r\n    _workerMsg({data: msg}){\r\n        const callback = this._callbacks[this._callbacks.length -1];\r\n        const next = callback(msg);\r\n        if( !next ){\r\n            this._callbacks.pop();\r\n        }\r\n    }\r\n\r\n}","import { Archive } from 'libarchive.js/main.js'\nimport { addUnprefixed } from './addUnprefixed'\nimport { FileEntry } from './types'\n\nArchive.init({\n  workerUrl: '/vendor/libarchive.js-1.3.0/dist/worker-bundle.js',\n})\n\nexport async function unarchive(file: File): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const archive = await Archive.open(file)\n  const extracted = await archive.extractFiles()\n  const traverse = (tree: any, prefix = '') => {\n    for (const key of Object.keys(tree)) {\n      if (tree[key] instanceof File) {\n        addUnprefixed(prefix, key, (name) => {\n          out.push({ name, file: tree[key] })\n        })\n      } else if (tree[key] && typeof tree[key] === 'object') {\n        traverse(tree[key], prefix + key + '/')\n      }\n    }\n  }\n  traverse(extracted)\n  return out\n}\n","import * as ProgressUtils from 'bemuse/progress/utils'\nimport {\n  FileEntry,\n  LoggingFunction,\n  IResource,\n  ICustomSongResources,\n} from './types'\nimport ResourceLogging from './resource-logging'\nimport { unarchive } from './unarchiver'\nimport readBlob from 'bemuse/utils/read-blob'\nimport Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\n\nexport const ARCHIVE_REGEXP = /\\.(?:zip|rar|7z|tar(?:\\.(?:gz|bz2))?)/i\n\n// http://nekokan.dyndns.info/tool/DropboxReplacer/index.html\nconst DROPBOX_REGEXP =\n  /https?:\\/\\/(?:(?:www|dl)\\.dropbox\\.com|dl\\.dropboxusercontent\\.com)\\/(sh?)\\/([^?]*)(.*)?$/\n\n/**\n * A resource provider for custom songs.\n * It may retrieve the files from, e.g., a drag and drop event or an `?archive` flag.\n */\nexport interface CustomResourceProvider {\n  getFiles(loggingFunction: LoggingFunction): PromiseLike<FileEntry[]>\n}\n\n/**\n * An IResources for songs provided by a CustomResourceProvider.\n */\nexport class CustomSongResources implements ICustomSongResources {\n  private _logging = new ResourceLogging()\n  private _files: PromiseLike<FileEntry[]>\n  public setLoggingFunction = this._logging.setLoggingFunction\n\n  constructor(provider: CustomResourceProvider) {\n    this._files = Promise.resolve(provider.getFiles(this._logging.log)).then(\n      (files) => unarchiveIfNeeded(files, this._logging.log)\n    )\n  }\n\n  file(name: string) {\n    return this._files.then(function (files) {\n      for (const file of files) {\n        if (file.name.toLowerCase() === name.toLowerCase()) {\n          return new FileResource(file.file)\n        }\n      }\n      throw new Error('unable to find ' + name)\n    })\n  }\n\n  get fileList(): Promise<string[]> {\n    return Promise.resolve(this._files).then((a) => a.map((f) => f.name))\n  }\n}\n\nexport class FileResource implements IResource {\n  constructor(private _file: File) {}\n  read(progress: Progress) {\n    return ProgressUtils.atomic(\n      progress,\n      readBlob(this._file).as('arraybuffer')\n    )\n  }\n\n  resolveUrl() {\n    return Promise.resolve(URL.createObjectURL(this._file))\n  }\n\n  get name() {\n    return this._file.name\n  }\n}\n\n/**\n * If only 1 FileEntry is present and it is an archive file, extract it.\n */\nexport async function unarchiveIfNeeded(\n  files: FileEntry[],\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  if (files.length !== 1) return files\n  const fileEntry = files[0]\n  if (!fileEntry.name.match(ARCHIVE_REGEXP)) {\n    return files\n  }\n  log('Archive file detected! Now unarchiving')\n  return unarchive(fileEntry.file)\n}\n\n/**\n * Downloads a URL as a FileEntry.\n */\nexport async function downloadFileEntryFromURL(\n  url: string,\n  log: LoggingFunction\n): Promise<FileEntry> {\n  const name = url\n    .replace(/[?#].*/, '')\n    .split('/')\n    .pop()!\n\n  // Try Dropbox URL replacement\n  const match = url.match(DROPBOX_REGEXP)\n  if (match) {\n    url = `https://dl.dropboxusercontent.com/${match[1]}/${match[2]}`\n  }\n\n  const progress = new Progress()\n  let lastTime = 0\n  progress.watch(() => {\n    if (Date.now() < lastTime + 5e3) return\n    log(`Downloading: ${progress}`)\n    lastTime = Date.now()\n  })\n  const blob = await download(url).as('blob', progress)\n  return { name, file: blob }\n}\n","import throat from 'throat'\n\ntype OGGDecodeEvent = {\n  data?: Float32Array[]\n  sampleRate: number\n  error?: any\n  eof?: boolean\n}\n\ntype OGGDecoder = {\n  decode(arrayBuffer: ArrayBuffer, callback: (e: OGGDecodeEvent) => void): void\n}\n\nlet decoderPromise: Promise<OGGDecoder>\n\nconst limit = throat(1)\n\nfunction getDecoder() {\n  if (!decoderPromise) {\n    decoderPromise = import(\n      // @ts-ignore\n      /* webpackChunkName: 'stbvorbis' */ 'raw-loader!./vendor/stbvorbis/stbvorbis-e6da5fe-NDEBUG.js'\n    )\n      .then((ns) => ns.default)\n      .then((src) => {\n        // eslint-disable-next-line no-eval\n        return (0, eval)(src + ';stbvorbis')\n      })\n  }\n  return decoderPromise\n}\n\n/**\n * Decodes an OGG file using stbvorbis.js.\n */\nexport async function decodeOGG(\n  audioContext: AudioContext,\n  arrayBuffer: ArrayBuffer\n) {\n  const stbvorbis = await getDecoder()\n  return limit(() => doDecodeOGG(stbvorbis, audioContext, arrayBuffer))\n}\n\nfunction doDecodeOGG(\n  stbvorbis: OGGDecoder,\n  audioContext: AudioContext,\n  arrayBuffer: ArrayBuffer\n) {\n  return new Promise<AudioBuffer>((resolve, reject) => {\n    const buffers: Float32Array[][] = []\n    let totalLength = 0\n    let sampleRate: number\n    stbvorbis.decode(arrayBuffer, function (e) {\n      if (e.data) {\n        sampleRate = e.sampleRate\n        buffers.push(e.data)\n        totalLength += e.data[0].length\n      }\n      if (e.error) {\n        const error =\n          e.error instanceof Error ? e.error : `stbvorbis.js Error: ${e.error}`\n        reject(error)\n      }\n      if (e.eof) {\n        resolve(createBuffer(audioContext, buffers, totalLength, sampleRate))\n      }\n    })\n  })\n}\n\nasync function createBuffer(\n  audioContext: AudioContext,\n  decodedChunks: Float32Array[][],\n  length: number,\n  sampleRate: number\n) {\n  if (!length) throw new Error(`stbvorbis.js Error: No length`)\n  if (!sampleRate) throw new Error(`stbvorbis.js Error: No sample rate`)\n  const numberOfChannels = decodedChunks[0].length\n  const audioBuffer = audioContext.createBuffer(\n    numberOfChannels,\n    length,\n    sampleRate\n  )\n  const channels: ChannelDataWriter[] = Array(audioBuffer.numberOfChannels)\n    .fill(null)\n    .map((_, ch) => new ChannelDataWriter(audioBuffer.getChannelData(ch)))\n  for (const chunk of decodedChunks) {\n    chunk.forEach((audioSamples, channelIndex) => {\n      channels[channelIndex].write(audioSamples)\n    })\n  }\n  return audioBuffer\n}\n\nclass ChannelDataWriter {\n  private offset = 0\n  constructor(private data: Float32Array) {}\n  write(audioSamples: Float32Array) {\n    // iOS Safari does not support `buf.copyToChannel(a, ch, track[ch])`, so we had to copy audio data sample-by-sample.\n    const { offset, data } = this\n    for (let i = 0; i < audioSamples.length; i++) {\n      data[i + offset] = audioSamples[i]\n    }\n    this.offset += audioSamples.length\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notechart = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar invariant_1 = __importDefault(require(\"invariant\"));\n__exportStar(require(\"./types\"), exports);\n/**\n * A notechart holds every info about a single player's note chart that the\n * game will ever need.\n */\nvar Notechart = /** @class */ (function () {\n    function Notechart(data, playerOptions) {\n        if (playerOptions === void 0) { playerOptions = {}; }\n        var _this = this;\n        var bmsNotes = data.notes, timing = data.timing, keysounds = data.keysounds, songInfo = data.songInfo, positioning = data.positioning, spacing = data.spacing, barLines = data.barLines, images = data.images, expertJudgmentWindow = data.expertJudgmentWindow, _a = data.landmineNotes, landmineNotes = _a === void 0 ? [] : _a;\n        (0, invariant_1.default)(bmsNotes, 'Expected \"data.notes\"');\n        (0, invariant_1.default)(timing, 'Expected \"data.timing\"');\n        (0, invariant_1.default)(keysounds, 'Expected \"data.keysounds\"');\n        (0, invariant_1.default)(songInfo, 'Expected \"data.songInfo\"');\n        (0, invariant_1.default)(positioning, 'Expected \"data.positioning\"');\n        (0, invariant_1.default)(spacing, 'Expected \"data.spacing\"');\n        (0, invariant_1.default)(barLines, 'Expected \"data.barLines\"');\n        this.expertJudgmentWindow = expertJudgmentWindow;\n        bmsNotes = this._preTransform(bmsNotes, playerOptions);\n        this._timing = timing;\n        this._positioning = positioning;\n        this._spacing = spacing;\n        this._keysounds = keysounds;\n        this._duration = 0;\n        this._notes = this._generatePlayableNotesFromBMS(bmsNotes);\n        this._landmines = this._generatePlayableNotesFromBMS(landmineNotes);\n        this._autos = this._generateAutoKeysoundEventsFromBMS(bmsNotes);\n        this._barLines = this._generateBarLineEvents(barLines);\n        this._samples = this._generateKeysoundFiles(keysounds);\n        this._infos = new Map(this._notes.map(function (note) { return [note, _this._getNoteInfo(note)]; }));\n        this._songInfo = songInfo;\n        this._images = images;\n    }\n    Object.defineProperty(Notechart.prototype, \"notes\", {\n        /**\n         * An Array of note events.\n         */\n        get: function () {\n            return this._notes;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"landmines\", {\n        /**\n         * An Array of landmines events.\n         */\n        get: function () {\n            return this._landmines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"autos\", {\n        /**\n         * An Array of auto-keysound events.\n         */\n        get: function () {\n            return this._autos;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"samples\", {\n        /**\n         * An Array of all the sample files to use.\n         */\n        get: function () {\n            return this._samples;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"keysounds\", {\n        /**\n         * An Object containing the mapping from keysound ID to keysound filename.\n         */\n        get: function () {\n            return this._keysounds.all();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"barLines\", {\n        /**\n         * An Object representing the bar line events.\n         */\n        get: function () {\n            return this._barLines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"columns\", {\n        /**\n         * An Array of all column names in this notechart.\n         */\n        get: function () {\n            return ['SC', '1', '2', '3', '4', '5', '6', '7'];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"duration\", {\n        /**\n         * Notechart's duration (time of last event)\n         */\n        get: function () {\n            return this._duration;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"songInfo\", {\n        /**\n         * Notechart's song info\n         */\n        get: function () {\n            return this._songInfo;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"eyecatchImage\", {\n        /**\n         * Eyecatch image\n         */\n        get: function () {\n            return (this._images && this._images.eyecatch) || 'eyecatch_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"backgroundImage\", {\n        /**\n         * Background image\n         */\n        get: function () {\n            return (this._images && this._images.background) || 'back_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the characteristic of the note as an Object.\n     */\n    Notechart.prototype.info = function (note) {\n        return this._infos.get(note);\n    };\n    /**\n     * Converts the beat number to in-song position (seconds)\n     */\n    Notechart.prototype.beatToSeconds = function (beat) {\n        return this._timing.beatToSeconds(beat);\n    };\n    /**\n     * Converts the beat number to in-game position.\n     */\n    Notechart.prototype.beatToPosition = function (beat) {\n        return this._positioning.position(beat);\n    };\n    /**\n     * Converts measure number to beat.\n     */\n    Notechart.prototype.measureToBeat = function (measure) {\n        return (this._barLines[measure] || this._barLines[this._barLines.length - 1]).beat;\n    };\n    /**\n     * Converts the in-song position to beat number.\n     */\n    Notechart.prototype.secondsToBeat = function (seconds) {\n        return this._timing.secondsToBeat(seconds);\n    };\n    /**\n     * Converts the in-song position to in-game position.\n     */\n    Notechart.prototype.secondsToPosition = function (seconds) {\n        return this.beatToPosition(this.secondsToBeat(seconds));\n    };\n    /**\n     * Finds BPM at the specified beat.\n     */\n    Notechart.prototype.bpmAtBeat = function (beat) {\n        return this._timing.bpmAtBeat(beat);\n    };\n    /**\n     * Finds the scrolling speed at the specified beat.\n     */\n    Notechart.prototype.scrollSpeedAtBeat = function (beat) {\n        return this._positioning.speed(beat);\n    };\n    /**\n     * Calculates the note spacing factor at the specified beat.\n     */\n    Notechart.prototype.spacingAtBeat = function (beat) {\n        return this._spacing.factor(beat);\n    };\n    /**\n     * Gets the keyMode from scratch\n     * @param scratch\n     * @returns {string}\n     */\n    Notechart.prototype.getKeyMode = function (scratch) {\n        var e_1, _a;\n        var usedColumns = {};\n        try {\n            for (var _b = __values(this.notes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var note = _c.value;\n                usedColumns[note.column] = true;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        if (scratch === 'off' && !usedColumns['1'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'left' && !usedColumns['6'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'right' && !usedColumns['1'] && !usedColumns['2'])\n            return '5K';\n        return '7K';\n    };\n    Notechart.prototype._preTransform = function (bmsNotes, playerOptions) {\n        var chain = lodash_1.default.chain(bmsNotes);\n        var keys = getKeys(bmsNotes);\n        if (playerOptions.scratch === 'off') {\n            chain = chain.map(function (note) {\n                if (note.column && note.column === 'SC') {\n                    return Object.assign({}, note, { column: null });\n                }\n                else {\n                    return note;\n                }\n            });\n        }\n        if (keys === '5K') {\n            var columnsToShift_1 = ['1', '2', '3', '4', '5', '6', '7'];\n            var shiftNote = function (amount) { return function (note) {\n                if (note.column) {\n                    var index = columnsToShift_1.indexOf(note.column);\n                    if (index > -1) {\n                        var newIndex = index + amount;\n                        (0, invariant_1.default)(newIndex < columnsToShift_1.length, 'Weird. Columns must not shift beyond available column');\n                        var newColumn = columnsToShift_1[newIndex];\n                        return Object.assign({}, note, { column: newColumn });\n                    }\n                }\n                return note;\n            }; };\n            if (playerOptions.scratch === 'off') {\n                chain = chain.map(shiftNote(1));\n            }\n            else if (playerOptions.scratch === 'right') {\n                chain = chain.map(shiftNote(2));\n            }\n        }\n        return chain.value();\n    };\n    Notechart.prototype._generatePlayableNotesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            _this._updateDuration(spec);\n            if (note.endBeat !== undefined) {\n                spec.end = _this._generateEvent(note.endBeat);\n                _this._updateDuration(spec.end);\n            }\n            else {\n                spec.end = undefined;\n            }\n            return spec;\n        });\n    };\n    Notechart.prototype._generateLandminesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            _this._updateDuration(spec);\n            return spec;\n        });\n    };\n    Notechart.prototype._updateDuration = function (event) {\n        if (event.time > this._duration)\n            this._duration = event.time;\n    };\n    Notechart.prototype._generateAutoKeysoundEventsFromBMS = function (bmsNotes) {\n        var _this = this;\n        return bmsNotes\n            .filter(function (note) { return !note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            return spec;\n        });\n    };\n    Notechart.prototype._generateKeysoundFiles = function (keysounds) {\n        var e_2, _a, e_3, _b;\n        var set = new Set();\n        try {\n            for (var _c = __values([this.notes, this.autos]), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var array = _d.value;\n                try {\n                    for (var array_1 = (e_3 = void 0, __values(array)), array_1_1 = array_1.next(); !array_1_1.done; array_1_1 = array_1.next()) {\n                        var event_ = array_1_1.value;\n                        var file = keysounds.get(event_.keysound);\n                        if (file)\n                            set.add(file);\n                    }\n                }\n                catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                finally {\n                    try {\n                        if (array_1_1 && !array_1_1.done && (_b = array_1.return)) _b.call(array_1);\n                    }\n                    finally { if (e_3) throw e_3.error; }\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return Array.from(set);\n    };\n    Notechart.prototype._generateBarLineEvents = function (beats) {\n        var _this = this;\n        return beats.map(function (beat) { return _this._generateEvent(beat); });\n    };\n    Notechart.prototype._generateEvent = function (beat) {\n        return {\n            beat: beat,\n            time: this.beatToSeconds(beat),\n            position: this.beatToPosition(beat),\n        };\n    };\n    Notechart.prototype._getNoteInfo = function (note) {\n        return { combos: note.end ? 2 : 1 };\n    };\n    return Notechart;\n}());\nexports.Notechart = Notechart;\nexports.default = Notechart;\nfunction getKeys(bmsNotes) {\n    var e_4, _a;\n    try {\n        for (var bmsNotes_1 = __values(bmsNotes), bmsNotes_1_1 = bmsNotes_1.next(); !bmsNotes_1_1.done; bmsNotes_1_1 = bmsNotes_1.next()) {\n            var note = bmsNotes_1_1.value;\n            if (note.column === '6' || note.column === '7') {\n                return '7K';\n            }\n        }\n    }\n    catch (e_4_1) { e_4 = { error: e_4_1 }; }\n    finally {\n        try {\n            if (bmsNotes_1_1 && !bmsNotes_1_1.done && (_a = bmsNotes_1.return)) _a.call(bmsNotes_1);\n        }\n        finally { if (e_4) throw e_4.error; }\n    }\n    return '5K';\n}\n//# sourceMappingURL=index.js.map","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./GameShellScene.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./GameShellScene.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./GameShellScene.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".GameShellScene {\\n  margin: 20px auto;\\n  background: #353433;\\n  border: 1px solid #555453;\\n  padding: 15px;\\n  max-width: 720px;\\n}\\n.GameShellScene .drop-zone {\\n  border: 2px dashed #555453;\\n  padding: 5px;\\n}\\n.GameShellScene .drop-zone a.is-active {\\n  font-weight: bold;\\n}\\n.GameShellScene .drop-zone-hint {\\n  padding: 10px;\\n  text-align: center;\\n  color: #8b8685;\\n}\\n.GameShellScene form > div {\\n  margin-bottom: 1em;\\n}\\n.GameShellScene form > div.text .label {\\n  display: block;\\n  color: #8b8685;\\n  font-weight: bold;\\n  font-size: 0.8em;\\n  margin: 0;\\n  margin-bottom: 0.5ex;\\n}\\n.GameShellScene form > div.text input {\\n  font: inherit;\\n  display: block;\\n  width: 100%;\\n  box-sizing: border-box;\\n  border: 1px inset #555453;\\n  background: #252423;\\n  color: #bfb;\\n}\\n.GameShellScene form > div.text input:disabled {\\n  opacity: 0.2;\\n}\\n.GameShellScene form > div.checkbox input {\\n  margin-right: 1ex;\\n}\\n.GameShellScene form > div.radio > h3 {\\n  display: block;\\n  color: #8b8685;\\n  font-weight: bold;\\n  font-size: 0.8em;\\n  margin: 0;\\n  margin-bottom: 0.5ex;\\n}\\n.GameShellScene form > div.radio > label {\\n  display: block;\\n}\\n.GameShellScene form > div.radio input {\\n  margin-right: 1ex;\\n}\\n.GameShellScene button {\\n  background: #8b8685;\\n  border: 1px outset #aba6a5;\\n  font: inherit;\\n  font-size: 1.5em;\\n  color: #e9e8e7;\\n  display: block;\\n  width: 100%;\\n  box-sizing: border-box;\\n}\\n.GameShellScene a {\\n  color: #fed;\\n}\", \"\"]);\n\n// exports\n","// Touch3D mode -- inspired by Thapster.\n// Notes are arranged on a 3D arc that moves towards the screen.\n// Example: https://twitter.com/bemusegame/status/950505986409709569\n\n/** Parameters to the algorithm. These values are obtained by trial-and-error. */\nconst config = {\n  /** Centre point of the arc (X-coordinate) */\n  cx: 1024,\n  /** Centre point of the arc (Y-coordinate) */\n  cy: -975,\n  /** Radius of the arc */\n  r: 1024,\n  /** Beginning angle of the arc */\n  t0: 3.922,\n  /** Ending angle of the arc */\n  t1: 4.555,\n  /**\n   * Perspective value (field of view).\n   * Camera is placed at (p, 0, 0), facing towards (0, 0, 0).\n   * See: https://developer.mozilla.org/en-US/docs/Web/CSS/perspective\n   */\n  p: 960,\n  /** Width of the play area */\n  w: 60,\n}\n\n/**\n * Given the display position (0 representing top and 1 representing bottom),\n * calculates the onscreen position to display it.\n *\n * Screen size is hardcoded as 1280x720.\n *\n * @param position The display position (0 representing top and 1 representing bottom)\n * @return An object with\n *   - `y` A number represeting the onscreen position to display the note.\n *   - `projection` The projected scale. If an object is closer to the screen,\n *     it will appear bigger. This value represents that scale.\n */\nexport function getRow(position) {\n  const excess = Math.max(0, position - 1)\n  if (position < 0) position = 0\n  if (position > 1) position = 1\n  const theta = config.t0 + (config.t1 - config.t0) * position\n  const pointX = config.cx + Math.cos(theta) * config.r\n  const pointY = config.cy - Math.sin(theta) * config.r\n  const projection = config.p / (config.p - pointX)\n  const screenY = pointY * projection + 720 / 2\n  return { y: screenY + excess * 2048, projection }\n}\n\n/**\n * The world width of the play area.\n * Multiply this with the projection number to get the onscreen width.\n */\nexport const PLAY_AREA_WIDTH = config.w\n\n/**\n * Finds the touched column based on screen coordinate.\n *\n * @param {number} x The x onscreen coordinate (0~1280)\n * @param {number} y The y onscreen coordinate (0~1280)\n * @return Column name ('1'~'7') or `null` if no column should be triggered.\n */\nexport function getTouchedColumn(x, y) {\n  let min = 0.75\n  let max = 1\n  let mid\n  let row\n  for (let i = 0; i < 8; i++) {\n    mid = (min + max) / 2\n    row = getRow(mid)\n    if (row.y > y) {\n      max = mid\n    } else {\n      min = mid\n    }\n  }\n  if (mid < 0.8) return null\n  const x0 = 1280 / 2 + row.projection * -config.w\n  const x1 = 1280 / 2 + row.projection * config.w\n  let pos = Math.floor(((x - x0) / (x1 - x0)) * 7)\n  if (pos >= -1 && pos <= 7) {\n    if (pos < 0) pos = 0\n    if (pos > 6) pos = 6\n    return String(pos + 1)\n  }\n  return null\n}\n","import './BenchmarkPanel.scss'\nimport React from 'react'\nimport PropTypes from 'prop-types'\n\nexport default class BenchmarkPanel extends React.Component {\n  static propTypes = {\n    bench: PropTypes.object,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      show: false,\n      text: 'wow',\n    }\n  }\n\n  render() {\n    return (\n      <div\n        className='BenchmarkPanel'\n        onClick={this.handleInteraction}\n        onTouchStart={this.handleInteraction}\n      >\n        {this.state.show ? (\n          <article>\n            <b>Benchmark Stats</b>\n            <br />\n            {this.renderTable()}\n          </article>\n        ) : (\n          'Show Benchmark Stats'\n        )}\n      </div>\n    )\n  }\n\n  componentDidMount() {\n    setInterval(() => this.forceUpdate(), 1000)\n  }\n\n  renderTable = () => {\n    const stats = this.props.bench.stats\n    return (\n      <table>\n        <tbody>\n          {Object.keys(stats).map((key) => {\n            const stat = stats[key]\n            return (\n              <tr>\n                <td>\n                  <strong>{key}</strong>\n                </td>\n                <td align='right'>{'' + stat}</td>\n              </tr>\n            )\n          })}\n        </tbody>\n      </table>\n    )\n  }\n\n  handleInteraction = (e) => {\n    e.preventDefault()\n    e.stopPropagation()\n    this.setState({ show: !this.state.show })\n  }\n}\n","import now from 'bemuse/utils/now'\nimport { shouldEnableBenchmark } from './query-flags'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\nimport BenchmarkPanel from './ui/BenchmarkPanel'\n\nfunction Stat() {\n  let sum = 0\n  let count = 0\n  let average = 0\n  const hist = []\n  let lastSec = 0\n  let secAvg = 0\n  return {\n    push: function (delta) {\n      const t = now()\n      sum += delta\n      count += 1\n      average = sum / count\n      lastSec += delta\n      hist.push({ delta, time: t })\n      while (hist[0] && hist[0].time < t - 1000) {\n        lastSec -= hist.shift().delta\n      }\n      secAvg = lastSec / hist.length\n    },\n    toString() {\n      return format(average) + ' / ' + format(secAvg)\n    },\n  }\n}\n\nfunction format(x) {\n  return x.toFixed(2) + 'ms'\n}\n\nfunction Benchmarker() {\n  const stats = {}\n  const bench = {\n    enabled: true,\n    stats,\n    wrap(title, f) {\n      return function () {\n        const start = now()\n        try {\n          return f.apply(this, arguments)\n        } finally {\n          const finish = now()\n          const stat = stats[title] || (stats[title] = new Stat(title))\n          stat.push(finish - start)\n        }\n      }\n    },\n    benchmark(title, obj, name) {\n      obj[name] = this.wrap(title, obj[name])\n    },\n    toString() {\n      const lines = []\n      Object.keys(stats).forEach(function (key) {\n        lines.push('- ' + key + ': ' + stats[key])\n      })\n      return lines.join('\\n')\n    },\n  }\n  const div = document.createElement('div')\n  div.setAttribute('style', 'position:fixed;top:10px;right:10px;z-index:99999')\n  document.body.appendChild(div)\n  ReactDOM.render(<BenchmarkPanel bench={bench} />, div)\n  return bench\n}\n\nfunction FakeBenchmarker() {\n  return {\n    enabled: false,\n    wrap: (title, f) => f,\n  }\n}\n\nexport default window.BEMUSE_BENCHMARK = shouldEnableBenchmark()\n  ? new Benchmarker()\n  : new FakeBenchmarker()\n","import './GameShellScene.scss'\n\nimport DndResources from 'bemuse/resources/dnd-resources'\nimport PropTypes from 'prop-types'\nimport React from 'react'\nimport c from 'classnames'\n\nclass CustomChartSelector extends React.Component {\n  static propTypes = {\n    selectedResource: PropTypes.any,\n    onSelect: PropTypes.func,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      files: [],\n    }\n  }\n\n  render() {\n    const files = this.state.files\n    return (\n      <div className='drop-zone'>\n        {files.length ? (\n          <ul>\n            {files.map((file) => (\n              <li>\n                <a\n                  href='javascript://'\n                  onClick={this.handleItemClick}\n                  className={c({\n                    'is-active': file.resource === this.props.selectedResource,\n                  })}\n                >\n                  {file.name}\n                </a>\n              </li>\n            ))}\n            {this.props.selectedResource ? (\n              <li>\n                <a href='javascript://' onClick={this.handleClear}>\n                  Clear\n                </a>\n              </li>\n            ) : null}\n          </ul>\n        ) : (\n          <div className='drop-zone-hint'>\n            Drop BMS folder here\n            <br />\n            (only works on Google Chrome)\n          </div>\n        )}\n      </div>\n    )\n  }\n\n  handleDrop = (e) => {\n    e.preventDefault()\n    const event = e.nativeEvent\n    const resources = new DndResources(event)\n    resources.fileList\n      .then((list) => {\n        return list.filter((filename) => /\\.(bms|bme|bml)$/i.test(filename))\n      })\n      .map((name) =>\n        resources.file(name).then((resource) => ({ name, resource }))\n      )\n      .then((bms) => {\n        this.setState({ files: bms, resources: resources })\n      })\n      .catch((err) => {\n        if (err.constructor.name === 'FileError') {\n          throw new Error('File Error code ' + e.code)\n        } else {\n          throw err\n        }\n      })\n  }\n\n  handleItemClick = (file) => {\n    return () => {\n      this.props.onSelect(this.state.resources, file.resource)\n    }\n  }\n\n  handleClear = () => {\n    this.props.onSelect(null, null)\n  }\n}\n\nexport default class GameShellScene extends React.Component {\n  static propTypes = {\n    options: PropTypes.object,\n    play: PropTypes.func,\n  }\n\n  constructor(props) {\n    super(props)\n    this.state = {\n      options: this.props.options,\n    }\n  }\n\n  render() {\n    const options = this.state.options\n    return (\n      <div\n        className='GameShellScene'\n        onDragOver={this.handleDragOver}\n        onDrop={this.handleDrop}\n      >\n        <h1>Bemuse Game Shell</h1>\n        <p>This tool is intended for developers testing the game.</p>\n        <form onSubmit={this.submit}>\n          <div className='text'>\n            <label>\n              <span className='label'>BMS URL:</span>\n              <input\n                type='text'\n                disabled={options.resource}\n                onChange={this.bindOption((o, v) => (o.url = v))}\n                value={options.url}\n              />\n            </label>\n          </div>\n          <div className='text'>\n            <label>\n              <span className='label'>-or- Drop BMS folder here</span>\n              <CustomChartSelector\n                ref='dropzone'\n                selectedResource={options.resource}\n                onSelect={this.handleSelectFile}\n              />\n            </label>\n          </div>\n          <div className='text'>\n            <label>\n              <span className='label'>Audio-Input Latency</span>\n              <input\n                type='text'\n                onChange={this.bindOption(\n                  (o, v) => (o.game.audioInputLatency = v)\n                )}\n                value={options.game.audioInputLatency}\n              />\n            </label>\n          </div>\n          <div className='text'>\n            <label>\n              <span className='label'>HI-SPEED:</span>\n              <input\n                type='text'\n                onChange={this.bindOption((o, v) => (o.players[0].speed = v))}\n                value={options.players[0].speed}\n              />\n            </label>\n          </div>\n          <div className='radio'>\n            <h3>Placement</h3>\n            {['left', 'center', 'right'].map((placement) => (\n              <label>\n                <input\n                  type='radio'\n                  value={placement}\n                  onChange={this.bindOption(\n                    (o, v) => (o.players[0].placement = v)\n                  )}\n                  checked={options.players[0].placement === placement}\n                />\n                <span className='label'>{placement}</span>\n              </label>\n            ))}\n          </div>\n          <button type='submit'>Play</button>\n        </form>\n      </div>\n    )\n  }\n\n  submit = (e) => {\n    e.preventDefault()\n    this.props.play(this.state.options)\n  }\n\n  bindOption = (binder) => {\n    return (event) => {\n      binder(this.state.options, event.target.value)\n      this.forceUpdate()\n    }\n  }\n\n  handleDragOver = (e) => {\n    e.preventDefault()\n  }\n\n  handleDrop = (e) => {\n    e.preventDefault()\n    this.refs.dropzone.handleDrop(e)\n  }\n\n  handleSelectFile = (resources, resource) => {\n    this.setState({\n      options: Object.assign(this.state.options, { resources, resource }),\n    })\n    this.forceUpdate()\n  }\n}\n","import * as GameLoader from './loaders/game-loader'\n\nimport BemusePackageResources from 'bemuse/resources/bemuse-package'\nimport GameScene from './game-scene'\nimport GameShellScene from './ui/GameShellScene.jsx'\nimport LoadingScene from './ui/LoadingScene.jsx'\nimport React from 'react'\nimport SCENE_MANAGER from 'bemuse/scene-manager'\nimport URLResource from 'bemuse/resources/url'\nimport audioContext from 'bemuse/audio-context'\nimport query from 'bemuse/utils/query'\nimport { resolveUrl } from 'url'\nimport { unmuteAudio } from 'bemuse/sampling-master'\n\nexport async function main() {\n  // iOS\n  window.addEventListener('touchstart', function unmute() {\n    unmuteAudio(audioContext)\n    window.removeEventListener('touchstart', unmute)\n  })\n\n  const displayShell = function (options) {\n    return new Promise(function (resolve) {\n      const scene = React.createElement(GameShellScene, {\n        options: options,\n        play: function (data) {\n          resolve(data)\n        },\n      })\n      SCENE_MANAGER.display(scene)\n    })\n  }\n\n  const getSong = async function () {\n    const kbm = (query.keyboard || '').split(',').map((x) => +x)\n    let options = {\n      url: query.bms || '/music/[snack]dddd/dddd_sph.bme',\n      game: {\n        audioInputLatency: +query.latency || 0,\n      },\n      players: [\n        {\n          speed: +query.speed || 3,\n          autoplay: !!query.autoplay,\n          placement: 'center',\n          scratch: query.scratch || 'left',\n          input: {\n            keyboard: {\n              1: kbm[0] || 83,\n              2: kbm[1] || 68,\n              3: kbm[2] || 70,\n              4: kbm[3] || 32,\n              5: kbm[4] || 74,\n              6: kbm[5] || 75,\n              7: kbm[6] || 76,\n              SC: kbm[7] || 65,\n              SC2: kbm[8] || 16,\n            },\n          },\n        },\n      ],\n    }\n    options = await displayShell(options)\n    const url = options.url\n    const assetsUrl = resolveUrl(url, 'assets/')\n    const metadata = {\n      title: 'Loading',\n      subtitles: [],\n      artist: '',\n      genre: '',\n      subartists: [],\n    }\n    return {\n      bms: options.resource || new URLResource(url),\n      assets: options.resources || new BemusePackageResources(assetsUrl),\n      metadata: metadata,\n      options: Object.assign({}, options.game, { players: options.players }),\n    }\n  }\n\n  const loadSpec = await getSong()\n  const { tasks, promise } = GameLoader.load(loadSpec)\n  await SCENE_MANAGER.display(\n    React.createElement(LoadingScene, {\n      tasks: tasks,\n      song: loadSpec.metadata,\n    })\n  )\n  const controller = await promise\n  await SCENE_MANAGER.display(new GameScene(controller.display))\n  controller.start()\n}\n","import MAIN from 'bemuse/utils/main-element'\nimport React from 'react'\nimport ReactDOM from 'react-dom'\n\n// The SceneManager takes care of managing the scenes in this game.\n// Only a single scene may be displayed at any given time, but a scene may\n// contain any number of UI elements.\n//\n// A scene is a React component that renders a ``<Scene>``::\n//\n//    export default React.createClass({\n//      render() {\n//        return <Scene>contents</Scene>\n//      }\n//    })\n//\n// Behind the scene, are using some advanced techniques which requires\n// the scene class to be declared using ``React.createClass`` (not by extending\n// ``React.Component``)\n//\n// To use the SceneManager, get the instance and use it::\n//\n//    import SCENE_MANAGER from 'bemuse/scene-manager'\n//    import TitleScene from './TitleScene'\n//    SCENE_MANAGER.display(<TitleScene />)\n//\n// Non-React Scene\n//   You can also use a scene that is not React-based. Define your scene\n//   as a function that accepts an HTMLElement and returns an object with a\n//   ``teardown()`` method.\n//\nexport class SceneManager {\n  constructor() {\n    this._transitioning = false\n    this._stack = []\n  }\n\n  // Displays the scene and returns a promise that resolves when the old\n  // scene finishes exiting.\n  display(scene) {\n    return this._transitionTo(() => {\n      return scene\n    })\n  }\n\n  // Displays the scene, while remembering the previous scene.\n  push(scene) {\n    const previousScene = this.currentScene\n    return this._transitionTo(() => {\n      this._stack.push(previousScene)\n      return scene\n    })\n  }\n\n  // Displays the previous scene.\n  pop() {\n    return this._transitionTo(() => {\n      return this._stack.pop()\n    })\n  }\n\n  async _transitionTo(getNextScene) {\n    if (this._transitioning) throw new Error('Scene is transitioning!')\n    try {\n      this._transitioning = true\n\n      // detach the previous scene\n      if (this.currentSceneInstance) {\n        await Promise.resolve(this.currentSceneInstance.teardown())\n        detach(this.currentElement)\n      }\n\n      // obtain the next scene\n      let scene = getNextScene()\n\n      // coerce react elements\n      if (typeof scene !== 'function') {\n        scene = new ReactScene(scene, this.ReactSceneContainer)\n      }\n\n      // set up the next scene\n      const element = document.createElement('div')\n      element.className = 'scene-manager--scene'\n      MAIN.appendChild(element)\n      this.currentElement = element\n      this.currentScene = scene\n      this.currentSceneInstance = scene(element)\n    } finally {\n      this._transitioning = false\n    }\n  }\n}\n\nfunction detach(element) {\n  if (element && element.parentNode === MAIN) {\n    MAIN.removeChild(element)\n  }\n}\n\n// The shared SceneManager instance.\nexport const instance = new SceneManager()\n\nexport default instance\n\nfunction ReactScene(element, ReactSceneContainer) {\n  return function instantiate(container) {\n    let teardown = async () => {}\n    const clonedElement = React.cloneElement(element, {\n      scene: element,\n      registerTeardownCallback: (callback) => {\n        teardown = callback\n      },\n    })\n    const elementToDisplay = ReactSceneContainer ? (\n      <ReactSceneContainer>{clonedElement}</ReactSceneContainer>\n    ) : (\n      clonedElement\n    )\n    ReactDOM.render(elementToDisplay, container)\n    return {\n      async teardown() {\n        try {\n          return await teardown()\n        } finally {\n          ReactDOM.unmountComponentAtNode(container)\n        }\n      },\n    }\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getReaderOptionsFromFilename = exports.readAsync = exports.read = void 0;\nvar chardet = require(\"bemuse-chardet/bemuse-chardet\");\nfunction read(buffer) {\n    throw new Error('Synchronous read unsupported in browser!');\n}\nexports.read = read;\nfunction readAsync() {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n    }\n    var buffer = args[0];\n    var options = args[1];\n    var charset = (options && options.forceEncoding) || chardet.detect(buffer);\n    return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function () {\n            resolve(reader.result);\n        };\n        reader.onerror = function () {\n            reject(new Error('cannot read it'));\n        };\n        reader.readAsText(new Blob([buffer]), charset);\n    });\n}\nexports.readAsync = readAsync;\nvar getReaderOptionsFromFilename_1 = require(\"./getReaderOptionsFromFilename\");\nObject.defineProperty(exports, \"getReaderOptionsFromFilename\", { enumerable: true, get: function () { return getReaderOptionsFromFilename_1.getReaderOptionsFromFilename; } });\n//# sourceMappingURL=index.web.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getReaderOptionsFromFilename = void 0;\n/**\n * Given the filename, returns the reader options.\n * @param {string} filename\n */\nfunction getReaderOptionsFromFilename(filename) {\n    var forceEncoding;\n    if (filename.match(/\\.sjis\\.\\w+$/i)) {\n        forceEncoding = 'Shift-JIS';\n    }\n    if (filename.match(/\\.euc_kr\\.\\w+$/i)) {\n        forceEncoding = 'EUC-KR';\n    }\n    if (filename.match(/\\.utf8\\.\\w+$/i)) {\n        forceEncoding = 'UTF-8';\n    }\n    return { forceEncoding: forceEncoding };\n}\nexports.getReaderOptionsFromFilename = getReaderOptionsFromFilename;\n//# sourceMappingURL=getReaderOptionsFromFilename.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.compile = void 0;\n// Public: A module that takes a string representing the BMS notechart,\n// parses it, and compiles into a {BMSChart}.\n/* module */\nvar match_1 = require(\"../util/match\");\nvar chart_1 = require(\"../bms/chart\");\nvar matchers = {\n    bms: {\n        random: /^#RANDOM\\s+(\\d+)$/i,\n        if: /^#IF\\s+(\\d+)$/i,\n        endif: /^#ENDIF$/i,\n        timeSignature: /^#(\\d\\d\\d)02:(\\S*)$/,\n        channel: /^#(?:EXT\\s+#)?(\\d\\d\\d)(\\S\\S):(\\S*)$/,\n        header: /^#(\\w+)(?:\\s+(\\S.*))?$/,\n    },\n    dtx: {\n        random: /^#RANDOM\\s+(\\d+)$/i,\n        if: /^#IF\\s+(\\d+)$/i,\n        endif: /^#ENDIF$/i,\n        timeSignature: /^#(\\d\\d\\d)02:\\s*(\\S*)$/,\n        channel: /^#(?:EXT\\s+#)?(\\d\\d\\d)(\\S\\S):\\s*(\\S*)$/,\n        header: /^#(\\w+):(?:\\s+(\\S.*))?$/,\n    },\n};\n/**\n * Reads the string representing the BMS notechart, parses it,\n * and compiles into a {BMSChart}.\n * @param text the BMS notechart\n * @param options additional parser options\n */\nfunction compile(text, options) {\n    options = options || {};\n    var chart = new chart_1.BMSChart();\n    var rng = options.rng ||\n        function (max) {\n            return 1 + Math.floor(Math.random() * max);\n        };\n    var matcher = (options.format && matchers[options.format]) || matchers.bms;\n    var randomStack = [];\n    var skipStack = [false];\n    var result = {\n        headerSentences: 0,\n        channelSentences: 0,\n        controlSentences: 0,\n        skippedSentences: 0,\n        malformedSentences: 0,\n        /**\n         * The resulting chart\n         */\n        chart: chart,\n        /**\n         * Warnings found during compilation\n         */\n        warnings: [],\n    };\n    eachLine(text, function (text, lineNumber) {\n        var flow = true;\n        if (text.charAt(0) !== '#')\n            return;\n        (0, match_1.match)(text)\n            .when(matcher.random, function (m) {\n            result.controlSentences += 1;\n            randomStack.push(rng(+m[1]));\n        })\n            .when(matcher.if, function (m) {\n            result.controlSentences += 1;\n            skipStack.push(randomStack[randomStack.length - 1] !== +m[1]);\n        })\n            .when(matcher.endif, function (m) {\n            result.controlSentences += 1;\n            skipStack.pop();\n        })\n            .else(function () {\n            flow = false;\n        });\n        if (flow)\n            return;\n        var skipped = skipStack[skipStack.length - 1];\n        (0, match_1.match)(text)\n            .when(matcher.timeSignature, function (m) {\n            result.channelSentences += 1;\n            if (!skipped)\n                chart.timeSignatures.set(+m[1], +m[2]);\n        })\n            .when(matcher.channel, function (m) {\n            result.channelSentences += 1;\n            if (!skipped)\n                handleChannelSentence(+m[1], m[2], m[3], lineNumber);\n        })\n            .when(matcher.header, function (m) {\n            result.headerSentences += 1;\n            if (!skipped)\n                chart.headers.set(m[1], m[2]);\n        })\n            .else(function () {\n            warn(lineNumber, 'Invalid command');\n        });\n    });\n    return result;\n    function handleChannelSentence(measure, channel, string, lineNumber) {\n        var items = Math.floor(string.length / 2);\n        if (items === 0)\n            return;\n        for (var i = 0; i < items; i++) {\n            var value = string.substr(i * 2, 2);\n            var fraction = i / items;\n            if (value === '00')\n                continue;\n            chart.objects.add({\n                measure: measure,\n                fraction: fraction,\n                value: value,\n                channel: channel,\n                lineNumber: lineNumber,\n            });\n        }\n    }\n    function warn(lineNumber, message) {\n        result.warnings.push({\n            lineNumber: lineNumber,\n            message: message,\n        });\n    }\n}\nexports.compile = compile;\nfunction eachLine(text, callback) {\n    text\n        .split(/\\r\\n|\\r|\\n/)\n        .map(function (line) {\n        return line.trim();\n    })\n        .forEach(function (line, index) {\n        callback(line, index + 1);\n    });\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Segment = void 0;\nvar data_structure_1 = __importDefault(require(\"data-structure\"));\nexports.Segment = (0, data_structure_1.default)({\n    t: 'number',\n    x: 'number',\n    dx: 'number',\n});\n//# sourceMappingURL=segment.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notes = void 0;\nvar note_1 = require(\"./note\");\nvar invariant_1 = __importDefault(require(\"invariant\"));\nvar ChannelMapping = __importStar(require(\"./channels\"));\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A Notes holds the {Note} objects in the game.\n * A note object may or may not be playable.\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #00111:AA\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {Notes} using `fromBMSChart()`:\n *\n * ```js\n * var notes = Notes.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can get all notes using `.all()` method\n *\n * ```js\n * notes.all()\n * ```\n */\nvar Notes = /** @class */ (function () {\n    /**\n     * @param {BMSNote[]} notes An array of Note objects\n     */\n    function Notes(notes) {\n        notes.forEach(note_1.Note);\n        this._notes = notes;\n    }\n    /**\n     * Returns the number of notes in this object,\n     * counting both playable and non-playable notes.\n     */\n    Notes.prototype.count = function () {\n        return this._notes.length;\n    };\n    /**\n     * Returns an Array of all notes.\n     */\n    Notes.prototype.all = function () {\n        return this._notes.slice();\n    };\n    /**\n     * Creates a Notes object from a BMSChart.\n     * @param chart the chart to process\n     * @param options options\n     */\n    Notes.fromBMSChart = function (chart, options) {\n        void chart_1.BMSChart;\n        options = options || {};\n        var mapping = options.mapping || Notes.CHANNEL_MAPPING.IIDX_P1;\n        var builder = new BMSNoteBuilder(chart, { mapping: mapping });\n        return builder.build();\n    };\n    Notes.CHANNEL_MAPPING = ChannelMapping;\n    return Notes;\n}());\nexports.Notes = Notes;\nvar BMSNoteBuilder = /** @class */ (function () {\n    function BMSNoteBuilder(chart, options) {\n        this._chart = chart;\n        (0, invariant_1.default)(options.mapping, 'Expected options.mapping');\n        (0, invariant_1.default)(typeof options.mapping === 'object', 'options.mapping must be object');\n        this._mapping = options.mapping;\n        this._notes = [];\n        this._activeLN = {};\n        this._lastNote = {};\n        this._lnObj = (this._chart.headers.get('lnobj') || '').toLowerCase();\n        this._channelMapping = this._mapping;\n        this._objects = this._chart.objects.allSorted();\n    }\n    BMSNoteBuilder.prototype.build = function () {\n        var _this = this;\n        this._objects.forEach(function (object) {\n            _this._handle(object);\n        });\n        return new Notes(this._notes);\n    };\n    BMSNoteBuilder.prototype._handle = function (object) {\n        if (object.channel === '01') {\n            this._handleNormalNote(object);\n        }\n        else {\n            switch (object.channel.charAt(0).toUpperCase()) {\n                case '1':\n                case '2':\n                case 'D':\n                case 'E':\n                    this._handleNormalNote(object);\n                    break;\n                case '5':\n                case '6':\n                    this._handleLongNote(object);\n                    break;\n            }\n        }\n    };\n    BMSNoteBuilder.prototype._handleNormalNote = function (object) {\n        var channel = this._normalizeChannel(object.channel);\n        var beat = this._getBeat(object);\n        if (object.value.toLowerCase() === this._lnObj) {\n            if (this._lastNote[channel]) {\n                this._lastNote[channel].endBeat = beat;\n            }\n        }\n        else {\n            var note = {\n                beat: beat,\n                endBeat: undefined,\n                keysound: object.value,\n                column: this._getColumn(channel),\n            };\n            this._lastNote[channel] = note;\n            this._notes.push(note);\n        }\n    };\n    BMSNoteBuilder.prototype._handleLongNote = function (object) {\n        var channel = this._normalizeChannel(object.channel);\n        var beat = this._getBeat(object);\n        if (this._activeLN[channel]) {\n            var note = this._activeLN[channel];\n            note.endBeat = beat;\n            this._notes.push(note);\n            delete this._activeLN[channel];\n        }\n        else {\n            this._activeLN[channel] = {\n                beat: beat,\n                keysound: object.value,\n                column: this._getColumn(channel),\n            };\n        }\n    };\n    BMSNoteBuilder.prototype._getBeat = function (object) {\n        return this._chart.measureToBeat(object.measure, object.fraction);\n    };\n    BMSNoteBuilder.prototype._getColumn = function (channel) {\n        return this._channelMapping[channel];\n    };\n    BMSNoteBuilder.prototype._normalizeChannel = function (channel) {\n        return channel.replace(/^5/, '1').replace(/^6/, '2');\n    };\n    return BMSNoteBuilder;\n}());\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Note = void 0;\nvar data_structure_1 = __importDefault(require(\"data-structure\"));\nexports.Note = (0, data_structure_1.default)({\n    beat: 'number',\n    endBeat: data_structure_1.default.maybe('number'),\n    column: data_structure_1.default.maybe('string'),\n    keysound: 'string',\n});\n//# sourceMappingURL=note.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.IIDX_DP_LANDMINE = exports.IIDX_P1_LANDMINE = exports.IIDX_DP = exports.IIDX_P1 = void 0;\nexports.IIDX_P1 = {\n    '11': '1',\n    '12': '2',\n    '13': '3',\n    '14': '4',\n    '15': '5',\n    '18': '6',\n    '19': '7',\n    '16': 'SC',\n};\nexports.IIDX_DP = {\n    '11': '1',\n    '12': '2',\n    '13': '3',\n    '14': '4',\n    '15': '5',\n    '18': '6',\n    '19': '7',\n    '16': 'SC',\n    '21': '8',\n    '22': '9',\n    '23': '10',\n    '24': '11',\n    '25': '12',\n    '28': '13',\n    '29': '14',\n    '26': 'SC2',\n};\nexports.IIDX_P1_LANDMINE = {\n    D1: '1',\n    D2: '2',\n    D3: '3',\n    D4: '4',\n    D5: '5',\n    D8: '6',\n    D9: '7',\n    D6: 'SC',\n};\nexports.IIDX_DP_LANDMINE = {\n    D1: '1',\n    D2: '2',\n    D3: '3',\n    D4: '4',\n    D5: '5',\n    D8: '6',\n    D9: '7',\n    D6: 'SC',\n    E1: '8',\n    E2: '9',\n    E3: '10',\n    E4: '11',\n    E5: '12',\n    E8: '13',\n    E9: '14',\n    E6: 'SC2',\n};\n//# sourceMappingURL=channels.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Timing = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\nvar precedence = { bpm: 1, stop: 2 };\n/**\n * A Timing represents the timing information of a musical score.\n * A Timing object provides facilities to synchronize between\n * metric time (seconds) and musical time (beats).\n *\n * A Timing are created from a series of actions:\n *\n * - BPM changes.\n * - STOP action.\n */\nvar Timing = /** @class */ (function () {\n    /**\n     * Constructs a Timing with an initial BPM and specified actions.\n     *\n     * Generally, you would use `Timing.fromBMSChart` to create an instance\n     * from a BMSChart, but the constructor may also be used in other situations\n     * unrelated to the BMS file format. (e.g. bmson package)\n     */\n    function Timing(initialBPM, actions) {\n        var state = { bpm: initialBPM, beat: 0, seconds: 0 };\n        var segments = [];\n        segments.push({\n            t: 0,\n            x: 0,\n            dx: state.bpm / 60,\n            bpm: state.bpm,\n            inclusive: true,\n        });\n        actions = actions.slice();\n        actions.sort(function (a, b) {\n            return a.beat - b.beat || precedence[a.type] - precedence[b.type];\n        });\n        actions.forEach(function (action) {\n            var beat = action.beat;\n            var seconds = state.seconds + ((beat - state.beat) * 60) / state.bpm;\n            switch (action.type) {\n                case 'bpm':\n                    state.bpm = action.bpm;\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: state.bpm / 60,\n                        bpm: state.bpm,\n                        inclusive: true,\n                    });\n                    break;\n                case 'stop':\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: 0,\n                        bpm: state.bpm,\n                        inclusive: true,\n                    });\n                    seconds += ((action.stopBeats || 0) * 60) / state.bpm;\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: state.bpm / 60,\n                        bpm: state.bpm,\n                        inclusive: false,\n                    });\n                    break;\n                default:\n                    throw new Error('Unrecognized segment object!');\n            }\n            state.beat = beat;\n            state.seconds = seconds;\n        });\n        this._speedcore = new speedcore_1.Speedcore(segments);\n        this._eventBeats = (0, lodash_1.uniq)((0, lodash_1.map)(actions, function (action) { return action.beat; }));\n    }\n    /**\n     * Convert the given beat into seconds.\n     * @param {number} beat\n     */\n    Timing.prototype.beatToSeconds = function (beat) {\n        return this._speedcore.t(beat);\n    };\n    /**\n     * Convert the given second into beats.\n     * @param {number} seconds\n     */\n    Timing.prototype.secondsToBeat = function (seconds) {\n        return this._speedcore.x(seconds);\n    };\n    /**\n     * Returns the BPM at the specified beat.\n     * @param {number} beat\n     */\n    Timing.prototype.bpmAtBeat = function (beat) {\n        return this._speedcore.segmentAtX(beat).bpm;\n    };\n    /**\n     * Returns an array representing the beats where there are events.\n     */\n    Timing.prototype.getEventBeats = function () {\n        return this._eventBeats;\n    };\n    /**\n     * Creates a Timing instance from a BMSChart.\n     * @param {BMSChart} chart\n     */\n    Timing.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var actions = [];\n        chart.objects.all().forEach(function (object) {\n            var bpm;\n            var beat = chart.measureToBeat(object.measure, object.fraction);\n            if (object.channel === '03') {\n                bpm = parseInt(object.value, 16);\n                actions.push({ type: 'bpm', beat: beat, bpm: bpm });\n            }\n            else if (object.channel === '08') {\n                bpm = +chart.headers.get('bpm' + object.value);\n                if (!isNaN(bpm))\n                    actions.push({ type: 'bpm', beat: beat, bpm: bpm });\n            }\n            else if (object.channel === '09') {\n                var stopBeats = +chart.headers.get('stop' + object.value) / 48;\n                actions.push({ type: 'stop', beat: beat, stopBeats: stopBeats });\n            }\n        });\n        return new Timing(+chart.headers.get('bpm') || 60, actions);\n    };\n    return Timing;\n}());\nexports.Timing = Timing;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SongInfo = void 0;\nvar match_1 = require(\"../util/match\");\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A SongInfo represents the song info, such as title, artist, genre.\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #TITLE Exargon [HYPER]\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {SongInfo} using `fromBMSChart()`:\n *\n * ```js\n * var info = SongInfo.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can query the song information by accessing its properties.\n *\n * ```js\n * info.title     // => 'Exargon'\n * info.subtitles // => ['HYPER']\n * ```\n */\nvar SongInfo = /** @class */ (function () {\n    /**\n     * Constructs a SongInfo with given data\n     * @param info the properties to set on this new instance\n     */\n    function SongInfo(info) {\n        /** the song title */\n        this.title = 'NO TITLE';\n        /** the song artist */\n        this.artist = 'NO ARTIST';\n        /** the song genre */\n        this.genre = 'NO GENRE';\n        /**\n         * the song's subtitles, one line per element.\n         * The subtitle may be used to represent the difficulty name,\n         * such as NORMAL, HYPER, ANOTHER.\n         * @type {string[]}\n         */\n        this.subtitles = [];\n        /**\n         * the song's other artists, one artist per element.\n         * @type {string[]}\n         */\n        this.subartists = [];\n        /**\n         * the difficulty.\n         * Meaning of the number is same as BMS's [`#DIFFICULTY`](http:*hitkey.nekokan.dyndns.info/cmds.htm#DIFFICULTY) header.\n         *\n         * | difficulty | meaning  |\n         * | ----------:|:--------:|\n         * |          1 | BEGINNER |\n         * |          2 | NORMAL   |\n         * |          3 | HYPER    |\n         * |          4 | ANOTHER  |\n         * |          5 | INSANE   |\n         */\n        this.difficulty = 0;\n        /**\n         * the level of the song.\n         * When converted from a BMS chart, this is the value of `#PLAYLEVEL` header.\n         */\n        this.level = 0;\n        if (info)\n            (0, lodash_1.assign)(this, info);\n    }\n    /**\n     * Constructs a new {SongInfo} object from a {BMSChart}.\n     * @param chart A {BMSChart} to construct a {SongInfo} from\n     */\n    SongInfo.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var info = {};\n        var title = chart.headers.get('title');\n        var artist = chart.headers.get('artist');\n        var genre = chart.headers.get('genre');\n        var difficulty = +chart.headers.get('difficulty') || 0;\n        var level = +chart.headers.get('playlevel') || 0;\n        var subtitles = chart.headers.getAll('subtitle');\n        var subartists = chart.headers.getAll('subartist');\n        if (typeof title === 'string' && !subtitles) {\n            var extractSubtitle = function (m) {\n                title = m[1];\n                subtitles = [m[2]];\n            };\n            (0, match_1.match)(title)\n                .when(/^(.*\\S)\\s*-(.+?)-$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*(.+?)$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*\\((.+?)\\)$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*\\[(.+?)\\]$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*<(.+?)>$/, extractSubtitle);\n        }\n        if (title)\n            info.title = title;\n        if (artist)\n            info.artist = artist;\n        if (genre)\n            info.genre = genre;\n        if (subtitles)\n            info.subtitles = subtitles;\n        if (subartists)\n            info.subartists = subartists;\n        if (difficulty)\n            info.difficulty = difficulty;\n        if (level)\n            info.level = level;\n        return new SongInfo(info);\n    };\n    return SongInfo;\n}());\nexports.SongInfo = SongInfo;\n//# sourceMappingURL=index.js.map","\"use strict\";\n// Public: A module that exposes {Keysounds}\n/* module */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Keysounds = void 0;\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A simple mapping between keysounds ID and the file name.\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #WAVAA cat.wav\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {Keysounds} using `fromBMSChart()`:\n *\n * ```js\n * var keysounds = Keysounds.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can retrieve the filename using `.get()`:\n *\n * ```js\n * keysounds.get('aa') // => 'cat.wav'\n * ```\n */\nvar Keysounds = /** @class */ (function () {\n    function Keysounds(map) {\n        this._map = map;\n    }\n    /**\n     * Returns the keysound file at the specified ID.\n     * @param id the two-character keysound ID\n     * @returns the sound filename\n     */\n    Keysounds.prototype.get = function (id) {\n        return this._map[id.toLowerCase()];\n    };\n    /**\n     * Returns an array of unique filenames in this Keysounds object.\n     * @returns filenames array\n     */\n    Keysounds.prototype.files = function () {\n        return (0, lodash_1.uniq)((0, lodash_1.values)(this._map));\n    };\n    /**\n     * Returns a mapping from keysound ID to keysound filename.\n     *\n     * **Warning:** This method returns the internal data structure used\n     * in this Keysounds object. Do not mutate!\n     */\n    Keysounds.prototype.all = function () {\n        return this._map;\n    };\n    /**\n     * Constructs a new {Keysounds} object from a {BMSChart}.\n     * @param chart\n     */\n    Keysounds.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var map = {};\n        chart.headers.each(function (name, value) {\n            var match = name.match(/^wav(\\S\\S)$/i);\n            if (!match)\n                return;\n            map[match[1].toLowerCase()] = value;\n        });\n        return new Keysounds(map);\n    };\n    return Keysounds;\n}());\nexports.Keysounds = Keysounds;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Positioning = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A Positioning represents the relation between song beats and\n * display position, and provides a way to convert between them.\n *\n * In some rhythm games, the amount of scrolling per beat may be different.\n * StepManias `#SCROLL` segments is an example.\n */\nvar Positioning = /** @class */ (function () {\n    /**\n     * Constructs a Positioning from the given `segments`.\n     * @param segments\n     */\n    function Positioning(segments) {\n        this._speedcore = new speedcore_1.Speedcore(segments);\n    }\n    /**\n     * Returns the scrolling speed at specified beat.\n     * @param beat the beat number\n     */\n    Positioning.prototype.speed = function (beat) {\n        return this._speedcore.dx(beat);\n    };\n    /**\n     * Returns the total elapsed scrolling amount at specified beat.\n     * @param beat the beat number\n     */\n    Positioning.prototype.position = function (beat) {\n        return this._speedcore.x(beat);\n    };\n    /**\n     * Creates a {Positioning} object from the {BMSChart}.\n     * @param {BMSChart} chart A {BMSChart} to construct a {Positioning} from\n     */\n    Positioning.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var segments = [];\n        var x = 0;\n        segments.push({\n            t: 0,\n            x: x,\n            dx: 1,\n            inclusive: true,\n        });\n        chart.objects.allSorted().forEach(function (object) {\n            if (object.channel === 'SC') {\n                var beat = chart.measureToBeat(object.measure, object.fraction);\n                var dx = +chart.headers.get('scroll' + object.value);\n                if (isNaN(dx))\n                    return;\n                var previous = segments[segments.length - 1];\n                x += (beat - previous.t) * previous.dx;\n                if (beat === 0 && segments.length === 1) {\n                    segments[0].dx = dx;\n                }\n                else {\n                    segments.push({\n                        t: beat,\n                        x: x,\n                        dx: dx,\n                        inclusive: true,\n                    });\n                }\n            }\n        });\n        return new Positioning(segments);\n    };\n    return Positioning;\n}());\nexports.Positioning = Positioning;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Spacing = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * Public: A Spacing represents the relation between song beats and\n * notes spacing.\n *\n * In some rhythm games, such as Pump It Up!,\n * the speed (note spacing factor) may be adjusted by the notechart.\n * StepManias `#SPEED` segments is an example.\n */\nvar Spacing = /** @class */ (function () {\n    /**\n     * Constructs a Spacing from the given `segments`.\n     */\n    function Spacing(segments) {\n        if (segments.length > 0) {\n            this._speedcore = new speedcore_1.Speedcore(segments);\n        }\n    }\n    /**\n     * Returns the note spacing factor at the specified beat.\n     * @param beat the beat\n     */\n    Spacing.prototype.factor = function (beat) {\n        if (this._speedcore) {\n            return this._speedcore.x(beat);\n        }\n        else {\n            return 1;\n        }\n    };\n    /**\n     * Creates a {Spacing} object from the {BMSChart}.\n     *\n     * ## `#SPEED` and `#xxxSP`\n     *\n     * Speed is defined as keyframes. These keyframes will be linearly interpolated.\n     *\n     * ```\n     * #SPEED01 1.0\n     * #SPEED02 2.0\n     *\n     * #001SP:01010202\n     * ```\n     *\n     * In this example, the note spacing factor will gradually change\n     * from 1.0x at beat 1 to 2.0x at beat 2.\n     *\n     * Returns a {Spacing} object\n     *\n     * @param {BMSChart} chart the chart\n     */\n    Spacing.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var segments = [];\n        chart.objects.allSorted().forEach(function (object) {\n            if (object.channel === 'SP') {\n                var beat = chart.measureToBeat(object.measure, object.fraction);\n                var factor = +chart.headers.get('speed' + object.value);\n                if (isNaN(factor))\n                    return;\n                if (segments.length > 0) {\n                    var previous = segments[segments.length - 1];\n                    previous.dx = (factor - previous.x) / (beat - previous.t);\n                }\n                segments.push({\n                    t: beat,\n                    x: factor,\n                    dx: 0,\n                    inclusive: true,\n                });\n            }\n        });\n        if (segments.length > 0) {\n            segments.unshift({\n                t: 0,\n                x: segments[0].x,\n                dx: 0,\n                inclusive: true,\n            });\n        }\n        return new Spacing(segments);\n    };\n    return Spacing;\n}());\nexports.Spacing = Spacing;\n//# sourceMappingURL=index.js.map","let _enabled = false\n\nlet _lifecycleHandler = {\n  /** @returns {Promise<void>} */\n  pauseAt(t) {\n    throw new Error('Cannot pause: No lifecycle handler registered!')\n  },\n  /** @returns {void} */\n  unpause() {\n    throw new Error('Cannot unpause: No lifecycle handler registered!')\n  },\n  /** @returns {number} */\n  getScore() {\n    throw new Error('Cannot get score: No lifecycle handler registered!')\n  },\n}\n\n/**\n * Activates the test mode. In this mode,\n *\n * - An overlay will be displayed indicating the test mode.\n * - The following APIs will be available to facilitate automated testing:\n *     - `BemuseTestMode.pauseAt(t)` will make the game pause at time `t`.\n *     - `BemuseTestMode.unpause()` will unpause the game.\n * - Score submission is disabled.\n *\n * Note: Once test mode is activated, it cannot be deactivated for the rest of the game session.\n */\nexport function enableTestMode() {\n  if (!_enabled) {\n    _enabled = true\n    console.log('[Bemuse test mode enabled]')\n    const overlay = document.createElement('div')\n    overlay.setAttribute(\n      'style',\n      `\n        position: fixed;\n        top: 20px;\n        left: 20px;\n        font: 20px Comic Sans MS, sans-serif;\n        z-index: 99999;\n        background: rgba(0,0,0,0.5);\n        color: #0f0;\n        border: 2px solid #0f0;\n        padding: 4px;\n        pointer-events: none;\n      `\n    )\n    overlay.innerHTML = `\n      <strong>Test mode:</strong>\n      Bemuse is being controlled by automated test software.\n    `\n    document.body.appendChild(overlay)\n  }\n}\n\n/**\n * Registers a pause handler.\n * This allows the `pauseAt` and `unpause` APIs to be used.\n *\n * @param {typeof _lifecycleHandler} handler\n */\nexport function setGameLifecycleHandler(handler) {\n  console.log('[Bemuse test mode] A pause handler has been registered.')\n  _lifecycleHandler = handler\n}\n\n/**\n * Returns `true` if test mode is enabled, `false` otherwise.\n */\nexport function isTestModeEnabled() {\n  return !!_enabled\n}\n\n/**\n * Will schedule the game to pause at time `t`.\n *\n * @param {number} t The song time to pause in seconds\n * @returns {Promise<void>} A promise that will be resolved when the time is reached and game is paused.\n */\nexport function pauseAt(t) {\n  return _lifecycleHandler.pauseAt(t)\n}\n\n/**\n * Unpauses the game.\n */\nexport function unpause() {\n  return _lifecycleHandler.unpause()\n}\n\n/**\n * Returns the current score.\n */\nexport function getScore() {\n  return _lifecycleHandler.getScore()\n}\n","module.exports = function() {\n\tthrow new Error(\"define cannot be used indirect\");\n};\n","/* globals __webpack_amd_options__ */\nmodule.exports = __webpack_amd_options__;\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fromBMSChart = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar __1 = __importDefault(require(\"../\"));\n// Returns a new Notechart from a BMSChart.\nfunction fromBMSChart(bms, playerOptions) {\n    var notes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1,\n    }).all();\n    var landmineNotes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP_LANDMINE\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1_LANDMINE,\n    }).all();\n    var timing = BMS.Timing.fromBMSChart(bms);\n    var keysounds = BMS.Keysounds.fromBMSChart(bms);\n    var songInfo = BMS.SongInfo.fromBMSChart(bms);\n    var positioning = BMS.Positioning.fromBMSChart(bms);\n    var spacing = BMS.Spacing.fromBMSChart(bms);\n    var data = {\n        notes: notes,\n        landmineNotes: landmineNotes,\n        timing: timing,\n        keysounds: keysounds,\n        songInfo: songInfo,\n        positioning: positioning,\n        spacing: spacing,\n        barLines: generateBarLinesFromBMS(notes, bms),\n        expertJudgmentWindow: getJudgmentWindowFromBMS(bms),\n    };\n    return new __1.default(data, playerOptions);\n}\nexports.fromBMSChart = fromBMSChart;\nfunction getJudgmentWindowFromBMS(bms) {\n    // http://hitkey.nekokan.dyndns.info/diary1501.php\n    var rank = +bms.headers.get('rank') || 2;\n    if (rank === 0)\n        return [8, 24]; // Very Hard\n    if (rank === 1)\n        return [15, 30]; // Hard\n    if (rank === 3)\n        return [21, 60]; // Easy\n    return [18, 40]; // Normal\n}\nfunction generateBarLinesFromBMS(bmsNotes, bms) {\n    var max = lodash_1.default.max(bmsNotes.map(function (note) { return note.endBeat || note.beat; })) || 0;\n    var barLines = [0];\n    var currentBeat = 0;\n    var currentMeasure = 0;\n    do {\n        currentBeat += bms.timeSignatures.getBeats(currentMeasure);\n        currentMeasure += 1;\n        barLines.push(currentBeat);\n    } while (currentBeat <= max);\n    return barLines;\n}\n//# sourceMappingURL=BMSNotechartLoader.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","export function forModule(moduleName: string) {\n  return {\n    info: bindLogger(moduleName, 'info'),\n    warn: bindLogger(moduleName, 'warn'),\n    error: bindLogger(moduleName, 'error'),\n  }\n}\n\nfunction bindLogger(moduleName: string, level: 'info' | 'warn' | 'error') {\n  return (...args: any[]) => {\n    console.log(\n      `[${new Date().toJSON()}] [${moduleName}] [${level}] ${require('util').format(\n        ...args\n      )}`\n    )\n  }\n}\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports._slicesForNotesAndTiming = exports.beatForLoc = exports.timingInfoForBmson = exports.barLinesForBmson = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar utils = __importStar(require(\"./utils\"));\nfunction barLinesForBmson(bmson) {\n    var lines = bmson.lines;\n    return (0, lodash_1.default)(lines)\n        .map(function (_a) {\n        var y = _a.y;\n        return beatForLoc(y);\n    })\n        .sortBy()\n        .value();\n}\nexports.barLinesForBmson = barLinesForBmson;\nfunction timingInfoForBmson(bmson) {\n    return {\n        initialBPM: bmson.info.initBPM,\n        actions: __spreadArray(__spreadArray([], __read((bmson.bpmNotes || []).map(function (_a) {\n            var y = _a.y, v = _a.v;\n            return ({\n                type: 'bpm',\n                beat: beatForLoc(y),\n                bpm: v,\n            });\n        })), false), __read((bmson.stopNotes || []).map(function (_a) {\n            var y = _a.y, v = _a.v;\n            return ({\n                type: 'stop',\n                beat: beatForLoc(y),\n                stopBeats: beatForLoc(Math.floor(v)),\n            });\n        })), false),\n    };\n}\nexports.timingInfoForBmson = timingInfoForBmson;\nfunction beatForLoc(y) {\n    return y / 240;\n}\nexports.beatForLoc = beatForLoc;\nfunction slicesForNotesAndTiming(notes, timing) {\n    return utils.slicesForNotesAndTiming(notes, timing, {\n        beatForPulse: beatForLoc,\n    });\n}\nexports._slicesForNotesAndTiming = slicesForNotesAndTiming;\n//# sourceMappingURL=legacy.js.map","\"use strict\";\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.slicesForNotesAndTiming = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\n/**\n * Takes the notes for a certain `soundChannel` and returns instructions\n * on how to slice the keysound file, given the `y` position of a note.\n *\n * @param notes An {Array} of `notes` inside `bmson.soundChannel[i]`\n * @param timing The {BMS.Timing} object that corresponds to the bmson\n * @param options An {Object} of options with the following keys:\n *  * `beatForPulse` A {Function} used to resolve beat for a given pulse number\n * @returns an ES6 {Map} that maps `y` position of the note to an SoundSlice\n */\nfunction slicesForNotesAndTiming(notes, timing, options) {\n    var e_1, _a, e_2, _b;\n    var beatForPulse = options.beatForPulse;\n    var all = new Set();\n    var play = new Set();\n    var restart = new Set();\n    try {\n        for (var notes_1 = __values(notes), notes_1_1 = notes_1.next(); !notes_1_1.done; notes_1_1 = notes_1.next()) {\n            var _c = notes_1_1.value, x = _c.x, y = _c.y, c = _c.c;\n            all.add(y);\n            if (x) {\n                play.add(y);\n            }\n            if (!c) {\n                restart.add(y);\n            }\n        }\n    }\n    catch (e_1_1) { e_1 = { error: e_1_1 }; }\n    finally {\n        try {\n            if (notes_1_1 && !notes_1_1.done && (_a = notes_1.return)) _a.call(notes_1);\n        }\n        finally { if (e_1) throw e_1.error; }\n    }\n    var result = new Map();\n    var soundTime = null;\n    var mustAdd = true;\n    var t;\n    var lastAdded;\n    try {\n        for (var _d = __values(lodash_1.default.sortBy(__spreadArray([], __read(all), false))), _e = _d.next(); !_e.done; _e = _d.next()) {\n            var y = _e.value;\n            var t = timing.beatToSeconds(beatForPulse(y));\n            if (soundTime === null || restart.has(y)) {\n                soundTime = 0;\n            }\n            else {\n                soundTime += t - t;\n            }\n            var shouldAdd = mustAdd || play.has(y) || restart.has(y);\n            if (shouldAdd) {\n                if (lastAdded && !restart.has(y)) {\n                    lastAdded.keysoundEnd = soundTime;\n                }\n                var obj = { keysoundStart: soundTime, keysoundEnd: undefined };\n                result.set(y, obj);\n                lastAdded = obj;\n            }\n            mustAdd = play.has(y);\n            t = t;\n        }\n    }\n    catch (e_2_1) { e_2 = { error: e_2_1 }; }\n    finally {\n        try {\n            if (_e && !_e.done && (_b = _d.return)) _b.call(_d);\n        }\n        finally { if (e_2) throw e_2.error; }\n    }\n    return result;\n}\nexports.slicesForNotesAndTiming = slicesForNotesAndTiming;\n//# sourceMappingURL=utils.js.map","import Notechart from 'bemuse-notechart'\nimport { PlayerOptions } from 'bemuse-notechart/lib/types'\n\nexport type PlayerControlKeys =\n  | '1'\n  | '2'\n  | '3'\n  | '4'\n  | '5'\n  | '6'\n  | '7'\n  | 'SC'\n  | 'SC2'\n\nexport type PlayerOptionsPlacement = 'left' | 'center' | 'right' | '3d'\n\nexport type PlayerOptionsScratch = 'left' | 'right' | 'off'\n\nexport type PlayerOptionsGauge = 'off' | 'hope'\n\ntype PlayerOptionsInputMapping = {\n  keyboard: { [control in PlayerControlKeys]: string }\n  continuous: boolean\n  sensitivity: number\n}\n\ntype PlayerOptionsInternal = {\n  autoplayEnabled: boolean\n  autosound: boolean\n  speed: number\n  placement: PlayerOptionsPlacement\n  scratch: PlayerOptionsScratch\n  laneCover: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial: boolean\n}\n\nexport type PlayerOptionsInput = PlayerOptions & {\n  autoplayEnabled?: boolean\n  autosound?: boolean\n  speed: number\n  placement?: PlayerOptionsPlacement\n  laneCover?: number\n  gauge: PlayerOptionsGauge\n  input: PlayerOptionsInputMapping\n  tutorial?: boolean\n}\n\n/** The object representing the player's information, notechart and options. */\nexport class Player {\n  public readonly options: PlayerOptionsInternal\n  constructor(\n    public readonly notechart: Notechart,\n    public readonly number: number,\n    options: PlayerOptionsInput\n  ) {\n    this.options = {\n      autoplayEnabled: !!options.autoplayEnabled,\n      autosound: !!options.autosound,\n      speed: +options.speed,\n      placement: options.placement || 'center',\n      scratch: options.scratch || 'left',\n      input: options.input,\n      laneCover: +(options.laneCover || 0),\n      gauge: options.gauge,\n      tutorial: !!options.tutorial,\n    }\n  }\n\n  // An array of column names for this Notechart.\n  get columns() {\n    return this.notechart.columns\n  }\n}\n\nexport default Player\n","import * as Judgments from '../judgments'\n\nimport _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nconst getAccuracyScore = (accuracy: number) => Math.floor(accuracy * 500000)\nconst getComboScore = (sum: number, total: number) =>\n  Math.floor((sum * 55555) / total)\n\nexport class PlayerStats {\n  public totalCombo: number\n  public totalNotes: number\n  public combo: number\n  public maxCombo: number\n  public rawSumJudgmentWeight: number\n  public rawTotalComboScore: number\n  public rawSumComboScore: number\n  public counts: { [k in Judgments.JudgedJudgment]: number }\n  public numJudgments: number\n  public poor: boolean\n  public deltas: number[]\n\n  private _remainingMaxPossibleRawComboScore: number\n  private _log: { character: string; count: number }[]\n\n  constructor(notechart: Notechart) {\n    this.totalCombo = _(notechart.notes)\n      .map((note) => notechart.info(note)!.combos)\n      .sum()\n    this.totalNotes = notechart.notes.length\n    this.combo = 0\n    this.maxCombo = 0\n    this.rawSumJudgmentWeight = 0\n    this.rawTotalComboScore = this._calculateRawTotalComboScore(this.totalCombo)\n    this._remainingMaxPossibleRawComboScore = this.rawTotalComboScore\n    this.rawSumComboScore = 0\n    this.counts = { [Judgments.MISSED]: 0, '1': 0, '2': 0, '3': 0, '4': 0 }\n    this.numJudgments = 0\n    this.poor = false\n    this._log = []\n    this.deltas = []\n  }\n\n  get score() {\n    // #region score\n    return this.accuracyScore + this.comboScore\n    // #endregion\n  }\n\n  get accuracyScore() {\n    return getAccuracyScore(this.accuracy)\n  }\n\n  get comboScore() {\n    return getComboScore(this.rawSumComboScore, this.rawTotalComboScore)\n  }\n\n  get maxPossibleScore() {\n    return this.maxPossibleAccuracyScore + this.maxPossibleComboScore\n  }\n\n  get maxPossibleAccuracyScore() {\n    const remainingJudgments = this.totalCombo - this.numJudgments\n    const maxPossibleRawWeight =\n      this.rawSumJudgmentWeight + Judgments.weight(1) * remainingJudgments\n    const maxPossibleAccuracy =\n      maxPossibleRawWeight / (Judgments.weight(1) * this.totalCombo)\n    return getAccuracyScore(maxPossibleAccuracy)\n  }\n\n  get maxPossibleComboScore() {\n    const maxPossibleRawComboScore =\n      this.rawSumComboScore + this._remainingMaxPossibleRawComboScore\n    return getComboScore(maxPossibleRawComboScore, this.rawTotalComboScore)\n  }\n\n  get accuracy() {\n    return this.rawSumJudgmentWeight / (Judgments.weight(1) * this.totalCombo)\n  }\n\n  get currentAccuracy() {\n    return (\n      this.rawSumJudgmentWeight / (Judgments.weight(1) * this.numJudgments || 1)\n    )\n  }\n\n  get log() {\n    return this._log\n      .map(({ character, count }) => `${count > 1 ? count : ''}${character}`)\n      .join('')\n  }\n\n  handleJudgment(judgment: Judgments.JudgedJudgment) {\n    this.counts[judgment] += 1\n    this.numJudgments += 1\n    if (Judgments.breaksCombo(judgment)) {\n      const remainingJudgments = this.totalCombo - this.numJudgments\n      this.combo = 0\n      this.poor = true\n      this._remainingMaxPossibleRawComboScore =\n        this._calculateRawTotalComboScore(remainingJudgments)\n    } else {\n      this.combo += 1\n      const rawComboScore = this._calculateRawComboScore(this.combo)\n      this.rawSumComboScore += rawComboScore\n      this._remainingMaxPossibleRawComboScore -= rawComboScore\n      this.poor = false\n    }\n    this.rawSumJudgmentWeight += Judgments.weight(judgment)\n    if (this.combo > this.maxCombo) {\n      this.maxCombo = this.combo\n    }\n    this._recordLog(judgment)\n  }\n\n  handleDelta(delta: number) {\n    this.deltas.push(delta)\n  }\n\n  private _calculateRawTotalComboScore(total: number) {\n    let sum = 0\n    for (let i = 1; i <= total; i++) {\n      sum += this._calculateRawComboScore(i)\n    }\n    return sum\n  }\n\n  private _calculateRawComboScore(i: number) {\n    // #region combo\n    if (i === 0) return 0\n    if (i < 23) return 1\n    if (i < 51) return 2\n    if (i < 92) return 3\n    if (i < 161) return 4\n    return 5\n    // #endregion\n  }\n\n  private _recordLog(judgment: Judgments.JudgedJudgment) {\n    const character = this._getLogCharacter(judgment)\n    if (character) {\n      if (\n        this._log.length === 0 ||\n        this._log[this._log.length - 1].character !== character\n      ) {\n        this._log.push({ character, count: 1 })\n      } else {\n        this._log[this._log.length - 1].count += 1\n      }\n    }\n  }\n\n  private _getLogCharacter(judgment: Judgments.JudgedJudgment) {\n    switch (judgment) {\n      case 1:\n        return 'A'\n      case 2:\n        return 'B'\n      case 3:\n        return 'C'\n      case 4:\n        return 'D'\n      case Judgments.MISSED:\n        return 'M'\n    }\n  }\n}\n\nexport default PlayerStats\n","import _ from 'lodash'\n\nexport class NoteArea {\n  constructor(notes, barLines) {\n    this._notes = _.sortBy(notes, position)\n    this._barLines = _(barLines).map('position').sortBy().value()\n  }\n\n  getVisibleNotes(lower, upper, headroom) {\n    const out = []\n    const notes = this._notes\n    if (!headroom) headroom = 0\n    for (let i = 0; i < notes.length; i++) {\n      const note = notes[i]\n      const visible = note.end\n        ? !(note.position > upper || note.end.position < lower - headroom)\n        : !(note.position > upper || note.position < lower - headroom)\n      if (visible) {\n        const entity = { note: note }\n        if (!note.end) {\n          entity.y = y(lower, upper, note.position)\n        } else {\n          const head = y(lower, upper, note.position)\n          const tail = y(lower, upper, note.end.position)\n          entity.y = Math.min(head, tail)\n          entity.height = Math.abs(head - tail)\n        }\n        out.push(entity)\n      }\n    }\n    return out\n  }\n\n  getVisibleBarLines(lower, upper, headroom) {\n    if (!headroom) headroom = 0\n    return this._barLines\n      .filter((pos) => lower - headroom <= pos && pos <= upper)\n      .map((pos) => ({ id: pos, y: y(lower, upper, pos) }))\n  }\n}\n\nexport default NoteArea\n\nfunction y(lower, upper, pos) {\n  return 1 - (pos - lower) / (upper - lower)\n}\n\nfunction position(event) {\n  return event.position\n}\n","export function getGauge(gaugeType) {\n  if (gaugeType === 'hope') {\n    return hopeGauge()\n  }\n  return nullGauge()\n}\n\nfunction nullGauge() {\n  return {\n    update() {},\n    shouldDisplay() {\n      return false\n    },\n    getPrimary() {\n      return 0\n    },\n    getSecondary() {\n      return 0\n    },\n    getExtra() {\n      return 0\n    },\n  }\n}\n\nfunction hopeGauge() {\n  let primary\n  let secondary\n  let extra\n  return {\n    update(playerState) {\n      const stats = playerState.stats\n      const progress = stats.numJudgments / stats.totalCombo\n      const getHope = (min, max1, max2) => {\n        const max = max1 + (max2 - max1) * progress\n        const maxPossibleScore = stats.maxPossibleScore\n        return Math.max(0, (maxPossibleScore - min) / (max - min))\n      }\n      const hopeS = getHope(500000, 555555, 510000) * 0.5\n      primary = Math.min(1, hopeS)\n      extra = Math.max(0, Math.min(1, hopeS - 1))\n      if (hopeS > 0) {\n        secondary = 0\n      } else {\n        const hopeA = getHope(450000, 500000, 500000)\n        secondary = hopeA\n      }\n    },\n    shouldDisplay() {\n      return primary > 0 || secondary > 0\n    },\n    getPrimary() {\n      return primary\n    },\n    getSecondary() {\n      return secondary\n    },\n    getExtra() {\n      return extra\n    },\n  }\n}\n","export function formatTime(seconds) {\n  const s = Math.floor(seconds % 60)\n  return Math.floor(seconds / 60) + ':' + (s < 10 ? '0' : '') + s\n}\n\nexport default formatTime\n","/*! https://mths.be/punycode v1.4.1 by @mathias */\n;(function(root) {\n\n\t/** Detect free variables */\n\tvar freeExports = typeof exports == 'object' && exports &&\n\t\t!exports.nodeType && exports;\n\tvar freeModule = typeof module == 'object' && module &&\n\t\t!module.nodeType && module;\n\tvar freeGlobal = typeof global == 'object' && global;\n\tif (\n\t\tfreeGlobal.global === freeGlobal ||\n\t\tfreeGlobal.window === freeGlobal ||\n\t\tfreeGlobal.self === freeGlobal\n\t) {\n\t\troot = freeGlobal;\n\t}\n\n\t/**\n\t * The `punycode` object.\n\t * @name punycode\n\t * @type Object\n\t */\n\tvar punycode,\n\n\t/** Highest positive signed 32-bit float value */\n\tmaxInt = 2147483647, // aka. 0x7FFFFFFF or 2^31-1\n\n\t/** Bootstring parameters */\n\tbase = 36,\n\ttMin = 1,\n\ttMax = 26,\n\tskew = 38,\n\tdamp = 700,\n\tinitialBias = 72,\n\tinitialN = 128, // 0x80\n\tdelimiter = '-', // '\\x2D'\n\n\t/** Regular expressions */\n\tregexPunycode = /^xn--/,\n\tregexNonASCII = /[^\\x20-\\x7E]/, // unprintable ASCII chars + non-ASCII chars\n\tregexSeparators = /[\\x2E\\u3002\\uFF0E\\uFF61]/g, // RFC 3490 separators\n\n\t/** Error messages */\n\terrors = {\n\t\t'overflow': 'Overflow: input needs wider integers to process',\n\t\t'not-basic': 'Illegal input >= 0x80 (not a basic code point)',\n\t\t'invalid-input': 'Invalid input'\n\t},\n\n\t/** Convenience shortcuts */\n\tbaseMinusTMin = base - tMin,\n\tfloor = Math.floor,\n\tstringFromCharCode = String.fromCharCode,\n\n\t/** Temporary variable */\n\tkey;\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/**\n\t * A generic error utility function.\n\t * @private\n\t * @param {String} type The error type.\n\t * @returns {Error} Throws a `RangeError` with the applicable error message.\n\t */\n\tfunction error(type) {\n\t\tthrow new RangeError(errors[type]);\n\t}\n\n\t/**\n\t * A generic `Array#map` utility function.\n\t * @private\n\t * @param {Array} array The array to iterate over.\n\t * @param {Function} callback The function that gets called for every array\n\t * item.\n\t * @returns {Array} A new array of values returned by the callback function.\n\t */\n\tfunction map(array, fn) {\n\t\tvar length = array.length;\n\t\tvar result = [];\n\t\twhile (length--) {\n\t\t\tresult[length] = fn(array[length]);\n\t\t}\n\t\treturn result;\n\t}\n\n\t/**\n\t * A simple `Array#map`-like wrapper to work with domain name strings or email\n\t * addresses.\n\t * @private\n\t * @param {String} domain The domain name or email address.\n\t * @param {Function} callback The function that gets called for every\n\t * character.\n\t * @returns {Array} A new string of characters returned by the callback\n\t * function.\n\t */\n\tfunction mapDomain(string, fn) {\n\t\tvar parts = string.split('@');\n\t\tvar result = '';\n\t\tif (parts.length > 1) {\n\t\t\t// In email addresses, only the domain name should be punycoded. Leave\n\t\t\t// the local part (i.e. everything up to `@`) intact.\n\t\t\tresult = parts[0] + '@';\n\t\t\tstring = parts[1];\n\t\t}\n\t\t// Avoid `split(regex)` for IE8 compatibility. See #17.\n\t\tstring = string.replace(regexSeparators, '\\x2E');\n\t\tvar labels = string.split('.');\n\t\tvar encoded = map(labels, fn).join('.');\n\t\treturn result + encoded;\n\t}\n\n\t/**\n\t * Creates an array containing the numeric code points of each Unicode\n\t * character in the string. While JavaScript uses UCS-2 internally,\n\t * this function will convert a pair of surrogate halves (each of which\n\t * UCS-2 exposes as separate characters) into a single code point,\n\t * matching UTF-16.\n\t * @see `punycode.ucs2.encode`\n\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t * @memberOf punycode.ucs2\n\t * @name decode\n\t * @param {String} string The Unicode input string (UCS-2).\n\t * @returns {Array} The new array of code points.\n\t */\n\tfunction ucs2decode(string) {\n\t\tvar output = [],\n\t\t    counter = 0,\n\t\t    length = string.length,\n\t\t    value,\n\t\t    extra;\n\t\twhile (counter < length) {\n\t\t\tvalue = string.charCodeAt(counter++);\n\t\t\tif (value >= 0xD800 && value <= 0xDBFF && counter < length) {\n\t\t\t\t// high surrogate, and there is a next character\n\t\t\t\textra = string.charCodeAt(counter++);\n\t\t\t\tif ((extra & 0xFC00) == 0xDC00) { // low surrogate\n\t\t\t\t\toutput.push(((value & 0x3FF) << 10) + (extra & 0x3FF) + 0x10000);\n\t\t\t\t} else {\n\t\t\t\t\t// unmatched surrogate; only append this code unit, in case the next\n\t\t\t\t\t// code unit is the high surrogate of a surrogate pair\n\t\t\t\t\toutput.push(value);\n\t\t\t\t\tcounter--;\n\t\t\t\t}\n\t\t\t} else {\n\t\t\t\toutput.push(value);\n\t\t\t}\n\t\t}\n\t\treturn output;\n\t}\n\n\t/**\n\t * Creates a string based on an array of numeric code points.\n\t * @see `punycode.ucs2.decode`\n\t * @memberOf punycode.ucs2\n\t * @name encode\n\t * @param {Array} codePoints The array of numeric code points.\n\t * @returns {String} The new Unicode string (UCS-2).\n\t */\n\tfunction ucs2encode(array) {\n\t\treturn map(array, function(value) {\n\t\t\tvar output = '';\n\t\t\tif (value > 0xFFFF) {\n\t\t\t\tvalue -= 0x10000;\n\t\t\t\toutput += stringFromCharCode(value >>> 10 & 0x3FF | 0xD800);\n\t\t\t\tvalue = 0xDC00 | value & 0x3FF;\n\t\t\t}\n\t\t\toutput += stringFromCharCode(value);\n\t\t\treturn output;\n\t\t}).join('');\n\t}\n\n\t/**\n\t * Converts a basic code point into a digit/integer.\n\t * @see `digitToBasic()`\n\t * @private\n\t * @param {Number} codePoint The basic numeric code point value.\n\t * @returns {Number} The numeric value of a basic code point (for use in\n\t * representing integers) in the range `0` to `base - 1`, or `base` if\n\t * the code point does not represent a value.\n\t */\n\tfunction basicToDigit(codePoint) {\n\t\tif (codePoint - 48 < 10) {\n\t\t\treturn codePoint - 22;\n\t\t}\n\t\tif (codePoint - 65 < 26) {\n\t\t\treturn codePoint - 65;\n\t\t}\n\t\tif (codePoint - 97 < 26) {\n\t\t\treturn codePoint - 97;\n\t\t}\n\t\treturn base;\n\t}\n\n\t/**\n\t * Converts a digit/integer into a basic code point.\n\t * @see `basicToDigit()`\n\t * @private\n\t * @param {Number} digit The numeric value of a basic code point.\n\t * @returns {Number} The basic code point whose value (when used for\n\t * representing integers) is `digit`, which needs to be in the range\n\t * `0` to `base - 1`. If `flag` is non-zero, the uppercase form is\n\t * used; else, the lowercase form is used. The behavior is undefined\n\t * if `flag` is non-zero and `digit` has no uppercase form.\n\t */\n\tfunction digitToBasic(digit, flag) {\n\t\t//  0..25 map to ASCII a..z or A..Z\n\t\t// 26..35 map to ASCII 0..9\n\t\treturn digit + 22 + 75 * (digit < 26) - ((flag != 0) << 5);\n\t}\n\n\t/**\n\t * Bias adaptation function as per section 3.4 of RFC 3492.\n\t * https://tools.ietf.org/html/rfc3492#section-3.4\n\t * @private\n\t */\n\tfunction adapt(delta, numPoints, firstTime) {\n\t\tvar k = 0;\n\t\tdelta = firstTime ? floor(delta / damp) : delta >> 1;\n\t\tdelta += floor(delta / numPoints);\n\t\tfor (/* no initialization */; delta > baseMinusTMin * tMax >> 1; k += base) {\n\t\t\tdelta = floor(delta / baseMinusTMin);\n\t\t}\n\t\treturn floor(k + (baseMinusTMin + 1) * delta / (delta + skew));\n\t}\n\n\t/**\n\t * Converts a Punycode string of ASCII-only symbols to a string of Unicode\n\t * symbols.\n\t * @memberOf punycode\n\t * @param {String} input The Punycode string of ASCII-only symbols.\n\t * @returns {String} The resulting string of Unicode symbols.\n\t */\n\tfunction decode(input) {\n\t\t// Don't use UCS-2\n\t\tvar output = [],\n\t\t    inputLength = input.length,\n\t\t    out,\n\t\t    i = 0,\n\t\t    n = initialN,\n\t\t    bias = initialBias,\n\t\t    basic,\n\t\t    j,\n\t\t    index,\n\t\t    oldi,\n\t\t    w,\n\t\t    k,\n\t\t    digit,\n\t\t    t,\n\t\t    /** Cached calculation results */\n\t\t    baseMinusT;\n\n\t\t// Handle the basic code points: let `basic` be the number of input code\n\t\t// points before the last delimiter, or `0` if there is none, then copy\n\t\t// the first basic code points to the output.\n\n\t\tbasic = input.lastIndexOf(delimiter);\n\t\tif (basic < 0) {\n\t\t\tbasic = 0;\n\t\t}\n\n\t\tfor (j = 0; j < basic; ++j) {\n\t\t\t// if it's not a basic code point\n\t\t\tif (input.charCodeAt(j) >= 0x80) {\n\t\t\t\terror('not-basic');\n\t\t\t}\n\t\t\toutput.push(input.charCodeAt(j));\n\t\t}\n\n\t\t// Main decoding loop: start just after the last delimiter if any basic code\n\t\t// points were copied; start at the beginning otherwise.\n\n\t\tfor (index = basic > 0 ? basic + 1 : 0; index < inputLength; /* no final expression */) {\n\n\t\t\t// `index` is the index of the next character to be consumed.\n\t\t\t// Decode a generalized variable-length integer into `delta`,\n\t\t\t// which gets added to `i`. The overflow checking is easier\n\t\t\t// if we increase `i` as we go, then subtract off its starting\n\t\t\t// value at the end to obtain `delta`.\n\t\t\tfor (oldi = i, w = 1, k = base; /* no condition */; k += base) {\n\n\t\t\t\tif (index >= inputLength) {\n\t\t\t\t\terror('invalid-input');\n\t\t\t\t}\n\n\t\t\t\tdigit = basicToDigit(input.charCodeAt(index++));\n\n\t\t\t\tif (digit >= base || digit > floor((maxInt - i) / w)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\ti += digit * w;\n\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\n\t\t\t\tif (digit < t) {\n\t\t\t\t\tbreak;\n\t\t\t\t}\n\n\t\t\t\tbaseMinusT = base - t;\n\t\t\t\tif (w > floor(maxInt / baseMinusT)) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tw *= baseMinusT;\n\n\t\t\t}\n\n\t\t\tout = output.length + 1;\n\t\t\tbias = adapt(i - oldi, out, oldi == 0);\n\n\t\t\t// `i` was supposed to wrap around from `out` to `0`,\n\t\t\t// incrementing `n` each time, so we'll fix that now:\n\t\t\tif (floor(i / out) > maxInt - n) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tn += floor(i / out);\n\t\t\ti %= out;\n\n\t\t\t// Insert `n` at position `i` of the output\n\t\t\toutput.splice(i++, 0, n);\n\n\t\t}\n\n\t\treturn ucs2encode(output);\n\t}\n\n\t/**\n\t * Converts a string of Unicode symbols (e.g. a domain name label) to a\n\t * Punycode string of ASCII-only symbols.\n\t * @memberOf punycode\n\t * @param {String} input The string of Unicode symbols.\n\t * @returns {String} The resulting Punycode string of ASCII-only symbols.\n\t */\n\tfunction encode(input) {\n\t\tvar n,\n\t\t    delta,\n\t\t    handledCPCount,\n\t\t    basicLength,\n\t\t    bias,\n\t\t    j,\n\t\t    m,\n\t\t    q,\n\t\t    k,\n\t\t    t,\n\t\t    currentValue,\n\t\t    output = [],\n\t\t    /** `inputLength` will hold the number of code points in `input`. */\n\t\t    inputLength,\n\t\t    /** Cached calculation results */\n\t\t    handledCPCountPlusOne,\n\t\t    baseMinusT,\n\t\t    qMinusT;\n\n\t\t// Convert the input in UCS-2 to Unicode\n\t\tinput = ucs2decode(input);\n\n\t\t// Cache the length\n\t\tinputLength = input.length;\n\n\t\t// Initialize the state\n\t\tn = initialN;\n\t\tdelta = 0;\n\t\tbias = initialBias;\n\n\t\t// Handle the basic code points\n\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\tcurrentValue = input[j];\n\t\t\tif (currentValue < 0x80) {\n\t\t\t\toutput.push(stringFromCharCode(currentValue));\n\t\t\t}\n\t\t}\n\n\t\thandledCPCount = basicLength = output.length;\n\n\t\t// `handledCPCount` is the number of code points that have been handled;\n\t\t// `basicLength` is the number of basic code points.\n\n\t\t// Finish the basic string - if it is not empty - with a delimiter\n\t\tif (basicLength) {\n\t\t\toutput.push(delimiter);\n\t\t}\n\n\t\t// Main encoding loop:\n\t\twhile (handledCPCount < inputLength) {\n\n\t\t\t// All non-basic code points < n have been handled already. Find the next\n\t\t\t// larger one:\n\t\t\tfor (m = maxInt, j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\t\t\t\tif (currentValue >= n && currentValue < m) {\n\t\t\t\t\tm = currentValue;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t// Increase `delta` enough to advance the decoder's <n,i> state to <m,0>,\n\t\t\t// but guard against overflow\n\t\t\thandledCPCountPlusOne = handledCPCount + 1;\n\t\t\tif (m - n > floor((maxInt - delta) / handledCPCountPlusOne)) {\n\t\t\t\terror('overflow');\n\t\t\t}\n\n\t\t\tdelta += (m - n) * handledCPCountPlusOne;\n\t\t\tn = m;\n\n\t\t\tfor (j = 0; j < inputLength; ++j) {\n\t\t\t\tcurrentValue = input[j];\n\n\t\t\t\tif (currentValue < n && ++delta > maxInt) {\n\t\t\t\t\terror('overflow');\n\t\t\t\t}\n\n\t\t\t\tif (currentValue == n) {\n\t\t\t\t\t// Represent delta as a generalized variable-length integer\n\t\t\t\t\tfor (q = delta, k = base; /* no condition */; k += base) {\n\t\t\t\t\t\tt = k <= bias ? tMin : (k >= bias + tMax ? tMax : k - bias);\n\t\t\t\t\t\tif (q < t) {\n\t\t\t\t\t\t\tbreak;\n\t\t\t\t\t\t}\n\t\t\t\t\t\tqMinusT = q - t;\n\t\t\t\t\t\tbaseMinusT = base - t;\n\t\t\t\t\t\toutput.push(\n\t\t\t\t\t\t\tstringFromCharCode(digitToBasic(t + qMinusT % baseMinusT, 0))\n\t\t\t\t\t\t);\n\t\t\t\t\t\tq = floor(qMinusT / baseMinusT);\n\t\t\t\t\t}\n\n\t\t\t\t\toutput.push(stringFromCharCode(digitToBasic(q, 0)));\n\t\t\t\t\tbias = adapt(delta, handledCPCountPlusOne, handledCPCount == basicLength);\n\t\t\t\t\tdelta = 0;\n\t\t\t\t\t++handledCPCount;\n\t\t\t\t}\n\t\t\t}\n\n\t\t\t++delta;\n\t\t\t++n;\n\n\t\t}\n\t\treturn output.join('');\n\t}\n\n\t/**\n\t * Converts a Punycode string representing a domain name or an email address\n\t * to Unicode. Only the Punycoded parts of the input will be converted, i.e.\n\t * it doesn't matter if you call it on a string that has already been\n\t * converted to Unicode.\n\t * @memberOf punycode\n\t * @param {String} input The Punycoded domain name or email address to\n\t * convert to Unicode.\n\t * @returns {String} The Unicode representation of the given Punycode\n\t * string.\n\t */\n\tfunction toUnicode(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexPunycode.test(string)\n\t\t\t\t? decode(string.slice(4).toLowerCase())\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/**\n\t * Converts a Unicode string representing a domain name or an email address to\n\t * Punycode. Only the non-ASCII parts of the domain name will be converted,\n\t * i.e. it doesn't matter if you call it with a domain that's already in\n\t * ASCII.\n\t * @memberOf punycode\n\t * @param {String} input The domain name or email address to convert, as a\n\t * Unicode string.\n\t * @returns {String} The Punycode representation of the given domain name or\n\t * email address.\n\t */\n\tfunction toASCII(input) {\n\t\treturn mapDomain(input, function(string) {\n\t\t\treturn regexNonASCII.test(string)\n\t\t\t\t? 'xn--' + encode(string)\n\t\t\t\t: string;\n\t\t});\n\t}\n\n\t/*--------------------------------------------------------------------------*/\n\n\t/** Define the public API */\n\tpunycode = {\n\t\t/**\n\t\t * A string representing the current Punycode.js version number.\n\t\t * @memberOf punycode\n\t\t * @type String\n\t\t */\n\t\t'version': '1.4.1',\n\t\t/**\n\t\t * An object of methods to convert from JavaScript's internal character\n\t\t * representation (UCS-2) to Unicode code points, and back.\n\t\t * @see <https://mathiasbynens.be/notes/javascript-encoding>\n\t\t * @memberOf punycode\n\t\t * @type Object\n\t\t */\n\t\t'ucs2': {\n\t\t\t'decode': ucs2decode,\n\t\t\t'encode': ucs2encode\n\t\t},\n\t\t'decode': decode,\n\t\t'encode': encode,\n\t\t'toASCII': toASCII,\n\t\t'toUnicode': toUnicode\n\t};\n\n\t/** Expose `punycode` */\n\t// Some AMD build optimizers, like r.js, check for specific condition patterns\n\t// like the following:\n\tif (\n\t\ttypeof define == 'function' &&\n\t\ttypeof define.amd == 'object' &&\n\t\tdefine.amd\n\t) {\n\t\tdefine('punycode', function() {\n\t\t\treturn punycode;\n\t\t});\n\t} else if (freeExports && freeModule) {\n\t\tif (module.exports == freeExports) {\n\t\t\t// in Node.js, io.js, or RingoJS v0.8.0+\n\t\t\tfreeModule.exports = punycode;\n\t\t} else {\n\t\t\t// in Narwhal or RingoJS v0.7.0-\n\t\t\tfor (key in punycode) {\n\t\t\t\tpunycode.hasOwnProperty(key) && (freeExports[key] = punycode[key]);\n\t\t\t}\n\t\t}\n\t} else {\n\t\t// in Rhino or a web browser\n\t\troot.punycode = punycode;\n\t}\n\n}(this));\n","import Bacon from 'baconjs'\n\nfunction observeMidiAccess(access) {\n  return Bacon.fromBinder((sink) => {\n    for (const port of access.inputs.values()) {\n      sink(new Bacon.Next(port))\n    }\n    for (const port of access.outputs.values()) {\n      sink(new Bacon.Next(port))\n    }\n    access.onstatechange = (e) => {\n      sink(new Bacon.Next(e.port))\n    }\n  })\n}\n\nfunction requestMIDIAccess() {\n  if (!navigator.requestMIDIAccess) {\n    return Promise.reject(new Error('MIDI is not supported'))\n  }\n  return navigator.requestMIDIAccess()\n}\n\nexport function getMidi() {\n  return Bacon.fromPromise(requestMIDIAccess())\n    .flatMap(observeMidiAccess)\n    .flatMapError((e) => (console.warn('MIDI Error:', e.stack), Bacon.never()))\n    .flatMap(messageForPort)\n    .doLog('messageforport')\n}\n\nfunction messageForPort(port) {\n  if (port.type !== 'input') return Bacon.never()\n  return Bacon.fromEvent(port, 'midimessage')\n}\n\nexport default getMidi\n","export class AxisLogic {\n  private stop = 1\n  private charge = 0\n  private previous: false | number = false\n  private active = false\n  private positive = false\n\n  public update(axis: number, threshold: number = 3) {\n    if (this.previous === false) {\n      this.previous = axis\n      return 0\n    }\n\n    if (this.previous !== axis) {\n      let delta = axis - this.previous\n      if (delta > 1) {\n        delta -= 2 + 0.005\n      } else if (delta < -1) {\n        delta += 2 + 0.005\n      }\n\n      const immediateOutput = delta > 0\n\n      if (this.active && this.positive !== immediateOutput) {\n        this.positive = immediateOutput\n        this.active = false\n        this.charge = 0\n      } else if (!this.active) {\n        if (this.charge === 0 || this.stop <= threshold) {\n          this.charge += Math.ceil(Math.abs(delta) / 0.01)\n        }\n\n        if (this.charge >= 2) {\n          this.active = true\n          this.positive = immediateOutput\n        }\n      }\n\n      this.stop = 0\n      this.previous = axis\n    }\n\n    if (this.stop > threshold * 2) {\n      this.active = false\n      this.charge = 0\n      this.stop = 0\n    }\n\n    this.stop += 1\n\n    return this.active ? (this.positive ? 1 : -1) : 0\n  }\n}\n","import keycode from 'keycode'\nimport _ from 'lodash'\nimport Bacon from 'baconjs'\nimport getMidi from './midi'\nimport { AxisLogic } from './axis-logic'\n\n// Public: OmniInput is a poll-based class that handles the key-pressed state of\n// multiple inputs.\n//\n// Each call to `update()` returns a mapping of active inputs. This object may\n// be reused and mutated by OmniInput for performance reasons, and thus the\n// caller SHOULD NOT hold on to or mutate it.\n//\n// ## Keys\n//\n// The key is a string that identifies some key on each input.\n// It follows the following convention:\n//\n// - `65` A keyboard keycode.\n// - `gamepad.0.button.3` A gamepad button.\n// - `gamepad.0.axis.3.positive` A gamepad axis (positive value).\n// - `gamepad.0.axis.3.negative` A gamepad axis (negative value).\n// - `midi.[id].[channel].note.[note]` A MIDI note.\n// - `midi.[id].[channel].sustain` Sustain pedal.\n// - `midi.[id].[channel].mod` Modulation level.\n// - `midi.[id].[channel].pitch.up` Pitch bend (up).\n// - `midi.[id].[channel].pitch.down` Pitch bend (down).\n//\nexport class OmniInput {\n  constructor(win = window, options = {}) {\n    const midi = (options.getMidi || getMidi)()\n    this._window = win\n    this._exclusive = !!options.exclusive\n    this._continuousAxis = !!options.continuous\n    this.setGamepadSensitivity(options.sensitivity || 3)\n\n    this._disposables = [\n      listen(win, 'keydown', (e) => this._handleKeyDown(e)),\n      listen(win, 'keyup', (e) => this._handleKeyUp(e)),\n      midi.onValue((e) => this._handleMIDIMessage(e)),\n    ]\n    this._status = {}\n    this._axis = {}\n  }\n\n  _handleKeyDown(e) {\n    this._status[`${e.which}`] = true\n    if (this._exclusive) e.preventDefault()\n  }\n\n  _handleKeyUp(e) {\n    this._status[`${e.which}`] = false\n  }\n\n  _handleMIDIMessage(e) {\n    if (!e || !e.data) return\n    const data = e.data\n    const prefix = `midi.${e.target.id}.${e.data[0] & 0x0f}`\n    const handleNote = (state) => {\n      this._status[`${prefix}.note.${data[1]}`] = state\n    }\n    if ((data[0] & 0xf0) === 0x80) {\n      // NoteOff\n      handleNote(false)\n    } else if ((data[0] & 0xf0) === 0x90) {\n      // NoteOn\n      if (data[2] > 0x0) {\n        // NoteOn (really)\n        handleNote(true)\n      } else {\n        // NoteOff disguised as NoteOn\n        handleNote(false)\n      }\n    } else if ((data[0] & 0xf0) === 0xb0) {\n      // CC\n      if (data[1] === 0x40) {\n        // Sustain\n        this._status[`${prefix}.sustain`] = data[2] >= 64\n      } else if (data[1] === 0x01) {\n        // Modulation\n        this._status[`${prefix}.mod`] = data[2] >= 16\n      }\n    } else if ((data[0] & 0xf0) === 0xe0) {\n      // Pitch Bend\n      const bend = data[1] | (data[2] << 7)\n      this._status[`${prefix}.pitch.up`] = bend >= 0x2100\n      this._status[`${prefix}.pitch.down`] = bend < 0x1f00\n    }\n  }\n\n  _updateGamepads() {\n    const nav = this._window.navigator\n    const gamepads = nav.getGamepads\n      ? nav.getGamepads()\n      : nav.webkitGetGamepads\n      ? nav.webkitGetGamepads()\n      : []\n    if (!gamepads) return\n    for (let i = 0; i < gamepads.length; i++) {\n      const gamepad = gamepads[i]\n      if (gamepad) {\n        this._updateGamepad(gamepad)\n      }\n    }\n  }\n\n  _updateGamepad(gamepad) {\n    const prefix = `gamepad.${gamepad.index}`\n    for (let i = 0; i < gamepad.buttons.length; i++) {\n      const button = gamepad.buttons[i]\n      this._status[`${prefix}.button.${i}`] = button && button.value >= 0.5\n    }\n    for (let i = 0; i < gamepad.axes.length; i++) {\n      const axisName = `${prefix}.axis.${i}`\n      let axis = gamepad.axes[i]\n\n      if (this._continuousAxis) {\n        if (this._axis[axisName] == null) {\n          this._axis[axisName] = new AxisLogic()\n        }\n        axis = this._axis[axisName].update(axis)\n      }\n\n      this._status[`${axisName}.positive`] = axis >= this._deadzone\n      this._status[`${axisName}.negative`] = axis <= -this._deadzone\n    }\n  }\n\n  update() {\n    this._updateGamepads()\n    return this._status\n  }\n\n  setGamepadSensitivity(sensitivity) {\n    this._sensitivity = sensitivity\n    this._deadzone = (9 - this._sensitivity) * 0.05\n    if (this._deadzone < 0.01) this._deadzone = 0.01\n    this._analogThreshold = 18 - this._sensitivity * 2\n  }\n\n  setGamepadContinuousAxisEnabled(enabled) {\n    this._continuousAxis = enabled\n  }\n\n  dispose() {\n    for (const dispose of this._disposables) {\n      dispose()\n    }\n  }\n}\n\n// Public: Returns a Bacon EventStream of keys pressed.\n//\nexport function key(input = new OmniInput(), win = window) {\n  return _keyForUpdate(\n    Bacon.fromBinder((sink) => {\n      const handle = win.setInterval(() => {\n        sink(new Bacon.Next(input.update()))\n      }, 16)\n      return () => win.clearInterval(handle)\n    })\n  )\n}\n\nexport function _keyForUpdate(update) {\n  return update\n    .map((update) => Object.keys(update).filter((key) => update[key]))\n    .diff([], (previous, current) => _.difference(current, previous))\n    .flatMap((array) => Bacon.fromArray(array))\n}\n\nexport default OmniInput\n\nconst knownMidiIds = {}\n\nexport function getName(key) {\n  if (+key) {\n    return _.capitalize(keycode(+key))\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.axis\\.(\\d+)\\.(\\w+)/)\n    if (match) {\n      return `Joy${match[1]} Axis${match[2]} (${\n        match[3] === 'positive' ? '+' : '-'\n      })`\n    }\n  }\n  {\n    const match = key.match(/^gamepad\\.(\\d+)\\.button\\.(\\d+)/)\n    if (match) {\n      return `Joy${match[1]} Btn${match[2]}`\n    }\n  }\n  {\n    const match = key.match(/^midi\\.(.+)\\.(\\d+)\\.(.+)$/)\n    if (match) {\n      const rest = match[3].split('.')\n      const id = match[1]\n      const midiDeviceNumber =\n        knownMidiIds[id] ||\n        (knownMidiIds[id] = Object.keys(knownMidiIds).length + 1)\n      const prefix = `MIDI${midiDeviceNumber} Ch${+match[2] + 1}`\n      if (rest[0] === 'note') {\n        const midiNote = +rest[1]\n        const lookup = [\n          'C',\n          'C#',\n          'D',\n          'D#',\n          'E',\n          'F',\n          'F#',\n          'G',\n          'G#',\n          'A',\n          'A#',\n          'B',\n        ]\n        const noteName = lookup[midiNote % 12]\n        const octave = Math.floor(midiNote / 12) - 1\n        return `${prefix} ${noteName}${octave}`\n      }\n      if (rest[0] === 'pitch') {\n        return `${prefix} Pitch${rest[1] === 'up' ? '+' : '-'}`\n      }\n      if (rest[0] === 'sustain') return 'Sustain'\n      if (rest[0] === 'mod') return 'Mod'\n    }\n  }\n  return `${String(key).replace(/\\./g, ' ')}?`\n}\n\nfunction listen(subject, eventName, listener) {\n  subject.addEventListener(eventName, listener)\n  return function dispose() {\n    subject.removeEventListener(eventName, listener)\n  }\n}\n","export class Control {\n  public value = 0\n  public changed = false\n  get justPressed() {\n    return this.changed && this.value\n  }\n}\n\nexport default Control\n","import Control from './control'\nimport _ from 'lodash'\nimport bench from 'bemuse/devtools/benchmark'\n\ntype GameInputPluginInternalInstance = {\n  get(): [string, number][]\n  destroy(): void\n}\n\ninterface IGameInputPlugin {\n  name: string\n  get(): { [key: string]: number }\n  destroy?(): void\n}\n\nexport class GameInput {\n  private _controls = new Map<string, Control>()\n  private _plugins: GameInputPluginInternalInstance[] = []\n  update() {\n    const changes = new Map()\n    for (const [name, control] of this._controls) {\n      void name\n      control.changed = false\n    }\n    for (const plugin of this._plugins) {\n      for (const [name, value] of plugin.get()) {\n        changes.set(name, value)\n      }\n    }\n    for (const [name, value] of changes) {\n      const control = this.get(name)!\n      if (control.value !== value) {\n        control.changed = true\n        control.value = value\n      }\n    }\n  }\n\n  destroy() {\n    for (const plugin of this._plugins) {\n      plugin.destroy()\n    }\n  }\n\n  get(controlName: string) {\n    if (!this._controls.has(controlName)) {\n      this._controls.set(controlName, new Control())\n    }\n    return this._controls.get(controlName)!\n  }\n\n  use(plugin: IGameInputPlugin) {\n    const state: { [key: string]: number } = {}\n    const name = 'input:' + plugin.name\n    this._plugins.push({\n      get: bench.wrap(name, function () {\n        const out = plugin.get()\n        const diff = []\n        for (const key of _.union(_.keys(out), _.keys(state))) {\n          const last = +state[key] || 0\n          const current = +out[key] || 0\n          if (last !== current) diff.push([key, current])\n          state[key] = current\n        }\n        return diff\n      }),\n      destroy() {\n        if (typeof plugin.destroy === 'function') {\n          return plugin.destroy()\n        } else {\n          return true\n        }\n      },\n    })\n  }\n}\n\nexport default GameInput\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSChart = void 0;\nvar headers_1 = require(\"./headers\");\nvar objects_1 = require(\"./objects\");\nvar time_signatures_1 = require(\"../time-signatures\");\n/**\n * A BMSChart holds information about a particular BMS notechart.\n * Note that a BMSChart does not contain any information about `#RANDOM`,\n * as they are already processed after compilation.\n *\n * There is not many useful things you can do with a BMSChart other than\n * accessing the header fields and objects inside it.\n *\n * To extract information from a BMSChart,\n * please look at the documentation of higher-level classes,\n * such as {Keysounds}, {Notes}, and {Timing}.\n */\nvar BMSChart = /** @class */ (function () {\n    function BMSChart() {\n        /**\n         * {BMSHeaders} representing the BMS-specific headers of this notechart\n         */\n        this.headers = new headers_1.BMSHeaders();\n        /**\n         * {BMSObjects} representing all objects of this notechart\n         */\n        this.objects = new objects_1.BMSObjects();\n        /**\n         * {TimeSignatures} representing the time signature information in this chart\n         */\n        this.timeSignatures = new time_signatures_1.TimeSignatures();\n    }\n    /**\n     * Public: Converts measure number and fraction into beat.\n     * A single beat is equivalent to a quarter note in common time signature.\n     *\n     * @param {number} measure representing the measure number, starting from 0\n     * @param {number} fraction representing the fraction inside that measure, from 0 to 1\n     */\n    BMSChart.prototype.measureToBeat = function (measure, fraction) {\n        return this.timeSignatures.measureToBeat(measure, fraction);\n    };\n    return BMSChart;\n}());\nexports.BMSChart = BMSChart;\n//# sourceMappingURL=chart.js.map","// .dirname, .basename, and .extname methods are extracted from Node.js v8.11.1,\n// backported and transplited with Babel, with backwards-compat fixes\n\n// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n// resolves . and .. elements in a path array with directory names there\n// must be no slashes, empty elements, or device names (c:\\) in the array\n// (so also no leading and trailing slashes - it does not distinguish\n// relative and absolute paths)\nfunction normalizeArray(parts, allowAboveRoot) {\n  // if the path tries to go above the root, `up` ends up > 0\n  var up = 0;\n  for (var i = parts.length - 1; i >= 0; i--) {\n    var last = parts[i];\n    if (last === '.') {\n      parts.splice(i, 1);\n    } else if (last === '..') {\n      parts.splice(i, 1);\n      up++;\n    } else if (up) {\n      parts.splice(i, 1);\n      up--;\n    }\n  }\n\n  // if the path is allowed to go above the root, restore leading ..s\n  if (allowAboveRoot) {\n    for (; up--; up) {\n      parts.unshift('..');\n    }\n  }\n\n  return parts;\n}\n\n// path.resolve([from ...], to)\n// posix version\nexports.resolve = function() {\n  var resolvedPath = '',\n      resolvedAbsolute = false;\n\n  for (var i = arguments.length - 1; i >= -1 && !resolvedAbsolute; i--) {\n    var path = (i >= 0) ? arguments[i] : process.cwd();\n\n    // Skip empty and invalid entries\n    if (typeof path !== 'string') {\n      throw new TypeError('Arguments to path.resolve must be strings');\n    } else if (!path) {\n      continue;\n    }\n\n    resolvedPath = path + '/' + resolvedPath;\n    resolvedAbsolute = path.charAt(0) === '/';\n  }\n\n  // At this point the path should be resolved to a full absolute path, but\n  // handle relative paths to be safe (might happen when process.cwd() fails)\n\n  // Normalize the path\n  resolvedPath = normalizeArray(filter(resolvedPath.split('/'), function(p) {\n    return !!p;\n  }), !resolvedAbsolute).join('/');\n\n  return ((resolvedAbsolute ? '/' : '') + resolvedPath) || '.';\n};\n\n// path.normalize(path)\n// posix version\nexports.normalize = function(path) {\n  var isAbsolute = exports.isAbsolute(path),\n      trailingSlash = substr(path, -1) === '/';\n\n  // Normalize the path\n  path = normalizeArray(filter(path.split('/'), function(p) {\n    return !!p;\n  }), !isAbsolute).join('/');\n\n  if (!path && !isAbsolute) {\n    path = '.';\n  }\n  if (path && trailingSlash) {\n    path += '/';\n  }\n\n  return (isAbsolute ? '/' : '') + path;\n};\n\n// posix version\nexports.isAbsolute = function(path) {\n  return path.charAt(0) === '/';\n};\n\n// posix version\nexports.join = function() {\n  var paths = Array.prototype.slice.call(arguments, 0);\n  return exports.normalize(filter(paths, function(p, index) {\n    if (typeof p !== 'string') {\n      throw new TypeError('Arguments to path.join must be strings');\n    }\n    return p;\n  }).join('/'));\n};\n\n\n// path.relative(from, to)\n// posix version\nexports.relative = function(from, to) {\n  from = exports.resolve(from).substr(1);\n  to = exports.resolve(to).substr(1);\n\n  function trim(arr) {\n    var start = 0;\n    for (; start < arr.length; start++) {\n      if (arr[start] !== '') break;\n    }\n\n    var end = arr.length - 1;\n    for (; end >= 0; end--) {\n      if (arr[end] !== '') break;\n    }\n\n    if (start > end) return [];\n    return arr.slice(start, end - start + 1);\n  }\n\n  var fromParts = trim(from.split('/'));\n  var toParts = trim(to.split('/'));\n\n  var length = Math.min(fromParts.length, toParts.length);\n  var samePartsLength = length;\n  for (var i = 0; i < length; i++) {\n    if (fromParts[i] !== toParts[i]) {\n      samePartsLength = i;\n      break;\n    }\n  }\n\n  var outputParts = [];\n  for (var i = samePartsLength; i < fromParts.length; i++) {\n    outputParts.push('..');\n  }\n\n  outputParts = outputParts.concat(toParts.slice(samePartsLength));\n\n  return outputParts.join('/');\n};\n\nexports.sep = '/';\nexports.delimiter = ':';\n\nexports.dirname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  if (path.length === 0) return '.';\n  var code = path.charCodeAt(0);\n  var hasRoot = code === 47 /*/*/;\n  var end = -1;\n  var matchedSlash = true;\n  for (var i = path.length - 1; i >= 1; --i) {\n    code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        if (!matchedSlash) {\n          end = i;\n          break;\n        }\n      } else {\n      // We saw the first non-path separator\n      matchedSlash = false;\n    }\n  }\n\n  if (end === -1) return hasRoot ? '/' : '.';\n  if (hasRoot && end === 1) {\n    // return '//';\n    // Backwards-compat fix:\n    return '/';\n  }\n  return path.slice(0, end);\n};\n\nfunction basename(path) {\n  if (typeof path !== 'string') path = path + '';\n\n  var start = 0;\n  var end = -1;\n  var matchedSlash = true;\n  var i;\n\n  for (i = path.length - 1; i >= 0; --i) {\n    if (path.charCodeAt(i) === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          start = i + 1;\n          break;\n        }\n      } else if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // path component\n      matchedSlash = false;\n      end = i + 1;\n    }\n  }\n\n  if (end === -1) return '';\n  return path.slice(start, end);\n}\n\n// Uses a mixed approach for backwards-compatibility, as ext behavior changed\n// in new Node.js versions, so only basename() above is backported here\nexports.basename = function (path, ext) {\n  var f = basename(path);\n  if (ext && f.substr(-1 * ext.length) === ext) {\n    f = f.substr(0, f.length - ext.length);\n  }\n  return f;\n};\n\nexports.extname = function (path) {\n  if (typeof path !== 'string') path = path + '';\n  var startDot = -1;\n  var startPart = 0;\n  var end = -1;\n  var matchedSlash = true;\n  // Track the state of characters (if any) we see before our first dot and\n  // after any path separator we find\n  var preDotState = 0;\n  for (var i = path.length - 1; i >= 0; --i) {\n    var code = path.charCodeAt(i);\n    if (code === 47 /*/*/) {\n        // If we reached a path separator that was not part of a set of path\n        // separators at the end of the string, stop now\n        if (!matchedSlash) {\n          startPart = i + 1;\n          break;\n        }\n        continue;\n      }\n    if (end === -1) {\n      // We saw the first non-path separator, mark this as the end of our\n      // extension\n      matchedSlash = false;\n      end = i + 1;\n    }\n    if (code === 46 /*.*/) {\n        // If this is our first dot, mark it as the start of our extension\n        if (startDot === -1)\n          startDot = i;\n        else if (preDotState !== 1)\n          preDotState = 1;\n    } else if (startDot !== -1) {\n      // We saw a non-dot and non-path separator before our dot, so we should\n      // have a good chance at having a non-empty extension\n      preDotState = -1;\n    }\n  }\n\n  if (startDot === -1 || end === -1 ||\n      // We saw a non-dot character immediately before the dot\n      preDotState === 0 ||\n      // The (right-most) trimmed path component is exactly '..'\n      preDotState === 1 && startDot === end - 1 && startDot === startPart + 1) {\n    return '';\n  }\n  return path.slice(startDot, end);\n};\n\nfunction filter (xs, f) {\n    if (xs.filter) return xs.filter(f);\n    var res = [];\n    for (var i = 0; i < xs.length; i++) {\n        if (f(xs[i], i, xs)) res.push(xs[i]);\n    }\n    return res;\n}\n\n// String.prototype.substr - negative index don't work in IE8\nvar substr = 'ab'.substr(-1) === 'b'\n    ? function (str, start, len) { return str.substr(start, len) }\n    : function (str, start, len) {\n        if (start < 0) start = str.length + start;\n        return str.substr(start, len);\n    }\n;\n","import Progress from 'bemuse/progress'\nimport * as ProgressUtils from 'bemuse/progress/utils'\nimport readBlob from 'bemuse/utils/read-blob'\nimport _ from 'lodash'\nimport throat from 'throat'\nimport { IResource, IResources } from './types'\nimport { URLResources } from './url'\n\ntype MetadataFileJSON = {\n  files: BemusePackFileEntry[]\n  refs: BemusePackRefEntry[]\n}\ntype BemusePackRefEntry = { path: string; hash: string }\ntype BemusePackFileEntry = { name: string; ref: BemusePackContentRef }\ntype BemusePackContentRef = [number, number, number]\n\nexport class BemusePackageResources implements IResources {\n  private _base: IResources\n  private _fallback: IResources | undefined\n  private _fallbackPattern: RegExp | undefined\n  private _metadataFilename: string\n  public loadPayload: (\n    resourcePromise: PromiseLike<IResource>\n  ) => PromiseLike<Blob>\n\n  public progress = {\n    all: new Progress(),\n    current: new Progress(),\n  }\n\n  constructor(\n    base: string | IResources,\n    options: {\n      metadataFilename?: string\n      fallback?: string | IResources\n      fallbackPattern?: RegExp\n    } = {}\n  ) {\n    if (typeof base === 'string') {\n      base = new URLResources(new URL(base, location.href))\n    }\n\n    const fallback =\n      typeof options.fallback === 'string'\n        ? new URLResources(new URL(options.fallback, location.href))\n        : options.fallback\n\n    this._base = base\n    this._fallback = fallback\n    this._fallbackPattern = options.fallbackPattern\n    this._metadataFilename = options.metadataFilename || 'metadata.json'\n\n    const simultaneous = ProgressUtils.simultaneous(this.progress.current)\n    const nextProgress = () => {\n      const progress = new Progress()\n      simultaneous.add(progress)\n      return progress\n    }\n    this.loadPayload = ProgressUtils.wrapPromise(\n      this.progress.all,\n      throat(2, (resourcePromise) =>\n        resourcePromise\n          .then((resource) => resource.read(nextProgress()))\n          .then((arrayBuffer) => new Blob([arrayBuffer]))\n          .then(getPayload)\n      )\n    )\n  }\n\n  private _getMetadata = _.once(async () => {\n    const file = await this._base.file(this._metadataFilename)\n    const data = await file.read()\n    const text = await new Blob([data]).text()\n    return JSON.parse(text) as MetadataFileJSON\n  })\n\n  private _getRefs = _.once(async () => {\n    const metadata = await this._getMetadata()\n    return metadata.refs.map((spec) => new Ref(this, spec))\n  })\n\n  private _getFileMap = _.once(async () => {\n    const metadata = await this._getMetadata()\n    const files = new Map<string, BemusePackFileEntry>()\n    for (const file of metadata.files) {\n      files.set(file.name.toLowerCase(), file)\n    }\n    return files\n  })\n\n  get base() {\n    return this._base\n  }\n\n  async file(name: string): Promise<IResource> {\n    const fileMap = await this._getFileMap()\n    const file = fileMap.get(name.toLowerCase())\n    if (file) {\n      return new BemusePackageFileResource(this, file.ref, file.name)\n    } else if (\n      this._fallback &&\n      this._fallbackPattern &&\n      this._fallbackPattern.test(name)\n    ) {\n      return this._fallback.file(name)\n    } else {\n      throw new Error('Unable to find: ' + name)\n    }\n  }\n\n  async getBlob([index, start, end]: [number, number, number]) {\n    const refs = await this._getRefs()\n    const ref = refs[index]\n    const payload = await ref.load()\n    return payload.slice(start, end)\n  }\n}\n\nclass BemusePackageFileResource implements IResource {\n  constructor(\n    private resources: BemusePackageResources,\n    private ref: BemusePackContentRef,\n    public readonly name: string\n  ) {}\n\n  read(progress: Progress): PromiseLike<ArrayBuffer> {\n    return ProgressUtils.atomic(\n      progress,\n      this.resources\n        .getBlob(this.ref)\n        .then((blob) => readBlob(blob).as('arraybuffer'))\n    )\n  }\n\n  async resolveUrl() {\n    const blob = await this.resources.getBlob(this.ref)\n    return URL.createObjectURL(blob)\n  }\n}\n\nclass Ref {\n  private _basePromise: PromiseLike<IResource>\n  private _promise: PromiseLike<Blob> | undefined\n  constructor(\n    private resources: BemusePackageResources,\n    spec: BemusePackRefEntry\n  ) {\n    this._basePromise = resources.base.file(spec.path)\n  }\n\n  load() {\n    return (\n      this._promise ||\n      (this._promise = this.resources.loadPayload(this._basePromise))\n    )\n  }\n}\n\nexport default BemusePackageResources\n\nasync function getPayload(blob: Blob) {\n  const magic = await readBlob(blob.slice(0, 10)).as('text')\n  if (magic !== 'BEMUSEPACK') {\n    throw new Error('Invalid magic number')\n  }\n  const buffer = await readBlob(blob.slice(10, 14)).as('arraybuffer')\n  const array = new Uint8Array(buffer)\n  const length =\n    array[0] + (array[1] << 8) + (array[2] << 16) + (array[3] << 24)\n  const metadataLength = length\n  return blob.slice(14 + metadataLength)\n}\n","\nvar timesync = require('./timesync')\nmodule.exports = sync\n\nfunction sync(url, callback, callback2) {\n  var ws = new WebSocket(url)\n  var clocks = []\n  ws.onmessage = function(e) {\n    if (e.data == 'k') {\n      emit()\n    }\n    if (e.data.indexOf(',') >= 0) {\n      process(e.data)\n      emit()\n    }\n  }\n  ws.onclose = function() {\n    if (clocks.length < 1) return callback(new Error('no offset received'))\n    return callback(null, timesync.offset(clocks))\n  }\n  function emit() {\n    try {\n      ws.send('' + new Date().getTime())\n    } catch (e) {\n      // do nuffink\n    }\n  }\n  function process(text) {\n    var fields = text.split(',')\n    var a = +fields[0]\n    var b = +fields[1]\n    var c = new Date().getTime()\n    if (a <= c) clocks.push(timesync.convert([a, b, b, c]))\n    if (clocks.length >= 8) {\n      if (callback2) callback2(timesync.offset(clocks))\n    }\n  }\n}\n","\nexports.convert = function convert(array) {\n  var t1 = array[0]\n  var t2 = array[1]\n  var t3 = array[2]\n  var t4 = array[3]\n  return {\n    offset: ((t2 - t1) + (t3 - t4)) / 2,\n    delay:  (t4 - t1) - (t3 - t2)\n  }\n}\n\nexports.offset = function offset(clocks) {\n  clocks = clocks.slice()\n  clocks.sort(function(a, b) {\n    return a.offset - b.offset\n  })\n  clocks = clocks.slice(1, clocks.length - 1)\n  clocks.sort(function(a, b) {\n    return a.delay - b.delay\n  })\n  var sum = 0, count = 0\n  var hp = Math.ceil(clocks.length / 8)\n  for (var i = 0; i < clocks.length; i++) {\n    if (clocks[i].delay > clocks[0].delay) hp--\n    if (hp === 0) break\n    sum += clocks[i].offset\n    count += 1\n  }\n  return sum / count\n}\n","import createKeysoundCache from './createKeysoundCache'\n\nexport default createKeysoundCache()\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./BenchmarkPanel.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./BenchmarkPanel.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./BenchmarkPanel.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".BenchmarkPanel {\\n  background: #449;\\n  border: 2px solid #66e;\\n  padding: 4px;\\n}\\n.BenchmarkPanel table {\\n  font-size: 10px;\\n}\", \"\"]);\n\n// exports\n","import _ from 'lodash'\n\nimport PlayerStats from './player-stats'\nimport {\n  MISSED,\n  getJudgeForNotechart,\n  isBad,\n  judgeEndTime,\n  judgeTime,\n  IJudge,\n  Judgment,\n  JudgedJudgment,\n} from '../judgments'\nimport Player from '../player'\nimport { GameNote } from 'bemuse-notechart/lib/types'\nimport GameInput from '../input'\nimport Control from '../input/control'\nimport invariant from 'invariant'\n\ntype NoteResult = {\n  judgment: Judgment\n  status: NoteStatus\n  delta: number\n}\n\nenum NoteStatus {\n  /** For long notes -- when the player is holding the note but not yet release it. */\n  Active = 'active',\n  /** This not is not yet judged. */\n  Unjudged = 'unjudged',\n  /** This note is fully-judged. */\n  Judged = 'judged',\n}\n\ntype Notifications = {\n  sounds: (\n    | { type: 'hit'; note: GameNote; judgment: Judgment }\n    | { type: 'free'; note: GameNote }\n    | { type: 'break'; note: GameNote }\n  )[]\n  judgments: {}[]\n}\n\nfunction initializeNotifications(): Notifications {\n  return { sounds: [], judgments: [] }\n}\n\n// The PlayerState class holds a single player's state, including the stats\n// (score, current combo, maximum combo).\nexport class PlayerState {\n  /** The PlayerStats object. */\n  public stats: PlayerStats\n\n  /** The notifications from the previous update. */\n  public notifications = initializeNotifications()\n  /** The current note scrolling speed. */\n  public speed: number\n  /** `true` if finished playing, `false` otherwise. */\n  public finished = false\n  /** `true` if score is invalid due to autoplay being activated. `false` otherwise. */\n  public tainted = false\n  public input: Map<string, Control> = new Map()\n\n  private _columns: string[]\n  private _noteBufferByColumn: _.Dictionary<NoteBuffer>\n  private _noteResult: Map<GameNote, NoteResult>\n  private _duration: number\n  private _judge: IJudge\n  private _gameTime = 0\n  private _rawInput?: GameInput\n  private _pinching: null | { start: number; speed: number } = null\n\n  constructor(public readonly player: Player) {\n    this._columns = player.columns\n    this._noteBufferByColumn = _(player.notechart.notes)\n      .sortBy((n) => n.time)\n      .groupBy((n) => n.column)\n      .mapValues(noteBuffer(this))\n      .value()\n    this._noteResult = new Map()\n    this._duration = player.notechart.duration\n    this._judge = getJudgeForNotechart(player.notechart, {\n      tutorial: player.options.tutorial,\n    })\n    this.stats = new PlayerStats(player.notechart)\n    this.speed = player.options.speed\n  }\n\n  /**\n   * Updates the state. Judge the notes and emit notifications.\n   */\n  update(gameTime: number, input: GameInput) {\n    this._gameTime = gameTime\n    this._rawInput = input\n    this.notifications = initializeNotifications()\n    this._updateInputColumnMap()\n    this._judgeNotes()\n    this._updateSpeed()\n    if (gameTime > this._duration + 3) this.finished = true\n  }\n\n  getNoteStatus(note: GameNote): NoteStatus {\n    const result = this._noteResult.get(note)\n    if (!result) return NoteStatus.Unjudged\n    return result.status\n  }\n\n  getNoteJudgment(note: GameNote) {\n    const result = this._noteResult.get(note)\n    if (!result) return Judgment.Unjudged\n    return result.judgment\n  }\n\n  getPlayerInput(control: string) {\n    return this._rawInput!.get(`p${this.player.number}_${control}`)!\n  }\n\n  _updateInputColumnMap() {\n    this.input = new Map(\n      this._columns.map((column) => [column, this.getPlayerInput(column)])\n    )\n  }\n\n  _judgeNotes() {\n    for (const column of this._columns) {\n      const buffer = this._noteBufferByColumn[column]\n      if (buffer) {\n        const control = this.input.get(column)!\n        this._judgeColumn(buffer, control, column)\n        buffer.update()\n      }\n    }\n  }\n\n  _updateSpeed() {\n    if (this.getPlayerInput('speedup').justPressed) {\n      this._modifySpeed(+1)\n    }\n    if (this.getPlayerInput('speeddown').justPressed) {\n      this._modifySpeed(-1)\n    }\n    const pinch = this.getPlayerInput('pinch').value\n    if (pinch && !this._pinching) {\n      this._pinching = { start: pinch, speed: this.speed }\n    } else if (!pinch) {\n      this._pinching = null\n    }\n    if (pinch && this._pinching) {\n      const pinching = this._pinching\n      const speed = (pinching.speed * pinch) / pinching.start\n      this.speed = Math.max(0.2, Math.round(speed * 10) / 10)\n    }\n  }\n\n  _modifySpeed(direction: 1 | -1) {\n    const amount = this._rawInput!.get('select').value\n      ? 0.1\n      : this.speed < 0.5\n      ? 0.3\n      : 0.5\n    this.speed += direction * amount\n    if (this.speed < 0.2) this.speed = 0.2\n  }\n\n  _shouldAutoplay() {\n    return this.player.options.autoplayEnabled || isAutoplayEnabled()\n  }\n\n  _judgeColumn(buffer: NoteBuffer, control: Control, column: string) {\n    let judgedNote\n    let judgment\n    const notes = buffer.notes\n    let autoPlayed = false\n    for (let i = buffer.startIndex; i < notes.length; i++) {\n      const note = notes[i]\n      if (this._shouldJudge(note, control, buffer)) {\n        const shouldBreak = this.getNoteStatus(note) !== 'active'\n        judgedNote = note\n        judgment = this._judgeNote(note)\n        if (this._shouldAutoplay()) {\n          autoPlayed = true\n        }\n        if (shouldBreak) break\n      }\n    }\n    if (control.justPressed || autoPlayed) {\n      if (judgedNote && judgment != null) {\n        this.notifications.sounds!.push({\n          note: judgedNote,\n          type: 'hit',\n          judgment: judgment,\n        })\n      } else {\n        const freestyleNote = this._getFreestyleNote(notes)\n        if (freestyleNote) {\n          const shouldPlayFreestyleNote =\n            this.player.options.placement !== '3d' ||\n            !this._isSandwiched(column)\n          if (shouldPlayFreestyleNote) {\n            this.notifications.sounds!.push({\n              note: freestyleNote,\n              type: 'free',\n            })\n          }\n        }\n      }\n    }\n  }\n\n  _getClosestNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => Math.abs(this._gameTime - note.time))\n  }\n\n  _getFreestyleNote(notes: GameNote[]) {\n    return _.minBy(notes, (note) => {\n      const distance = Math.abs(this._gameTime - note.time)\n      const penalty = this._gameTime < note.time - 1 ? 1000000 : 0\n      return distance + penalty\n    })\n  }\n\n  _isSandwiched(column: string) {\n    const mapping: { [col: string]: string[] } = {\n      '2': ['1', '3'],\n      '3': ['2', '4'],\n      '4': ['3', '5'],\n      '5': ['4', '6'],\n      '6': ['5', '7'],\n    }\n    if (!mapping[column]) return false\n    return mapping[column].every((adjacentColumn) => {\n      const buffer = this._noteBufferByColumn[adjacentColumn]\n      if (!buffer) return false\n      return buffer.notes.some(\n        (note) => Math.abs(this._gameTime - note.time) < 0.1\n      )\n    })\n  }\n\n  _shouldJudge(note: GameNote, control: Control, buffer: NoteBuffer) {\n    const status = this.getNoteStatus(note)\n    if (status === 'unjudged') {\n      if (this._shouldAutoplay() && this._gameTime >= note.time) {\n        this.tainted = true\n        return true\n      }\n      const judgment = judgeTime(this._gameTime, note.time, this._judge)\n      const missed = judgment === MISSED\n      let hit = judgment > 0 && control.changed && control.value\n      if (isBad(judgment) && this._getClosestNote(buffer.notes) !== note) {\n        hit = false\n      }\n      return missed || hit\n    } else if (status === 'active') {\n      const noteEnd = note.end || invariant(false, 'note.end must exist')\n      if (this._shouldAutoplay() && this._gameTime >= noteEnd.time) {\n        this.tainted = true\n        return true\n      }\n      const judgment = judgeEndTime(this._gameTime, noteEnd.time, this._judge)\n      const missed = judgment === MISSED\n      const lifted = control.changed\n      const scratch = note.column === 'SC'\n      const passed = this._gameTime >= noteEnd.time\n      return missed || lifted || (scratch && passed)\n    } else {\n      return false\n    }\n  }\n\n  _judgeNote(note: GameNote) {\n    let delta = this._gameTime - note.time\n    let judgment = judgeTime(this._gameTime, note.time, this._judge)\n    let result = this._noteResult.get(note)\n    const isDown = !result || result.status === 'unjudged'\n    const isUp = result && result.status === 'active'\n    if (this._shouldAutoplay() && judgment >= 1) {\n      judgment = 1\n    }\n    if (note.end) {\n      if (isDown) {\n        const status =\n          judgment === MISSED ? NoteStatus.Judged : NoteStatus.Active\n        if (judgment === MISSED) {\n          // judge missed long note twice\n          this._setJudgment(judgment, delta, note.column)\n        }\n        result = { status, judgment, delta }\n      } else if (isUp) {\n        const scratch = note.column === 'SC'\n        delta = this._gameTime - note.end.time\n        judgment =\n          judgeEndTime(this._gameTime, note.end.time, this._judge) || MISSED\n        if (scratch && delta > 0) judgment = 1\n        result = { status: NoteStatus.Judged, judgment, delta }\n      }\n    } else {\n      result = { status: NoteStatus.Judged, judgment, delta }\n    }\n    if (judgment === MISSED) {\n      this.notifications.sounds.push({ note, type: 'break' })\n    }\n    if (isDown && judgment !== MISSED) {\n      this.stats.handleDelta(delta)\n    }\n    if (!result) {\n      throw new Error('Invariant violation: result must not be undefined')\n    }\n    if (!judgment) {\n      throw new Error(\n        'Invariant violation: note should be judged by this point'\n      )\n    }\n    this._noteResult.set(note, result)\n    this._setJudgment(judgment, delta, note.column)\n    return judgment\n  }\n\n  _setJudgment(judgment: JudgedJudgment, delta: number, column: string) {\n    this.stats.handleJudgment(judgment)\n    const info = { judgment, combo: this.stats.combo, delta, column }\n    this.notifications.judgments.push(info)\n  }\n}\n\ntype NoteBuffer = {\n  notes: GameNote[]\n  startIndex: number\n  update: () => void\n}\n\nfunction isAutoplayEnabled() {\n  return !!(window as any).BEMUSE_AUTOPLAY\n}\n\nfunction noteBuffer(state: PlayerState) {\n  return function bufferNotes(notes: GameNote[]): NoteBuffer {\n    let startIndex = 0\n    return {\n      notes,\n      get startIndex() {\n        return startIndex\n      },\n      update() {\n        while (\n          startIndex < notes.length &&\n          state.getNoteStatus(notes[startIndex]) === 'judged'\n        ) {\n          startIndex += 1\n        }\n      },\n    }\n  }\n}\n\nexport default PlayerState\n","// Source: http://jsfiddle.net/vWx8V/\n// http://stackoverflow.com/questions/5603195/full-list-of-javascript-keycodes\n\n/**\n * Conenience method returns corresponding value for given keyName or keyCode.\n *\n * @param {Mixed} keyCode {Number} or keyName {String}\n * @return {Mixed}\n * @api public\n */\n\nfunction keyCode(searchInput) {\n  // Keyboard Events\n  if (searchInput && 'object' === typeof searchInput) {\n    var hasKeyCode = searchInput.which || searchInput.keyCode || searchInput.charCode\n    if (hasKeyCode) searchInput = hasKeyCode\n  }\n\n  // Numbers\n  if ('number' === typeof searchInput) return names[searchInput]\n\n  // Everything else (cast to string)\n  var search = String(searchInput)\n\n  // check codes\n  var foundNamedKey = codes[search.toLowerCase()]\n  if (foundNamedKey) return foundNamedKey\n\n  // check aliases\n  var foundNamedKey = aliases[search.toLowerCase()]\n  if (foundNamedKey) return foundNamedKey\n\n  // weird character?\n  if (search.length === 1) return search.charCodeAt(0)\n\n  return undefined\n}\n\n/**\n * Compares a keyboard event with a given keyCode or keyName.\n *\n * @param {Event} event Keyboard event that should be tested\n * @param {Mixed} keyCode {Number} or keyName {String}\n * @return {Boolean}\n * @api public\n */\nkeyCode.isEventKey = function isEventKey(event, nameOrCode) {\n  if (event && 'object' === typeof event) {\n    var keyCode = event.which || event.keyCode || event.charCode\n    if (keyCode === null || keyCode === undefined) { return false; }\n    if (typeof nameOrCode === 'string') {\n      // check codes\n      var foundNamedKey = codes[nameOrCode.toLowerCase()]\n      if (foundNamedKey) { return foundNamedKey === keyCode; }\n    \n      // check aliases\n      var foundNamedKey = aliases[nameOrCode.toLowerCase()]\n      if (foundNamedKey) { return foundNamedKey === keyCode; }\n    } else if (typeof nameOrCode === 'number') {\n      return nameOrCode === keyCode;\n    }\n    return false;\n  }\n}\n\nexports = module.exports = keyCode;\n\n/**\n * Get by name\n *\n *   exports.code['enter'] // => 13\n */\n\nvar codes = exports.code = exports.codes = {\n  'backspace': 8,\n  'tab': 9,\n  'enter': 13,\n  'shift': 16,\n  'ctrl': 17,\n  'alt': 18,\n  'pause/break': 19,\n  'caps lock': 20,\n  'esc': 27,\n  'space': 32,\n  'page up': 33,\n  'page down': 34,\n  'end': 35,\n  'home': 36,\n  'left': 37,\n  'up': 38,\n  'right': 39,\n  'down': 40,\n  'insert': 45,\n  'delete': 46,\n  'command': 91,\n  'left command': 91,\n  'right command': 93,\n  'numpad *': 106,\n  'numpad +': 107,\n  'numpad -': 109,\n  'numpad .': 110,\n  'numpad /': 111,\n  'num lock': 144,\n  'scroll lock': 145,\n  'my computer': 182,\n  'my calculator': 183,\n  ';': 186,\n  '=': 187,\n  ',': 188,\n  '-': 189,\n  '.': 190,\n  '/': 191,\n  '`': 192,\n  '[': 219,\n  '\\\\': 220,\n  ']': 221,\n  \"'\": 222\n}\n\n// Helper aliases\n\nvar aliases = exports.aliases = {\n  'windows': 91,\n  '': 16,\n  '': 18,\n  '': 17,\n  '': 91,\n  'ctl': 17,\n  'control': 17,\n  'option': 18,\n  'pause': 19,\n  'break': 19,\n  'caps': 20,\n  'return': 13,\n  'escape': 27,\n  'spc': 32,\n  'spacebar': 32,\n  'pgup': 33,\n  'pgdn': 34,\n  'ins': 45,\n  'del': 46,\n  'cmd': 91\n}\n\n/*!\n * Programatically add the following\n */\n\n// lower case chars\nfor (i = 97; i < 123; i++) codes[String.fromCharCode(i)] = i - 32\n\n// numbers\nfor (var i = 48; i < 58; i++) codes[i - 48] = i\n\n// function keys\nfor (i = 1; i < 13; i++) codes['f'+i] = i + 111\n\n// numpad keys\nfor (i = 0; i < 10; i++) codes['numpad '+i] = i + 96\n\n/**\n * Get by code\n *\n *   exports.name[13] // => 'Enter'\n */\n\nvar names = exports.names = exports.title = {} // title for backward compat\n\n// Create reverse mapping\nfor (i in codes) names[codes[i]] = i\n\n// Add aliases\nfor (var alias in aliases) {\n  codes[alias] = aliases[alias]\n}\n","import * as touch3d from './touch3d'\nimport NoteArea from './note-area'\nimport { MISSED, breaksCombo } from '../judgments'\nimport { getGauge } from './Gauge'\n\nexport class PlayerDisplay {\n  constructor(player, skinData) {\n    this._currentSpeed = 1\n    this._player = player\n    this._noteArea = new NoteArea(\n      player.notechart.notes,\n      player.notechart.barLines\n    )\n    this._stateful = {}\n    this._defaultData = {\n      placement: player.options.placement,\n      scratch: player.options.scratch,\n      key_mode: player.notechart.getKeyMode(player.options.scratch),\n      lane_lift: Math.max(0, -player.options.laneCover),\n      lane_press: Math.max(0, player.options.laneCover),\n    }\n    this._gauge = getGauge(player.options.gauge)\n    this._touch3dMode = skinData.displayMode === 'touch3d'\n  }\n\n  update(time, gameTime, playerState) {\n    const touch3dMode = this._touch3dMode\n    const player = this._player\n    const noteArea = this._noteArea\n    const stateful = this._stateful\n    const beat = player.notechart.secondsToBeat(gameTime)\n    const position = player.notechart.beatToPosition(beat)\n    const spacing = player.notechart.spacingAtBeat(beat)\n    const data = Object.assign({}, this._defaultData)\n    const push = (key, value) => (data[key] || (data[key] = [])).push(value)\n    const gauge = this._gauge\n\n    this._currentSpeed += (playerState.speed - this._currentSpeed) / 3\n    const speed = this._currentSpeed * spacing\n\n    updateBeat()\n    updateVisibleNotes()\n    updateBarLines()\n    updateInput()\n    updateJudgment()\n    updateGauge()\n    updateExplode()\n\n    data['speed'] = playerState.speed.toFixed(1) + 'x'\n    data['stat_1'] = getCount(1)\n    data['stat_2'] = getCount(2)\n    data['stat_3'] = getCount(3)\n    data['stat_4'] = getCount(4)\n    data['stat_missed'] = getCount(MISSED)\n    data['stat_acc'] = getAccuracy()\n    const bpm = player.notechart.bpmAtBeat(beat)\n    data['bpm'] = bpm < 1 ? '' : Math.round(bpm) % 10000 || ''\n\n    Object.assign(data, stateful)\n    return data\n\n    function updateBeat() {\n      data.beat = beat\n    }\n\n    function getCount(judgment) {\n      return playerState.stats.counts && playerState.stats.counts[judgment]\n    }\n\n    function getAccuracy() {\n      return ((playerState.stats.currentAccuracy || 0) * 100).toFixed(2) + '%'\n    }\n\n    function updateVisibleNotes() {\n      const entities = noteArea.getVisibleNotes(position, getUpperBound(), 1)\n      if (touch3dMode) {\n        const putNote = (id, noteY, column, scale = 1) => {\n          const row = touch3d.getRow(noteY - 0.01)\n          const columnIndex = +column || -1\n          const areaWidth = touch3d.PLAY_AREA_WIDTH\n          const xOffset =\n            row.projection * areaWidth * ((2 * (columnIndex - 0.5)) / 7 - 1)\n          const desiredWidth = (row.projection * scale * areaWidth * 2) / 7\n          push(`note3d_${column}`, {\n            key: id,\n            y: row.y,\n            x: xOffset + 1280 / 2,\n            width: desiredWidth,\n          })\n        }\n        const longNoteStep = 3 / 128\n        for (const entity of entities) {\n          const note = entity.note\n          const column = note.column\n          if (entity.height) {\n            let c = 0\n            const start = entity.y + entity.height\n            for (\n              let i =\n                start -\n                Math.max(\n                  0,\n                  Math.floor((start - 1) / longNoteStep) * longNoteStep\n                );\n              i >= 0 && i >= entity.y;\n              i -= longNoteStep\n            ) {\n              putNote(note.id + 'x' + c++, i, column, 0.8)\n            }\n            putNote(note.id, entity.y + entity.height, column)\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              putNote(note.id, entity.y, column)\n            }\n          }\n        }\n      } else {\n        for (const entity of entities) {\n          const note = entity.note\n          const column = note.column\n          if (entity.height) {\n            const judgment = playerState.getNoteJudgment(note)\n            const status = playerState.getNoteStatus(note)\n            push(`longnote_${column}`, {\n              key: note.id,\n              y: entity.y,\n              height: entity.height,\n              active: judgment !== 0 && judgment !== MISSED,\n              missed: status === 'judged' && judgment === MISSED,\n            })\n          } else {\n            if (playerState.getNoteStatus(note) !== 'judged') {\n              push(`note_${column}`, {\n                key: note.id,\n                y: entity.y,\n              })\n            }\n          }\n        }\n      }\n    }\n\n    function updateBarLines() {\n      const entities = noteArea.getVisibleBarLines(position, getUpperBound(), 1)\n      for (const entity of entities) {\n        if (touch3dMode) {\n          const row = touch3d.getRow(entity.y - 0.01)\n          push('barlines3d', {\n            key: entity.id,\n            y: row.y,\n            x: row.projection * -touch3d.PLAY_AREA_WIDTH + 1280 / 2,\n            width: row.projection * touch3d.PLAY_AREA_WIDTH * 2,\n          })\n        } else {\n          push('barlines', { key: entity.id, y: entity.y })\n        }\n      }\n    }\n\n    function updateInput() {\n      const input = playerState.input\n      for (const column of player.columns) {\n        const control = input.get(column)\n        data[`${column}_active`] = control.value !== 0 ? 1 : 0\n        if (control.changed) {\n          if (control.value !== 0) {\n            stateful[`${column}_down`] = time\n          } else {\n            stateful[`${column}_up`] = time\n          }\n        }\n      }\n    }\n\n    function updateJudgment() {\n      const notifications = playerState.notifications.judgments\n      const notification = notifications[notifications.length - 1]\n      if (notification) {\n        const name =\n          notification.judgment === -1 ? 'missed' : `${notification.judgment}`\n        stateful[`judge_${name}`] = time\n        const deviationMode =\n          notification.judgment === -1 || notification.judgment === 1\n            ? 'none'\n            : notification.delta > 0\n            ? 'late'\n            : notification.delta < 0\n            ? 'early'\n            : 'none'\n        stateful[`judge_deviation_${deviationMode}`] = time\n        stateful['combo'] = notification.combo\n      }\n      data['score'] = playerState.stats.score\n    }\n\n    function updateGauge() {\n      gauge.update(playerState)\n      if (gauge.shouldDisplay()) {\n        if (!stateful['gauge_enter']) stateful['gauge_enter'] = time\n      } else {\n        if (stateful['gauge_enter']) {\n          if (!stateful['gauge_exit']) stateful['gauge_exit'] = time\n        }\n      }\n      data['gauge_primary'] = gauge.getPrimary()\n      data['gauge_secondary'] = gauge.getSecondary()\n      data['gauge_extra'] = gauge.getExtra()\n    }\n\n    function updateExplode() {\n      const notifications = playerState.notifications.judgments\n      for (let i = 0; i < notifications.length; i++) {\n        const notification = notifications[i]\n        if (!breaksCombo(notification.judgment)) {\n          stateful[`${notification.column}_explode`] = time\n        }\n      }\n    }\n\n    function getUpperBound() {\n      return position + 5 / speed\n    }\n  }\n}\n\nexport default PlayerDisplay\n","'use strict';\nconst AggregateError = require('aggregate-error');\n\nmodule.exports = async (\n\titerable,\n\tmapper,\n\t{\n\t\tconcurrency = Infinity,\n\t\tstopOnError = true\n\t} = {}\n) => {\n\treturn new Promise((resolve, reject) => {\n\t\tif (typeof mapper !== 'function') {\n\t\t\tthrow new TypeError('Mapper function is required');\n\t\t}\n\n\t\tif (!((Number.isSafeInteger(concurrency) || concurrency === Infinity) && concurrency >= 1)) {\n\t\t\tthrow new TypeError(`Expected \\`concurrency\\` to be an integer from 1 and up or \\`Infinity\\`, got \\`${concurrency}\\` (${typeof concurrency})`);\n\t\t}\n\n\t\tconst result = [];\n\t\tconst errors = [];\n\t\tconst iterator = iterable[Symbol.iterator]();\n\t\tlet isRejected = false;\n\t\tlet isIterableDone = false;\n\t\tlet resolvingCount = 0;\n\t\tlet currentIndex = 0;\n\n\t\tconst next = () => {\n\t\t\tif (isRejected) {\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tconst nextItem = iterator.next();\n\t\t\tconst index = currentIndex;\n\t\t\tcurrentIndex++;\n\n\t\t\tif (nextItem.done) {\n\t\t\t\tisIterableDone = true;\n\n\t\t\t\tif (resolvingCount === 0) {\n\t\t\t\t\tif (!stopOnError && errors.length !== 0) {\n\t\t\t\t\t\treject(new AggregateError(errors));\n\t\t\t\t\t} else {\n\t\t\t\t\t\tresolve(result);\n\t\t\t\t\t}\n\t\t\t\t}\n\n\t\t\t\treturn;\n\t\t\t}\n\n\t\t\tresolvingCount++;\n\n\t\t\t(async () => {\n\t\t\t\ttry {\n\t\t\t\t\tconst element = await nextItem.value;\n\t\t\t\t\tresult[index] = await mapper(element, index);\n\t\t\t\t\tresolvingCount--;\n\t\t\t\t\tnext();\n\t\t\t\t} catch (error) {\n\t\t\t\t\tif (stopOnError) {\n\t\t\t\t\t\tisRejected = true;\n\t\t\t\t\t\treject(error);\n\t\t\t\t\t} else {\n\t\t\t\t\t\terrors.push(error);\n\t\t\t\t\t\tresolvingCount--;\n\t\t\t\t\t\tnext();\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t})();\n\t\t};\n\n\t\tfor (let i = 0; i < concurrency; i++) {\n\t\t\tnext();\n\n\t\t\tif (isIterableDone) {\n\t\t\t\tbreak;\n\t\t\t}\n\t\t}\n\t});\n};\n","'use strict';\nconst indentString = require('indent-string');\nconst cleanStack = require('clean-stack');\n\nconst cleanInternalStack = stack => stack.replace(/\\s+at .*aggregate-error\\/index.js:\\d+:\\d+\\)?/g, '');\n\nclass AggregateError extends Error {\n\tconstructor(errors) {\n\t\tif (!Array.isArray(errors)) {\n\t\t\tthrow new TypeError(`Expected input to be an Array, got ${typeof errors}`);\n\t\t}\n\n\t\terrors = [...errors].map(error => {\n\t\t\tif (error instanceof Error) {\n\t\t\t\treturn error;\n\t\t\t}\n\n\t\t\tif (error !== null && typeof error === 'object') {\n\t\t\t\t// Handle plain error objects with message property and/or possibly other metadata\n\t\t\t\treturn Object.assign(new Error(error.message), error);\n\t\t\t}\n\n\t\t\treturn new Error(error);\n\t\t});\n\n\t\tlet message = errors\n\t\t\t.map(error => {\n\t\t\t\t// The `stack` property is not standardized, so we can't assume it exists\n\t\t\t\treturn typeof error.stack === 'string' ? cleanInternalStack(cleanStack(error.stack)) : String(error);\n\t\t\t})\n\t\t\t.join('\\n');\n\t\tmessage = '\\n' + indentString(message, 4);\n\t\tsuper(message);\n\n\t\tthis.name = 'AggregateError';\n\n\t\tObject.defineProperty(this, '_errors', {value: errors});\n\t}\n\n\t* [Symbol.iterator]() {\n\t\tfor (const error of this._errors) {\n\t\t\tyield error;\n\t\t}\n\t}\n}\n\nmodule.exports = AggregateError;\n","'use strict';\n\nmodule.exports = (string, count = 1, options) => {\n\toptions = {\n\t\tindent: ' ',\n\t\tincludeEmptyLines: false,\n\t\t...options\n\t};\n\n\tif (typeof string !== 'string') {\n\t\tthrow new TypeError(\n\t\t\t`Expected \\`input\\` to be a \\`string\\`, got \\`${typeof string}\\``\n\t\t);\n\t}\n\n\tif (typeof count !== 'number') {\n\t\tthrow new TypeError(\n\t\t\t`Expected \\`count\\` to be a \\`number\\`, got \\`${typeof count}\\``\n\t\t);\n\t}\n\n\tif (typeof options.indent !== 'string') {\n\t\tthrow new TypeError(\n\t\t\t`Expected \\`options.indent\\` to be a \\`string\\`, got \\`${typeof options.indent}\\``\n\t\t);\n\t}\n\n\tif (count === 0) {\n\t\treturn string;\n\t}\n\n\tconst regex = options.includeEmptyLines ? /^/gm : /^(?!\\s*$)/gm;\n\n\treturn string.replace(regex, options.indent.repeat(count));\n};\n","'use strict';\nconst os = require('os');\n\nconst extractPathRegex = /\\s+at.*(?:\\(|\\s)(.*)\\)?/;\nconst pathRegex = /^(?:(?:(?:node|(?:internal\\/[\\w/]*|.*node_modules\\/(?:babel-polyfill|pirates)\\/.*)?\\w+)\\.js:\\d+:\\d+)|native)/;\nconst homeDir = typeof os.homedir === 'undefined' ? '' : os.homedir();\n\nmodule.exports = (stack, options) => {\n\toptions = Object.assign({pretty: false}, options);\n\n\treturn stack.replace(/\\\\/g, '/')\n\t\t.split('\\n')\n\t\t.filter(line => {\n\t\t\tconst pathMatches = line.match(extractPathRegex);\n\t\t\tif (pathMatches === null || !pathMatches[1]) {\n\t\t\t\treturn true;\n\t\t\t}\n\n\t\t\tconst match = pathMatches[1];\n\n\t\t\t// Electron\n\t\t\tif (\n\t\t\t\tmatch.includes('.app/Contents/Resources/electron.asar') ||\n\t\t\t\tmatch.includes('.app/Contents/Resources/default_app.asar')\n\t\t\t) {\n\t\t\t\treturn false;\n\t\t\t}\n\n\t\t\treturn !pathRegex.test(match);\n\t\t})\n\t\t.filter(line => line.trim() !== '')\n\t\t.map(line => {\n\t\t\tif (options.pretty) {\n\t\t\t\treturn line.replace(extractPathRegex, (m, p1) => m.replace(p1, p1.replace(homeDir, '~')));\n\t\t\t}\n\n\t\t\treturn line;\n\t\t})\n\t\t.join('\\n');\n};\n","import {\n  ARCHIVE_REGEXP,\n  CustomSongResources,\n  downloadFileEntryFromURL,\n} from './custom-song-resources'\nimport { FileEntry, ICustomSongResources, LoggingFunction } from './types'\n\nimport { addUnprefixed } from './addUnprefixed'\n\n// TODO [#634]: Remove the `DndResources` class and have users of this class create a `CustomSongResources` directly.\n//\n// The original implementation of DndResources class has been extracted\n// into a CustomSongResources superclass in commit cc6a6e70586487ef476890f5a7911837186a7a32,\n// so that part of its logic can be re-used in other contexts, such as in commit ba9e15bab72fec17a144e40433cb3a4ffd31db5b.\n//\n// Now this `DndResources` class is really dumb and we want to prefer composition over inheritance.\n// This class should be removed.\nexport class DndResources\n  extends CustomSongResources\n  implements ICustomSongResources\n{\n  constructor(event: DragEvent) {\n    super({\n      getFiles: (log) => getFilesFromEvent(event, log),\n    })\n  }\n}\n\nexport default DndResources\n\nasync function getFilesFromEvent(\n  event: DragEvent,\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const dataTransfer = event.dataTransfer\n  if (!dataTransfer) {\n    throw new Error('Expect event.dataTransfer to be present')\n  }\n  if (dataTransfer.types.indexOf('text/uri-list') > -1) {\n    const url = dataTransfer\n      .getData('text/uri-list')\n      .split(/\\r\\n|\\r|\\n/)\n      .filter((t) => t && !t.startsWith('#'))[0]\n    if (ARCHIVE_REGEXP.test(url && url.replace(/[?#].*/, ''))) {\n      log('Link to archive file detected. Trying to download')\n      return [await downloadFileEntryFromURL(url, log)]\n    }\n  } else if (dataTransfer.items) {\n    for (const item of Array.from(dataTransfer.items)) {\n      await readItem(item)\n    }\n  } else if (dataTransfer.files) {\n    for (const file of Array.from(dataTransfer.files)) {\n      addFile(file)\n    }\n  }\n  return out\n\n  async function readItem(item: DataTransferItem) {\n    const entry = item.webkitGetAsEntry && item.webkitGetAsEntry()\n    if (entry) {\n      await readEntry(entry)\n    } else {\n      const file = item.getAsFile && item.getAsFile()\n      if (file) addFile(file)\n    }\n  }\n\n  function readEntry(entry: any, prefix = '') {\n    if (entry.isFile) {\n      return readFile(entry, prefix)\n    } else if (entry.isDirectory) {\n      return readDirectory(entry, prefix)\n    }\n  }\n\n  async function readFile(entry: any, prefix = '') {\n    const file = await new Promise<File>((resolve, reject) => {\n      entry.file(resolve, reject)\n    })\n    addFile(file, prefix)\n    return file\n  }\n\n  async function readDirectory(dir: any, prefix = '') {\n    const entries: any[] = []\n    const reader = dir.createReader()\n    const readMore = () =>\n      new Promise<any>((resolve, reject) => {\n        reader.readEntries(resolve, reject)\n      })\n    for (;;) {\n      const results = await readMore()\n      if (!results || results.length === 0) break\n      entries.push(...Array.from(results))\n    }\n    for (const entry of entries) {\n      await readEntry(entry, prefix + dir.name + '/')\n    }\n  }\n\n  function addFile(file: File, prefix = '') {\n    if (file) {\n      addUnprefixed(prefix, file.name, (name) => {\n        out.push({ name, file })\n      })\n    }\n  }\n}\n","/*!\n\tCopyright (c) 2018 Jed Watson.\n\tLicensed under the MIT License (MIT), see\n\thttp://jedwatson.github.io/classnames\n*/\n/* global define */\n\n(function () {\n\t'use strict';\n\n\tvar hasOwn = {}.hasOwnProperty;\n\tvar nativeCodeString = '[native code]';\n\n\tfunction classNames() {\n\t\tvar classes = [];\n\n\t\tfor (var i = 0; i < arguments.length; i++) {\n\t\t\tvar arg = arguments[i];\n\t\t\tif (!arg) continue;\n\n\t\t\tvar argType = typeof arg;\n\n\t\t\tif (argType === 'string' || argType === 'number') {\n\t\t\t\tclasses.push(arg);\n\t\t\t} else if (Array.isArray(arg)) {\n\t\t\t\tif (arg.length) {\n\t\t\t\t\tvar inner = classNames.apply(null, arg);\n\t\t\t\t\tif (inner) {\n\t\t\t\t\t\tclasses.push(inner);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t} else if (argType === 'object') {\n\t\t\t\tif (arg.toString !== Object.prototype.toString && !arg.toString.toString().includes('[native code]')) {\n\t\t\t\t\tclasses.push(arg.toString());\n\t\t\t\t\tcontinue;\n\t\t\t\t}\n\n\t\t\t\tfor (var key in arg) {\n\t\t\t\t\tif (hasOwn.call(arg, key) && arg[key]) {\n\t\t\t\t\t\tclasses.push(key);\n\t\t\t\t\t}\n\t\t\t\t}\n\t\t\t}\n\t\t}\n\n\t\treturn classes.join(' ');\n\t}\n\n\tif (typeof module !== 'undefined' && module.exports) {\n\t\tclassNames.default = classNames;\n\t\tmodule.exports = classNames;\n\t} else if (typeof define === 'function' && typeof define.amd === 'object' && define.amd) {\n\t\t// register as 'classnames', consistent with npm package name\n\t\tdefine('classnames', [], function () {\n\t\t\treturn classNames;\n\t\t});\n\t} else {\n\t\twindow.classNames = classNames;\n\t}\n}());\n","'use strict';\n\nmodule.exports = {\n  isString: function(arg) {\n    return typeof(arg) === 'string';\n  },\n  isObject: function(arg) {\n    return typeof(arg) === 'object' && arg !== null;\n  },\n  isNull: function(arg) {\n    return arg === null;\n  },\n  isNullOrUndefined: function(arg) {\n    return arg == null;\n  }\n};\n","'use strict';\n\nexports.decode = exports.parse = require('./decode');\nexports.encode = exports.stringify = require('./encode');\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\n// If obj.hasOwnProperty has been overridden, then calling\n// obj.hasOwnProperty(prop) will break.\n// See: https://github.com/joyent/node/issues/1707\nfunction hasOwnProperty(obj, prop) {\n  return Object.prototype.hasOwnProperty.call(obj, prop);\n}\n\nmodule.exports = function(qs, sep, eq, options) {\n  sep = sep || '&';\n  eq = eq || '=';\n  var obj = {};\n\n  if (typeof qs !== 'string' || qs.length === 0) {\n    return obj;\n  }\n\n  var regexp = /\\+/g;\n  qs = qs.split(sep);\n\n  var maxKeys = 1000;\n  if (options && typeof options.maxKeys === 'number') {\n    maxKeys = options.maxKeys;\n  }\n\n  var len = qs.length;\n  // maxKeys <= 0 means that we should not limit keys count\n  if (maxKeys > 0 && len > maxKeys) {\n    len = maxKeys;\n  }\n\n  for (var i = 0; i < len; ++i) {\n    var x = qs[i].replace(regexp, '%20'),\n        idx = x.indexOf(eq),\n        kstr, vstr, k, v;\n\n    if (idx >= 0) {\n      kstr = x.substr(0, idx);\n      vstr = x.substr(idx + 1);\n    } else {\n      kstr = x;\n      vstr = '';\n    }\n\n    k = decodeURIComponent(kstr);\n    v = decodeURIComponent(vstr);\n\n    if (!hasOwnProperty(obj, k)) {\n      obj[k] = v;\n    } else if (isArray(obj[k])) {\n      obj[k].push(v);\n    } else {\n      obj[k] = [obj[k], v];\n    }\n  }\n\n  return obj;\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n","// Copyright Joyent, Inc. and other Node contributors.\n//\n// Permission is hereby granted, free of charge, to any person obtaining a\n// copy of this software and associated documentation files (the\n// \"Software\"), to deal in the Software without restriction, including\n// without limitation the rights to use, copy, modify, merge, publish,\n// distribute, sublicense, and/or sell copies of the Software, and to permit\n// persons to whom the Software is furnished to do so, subject to the\n// following conditions:\n//\n// The above copyright notice and this permission notice shall be included\n// in all copies or substantial portions of the Software.\n//\n// THE SOFTWARE IS PROVIDED \"AS IS\", WITHOUT WARRANTY OF ANY KIND, EXPRESS\n// OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF\n// MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN\n// NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM,\n// DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR\n// OTHERWISE, ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE\n// USE OR OTHER DEALINGS IN THE SOFTWARE.\n\n'use strict';\n\nvar stringifyPrimitive = function(v) {\n  switch (typeof v) {\n    case 'string':\n      return v;\n\n    case 'boolean':\n      return v ? 'true' : 'false';\n\n    case 'number':\n      return isFinite(v) ? v : '';\n\n    default:\n      return '';\n  }\n};\n\nmodule.exports = function(obj, sep, eq, name) {\n  sep = sep || '&';\n  eq = eq || '=';\n  if (obj === null) {\n    obj = undefined;\n  }\n\n  if (typeof obj === 'object') {\n    return map(objectKeys(obj), function(k) {\n      var ks = encodeURIComponent(stringifyPrimitive(k)) + eq;\n      if (isArray(obj[k])) {\n        return map(obj[k], function(v) {\n          return ks + encodeURIComponent(stringifyPrimitive(v));\n        }).join(sep);\n      } else {\n        return ks + encodeURIComponent(stringifyPrimitive(obj[k]));\n      }\n    }).join(sep);\n\n  }\n\n  if (!name) return '';\n  return encodeURIComponent(stringifyPrimitive(name)) + eq +\n         encodeURIComponent(stringifyPrimitive(obj));\n};\n\nvar isArray = Array.isArray || function (xs) {\n  return Object.prototype.toString.call(xs) === '[object Array]';\n};\n\nfunction map (xs, f) {\n  if (xs.map) return xs.map(f);\n  var res = [];\n  for (var i = 0; i < xs.length; i++) {\n    res.push(f(xs[i], i));\n  }\n  return res;\n}\n\nvar objectKeys = Object.keys || function (obj) {\n  var res = [];\n  for (var key in obj) {\n    if (Object.prototype.hasOwnProperty.call(obj, key)) res.push(key);\n  }\n  return res;\n};\n","import { IResources } from './types'\nimport { URLResources } from './url'\n\nexport function resolveRelativeResources(\n  base: IResources,\n  url: string\n): [IResources, string] {\n  // Absolute URL\n  if (url.includes('://')) {\n    return [new URLResources(new URL(url)), url.split('/').slice(-1)[0]]\n  }\n\n  const parts = url.split('/')\n  let current = base\n  while (parts.length > 1) {\n    const dirName = parts.shift()!\n    current = new DirectoryResources(current, dirName)\n  }\n  return [current, parts[0]]\n}\n\nexport class DirectoryResources implements IResources {\n  constructor(private base: IResources, private dirName: string) {}\n\n  async file(filename: string) {\n    return this.base.file(`${this.dirName}/${filename}`)\n  }\n}\n","import invariant from 'invariant'\n\nexport function createKeysoundCache() {\n  const map = new Map()\n  let _lastSongId\n  return {\n    receiveSongId(nextSongId) {\n      if (_lastSongId !== nextSongId) {\n        _lastSongId = nextSongId\n        map.clear()\n      }\n    },\n    isEmpty() {\n      return map.size === 0\n    },\n    isCached(soundName) {\n      return map.has(soundName)\n    },\n    cache(soundName, audioBuffer) {\n      invariant(_lastSongId, 'Expected current song to be set.')\n      map.set(soundName, audioBuffer)\n    },\n    get(soundName) {\n      return map.get(soundName)\n    },\n  }\n}\n\nexport default createKeysoundCache\n","export class WaveFactory {\n  constructor(master, samples, map, { volume } = {}) {\n    this._master = master\n    this._samples = samples\n    this._map = map\n    this._exclusiveInstances = new Map()\n    this._group = this._master.group({ volume })\n  }\n\n  // Plays an autokeysound note (using limited polyphony)\n  playAuto(note, delay, slice) {\n    return this._play({ note, delay, exclusive: true, slice })\n  }\n\n  // Plays a hit note (using limited polyphony)\n  // Returns the SoundInstance which may be stopped when hold note is missed\n  playNote(note, delay, slice) {\n    return this._play({ note, delay, exclusive: true, slice })\n  }\n\n  // Plays a note when hitting in the blank area (unlimited polyphony)\n  playFree(note, delay, slice) {\n    return this._play({ note, delay: 0, exclusive: false, slice })\n  }\n\n  // Plays a note\n  _play({ note, delay, exclusive }) {\n    const keysound = note.keysound\n    if (exclusive) this._stopOldExclusiveSound(keysound, delay)\n    const filename = this._map[keysound.toLowerCase()]\n    if (!filename) return null\n    const sample = this._samples[filename]\n    if (!sample) return null\n    const instance = sample.play(delay, {\n      start: note.keysoundStart,\n      end: note.keysoundEnd,\n      group: this._group,\n    })\n    if (exclusive) this._exclusiveInstances.set(keysound, instance)\n    return instance\n  }\n\n  _stopOldExclusiveSound(keysound, delay) {\n    const instance = this._exclusiveInstances.get(keysound)\n    if (instance) {\n      setTimeout(() => instance.stop(), delay * 1000)\n      this._exclusiveInstances.delete(keysound)\n    }\n  }\n}\n\nexport default WaveFactory\n","\nvar content = require(\"!!../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./Scene.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./Scene.scss\", function() {\n\t\tvar newContent = require(\"!!../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./Scene.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".Scene {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  overflow: hidden;\\n  font-family: \\\"Source Sans Pro\\\", \\\"Segoe UI\\\", \\\"Helvetica Neue\\\", sans-serif;\\n}\\n.Scene > .SceneHeading {\\n  position: absolute;\\n  top: 20px;\\n  right: 0;\\n  left: 0;\\n}\\n@media (min-width: 720px) {\\n  .Scene > .SceneHeading {\\n    top: 2rem;\\n  }\\n}\\n.Scene > .SceneToolbar {\\n  position: absolute;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n}\", \"\"]);\n\n// exports\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Speedcore = void 0;\nvar segment_1 = require(\"./segment\");\n/**\n * Speedcore is a small internally-used library.\n * A Speedcore represents a single dimensional keyframed linear motion\n * (as in equation x = f(t)), and is useful when working\n * with BPM changes ({Timing}), note spacing factor ({Spacing}), or scrolling\n * segments ({Positioning}).\n * A Speedcore is constructed from an array of Segments.\n *\n * A {Segment} is defined as `{ t, x, dx }`, such that:\n *\n * * speedcore.x(segment.t) = segment.x\n * * speedcore.t(segment.x) = segment.t\n * * speedcore.x(segment.t + dt) = segment.x + (segment.dx / dt)\n *\n *\n * ## Explanation\n *\n * One way to think of these segments is to think about tempo changes, where:\n *\n * * `t` is the elapsed time (in seconds) since song start.\n * * `x` is the elapsed beat since song start.\n * * `dx` is the amount of `x` increase per `t`. In this case, it has the\n *   unit of beats per second.\n *\n * For example, consider a song that starts at 140 BPM.\n * 32 beats later, the tempo changes to 160 BPM.\n * 128 beats later (at beat 160), the tempo reverts to 140 BPM.\n *\n * We can derive three segments:\n *\n * 1. At time 0, we are at beat 0, and moving at 2.333 beats per second.\n * 2. At 13.714s, we are at beat 32, moving at 2.667 beats per second.\n * 3. At 61.714s, we are at beat 160, moving at 2.333 beats per second.\n *\n * This maps out to this data structure:\n *\n * ```js\n * [ [0]: { t:  0.000,  x:   0,  dx: 2.333,  inclusive: true },\n *   [1]: { t: 13.714,  x:  32,  dx: 2.667,  inclusive: true },\n *   [2]: { t: 61.714,  x: 160,  dx: 2.333,  inclusive: true } ]\n * ```\n *\n * With this data, it is possible to find out the value of `x` at any given `t`.\n *\n * For example, to answer the question, what is the beat number at 30s?\n * First, we find the segment with maximum value of `t < 30`, and we get\n * the segment `[1]`.\n *\n * We calculate `segment.x + (t - segment.t) * segment.dx`.\n * The result beat number is (32 + (30 - 13.714) * 2.667) = 75.435.\n *\n * We can also perform the reverse calculation in a similar way, by reversing\n * the equation.\n *\n * Interestingly, we can use these segments to represent the effect of\n * both BPM changes and STOP segments in the same array.\n * For example, a 150-BPM song with a 2-beat stop in the 32nd beat\n * can be represented like this:\n *\n * ```js\n * [ [0]: { t:  0.0,  x:  0,  dx: 2.5,  inclusive: true  },\n *   [1]: { t: 12.8,  x: 32,  dx: 0,    inclusive: true  },\n *   [2]: { t: 13.6,  x: 32,  dx: 2.5,  inclusive: false } ]\n * ```\n */\nvar Speedcore = /** @class */ (function () {\n    /**\n     * Constructs a new `Speedcore` from given segments.\n     */\n    function Speedcore(segments) {\n        segments.forEach(segment_1.Segment);\n        this._segments = segments;\n    }\n    Speedcore.prototype._reached = function (index, targetFn, position) {\n        if (index >= this._segments.length)\n            return false;\n        var segment = this._segments[index];\n        var target = targetFn(segment);\n        return segment.inclusive ? position >= target : position > target;\n    };\n    Speedcore.prototype._segmentAt = function (targetFn, position) {\n        for (var i = 0; i < this._segments.length; i++) {\n            if (!this._reached(i + 1, targetFn, position))\n                return this._segments[i];\n        }\n        throw new Error('Unable to find a segment matching a criteria (this should never happen)!');\n    };\n    Speedcore.prototype.segmentAtX = function (x) {\n        return this._segmentAt(X, x);\n    };\n    Speedcore.prototype.segmentAtT = function (t) {\n        return this._segmentAt(T, t);\n    };\n    /**\n     * Calculates the _t_, given _x_.\n     */\n    Speedcore.prototype.t = function (x) {\n        var segment = this.segmentAtX(x);\n        return segment.t + (x - segment.x) / (segment.dx || 1);\n    };\n    /**\n     * Calculates the _x_, given _t_.\n     * @param {number} t\n     */\n    Speedcore.prototype.x = function (t) {\n        var segment = this.segmentAtT(t);\n        return segment.x + (t - segment.t) * segment.dx;\n    };\n    /**\n     * Finds the _dx_, given _t_.\n     * @param {number} t\n     */\n    Speedcore.prototype.dx = function (t) {\n        var segment = this.segmentAtT(t);\n        return segment.dx;\n    };\n    return Speedcore;\n}());\nexports.Speedcore = Speedcore;\nvar T = function (segment) { return segment.t; };\nvar X = function (segment) { return segment.x; };\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (_) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.NotechartLoader = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar BMSNotechartLoader = __importStar(require(\"./BMSNotechartLoader\"));\nvar BmsonNotechartLoader = __importStar(require(\"./BmsonNotechartLoader\"));\nvar coerceToBuffer = function (bufferOrArrayBuffer) {\n    return Buffer.isBuffer(bufferOrArrayBuffer)\n        ? bufferOrArrayBuffer\n        : Buffer.from(new Uint8Array(bufferOrArrayBuffer));\n};\nvar NotechartLoader = /** @class */ (function () {\n    function NotechartLoader() {\n    }\n    NotechartLoader.prototype.load = function (arraybuffer, resource, options) {\n        if (resource.name.match(/\\.bmson$/i)) {\n            return this.loadBmson(arraybuffer, resource, options);\n        }\n        else {\n            return this.loadBMS(arraybuffer, resource, options);\n        }\n    };\n    NotechartLoader.prototype.loadBMS = function (arraybuffer, resource, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var buffer, readerOptions, source, compileResult, chart, notechart;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        buffer = coerceToBuffer(arraybuffer);\n                        readerOptions = BMS.Reader.getReaderOptionsFromFilename(resource.name);\n                        return [4 /*yield*/, BMS.Reader.readAsync(buffer, readerOptions)];\n                    case 1:\n                        source = _a.sent();\n                        compileResult = BMS.Compiler.compile(source);\n                        chart = compileResult.chart;\n                        notechart = BMSNotechartLoader.fromBMSChart(chart, options);\n                        return [2 /*return*/, notechart];\n                }\n            });\n        });\n    };\n    NotechartLoader.prototype.loadBmson = function (arraybuffer, resource, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var buffer, source;\n            return __generator(this, function (_a) {\n                buffer = coerceToBuffer(arraybuffer);\n                source = buffer.toString('utf-8');\n                return [2 /*return*/, BmsonNotechartLoader.load(source, options)];\n            });\n        });\n    };\n    return NotechartLoader;\n}());\nexports.NotechartLoader = NotechartLoader;\nexports.default = NotechartLoader;\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.load = void 0;\nvar bmson = __importStar(require(\"bmson\"));\nvar BMS = __importStar(require(\"bms\"));\nvar __1 = __importDefault(require(\"../\"));\nfunction load(source, playerOptions) {\n    var data = JSON.parse(source);\n    var songInfo = bmson.songInfoForBmson(data);\n    var score = bmson.musicalScoreForBmson(data, {\n        double: playerOptions.double,\n    });\n    var barLines = bmson.barLinesForBmson(data);\n    var stuff = {\n        notes: score.notes.all(),\n        timing: score.timing,\n        keysounds: score.keysounds,\n        songInfo: songInfo,\n        positioning: new BMS.Positioning([{ t: 0, x: 0, dx: 1, inclusive: true }]),\n        spacing: new BMS.Spacing([]),\n        barLines: barLines,\n        images: {\n            // HACK: Hardcoded here, probably should belong in bmson package\n            eyecatch: data.info.eyecatch_image,\n            background: data.info.back_image,\n        },\n        expertJudgmentWindow: getExpertJudgmentWindowForBmson(data),\n    };\n    return new __1.default(stuff, playerOptions);\n}\nexports.load = load;\nfunction getExpertJudgmentWindowForBmson(data) {\n    var judgeRank = (function () {\n        if (!data.info)\n            return 100;\n        if (!data.info.judge_rank)\n            return 100;\n        return +data.info.judge_rank || 100;\n    })() / 100;\n    return [18 * judgeRank, 40 * judgeRank];\n}\n//# sourceMappingURL=BmsonNotechartLoader.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __read = (this && this.__read) || function (o, n) {\n    var m = typeof Symbol === \"function\" && o[Symbol.iterator];\n    if (!m) return o;\n    var i = m.call(o), r, ar = [], e;\n    try {\n        while ((n === void 0 || n-- > 0) && !(r = i.next()).done) ar.push(r.value);\n    }\n    catch (error) { e = { error: error }; }\n    finally {\n        try {\n            if (r && !r.done && (m = i[\"return\"])) m.call(i);\n        }\n        finally { if (e) throw e.error; }\n    }\n    return ar;\n};\nvar __spreadArray = (this && this.__spreadArray) || function (to, from, pack) {\n    if (pack || arguments.length === 2) for (var i = 0, l = from.length, ar; i < l; i++) {\n        if (ar || !(i in from)) {\n            if (!ar) ar = Array.prototype.slice.call(from, 0, i);\n            ar[i] = from[i];\n        }\n    }\n    return to.concat(ar || Array.prototype.slice.call(from));\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.keysForBmson = exports.hasScratch = exports.beatForPulseForBmson = exports._slicesForNotesAndTiming = exports.musicalScoreForBmson = exports.timingInfoForBmson = exports.barLinesForBmson = exports.songInfoForBmson = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar BMS = __importStar(require(\"bms\"));\nvar legacy = __importStar(require(\"./legacy\"));\nvar utils = __importStar(require(\"./utils\"));\n__exportStar(require(\"./types\"), exports);\n/**\n * Returns a BMS.SongInfo corresponding to this BMS file.\n */\nfunction songInfoForBmson(bmson) {\n    var bmsonInfo = bmson.info;\n    var info = {};\n    if (bmsonInfo.title)\n        info.title = bmsonInfo.title;\n    if (bmsonInfo.artist)\n        info.artist = bmsonInfo.artist;\n    if (bmsonInfo.genre)\n        info.genre = bmsonInfo.genre;\n    if (bmsonInfo.level)\n        info.level = bmsonInfo.level;\n    info.subtitles = getSubtitles();\n    if (bmsonInfo.subartists)\n        info.subartists = bmsonInfo.subartists;\n    return new BMS.SongInfo(info);\n    function getSubtitles() {\n        if (!bmson.version)\n            return ['Warning: legacy bmson'];\n        var subtitles = [];\n        if (bmsonInfo.chart_name && typeof bmsonInfo.chart_name === 'string') {\n            subtitles.push(bmsonInfo.chart_name);\n        }\n        if (bmsonInfo.subtitle && typeof bmsonInfo.subtitle === 'string') {\n            subtitles.push.apply(subtitles, __spreadArray([], __read(bmsonInfo.subtitle.split('\\n')), false));\n        }\n        return subtitles;\n    }\n}\nexports.songInfoForBmson = songInfoForBmson;\n/**\n * Returns the barlines as an array of beats.\n */\nfunction barLinesForBmson(bmson) {\n    if (!bmson.version)\n        return legacy.barLinesForBmson(bmson);\n    var beatForPulse = beatForPulseForBmson(bmson);\n    var lines = bmson.lines;\n    return (0, lodash_1.default)(lines)\n        .map(function (_a) {\n        var y = _a.y;\n        return beatForPulse(y);\n    })\n        .sortBy()\n        .value();\n}\nexports.barLinesForBmson = barLinesForBmson;\n/**\n * Returns the information to be passed to BMS.Timing constructor\n * in order to generate the timing data represented by the `bmson` object.\n * @param {Bmson} bmson\n */\nfunction timingInfoForBmson(bmson) {\n    if (!bmson.version)\n        return legacy.timingInfoForBmson(bmson);\n    var beatForPulse = beatForPulseForBmson(bmson);\n    return {\n        initialBPM: bmson.info.init_bpm,\n        actions: __spreadArray(__spreadArray([], __read((bmson.bpm_events || []).map(function (_a) {\n            var y = _a.y, bpm = _a.bpm;\n            return ({\n                type: 'bpm',\n                beat: beatForPulse(y),\n                bpm: bpm,\n            });\n        })), false), __read((bmson.stop_events || []).map(function (_a) {\n            var y = _a.y, duration = _a.duration;\n            return ({\n                type: 'stop',\n                beat: beatForPulse(y),\n                stopBeats: beatForPulse(Math.floor(duration)),\n            });\n        })), false),\n    };\n}\nexports.timingInfoForBmson = timingInfoForBmson;\n/**\n * Returns the timing data represented by the `bmson` object.\n * @param {Bmson} bmson\n */\nfunction timingForBmson(bmson) {\n    var _a = timingInfoForBmson(bmson), initialBPM = _a.initialBPM, actions = _a.actions;\n    return new BMS.Timing(initialBPM, actions);\n}\n/**\n * Returns the musical score (comprised of BMS.Notes and BMS.Keysounds).\n * @param {Bmson} bmson\n */\nfunction musicalScoreForBmson(bmson, options) {\n    if (options === void 0) { options = {}; }\n    var timing = timingForBmson(bmson);\n    var _a = notesDataAndKeysoundsDataForBmsonAndTiming(bmson, timing, options), notes = _a.notes, keysounds = _a.keysounds;\n    return {\n        /**\n         * The {BMS.Timing} object for this musical score.\n         */\n        timing: timing,\n        /**\n         * A {BMS.Notes} representing notes inside the bmson notechart.\n         */\n        notes: new BMS.Notes(notes),\n        /**\n         * A {BMS.Keysounds} representing mapping between keysound in the\n         * `notes` field to the actual keysound file name.\n         */\n        keysounds: new BMS.Keysounds(keysounds),\n    };\n}\nexports.musicalScoreForBmson = musicalScoreForBmson;\nfunction soundChannelsForBmson(bmson) {\n    return bmson.version\n        ? bmson.sound_channels\n        : bmson.soundChannel;\n}\nfunction notesDataAndKeysoundsDataForBmsonAndTiming(bmson, timing, options) {\n    var e_1, _a, e_2, _b;\n    var nextKeysoundNumber = 1;\n    var beatForPulse = beatForPulseForBmson(bmson);\n    var notes = [];\n    var keysounds = {};\n    var soundChannels = soundChannelsForBmson(bmson);\n    if (soundChannels) {\n        try {\n            for (var soundChannels_1 = __values(soundChannels), soundChannels_1_1 = soundChannels_1.next(); !soundChannels_1_1.done; soundChannels_1_1 = soundChannels_1.next()) {\n                var _c = soundChannels_1_1.value, name_1 = _c.name, soundChannelNotes = _c.notes;\n                var sortedNotes = lodash_1.default.sortBy(soundChannelNotes, 'y');\n                var keysoundNumber = nextKeysoundNumber++;\n                var keysoundId = lodash_1.default.padStart('' + keysoundNumber, 4, '0');\n                var slices = utils.slicesForNotesAndTiming(soundChannelNotes, timing, {\n                    beatForPulse: beatForPulse,\n                });\n                keysounds[keysoundId] = name_1;\n                try {\n                    for (var sortedNotes_1 = (e_2 = void 0, __values(sortedNotes)), sortedNotes_1_1 = sortedNotes_1.next(); !sortedNotes_1_1.done; sortedNotes_1_1 = sortedNotes_1.next()) {\n                        var _d = sortedNotes_1_1.value, x = _d.x, y = _d.y, l = _d.l;\n                        var note = {\n                            column: getColumn(x, options),\n                            beat: beatForPulse(y),\n                            keysound: keysoundId,\n                            endBeat: undefined,\n                        };\n                        if (l > 0) {\n                            note.endBeat = beatForPulse(y + l);\n                        }\n                        var slice = slices.get(y);\n                        if (slice) {\n                            Object.assign(note, slice);\n                            notes.push(note);\n                        }\n                    }\n                }\n                catch (e_2_1) { e_2 = { error: e_2_1 }; }\n                finally {\n                    try {\n                        if (sortedNotes_1_1 && !sortedNotes_1_1.done && (_b = sortedNotes_1.return)) _b.call(sortedNotes_1);\n                    }\n                    finally { if (e_2) throw e_2.error; }\n                }\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (soundChannels_1_1 && !soundChannels_1_1.done && (_a = soundChannels_1.return)) _a.call(soundChannels_1);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n    }\n    return { notes: notes, keysounds: keysounds };\n}\nvar legacy_1 = require(\"./legacy\");\nObject.defineProperty(exports, \"_slicesForNotesAndTiming\", { enumerable: true, get: function () { return legacy_1._slicesForNotesAndTiming; } });\nfunction beatForPulseForBmson(bmson) {\n    if (!bmson.version)\n        return legacy.beatForLoc;\n    var resolution = (bmson.info && bmson.info.resolution) || 240;\n    return function (y) { return y / resolution; };\n}\nexports.beatForPulseForBmson = beatForPulseForBmson;\nfunction getColumn(x, options) {\n    switch (x) {\n        case 1:\n            return '1';\n        case 2:\n            return '2';\n        case 3:\n            return '3';\n        case 4:\n            return '4';\n        case 5:\n            return '5';\n        case 6:\n            return '6';\n        case 7:\n            return '7';\n        case 8:\n            return 'SC';\n    }\n    if (options.double) {\n        switch (x) {\n            case 9:\n                return '8';\n            case 10:\n                return '9';\n            case 11:\n                return '10';\n            case 12:\n                return '11';\n            case 13:\n                return '12';\n            case 14:\n                return '13';\n            case 15:\n                return '14';\n            case 16:\n                return 'SC2';\n        }\n    }\n    return undefined;\n}\n/**\n * Checks if there is a scratch in a bmson file\n */\nfunction hasScratch(bmson) {\n    var e_3, _a, e_4, _b;\n    var soundChannels = soundChannelsForBmson(bmson);\n    if (soundChannels) {\n        try {\n            for (var soundChannels_2 = __values(soundChannels), soundChannels_2_1 = soundChannels_2.next(); !soundChannels_2_1.done; soundChannels_2_1 = soundChannels_2.next()) {\n                var notes = soundChannels_2_1.value.notes;\n                try {\n                    for (var notes_1 = (e_4 = void 0, __values(notes)), notes_1_1 = notes_1.next(); !notes_1_1.done; notes_1_1 = notes_1.next()) {\n                        var x = notes_1_1.value.x;\n                        if (x === 8 || x === 18)\n                            return true;\n                    }\n                }\n                catch (e_4_1) { e_4 = { error: e_4_1 }; }\n                finally {\n                    try {\n                        if (notes_1_1 && !notes_1_1.done && (_b = notes_1.return)) _b.call(notes_1);\n                    }\n                    finally { if (e_4) throw e_4.error; }\n                }\n            }\n        }\n        catch (e_3_1) { e_3 = { error: e_3_1 }; }\n        finally {\n            try {\n                if (soundChannels_2_1 && !soundChannels_2_1.done && (_a = soundChannels_2.return)) _a.call(soundChannels_2);\n            }\n            finally { if (e_3) throw e_3.error; }\n        }\n    }\n    return false;\n}\nexports.hasScratch = hasScratch;\n/**\n * Checks the key mode for a bmson file\n */\nfunction keysForBmson(bmson) {\n    var e_5, _a, e_6, _b;\n    var soundChannels = soundChannelsForBmson(bmson);\n    var hasKeys = false;\n    var hasSecondPlayer = false;\n    var hasDeluxeKeys = false;\n    if (soundChannels) {\n        try {\n            for (var soundChannels_3 = __values(soundChannels), soundChannels_3_1 = soundChannels_3.next(); !soundChannels_3_1.done; soundChannels_3_1 = soundChannels_3.next()) {\n                var notes = soundChannels_3_1.value.notes;\n                try {\n                    for (var notes_2 = (e_6 = void 0, __values(notes)), notes_2_1 = notes_2.next(); !notes_2_1.done; notes_2_1 = notes_2.next()) {\n                        var x = notes_2_1.value.x;\n                        hasKeys = true;\n                        if (x >= 11 && x <= 20)\n                            hasSecondPlayer = true;\n                        if (x === 6 || x === 7 || x === 16 || x === 17)\n                            hasDeluxeKeys = true;\n                    }\n                }\n                catch (e_6_1) { e_6 = { error: e_6_1 }; }\n                finally {\n                    try {\n                        if (notes_2_1 && !notes_2_1.done && (_b = notes_2.return)) _b.call(notes_2);\n                    }\n                    finally { if (e_6) throw e_6.error; }\n                }\n            }\n        }\n        catch (e_5_1) { e_5 = { error: e_5_1 }; }\n        finally {\n            try {\n                if (soundChannels_3_1 && !soundChannels_3_1.done && (_a = soundChannels_3.return)) _a.call(soundChannels_3);\n            }\n            finally { if (e_5) throw e_5.error; }\n        }\n    }\n    if (!hasKeys)\n        return 'empty';\n    if (hasSecondPlayer) {\n        return hasDeluxeKeys ? '14K' : '10K';\n    }\n    else {\n        return hasDeluxeKeys ? '7K' : '5K';\n    }\n}\nexports.keysForBmson = keysForBmson;\n//# sourceMappingURL=index.js.map","\"use strict\";\n/* eslint camelcase: off */\n/* REASON: These snake case names are specified in bmsons spec. */\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","import Player, { PlayerOptionsInput } from './player'\nimport Notechart from 'bemuse-notechart'\n\nexport type GamePlayerOptionsInput = {\n  players: Omit<PlayerOptionsInput, 'autosound' | 'tutorial'>[]\n  audioInputLatency: number\n  tutorial: boolean\n  soundVolume: number\n}\n\n/**\n * The Game model holds the game's options and the player objects.\n * This class represents all the data needed to start a game.\n * However, it is immutable.  See `GameState` for mutable stuff.\n */\nexport class Game {\n  /** The Game's players */\n  public players: Player[]\n\n  constructor(\n    notecharts: Notechart[],\n    public readonly options: GamePlayerOptionsInput\n  ) {\n    this.players = options.players.map(function (playerOptions, index) {\n      playerOptions = Object.assign({}, playerOptions, {\n        autosound: options.audioInputLatency >= 0.01,\n        tutorial: options.tutorial,\n      })\n      return new Player(notecharts[index], index + 1, playerOptions)\n    })\n  }\n\n  /** A list of all sound samples used in game. Used for loading sounds. */\n  get samples() {\n    const set = new Set()\n    for (const player of this.players) {\n      for (const sample of player.notechart.samples) {\n        set.add(sample)\n      }\n    }\n    return Array.from(set)\n  }\n}\n\nexport default Game\n","import _ from 'lodash'\n\nimport WaveFactory from './wave-factory'\nimport { isBad } from '../judgments'\n\nfunction autoplayer(array) {\n  array = _.sortBy(array, 'time')\n  let i = 0\n  return {\n    next(time) {\n      const out = []\n      for (; i < array.length && time >= array[i].time; i++) {\n        out.push(array[i])\n      }\n      return out\n    },\n  }\n}\n\nexport class PlayerAudio {\n  constructor({ player, samples, master, waveFactory, volume }) {\n    const notechart = player.notechart\n    this._waveFactory =\n      waveFactory ||\n      new WaveFactory(master, samples, notechart.keysounds, { volume })\n    this._autos = autoplayer(notechart.autos)\n    this._notes = autoplayer(notechart.notes)\n    this._played = new Map()\n    this._autosound = !!player.options.autosound\n  }\n\n  update(time, state) {\n    this._playAutokeysounds(time)\n    this._playAutosounds(time, state)\n    this._handleSoundNotifications((state && state.notifications.sounds) || [])\n  }\n\n  _playAutokeysounds(time) {\n    for (const auto of this._autos.next(time + 1 / 30)) {\n      this._waveFactory.playAuto(auto, auto.time - time)\n    }\n  }\n\n  _playAutosounds(time, state) {\n    const autosounds = this._notes.next(time + 1 / 30)\n    const poor = state && state.stats.poor\n    const shouldPlay = this._autosound && !poor\n    if (!shouldPlay) return\n    for (const note of autosounds) {\n      this._hitNote(note, note.time - time)\n    }\n  }\n\n  _handleSoundNotifications(soundNotifications) {\n    for (const notification of soundNotifications) {\n      const { type, note } = notification\n      if (type === 'hit') {\n        this._hitNote(note, 0, notification.judgment)\n      } else if (type === 'break') {\n        this._breakNote(note)\n      } else if (type === 'free') {\n        this._waveFactory.playFree(note, 0)\n      }\n    }\n  }\n\n  _hitNote(note, delay, judgment) {\n    let instance = this._played.get(note)\n    if (!instance) {\n      instance = this._waveFactory.playNote(note, delay)\n      this._played.set(note, instance)\n    }\n    if (instance) {\n      if (isBad(judgment)) {\n        instance.bad()\n      }\n    }\n  }\n\n  _breakNote(note) {\n    const instance = this._played.get(note)\n    if (instance) {\n      instance.stop()\n    }\n  }\n}\n\nexport default PlayerAudio\n","import PlayerState from './player-state'\nimport Game from '../game'\nimport Player from '../player'\nimport GameInput from '../input'\nimport GameTimer from '../game-timer'\nimport invariant from 'invariant'\n\nexport class GameState {\n  /** See Timer#readyFraction. We need it here so that the display can read this information. */\n  public readyFraction = 0\n  /** True if the the player is getting started (i.e. holding down the start button for the first time), false otherwise. */\n  public gettingStarted = false\n  /** True if the game is started, false otherwise. */\n  public started = false\n  /** True if the game is finished, false otherwise. */\n  public finished = false\n\n  private _players: Map<Player, PlayerState>\n\n  constructor(public readonly game: Game) {\n    this._players = new Map(\n      game.players.map((player) => [player, new PlayerState(player)])\n    )\n  }\n\n  update(gameTime: number, input: GameInput, timer: GameTimer) {\n    let finished = true\n    for (const [player, playerState] of this._players) {\n      playerState.update(gameTime, input)\n      if (!playerState.finished) finished = false\n      void player\n    }\n    this.readyFraction = timer.readyFraction\n    this.gettingStarted = timer.gettingStarted\n    this.started = timer.started\n    this.finished = finished\n  }\n\n  player(p: Player) {\n    const playerState = this._players.get(p)\n    return (\n      playerState ||\n      invariant(\n        false,\n        'Invariant violation: No player state found for player %s',\n        p.number\n      )\n    )\n  }\n}\n\nexport default GameState\n","import * as touch3d from '../display/touch3d'\n\nimport bench from 'bemuse/devtools/benchmark'\n\nconst BUTTONS = [\n  'p1_1',\n  'p1_2',\n  'p1_3',\n  'p1_4',\n  'p1_5',\n  'p1_6',\n  'p1_7',\n  'start',\n]\n\nwindow.BEMUSE_TOUCH_STATS = []\n\nfunction StatsRecorder() {\n  const stats = []\n  window.BEMUSE_TOUCH_STATS.push(stats)\n  return {\n    record(input) {\n      for (const { x, y } of input) {\n        stats.push({ x: Math.round(x), y: Math.round(y) })\n      }\n    },\n    done() {\n      if (stats.length) {\n        localStorage['_stats_touch'] = JSON.stringify(window.BEMUSE_TOUCH_STATS)\n      }\n    },\n  }\n}\n\nexport function TouchPlugin(context) {\n  let scratchStartY = null\n  let scratchY = null\n  const getInput = bench.wrap('input:touch:I', _getInput)\n  const getScratch = bench.wrap('input:touch:SC', _getScratch)\n  const getButton = bench.wrap('input:touch:B', _getButton)\n  const getPinch = bench.wrap('input:touch:P', _getPinch)\n  const statsRecorder = new StatsRecorder()\n  const touch3dMode = context.skinData.displayMode === 'touch3d'\n  const pinchThreshold = touch3dMode ? touch3d.getRow(0.8).y : 550\n  return {\n    name: 'TouchPlugin',\n    get() {\n      const input = getInput()\n      const output = {}\n      if (bench.enabled) bench.stats['input:touch:n'] = '' + input.length\n      statsRecorder.record(input)\n      output['p1_SC'] = getScratch(input)\n      for (const button of BUTTONS) {\n        output[button] = getButton(input, button)\n      }\n      if (touch3dMode) {\n        for (const p of input) {\n          const lane = touch3d.getTouchedColumn(p.x, p.y)\n          if (lane) output['p1_' + lane] = 1\n        }\n      }\n      output['p1_pinch'] = getPinch(input)\n      return output\n    },\n    destroy() {\n      statsRecorder.done()\n    },\n  }\n  function _expand(rectangle, amount = 4) {\n    const newRect = rectangle.clone()\n    newRect.x -= amount\n    newRect.y -= amount\n    newRect.width += amount * 2\n    newRect.height += amount * 2\n    return newRect\n  }\n  function _getInput() {\n    return context.input\n  }\n  function _getButton(input, button) {\n    const objects = context.refs[button]\n    if (objects) {\n      for (const object of objects) {\n        const bounds = _expand(object.getBounds())\n        for (const p of input) {\n          if (bounds.contains(p.x, p.y)) return 1\n        }\n      }\n    }\n    return 0\n  }\n  function _getScratch(input) {\n    const objects = context.refs['p1_SC']\n    if (!objects) return 0\n    scratchY = null\n    for (const p of input) {\n      for (const object of objects) {\n        if (_expand(object.getBounds(), 32).contains(p.x, p.y)) {\n          scratchY = p.y\n          break\n        }\n      }\n      if (scratchY !== null) {\n        break\n      }\n    }\n    if (scratchY === null) {\n      scratchStartY = null\n      return 0\n    }\n    if (scratchStartY === null) {\n      scratchStartY = scratchY\n    }\n    if (scratchY > scratchStartY + 24) {\n      scratchStartY = scratchY - 24\n    } else if (scratchY < scratchStartY - 24) {\n      scratchStartY = scratchY + 24\n    }\n    return scratchY > scratchStartY + 4\n      ? -1\n      : scratchY < scratchStartY - 4\n      ? 1\n      : 0\n  }\n  function _getPinch(input) {\n    let a = null\n    let b = null\n    for (const p of input) {\n      if (p.y < pinchThreshold) {\n        if (a === null) {\n          a = p.y\n        } else if (b === null) {\n          b = p.y\n        } else {\n          return 0\n        }\n      }\n    }\n    if (a !== null && b !== null) {\n      return Math.abs(a - b)\n    } else {\n      return 0\n    }\n  }\n}\n\nexport default TouchPlugin\n","import './game-display.scss'\n\nimport $ from 'jquery'\n\nimport PlayerDisplay from './player-display'\nimport formatTime from '../../utils/formatTime'\nimport { shouldDisableFullScreen } from 'bemuse/devtools/query-flags'\nimport screenfull from 'screenfull'\n\nexport class GameDisplay {\n  constructor({ game, context, backgroundImagePromise, video }) {\n    this._game = game\n    this._context = context\n    const skinData = context.skinData\n    this._players = new Map(\n      game.players.map((player) => [\n        player,\n        new PlayerDisplay(player, skinData),\n      ])\n    )\n    this._stateful = {}\n    this._wrapper = this._createWrapper({\n      backgroundImagePromise,\n      video,\n      panelPlacement: game.players[0].options.placement,\n      infoPanelPosition: skinData.infoPanelPosition,\n    })\n    this._createTouchEscapeButton()\n    this._createFullScreenButton()\n    this._escapeHintShown = false\n  }\n\n  setEscapeHandler(escapeHandler) {\n    this._onEscape = escapeHandler\n  }\n\n  setReplayHandler(replayHandler) {\n    this._onReplay = replayHandler\n  }\n\n  start() {\n    this._started = new Date().getTime()\n    const player = this._game.players[0]\n    const songInfo = player.notechart.songInfo\n    const prefix = player.options.autoplayEnabled ? '[AUTOPLAY] ' : ''\n    this._stateful['song_title'] = prefix + songInfo.title\n    this._stateful['song_artist'] = songInfo.artist\n    this._duration = player.notechart.duration\n  }\n\n  destroy() {\n    this._context.destroy()\n  }\n\n  update(gameTime, gameState) {\n    const time = (new Date().getTime() - this._started) / 1000\n    const data = this._getData(time, gameTime, gameState)\n    this._updateStatefulData(time, gameTime, gameState)\n    this._context.render(Object.assign({}, this._stateful, data))\n    this._synchronizeVideo(gameTime)\n    this._synchronizeTutorialEscapeHint(gameTime)\n  }\n\n  _synchronizeVideo(gameTime) {\n    if (this._video && !this._videoStarted && gameTime >= this._videoOffset) {\n      this._video.volume = 0\n      this._video.play()\n      this._video.classList.add('is-playing')\n      this._videoStarted = true\n    }\n  }\n\n  _synchronizeTutorialEscapeHint(gameTime) {\n    if (this._game.options.tutorial) {\n      const TUTORIAL_ESCAPE_HINT_SHOW_TIME = 101.123595506\n      if (\n        gameTime >= TUTORIAL_ESCAPE_HINT_SHOW_TIME &&\n        !this._escapeHintShown\n      ) {\n        this._escapeHintShown = true\n        this._escapeHint.classList.add('is-shown')\n      }\n    }\n  }\n\n  _getData(time, gameTime, gameState) {\n    const data = {}\n    data['tutorial'] = this._game.options.tutorial ? 'yes' : 'no'\n    data['t'] = time\n    data['gameTime'] = gameTime\n    data['ready'] = this._getReady(gameState)\n    data['song_time'] = this._getSongTime(gameTime)\n    for (const [player, playerDisplay] of this._players) {\n      const playerState = gameState.player(player)\n      const playerData = playerDisplay.update(time, gameTime, playerState)\n      for (const key in playerData) {\n        data[`p${player.number}_${key}`] = playerData[key]\n      }\n    }\n    return data\n  }\n\n  _updateStatefulData(time, gameTime, gameState) {\n    const data = this._stateful\n    if (data['started'] === undefined && gameState.started) {\n      data['started'] = time\n    }\n    if (data['gettingStarted'] === undefined && gameState.gettingStarted) {\n      data['gettingStarted'] = time\n    }\n  }\n\n  _getSongTime(gameTime) {\n    return (\n      formatTime(Math.min(this._duration, Math.max(0, gameTime))) +\n      ' / ' +\n      formatTime(this._duration)\n    )\n  }\n\n  _getReady(gameState) {\n    const f = gameState.readyFraction\n    return f > 0.5 ? Math.pow(1 - (f - 0.5) / 0.5, 2) : 0\n  }\n\n  _createWrapper({\n    backgroundImagePromise,\n    video,\n    panelPlacement,\n    infoPanelPosition,\n  }) {\n    const $wrapper = $('<div class=\"game-display\"></div>')\n      .attr('data-panel-placement', panelPlacement)\n      .attr('data-info-panel-position', infoPanelPosition)\n      .append('<div class=\"game-display--bg js-back-image\"></div>')\n      .append(this.view)\n    if (backgroundImagePromise) {\n      Promise.resolve(backgroundImagePromise).then((image) =>\n        $wrapper.find('.js-back-image').append(image)\n      )\n    }\n    if (video) {\n      this._video = video.element\n      this._videoOffset = video.offset\n      $(video.element).addClass('game-display--video-bg').appendTo($wrapper)\n    }\n    return $wrapper[0]\n  }\n\n  _createTouchEscapeButton() {\n    const touchButtons = document.createElement('div')\n    touchButtons.className = 'game-display--touch-buttons is-left'\n    this.wrapper.appendChild(touchButtons)\n    touchButtons.classList.add('is-visible')\n    const addTouchButton = (className, onClick) => {\n      const button = createTouchButton(onClick, className)\n      touchButtons.appendChild(button)\n    }\n    addTouchButton('game-display--touch-escape-button', () => this._onEscape())\n    addTouchButton('game-display--touch-replay-button', () => this._onReplay())\n\n    const escapeHint = document.createElement('div')\n    escapeHint.textContent = 'Click or press Esc to exit the tutorial'\n    escapeHint.className = 'game-display--escape-hint'\n    this._escapeHint = escapeHint\n    touchButtons.appendChild(escapeHint)\n  }\n\n  _createFullScreenButton() {\n    if (shouldDisableFullScreen() || !screenfull.enabled) {\n      return\n    }\n    const touchButtons = document.createElement('div')\n    touchButtons.className = 'game-display--touch-buttons is-visible is-right'\n    this.wrapper.appendChild(touchButtons)\n    const onClick = () => {\n      screenfull.request()\n    }\n    const button = createTouchButton(\n      onClick,\n      'game-display--touch-fullscreen-button'\n    )\n    touchButtons.appendChild(button)\n  }\n\n  get context() {\n    return this._context\n  }\n\n  get view() {\n    return this._context.view\n  }\n\n  get wrapper() {\n    return this._wrapper\n  }\n}\n\nfunction createTouchButton(onClick, className) {\n  const button = document.createElement('button')\n  button.addEventListener(\n    'touchstart',\n    (e) => {\n      e.stopPropagation()\n    },\n    true\n  )\n  button.onclick = (e) => {\n    e.preventDefault()\n    onClick()\n  }\n  button.className = className\n  return button\n}\n\nexport default GameDisplay\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./game-display.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./game-display.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./game-display.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","var escape = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".game-display {\\n  display: block;\\n  margin: 0 auto;\\n  overflow: hidden;\\n  position: relative;\\n}\\n.game-display--bg {\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  top: 0;\\n  left: 0;\\n  z-index: 10;\\n  background: url(\" + escape(require(\"./background/default.jpg\")) + \") center no-repeat;\\n  background-size: cover;\\n  -webkit-animation: 1.5s game-display--bg-default;\\n          animation: 1.5s game-display--bg-default;\\n  -webkit-animation-fill-mode: both;\\n          animation-fill-mode: both;\\n}\\n.game-display[data-info-panel-position=top] .game-display--bg {\\n  -webkit-animation-name: game-display--bg-down;\\n          animation-name: game-display--bg-down;\\n}\\n.game-display--video-bg {\\n  width: 100%;\\n  height: 100%;\\n  position: absolute;\\n  top: -48px;\\n  left: 0px;\\n  z-index: 11;\\n  opacity: 0;\\n  transition: 0.5s opacity;\\n  will-change: opacity;\\n}\\n.game-display--video-bg.is-playing {\\n  opacity: 1;\\n}\\n.game-display[data-panel-placement=left] .game-display--video-bg {\\n  -webkit-transform: translateX(13.671875%) scale(0.87);\\n          transform: translateX(13.671875%) scale(0.87);\\n}\\n.game-display[data-panel-placement=right] .game-display--video-bg {\\n  -webkit-transform: translateX(13.671875%) scale(0.87);\\n          transform: translateX(13.671875%) scale(0.87);\\n}\\n.game-display--bg img {\\n  width: 100%;\\n  height: 100%;\\n  display: block;\\n  object-fit: cover;\\n  -webkit-animation: 1.2s game-display--bg-default;\\n          animation: 1.2s game-display--bg-default;\\n  -webkit-animation-fill-mode: both;\\n          animation-fill-mode: both;\\n}\\n.game-display[data-info-panel-position=top] .game-display--bg img {\\n  -webkit-animation-name: game-display--bg-down;\\n          animation-name: game-display--bg-down;\\n}\\n.game-display > canvas {\\n  position: relative;\\n  z-index: 100;\\n}\\n.game-display--touch-buttons {\\n  position: fixed;\\n  -webkit-transform: translateZ(0);\\n          transform: translateZ(0);\\n  top: 0;\\n  opacity: 0;\\n  z-index: 110;\\n}\\n.game-display--touch-buttons.is-visible {\\n  opacity: 1;\\n}\\n.game-display--touch-buttons.is-left {\\n  left: 0;\\n}\\n.game-display--touch-buttons.is-right {\\n  right: 0;\\n}\\n.game-display--touch-escape-button, .game-display--touch-replay-button, .game-display--touch-fullscreen-button {\\n  position: absolute;\\n  top: 12px;\\n  margin: 0;\\n  padding: 0;\\n  border: 0;\\n  width: 32px;\\n  height: 32px;\\n  background: transparent center center no-repeat;\\n  background-size: 32px 32px;\\n  cursor: pointer;\\n}\\n.game-display--touch-escape-button {\\n  background-image: url(\" + escape(require(\"./touch-escape.png\")) + \");\\n  left: 12px;\\n}\\n.game-display--touch-replay-button {\\n  background-image: url(\" + escape(require(\"./touch-replay.png\")) + \");\\n  left: 56px;\\n}\\n.game-display--touch-fullscreen-button {\\n  background-image: url(\" + escape(require(\"./touch-fullscreen.png\")) + \");\\n  right: 12px;\\n}\\n:root:-webkit-full-screen .game-display--touch-fullscreen-button {\\n  display: none;\\n}\\n:root:fullscreen .game-display--touch-fullscreen-button {\\n  display: none;\\n}\\n.game-display--escape-hint {\\n  position: absolute;\\n  left: 12px;\\n  top: 56px;\\n  display: none;\\n  background: #b61a44;\\n  padding: 8px 12px;\\n  color: white;\\n  white-space: nowrap;\\n  border-radius: 8px;\\n  font-weight: bold;\\n  font-size: 1rem;\\n  pointer-events: none;\\n}\\n.game-display--escape-hint.is-shown {\\n  display: block;\\n}\\n.game-display--escape-hint::after {\\n  content: \\\"\\\";\\n  display: block;\\n  position: absolute;\\n  width: 0;\\n  height: 0;\\n  top: -8px;\\n  left: 16px;\\n  margin-left: -8px;\\n  border-width: 0 8px 8px 8px;\\n  border-style: solid;\\n  border-color: transparent;\\n  border-bottom-color: #b61a44;\\n}\\n\\n@-webkit-keyframes game-display--bg-default {\\n  from {\\n    -webkit-transform: translate(0, 0);\\n            transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    -webkit-transform: translate(0, -35px);\\n            transform: translate(0, -35px);\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes game-display--bg-default {\\n  from {\\n    -webkit-transform: translate(0, 0);\\n            transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    -webkit-transform: translate(0, -35px);\\n            transform: translate(0, -35px);\\n    opacity: 1;\\n  }\\n}\\n@-webkit-keyframes game-display--bg-down {\\n  from {\\n    -webkit-transform: translate(0, 0);\\n            transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    -webkit-transform: translate(0, 35px);\\n            transform: translate(0, 35px);\\n    opacity: 1;\\n  }\\n}\\n@keyframes game-display--bg-down {\\n  from {\\n    -webkit-transform: translate(0, 0);\\n            transform: translate(0, 0);\\n    opacity: 0;\\n  }\\n  to {\\n    -webkit-transform: translate(0, 35px);\\n            transform: translate(0, 35px);\\n    opacity: 1;\\n  }\\n}\", \"\"]);\n\n// exports\n","module.exports = __webpack_public_path__ + \"build/ea410328703171d8f693d3a404a11a8f.jpg\";","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAACxUlEQVR4AdSYgWfrUBTG2xWNhLbQUbQAlUA7oEzKUNSGwqbA84INBs3oJPvj+75wUMe5Sd+yfM3KD+L2nvPdnNz7ndtp+nc6nQIQghjsQALeQQoyIZVniYyJ5T9BI0kRRE/ABryCr5q8ylyTtovugxV4k8Sb4E1i9Nsk3ANr8CFJMviQmN41hXfBAqQVyeYgkTK+AzMwAj7oCb48m8mYjfwnr5j7IDl02eKH4E9JYhl4lo3Mq1ldocyVueJJLkOW+Ck4OBL5BA/AbyCuL3N/llTDtGnxS5A5yvwJDAgvYCCxckflLZsIegM2jpXfg/EV9qCxxP7SSK43Pyn+xRHovgWn0L0jt5cfWQTHmz+CeYuO4jk4WpVQ+5s3Jn0Hty00YreSm853WWe3zwzxQYvdaKAXQTRMv3POH3TZ22++lZVwNI7I4eUOzzY581/UjM0dZql7yZ8X5m5fvmBbEBEFRhKz+5+nw6LSehrefl8h/vHMDEUk8bnEfKxYhL3xKXhlk68NhzcuGb81xkcM8WdsK8ySHr8u6+d1S/t0SUKERfh2rEKD0Ur3rYEro7EZNJIYQbzqHXQDtbIG6pucB0KClLkLLfpmSQ+YGObBJyRKmbPQYpi6SZnffyYkTF3QQpOzTzBub0PCW2NXU6hvm8/9sw7kUb5bgnjlcfS8gbUyf2k7N0G8mj/RlV48jK1vg7cIBPHuvS4uHu7UwzuWgWEbqkKbirGzymLGdHFkNzlTcZKOcYEwIvr4nCVechjpC56O0f35zGaG3Ez5Kl7aMRxSj9HOssVL7J52vP/at28CgIEYiqF4AssQzH/Jmt4z/QfhqptkAzwBn6AwmJ4ISYWH1bUIKobiy2ENES0xTVFtcYMRozHD0Vms7IDxOEACIgOSgskBJaGyYGm4PGGCMkOaeq/N9QVtrh5oc/W7NkecpM6Sp+P1+REepk4aEr9vwAAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAEEklEQVR4AdSaBY/zPAzHBw8cMzMzCo+ZmZmZmfvh7/1P8kt+kq65dLt00k9QZYbUSWynvkj/Pj8/40Et6AZz4ABcgQfwTjzQswMa003/ifd58QfDc8EwOAGWJickK9d0p3+DNnAKrAhxSjp+m+R4DOgBj8CKEo+kM+Y7HfeDZvAQxtgPcEBh3AqKQAqIA0Eijp4V0Zhh+s9HGNn3ZIM/2s4ng10bw97BMqgFMZrRVUuy3mX6yJbkaDlfCO4lhryCfhAXAb1xJPvVJhoKI+18C3iXhPkUSIrCC0giXR+SyGuJhNIArUtLwBrI/IY9KJN0WxyyNeCm8ysSRZ0GnEKdEttWXJkEyZt/AdUGHcXV4EUUCW6seYtxBbIMTMSyyDaL0aKz279z503Oz6nuuBJsjIVfOefvediL37yRkfAiOCKTFTI8YZJTrWlYLGgEM2AbnIMX4hLsgRkak+BQ5oB0TxAnS34nQps1d3surwZsOUhrRQZX2sgdonG/FE6HZiep5wM/5zX2kD1gaXIMSkTOE9LkS5An3Num5lRh8Qwv8wt5wwiwXGYQBJnzIbLDJEs88nrs6nle0k59oXjZsHHiCHSDEpAOfhF/V4LdYYqsW8Gz4jA2TQlK6d+igW2CwiZJ0fkzieGLIF1xJ59xGBnVDmoHXkC1iQbyTk6/YthvSJKmAs3K85LJVE50Qr7wzpKgh8eSB4WSVrLmtxVkKMlmtDkspXlSl2uX7y8rvSWx80F95/mGJ6TPoaxlaZ0g6N7WKhi5Jwj7uGg4T4w5lFfLu83/zZ/50RejkORYjIJoOU/MK2zS/EiMF83MvoKhW3y3d8H5AWApsK4g++CPSKezV7mGptyez2i6SwXNLzq+skExRVoLaAN9YAzMg3UwqdHb6A49nGMPWx0Ka+RJjgcqxVZm85woLIocCpvls+mBCShiNh/4BA2EFIfCttn/SjwwASn8xPIJqr84h8LO+fr3wATEMZsffDxDcprACLouvzwwAUGe8XpyAsiRjv/QpjMBnlsC0JXG17LGEvDeJghd5Uz3lsYm6L1jkMJe0LhRPwY9mQiFdHGbdRIhY1Jhh3ozBMVbnE4qXMvD4juKIQWdC+4WQwaUw5rNlzqdctjMhoh8yV0wXXvAr9EQMbolxhOYHZ1oE7fEvNEUjQObCq0whaao+W3xfMmd/wb7+kOvLW7gxUgG/ccScMo3ae2LEQOuxtJAMegBhzb/3xQtK42rMU9djsq//NK8HOVv8N6w6/G9cBegGtfjxn4g8UGnSLXLn881m/CJzKzgE5kLejZLY2L/at8OLACAgSAI1nolpH9IC8kJ4U0Xi50H21y1yJikbHJGSausWdouD0wgM9DUBZtbB1mbgs3lP5sDJ9FZeHo6n99ybdMJ2yzi/QAAAABJRU5ErkJggg==\"","module.exports = \"data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAEAAAABACAYAAACqaXHeAAAC30lEQVR4AdyYgacqQRTGt1u0NmqhSyiAFFRAXEUICEHXA563KNiH9tK19cf3vjgexje7e+9p9m4NPxhzzpzzdXbmTJ7rcb1eW2AEFmALIhCDBKRCInORrFmITct7xIHAe2AN9uCiZC++elVPugnm4AAujjjIHs0qJe6DJfgAl5L4kD39n0y8BiYgyQn2DCIp4xkYgBAEoC4EMjeQNWuxOef4PkoMtbKT74DfGYGlYCcHma+srpH4Sm37SSydspLvi/IskE+wAoGDfQPx/ZlRDX3XyU9BainzDWiX8AO0Za+zpfKmLjZ9AWuL8r9A9wfOoK7szWJag5d7Jv9u2eitArfQmyW297uIYPnlT2BYoat4CE6sEtTfPHEag9cKNmKvICbxTjWnfUqSb1W4G20REVLQ/849fyRlz3/56lXCiVyRneIdHm9yhg/0GBtamqVaEeNJVU57B7fDpEjrmZj3fI7N5SuIWSn+SJ9wBH6WwZJ0eN0HFqBLOsal9T1PnrQb9wE797chT+kmWzgnD5v2EwjQJg+oOVt4MBatPAxFwGcwvsNhNs76X6Cgj5VhdzAX9EjzECgF0IlAklcIEJCmrpfV7++KB0mTVovAkmdifMHfzvpOIP/ejhQCjLUiZPlQCDAybPf/+2eykV/YMQlIIUKurUIAn/htMWX+eBgaAb4pQr6NQgCxjcxKv00u+LehECA7oRg0iJ8GiO3J6wUgZ93iNrk1Jmd6Aawi/AVhhq9Q1vBq0QswM+y3rCwGnnZwEWKaPBchBmMHcQyMXCOPlF3o6HXW0K9VxxCan6NHXn+B96TjlpuRa+KRDqn+xALUzY73X/v2UQAgDMBQVA+yKqH+L9zZezRPAnQn//sBlkD6JugYdBFyFe5G0yLoMeQ5nByIiMSEomJxxYhqTDk6PitrQD0OkIDIgKRgckBJqCxYGi5PmKDMkKbOa3N1QyhSDmhz5WVtjjhJnSVPB+jzPZGAyclJbc34AAAAAElFTkSuQmCC\"","/*!\n* screenfull\n* v3.3.3 - 2018-09-04\n* (c) Sindre Sorhus; MIT License\n*/\n(function () {\n\t'use strict';\n\n\tvar document = typeof window !== 'undefined' && typeof window.document !== 'undefined' ? window.document : {};\n\tvar isCommonjs = typeof module !== 'undefined' && module.exports;\n\tvar keyboardAllowed = typeof Element !== 'undefined' && 'ALLOW_KEYBOARD_INPUT' in Element;\n\n\tvar fn = (function () {\n\t\tvar val;\n\n\t\tvar fnMap = [\n\t\t\t[\n\t\t\t\t'requestFullscreen',\n\t\t\t\t'exitFullscreen',\n\t\t\t\t'fullscreenElement',\n\t\t\t\t'fullscreenEnabled',\n\t\t\t\t'fullscreenchange',\n\t\t\t\t'fullscreenerror'\n\t\t\t],\n\t\t\t// New WebKit\n\t\t\t[\n\t\t\t\t'webkitRequestFullscreen',\n\t\t\t\t'webkitExitFullscreen',\n\t\t\t\t'webkitFullscreenElement',\n\t\t\t\t'webkitFullscreenEnabled',\n\t\t\t\t'webkitfullscreenchange',\n\t\t\t\t'webkitfullscreenerror'\n\n\t\t\t],\n\t\t\t// Old WebKit (Safari 5.1)\n\t\t\t[\n\t\t\t\t'webkitRequestFullScreen',\n\t\t\t\t'webkitCancelFullScreen',\n\t\t\t\t'webkitCurrentFullScreenElement',\n\t\t\t\t'webkitCancelFullScreen',\n\t\t\t\t'webkitfullscreenchange',\n\t\t\t\t'webkitfullscreenerror'\n\n\t\t\t],\n\t\t\t[\n\t\t\t\t'mozRequestFullScreen',\n\t\t\t\t'mozCancelFullScreen',\n\t\t\t\t'mozFullScreenElement',\n\t\t\t\t'mozFullScreenEnabled',\n\t\t\t\t'mozfullscreenchange',\n\t\t\t\t'mozfullscreenerror'\n\t\t\t],\n\t\t\t[\n\t\t\t\t'msRequestFullscreen',\n\t\t\t\t'msExitFullscreen',\n\t\t\t\t'msFullscreenElement',\n\t\t\t\t'msFullscreenEnabled',\n\t\t\t\t'MSFullscreenChange',\n\t\t\t\t'MSFullscreenError'\n\t\t\t]\n\t\t];\n\n\t\tvar i = 0;\n\t\tvar l = fnMap.length;\n\t\tvar ret = {};\n\n\t\tfor (; i < l; i++) {\n\t\t\tval = fnMap[i];\n\t\t\tif (val && val[1] in document) {\n\t\t\t\tfor (i = 0; i < val.length; i++) {\n\t\t\t\t\tret[fnMap[0][i]] = val[i];\n\t\t\t\t}\n\t\t\t\treturn ret;\n\t\t\t}\n\t\t}\n\n\t\treturn false;\n\t})();\n\n\tvar eventNameMap = {\n\t\tchange: fn.fullscreenchange,\n\t\terror: fn.fullscreenerror\n\t};\n\n\tvar screenfull = {\n\t\trequest: function (elem) {\n\t\t\tvar request = fn.requestFullscreen;\n\n\t\t\telem = elem || document.documentElement;\n\n\t\t\t// Work around Safari 5.1 bug: reports support for\n\t\t\t// keyboard in fullscreen even though it doesn't.\n\t\t\t// Browser sniffing, since the alternative with\n\t\t\t// setTimeout is even worse.\n\t\t\tif (/ Version\\/5\\.1(?:\\.\\d+)? Safari\\//.test(navigator.userAgent)) {\n\t\t\t\telem[request]();\n\t\t\t} else {\n\t\t\t\telem[request](keyboardAllowed ? Element.ALLOW_KEYBOARD_INPUT : {});\n\t\t\t}\n\t\t},\n\t\texit: function () {\n\t\t\tdocument[fn.exitFullscreen]();\n\t\t},\n\t\ttoggle: function (elem) {\n\t\t\tif (this.isFullscreen) {\n\t\t\t\tthis.exit();\n\t\t\t} else {\n\t\t\t\tthis.request(elem);\n\t\t\t}\n\t\t},\n\t\tonchange: function (callback) {\n\t\t\tthis.on('change', callback);\n\t\t},\n\t\tonerror: function (callback) {\n\t\t\tthis.on('error', callback);\n\t\t},\n\t\ton: function (event, callback) {\n\t\t\tvar eventName = eventNameMap[event];\n\t\t\tif (eventName) {\n\t\t\t\tdocument.addEventListener(eventName, callback, false);\n\t\t\t}\n\t\t},\n\t\toff: function (event, callback) {\n\t\t\tvar eventName = eventNameMap[event];\n\t\t\tif (eventName) {\n\t\t\t\tdocument.removeEventListener(eventName, callback, false);\n\t\t\t}\n\t\t},\n\t\traw: fn\n\t};\n\n\tif (!fn) {\n\t\tif (isCommonjs) {\n\t\t\tmodule.exports = false;\n\t\t} else {\n\t\t\twindow.screenfull = false;\n\t\t}\n\n\t\treturn;\n\t}\n\n\tObject.defineProperties(screenfull, {\n\t\tisFullscreen: {\n\t\t\tget: function () {\n\t\t\t\treturn Boolean(document[fn.fullscreenElement]);\n\t\t\t}\n\t\t},\n\t\telement: {\n\t\t\tenumerable: true,\n\t\t\tget: function () {\n\t\t\t\treturn document[fn.fullscreenElement];\n\t\t\t}\n\t\t},\n\t\tenabled: {\n\t\t\tenumerable: true,\n\t\t\tget: function () {\n\t\t\t\t// Coerce to boolean in case of old WebKit\n\t\t\t\treturn Boolean(document[fn.fullscreenEnabled]);\n\t\t\t}\n\t\t}\n\t});\n\n\tif (isCommonjs) {\n\t\tmodule.exports = screenfull;\n\t} else {\n\t\twindow.screenfull = screenfull;\n\t}\n})();\n","import * as ProgressUtils from 'bemuse/progress/utils'\nimport _ from 'lodash'\nimport defaultKeysoundCache from 'bemuse/keysound-cache'\nimport pMap from 'p-map'\nimport { EXTRA_FORMATTER } from 'bemuse/progress/formatters'\n\nexport class SamplesLoader {\n  constructor(assets, master, { keysoundCache = defaultKeysoundCache } = {}) {\n    this._assets = assets\n    this._master = master\n    this._keysoundCache = keysoundCache\n  }\n\n  loadFiles(files, loadProgress, decodeProgress) {\n    const onload = ProgressUtils.fixed(files.length, loadProgress)\n    const ondecode = ProgressUtils.fixed(files.length, decodeProgress)\n    const load = (name) =>\n      new Promise((resolve) => {\n        requestAnimationFrame(() => {\n          resolve(this._loadSample(name, onload, ondecode))\n        })\n      })\n    if (decodeProgress) decodeProgress.formatter = EXTRA_FORMATTER\n    return pMap(files, load, { concurrency: 64 }).then((arr) =>\n      _(arr).filter().fromPairs().value()\n    )\n  }\n\n  async _loadSample(name, onload, ondecode) {\n    const audioBufferPromise = (async () => {\n      if (this._keysoundCache.isCached(name)) {\n        const cache = await this._keysoundCache.get(name)\n        onload(name)\n        ondecode(name)\n        return cache\n      }\n      const file = await this._getFile(name)\n      const buffer = await file.read()\n      onload(name)\n      const audioBuffer = await this._decode(buffer)\n      this._keysoundCache.cache(name, audioBuffer)\n      ondecode(name)\n      return audioBuffer\n    })()\n    try {\n      const audioBuffer = await audioBufferPromise\n\n      const sample = await this._master.sample(audioBuffer)\n      return [name, sample]\n    } catch (e) {\n      console.error('Unable to load keysound: ' + name, e)\n      return null\n    }\n  }\n\n  _decode(buffer) {\n    return this._master.decode(buffer)\n  }\n\n  _getFile(name) {\n    name = name.replace(/\\\\/g, '/')\n    return this._assets\n      .file(name.replace(/\\.\\w+$/, '.ogg'))\n      .catch(() => this._assets.file(name.replace(/\\.\\w+$/, '.m4a')))\n      .catch(() => this._assets.file(name.replace(/\\.\\w+$/, '.mp3')))\n      .catch(() => this._assets.file(name))\n  }\n}\n\nexport default SamplesLoader\n","import _ from 'lodash'\nimport Notechart from 'bemuse-notechart'\n\nexport enum Judgment {\n  Missed = -1,\n  Unjudged = 0,\n  Meticulous = 1,\n  Precise = 2,\n  Good = 3,\n  Offbeat = 4,\n}\n\nexport type JudgedJudgment = Exclude<Judgment, Judgment.Unjudged>\n\nexport const UNJUDGED = Judgment.Unjudged\nexport const MISSED = Judgment.Missed\n\nexport type Timegate = {\n  value: Judgment\n  timegate: number\n  endTimegate: number\n}\nexport type Timegates = Timegate[]\n\n// #region judgment timegate\nconst NORMAL_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.02, endTimegate: 0.04 },\n  { value: 2, timegate: 0.05, endTimegate: 0.1 },\n  { value: 3, timegate: 0.1, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV5_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.021, endTimegate: 0.042 },\n  { value: 2, timegate: 0.06, endTimegate: 0.12 },\n  { value: 3, timegate: 0.12, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV4_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.022, endTimegate: 0.044 },\n  { value: 2, timegate: 0.07, endTimegate: 0.14 },\n  { value: 3, timegate: 0.14, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst TRANSITIONAL_BEGINNER_LV3_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.023, endTimegate: 0.046 },\n  { value: 2, timegate: 0.08, endTimegate: 0.16 },\n  { value: 3, timegate: 0.16, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\nconst ABSOLUTE_BEGINNER_TIMEGATES: Timegates = [\n  { value: 1, timegate: 0.024, endTimegate: 0.048 },\n  { value: 2, timegate: 0.1, endTimegate: 0.18 },\n  { value: 3, timegate: 0.18, endTimegate: 0.2 },\n  { value: 4, timegate: 0.2, endTimegate: 0.2 },\n]\n// #endregion\n\nexport interface IJudge {\n  getTimegates(gameTime: number | null, noteTime: number | null): Timegates\n}\n\nclass FixedTimegatesJudge implements IJudge {\n  constructor(private timegates: Timegates) {}\n  getTimegates(_gameTime: number | null, _noteTime: number | null) {\n    return this.timegates\n  }\n}\n\nclass TutorialJudge implements IJudge {\n  getTimegates(_gameTime: number | null, noteTime: number | null) {\n    if (!noteTime || noteTime < 100) {\n      return ABSOLUTE_BEGINNER_TIMEGATES\n    } else {\n      return NORMAL_TIMEGATES\n    }\n  }\n}\n\nconst NORMAL_JUDGE = new FixedTimegatesJudge(NORMAL_TIMEGATES)\n\nexport function getJudgeForNotechart(\n  notechart: Notechart,\n  { tutorial = false }\n): IJudge {\n  const info = notechart.songInfo\n  const insane = info.difficulty >= 5\n  if (tutorial) {\n    return new TutorialJudge()\n  }\n  if (insane) {\n    return NORMAL_JUDGE\n  }\n  if (info.level === 1 || info.level === 2) {\n    return new FixedTimegatesJudge(ABSOLUTE_BEGINNER_TIMEGATES)\n  }\n  if (info.level === 3) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV3_TIMEGATES)\n  }\n  if (info.level === 4) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV4_TIMEGATES)\n  }\n  if (info.level === 5) {\n    return new FixedTimegatesJudge(TRANSITIONAL_BEGINNER_LV5_TIMEGATES)\n  }\n  return NORMAL_JUDGE\n}\n\n/**\n * Takes a gameTime and noteTime and returns the appropriate judgment.\n *\n *  1 - METICULOUS\n *  2 - PRECISE\n *  3 - GOOD\n *  4 - OFFBEAT\n *  0 - (not judge)\n * -1 - MISSED\n */\nexport function judgeTimeWith(f: (timegate: Timegate) => number) {\n  return function judgeTimeWithF(\n    gameTime: number,\n    noteTime: number,\n    judge: IJudge = NORMAL_JUDGE\n  ): Judgment {\n    const timegates = judge.getTimegates(gameTime, noteTime)\n    const delta = Math.abs(gameTime - noteTime)\n    for (let i = 0; i < timegates.length; i++) {\n      if (delta < f(timegates[i])) return timegates[i].value\n    }\n    return gameTime < noteTime ? UNJUDGED : MISSED\n  }\n}\n\nexport const judgeTime = judgeTimeWith((t) => t.timegate)\nexport const judgeEndTime = judgeTimeWith((t) => t.endTimegate)\n\nexport function timegate(judgment: Judgment, judge = NORMAL_JUDGE) {\n  return _.find(judge.getTimegates(null, null), { value: judgment })!.timegate\n}\n\nexport function isBad(judgment: Judgment) {\n  return judgment >= 4\n}\n\nexport function breaksCombo(judgment: Judgment) {\n  return judgment === MISSED || isBad(judgment)\n}\n\n// #region judgment weight\nexport function weight(judgment: Judgment) {\n  if (judgment === 1) return 100\n  if (judgment === 2) return 80\n  if (judgment === 3) return 50\n  return 0\n}\n// #endregion\n","import bytes from 'bytes'\n\nconst wrap = (f) => (progress) => progress.progress !== null ? f(progress) : ''\n\n// Formats the `Progress` as bytes (e.g. 1.23mb of 1.31mb).\nexport const BYTES_FORMATTER = wrap(\n  (progress) => bytes(progress.current) + ' / ' + bytes(progress.total)\n)\n\n// Formats the `Progress` as percentage.\nexport const PERCENTAGE_FORMATTER = wrap(\n  (progress) => ((progress.current / progress.total) * 100).toFixed(1) + '%'\n)\n\n// Formats the `Progress` simply by using the value of `Progress#extra`.\nexport const EXTRA_FORMATTER = wrap((progress) => progress.extra + '')\n","(function() {\nvar _slice = Array.prototype.slice;\nvar Bacon = {\n  toString: function () {\n    return \"Bacon\";\n  }\n};\n\nBacon.version = '0.7.95';\n\nvar Exception = (typeof global !== \"undefined\" && global !== null ? global : this).Error;\nvar nop = function () {};\nvar latter = function (_, x) {\n  return x;\n};\nvar former = function (x, _) {\n  return x;\n};\nvar cloneArray = function (xs) {\n  return xs.slice(0);\n};\nvar assert = function (message, condition) {\n  if (!condition) {\n    throw new Exception(message);\n  }\n};\nvar assertObservableIsProperty = function (x) {\n  if ((x != null ? x._isObservable : void 0) && !(x != null ? x._isProperty : void 0)) {\n    throw new Exception(\"Observable is not a Property : \" + x);\n  }\n};\nvar assertEventStream = function (event) {\n  if (!(event != null ? event._isEventStream : void 0)) {\n    throw new Exception(\"not an EventStream : \" + event);\n  }\n};\n\nvar assertObservable = function (event) {\n  if (!(event != null ? event._isObservable : void 0)) {\n    throw new Exception(\"not an Observable : \" + event);\n  }\n};\nvar assertFunction = function (f) {\n  return assert(\"not a function : \" + f, _.isFunction(f));\n};\nvar isArray = Array.isArray || function (xs) {\n  return xs instanceof Array;\n};\nvar isObservable = function (x) {\n  return x && x._isObservable;\n};\nvar assertArray = function (xs) {\n  if (!isArray(xs)) {\n    throw new Exception(\"not an array : \" + xs);\n  }\n};\nvar assertNoArguments = function (args) {\n  return assert(\"no arguments supported\", args.length === 0);\n};\nvar assertString = function (x) {\n  if (typeof x === \"string\") {\n    throw new Exception(\"not a string : \" + x);\n  }\n};\n\nvar extend = function (target) {\n  var length = arguments.length;\n  for (var i = 1; 1 < length ? i < length : i > length; 1 < length ? i++ : i--) {\n    for (var prop in arguments[i]) {\n      target[prop] = arguments[i][prop];\n    }\n  }\n  return target;\n};\n\nvar inherit = function (child, parent) {\n  var hasProp = ({}).hasOwnProperty;\n  var ctor = function () {};\n  ctor.prototype = parent.prototype;\n  child.prototype = new ctor();\n  for (var key in parent) {\n    if (hasProp.call(parent, key)) {\n      child[key] = parent[key];\n    }\n  }\n  return child;\n};\n\nvar symbol = function (key) {\n  if (typeof Symbol !== \"undefined\" && Symbol[key]) {\n    return Symbol[key];\n  } else if (typeof Symbol !== \"undefined\" && typeof Symbol[\"for\"] === \"function\") {\n    return Symbol[key] = Symbol[\"for\"](key);\n  } else {\n    return \"@@\" + key;\n  }\n};\n\nvar _ = {\n  indexOf: (function () {\n    if (Array.prototype.indexOf) {\n      return function (xs, x) {\n        return xs.indexOf(x);\n      };\n    } else {\n      return function (xs, x) {\n        for (var i = 0, y; i < xs.length; i++) {\n          y = xs[i];\n          if (x === y) {\n            return i;\n          }\n        }\n        return -1;\n      };\n    }\n  })(),\n  indexWhere: function (xs, f) {\n    for (var i = 0, y; i < xs.length; i++) {\n      y = xs[i];\n      if (f(y)) {\n        return i;\n      }\n    }\n    return -1;\n  },\n  head: function (xs) {\n    return xs[0];\n  },\n  always: function (x) {\n    return function () {\n      return x;\n    };\n  },\n  negate: function (f) {\n    return function (x) {\n      return !f(x);\n    };\n  },\n  empty: function (xs) {\n    return xs.length === 0;\n  },\n  tail: function (xs) {\n    return xs.slice(1, xs.length);\n  },\n  filter: function (f, xs) {\n    var filtered = [];\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        filtered.push(x);\n      }\n    }\n    return filtered;\n  },\n  map: function (f, xs) {\n    return (function () {\n      var result = [];\n      for (var i = 0, x; i < xs.length; i++) {\n        x = xs[i];\n        result.push(f(x));\n      }\n      return result;\n    })();\n  },\n  each: function (xs, f) {\n    for (var key in xs) {\n      if (Object.prototype.hasOwnProperty.call(xs, key)) {\n        var value = xs[key];\n        f(key, value);\n      }\n    }\n  },\n  toArray: function (xs) {\n    return isArray(xs) ? xs : [xs];\n  },\n  contains: function (xs, x) {\n    return _.indexOf(xs, x) !== -1;\n  },\n  id: function (x) {\n    return x;\n  },\n  last: function (xs) {\n    return xs[xs.length - 1];\n  },\n  all: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (!f(x)) {\n        return false;\n      }\n    }\n    return true;\n  },\n  any: function (xs) {\n    var f = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      if (f(x)) {\n        return true;\n      }\n    }\n    return false;\n  },\n  without: function (x, xs) {\n    return _.filter(function (y) {\n      return y !== x;\n    }, xs);\n  },\n  remove: function (x, xs) {\n    var i = _.indexOf(xs, x);\n    if (i >= 0) {\n      return xs.splice(i, 1);\n    }\n  },\n  fold: function (xs, seed, f) {\n    for (var i = 0, x; i < xs.length; i++) {\n      x = xs[i];\n      seed = f(seed, x);\n    }\n    return seed;\n  },\n  flatMap: function (f, xs) {\n    return _.fold(xs, [], function (ys, x) {\n      return ys.concat(f(x));\n    });\n  },\n  cached: function (f) {\n    var value = None;\n    return function () {\n      if (typeof value !== \"undefined\" && value !== null ? value._isNone : undefined) {\n        value = f();\n        f = undefined;\n      }\n      return value;\n    };\n  },\n  bind: function (fn, me) {\n    return function () {\n      return fn.apply(me, arguments);\n    };\n  },\n  isFunction: function (f) {\n    return typeof f === \"function\";\n  },\n  toString: function (obj) {\n    var internals, key, value;\n    var hasProp = ({}).hasOwnProperty;\n    try {\n      recursionDepth++;\n      if (obj == null) {\n        return \"undefined\";\n      } else if (_.isFunction(obj)) {\n        return \"function\";\n      } else if (isArray(obj)) {\n        if (recursionDepth > 5) {\n          return \"[..]\";\n        }\n        return \"[\" + _.map(_.toString, obj).toString() + \"]\";\n      } else if ((obj != null ? obj.toString : void 0) != null && obj.toString !== Object.prototype.toString) {\n        return obj.toString();\n      } else if (typeof obj === \"object\") {\n        if (recursionDepth > 5) {\n          return \"{..}\";\n        }\n        internals = (function () {\n          var results = [];\n          for (key in obj) {\n            if (!hasProp.call(obj, key)) continue;\n            value = (function () {\n              var error;\n              try {\n                return obj[key];\n              } catch (error) {\n                return error;\n              }\n            })();\n            results.push(_.toString(key) + \":\" + _.toString(value));\n          }\n          return results;\n        })();\n        return \"{\" + internals + \"}\";\n      } else {\n        return obj;\n      }\n    } finally {\n      recursionDepth--;\n    }\n  }\n};\n\nvar recursionDepth = 0;\n\nBacon._ = _;\n\nvar UpdateBarrier = Bacon.UpdateBarrier = (function () {\n  var rootEvent;\n  var waiterObs = [];\n  var waiters = {};\n  var aftersStack = [];\n  var aftersStackHeight = 0;\n  var flushed = {};\n\n  function ensureStackHeight(h) {\n    if (h <= aftersStackHeight) return;\n    if (!aftersStack[h - 1]) {\n      aftersStack[h - 1] = [[], 0];\n    }\n    aftersStackHeight = h;\n  }\n\n  var afterTransaction = function (obs, f) {\n    if (rootEvent || aftersStack.length) {\n      ensureStackHeight(1);\n      var stackIndexForThisObs = 0;\n      while (stackIndexForThisObs < aftersStackHeight - 1) {\n        if (containsObs(obs, aftersStack[stackIndexForThisObs][0])) {\n          break;\n        }\n        stackIndexForThisObs++;\n      }\n      var listFromStack = aftersStack[stackIndexForThisObs][0];\n      listFromStack.push([obs, f]);\n      if (!rootEvent) {\n        processAfters();\n      }\n    } else {\n        return f();\n      }\n  };\n\n  function containsObs(obs, aftersList) {\n    for (var i = 0; i < aftersList.length; i++) {\n      if (aftersList[i][0].id == obs.id) return true;\n    }\n    return false;\n  }\n\n  function processAfters() {\n    var stackSizeAtStart = aftersStackHeight;\n    if (!stackSizeAtStart) return;\n    while (aftersStackHeight >= stackSizeAtStart) {\n      var topOfStack = aftersStack[aftersStackHeight - 1];\n      if (!topOfStack) throw new Error(\"Unexpected stack top: \" + topOfStack);\n      var topAfters = topOfStack[0];\n      var index = topOfStack[1];\n\n      if (index < topAfters.length) {\n        var _topAfters$index = topAfters[index];\n        var obs = _topAfters$index[0];\n        var after = _topAfters$index[1];\n\n        topOfStack[1]++;\n        ensureStackHeight(aftersStackHeight + 1);\n        var callSuccess = false;\n        try {\n          after();\n          callSuccess = true;\n          while (aftersStackHeight > stackSizeAtStart && aftersStack[aftersStackHeight - 1][0].length == 0) {\n            aftersStackHeight--;\n          }\n        } finally {\n          if (!callSuccess) {\n            aftersStack = [];\n            aftersStackHeight = 0;\n          }\n        }\n      } else {\n          topOfStack[0] = [];\n          topOfStack[1] = 0;\n          break;\n        }\n    }\n  }\n\n  var whenDoneWith = function (obs, f) {\n    if (rootEvent) {\n      var obsWaiters = waiters[obs.id];\n      if (!(typeof obsWaiters !== \"undefined\" && obsWaiters !== null)) {\n        obsWaiters = waiters[obs.id] = [f];\n        return waiterObs.push(obs);\n      } else {\n        return obsWaiters.push(f);\n      }\n    } else {\n      return f();\n    }\n  };\n\n  var flush = function () {\n    while (waiterObs.length > 0) {\n      flushWaiters(0, true);\n    }\n    flushed = {};\n  };\n\n  var flushWaiters = function (index, deps) {\n    var obs = waiterObs[index];\n    var obsId = obs.id;\n    var obsWaiters = waiters[obsId];\n    waiterObs.splice(index, 1);\n    delete waiters[obsId];\n    if (deps && waiterObs.length > 0) {\n      flushDepsOf(obs);\n    }\n    for (var i = 0, f; i < obsWaiters.length; i++) {\n      f = obsWaiters[i];\n      f();\n    }\n  };\n\n  var flushDepsOf = function (obs) {\n    if (flushed[obs.id]) return;\n    var deps = obs.internalDeps();\n    for (var i = 0, dep; i < deps.length; i++) {\n      dep = deps[i];\n      flushDepsOf(dep);\n      if (waiters[dep.id]) {\n        var index = _.indexOf(waiterObs, dep);\n        flushWaiters(index, false);\n      }\n    }\n    flushed[obs.id] = true;\n  };\n\n  var inTransaction = function (event, context, f, args) {\n    if (rootEvent) {\n      return f.apply(context, args);\n    } else {\n      rootEvent = event;\n      try {\n        var result = f.apply(context, args);\n\n        flush();\n      } finally {\n        rootEvent = undefined;\n        processAfters();\n      }\n      return result;\n    }\n  };\n\n  var currentEventId = function () {\n    return rootEvent ? rootEvent.id : undefined;\n  };\n\n  var wrappedSubscribe = function (obs, sink) {\n    var unsubd = false;\n    var shouldUnsub = false;\n    var doUnsub = function () {\n      shouldUnsub = true;\n      return shouldUnsub;\n    };\n    var unsub = function () {\n      unsubd = true;\n      return doUnsub();\n    };\n    doUnsub = obs.dispatcher.subscribe(function (event) {\n      return afterTransaction(obs, function () {\n        if (!unsubd) {\n          var reply = sink(event);\n          if (reply === Bacon.noMore) {\n            return unsub();\n          }\n        }\n      });\n    });\n    if (shouldUnsub) {\n      doUnsub();\n    }\n    return unsub;\n  };\n\n  var hasWaiters = function () {\n    return waiterObs.length > 0;\n  };\n\n  return { whenDoneWith: whenDoneWith, hasWaiters: hasWaiters, inTransaction: inTransaction, currentEventId: currentEventId, wrappedSubscribe: wrappedSubscribe, afterTransaction: afterTransaction };\n})();\n\nfunction Source(obs, sync) {\n  var lazy = arguments.length <= 2 || arguments[2] === undefined ? false : arguments[2];\n\n  this.obs = obs;\n  this.sync = sync;\n  this.lazy = lazy;\n  this.queue = [];\n}\n\nextend(Source.prototype, {\n  _isSource: true,\n\n  subscribe: function (sink) {\n    return this.obs.dispatcher.subscribe(sink);\n  },\n  toString: function () {\n    return this.obs.toString();\n  },\n  markEnded: function () {\n    this.ended = true;\n    return true;\n  },\n  consume: function () {\n    if (this.lazy) {\n      return { value: _.always(this.queue[0]) };\n    } else {\n      return this.queue[0];\n    }\n  },\n  push: function (x) {\n    this.queue = [x];\n    return [x];\n  },\n  mayHave: function () {\n    return true;\n  },\n  hasAtLeast: function () {\n    return this.queue.length;\n  },\n  flatten: true\n});\n\nfunction ConsumingSource() {\n  Source.apply(this, arguments);\n}\n\ninherit(ConsumingSource, Source);\nextend(ConsumingSource.prototype, {\n  consume: function () {\n    return this.queue.shift();\n  },\n  push: function (x) {\n    return this.queue.push(x);\n  },\n  mayHave: function (c) {\n    return !this.ended || this.queue.length >= c;\n  },\n  hasAtLeast: function (c) {\n    return this.queue.length >= c;\n  },\n  flatten: false\n});\n\nfunction BufferingSource(obs) {\n  Source.call(this, obs, true);\n}\n\ninherit(BufferingSource, Source);\nextend(BufferingSource.prototype, {\n  consume: function () {\n    var values = this.queue;\n    this.queue = [];\n    return {\n      value: function () {\n        return values;\n      }\n    };\n  },\n  push: function (x) {\n    return this.queue.push(x.value());\n  },\n  hasAtLeast: function () {\n    return true;\n  }\n});\n\nSource.isTrigger = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s.sync;\n  } else {\n    return s != null ? s._isEventStream : void 0;\n  }\n};\n\nSource.fromObservable = function (s) {\n  if (s != null ? s._isSource : void 0) {\n    return s;\n  } else if (s != null ? s._isProperty : void 0) {\n    return new Source(s, false);\n  } else {\n    return new ConsumingSource(s, true);\n  }\n};\n\nfunction Desc(context, method, args) {\n  this.context = context;\n  this.method = method;\n  this.args = args;\n}\n\nextend(Desc.prototype, {\n  _isDesc: true,\n  deps: function () {\n    if (!this.cached) {\n      this.cached = findDeps([this.context].concat(this.args));\n    }\n    return this.cached;\n  },\n  toString: function () {\n    return _.toString(this.context) + \".\" + _.toString(this.method) + \"(\" + _.map(_.toString, this.args) + \")\";\n  }\n});\n\nvar describe = function (context, method) {\n  var ref = context || method;\n  if (ref && ref._isDesc) {\n    return context || method;\n  } else {\n    for (var _len = arguments.length, args = Array(_len > 2 ? _len - 2 : 0), _key = 2; _key < _len; _key++) {\n      args[_key - 2] = arguments[_key];\n    }\n\n    return new Desc(context, method, args);\n  }\n};\n\nvar withDesc = function (desc, obs) {\n  obs.desc = desc;\n  return obs;\n};\n\nvar findDeps = function (x) {\n  if (isArray(x)) {\n    return _.flatMap(findDeps, x);\n  } else if (isObservable(x)) {\n    return [x];\n  } else if (typeof x !== \"undefined\" && x !== null ? x._isSource : undefined) {\n    return [x.obs];\n  } else {\n    return [];\n  }\n};\n\nBacon.Desc = Desc;\nBacon.Desc.empty = new Bacon.Desc(\"\", \"\", []);\n\nvar withMethodCallSupport = function (wrapped) {\n  return function (f) {\n    for (var _len2 = arguments.length, args = Array(_len2 > 1 ? _len2 - 1 : 0), _key2 = 1; _key2 < _len2; _key2++) {\n      args[_key2 - 1] = arguments[_key2];\n    }\n\n    if (typeof f === \"object\" && args.length) {\n      var context = f;\n      var methodName = args[0];\n      f = function () {\n        return context[methodName].apply(context, arguments);\n      };\n      args = args.slice(1);\n    }\n    return wrapped.apply(undefined, [f].concat(args));\n  };\n};\n\nvar makeFunctionArgs = function (args) {\n  args = Array.prototype.slice.call(args);\n  return makeFunction_.apply(undefined, args);\n};\n\nvar partiallyApplied = function (f, applied) {\n  return function () {\n    for (var _len3 = arguments.length, args = Array(_len3), _key3 = 0; _key3 < _len3; _key3++) {\n      args[_key3] = arguments[_key3];\n    }\n\n    return f.apply(undefined, applied.concat(args));\n  };\n};\n\nvar toSimpleExtractor = function (args) {\n  return function (key) {\n    return function (value) {\n      if (!(typeof value !== \"undefined\" && value !== null)) {\n        return;\n      } else {\n        var fieldValue = value[key];\n        if (_.isFunction(fieldValue)) {\n          return fieldValue.apply(value, args);\n        } else {\n          return fieldValue;\n        }\n      }\n    };\n  };\n};\n\nvar toFieldExtractor = function (f, args) {\n  var parts = f.slice(1).split(\".\");\n  var partFuncs = _.map(toSimpleExtractor(args), parts);\n  return function (value) {\n    for (var i = 0, f; i < partFuncs.length; i++) {\n      f = partFuncs[i];\n      value = f(value);\n    }\n    return value;\n  };\n};\n\nvar isFieldKey = function (f) {\n  return typeof f === \"string\" && f.length > 1 && f.charAt(0) === \".\";\n};\n\nvar makeFunction_ = withMethodCallSupport(function (f) {\n  for (var _len4 = arguments.length, args = Array(_len4 > 1 ? _len4 - 1 : 0), _key4 = 1; _key4 < _len4; _key4++) {\n    args[_key4 - 1] = arguments[_key4];\n  }\n\n  if (_.isFunction(f)) {\n    if (args.length) {\n      return partiallyApplied(f, args);\n    } else {\n      return f;\n    }\n  } else if (isFieldKey(f)) {\n    return toFieldExtractor(f, args);\n  } else {\n    return _.always(f);\n  }\n});\n\nvar makeFunction = function (f, args) {\n  return makeFunction_.apply(undefined, [f].concat(args));\n};\n\nvar convertArgsToFunction = function (obs, f, args, method) {\n  if (typeof f !== \"undefined\" && f !== null ? f._isProperty : undefined) {\n    var sampled = f.sampledBy(obs, function (p, s) {\n      return [p, s];\n    });\n    return method.call(sampled, function (_ref) {\n      var p = _ref[0];\n      var s = _ref[1];\n      return p;\n    }).map(function (_ref2) {\n      var p = _ref2[0];\n      var s = _ref2[1];\n      return s;\n    });\n  } else {\n    f = makeFunction(f, args);\n    return method.call(obs, f);\n  }\n};\n\nvar toCombinator = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else if (isFieldKey(f)) {\n    var key = toFieldKey(f);\n    return function (left, right) {\n      return left[key](right);\n    };\n  } else {\n    throw new Exception(\"not a function or a field key: \" + f);\n  }\n};\n\nvar toFieldKey = function (f) {\n  return f.slice(1);\n};\n\nfunction Some(value) {\n  this.value = value;\n}\n\nextend(Some.prototype, {\n  _isSome: true,\n  getOrElse: function () {\n    return this.value;\n  },\n  get: function () {\n    return this.value;\n  },\n  filter: function (f) {\n    if (f(this.value)) {\n      return new Some(this.value);\n    } else {\n      return None;\n    }\n  },\n  map: function (f) {\n    return new Some(f(this.value));\n  },\n  forEach: function (f) {\n    return f(this.value);\n  },\n  isDefined: true,\n  toArray: function () {\n    return [this.value];\n  },\n  inspect: function () {\n    return \"Some(\" + this.value + \")\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n});\n\nvar None = {\n  _isNone: true,\n  getOrElse: function (value) {\n    return value;\n  },\n  filter: function () {\n    return None;\n  },\n  map: function () {\n    return None;\n  },\n  forEach: function () {},\n  isDefined: false,\n  toArray: function () {\n    return [];\n  },\n  inspect: function () {\n    return \"None\";\n  },\n  toString: function () {\n    return this.inspect();\n  }\n};\n\nvar toOption = function (v) {\n  if ((typeof v !== \"undefined\" && v !== null ? v._isSome : undefined) || (typeof v !== \"undefined\" && v !== null ? v._isNone : undefined)) {\n    return v;\n  } else {\n    return new Some(v);\n  }\n};\n\nBacon.noMore = \"<no-more>\";\nBacon.more = \"<more>\";\n\nvar eventIdCounter = 0;\n\nfunction Event() {\n  this.id = ++eventIdCounter;\n}\n\nEvent.prototype._isEvent = true;\nEvent.prototype.isEvent = function () {\n  return true;\n};\nEvent.prototype.isEnd = function () {\n  return false;\n};\nEvent.prototype.isInitial = function () {\n  return false;\n};\nEvent.prototype.isNext = function () {\n  return false;\n};\nEvent.prototype.isError = function () {\n  return false;\n};\nEvent.prototype.hasValue = function () {\n  return false;\n};\nEvent.prototype.filter = function () {\n  return true;\n};\nEvent.prototype.inspect = function () {\n  return this.toString();\n};\nEvent.prototype.log = function () {\n  return this.toString();\n};\n\nfunction Next(valueF, eager) {\n  if (!(this instanceof Next)) {\n    return new Next(valueF, eager);\n  }\n\n  Event.call(this);\n\n  if (!eager && _.isFunction(valueF) || (valueF != null ? valueF._isNext : void 0)) {\n    this.valueF = valueF;\n    this.valueInternal = void 0;\n  } else {\n    this.valueF = void 0;\n    this.valueInternal = valueF;\n  }\n}\n\ninherit(Next, Event);\n\nNext.prototype.isNext = function () {\n  return true;\n};\nNext.prototype.hasValue = function () {\n  return true;\n};\nNext.prototype.value = function () {\n  var ref;\n  if ((ref = this.valueF) != null ? ref._isNext : void 0) {\n    this.valueInternal = this.valueF.value();\n    this.valueF = void 0;\n  } else if (this.valueF) {\n    this.valueInternal = this.valueF();\n    this.valueF = void 0;\n  }\n  return this.valueInternal;\n};\n\nNext.prototype.fmap = function (f) {\n  var event, value;\n  if (this.valueInternal) {\n    value = this.valueInternal;\n    return this.apply(function () {\n      return f(value);\n    });\n  } else {\n    event = this;\n    return this.apply(function () {\n      return f(event.value());\n    });\n  }\n};\n\nNext.prototype.apply = function (value) {\n  return new Next(value);\n};\nNext.prototype.filter = function (f) {\n  return f(this.value());\n};\nNext.prototype.toString = function () {\n  return _.toString(this.value());\n};\nNext.prototype.log = function () {\n  return this.value();\n};\nNext.prototype._isNext = true;\n\nfunction Initial(valueF, eager) {\n  if (!(this instanceof Initial)) {\n    return new Initial(valueF, eager);\n  }\n  Next.call(this, valueF, eager);\n}\n\ninherit(Initial, Next);\nInitial.prototype._isInitial = true;\nInitial.prototype.isInitial = function () {\n  return true;\n};\nInitial.prototype.isNext = function () {\n  return false;\n};\nInitial.prototype.apply = function (value) {\n  return new Initial(value);\n};\nInitial.prototype.toNext = function () {\n  return new Next(this);\n};\n\nfunction End() {\n  if (!(this instanceof End)) {\n    return new End();\n  }\n  Event.call(this);\n}\n\ninherit(End, Event);\nEnd.prototype.isEnd = function () {\n  return true;\n};\nEnd.prototype.fmap = function () {\n  return this;\n};\nEnd.prototype.apply = function () {\n  return this;\n};\nEnd.prototype.toString = function () {\n  return \"<end>\";\n};\n\nfunction Error(error) {\n  if (!(this instanceof Error)) {\n    return new Error(error);\n  }\n  this.error = error;\n  Event.call(this);\n}\n\ninherit(Error, Event);\nError.prototype.isError = function () {\n  return true;\n};\nError.prototype.fmap = function () {\n  return this;\n};\nError.prototype.apply = function () {\n  return this;\n};\nError.prototype.toString = function () {\n  return \"<error> \" + _.toString(this.error);\n};\n\nBacon.Event = Event;\nBacon.Initial = Initial;\nBacon.Next = Next;\nBacon.End = End;\nBacon.Error = Error;\n\nvar initialEvent = function (value) {\n  return new Initial(value, true);\n};\nvar nextEvent = function (value) {\n  return new Next(value, true);\n};\nvar endEvent = function () {\n  return new End();\n};\nvar toEvent = function (x) {\n  if (x && x._isEvent) {\n    return x;\n  } else {\n    return nextEvent(x);\n  }\n};\n\nvar idCounter = 0;\nvar registerObs = function () {};\n\nfunction Observable(desc) {\n  this.desc = desc;\n  this.id = ++idCounter;\n  this.initialDesc = this.desc;\n}\n\nextend(Observable.prototype, {\n  _isObservable: true,\n\n  subscribe: function (sink) {\n    return UpdateBarrier.wrappedSubscribe(this, sink);\n  },\n\n  subscribeInternal: function (sink) {\n    return this.dispatcher.subscribe(sink);\n  },\n\n  onValue: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.hasValue()) {\n        return f(event.value());\n      }\n    });\n  },\n\n  onValues: function (f) {\n    return this.onValue(function (args) {\n      return f.apply(undefined, args);\n    });\n  },\n\n  onError: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isError()) {\n        return f(event.error);\n      }\n    });\n  },\n\n  onEnd: function () {\n    var f = makeFunctionArgs(arguments);\n    return this.subscribe(function (event) {\n      if (event.isEnd()) {\n        return f();\n      }\n    });\n  },\n\n  name: function (name) {\n    this._name = name;\n    return this;\n  },\n\n  withDescription: function () {\n    this.desc = describe.apply(undefined, arguments);\n    return this;\n  },\n\n  toString: function () {\n    if (this._name) {\n      return this._name;\n    } else {\n      return this.desc.toString();\n    }\n  },\n\n  deps: function () {\n    return this.desc.deps();\n  },\n\n  internalDeps: function () {\n    return this.initialDesc.deps();\n  }\n});\n\nObservable.prototype.assign = Observable.prototype.onValue;\nObservable.prototype.forEach = Observable.prototype.onValue;\nObservable.prototype.inspect = Observable.prototype.toString;\n\nBacon.Observable = Observable;\n\nfunction CompositeUnsubscribe() {\n  var ss = arguments.length <= 0 || arguments[0] === undefined ? [] : arguments[0];\n\n  this.unsubscribe = _.bind(this.unsubscribe, this);\n  this.unsubscribed = false;\n  this.subscriptions = [];\n  this.starting = [];\n  for (var i = 0, s; i < ss.length; i++) {\n    s = ss[i];\n    this.add(s);\n  }\n}\n\nextend(CompositeUnsubscribe.prototype, {\n  add: function (subscription) {\n    var _this2 = this;\n\n    if (this.unsubscribed) {\n      return;\n    }\n    var ended = false;\n    var unsub = nop;\n    this.starting.push(subscription);\n    var unsubMe = function () {\n      if (_this2.unsubscribed) {\n        return;\n      }\n      ended = true;\n      _this2.remove(unsub);\n      return _.remove(subscription, _this2.starting);\n    };\n    unsub = subscription(this.unsubscribe, unsubMe);\n    if (!(this.unsubscribed || ended)) {\n      this.subscriptions.push(unsub);\n    } else {\n      unsub();\n    }\n    _.remove(subscription, this.starting);\n    return unsub;\n  },\n\n  remove: function (unsub) {\n    if (this.unsubscribed) {\n      return;\n    }\n    if (_.remove(unsub, this.subscriptions) !== undefined) {\n      return unsub();\n    }\n  },\n\n  unsubscribe: function () {\n    if (this.unsubscribed) {\n      return;\n    }\n    this.unsubscribed = true;\n    var iterable = this.subscriptions;\n    for (var i = 0; i < iterable.length; i++) {\n      iterable[i]();\n    }\n    this.subscriptions = [];\n    this.starting = [];\n    return [];\n  },\n\n  count: function () {\n    if (this.unsubscribed) {\n      return 0;\n    }\n    return this.subscriptions.length + this.starting.length;\n  },\n\n  empty: function () {\n    return this.count() === 0;\n  }\n});\n\nBacon.CompositeUnsubscribe = CompositeUnsubscribe;\n\nfunction Dispatcher(_subscribe, _handleEvent) {\n  this._subscribe = _subscribe;\n  this._handleEvent = _handleEvent;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.handleEvent = _.bind(this.handleEvent, this);\n  this.pushing = false;\n  this.ended = false;\n  this.prevError = undefined;\n  this.unsubSrc = undefined;\n  this.subscriptions = [];\n  this.queue = [];\n}\n\nDispatcher.prototype.hasSubscribers = function () {\n  return this.subscriptions.length > 0;\n};\n\nDispatcher.prototype.removeSub = function (subscription) {\n  this.subscriptions = _.without(subscription, this.subscriptions);\n  return this.subscriptions;\n};\n\nDispatcher.prototype.push = function (event) {\n  if (event.isEnd()) {\n    this.ended = true;\n  }\n  return UpdateBarrier.inTransaction(event, this, this.pushIt, [event]);\n};\n\nDispatcher.prototype.pushToSubscriptions = function (event) {\n  try {\n    var tmp = this.subscriptions;\n    var len = tmp.length;\n    for (var i = 0; i < len; i++) {\n      var sub = tmp[i];\n      var reply = sub.sink(event);\n      if (reply === Bacon.noMore || event.isEnd()) {\n        this.removeSub(sub);\n      }\n    }\n    return true;\n  } catch (error) {\n    this.pushing = false;\n    this.queue = [];\n    throw error;\n  }\n};\n\nDispatcher.prototype.pushIt = function (event) {\n  if (!this.pushing) {\n    if (event === this.prevError) {\n      return;\n    }\n    if (event.isError()) {\n      this.prevError = event;\n    }\n    this.pushing = true;\n    this.pushToSubscriptions(event);\n    this.pushing = false;\n    while (this.queue.length) {\n      event = this.queue.shift();\n      this.push(event);\n    }\n    if (this.hasSubscribers()) {\n      return Bacon.more;\n    } else {\n      this.unsubscribeFromSource();\n      return Bacon.noMore;\n    }\n  } else {\n    this.queue.push(event);\n    return Bacon.more;\n  }\n};\n\nDispatcher.prototype.handleEvent = function (event) {\n  if (this._handleEvent) {\n    return this._handleEvent(event);\n  } else {\n    return this.push(event);\n  }\n};\n\nDispatcher.prototype.unsubscribeFromSource = function () {\n  if (this.unsubSrc) {\n    this.unsubSrc();\n  }\n  this.unsubSrc = undefined;\n};\n\nDispatcher.prototype.subscribe = function (sink) {\n  var subscription;\n  if (this.ended) {\n    sink(endEvent());\n    return nop;\n  } else {\n    assertFunction(sink);\n    subscription = {\n      sink: sink\n    };\n    this.subscriptions.push(subscription);\n    if (this.subscriptions.length === 1) {\n      this.unsubSrc = this._subscribe(this.handleEvent);\n      assertFunction(this.unsubSrc);\n    }\n    return (function (_this) {\n      return function () {\n        _this.removeSub(subscription);\n        if (!_this.hasSubscribers()) {\n          return _this.unsubscribeFromSource();\n        }\n      };\n    })(this);\n  }\n};\n\nBacon.Dispatcher = Dispatcher;\n\nfunction EventStream(desc, subscribe, handler) {\n  if (!(this instanceof EventStream)) {\n    return new EventStream(desc, subscribe, handler);\n  }\n  if (_.isFunction(desc)) {\n    handler = subscribe;\n    subscribe = desc;\n    desc = Desc.empty;\n  }\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new Dispatcher(subscribe, handler);\n  registerObs(this);\n}\n\ninherit(EventStream, Observable);\nextend(EventStream.prototype, {\n  _isEventStream: true,\n\n  toProperty: function (initValue_) {\n    var initValue = arguments.length === 0 ? None : toOption(function () {\n      return initValue_;\n    });\n    var disp = this.dispatcher;\n    var desc = new Bacon.Desc(this, \"toProperty\", [initValue_]);\n    return new Property(desc, function (sink) {\n      var initSent = false;\n      var subbed = false;\n      var unsub = nop;\n      var reply = Bacon.more;\n      var sendInit = function () {\n        if (!initSent) {\n          return initValue.forEach(function (value) {\n            initSent = true;\n            reply = sink(new Initial(value));\n            if (reply === Bacon.noMore) {\n              unsub();\n              unsub = nop;\n              return nop;\n            }\n          });\n        }\n      };\n\n      unsub = disp.subscribe(function (event) {\n        if (event.hasValue()) {\n          if (event.isInitial() && !subbed) {\n            initValue = new Some(function () {\n              return event.value();\n            });\n            return Bacon.more;\n          } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = true;\n            initValue = new Some(event);\n            return sink(event);\n          }\n        } else {\n          if (event.isEnd()) {\n            reply = sendInit();\n          }\n          if (reply !== Bacon.noMore) {\n            return sink(event);\n          }\n        }\n      });\n      subbed = true;\n      sendInit();\n      return unsub;\n    });\n  },\n\n  toEventStream: function () {\n    return this;\n  },\n\n  withHandler: function (handler) {\n    return new EventStream(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  }\n});\n\nBacon.EventStream = EventStream;\n\nBacon.never = function () {\n  return new EventStream(describe(Bacon, \"never\"), function (sink) {\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.when = function () {\n  if (arguments.length === 0) {\n    return Bacon.never();\n  }\n  var len = arguments.length;\n  var usage = \"when: expecting arguments in the form (Observable+,function)+\";\n\n  assert(usage, len % 2 === 0);\n  var sources = [];\n  var pats = [];\n  var i = 0;\n  var patterns = [];\n  while (i < len) {\n    patterns[i] = arguments[i];\n    patterns[i + 1] = arguments[i + 1];\n    var patSources = _.toArray(arguments[i]);\n    var f = constantToFunction(arguments[i + 1]);\n    var pat = { f: f, ixs: [] };\n    var triggerFound = false;\n    for (var j = 0, s; j < patSources.length; j++) {\n      s = patSources[j];\n      var index = _.indexOf(sources, s);\n      if (!triggerFound) {\n        triggerFound = Source.isTrigger(s);\n      }\n      if (index < 0) {\n        sources.push(s);\n        index = sources.length - 1;\n      }\n      for (var k = 0, ix; k < pat.ixs.length; k++) {\n        ix = pat.ixs[k];\n        if (ix.index === index) {\n          ix.count++;\n        }\n      }\n      pat.ixs.push({ index: index, count: 1 });\n    }\n\n    assert(\"At least one EventStream required\", triggerFound || !patSources.length);\n\n    if (patSources.length > 0) {\n      pats.push(pat);\n    }\n    i = i + 2;\n  }\n\n  if (!sources.length) {\n    return Bacon.never();\n  }\n\n  sources = _.map(Source.fromObservable, sources);\n  var needsBarrier = _.any(sources, function (s) {\n    return s.flatten;\n  }) && containsDuplicateDeps(_.map(function (s) {\n    return s.obs;\n  }, sources));\n\n  var desc = new Bacon.Desc(Bacon, \"when\", patterns);\n  var resultStream = new EventStream(desc, function (sink) {\n    var triggers = [];\n    var ends = false;\n    var match = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].hasAtLeast(i.count)) {\n          return false;\n        }\n      }\n      return true;\n    };\n    var cannotSync = function (source) {\n      return !source.sync || source.ended;\n    };\n    var cannotMatch = function (p) {\n      for (var i1 = 0, i; i1 < p.ixs.length; i1++) {\n        i = p.ixs[i1];\n        if (!sources[i.index].mayHave(i.count)) {\n          return true;\n        }\n      }\n    };\n    var nonFlattened = function (trigger) {\n      return !trigger.source.flatten;\n    };\n    var part = function (source) {\n      return function (unsubAll) {\n        var flushLater = function () {\n          return UpdateBarrier.whenDoneWith(resultStream, flush);\n        };\n        var flushWhileTriggers = function () {\n          if (triggers.length > 0) {\n            var reply = Bacon.more;\n            var trigger = triggers.pop();\n            for (var i1 = 0, p; i1 < pats.length; i1++) {\n              p = pats[i1];\n              if (match(p)) {\n                var events = (function () {\n                  var result = [];\n                  for (var i2 = 0, i; i2 < p.ixs.length; i2++) {\n                    i = p.ixs[i2];\n                    result.push(sources[i.index].consume());\n                  }\n                  return result;\n                })();\n                reply = sink(trigger.e.apply(function () {\n                  var _p;\n\n                  var values = (function () {\n                    var result = [];\n                    for (var i2 = 0, event; i2 < events.length; i2++) {\n                      event = events[i2];\n                      result.push(event.value());\n                    }\n                    return result;\n                  })();\n\n                  return (_p = p).f.apply(_p, values);\n                }));\n                if (triggers.length) {\n                  triggers = _.filter(nonFlattened, triggers);\n                }\n                if (reply === Bacon.noMore) {\n                  return reply;\n                } else {\n                  return flushWhileTriggers();\n                }\n              }\n            }\n          } else {\n            return Bacon.more;\n          }\n        };\n        var flush = function () {\n          var reply = flushWhileTriggers();\n          if (ends) {\n            if (_.all(sources, cannotSync) || _.all(pats, cannotMatch)) {\n              reply = Bacon.noMore;\n              sink(endEvent());\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n\n          return reply;\n        };\n        return source.subscribe(function (e) {\n          if (e.isEnd()) {\n            ends = true;\n            source.markEnded();\n            flushLater();\n          } else if (e.isError()) {\n            var reply = sink(e);\n          } else {\n            source.push(e);\n            if (source.sync) {\n              triggers.push({ source: source, e: e });\n              if (needsBarrier || UpdateBarrier.hasWaiters()) {\n                flushLater();\n              } else {\n                flush();\n              }\n            }\n          }\n          if (reply === Bacon.noMore) {\n            unsubAll();\n          }\n          return reply || Bacon.more;\n        });\n      };\n    };\n\n    return new Bacon.CompositeUnsubscribe((function () {\n      var result = [];\n      for (var i1 = 0, s; i1 < sources.length; i1++) {\n        s = sources[i1];\n        result.push(part(s));\n      }\n      return result;\n    })()).unsubscribe;\n  });\n  return resultStream;\n};\n\nvar containsDuplicateDeps = function (observables) {\n  var state = arguments.length <= 1 || arguments[1] === undefined ? [] : arguments[1];\n\n  var checkObservable = function (obs) {\n    if (_.contains(state, obs)) {\n      return true;\n    } else {\n      var deps = obs.internalDeps();\n      if (deps.length) {\n        state.push(obs);\n        return _.any(deps, checkObservable);\n      } else {\n        state.push(obs);\n        return false;\n      }\n    }\n  };\n\n  return _.any(observables, checkObservable);\n};\n\nvar constantToFunction = function (f) {\n  if (_.isFunction(f)) {\n    return f;\n  } else {\n    return _.always(f);\n  }\n};\n\nBacon.groupSimultaneous = function () {\n  for (var _len5 = arguments.length, streams = Array(_len5), _key5 = 0; _key5 < _len5; _key5++) {\n    streams[_key5] = arguments[_key5];\n  }\n\n  if (streams.length === 1 && isArray(streams[0])) {\n    streams = streams[0];\n  }\n  var sources = (function () {\n    var result = [];\n    for (var i = 0, s; i < streams.length; i++) {\n      s = streams[i];\n      result.push(new BufferingSource(s));\n    }\n    return result;\n  })();\n  return withDesc(new Bacon.Desc(Bacon, \"groupSimultaneous\", streams), Bacon.when(sources, function () {\n    for (var _len6 = arguments.length, xs = Array(_len6), _key6 = 0; _key6 < _len6; _key6++) {\n      xs[_key6] = arguments[_key6];\n    }\n\n    return xs;\n  }));\n};\n\nfunction PropertyDispatcher(property, subscribe, handleEvent) {\n  Dispatcher.call(this, subscribe, handleEvent);\n  this.property = property;\n  this.subscribe = _.bind(this.subscribe, this);\n  this.current = None;\n  this.currentValueRootId = undefined;\n  this.propertyEnded = false;\n}\n\ninherit(PropertyDispatcher, Dispatcher);\nextend(PropertyDispatcher.prototype, {\n  push: function (event) {\n    if (event.isEnd()) {\n      this.propertyEnded = true;\n    }\n    if (event.hasValue()) {\n      this.current = new Some(event);\n      this.currentValueRootId = UpdateBarrier.currentEventId();\n    }\n    return Dispatcher.prototype.push.call(this, event);\n  },\n\n  maybeSubSource: function (sink, reply) {\n    if (reply === Bacon.noMore) {\n      return nop;\n    } else if (this.propertyEnded) {\n      sink(endEvent());\n      return nop;\n    } else {\n      return Dispatcher.prototype.subscribe.call(this, sink);\n    }\n  },\n\n  subscribe: function (sink) {\n    var _this3 = this;\n\n    var initSent = false;\n\n    var reply = Bacon.more;\n\n    if (this.current.isDefined && (this.hasSubscribers() || this.propertyEnded)) {\n      var dispatchingId = UpdateBarrier.currentEventId();\n      var valId = this.currentValueRootId;\n      if (!this.propertyEnded && valId && dispatchingId && dispatchingId !== valId) {\n        UpdateBarrier.whenDoneWith(this.property, function () {\n          if (_this3.currentValueRootId === valId) {\n            return sink(initialEvent(_this3.current.get().value()));\n          }\n        });\n\n        return this.maybeSubSource(sink, reply);\n      } else {\n        UpdateBarrier.inTransaction(undefined, this, function () {\n          reply = sink(initialEvent(this.current.get().value()));\n          return reply;\n        }, []);\n        return this.maybeSubSource(sink, reply);\n      }\n    } else {\n      return this.maybeSubSource(sink, reply);\n    }\n  }\n});\n\nfunction Property(desc, subscribe, handler) {\n  Observable.call(this, desc);\n  assertFunction(subscribe);\n  this.dispatcher = new PropertyDispatcher(this, subscribe, handler);\n  registerObs(this);\n}\n\ninherit(Property, Observable);\nextend(Property.prototype, {\n  _isProperty: true,\n\n  changes: function () {\n    var _this4 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"changes\", []), function (sink) {\n      return _this4.dispatcher.subscribe(function (event) {\n        if (!event.isInitial()) {\n          return sink(event);\n        }\n      });\n    });\n  },\n\n  withHandler: function (handler) {\n    return new Property(new Bacon.Desc(this, \"withHandler\", [handler]), this.dispatcher.subscribe, handler);\n  },\n\n  toProperty: function () {\n    assertNoArguments(arguments);\n    return this;\n  },\n\n  toEventStream: function () {\n    var _this5 = this;\n\n    return new EventStream(new Bacon.Desc(this, \"toEventStream\", []), function (sink) {\n      return _this5.dispatcher.subscribe(function (event) {\n        if (event.isInitial()) {\n          event = event.toNext();\n        }\n        return sink(event);\n      });\n    });\n  }\n});\n\nBacon.Property = Property;\n\nBacon.constant = function (value) {\n  return new Property(new Bacon.Desc(Bacon, \"constant\", [value]), function (sink) {\n    sink(initialEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.fromBinder = function (binder) {\n  var eventTransformer = arguments.length <= 1 || arguments[1] === undefined ? _.id : arguments[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromBinder\", [binder, eventTransformer]);\n  return new EventStream(desc, function (sink) {\n    var unbound = false;\n    var shouldUnbind = false;\n    var unbind = function () {\n      if (!unbound) {\n        if (typeof unbinder !== \"undefined\" && unbinder !== null) {\n          unbinder();\n          return unbound = true;\n        } else {\n          return shouldUnbind = true;\n        }\n      }\n    };\n    var unbinder = binder(function () {\n      var ref;\n\n      for (var _len7 = arguments.length, args = Array(_len7), _key7 = 0; _key7 < _len7; _key7++) {\n        args[_key7] = arguments[_key7];\n      }\n\n      var value = eventTransformer.apply(this, args);\n      if (!(isArray(value) && ((ref = _.last(value)) != null ? ref._isEvent : undefined))) {\n        value = [value];\n      }\n      var reply = Bacon.more;\n      for (var i = 0, event; i < value.length; i++) {\n        event = value[i];\n        reply = sink(event = toEvent(event));\n        if (reply === Bacon.noMore || event.isEnd()) {\n          unbind();\n          return reply;\n        }\n      }\n      return reply;\n    });\n    if (shouldUnbind) {\n      unbind();\n    }\n    return unbind;\n  });\n};\n\nBacon.Observable.prototype.map = function (p) {\n  for (var _len8 = arguments.length, args = Array(_len8 > 1 ? _len8 - 1 : 0), _key8 = 1; _key8 < _len8; _key8++) {\n    args[_key8 - 1] = arguments[_key8];\n  }\n\n  return convertArgsToFunction(this, p, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n      return this.push(event.fmap(f));\n    }));\n  });\n};\n\nvar argumentsToObservables = function (args) {\n  if (isArray(args[0])) {\n    return args[0];\n  } else {\n    return Array.prototype.slice.call(args);\n  }\n};\n\nvar argumentsToObservablesAndFunction = function (args) {\n  if (_.isFunction(args[0])) {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 1)), args[0]];\n  } else {\n    return [argumentsToObservables(Array.prototype.slice.call(args, 0, args.length - 1)), _.last(args)];\n  }\n};\n\nBacon.combineAsArray = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    var sources = [];\n    for (var i = 0; i < streams.length; i++) {\n      var stream = isObservable(streams[i]) ? streams[i] : Bacon.constant(streams[i]);\n      sources.push(new Source(stream, true));\n    }\n    return withDesc(new Bacon.Desc(Bacon, \"combineAsArray\", streams), Bacon.when(sources, function () {\n      for (var _len9 = arguments.length, xs = Array(_len9), _key9 = 0; _key9 < _len9; _key9++) {\n        xs[_key9] = arguments[_key9];\n      }\n\n      return xs;\n    }).toProperty());\n  } else {\n    return Bacon.constant([]);\n  }\n};\n\nBacon.onValues = function () {\n  return Bacon.combineAsArray(Array.prototype.slice.call(arguments, 0, arguments.length - 1)).onValues(arguments[arguments.length - 1]);\n};\n\nBacon.combineWith = function () {\n  var _argumentsToObservablesAndFunction = argumentsToObservablesAndFunction(arguments);\n\n  var streams = _argumentsToObservablesAndFunction[0];\n  var f = _argumentsToObservablesAndFunction[1];\n\n  var desc = new Bacon.Desc(Bacon, \"combineWith\", [f].concat(streams));\n  return withDesc(desc, Bacon.combineAsArray(streams).map(function (values) {\n    return f.apply(undefined, values);\n  }));\n};\n\nBacon.Observable.prototype.combine = function (other, f) {\n  var combinator = toCombinator(f);\n  var desc = new Bacon.Desc(this, \"combine\", [other, f]);\n  return withDesc(desc, Bacon.combineAsArray(this, other).map(function (values) {\n    return combinator(values[0], values[1]);\n  }));\n};\n\nBacon.Observable.prototype.withStateMachine = function (initState, f) {\n  var state = initState;\n  var desc = new Bacon.Desc(this, \"withStateMachine\", [initState, f]);\n  return withDesc(desc, this.withHandler(function (event) {\n    var fromF = f(state, event);\n    var newState = fromF[0];\n    var outputs = fromF[1];\n\n    state = newState;\n    var reply = Bacon.more;\n    for (var i = 0, output; i < outputs.length; i++) {\n      output = outputs[i];\n      reply = this.push(output);\n      if (reply === Bacon.noMore) {\n        return reply;\n      }\n    }\n    return reply;\n  }));\n};\n\nvar equals = function (a, b) {\n  return a === b;\n};\n\nvar isNone = function (object) {\n  return typeof object !== \"undefined\" && object !== null ? object._isNone : false;\n};\n\nBacon.Observable.prototype.skipDuplicates = function () {\n  var isEqual = arguments.length <= 0 || arguments[0] === undefined ? equals : arguments[0];\n\n  var desc = new Bacon.Desc(this, \"skipDuplicates\", []);\n  return withDesc(desc, this.withStateMachine(None, function (prev, event) {\n    if (!event.hasValue()) {\n      return [prev, [event]];\n    } else if (event.isInitial() || isNone(prev) || !isEqual(prev.get(), event.value())) {\n      return [new Some(event.value()), [event]];\n    } else {\n      return [prev, []];\n    }\n  }));\n};\n\nBacon.Observable.prototype.awaiting = function (other) {\n  var desc = new Bacon.Desc(this, \"awaiting\", [other]);\n  return withDesc(desc, Bacon.groupSimultaneous(this, other).map(function (values) {\n    return values[1].length === 0;\n  }).toProperty(false).skipDuplicates());\n};\n\nBacon.Observable.prototype.not = function () {\n  return withDesc(new Bacon.Desc(this, \"not\", []), this.map(function (x) {\n    return !x;\n  }));\n};\n\nBacon.Property.prototype.and = function (other) {\n  return withDesc(new Bacon.Desc(this, \"and\", [other]), this.combine(other, function (x, y) {\n    return x && y;\n  }));\n};\n\nBacon.Property.prototype.or = function (other) {\n  return withDesc(new Bacon.Desc(this, \"or\", [other]), this.combine(other, function (x, y) {\n    return x || y;\n  }));\n};\n\nBacon.scheduler = {\n  setTimeout: function (f, d) {\n    return setTimeout(f, d);\n  },\n  setInterval: function (f, i) {\n    return setInterval(f, i);\n  },\n  clearInterval: function (id) {\n    return clearInterval(id);\n  },\n  clearTimeout: function (id) {\n    return clearTimeout(id);\n  },\n  now: function () {\n    return new Date().getTime();\n  }\n};\n\nBacon.EventStream.prototype.bufferWithTime = function (delay) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithTime\", [delay]), this.bufferWithTimeOrCount(delay, Number.MAX_VALUE));\n};\n\nBacon.EventStream.prototype.bufferWithCount = function (count) {\n  return withDesc(new Bacon.Desc(this, \"bufferWithCount\", [count]), this.bufferWithTimeOrCount(undefined, count));\n};\n\nBacon.EventStream.prototype.bufferWithTimeOrCount = function (delay, count) {\n  var flushOrSchedule = function (buffer) {\n    if (buffer.values.length === count) {\n      return buffer.flush();\n    } else if (delay !== undefined) {\n      return buffer.schedule();\n    }\n  };\n  var desc = new Bacon.Desc(this, \"bufferWithTimeOrCount\", [delay, count]);\n  return withDesc(desc, this.buffer(delay, flushOrSchedule, flushOrSchedule));\n};\n\nBacon.EventStream.prototype.buffer = function (delay) {\n  var onInput = arguments.length <= 1 || arguments[1] === undefined ? nop : arguments[1];\n  var onFlush = arguments.length <= 2 || arguments[2] === undefined ? nop : arguments[2];\n\n  var buffer = {\n    scheduled: null,\n    end: undefined,\n    values: [],\n    flush: function () {\n      if (this.scheduled) {\n        Bacon.scheduler.clearTimeout(this.scheduled);\n        this.scheduled = null;\n      }\n      if (this.values.length > 0) {\n        var valuesToPush = this.values;\n        this.values = [];\n        var reply = this.push(nextEvent(valuesToPush));\n        if (this.end != null) {\n          return this.push(this.end);\n        } else if (reply !== Bacon.noMore) {\n          return onFlush(this);\n        }\n      } else {\n        if (this.end != null) {\n          return this.push(this.end);\n        }\n      }\n    },\n    schedule: function () {\n      var _this6 = this;\n\n      if (!this.scheduled) {\n        return this.scheduled = delay(function () {\n          return _this6.flush();\n        });\n      }\n    }\n  };\n  var reply = Bacon.more;\n  if (!_.isFunction(delay)) {\n    var delayMs = delay;\n    delay = function (f) {\n      return Bacon.scheduler.setTimeout(f, delayMs);\n    };\n  }\n  return withDesc(new Bacon.Desc(this, \"buffer\", []), this.withHandler(function (event) {\n    var _this7 = this;\n\n    buffer.push = function (event) {\n      return _this7.push(event);\n    };\n    if (event.isError()) {\n      reply = this.push(event);\n    } else if (event.isEnd()) {\n      buffer.end = event;\n      if (!buffer.scheduled) {\n        buffer.flush();\n      }\n    } else {\n      buffer.values.push(event.value());\n\n      onInput(buffer);\n    }\n    return reply;\n  }));\n};\n\nBacon.Observable.prototype.filter = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len10 = arguments.length, args = Array(_len10 > 1 ? _len10 - 1 : 0), _key10 = 1; _key10 < _len10; _key10++) {\n    args[_key10 - 1] = arguments[_key10];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"filter\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.once = function (value) {\n  return new EventStream(new Desc(Bacon, \"once\", [value]), function (sink) {\n    sink(toEvent(value));\n    sink(endEvent());\n    return nop;\n  });\n};\n\nBacon.EventStream.prototype.concat = function (right) {\n  var left = this;\n  return new EventStream(new Bacon.Desc(left, \"concat\", [right]), function (sink) {\n    var unsubRight = nop;\n    var unsubLeft = left.dispatcher.subscribe(function (e) {\n      if (e.isEnd()) {\n        unsubRight = right.toEventStream().dispatcher.subscribe(sink);\n        return unsubRight;\n      } else {\n        return sink(e);\n      }\n    });\n    return function () {\n      return unsubLeft(), unsubRight();\n    };\n  });\n};\n\nBacon.Property.prototype.concat = function (right) {\n  return addPropertyInitValueToStream(this, this.changes().concat(right));\n};\n\nBacon.concatAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"concatAll\", streams), _.fold(_.tail(streams), _.head(streams).toEventStream(), function (a, b) {\n      return a.concat(b);\n    }));\n  } else {\n    return Bacon.never();\n  }\n};\n\nvar addPropertyInitValueToStream = function (property, stream) {\n  var justInitValue = new EventStream(describe(property, \"justInitValue\"), function (sink) {\n    var value = undefined;\n    var unsub = property.dispatcher.subscribe(function (event) {\n      if (!event.isEnd()) {\n        value = event;\n      }\n      return Bacon.noMore;\n    });\n    UpdateBarrier.whenDoneWith(justInitValue, function () {\n      if (typeof value !== \"undefined\" && value !== null) {\n        sink(value);\n      }\n      return sink(endEvent());\n    });\n    return unsub;\n  });\n  return justInitValue.concat(stream).toProperty();\n};\n\nBacon.Observable.prototype.flatMap = function () {\n  return flatMap_(this, makeSpawner(arguments));\n};\n\nBacon.Observable.prototype.flatMapFirst = function () {\n  return flatMap_(this, makeSpawner(arguments), true);\n};\n\nvar makeSpawner = function (args) {\n  if (args.length === 1 && isObservable(args[0])) {\n    return _.always(args[0]);\n  } else {\n    return makeFunctionArgs(args);\n  }\n};\n\nvar makeObservable = function (x) {\n  if (isObservable(x)) {\n    return x;\n  } else {\n    return Bacon.once(x);\n  }\n};\n\nvar flatMap_ = function (root, f, firstOnly, limit) {\n  var rootDep = [root];\n  var childDeps = [];\n  var desc = new Bacon.Desc(root, \"flatMap\" + (firstOnly ? \"First\" : \"\"), [f]);\n  var result = new EventStream(desc, function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var queue = [];\n    var spawn = function (event) {\n      var child = makeObservable(f(event.value()));\n      childDeps.push(child);\n      return composite.add(function (unsubAll, unsubMe) {\n        return child.dispatcher.subscribe(function (event) {\n          if (event.isEnd()) {\n            _.remove(child, childDeps);\n            checkQueue();\n            checkEnd(unsubMe);\n            return Bacon.noMore;\n          } else {\n            if (typeof event !== \"undefined\" && event !== null ? event._isInitial : undefined) {\n              event = event.toNext();\n            }\n            var reply = sink(event);\n            if (reply === Bacon.noMore) {\n              unsubAll();\n            }\n            return reply;\n          }\n        });\n      });\n    };\n    var checkQueue = function () {\n      var event = queue.shift();\n      if (event) {\n        return spawn(event);\n      }\n    };\n    var checkEnd = function (unsub) {\n      unsub();\n      if (composite.empty()) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (__, unsubRoot) {\n      return root.dispatcher.subscribe(function (event) {\n        if (event.isEnd()) {\n          return checkEnd(unsubRoot);\n        } else if (event.isError()) {\n          return sink(event);\n        } else if (firstOnly && composite.count() > 1) {\n          return Bacon.more;\n        } else {\n          if (composite.unsubscribed) {\n            return Bacon.noMore;\n          }\n          if (limit && composite.count() > limit) {\n            return queue.push(event);\n          } else {\n            return spawn(event);\n          }\n        }\n      });\n    });\n    return composite.unsubscribe;\n  });\n  result.internalDeps = function () {\n    if (childDeps.length) {\n      return rootDep.concat(childDeps);\n    } else {\n      return rootDep;\n    }\n  };\n  return result;\n};\n\nBacon.Observable.prototype.flatMapWithConcurrencyLimit = function (limit) {\n  for (var _len11 = arguments.length, args = Array(_len11 > 1 ? _len11 - 1 : 0), _key11 = 1; _key11 < _len11; _key11++) {\n    args[_key11 - 1] = arguments[_key11];\n  }\n\n  var desc = new Bacon.Desc(this, \"flatMapWithConcurrencyLimit\", [limit].concat(args));\n  return withDesc(desc, flatMap_(this, makeSpawner(args), false, limit));\n};\n\nBacon.Observable.prototype.flatMapConcat = function () {\n  var desc = new Bacon.Desc(this, \"flatMapConcat\", Array.prototype.slice.call(arguments, 0));\n  return withDesc(desc, this.flatMapWithConcurrencyLimit.apply(this, [1].concat(_slice.call(arguments))));\n};\n\nBacon.later = function (delay, value) {\n  return withDesc(new Bacon.Desc(Bacon, \"later\", [delay, value]), Bacon.fromBinder(function (sink) {\n    var sender = function () {\n      return sink([value, endEvent()]);\n    };\n    var id = Bacon.scheduler.setTimeout(sender, delay);\n    return function () {\n      return Bacon.scheduler.clearTimeout(id);\n    };\n  }));\n};\n\nBacon.Observable.prototype.bufferingThrottle = function (minimumInterval) {\n  var desc = new Bacon.Desc(this, \"bufferingThrottle\", [minimumInterval]);\n  return withDesc(desc, this.flatMapConcat(function (x) {\n    return Bacon.once(x).concat(Bacon.later(minimumInterval).filter(false));\n  }));\n};\n\nBacon.Property.prototype.bufferingThrottle = function () {\n  return Bacon.Observable.prototype.bufferingThrottle.apply(this, arguments).toProperty();\n};\n\nfunction Bus() {\n  if (!(this instanceof Bus)) {\n    return new Bus();\n  }\n\n  this.unsubAll = _.bind(this.unsubAll, this);\n  this.subscribeAll = _.bind(this.subscribeAll, this);\n  this.guardedSink = _.bind(this.guardedSink, this);\n\n  this.sink = undefined;\n  this.subscriptions = [];\n  this.ended = false;\n  EventStream.call(this, new Bacon.Desc(Bacon, \"Bus\", []), this.subscribeAll);\n}\n\ninherit(Bus, EventStream);\nextend(Bus.prototype, {\n  unsubAll: function () {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (typeof sub.unsub === \"function\") {\n        sub.unsub();\n      }\n    }\n  },\n\n  subscribeAll: function (newSink) {\n    if (this.ended) {\n      newSink(endEvent());\n    } else {\n      this.sink = newSink;\n      var iterable = cloneArray(this.subscriptions);\n      for (var i = 0, subscription; i < iterable.length; i++) {\n        subscription = iterable[i];\n        this.subscribeInput(subscription);\n      }\n    }\n    return this.unsubAll;\n  },\n\n  guardedSink: function (input) {\n    var _this8 = this;\n\n    return function (event) {\n      if (event.isEnd()) {\n        _this8.unsubscribeInput(input);\n        return Bacon.noMore;\n      } else {\n        return _this8.sink(event);\n      }\n    };\n  },\n\n  subscribeInput: function (subscription) {\n    subscription.unsub = subscription.input.dispatcher.subscribe(this.guardedSink(subscription.input));\n    return subscription.unsub;\n  },\n\n  unsubscribeInput: function (input) {\n    var iterable = this.subscriptions;\n    for (var i = 0, sub; i < iterable.length; i++) {\n      sub = iterable[i];\n      if (sub.input === input) {\n        if (typeof sub.unsub === \"function\") {\n          sub.unsub();\n        }\n        this.subscriptions.splice(i, 1);\n        return;\n      }\n    }\n  },\n\n  plug: function (input) {\n    var _this9 = this;\n\n    assertObservable(input);\n    if (this.ended) {\n      return;\n    }\n    var sub = { input: input };\n    this.subscriptions.push(sub);\n    if (typeof this.sink !== \"undefined\") {\n      this.subscribeInput(sub);\n    }\n    return function () {\n      return _this9.unsubscribeInput(input);\n    };\n  },\n\n  end: function () {\n    this.ended = true;\n    this.unsubAll();\n    if (typeof this.sink === \"function\") {\n      return this.sink(endEvent());\n    }\n  },\n\n  push: function (value) {\n    if (!this.ended && typeof this.sink === \"function\") {\n      var rootPush = !this.pushing;\n      if (!rootPush) {\n        if (!this.pushQueue) this.pushQueue = [];\n        this.pushQueue.push(value);\n\n        return;\n      }\n      this.pushing = true;\n      try {\n        return this.sink(nextEvent(value));\n      } finally {\n        if (rootPush && this.pushQueue) {\n          var i = 0;\n          while (i < this.pushQueue.length) {\n            var value = this.pushQueue[i];\n            this.sink(nextEvent(value));\n            i++;\n          }\n          this.pushQueue = null;\n        }\n        this.pushing = false;\n      }\n    }\n  },\n\n  error: function (error) {\n    if (typeof this.sink === \"function\") {\n      return this.sink(new Error(error));\n    }\n  }\n});\n\nBacon.Bus = Bus;\n\nvar liftCallback = function (desc, wrapped) {\n  return withMethodCallSupport(function (f) {\n    var stream = partiallyApplied(wrapped, [function (values, callback) {\n      return f.apply(undefined, values.concat([callback]));\n    }]);\n\n    for (var _len12 = arguments.length, args = Array(_len12 > 1 ? _len12 - 1 : 0), _key12 = 1; _key12 < _len12; _key12++) {\n      args[_key12 - 1] = arguments[_key12];\n    }\n\n    return withDesc(new Bacon.Desc(Bacon, desc, [f].concat(args)), Bacon.combineAsArray(args).flatMap(stream));\n  });\n};\n\nBacon.fromCallback = liftCallback(\"fromCallback\", function (f) {\n  for (var _len13 = arguments.length, args = Array(_len13 > 1 ? _len13 - 1 : 0), _key13 = 1; _key13 < _len13; _key13++) {\n    args[_key13 - 1] = arguments[_key13];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (value) {\n    return [value, endEvent()];\n  });\n});\n\nBacon.fromNodeCallback = liftCallback(\"fromNodeCallback\", function (f) {\n  for (var _len14 = arguments.length, args = Array(_len14 > 1 ? _len14 - 1 : 0), _key14 = 1; _key14 < _len14; _key14++) {\n    args[_key14 - 1] = arguments[_key14];\n  }\n\n  return Bacon.fromBinder(function (handler) {\n    makeFunction(f, args)(handler);\n    return nop;\n  }, function (error, value) {\n    if (error) {\n      return [new Error(error), endEvent()];\n    }\n    return [value, endEvent()];\n  });\n});\n\nBacon.combineTemplate = function (template) {\n  function current(ctxStack) {\n    return ctxStack[ctxStack.length - 1];\n  }\n  function setValue(ctxStack, key, value) {\n    current(ctxStack)[key] = value;\n    return value;\n  }\n  function applyStreamValue(key, index) {\n    return function (ctxStack, values) {\n      setValue(ctxStack, key, values[index]);\n    };\n  }\n  function constantValue(key, value) {\n    return function (ctxStack) {\n      setValue(ctxStack, key, value);\n    };\n  }\n\n  function mkContext(template) {\n    return isArray(template) ? [] : {};\n  }\n\n  function pushContext(key, value) {\n    return function (ctxStack) {\n      var newContext = mkContext(value);\n      setValue(ctxStack, key, newContext);\n      ctxStack.push(newContext);\n    };\n  }\n\n  function containsObservables(value) {\n    if (isObservable(value)) {\n      return true;\n    } else if (value && (value.constructor == Object || value.constructor == Array)) {\n      for (var key in value) {\n        if (Object.prototype.hasOwnProperty.call(value, key)) {\n          var child = value[key];\n          if (containsObservables(child)) return true;\n        }\n      }\n    }\n  }\n\n  function compile(key, value) {\n    if (isObservable(value)) {\n      streams.push(value);\n      funcs.push(applyStreamValue(key, streams.length - 1));\n    } else if (containsObservables(value)) {\n      var popContext = function (ctxStack) {\n        ctxStack.pop();\n      };\n      funcs.push(pushContext(key, value));\n      compileTemplate(value);\n      funcs.push(popContext);\n    } else {\n      funcs.push(constantValue(key, value));\n    }\n  }\n\n  function combinator(values) {\n    var rootContext = mkContext(template);\n    var ctxStack = [rootContext];\n    for (var i = 0, f; i < funcs.length; i++) {\n      f = funcs[i];\n      f(ctxStack, values);\n    }\n    return rootContext;\n  }\n\n  function compileTemplate(template) {\n    _.each(template, compile);\n  }\n\n  var funcs = [];\n  var streams = [];\n\n  var resultProperty = containsObservables(template) ? (compileTemplate(template), Bacon.combineAsArray(streams).map(combinator)) : Bacon.constant(template);\n\n  return withDesc(new Bacon.Desc(Bacon, \"combineTemplate\", [template]), resultProperty);\n};\n\nBacon.Observable.prototype.mapEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      this.push(nextEvent(f(event)));\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.skipErrors = function () {\n  return withDesc(new Bacon.Desc(this, \"skipErrors\", []), this.withHandler(function (event) {\n    if (event.isError()) {\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.takeUntil = function (stopper) {\n  var endMarker = {};\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), Bacon.groupSimultaneous(this.mapEnd(endMarker), stopper.skipErrors()).withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      var _event$value = event.value();\n\n      var data = _event$value[0];\n      var stopper = _event$value[1];\n\n      if (stopper.length) {\n        return this.push(endEvent());\n      } else {\n        var reply = Bacon.more;\n        for (var i = 0, value; i < data.length; i++) {\n          value = data[i];\n          if (value === endMarker) {\n            reply = this.push(endEvent());\n          } else {\n            reply = this.push(nextEvent(value));\n          }\n        }\n        return reply;\n      }\n    }\n  }));\n};\n\nBacon.Property.prototype.takeUntil = function (stopper) {\n  var changes = this.changes().takeUntil(stopper);\n  return withDesc(new Bacon.Desc(this, \"takeUntil\", [stopper]), addPropertyInitValueToStream(this, changes));\n};\n\nBacon.Observable.prototype.flatMapLatest = function () {\n  var f = makeSpawner(arguments);\n  var stream = this.toEventStream();\n  return withDesc(new Bacon.Desc(this, \"flatMapLatest\", [f]), stream.flatMap(function (value) {\n    return makeObservable(f(value)).takeUntil(stream);\n  }));\n};\n\nBacon.Property.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, addPropertyInitValueToStream(this, f(this.changes())));\n};\n\nBacon.EventStream.prototype.delayChanges = function (desc, f) {\n  return withDesc(desc, f(this));\n};\n\nBacon.Observable.prototype.delay = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"delay\", [delay]), function (changes) {\n    return changes.flatMap(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounce = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounce\", [delay]), function (changes) {\n    return changes.flatMapLatest(function (value) {\n      return Bacon.later(delay, value);\n    });\n  });\n};\n\nBacon.Observable.prototype.debounceImmediate = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"debounceImmediate\", [delay]), function (changes) {\n    return changes.flatMapFirst(function (value) {\n      return Bacon.once(value).concat(Bacon.later(delay).filter(false));\n    });\n  });\n};\n\nBacon.Observable.prototype.decode = function (cases) {\n  return withDesc(new Bacon.Desc(this, \"decode\", [cases]), this.combine(Bacon.combineTemplate(cases), function (key, values) {\n    return values[key];\n  }));\n};\n\nBacon.Observable.prototype.scan = function (seed, f) {\n  var _this10 = this;\n\n  var resultProperty;\n  f = toCombinator(f);\n  var acc = toOption(seed);\n  var initHandled = false;\n  var subscribe = function (sink) {\n    var initSent = false;\n    var unsub = nop;\n    var reply = Bacon.more;\n    var sendInit = function () {\n      if (!initSent) {\n        return acc.forEach(function (value) {\n          initSent = initHandled = true;\n          reply = sink(new Initial(function () {\n            return value;\n          }));\n          if (reply === Bacon.noMore) {\n            unsub();\n            unsub = nop;\n            return unsub;\n          }\n        });\n      }\n    };\n    unsub = _this10.dispatcher.subscribe(function (event) {\n      if (event.hasValue()) {\n        if (initHandled && event.isInitial()) {\n          return Bacon.more;\n        } else {\n            if (!event.isInitial()) {\n              sendInit();\n            }\n            initSent = initHandled = true;\n            var prev = acc.getOrElse(undefined);\n            var next = f(prev, event.value());\n\n            acc = new Some(next);\n            return sink(event.apply(function () {\n              return next;\n            }));\n          }\n      } else {\n        if (event.isEnd()) {\n          reply = sendInit();\n        }\n        if (reply !== Bacon.noMore) {\n          return sink(event);\n        }\n      }\n    });\n    UpdateBarrier.whenDoneWith(resultProperty, sendInit);\n    return unsub;\n  };\n  resultProperty = new Property(new Bacon.Desc(this, \"scan\", [seed, f]), subscribe);\n  return resultProperty;\n};\n\nBacon.Observable.prototype.diff = function (start, f) {\n  f = toCombinator(f);\n  return withDesc(new Bacon.Desc(this, \"diff\", [start, f]), this.scan([start], function (prevTuple, next) {\n    return [next, f(prevTuple[0], next)];\n  }).filter(function (tuple) {\n    return tuple.length === 2;\n  }).map(function (tuple) {\n    return tuple[1];\n  }));\n};\n\nBacon.Observable.prototype.doAction = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doAction\", [f]), this.withHandler(function (event) {\n    if (event.hasValue()) {\n      f(event.value());\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doEnd = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doEnd\", [f]), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      f();\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"doError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      f(event.error);\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.doLog = function () {\n  for (var _len15 = arguments.length, args = Array(_len15), _key15 = 0; _key15 < _len15; _key15++) {\n    args[_key15] = arguments[_key15];\n  }\n\n  return withDesc(new Bacon.Desc(this, \"doLog\", args), this.withHandler(function (event) {\n    if (typeof console !== \"undefined\" && console !== null && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n    return this.push(event);\n  }));\n};\n\nBacon.Observable.prototype.endOnError = function (f) {\n  if (!(typeof f !== \"undefined\" && f !== null)) {\n    f = true;\n  }\n\n  for (var _len16 = arguments.length, args = Array(_len16 > 1 ? _len16 - 1 : 0), _key16 = 1; _key16 < _len16; _key16++) {\n    args[_key16 - 1] = arguments[_key16];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"endOnError\", []), this.withHandler(function (event) {\n      if (event.isError() && f(event.error)) {\n        this.push(event);\n        return this.push(endEvent());\n      } else {\n        return this.push(event);\n      }\n    }));\n  });\n};\n\nObservable.prototype.errors = function () {\n  return withDesc(new Bacon.Desc(this, \"errors\", []), this.filter(function () {\n    return false;\n  }));\n};\n\nBacon.Observable.prototype.take = function (count) {\n  if (count <= 0) {\n    return Bacon.never();\n  }\n  return withDesc(new Bacon.Desc(this, \"take\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else {\n      count--;\n      if (count > 0) {\n        return this.push(event);\n      } else {\n        if (count === 0) {\n          this.push(event);\n        }\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }\n  }));\n};\n\nBacon.Observable.prototype.first = function () {\n  return withDesc(new Bacon.Desc(this, \"first\", []), this.take(1));\n};\n\nBacon.Observable.prototype.mapError = function () {\n  var f = makeFunctionArgs(arguments);\n  return withDesc(new Bacon.Desc(this, \"mapError\", [f]), this.withHandler(function (event) {\n    if (event.isError()) {\n      return this.push(nextEvent(f(event.error)));\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.Observable.prototype.flatMapError = function (fn) {\n  var desc = new Bacon.Desc(this, \"flatMapError\", [fn]);\n  return withDesc(desc, this.mapError(function (err) {\n    return new Error(err);\n  }).flatMap(function (x) {\n    if (x instanceof Error) {\n      return fn(x.error);\n    } else {\n      return Bacon.once(x);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.flatScan = function (seed, f) {\n  var current = seed;\n  return this.flatMapConcat(function (next) {\n    return makeObservable(f(current, next)).doAction(function (updated) {\n      return current = updated;\n    });\n  }).toProperty(seed);\n};\n\nBacon.EventStream.prototype.sampledBy = function (sampler, combinator) {\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), this.toProperty().sampledBy(sampler, combinator));\n};\n\nBacon.Property.prototype.sampledBy = function (sampler, combinator) {\n  var lazy = false;\n  if (typeof combinator !== \"undefined\" && combinator !== null) {\n    combinator = toCombinator(combinator);\n  } else {\n    lazy = true;\n    combinator = function (f) {\n      return f.value();\n    };\n  }\n  var thisSource = new Source(this, false, lazy);\n  var samplerSource = new Source(sampler, true, lazy);\n  var stream = Bacon.when([thisSource, samplerSource], combinator);\n  var result = sampler._isProperty ? stream.toProperty() : stream;\n  return withDesc(new Bacon.Desc(this, \"sampledBy\", [sampler, combinator]), result);\n};\n\nBacon.Property.prototype.sample = function (interval) {\n  return withDesc(new Bacon.Desc(this, \"sample\", [interval]), this.sampledBy(Bacon.interval(interval, {})));\n};\n\nBacon.Observable.prototype.map = function (p) {\n  if (p && p._isProperty) {\n    return p.sampledBy(this, former);\n  } else {\n    for (var _len17 = arguments.length, args = Array(_len17 > 1 ? _len17 - 1 : 0), _key17 = 1; _key17 < _len17; _key17++) {\n      args[_key17 - 1] = arguments[_key17];\n    }\n\n    return convertArgsToFunction(this, p, args, function (f) {\n      return withDesc(new Bacon.Desc(this, \"map\", [f]), this.withHandler(function (event) {\n        return this.push(event.fmap(f));\n      }));\n    });\n  }\n};\n\nBacon.Observable.prototype.fold = function (seed, f) {\n  return withDesc(new Bacon.Desc(this, \"fold\", [seed, f]), this.scan(seed, f).sampledBy(this.filter(false).mapEnd().toProperty()));\n};\n\nObservable.prototype.reduce = Observable.prototype.fold;\n\nvar eventMethods = [[\"addEventListener\", \"removeEventListener\"], [\"addListener\", \"removeListener\"], [\"on\", \"off\"], [\"bind\", \"unbind\"]];\n\nvar findHandlerMethods = function (target) {\n  var pair;\n  for (var i = 0; i < eventMethods.length; i++) {\n    pair = eventMethods[i];\n    var methodPair = [target[pair[0]], target[pair[1]]];\n    if (methodPair[0] && methodPair[1]) {\n      return methodPair;\n    }\n  }\n  for (var j = 0; j < eventMethods.length; j++) {\n    pair = eventMethods[j];\n    var addListener = target[pair[0]];\n    if (addListener) {\n      return [addListener, function () {}];\n    }\n  }\n  throw new Error(\"No suitable event methods in \" + target);\n};\n\nBacon.fromEventTarget = function (target, eventName, eventTransformer) {\n  var _findHandlerMethods = findHandlerMethods(target);\n\n  var sub = _findHandlerMethods[0];\n  var unsub = _findHandlerMethods[1];\n\n  var desc = new Bacon.Desc(Bacon, \"fromEvent\", [target, eventName]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    sub.call(target, eventName, handler);\n    return function () {\n      return unsub.call(target, eventName, handler);\n    };\n  }, eventTransformer));\n};\n\nBacon.fromEvent = Bacon.fromEventTarget;\n\nBacon.fromPoll = function (delay, poll) {\n  var desc = new Bacon.Desc(Bacon, \"fromPoll\", [delay, poll]);\n  return withDesc(desc, Bacon.fromBinder(function (handler) {\n    var id = Bacon.scheduler.setInterval(handler, delay);\n    return function () {\n      return Bacon.scheduler.clearInterval(id);\n    };\n  }, poll));\n};\n\nfunction valueAndEnd(value) {\n  return [value, endEvent()];\n}\n\nBacon.fromPromise = function (promise, abort) {\n  var eventTransformer = arguments.length <= 2 || arguments[2] === undefined ? valueAndEnd : arguments[2];\n\n  return withDesc(new Bacon.Desc(Bacon, \"fromPromise\", [promise]), Bacon.fromBinder(function (handler) {\n    var bound = promise.then(handler, function (e) {\n      return handler(new Error(e));\n    });\n    if (bound && typeof bound.done === \"function\") {\n      bound.done();\n    }\n\n    if (abort) {\n      return function () {\n        if (typeof promise.abort === \"function\") {\n          return promise.abort();\n        }\n      };\n    } else {\n      return function () {};\n    }\n  }, eventTransformer));\n};\n\nBacon.Observable.prototype.groupBy = function (keyF) {\n  var limitF = arguments.length <= 1 || arguments[1] === undefined ? Bacon._.id : arguments[1];\n\n  var streams = {};\n  var src = this;\n  return src.filter(function (x) {\n    return !streams[keyF(x)];\n  }).map(function (x) {\n    var key = keyF(x);\n    var similar = src.filter(function (x) {\n      return keyF(x) === key;\n    });\n    var data = Bacon.once(x).concat(similar);\n    var limited = limitF(data, x).withHandler(function (event) {\n      this.push(event);\n      if (event.isEnd()) {\n        return delete streams[key];\n      }\n    });\n    streams[key] = limited;\n    return limited;\n  });\n};\n\nBacon.fromArray = function (values) {\n  assertArray(values);\n  if (!values.length) {\n    return withDesc(new Bacon.Desc(Bacon, \"fromArray\", values), Bacon.never());\n  } else {\n    var i = 0;\n    var stream = new EventStream(new Bacon.Desc(Bacon, \"fromArray\", [values]), function (sink) {\n      var unsubd = false;\n      var reply = Bacon.more;\n      var pushing = false;\n      var pushNeeded = false;\n      function push() {\n        pushNeeded = true;\n        if (pushing) {\n          return;\n        }\n        pushing = true;\n        while (pushNeeded) {\n          pushNeeded = false;\n          if (reply !== Bacon.noMore && !unsubd) {\n            var value = values[i++];\n            reply = sink(toEvent(value));\n            if (reply !== Bacon.noMore) {\n              if (i === values.length) {\n                sink(endEvent());\n              } else {\n                UpdateBarrier.afterTransaction(stream, push);\n              }\n            }\n          }\n        }\n        pushing = false;\n        return pushing;\n      };\n\n      push();\n      return function () {\n        unsubd = true;\n        return unsubd;\n      };\n    });\n    return stream;\n  }\n};\n\nBacon.EventStream.prototype.holdWhen = function (valve) {\n  var onHold = false;\n  var bufferedValues = [];\n  var src = this;\n  var srcIsEnded = false;\n  return new EventStream(new Bacon.Desc(this, \"holdWhen\", [valve]), function (sink) {\n    var composite = new CompositeUnsubscribe();\n    var subscribed = false;\n    var endIfBothEnded = function (unsub) {\n      if (typeof unsub === \"function\") {\n        unsub();\n      }\n      if (composite.empty() && subscribed) {\n        return sink(endEvent());\n      }\n    };\n    composite.add(function (unsubAll, unsubMe) {\n      return valve.subscribeInternal(function (event) {\n        if (event.hasValue()) {\n          onHold = event.value();\n          if (!onHold) {\n            var toSend = bufferedValues;\n            bufferedValues = [];\n            return (function () {\n              var result = [];\n              for (var i = 0, value; i < toSend.length; i++) {\n                value = toSend[i];\n                result.push(sink(nextEvent(value)));\n              }\n              if (srcIsEnded) {\n                result.push(sink(endEvent()));\n                unsubMe();\n              }\n              return result;\n            })();\n          }\n        } else if (event.isEnd()) {\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    composite.add(function (unsubAll, unsubMe) {\n      return src.subscribeInternal(function (event) {\n        if (onHold && event.hasValue()) {\n          return bufferedValues.push(event.value());\n        } else if (event.isEnd() && bufferedValues.length) {\n          srcIsEnded = true;\n          return endIfBothEnded(unsubMe);\n        } else {\n          return sink(event);\n        }\n      });\n    });\n    subscribed = true;\n    endIfBothEnded();\n    return composite.unsubscribe;\n  });\n};\n\nBacon.interval = function (delay) {\n  var value = arguments.length <= 1 || arguments[1] === undefined ? {} : arguments[1];\n\n  return withDesc(new Bacon.Desc(Bacon, \"interval\", [delay, value]), Bacon.fromPoll(delay, function () {\n    return nextEvent(value);\n  }));\n};\n\nBacon.$ = {};\nBacon.$.asEventStream = function (eventName, selector, eventTransformer) {\n  var _this11 = this;\n\n  if (_.isFunction(selector)) {\n    eventTransformer = selector;\n    selector = undefined;\n  }\n\n  return withDesc(new Bacon.Desc(this.selector || this, \"asEventStream\", [eventName]), Bacon.fromBinder(function (handler) {\n    _this11.on(eventName, selector, handler);\n    return function () {\n      return _this11.off(eventName, selector, handler);\n    };\n  }, eventTransformer));\n};\n\nif (typeof jQuery !== \"undefined\" && jQuery) {\n  jQuery.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nif (typeof Zepto !== \"undefined\" && Zepto) {\n  Zepto.fn.asEventStream = Bacon.$.asEventStream;\n}\n\nBacon.Observable.prototype.last = function () {\n  var lastEvent;\n\n  return withDesc(new Bacon.Desc(this, \"last\", []), this.withHandler(function (event) {\n    if (event.isEnd()) {\n      if (lastEvent) {\n        this.push(lastEvent);\n      }\n      this.push(endEvent());\n      return Bacon.noMore;\n    } else {\n      lastEvent = event;\n    }\n  }));\n};\n\nBacon.Observable.prototype.log = function () {\n  for (var _len18 = arguments.length, args = Array(_len18), _key18 = 0; _key18 < _len18; _key18++) {\n    args[_key18] = arguments[_key18];\n  }\n\n  this.subscribe(function (event) {\n    if (typeof console !== \"undefined\" && typeof console.log === \"function\") {\n      console.log.apply(console, args.concat([event.log()]));\n    }\n  });\n  return this;\n};\n\nBacon.EventStream.prototype.merge = function (right) {\n  assertEventStream(right);\n  var left = this;\n  return withDesc(new Bacon.Desc(left, \"merge\", [right]), Bacon.mergeAll(this, right));\n};\n\nBacon.mergeAll = function () {\n  var streams = argumentsToObservables(arguments);\n  if (streams.length) {\n    return new EventStream(new Bacon.Desc(Bacon, \"mergeAll\", streams), function (sink) {\n      var ends = 0;\n      var smartSink = function (obs) {\n        return function (unsubBoth) {\n          return obs.dispatcher.subscribe(function (event) {\n            if (event.isEnd()) {\n              ends++;\n              if (ends === streams.length) {\n                return sink(endEvent());\n              } else {\n                return Bacon.more;\n              }\n            } else {\n              var reply = sink(event);\n              if (reply === Bacon.noMore) {\n                unsubBoth();\n              }\n              return reply;\n            }\n          });\n        };\n      };\n      var sinks = _.map(smartSink, streams);\n      return new Bacon.CompositeUnsubscribe(sinks).unsubscribe;\n    });\n  } else {\n    return Bacon.never();\n  }\n};\n\nBacon.repeatedly = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"repeatedly\", [delay, values]), Bacon.fromPoll(delay, function () {\n    return values[index++ % values.length];\n  }));\n};\n\nBacon.repeat = function (generator) {\n  var index = 0;\n  return Bacon.fromBinder(function (sink) {\n    var flag = false;\n    var reply = Bacon.more;\n    var unsub = function () {};\n    function handleEvent(event) {\n      if (event.isEnd()) {\n        if (!flag) {\n          return flag = true;\n        } else {\n          return subscribeNext();\n        }\n      } else {\n        return reply = sink(event);\n      }\n    };\n    function subscribeNext() {\n      var next;\n      flag = true;\n      while (flag && reply !== Bacon.noMore) {\n        next = generator(index++);\n        flag = false;\n        if (next) {\n          unsub = next.subscribeInternal(handleEvent);\n        } else {\n          sink(endEvent());\n        }\n      }\n      return flag = true;\n    };\n    subscribeNext();\n    return function () {\n      return unsub();\n    };\n  });\n};\n\nBacon.retry = function (options) {\n  if (!_.isFunction(options.source)) {\n    throw new Exception(\"'source' option has to be a function\");\n  }\n  var source = options.source;\n  var retries = options.retries || 0;\n  var retriesDone = 0;\n  var delay = options.delay || function () {\n    return 0;\n  };\n  var isRetryable = options.isRetryable || function () {\n    return true;\n  };\n  var finished = false;\n  var error = null;\n\n  return withDesc(new Bacon.Desc(Bacon, \"retry\", [options]), Bacon.repeat(function (count) {\n    function valueStream() {\n      return source(count).endOnError().withHandler(function (event) {\n        if (event.isError()) {\n          error = event;\n          if (!(isRetryable(error.error) && (retries === 0 || retriesDone < retries))) {\n            finished = true;\n            return this.push(event);\n          }\n        } else {\n          if (event.hasValue()) {\n            error = null;\n            finished = true;\n          }\n          return this.push(event);\n        }\n      });\n    }\n\n    if (finished) {\n      return null;\n    } else if (error) {\n      var context = {\n        error: error.error,\n        retriesDone: retriesDone\n      };\n      var pause = Bacon.later(delay(context)).filter(false);\n      retriesDone++;\n      return pause.concat(Bacon.once().flatMap(valueStream));\n    } else {\n      return valueStream();\n    }\n  }));\n};\n\nBacon.sequentially = function (delay, values) {\n  var index = 0;\n  return withDesc(new Bacon.Desc(Bacon, \"sequentially\", [delay, values]), Bacon.fromPoll(delay, function () {\n    var value = values[index++];\n    if (index < values.length) {\n      return value;\n    } else if (index === values.length) {\n      return [value, endEvent()];\n    } else {\n      return endEvent();\n    }\n  }));\n};\n\nBacon.Observable.prototype.skip = function (count) {\n  return withDesc(new Bacon.Desc(this, \"skip\", [count]), this.withHandler(function (event) {\n    if (!event.hasValue()) {\n      return this.push(event);\n    } else if (count > 0) {\n      count--;\n      return Bacon.more;\n    } else {\n      return this.push(event);\n    }\n  }));\n};\n\nBacon.EventStream.prototype.skipUntil = function (starter) {\n  var started = starter.take(1).map(true).toProperty(false);\n  return withDesc(new Bacon.Desc(this, \"skipUntil\", [starter]), this.filter(started));\n};\n\nBacon.EventStream.prototype.skipWhile = function (f) {\n  assertObservableIsProperty(f);\n  var ok = false;\n\n  for (var _len19 = arguments.length, args = Array(_len19 > 1 ? _len19 - 1 : 0), _key19 = 1; _key19 < _len19; _key19++) {\n    args[_key19 - 1] = arguments[_key19];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"skipWhile\", [f]), this.withHandler(function (event) {\n      if (ok || !event.hasValue() || !f(event.value())) {\n        if (event.hasValue()) {\n          ok = true;\n        }\n        return this.push(event);\n      } else {\n        return Bacon.more;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.slidingWindow = function (n) {\n  var minValues = arguments.length <= 1 || arguments[1] === undefined ? 0 : arguments[1];\n\n  return withDesc(new Bacon.Desc(this, \"slidingWindow\", [n, minValues]), this.scan([], function (window, value) {\n    return window.concat([value]).slice(-n);\n  }).filter(function (values) {\n    return values.length >= minValues;\n  }));\n};\n\nvar spies = [];\nvar registerObs = function (obs) {\n  if (spies.length) {\n    if (!registerObs.running) {\n      try {\n        registerObs.running = true;\n        spies.forEach(function (spy) {\n          spy(obs);\n        });\n      } finally {\n        delete registerObs.running;\n      }\n    }\n  }\n};\n\nBacon.spy = function (spy) {\n  return spies.push(spy);\n};\n\nBacon.Property.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), this.scan(seed, function (prev, next) {\n    return next;\n  }));\n};\n\nBacon.EventStream.prototype.startWith = function (seed) {\n  return withDesc(new Bacon.Desc(this, \"startWith\", [seed]), Bacon.once(seed).concat(this));\n};\n\nBacon.Observable.prototype.takeWhile = function (f) {\n  assertObservableIsProperty(f);\n\n  for (var _len20 = arguments.length, args = Array(_len20 > 1 ? _len20 - 1 : 0), _key20 = 1; _key20 < _len20; _key20++) {\n    args[_key20 - 1] = arguments[_key20];\n  }\n\n  return convertArgsToFunction(this, f, args, function (f) {\n    return withDesc(new Bacon.Desc(this, \"takeWhile\", [f]), this.withHandler(function (event) {\n      if (event.filter(f)) {\n        return this.push(event);\n      } else {\n        this.push(endEvent());\n        return Bacon.noMore;\n      }\n    }));\n  });\n};\n\nBacon.Observable.prototype.throttle = function (delay) {\n  return this.delayChanges(new Bacon.Desc(this, \"throttle\", [delay]), function (changes) {\n    return changes.bufferWithTime(delay).map(function (values) {\n      return values[values.length - 1];\n    });\n  });\n};\n\nObservable.prototype.firstToPromise = function (PromiseCtr) {\n  var _this12 = this;\n\n  if (typeof PromiseCtr !== \"function\") {\n    if (typeof Promise === \"function\") {\n      PromiseCtr = Promise;\n    } else {\n      throw new Exception(\"There isn't default Promise, use shim or parameter\");\n    }\n  }\n\n  return new PromiseCtr(function (resolve, reject) {\n    return _this12.subscribe(function (event) {\n      if (event.hasValue()) {\n        resolve(event.value());\n      }\n      if (event.isError()) {\n        reject(event.error);\n      }\n\n      return Bacon.noMore;\n    });\n  });\n};\n\nObservable.prototype.toPromise = function (PromiseCtr) {\n  return this.last().firstToPromise(PromiseCtr);\n};\n\nBacon[\"try\"] = function (f) {\n  return function (value) {\n    try {\n      return Bacon.once(f(value));\n    } catch (e) {\n      return new Bacon.Error(e);\n    }\n  };\n};\n\nBacon.update = function (initial) {\n  function lateBindFirst(f) {\n    return function () {\n      for (var _len22 = arguments.length, args = Array(_len22), _key22 = 0; _key22 < _len22; _key22++) {\n        args[_key22] = arguments[_key22];\n      }\n\n      return function (i) {\n        return f.apply(undefined, [i].concat(args));\n      };\n    };\n  }\n\n  for (var _len21 = arguments.length, patterns = Array(_len21 > 1 ? _len21 - 1 : 0), _key21 = 1; _key21 < _len21; _key21++) {\n    patterns[_key21 - 1] = arguments[_key21];\n  }\n\n  var i = patterns.length - 1;\n  while (i > 0) {\n    if (!(patterns[i] instanceof Function)) {\n      patterns[i] = _.always(patterns[i]);\n    }\n    patterns[i] = lateBindFirst(patterns[i]);\n    i = i - 2;\n  }\n  return withDesc(new Bacon.Desc(Bacon, \"update\", [initial].concat(patterns)), Bacon.when.apply(Bacon, patterns).scan(initial, function (x, f) {\n    return f(x);\n  }));\n};\n\nBacon.zipAsArray = function () {\n  for (var _len23 = arguments.length, args = Array(_len23), _key23 = 0; _key23 < _len23; _key23++) {\n    args[_key23] = arguments[_key23];\n  }\n\n  var streams = argumentsToObservables(args);\n  return withDesc(new Bacon.Desc(Bacon, \"zipAsArray\", streams), Bacon.zipWith(streams, function () {\n    for (var _len24 = arguments.length, xs = Array(_len24), _key24 = 0; _key24 < _len24; _key24++) {\n      xs[_key24] = arguments[_key24];\n    }\n\n    return xs;\n  }));\n};\n\nBacon.zipWith = function () {\n  for (var _len25 = arguments.length, args = Array(_len25), _key25 = 0; _key25 < _len25; _key25++) {\n    args[_key25] = arguments[_key25];\n  }\n\n  var observablesAndFunction = argumentsToObservablesAndFunction(args);\n  var streams = observablesAndFunction[0];\n  var f = observablesAndFunction[1];\n\n  streams = _.map(function (s) {\n    return s.toEventStream();\n  }, streams);\n  return withDesc(new Bacon.Desc(Bacon, \"zipWith\", [f].concat(streams)), Bacon.when(streams, f));\n};\n\nBacon.Observable.prototype.zip = function (other, f) {\n  return withDesc(new Bacon.Desc(this, \"zip\", [other]), Bacon.zipWith([this, other], f || Array));\n};\n\nfunction ESObservable(observable) {\n  this.observable = observable;\n}\n\nESObservable.prototype.subscribe = function (observerOrOnNext, onError, onComplete) {\n  var observer = typeof observerOrOnNext === 'function' ? { next: observerOrOnNext, error: onError, complete: onComplete } : observerOrOnNext;\n  var subscription = {\n    closed: false,\n    unsubscribe: function () {\n      subscription.closed = true;\n      cancel();\n    }\n  };\n\n  var cancel = this.observable.subscribe(function (event) {\n    if (event.isError()) {\n      if (observer.error) observer.error(event.error);\n      subscription.unsubscribe();\n    } else if (event.isEnd()) {\n      subscription.closed = true;\n      if (observer.complete) observer.complete();\n    } else if (observer.next) {\n      observer.next(event.value());\n    }\n  });\n  return subscription;\n};\n\nESObservable.prototype[symbol('observable')] = function () {\n  return this;\n};\n\nBacon.Observable.prototype.toESObservable = function () {\n  return new ESObservable(this);\n};\n\nBacon.Observable.prototype[symbol('observable')] = Bacon.Observable.prototype.toESObservable;\n\nBacon.fromESObservable = function (_observable) {\n  var observable;\n  if (_observable[symbol(\"observable\")]) {\n    observable = _observable[symbol(\"observable\")]();\n  } else {\n    observable = _observable;\n  }\n\n  var desc = new Bacon.Desc(Bacon, \"fromESObservable\", [observable]);\n  return new Bacon.EventStream(desc, function (sink) {\n    var cancel = observable.subscribe({\n      error: function () {\n        sink(new Bacon.Error());\n        sink(new Bacon.End());\n      },\n      next: function (value) {\n        sink(new Bacon.Next(value, true));\n      },\n      complete: function () {\n        sink(new Bacon.End());\n      }\n    });\n\n    if (cancel.unsubscribe) {\n      return function () {\n        cancel.unsubscribe();\n      };\n    } else {\n      return cancel;\n    }\n  });\n};\n\nif (typeof define !== \"undefined\" && define !== null && define.amd != null) {\n  define([], function () {\n    return Bacon;\n  });\n  if (typeof this !== \"undefined\" && this !== null) {\n    this.Bacon = Bacon;\n  }\n} else if (typeof module !== \"undefined\" && module !== null && module.exports != null) {\n  module.exports = Bacon;\n  Bacon.Bacon = Bacon;\n} else {\n    this.Bacon = Bacon;\n  }\n}).call(this);\n","export default readBlob\n\n// Reads the blob as a specified type. The blob will not actually be read\n// unless the ``as()`` method is called.\n//\n// .. js:function:: as(type)\n//\n//    Starts reading the blob as ``type``. The ``type`` is a String such as\n//    \"arraybuffer\" or \"text\".\nexport function readBlob(blob) {\n  return {\n    as(type) {\n      return new Promise(function (resolve, reject) {\n        const reader = new FileReader()\n        reader.onload = function () {\n          resolve(reader.result)\n        }\n        reader.onerror = function () {\n          reject(new Error('Unable to read from Blob'))\n        }\n        switch (type) {\n          case 'arraybuffer':\n            reader.readAsArrayBuffer(blob)\n            break\n          case 'text':\n            reader.readAsText(blob)\n            break\n        }\n      })\n    },\n  }\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.assign = exports.values = exports.map = exports.uniq = void 0;\n// A subset of lodash that we actually use.\nvar lodash_uniq_1 = __importDefault(require(\"lodash.uniq\"));\nexports.uniq = lodash_uniq_1.default;\nvar lodash_map_1 = __importDefault(require(\"lodash.map\"));\nexports.map = lodash_map_1.default;\nvar lodash_values_1 = __importDefault(require(\"lodash.values\"));\nexports.values = lodash_values_1.default;\nvar lodash_assign_1 = __importDefault(require(\"lodash.assign\"));\nexports.assign = lodash_assign_1.default;\n//# sourceMappingURL=lodash.js.map","import { BYTES_FORMATTER } from 'bemuse/progress/formatters'\nimport { Progress } from './Progress'\n\n/**\n * Returns a callback that, when called,\n * update the progress with increasing `current` value,\n * out of a fixed `total`.\n */\nexport function fixed(total: number, progress: Progress) {\n  if (!progress) return () => {}\n  let loaded = 0\n  progress.report(0, total)\n  return (extra: any) => progress.report(++loaded, total, extra)\n}\n\n/**\n * Updates the progress with the result of an atomic operation.\n */\nexport async function atomic<T>(\n  progress: Progress,\n  promise: PromiseLike<T>\n): Promise<T> {\n  if (!progress) return promise\n  const data = await Promise.resolve(promise)\n  if (hasByteLength(data)) {\n    progress.formatter = BYTES_FORMATTER\n    progress.report(data.byteLength, data.byteLength)\n  } else {\n    progress.report(1, 1)\n  }\n  return data\n}\nfunction hasByteLength(data: any): data is { byteLength: number } {\n  return data && data.byteLength\n}\n\n/**\n * Wraps an async function that may be called multiple times.\n * Each call adds to the total, and each async resolution adds to current.\n */\nexport function wrapPromise<A extends any[], R>(\n  progress: Progress,\n  f: (...args: A) => PromiseLike<R>\n): (...args: A) => PromiseLike<R> {\n  let current = 0\n  let total = 0\n  return async function (this: any, ...args: A) {\n    progress.report(current, ++total)\n    const ret = await f.apply(this, args)\n    progress.report(++current, total)\n    return ret\n  }\n}\n\nexport function bind(from: Progress, to: Progress) {\n  return from.watch(() => to.report(from.current!, from.total!, from.extra))\n}\n\n/**\n * Updates the `target` with progress data from multiple sources.\n */\nexport function simultaneous(target: Progress) {\n  const queue: Progress[] = []\n  let current: Progress | undefined\n  let unsubscribe: (() => void) | null = null\n  function update() {\n    if (current) {\n      target.report(current.current!, current.total!, current.extra)\n    }\n    if (queue.length > 0 && (!current || current.progress! >= 1)) {\n      bind(queue.shift()!)\n    }\n  }\n  function bind(progress: Progress) {\n    if (current === progress) {\n      return\n    }\n    if (unsubscribe) {\n      unsubscribe()\n      unsubscribe = null\n    }\n    current = progress\n    if (current) {\n      unsubscribe = current.watch(update)\n    }\n  }\n  return {\n    add(progress: Progress) {\n      queue.push(progress)\n      update()\n    },\n  }\n}\n","\"use strict\";\n/**\n * Public: The `bms` package is a library for working with rhythm game data.\n *\n * Although this librarys name suggests that it is for BMS file format,\n * almost every part can be used standalone.\n *\n * This package contains:\n *\n * - __Modules that reads and parses BMS files:__\n *\n *   - {Reader} reads the BMS file from a {Buffer}, detects the character set\n *     and decodes the buffer using that character set into a {String}.\n *   - {Compiler} reads the BMS source from a {String}, and converts into\n *     {BMSChart}, an internal representation of a BMS notechart.\n *\n * - __Classes for representing a BMS notechart.__\n *   These module stores the data as close to the BMS file format as possible.\n *\n *   Almost no musical interpretation is made.\n *   For example, a BPM change is simply represented using a\n *   BMSObject with `channel` = `03` or `08`.\n *\n *   - {BMSChart} is composed of {BMSHeaders}, {BMSObjects}, and {TimeSignatures}.\n *   - {BMSHeaders} represents the header sentences in a BMS file.\n *   - {BMSObjects} represents the objects in a BMS file.\n *   - {BMSObject} represents a single object.\n *\n * - __Classes that represent different aspects of a notechart.__\n *   Instance of these classes may be created from a {BMSChart},\n *   but they can be used in a standalone manner as well.\n *\n *   This makes this library very flexible,\n *   and able to accommodate different formats of notechart.\n *   For example, see the [bmson](https: *github.com/bemusic/bmson) package.\n *\n *   Its also possible to use these classes in context other than music gaming,\n *   for example, you can use these classes to help building a music player\n *   that requires precise synchronization between beats.\n *\n *   - {TimeSignatures} represents a collection of time signatures\n *     in a musical score, and lets you convert the measure number and fraction\n *     into beat number.\n *   - {Timing} represents the timing information in a musical score,\n *     and provides methods to convert between musical time (beats) and\n *     metric time (seconds).\n *   - {SongInfo} represents the basic song information,\n *     such as title, artist, and genre.\n *   - {Notes} represents the sound objects inside your notechart.\n *   - {Keysounds} represents a mapping between keysound ID and filename.\n *   - {Positioning} represents a mapping between beat and in-game position.\n *     Some rhythm game lets chart author control the amount of scrolling\n *     per beat. In StepMania 5, this is called the scroll segments.\n *   - {Spacing} represents a mapping between beat and note spacing.\n *     Some rhythm game lets chart author change the note spacing (HI-SPEED)\n *     dynamically. In StepMania 5, this is called the speed segments.\n *\n * - __Low-level utility classes:__\n *\n *   - {Speedcore} represents a linear animation.\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Compiler = exports.Reader = void 0;\nvar Reader = __importStar(require(\"./reader\"));\nexports.Reader = Reader;\nvar Compiler = __importStar(require(\"./compiler\"));\nexports.Compiler = Compiler;\n__exportStar(require(\"./reader/types\"), exports);\n__exportStar(require(\"./bms/chart\"), exports);\n__exportStar(require(\"./bms/headers\"), exports);\n__exportStar(require(\"./bms/objects\"), exports);\n__exportStar(require(\"./speedcore\"), exports);\n__exportStar(require(\"./time-signatures\"), exports);\n__exportStar(require(\"./notes\"), exports);\n__exportStar(require(\"./timing\"), exports);\n__exportStar(require(\"./song-info\"), exports);\n__exportStar(require(\"./keysounds\"), exports);\n__exportStar(require(\"./positioning\"), exports);\n__exportStar(require(\"./spacing\"), exports);\n//# sourceMappingURL=index.js.map","module.exports = __webpack_public_path__ + \"build/7d6d69a86d70e4e52079c5ce873435c6.jpg\";","import $ from 'jquery'\n\nexport default function GameScene(display) {\n  return function (container) {\n    const handler = () => false\n    $(window).on('touchstart', handler)\n    showCanvas(display, container)\n    return {\n      teardown() {\n        $(window).off('touchstart', handler)\n      },\n    }\n  }\n}\n\nfunction showCanvas(display, container) {\n  const { view, wrapper } = display\n  const { width, height } = view\n  container.appendChild(wrapper)\n  container.addEventListener('touchstart', disableContextMenu)\n  function disableContextMenu() {\n    container.removeEventListener('touchstart', disableContextMenu)\n    container.addEventListener('contextmenu', (e) => {\n      e.preventDefault()\n    })\n  }\n\n  resize()\n  $(window).on('resize', resize)\n\n  function resize() {\n    const scale = Math.min(\n      window.innerWidth / width,\n      window.innerHeight / height\n    )\n    view.style.width = Math.round(width * scale) + 'px'\n    view.style.height = Math.round(height * scale) + 'px'\n    wrapper.style.width = Math.round(width * scale) + 'px'\n    wrapper.style.height = Math.round(height * scale) + 'px'\n    const yOffset = (window.innerHeight - height * scale) / 2\n    wrapper.style.marginTop = Math.round(yOffset) + 'px'\n  }\n\n  return wrapper\n}\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingScene.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingScene.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingScene.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","var escape = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/url/escape.js\");\nexports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.LoadingScene {\\n  background: url(\" + escape(require(\"bemuse/ui/images/bg/a.jpg\")) + \") center no-repeat;\\n  background-size: cover;\\n}\\n.LoadingSceneinfo {\\n  position: absolute;\\n  top: 40%;\\n  left: 0;\\n  right: 0;\\n  -webkit-transform: translateY(-50%);\\n          transform: translateY(-50%);\\n}\\n.LoadingScene .LoadingSceneSongInfo {\\n  -webkit-animation: loading-scene--loading-scene-song-info--animation 1s ease;\\n          animation: loading-scene--loading-scene-song-info--animation 1s ease;\\n}\\n.LoadingScene .LoadingSceneProgress {\\n  position: absolute;\\n  bottom: 10px;\\n  left: 10px;\\n}\\n.LoadingSceneimage {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n}\\n.LoadingSceneimage img {\\n  width: 100%;\\n  height: 100%;\\n  display: block;\\n  object-fit: cover;\\n  -webkit-animation: loading-scene--eyecatch-fade 0.8s;\\n          animation: loading-scene--eyecatch-fade 0.8s;\\n}\\n.LoadingSceneflash {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  opacity: 0;\\n  pointer-events: none;\\n  background: white;\\n  -webkit-animation: loading-scene--flash-animation 0.8s ease-out;\\n          animation: loading-scene--flash-animation 0.8s ease-out;\\n}\\n.LoadingScenecover {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  opacity: 0;\\n  pointer-events: none;\\n  background: black;\\n}\\n.Scene.is-exiting .LoadingSceneinfo {\\n  -webkit-animation: loading-scene--info-exit 0.3s linear;\\n          animation: loading-scene--info-exit 0.3s linear;\\n}\\n.Scene.is-exiting .LoadingSceneflash {\\n  -webkit-animation: loading-scene--flash-exit 0.3s ease;\\n          animation: loading-scene--flash-exit 0.3s ease;\\n}\\n.Scene.is-exiting .LoadingScenecover {\\n  -webkit-animation: loading-scene--cover-exit 0.3s linear;\\n          animation: loading-scene--cover-exit 0.3s linear;\\n  opacity: 1;\\n}\\n\\n@-webkit-keyframes loading-scene--eyecatch-fade {\\n  0% {\\n    opacity: 0;\\n  }\\n  100% {\\n    opacity: 1;\\n  }\\n}\\n\\n@keyframes loading-scene--eyecatch-fade {\\n  0% {\\n    opacity: 0;\\n  }\\n  100% {\\n    opacity: 1;\\n  }\\n}\\n@-webkit-keyframes loading-scene--loading-scene-song-info--animation {\\n  0% {\\n    -webkit-transform: scale(1.5, 0.02);\\n            transform: scale(1.5, 0.02);\\n  }\\n  100% {\\n    -webkit-transform: scale(1, 1);\\n            transform: scale(1, 1);\\n  }\\n}\\n@keyframes loading-scene--loading-scene-song-info--animation {\\n  0% {\\n    -webkit-transform: scale(1.5, 0.02);\\n            transform: scale(1.5, 0.02);\\n  }\\n  100% {\\n    -webkit-transform: scale(1, 1);\\n            transform: scale(1, 1);\\n  }\\n}\\n@-webkit-keyframes loading-scene--info-exit {\\n  0% {\\n    -webkit-transform: translateY(-50%) scale(1, 1);\\n            transform: translateY(-50%) scale(1, 1);\\n  }\\n  100% {\\n    -webkit-transform: translateY(-50%) scale(2, 2);\\n            transform: translateY(-50%) scale(2, 2);\\n  }\\n}\\n@keyframes loading-scene--info-exit {\\n  0% {\\n    -webkit-transform: translateY(-50%) scale(1, 1);\\n            transform: translateY(-50%) scale(1, 1);\\n  }\\n  100% {\\n    -webkit-transform: translateY(-50%) scale(2, 2);\\n            transform: translateY(-50%) scale(2, 2);\\n  }\\n}\\n@-webkit-keyframes loading-scene--cover-exit {\\n  0% {\\n    opacity: 0;\\n  }\\n  100% {\\n    opacity: 1;\\n  }\\n}\\n@keyframes loading-scene--cover-exit {\\n  0% {\\n    opacity: 0;\\n  }\\n  100% {\\n    opacity: 1;\\n  }\\n}\\n@-webkit-keyframes loading-scene--flash-animation {\\n  0% {\\n    opacity: 1;\\n  }\\n  100% {\\n    opacity: 0;\\n  }\\n}\\n@keyframes loading-scene--flash-animation {\\n  0% {\\n    opacity: 1;\\n  }\\n  100% {\\n    opacity: 0;\\n  }\\n}\\n@-webkit-keyframes loading-scene--flash-exit {\\n  0% {\\n    opacity: 0.5;\\n  }\\n  100% {\\n    opacity: 0;\\n  }\\n}\\n@keyframes loading-scene--flash-exit {\\n  0% {\\n    opacity: 0.5;\\n  }\\n  100% {\\n    opacity: 0;\\n  }\\n}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgress.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgress.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgress.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.LoadingSceneProgress {\\n  color: #333;\\n  font-size: 11px;\\n}\\n.LoadingSceneProgress .LoadingSceneProgressBar {\\n  display: inline-block;\\n  vertical-align: middle;\\n  width: 48px;\\n  margin-right: 4px;\\n  position: relative;\\n  top: -1px;\\n}\\n.LoadingSceneProgressextra {\\n  font-size: 83%;\\n  opacity: 0.7;\\n}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgressBar.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgressBar.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneProgressBar.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.LoadingSceneProgressBar {\\n  border: 1px solid rgba(0, 0, 0, 0.6);\\n  padding: 1px;\\n}\\n.LoadingSceneProgressBarbar {\\n  height: 8px;\\n  background: rgba(0, 0, 0, 0.6);\\n  width: 0%;\\n}\", \"\"]);\n\n// exports\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneSongInfo.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneSongInfo.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./LoadingSceneSongInfo.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \"@charset \\\"UTF-8\\\";\\n.LoadingSceneSongInfo {\\n  background: rgba(255, 255, 255, 0.96);\\n  color: #191817;\\n  text-align: center;\\n  padding: 25px 0px;\\n  box-shadow: 0 2px 18px rgba(0, 0, 0, 0.2);\\n}\\n.LoadingSceneSongInfogenre {\\n  font-size: 1.2rem;\\n}\\n.LoadingSceneSongInfotitle {\\n  font-size: 3.2rem;\\n  font-weight: bold;\\n}\\n.LoadingSceneSongInfosubtitle {\\n  font-size: 2.4rem;\\n}\\n.LoadingSceneSongInfoartist {\\n  font-size: 1.6rem;\\n  margin-top: 0.8ex;\\n}\\n.LoadingSceneSongInfosubartist {\\n  font-size: 1rem;\\n}\", \"\"]);\n\n// exports\n","import delay from 'delay'\nimport { BYTES_FORMATTER } from 'bemuse/progress/formatters'\n\n// Downloads the file from the URL.\n// The download will not actually be started unless the ``as()`` method\n// is called.\n//\n// .. js:function:: as(type)\n//\n//    Initiates the download as ``type``. The ``type`` is a string such as\n//    \"arraybuffer\" or \"blob\".\nexport function download(\n  url,\n  { getRetryDelay = () => 1000 + Math.random() * 4000 } = {}\n) {\n  return {\n    async as(type, progress) {\n      let shouldGiveUp = false\n      for (let i = 1; ; i++) {\n        try {\n          return await attempt()\n        } catch (error) {\n          console.error(`Unable to download ${url} [attempt ${i}]`, error)\n          if (i >= 3 || shouldGiveUp) throw error\n          const waitMs = getRetryDelay()\n          await delay(waitMs)\n        }\n      }\n      function attempt() {\n        return new Promise((resolve, reject) => {\n          const xh = new XMLHttpRequest()\n          xh.open('GET', url, true)\n          xh.responseType = type\n          xh.onload = () => {\n            if (+xh.status === 200) {\n              resolve(xh.response)\n            } else {\n              if (+xh.status === 403 || +xh.status === 404) {\n                shouldGiveUp = true\n              }\n              reject(new Error(`Unable to download ${url}: HTTP ${xh.status}`))\n            }\n          }\n          xh.onerror = () => reject(new Error(`Unable to download ${url}`))\n          if (progress) {\n            progress.formatter = BYTES_FORMATTER\n            xh.onprogress = (e) => progress.report(e.loaded, e.total)\n          }\n          xh.send(null)\n        })\n      }\n    },\n  }\n}\n\nexport default download\n","export default document.querySelector('#scene-root')\n"],"sourceRoot":""}