{"version":3,"file":"build/previewer-15242bfba2353ed81c99.js","mappings":"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","sources":["file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/BemusePreviewer.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/PreviewInfo.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Panel.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/audio-context/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/BemusePreviewer.scss?[contenthash]","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/PreviewCanvas.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/PreviewInfo.scss?[contenthash]","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/PreviewInfo.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/PreviewFileDropHandler.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/NotechartPreview.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/PreviewLoader.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/PreviewState.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/PreviewKeyHandler.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/useLatest.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/BemusePreviewer.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/previewer/index.tsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/sampling-master/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/sampling-master/ogg.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Panel.scss?[contenthash]","file:///home/runner/work/bemuse/bemuse/bemuse/src/ui/Panel.jsx","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/main-element.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/read-blob.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/warp-element.ts","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/index.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/BMSNotechartLoader.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/BmsonNotechartLoader.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/loader/index.js","file:///home/runner/work/bemuse/bemuse/packages/bemuse-notechart/lib/types.js"],"sourcesContent":["// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"@charset \\\"UTF-8\\\";\\n.BemusePreviewer {\\n  position: fixed;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  font-size: 18px;\\n}\\n.BemusePreviewerのheader {\\n  position: absolute;\\n  top: 0;\\n  right: 0;\\n  height: 50px;\\n  left: 0;\\n  background-color: #e34e7a;\\n  color: #fff;\\n  display: flex;\\n  align-items: center;\\n  padding: 0 1em;\\n}\\n.BemusePreviewerのheader > h1 {\\n  margin: 0;\\n  font-size: 20px;\\n  font-weight: normal;\\n}\\n.BemusePreviewerのheader > h1 strong {\\n  font-weight: 600;\\n}\\n.BemusePreviewerのheader > h1 a {\\n  color: inherit;\\n  text-decoration: none;\\n}\\n.BemusePreviewerのmain {\\n  position: absolute;\\n  top: 50px;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  display: flex;\\n  align-items: flex-start;\\n}\\n.BemusePreviewerのloading {\\n  position: absolute;\\n  top: 50px;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  background: rgba(0, 0, 0, 0.5333333333);\\n  color: #fff;\\n  text-align: left;\\n  padding: 2em;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./previewer/BemusePreviewer.scss\"],\"names\":[],\"mappings\":\"AAAA,gBAAgB;AAEhB;EACE,eAAA;EACA,MAAA;EACA,QAAA;EACA,SAAA;EACA,OAAA;EACA,eAAA;AAAF;AAEE;EACE,kBAAA;EACA,MAAA;EACA,QAAA;EACA,YAAA;EACA,OAAA;EACA,yBAAA;EACA,WAAA;EACA,aAAA;EACA,mBAAA;EACA,cAAA;AAAJ;AAGE;EACE,SAAA;EACA,eAAA;EACA,mBAAA;AADJ;AAIE;EACE,gBAAA;AAFJ;AAKE;EACE,cAAA;EACA,qBAAA;AAHJ;AAME;EACE,kBAAA;EACA,SAAA;EACA,QAAA;EACA,SAAA;EACA,OAAA;EACA,aAAA;EACA,uBAAA;AAJJ;AAOE;EACE,kBAAA;EACA,SAAA;EACA,QAAA;EACA,SAAA;EACA,OAAA;EACA,uCAAA;EACA,WAAA;EACA,gBAAA;EACA,YAAA;AALJ\",\"sourcesContent\":[\"@import '~bemuse/ui/common';\\n\\n.BemusePreviewer {\\n  position: fixed;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  font-size: 18px;\\n\\n  &のheader {\\n    position: absolute;\\n    top: 0;\\n    right: 0;\\n    height: 50px;\\n    left: 0;\\n    background-color: #e34e7a;\\n    color: #fff;\\n    display: flex;\\n    align-items: center;\\n    padding: 0 1em;\\n  }\\n\\n  &のheader > h1 {\\n    margin: 0;\\n    font-size: 20px;\\n    font-weight: normal;\\n  }\\n\\n  &のheader > h1 strong {\\n    font-weight: 600;\\n  }\\n\\n  &のheader > h1 a {\\n    color: inherit;\\n    text-decoration: none;\\n  }\\n\\n  &のmain {\\n    position: absolute;\\n    top: 50px;\\n    right: 0;\\n    bottom: 0;\\n    left: 0;\\n    display: flex;\\n    align-items: flex-start;\\n  }\\n\\n  &のloading {\\n    position: absolute;\\n    top: 50px;\\n    right: 0;\\n    bottom: 0;\\n    left: 0;\\n    background: #0008;\\n    color: #fff;\\n    text-align: left;\\n    padding: 2em;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"@charset \\\"UTF-8\\\";\\n.PreviewInfo {\\n  padding: 1em;\\n}\\n.PreviewInfo > h2 {\\n  margin: 0 0 0em;\\n}\\n.PreviewInfoのkeyHints {\\n  color: #8b8685;\\n  font-size: 12px;\\n  line-height: 2;\\n}\\n.PreviewInfoのkeyHints > kbd {\\n  font-family: inherit;\\n  padding: 0.1em 0.2em;\\n  background: #222;\\n  border: 1px solid #333;\\n  border-radius: 4px;\\n  box-shadow: 0 3px 0 #333;\\n  display: inline-block;\\n  line-height: 1;\\n}\\n.PreviewInfo td {\\n  text-align: right;\\n  font-family: Menlo, Consolas, monospace;\\n}\\n.PreviewInfo th {\\n  text-align: left;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./previewer/PreviewInfo.scss\"],\"names\":[],\"mappings\":\"AAAA,gBAAgB;AAAhB;EACE,YAAA;AAEF;AADE;EACE,eAAA;AAGJ;AAAE;EACE,cAAA;EACA,eAAA;EACA,cAAA;AAEJ;AACE;EACE,oBAAA;EACA,oBAAA;EACA,gBAAA;EACA,sBAAA;EACA,kBAAA;EACA,wBAAA;EACA,qBAAA;EACA,cAAA;AACJ;AAEE;EACE,iBAAA;EACA,uCAAA;AAAJ;AAGE;EACE,gBAAA;AADJ\",\"sourcesContent\":[\".PreviewInfo {\\n  padding: 1em;\\n  & > h2 {\\n    margin: 0 0 0em;\\n  }\\n\\n  &のkeyHints {\\n    color: #8b8685;\\n    font-size: 12px;\\n    line-height: 2;\\n  }\\n\\n  &のkeyHints > kbd {\\n    font-family: inherit;\\n    padding: 0.1em 0.2em;\\n    background: #222;\\n    border: 1px solid #333;\\n    border-radius: 4px;\\n    box-shadow: 0 3px 0 #333;\\n    display: inline-block;\\n    line-height: 1;\\n  }\\n\\n  & td {\\n    text-align: right;\\n    font-family: Menlo, Consolas, monospace;\\n  }\\n\\n  & th {\\n    text-align: left;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","// Imports\nimport ___CSS_LOADER_API_SOURCEMAP_IMPORT___ from \"../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/sourceMaps.js\";\nimport ___CSS_LOADER_API_IMPORT___ from \"../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/runtime/api.js\";\nvar ___CSS_LOADER_EXPORT___ = ___CSS_LOADER_API_IMPORT___(___CSS_LOADER_API_SOURCEMAP_IMPORT___);\n// Module\n___CSS_LOADER_EXPORT___.push([module.id, \"@charset \\\"UTF-8\\\";\\n.Panel {\\n  border: 1px solid #151413;\\n  border-radius: 4px 4px 0 0;\\n  box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);\\n  background: #353433;\\n}\\n.Panelのtitle {\\n  background: #252423 linear-gradient(to bottom, #353433 0%, #252423 50%, #151413 50%, #252423 100%);\\n  border-bottom: 0;\\n  text-align: center;\\n  color: #8b8685;\\n  padding: 0.5ex 1em;\\n}\\n.Panelのtitle > h2 {\\n  margin: 0;\\n  font: inherit;\\n}\", \"\",{\"version\":3,\"sources\":[\"webpack://./ui/Panel.scss\"],\"names\":[],\"mappings\":\"AAAA,gBAAgB;AAEhB;EACE,yBAAA;EACA,0BAAA;EACA,yCAAA;EACA,mBAAA;AAAF;AAEE;EACE,kGAAA;EAQA,gBAAA;EACA,kBAAA;EACA,cAAA;EACA,kBAAA;AAPJ;AAUE;EACE,SAAA;EACA,aAAA;AARJ\",\"sourcesContent\":[\"@import '~bemuse/ui/common';\\n\\n.Panel {\\n  border: 1px solid #151413;\\n  border-radius: 4px 4px 0 0;\\n  box-shadow: 0 2px 20px rgba(black, 0.3);\\n  background: #353433;\\n\\n  &のtitle {\\n    background: #252423\\n      linear-gradient(\\n        to bottom,\\n        #353433 0%,\\n        #252423 50%,\\n        #151413 50%,\\n        #252423 100%\\n      );\\n    border-bottom: 0;\\n    text-align: center;\\n    color: #8b8685;\\n    padding: 0.5ex 1em;\\n  }\\n\\n  &のtitle > h2 {\\n    margin: 0;\\n    font: inherit;\\n  }\\n}\\n\"],\"sourceRoot\":\"\"}]);\n// Exports\nexport default ___CSS_LOADER_EXPORT___;\n","export default new AudioContext({\n  latencyHint: 'interactive',\n})\n","\n      import API from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./BemusePreviewer.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./BemusePreviewer.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import _ from 'lodash'\nimport React, { useEffect, useMemo } from 'react'\nimport { NotechartPreview } from './NotechartPreview'\nimport { PreviewState } from './PreviewState'\n\nexport type PreviewColumn = {\n  x: number\n  width: number\n  column: string | null\n  sprite?: PreviewNoteSprite\n}\n\nexport type PreviewNoteSprite = {\n  x: number\n  width: number\n  highlight?: boolean\n}\n\nconst sprites = {\n  scratch: { x: 0, width: 61 },\n  white: { x: 62, width: 34, highlight: true },\n  blue: { x: 97, width: 26 },\n  green: { x: 159, width: 26 },\n}\n\nclass PreviewLayout {\n  columns: PreviewColumn[]\n  totalWidth: number\n  columnMapping: Record<string, PreviewColumn>\n  constructor(keymap: string) {\n    let nextX = 0\n    const column = (width: number, name: string | null): PreviewColumn => {\n      const x = nextX\n      nextX += width + 1\n      return { x, width, column: name }\n    }\n    const noteColumn = (\n      sprite: PreviewNoteSprite,\n      name: string\n    ): PreviewColumn => {\n      return { ...column(sprite.width, name), sprite }\n    }\n    this.columns = keymap.split(' ').map((c) => {\n      if (c === '-') return column(72, null)\n      if (c.endsWith('s')) return noteColumn(sprites.scratch, c.slice(0, -1))\n      if (c.endsWith('b')) return noteColumn(sprites.blue, c.slice(0, -1))\n      if (c.endsWith('g')) return noteColumn(sprites.green, c.slice(0, -1))\n      return noteColumn(sprites.white, c)\n    })\n    this.totalWidth = nextX\n    this.columnMapping = _.fromPairs(\n      this.columns.filter((c) => c.column != null).map((c) => [c.column, c])\n    )\n  }\n}\n\nexport interface PreviewCanvas {\n  previewState: PreviewState\n  notechartPreview: NotechartPreview\n}\n\nexport const PreviewCanvas: FC<PreviewCanvas> = (props) => {\n  const keymap = 'SCs 1 2b 3 4g 5 6b 7 - 8 9b 10 11g 12 13b 14 SC2s'\n  const notesImage = useImage('/skins/default/Note/DX/Note.png')\n  const landmineImage = useImage('/skins/default/Note/DX/Landmine.png')\n  const canvasRef = React.useRef<HTMLCanvasElement>(null)\n\n  const layout = useMemo(() => new PreviewLayout(keymap), [keymap])\n  const width = layout.totalWidth + 1\n  const height = 468\n\n  const viewport = useMemo(() => {\n    return props.notechartPreview.getViewport(\n      props.previewState.currentTime,\n      props.previewState.hiSpeed\n    )\n  }, [\n    props.notechartPreview,\n    props.previewState.currentTime,\n    props.previewState.hiSpeed,\n  ])\n\n  const maxCombo = props.notechartPreview.getMaxCombo()\n\n  const comboInfo = useMemo(() => {\n    return props.notechartPreview.getComboInfo(props.previewState.currentTime)\n  }, [props.notechartPreview, props.previewState.currentTime])\n\n  useEffect(() => {\n    const ctx = canvasRef.current?.getContext('2d')\n    if (!ctx) return\n\n    // background\n    ctx.fillStyle = '#000'\n    ctx.fillRect(0, 0, width, height)\n\n    // lines\n    for (const column of layout.columns) {\n      ctx.fillStyle = '#555'\n      ctx.fillRect(column.x, 0, 1, height)\n      if (column.sprite?.highlight) {\n        ctx.fillStyle = '#111'\n        ctx.fillRect(column.x + 1, 0, column.width, height)\n      }\n    }\n    ctx.fillStyle = '#555'\n    ctx.fillRect(layout.totalWidth, 0, 1, height)\n\n    ctx.textAlign = 'center'\n    ctx.font = 'bold 18px sans-serif'\n    for (const barLine of viewport.visibleBarLines) {\n      const y = Math.round(height - barLine.y * height)\n      ctx.fillRect(0, y - 1, layout.totalWidth, 1)\n      ctx.fillText('#' + barLine.measureNumber, layout.totalWidth / 2, y - 4)\n    }\n\n    if (notesImage && landmineImage) {\n      for (const note of viewport.visibleNotes) {\n        const column = layout.columnMapping[note.gameEvent.column]\n        if (column?.sprite) {\n          const y = Math.round(height - note.y * height)\n          if (note.long) {\n            const endY = Math.round(height - note.long.endY * height)\n            const spriteYOffset = note.long.active ? 100 : 0\n            ctx.drawImage(\n              notesImage,\n              column.sprite.x,\n              104 + spriteYOffset,\n              column.width,\n              8,\n              column.x + 1,\n              y - 8,\n              column.width,\n              8\n            )\n            ctx.drawImage(\n              notesImage,\n              column.sprite.x,\n              12 + spriteYOffset,\n              column.width,\n              8,\n              column.x + 1,\n              endY - 12,\n              column.width,\n              8\n            )\n            const noteHeight = y - endY - 4\n            if (noteHeight > 0) {\n              ctx.drawImage(\n                notesImage,\n                column.sprite.x,\n                22 + spriteYOffset,\n                column.width,\n                64,\n                column.x + 1,\n                endY - 4,\n                column.width,\n                noteHeight\n              )\n            }\n          } else {\n            const image = note.type === 'landmine' ? landmineImage : notesImage\n            ctx.drawImage(\n              image,\n              column.sprite.x,\n              0,\n              column.width,\n              12,\n              column.x + 1,\n              y - 12,\n              column.width,\n              12\n            )\n          }\n        }\n      }\n    }\n\n    if (comboInfo) {\n      const deltaTime = props.previewState.currentTime - comboInfo.comboTime\n      const opacity = Math.max(0, 1 - deltaTime)\n      if (opacity > 0) {\n        ctx.fillStyle = 'rgba(255, 255, 255, ' + opacity + ')'\n        ctx.font = 'bold 36px sans-serif'\n        ctx.textAlign = 'center'\n        ctx.fillText(\n          `${comboInfo.comboCount} / ${maxCombo}`,\n          layout.totalWidth / 2,\n          height - 64 - opacity ** 8 * 8\n        )\n      }\n    }\n  }, [\n    width,\n    height,\n    layout,\n    viewport,\n    notesImage,\n    maxCombo,\n    comboInfo,\n    props.previewState.currentTime,\n  ])\n\n  return (\n    <canvas\n      ref={canvasRef}\n      width={width}\n      height={height}\n      style={{\n        imageRendering: 'pixelated',\n      }}\n    />\n  )\n}\n\nfunction useImage(src: string) {\n  const [image, setImage] = React.useState<HTMLImageElement | null>(null)\n  useEffect(() => {\n    const img = new Image()\n    img.src = src\n    img.onload = () => setImage(img)\n    return () => {\n      img.onload = null\n    }\n  }, [src])\n  return image\n}\n","\n      import API from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./PreviewInfo.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./PreviewInfo.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import './PreviewInfo.scss'\nimport React, { useMemo } from 'react'\nimport { MeasureInfo, NotechartPreview } from './NotechartPreview'\nimport { PreviewState } from './PreviewState'\nimport { BarDot } from './BarDot'\n\nexport interface PreviewInfo {\n  notechartPreview: NotechartPreview\n  previewState: PreviewState\n}\n\nexport const PreviewInfo: FC<PreviewInfo> = (props) => {\n  const preview = props.notechartPreview\n\n  const measureInfo = useMemo(() => {\n    return props.notechartPreview.getMeasureInfo(props.previewState.currentTime)\n  }, [props.notechartPreview, props.previewState.currentTime])\n  const bpm = useMemo(() => {\n    return props.notechartPreview.getCurrentBpm(props.previewState.currentTime)\n  }, [props.notechartPreview, props.previewState.currentTime])\n  const scroll = useMemo(() => {\n    return props.notechartPreview.getCurrentScroll(\n      props.previewState.currentTime\n    )\n  }, [props.notechartPreview, props.previewState.currentTime])\n  const speed = useMemo(() => {\n    return props.notechartPreview.getCurrentSpeed(\n      props.previewState.currentTime\n    )\n  }, [props.notechartPreview, props.previewState.currentTime])\n  const hiSpeed = props.previewState.hiSpeed\n  const format = (n: number) => n.toFixed(2)\n  const formatTime = (s: number) => {\n    return `${~~(s / 60)}:${(~~s % 60).toString().padStart(2, '0')}`\n  }\n\n  const keyHints = useMemo(\n    () => (\n      <p className='PreviewInfoのkeyHints'>\n        <kbd>Space</kbd> Play/Pause\n        <br />\n        <kbd>Up/Down/Left/Right/,/.</kbd> Seek\n        <br />\n        <kbd>G</kbd> Go To Measure\n        <br />\n        <kbd>1/2</kbd> Hi-Speed\n        <br />\n        <kbd>R</kbd> Reload Chart\n      </p>\n    ),\n    []\n  )\n\n  return (\n    <div className='PreviewInfo'>\n      <h2>{preview.name}</h2>\n      <p>{preview.description}</p>\n      <table>\n        <col width={80} />\n        <col width={120} />\n        <col width={80} />\n        <tbody>\n          <tr>\n            <th scope='row'>Time</th>\n            <td colSpan={2}>\n              {formatTime(props.previewState.currentTime)} /{' '}\n              {formatTime(props.notechartPreview.duration)}\n            </td>\n          </tr>\n          <tr>\n            <th scope='row'>Measure</th>\n            <td colSpan={2}>\n              <BarDots measureInfo={measureInfo} /> #{measureInfo.measureNumber}\n            </td>\n          </tr>\n          <tr>\n            <th scope='row'>#BPM</th>\n            <td />\n            <td>{format(bpm)}</td>\n          </tr>\n          <tr>\n            <th scope='row'>#SCROLL</th>\n            <td>{format(scroll)}x &rarr;</td>\n            <td>{format(bpm * scroll)}</td>\n          </tr>\n          <tr>\n            <th scope='row'>#SPEED</th>\n            <td>{format(speed)}x &rarr;</td>\n            <td>{format(bpm * scroll * speed)}</td>\n          </tr>\n          <tr>\n            <th scope='row'>HI-SPEED</th>\n            <td>{format(hiSpeed)}x &rarr;</td>\n            <td>{format(bpm * scroll * speed * hiSpeed)}</td>\n          </tr>\n        </tbody>\n      </table>\n      {keyHints}\n    </div>\n  )\n}\n\ninterface BarDots {\n  measureInfo: MeasureInfo\n}\n\nconst BarDots: FC<BarDots> = (props) => {\n  const { measureInfo } = props\n  if (!measureInfo.measureEndBeat) return null\n  const measureSize = measureInfo.measureEndBeat - measureInfo.measureStartBeat\n  if (!measureSize) return null\n  let dotCount = measureSize\n  let dotSize = 1\n  while (dotCount >= 8) {\n    dotSize *= 2\n    dotCount /= 2\n  }\n  while (dotCount <= 2) {\n    dotSize /= 2\n    dotCount *= 2\n  }\n  const dots: ReactNode[] = []\n  let filledDots = Math.ceil(\n    (measureInfo.currentBeat - measureInfo.measureStartBeat) / dotSize\n  )\n  while (dotCount > 0) {\n    dots.push(\n      <BarDot\n        key={dots.length}\n        fraction={dotCount > 1 ? 1 : dotCount}\n        fill={filledDots > 0 ? '#e34e7a' : '#333'}\n      />\n    )\n    dotCount--\n    filledDots--\n  }\n  return <>{dots}</>\n}\n","import { showQuickPick } from 'bemuse/ui-dialogs'\nimport { useEffect } from 'react'\n\nexport interface PreviewFileDropHandler {\n  onDrop: (\n    handle: FileSystemDirectoryHandle,\n    selectedChartFilename: string\n  ) => void\n}\n\nexport const PreviewFileDropHandler: FC<PreviewFileDropHandler> = (props) => {\n  useEffect(() => {\n    const onDragOver = (e: DragEvent) => {\n      e.preventDefault()\n    }\n    const onDrop = async (e: DragEvent) => {\n      e.preventDefault()\n      const items = e.dataTransfer!.items\n      if (items.length !== 1) {\n        alert('Please drop only one folder.')\n        return\n      }\n      const item = items[0]\n      if (item.kind !== 'file') {\n        alert('Please drop only a folder here.')\n        return\n      }\n      if (!('getAsFileSystemHandle' in item)) {\n        alert('Unsupported browser (sorry).')\n        return\n      }\n      const handleNullable = await item.getAsFileSystemHandle()\n      if (!handleNullable || handleNullable.kind !== 'directory') {\n        alert('Please drop folder, not a file here.')\n        return\n      }\n      const handle = handleNullable as FileSystemDirectoryHandle\n      await handle.requestPermission({ mode: 'read' })\n      const chartFiles: { filename: string; label: string }[] = []\n      for await (const [name] of handle.entries()) {\n        if (/\\.(bms|bme|bml|bmson)$/i.test(name)) {\n          chartFiles.push({ filename: name, label: name })\n        }\n      }\n      if (chartFiles.length === 0) {\n        alert('No BMS/bmson files found in folder.')\n        return\n      }\n\n      const selectedChartFile = await showQuickPick(chartFiles, {\n        title: 'Select a chart file',\n      })\n      props.onDrop(handle, selectedChartFile.filename)\n    }\n    window.addEventListener('dragover', onDragOver)\n    window.addEventListener('drop', onDrop)\n    return () => {\n      window.removeEventListener('dragover', onDragOver)\n      window.removeEventListener('drop', onDrop)\n    }\n  }, [props.onDrop])\n  return null\n}\n","import Notechart, {\n  GameLandmine,\n  GameNote,\n  SoundedEvent,\n} from 'bemuse-notechart'\nimport SamplingMaster, {\n  PlayInstance,\n  Sample,\n  SoundGroup,\n} from 'bemuse/sampling-master'\nimport _ from 'lodash'\n\nexport interface NotechartPreview {\n  /**\n   * Song’s length in seconds.\n   */\n  duration: number\n\n  name: string\n  description: string\n\n  getViewport(currentTime: number, hiSpeed: number): PreviewViewport\n  getMeasureInfo(currentTime: number): MeasureInfo\n  getCurrentBpm(currentTime: number): number\n  getCurrentScroll(currentTime: number): number\n  getCurrentSpeed(currentTime: number): number\n  play(delegate: NotechartPreviewPlayerDelegate): NotechartPreviewPlayer\n  measureToSeconds(measure: number): number\n  getMeasureJumpTarget(currentTime: number, direction: number): number\n  getComboInfo(currentTime: number): ComboInfo | null\n  getMaxCombo(): number\n}\n\nexport interface PreviewViewport {\n  visibleNotes: VisibleNote[]\n  visibleBarLines: VisibleBarLine[]\n}\n\nexport interface MeasureInfo {\n  currentBeat: number\n  measureNumber: number\n  measureStartBeat: number\n  measureEndBeat?: number\n}\n\nexport interface ComboInfo {\n  comboTime: number\n  comboCount: number\n}\n\nexport interface NotechartPreviewPlayer {\n  stop(): void\n}\n\nexport interface NotechartPreviewPlayerDelegate {\n  startTime: number\n\n  onFinish(): void\n  onTimeUpdate(currentTime: number): void\n}\n\nexport type VisibleNote = {\n  y: number\n  long?: { endY: number; active: boolean }\n  gameEvent: GameNote | GameLandmine\n  type: 'note' | 'landmine'\n}\n\nexport type VisibleBarLine = {\n  y: number\n  measureNumber: number\n}\n\nexport function createNullNotechartPreview(): NotechartPreview {\n  const warning =\n    location.hostname !== 'bemuse.ninja'\n      ? ' [NOTE: Do not bookmark this URL because it is a preview and this URL will stop working in the future.]'\n      : ''\n  return {\n    duration: 0.99,\n    name: 'No BMS/bmson loaded',\n    description:\n      'Drop a folder with BMS/bmson files into this window to preview it.' +\n      warning,\n    getViewport: () => ({\n      visibleBarLines: [],\n      visibleNotes: [],\n    }),\n    getMeasureInfo: () => ({\n      currentBeat: 0,\n      measureNumber: 0,\n      measureStartBeat: 0,\n    }),\n    getCurrentBpm: () => 0,\n    getCurrentScroll: () => 0,\n    getCurrentSpeed: () => 0,\n    play: (delegate) => {\n      setTimeout(() => {\n        delegate.onFinish()\n      })\n      return { stop: () => {} }\n    },\n    measureToSeconds: () => 0,\n    getMeasureJumpTarget: () => 0,\n    getComboInfo: () => null,\n    getMaxCombo: () => 0,\n  }\n}\n\nexport type PreviewSoundSample = {\n  filename: string\n  sample: Sample | null\n}\n\nexport function createNotechartPreview(\n  notechart: Notechart,\n  filename: string,\n  samplingMaster: SamplingMaster,\n  soundGroup: SoundGroup,\n  samples: PreviewSoundSample[]\n): NotechartPreview {\n  return new BemuseNotechartPreview(\n    notechart,\n    filename,\n    samplingMaster,\n    soundGroup,\n    samples\n  )\n}\n\nclass BemuseNotechartPreview implements NotechartPreview {\n  private _sortedGameNotes: GameNote[]\n  private _sortedSoundEvents: SoundedEvent[]\n  private _secondsToBeatCache?: { seconds: number; beat: number }\n  private _comboPreviewer: ComboPreviewer\n  private _sortedGameLandmines: GameNote[]\n\n  constructor(\n    private _notechart: Notechart,\n    private _filename: string,\n    private _samplingMaster: SamplingMaster,\n    private _soundGroup: SoundGroup,\n    private _samples: PreviewSoundSample[]\n  ) {\n    this._sortedGameNotes = _.sortBy(this._notechart.notes, (e) => e.position)\n    this._sortedGameLandmines = _.sortBy(\n      this._notechart.landmines,\n      (e) => e.position\n    )\n    this._sortedSoundEvents = _.sortBy(\n      [...this._notechart.notes, ...this._notechart.autos],\n      (e) => e.time\n    )\n    this._comboPreviewer = new ComboPreviewer(this._notechart.notes)\n  }\n\n  get duration() {\n    return this._notechart.duration\n  }\n\n  get name() {\n    return this._filename\n  }\n\n  get description() {\n    return this._notechart.songInfo.title\n  }\n\n  getViewport(currentTime: number, hiSpeed: number): PreviewViewport {\n    const beat = this._secondsToBeat(currentTime)\n    const position = this._notechart.beatToPosition(beat)\n    const speed = this._notechart.spacingAtBeat(beat)\n    const windowSize = 4 / speed / hiSpeed\n    const visibleNotes: VisibleNote[] = []\n    const insideView = (gameNote: GameNote) => {\n      if (gameNote.end) {\n        if (currentTime > gameNote.end.time) return false\n        if (gameNote.position > position + windowSize * 1.5) return false\n        if (gameNote.end.position < position - windowSize * 0.5) return false\n        return true\n      } else {\n        if (currentTime > gameNote.time) return false\n        if (gameNote.position > position + windowSize * 1.5) return false\n        if (gameNote.position < position - windowSize * 0.5) return false\n        return true\n      }\n    }\n    for (const gameNote of this._sortedGameNotes) {\n      if (!insideView(gameNote)) continue\n      const delta = gameNote.position - position\n      const y = delta / windowSize\n      const visibleNote: VisibleNote = {\n        gameEvent: gameNote,\n        y,\n        type: 'note',\n      }\n      if (gameNote.end) {\n        const endDelta = gameNote.end.position - position\n        const endY = endDelta / windowSize\n        const active =\n          currentTime >= gameNote.time && currentTime < gameNote.end.time\n        visibleNote.long = { endY, active }\n      }\n      visibleNotes.push(visibleNote)\n    }\n    for (const gameLandmine of this._sortedGameLandmines) {\n      if (!insideView(gameLandmine)) continue\n      const delta = gameLandmine.position - position\n      const y = delta / windowSize\n      const visibleNote: VisibleNote = {\n        gameEvent: gameLandmine,\n        y,\n        type: 'landmine',\n      }\n      visibleNotes.push(visibleNote)\n    }\n    const visibleBarLines: VisibleBarLine[] = []\n    for (const [i, barLine] of this._notechart.barLines.entries()) {\n      if (barLine.position > position + windowSize * 1.5) continue\n      if (barLine.position < position - windowSize * 0.5) continue\n      const delta = barLine.position - position\n      visibleBarLines.push({ y: delta / windowSize, measureNumber: i })\n    }\n    return { visibleNotes, visibleBarLines }\n  }\n\n  getMeasureInfo(currentTime: number): MeasureInfo {\n    const beat = this._secondsToBeat(currentTime)\n    let currentMeasure = 0\n    let currentMeasureStart = 0\n    for (const [i, barLine] of this._notechart.barLines.entries()) {\n      if (beat < barLine.beat) {\n        break\n      }\n      currentMeasure = i\n      currentMeasureStart = barLine.beat\n    }\n    return {\n      currentBeat: beat,\n      measureNumber: currentMeasure,\n      measureStartBeat: currentMeasureStart,\n      measureEndBeat: this._notechart.barLines[currentMeasure + 1]?.beat,\n    }\n  }\n\n  getCurrentBpm(currentTime: number): number {\n    return this._notechart.bpmAtBeat(this._secondsToBeat(currentTime))\n  }\n\n  getCurrentScroll(currentTime: number): number {\n    return this._notechart.scrollSpeedAtBeat(this._secondsToBeat(currentTime))\n  }\n\n  getCurrentSpeed(currentTime: number): number {\n    return this._notechart.spacingAtBeat(this._secondsToBeat(currentTime))\n  }\n\n  measureToSeconds(measure: number): number {\n    const beat = this._notechart.measureToBeat(measure)\n    return this._notechart.beatToSeconds(beat)\n  }\n\n  getMeasureJumpTarget(currentTime: number, direction: number): number {\n    const beat = this._secondsToBeat(currentTime)\n    const closestBarLine = _.minBy(this._notechart.barLines, (b) =>\n      Math.abs(b.beat - beat)\n    )\n    if (!closestBarLine) {\n      return currentTime\n    }\n    const index = this._notechart.barLines.indexOf(closestBarLine)\n    const target = this._notechart.barLines[index + direction]\n    if (!target) {\n      return currentTime\n    }\n    return target.time\n  }\n\n  getComboInfo(currentTime: number): ComboInfo | null {\n    return this._comboPreviewer.getComboInfo(currentTime)\n  }\n\n  getMaxCombo(): number {\n    return this._comboPreviewer.getMaxCombo()\n  }\n\n  private _secondsToBeat(currentTime: number) {\n    if (\n      !this._secondsToBeatCache ||\n      this._secondsToBeatCache.seconds !== currentTime\n    ) {\n      this._secondsToBeatCache = {\n        seconds: currentTime,\n        beat: this._notechart.secondsToBeat(currentTime),\n      }\n    }\n    return this._secondsToBeatCache.beat\n  }\n\n  play(delegate: NotechartPreviewPlayerDelegate) {\n    this._samplingMaster.unmute()\n    console.log(this._sortedSoundEvents)\n    console.log(this._notechart.keysounds)\n    const player = new BemuseNotechartPreviewPlayer(\n      this._samplingMaster,\n      this._soundGroup,\n      this._sortedSoundEvents,\n      this._notechart.keysounds,\n      this._samples,\n      delegate\n    )\n    player.play()\n    return player\n  }\n}\n\nclass BemuseNotechartPreviewPlayer implements NotechartPreviewPlayer {\n  private _cursor = 0\n  private _sampleMap = new Map<string, Sample>()\n  private _startAudioTime = 0\n  private _startSongTime = 0\n  private _stopped = false\n  private _playingSamples = new Map<string, PlayInstance>()\n\n  constructor(\n    private _samplingMaster: SamplingMaster,\n    private _soundGroup: SoundGroup,\n    private _sortedSoundEvents: SoundedEvent[],\n    private _keysounds: Record<string, string>,\n    _samples: PreviewSoundSample[],\n    private _delegate: NotechartPreviewPlayerDelegate\n  ) {\n    for (const { filename, sample } of _samples) {\n      if (sample) {\n        this._sampleMap.set(filename, sample)\n      }\n    }\n  }\n\n  play() {\n    this._startAudioTime = this._samplingMaster.currentTime\n    this._startSongTime = this._delegate.startTime\n    const frame = () => {\n      if (this._stopped) return\n      this._advance()\n      requestAnimationFrame(frame)\n    }\n    requestAnimationFrame(frame)\n  }\n\n  private _advance() {\n    const currentTime =\n      this._samplingMaster.currentTime -\n      this._startAudioTime +\n      this._startSongTime\n    for (; this._cursor < this._sortedSoundEvents.length; this._cursor++) {\n      const nextEvent = this._sortedSoundEvents[this._cursor]\n      if (nextEvent.time > currentTime + 0.1) {\n        break\n      }\n\n      if (nextEvent.keysoundStart) {\n        // bmson’s \"continue\" notes do not trigger a new sound\n        continue\n      }\n\n      const keysound = nextEvent.keysound\n      const filename = this._keysounds[keysound.toLowerCase()]\n      if (!filename) {\n        continue\n      }\n\n      const sample = this._sampleMap.get(filename)\n      if (!sample) {\n        continue\n      }\n\n      let delay = 0\n      let offset = 0\n      if (nextEvent.time > currentTime) {\n        delay = nextEvent.time - currentTime\n      } else if (nextEvent.time < currentTime) {\n        offset = currentTime - nextEvent.time\n      }\n\n      if (offset >= sample.duration) {\n        continue\n      }\n      this._choke(keysound, delay)\n      const instance = sample.play(delay, {\n        start: offset,\n        group: this._soundGroup,\n      })\n      this._playingSamples.set(keysound, instance)\n    }\n    this._delegate.onTimeUpdate(currentTime)\n  }\n\n  private _choke(keysound: string, delay: number) {\n    const playing = this._playingSamples.get(keysound)\n    if (!playing) {\n      return\n    }\n    // TODO: Use Web Audio API instead\n    setTimeout(() => {\n      playing.stop()\n    }, delay * 1000)\n  }\n\n  stop() {\n    this._stopped = true\n    for (const playing of this._playingSamples.values()) {\n      playing.destroy()\n    }\n    this._playingSamples.clear()\n  }\n}\n\nclass ComboPreviewer {\n  private _events: number[]\n\n  constructor(notes: GameNote[]) {\n    this._events = _.sortBy(\n      _.flatMap(notes, (note) => {\n        if (note.end) {\n          return [note.time, note.end.time]\n        } else {\n          return [note.time]\n        }\n      }),\n      _.identity\n    )\n  }\n\n  getComboInfo(time: number): ComboInfo | null {\n    const index = _.sortedLastIndex(this._events, time)\n    if (index === 0) {\n      return null\n    }\n    const prev = this._events[index - 1]\n    return {\n      comboCount: index,\n      comboTime: prev,\n    }\n  }\n\n  getMaxCombo(): number {\n    return this._events.length\n  }\n}\n","import _ from 'lodash'\nimport NotechartLoader from 'bemuse-notechart/lib/loader'\nimport ObjectID from 'bson-objectid'\nimport pMap from 'p-map'\nimport SamplingMaster, { Sample } from 'bemuse/sampling-master'\nimport { get, set } from 'idb-keyval'\nimport { showAlert } from 'bemuse/ui-dialogs'\n\nimport { createNotechartPreview } from './NotechartPreview'\n\nconst PREVIEWER_FS_HANDLE_KEYVAL_KEY = 'previewer-fs-handle'\nconst getSamplingMaster = _.once(() => {\n  const samplingMaster = new SamplingMaster()\n  // http://qiita.com/dtinth/items/1200681c517a3fb26357\n  const DEFAULT_REPLAYGAIN = -12.2 // dB\n\n  const volume = Math.pow(10, (DEFAULT_REPLAYGAIN + 4) / 20)\n  const group = samplingMaster.group({ volume })\n  return {\n    samplingMaster,\n    group,\n  }\n})\n\nconst keysoundCache = new Map<string, Sample>()\nlet keysoundCacheHandleId = ''\n\nexport async function getSavedPreviewInfo() {\n  const data = await get(PREVIEWER_FS_HANDLE_KEYVAL_KEY)\n  const chartFilename = data?.chartFilename\n  return chartFilename ? { chartFilename } : null\n}\n\ntype LoadPreviewOptions = {\n  log: (message: string) => void\n}\n\nexport async function loadPreview(loadOptions: LoadPreviewOptions) {\n  const log =\n    loadOptions.log ||\n    ((message: string) => console.log(`[PreviewLoader] ${message}`))\n\n  log('Loading directory handle from IndexedDB')\n  const data = await get(PREVIEWER_FS_HANDLE_KEYVAL_KEY)\n  const directoryHandle: FileSystemDirectoryHandle = data.directory\n  const handleId = data.handleId\n\n  log('Obtaining permission to read directory')\n  await ensureReadable(directoryHandle)\n\n  log('Scanning charts')\n  const chartHandles: { name: string; handle: FileSystemFileHandle }[] = []\n  for await (const [name, fileHandle] of directoryHandle) {\n    if (fileHandle.kind === 'file' && /\\.(bms|bme|bml|bmson)$/i.test(name)) {\n      chartHandles.push({ name, handle: fileHandle })\n    }\n  }\n  console.log(directoryHandle)\n\n  const chartHandle =\n    chartHandles.find((c) => c.name === data.chartFilename) || chartHandles[0]\n  if (!chartHandle) {\n    throw new Error('No chart found.')\n  }\n\n  log('Loading chart ' + chartHandle.name)\n  const notechartLoader = new NotechartLoader()\n  const arrayBuffer = await (await chartHandle.handle.getFile()).arrayBuffer()\n  const notechart = await notechartLoader.load(\n    arrayBuffer,\n    { name: chartHandle.name },\n    { scratch: 'left', double: true }\n  )\n\n  log('Loading samples')\n  const { samplingMaster, group } = getSamplingMaster()\n  let numLoadedSamples = 0\n  if (keysoundCacheHandleId !== handleId) {\n    keysoundCache.clear()\n    keysoundCacheHandleId = handleId\n  }\n  const samples = await pMap(\n    notechart.samples,\n    async (filename) => {\n      if (keysoundCache.has(filename)) {\n        const sample = keysoundCache.get(filename) || null\n        return { filename, sample }\n      }\n      const load = async (name: string) => {\n        const fileHandle = await directoryHandle.getFileHandle(name)\n        const file = await fileHandle.getFile()\n        return file.arrayBuffer()\n      }\n      try {\n        const arrayBuffer = await load(\n          filename.replace(/\\.\\w+$/, '.ogg')\n        ).catch(() => load(filename))\n        const sample = await samplingMaster.sample(arrayBuffer)\n        const progress = `${++numLoadedSamples}/${notechart.samples.length}`\n        log(`Loaded ${filename} [${progress}]: ${sample.duration}s`)\n        keysoundCache.set(filename, sample)\n        return { filename, sample }\n      } catch (error) {\n        console.error(error)\n        log(`Failed to load ${filename}: ${error}`)\n        return { filename, sample: null }\n      }\n    },\n    { concurrency: 64 }\n  )\n  console.log(samples)\n\n  log('Loading preview')\n  const preview = createNotechartPreview(\n    notechart,\n    chartHandle.name,\n    samplingMaster,\n    group,\n    samples\n  )\n  console.log(preview)\n\n  return preview\n}\n\nasync function ensureReadable(directoryHandle: FileSystemDirectoryHandle) {\n  let permission = await directoryHandle.queryPermission({ mode: 'read' })\n  try {\n    if (permission === 'prompt') {\n      permission = await directoryHandle.requestPermission({ mode: 'read' })\n    }\n  } catch (error) {\n    await showAlert(\n      'File system access required',\n      'Please allow access to the filesystem.'\n    )\n    permission = await directoryHandle.requestPermission({ mode: 'read' })\n  }\n  if (permission !== 'granted') {\n    throw new Error('Permission denied.')\n  }\n}\n\nexport async function setPreview(\n  handle: FileSystemDirectoryHandle,\n  selectedChartFilename: string\n) {\n  await set(PREVIEWER_FS_HANDLE_KEYVAL_KEY, {\n    directory: handle,\n    chartFilename: selectedChartFilename,\n    handleId: ObjectID.generate(),\n  })\n}\n","import { NotechartPreview } from './NotechartPreview'\n\nexport type PreviewState = {\n  currentTime: number\n  hiSpeed: number\n  playing: boolean\n}\n\nexport type PreviewAction = {\n  loaded?: boolean\n  speedUp?: boolean\n  speedDown?: boolean\n  play?: boolean\n  pause?: boolean\n  playPause?: boolean\n  home?: boolean\n  playFinish?: boolean\n  updateTime?: { time: number }\n  jumpToTime?: { time: number }\n  jumpByMeasure?: { preview: NotechartPreview; direction: number }\n  jumpBySeconds?: { direction: number }\n}\n\nexport function previewStateReducer(\n  state: PreviewState,\n  action: PreviewAction\n) {\n  let nextState = state\n  if (action.loaded) {\n    nextState = {\n      ...state,\n      playing: false,\n    }\n  }\n  if (action.speedUp) {\n    nextState = {\n      ...state,\n      hiSpeed: +Math.min(state.hiSpeed + 0.25, 99).toFixed(2),\n    }\n  }\n  if (action.speedDown) {\n    nextState = {\n      ...state,\n      hiSpeed: +Math.max(state.hiSpeed - 0.25, 0.25).toFixed(2),\n    }\n  }\n  if (action.play) {\n    nextState = {\n      ...state,\n      playing: true,\n    }\n  }\n  if (action.pause) {\n    nextState = {\n      ...state,\n      playing: false,\n    }\n  }\n  if (action.playPause) {\n    nextState = {\n      ...state,\n      playing: !state.playing,\n    }\n  }\n  if (action.playFinish) {\n    nextState = {\n      ...state,\n      playing: false,\n    }\n  }\n  if (action.home) {\n    nextState = {\n      ...state,\n      playing: false,\n      currentTime: 0,\n    }\n  }\n  if (action.updateTime) {\n    nextState = {\n      ...state,\n      currentTime: action.updateTime.time,\n    }\n  }\n  if (action.jumpToTime) {\n    nextState = {\n      ...state,\n      currentTime: action.jumpToTime.time,\n      playing: false,\n    }\n  }\n  if (action.jumpByMeasure) {\n    nextState = {\n      ...state,\n      currentTime: action.jumpByMeasure.preview.getMeasureJumpTarget(\n        state.currentTime,\n        action.jumpByMeasure.direction\n      ),\n      playing: false,\n    }\n  }\n  if (action.jumpBySeconds) {\n    nextState = {\n      ...state,\n      currentTime: Math.max(\n        0,\n        state.currentTime + action.jumpBySeconds.direction\n      ),\n      playing: false,\n    }\n  }\n  return nextState\n}\n","import { isModalActive } from 'bemuse/ui-dialogs'\nimport { useLatest } from 'bemuse/utils/useLatest'\nimport { useEffect } from 'react'\nimport { NotechartPreview } from './NotechartPreview'\nimport { PreviewAction } from './PreviewState'\n\nlet rememberedMeasureNumber: number | null = null\n\nexport interface PreviewKeyHandler {\n  notechartPreview: NotechartPreview\n  dispatch: React.Dispatch<PreviewAction>\n  onReload: () => void\n}\n\nexport const PreviewKeyHandler: FC<PreviewKeyHandler> = (props) => {\n  const getLatestNotechartPreview = useLatest(props.notechartPreview)\n  useEffect(() => {\n    const onKeyDown = (e: KeyboardEvent) => {\n      if (isModalActive()) return\n      console.log(e.key)\n      if (e.key === '2') {\n        props.dispatch({ speedUp: true })\n        e.preventDefault()\n      }\n      if (e.key === '1') {\n        props.dispatch({ speedDown: true })\n        e.preventDefault()\n      }\n      if (e.key === ' ') {\n        props.dispatch({ playPause: true })\n        e.preventDefault()\n      }\n      if (e.key === 'Home') {\n        props.dispatch({ home: true })\n        e.preventDefault()\n      }\n      if (e.key === 'g') {\n        props.dispatch({ pause: true })\n        const measure = +(\n          prompt(\n            'Measure number',\n            rememberedMeasureNumber ? `${rememberedMeasureNumber}` : ''\n          ) || ''\n        )\n        if (!isNaN(measure)) {\n          rememberedMeasureNumber = measure\n          props.dispatch({\n            jumpToTime: {\n              time: getLatestNotechartPreview().measureToSeconds(measure),\n            },\n          })\n        }\n        e.preventDefault()\n      }\n      if (e.key === 'r' && !e.ctrlKey && !e.metaKey) {\n        props.onReload()\n        e.preventDefault()\n      }\n      if (e.key === 'ArrowDown') {\n        props.dispatch({\n          jumpByMeasure: {\n            direction: -1,\n            preview: getLatestNotechartPreview(),\n          },\n        })\n        e.preventDefault()\n      }\n      if (e.key === 'ArrowUp') {\n        props.dispatch({\n          jumpByMeasure: {\n            direction: 1,\n            preview: getLatestNotechartPreview(),\n          },\n        })\n        e.preventDefault()\n      }\n      if (e.key === 'ArrowLeft') {\n        props.dispatch({\n          jumpBySeconds: { direction: -5 },\n        })\n        e.preventDefault()\n      }\n      if (e.key === 'ArrowRight') {\n        props.dispatch({\n          jumpBySeconds: { direction: 5 },\n        })\n        e.preventDefault()\n      }\n      if (e.key === ',') {\n        props.dispatch({\n          jumpBySeconds: { direction: -1 / 10 },\n        })\n        e.preventDefault()\n      }\n      if (e.key === '.') {\n        props.dispatch({\n          jumpBySeconds: { direction: 1 / 10 },\n        })\n        e.preventDefault()\n      }\n    }\n    window.addEventListener('keydown', onKeyDown)\n    return () => {\n      window.removeEventListener('keydown', onKeyDown)\n    }\n  }, [props.dispatch])\n  return null\n}\n","import { useCallback, useEffect, useRef } from 'react'\n\nexport function useLatest<T>(value: T): () => T {\n  const ref = useRef(value)\n  useEffect(() => {\n    ref.current = value\n  }, [value])\n  return useCallback(() => ref.current, [])\n}\n","import './BemusePreviewer.scss'\nimport React, { useEffect, useReducer, useRef, useState } from 'react'\nimport { PreviewCanvas } from './PreviewCanvas'\nimport { PreviewInfo } from './PreviewInfo'\nimport { PreviewFileDropHandler } from './PreviewFileDropHandler'\nimport { getSavedPreviewInfo, loadPreview, setPreview } from './PreviewLoader'\nimport {\n  createNullNotechartPreview,\n  NotechartPreview,\n  NotechartPreviewPlayer,\n} from './NotechartPreview'\nimport {\n  PreviewAction,\n  PreviewState,\n  previewStateReducer,\n} from './PreviewState'\nimport { PreviewKeyHandler } from './PreviewKeyHandler'\nimport { showAlert, showQuickPick } from 'bemuse/ui-dialogs'\nimport _ from 'lodash'\n\nexport const BemusePreviewer = () => {\n  const div = useRef<HTMLDivElement>(null)\n  const [previewState, dispatch] = useReducer(previewStateReducer, {\n    currentTime: 0,\n    hiSpeed: 1,\n    playing: false,\n  })\n\n  const [notechartPreview, setNotechartPreview] = useState(\n    createNullNotechartPreview\n  )\n\n  const [loading, setLoading] = useState<null | string>(null)\n\n  const reload = () => {\n    setLoading('Loading...')\n    const setLoadingDebounced = _.throttle(setLoading, 100)\n    loadPreview({\n      log: (message) => {\n        setLoadingDebounced((x) => (x != null ? message : x))\n      },\n    })\n      .then((preview) => {\n        setNotechartPreview(preview)\n        dispatch({ loaded: true })\n        if (div.current) {\n          div.current.focus()\n        }\n      })\n      .catch((error) => {\n        console.error(error)\n        showAlert('Error loading preview', String(error))\n      })\n      .finally(() => setLoadingDebounced(null))\n  }\n\n  usePreviewPlayer(previewState, dispatch, notechartPreview)\n\n  useEffect(() => {\n    ;(async () => {\n      const savedPreviewInfo = await getSavedPreviewInfo()\n      if (savedPreviewInfo) {\n        const choices: { label: string; action: () => void }[] = [\n          {\n            label: `Load ${savedPreviewInfo.chartFilename}`,\n            action: () => {\n              reload()\n            },\n          },\n          {\n            label: 'Do not load',\n            action: () => {},\n          },\n        ]\n        const chosenChoice = await showQuickPick(choices, {\n          title: 'Load a recent song?',\n        })\n        chosenChoice.action()\n      }\n    })()\n  }, [])\n\n  const onDrop = async (\n    handle: FileSystemDirectoryHandle,\n    selectedChartFilename: string\n  ) => {\n    await setPreview(handle, selectedChartFilename)\n    reload()\n  }\n\n  const onReload = () => {\n    reload()\n  }\n\n  return (\n    <div className='BemusePreviewer' tabIndex={0} ref={div}>\n      <div className='BemusePreviewerのheader'>\n        <h1>\n          <a\n            href='https://bemuse.ninja/project/docs/previewer.html'\n            target='_blank'\n            rel='noreferrer'\n          >\n            <strong>Bemuse</strong>’s BMS/bmson previewer\n          </a>\n        </h1>\n      </div>\n      <div className='BemusePreviewerのmain'>\n        <PreviewCanvas\n          notechartPreview={notechartPreview}\n          previewState={previewState}\n        />\n        <PreviewInfo\n          notechartPreview={notechartPreview}\n          previewState={previewState}\n        />\n        <PreviewFileDropHandler onDrop={onDrop} />\n        <PreviewKeyHandler\n          notechartPreview={notechartPreview}\n          dispatch={dispatch}\n          onReload={onReload}\n        />\n      </div>\n      {loading != null ? (\n        <div className='BemusePreviewerのloading'>{loading}</div>\n      ) : null}\n    </div>\n  )\n}\n\nfunction usePreviewPlayer(\n  state: PreviewState,\n  dispatch: React.Dispatch<PreviewAction>,\n  notechartPreview: NotechartPreview\n) {\n  const playerRef = useRef<NotechartPreviewPlayer | null>(null)\n\n  useEffect(() => {\n    if (state.playing && playerRef.current === null) {\n      playerRef.current = notechartPreview.play({\n        startTime: state.currentTime,\n        onFinish: () => {\n          dispatch({ playFinish: true })\n        },\n        onTimeUpdate: (t) => {\n          dispatch({ updateTime: { time: t } })\n        },\n      })\n    } else if (!state.playing && playerRef.current !== null) {\n      playerRef.current.stop()\n      playerRef.current = null\n    }\n  }, [state])\n}\n","import React from 'react'\nimport _ from 'lodash'\nimport MAIN from 'bemuse/utils/main-element'\nimport ReactDOM from 'react-dom'\nimport { BemusePreviewer } from './BemusePreviewer'\n\nexport function main() {\n  ReactDOM.render(<BemusePreviewer />, MAIN)\n}\n","import defaultAudioContext from 'bemuse/audio-context'\nimport readBlob from 'bemuse/utils/read-blob'\nimport { decodeOGG } from './ogg'\n\nexport const FADE_LENGTH = 0.001\n\nconst dummyAudioTag = document.createElement('audio')\n// Checks whether an audio format is supported.\nexport function canPlay(type) {\n  // We have a Vorbis audio decoder!\n  if (type === 'audio/ogg; codecs=\"vorbis\"') return true\n  return dummyAudioTag.canPlayType(type) === 'probably'\n}\n\nconst needsVorbisDecoder = !dummyAudioTag.canPlayType(\n  'audio/ogg; codecs=\"vorbis\"'\n)\n\n// The sampling master is a wrapper class around Web Audio API\n// that takes care of:\n//\n// - Decoding audio from an ArrayBuffer or Blob (resulting in a \"Sample\").\n// - Playing the `Sample` and managing its lifecycle.\nexport class SamplingMaster {\n  constructor(audioContext) {\n    this._audioContext = audioContext || defaultAudioContext\n    this._samples = []\n    this._groups = []\n    this._instances = new Set()\n    this._destination = this._audioContext.destination\n  }\n\n  // Connects a dummy node to the audio, thereby unmuting the audio system on\n  // iOS devices (which keeps the audio muted until a user interacts with the\n  // page).\n  unmute() {\n    unmuteAudio(this._audioContext)\n  }\n\n  // The underlying AudioContext.\n  get audioContext() {\n    return this._audioContext\n  }\n\n  // The audio destination.\n  get destination() {\n    return this._destination\n  }\n\n  // The current time\n  // See: https://webaudio.github.io/web-audio-api/#dom-baseaudiocontext-currenttime\n  get currentTime() {\n    return this._audioContext.currentTime\n  }\n\n  // Destroys this SamplingMaster, make it unusable.\n  destroy() {\n    if (this._destroyed) return\n    this._destroyed = true\n    for (const sample of this._samples) sample.destroy()\n    for (const instance of this._instances) instance.destroy()\n    this._samples = null\n    this._instances = null\n  }\n\n  // Decodes the audio data from a Blob or an ArrayBuffer.\n  // Returns an AudioBuffer which can be re-used in other sampling masters.\n  decode(blobOrArrayBuffer) {\n    return this._coerceToArrayBuffer(blobOrArrayBuffer).then((arrayBuffer) =>\n      this._decodeAudio(arrayBuffer)\n    )\n  }\n\n  // Creates a `Sample` from a Blob or an ArrayBuffer or an AudioBuffer.\n  sample(blobOrArrayBufferOrAudioBuffer) {\n    const audioBufferPromise = (() => {\n      if (blobOrArrayBufferOrAudioBuffer.numberOfChannels) {\n        return Promise.resolve(blobOrArrayBufferOrAudioBuffer)\n      } else {\n        return this.decode(blobOrArrayBufferOrAudioBuffer)\n      }\n    })()\n    return audioBufferPromise.then((audioBuffer) => {\n      if (this._destroyed) throw new Error('SamplingMaster already destroyed!')\n      const sample = new Sample(this, audioBuffer)\n      this._samples.push(sample)\n      return sample\n    })\n  }\n\n  group(options) {\n    const group = new SoundGroup(this, options)\n    this._groups.push(group)\n    return group\n  }\n\n  _coerceToArrayBuffer(blobOrArrayBuffer) {\n    if (blobOrArrayBuffer instanceof ArrayBuffer) {\n      return Promise.resolve(blobOrArrayBuffer)\n    } else {\n      return readBlob(blobOrArrayBuffer).as('arraybuffer')\n    }\n  }\n\n  _decodeAudio(arrayBuffer) {\n    return new Promise((resolve, reject) => {\n      if (needsVorbisDecoder && arrayBuffer.byteLength > 4) {\n        const view = new Uint8Array(arrayBuffer, 0, 4)\n        if (\n          view[0] === 0x4f &&\n          view[1] === 0x67 &&\n          view[2] === 0x67 &&\n          view[3] === 0x53\n        ) {\n          return resolve(decodeOGG(this.audioContext, arrayBuffer))\n        }\n      }\n      this.audioContext.decodeAudioData(\n        arrayBuffer,\n        function decodeAudioDataSuccess(audioBuffer) {\n          resolve(audioBuffer)\n        },\n        function decodeAudioDataFailure(e) {\n          reject(new Error('Unable to decode audio: ' + e))\n        }\n      )\n    })\n  }\n\n  _startPlaying(instance) {\n    this._instances.add(instance)\n  }\n\n  _stoppedPlaying(instance) {\n    this._instances.delete(instance)\n  }\n}\n\n// Sound group\nexport class SoundGroup {\n  constructor(samplingMaster, { volume } = {}) {\n    this._master = samplingMaster\n    this._gain = this._master.audioContext.createGain()\n    if (volume != null) this._gain.gain.value = volume\n    this._gain.connect(this._master.destination)\n  }\n\n  get destination() {\n    return this._gain\n  }\n\n  destroy() {\n    this._gain.disconnect()\n    this._gain = null\n  }\n}\n\n// The Sample is created by and belongs to the `SamplingMaster`.\n//\n// You don't invoke this constructor directly; it is invoked by\n// `SamplingMaster#create`.\nexport class Sample {\n  constructor(samplingMaster, /** @type {AudioBuffer} */ audioBuffer) {\n    this._master = samplingMaster\n    this._buffer = audioBuffer\n  }\n\n  // Plays the sample and returns the new PlayInstance.\n  play(delay, options) {\n    return new PlayInstance(this._master, this._buffer, delay, options)\n  }\n\n  // Destroys this sample, thereby making it unusable.\n  destroy() {\n    this._master = null\n    this._buffer = null\n  }\n\n  get duration() {\n    return this._buffer.duration\n  }\n}\n\n// When a `Sample` is played, a PlayInstance is created.\n// A PlayInstance may not be reused; after the sound finishes playing,\n// you have to invoke `Sample#play` again.\n//\n// You don't invoke this constructor directly; it is invoked by `Sample#play`.\nexport class PlayInstance {\n  constructor(samplingMaster, buffer, delay, options = {}) {\n    delay = delay || 0\n    this._master = samplingMaster\n\n    // Connect all the stuff...\n    const context = samplingMaster.audioContext\n    const source = context.createBufferSource()\n    source.buffer = buffer\n    source.onended = () => this.stop()\n    const gain = context.createGain()\n    source.connect(gain)\n    const destination =\n      options.node ||\n      (options.group && options.group.destination) ||\n      samplingMaster.destination\n    gain.connect(destination)\n    this._source = source\n    this._gain = this.TEST_node = gain\n\n    // Start the sound.\n    const startTime = !delay ? 0 : Math.max(0, context.currentTime + delay)\n    const startOffset = options.start || 0\n    const fadeIn = startOffset > 0\n    let fadeOutAt = false\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, 0)\n    }\n    if (options.end !== undefined) {\n      const duration = Math.max(options.end - startOffset, 0)\n      source.start(startTime, startOffset, duration + FADE_LENGTH)\n      fadeOutAt = context.currentTime + delay + duration\n    } else {\n      source.start(startTime, startOffset)\n    }\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, context.currentTime + delay)\n      gain.gain.linearRampToValueAtTime(\n        1,\n        context.currentTime + delay + FADE_LENGTH\n      )\n    }\n    if (fadeOutAt !== false) {\n      gain.gain.setValueAtTime(1, fadeOutAt)\n      gain.gain.linearRampToValueAtTime(0, fadeOutAt + FADE_LENGTH)\n    }\n    this._master._startPlaying(this)\n  }\n\n  // Stops the sample and disconnects the underlying Web Audio nodes.\n  stop() {\n    if (!this._source) return\n    this._source.stop(0)\n    this._source.disconnect()\n    this._gain.disconnect()\n    this._source = null\n    this._gain = null\n    this._master._stoppedPlaying(this)\n    if (this.onstop) this.onstop()\n  }\n\n  // Makes this PlayInstance sound off-pitch, as a result of badly hitting\n  // a note.\n  bad() {\n    if (!this._source) return\n    this._source.playbackRate.value =\n      Math.random() < 0.5 ? Math.pow(2, 1 / 24) : Math.pow(2, -1 / 24)\n  }\n\n  // Destroys this PlayInstance.\n  destroy() {\n    this.stop()\n  }\n}\n\nexport default SamplingMaster\n\n/**\n * Enables Web Audio on iOS. By default, on iOS, audio is disabled.\n * This function must be called before audio will start working. It must be\n * called as a response to some user interaction (e.g. touchstart).\n *\n * Also, there’s now Chrome autoplay policy taking effect.\n * https://developers.google.com/web/updates/2017/09/autoplay-policy-changes\n *\n * @param {AudioContext} ctx The AudioContext to be unmuted.\n */\nexport function unmuteAudio(ctx = defaultAudioContext) {\n  // Perform some strange magic to unmute the audio on iOS devices.\n  // This code doesn’t make sense at all, you know.\n  const gain = ctx.createGain()\n  const osc = ctx.createOscillator()\n  osc.frequency.value = 440\n  osc.start(ctx.currentTime + 0.1)\n  osc.stop(ctx.currentTime + 0.1)\n  gain.connect(ctx.destination)\n  gain.disconnect()\n\n  resumeContext(ctx).catch((e) => {\n    console.error('[sampling-master] Cannot resume AudioContext', e)\n  })\n}\n\nasync function resumeContext(ctx) {\n  return ctx.resume()\n}\n","import throat from 'throat'\n\ntype OGGDecodeEvent = {\n  data?: Float32Array[]\n  sampleRate: number\n  error?: any\n  eof?: boolean\n}\n\ntype OGGDecoder = {\n  decode(arrayBuffer: ArrayBuffer, callback: (e: OGGDecodeEvent) => void): void\n}\n\nlet decoderPromise: Promise<OGGDecoder>\n\nconst limit = throat(1)\n\nfunction getDecoder() {\n  if (!decoderPromise) {\n    decoderPromise = import(\n      // @ts-ignore\n      /* webpackChunkName: 'stbvorbis' */ './vendor/stbvorbis/stbvorbis-e6da5fe-NDEBUG.js?raw'\n    )\n      .then((ns) => ns.default)\n      .then((src) => {\n        // eslint-disable-next-line no-eval\n        return (0, eval)(src + 'stbvorbis')\n      })\n  }\n  return decoderPromise\n}\n\n/**\n * Decodes an OGG file using stbvorbis.js.\n */\nexport async function decodeOGG(\n  audioContext: AudioContext,\n  arrayBuffer: ArrayBuffer\n) {\n  const stbvorbis = await getDecoder()\n  return limit(() => doDecodeOGG(stbvorbis, audioContext, arrayBuffer))\n}\n\nfunction doDecodeOGG(\n  stbvorbis: OGGDecoder,\n  audioContext: AudioContext,\n  arrayBuffer: ArrayBuffer\n) {\n  return new Promise<AudioBuffer>((resolve, reject) => {\n    const buffers: Float32Array[][] = []\n    let totalLength = 0\n    let sampleRate: number\n    stbvorbis.decode(arrayBuffer, function (e) {\n      if (e.data) {\n        sampleRate = e.sampleRate\n        buffers.push(e.data)\n        totalLength += e.data[0].length\n      }\n      if (e.error) {\n        const error =\n          e.error instanceof Error ? e.error : `stbvorbis.js Error: ${e.error}`\n        reject(error)\n      }\n      if (e.eof) {\n        resolve(createBuffer(audioContext, buffers, totalLength, sampleRate))\n      }\n    })\n  })\n}\n\nasync function createBuffer(\n  audioContext: AudioContext,\n  decodedChunks: Float32Array[][],\n  length: number,\n  sampleRate: number\n) {\n  if (!length) throw new Error(`stbvorbis.js Error: No length`)\n  if (!sampleRate) throw new Error(`stbvorbis.js Error: No sample rate`)\n  const numberOfChannels = decodedChunks[0].length\n  const audioBuffer = audioContext.createBuffer(\n    numberOfChannels,\n    length,\n    sampleRate\n  )\n  const channels: ChannelDataWriter[] = Array(audioBuffer.numberOfChannels)\n    .fill(null)\n    .map((_, ch) => new ChannelDataWriter(audioBuffer.getChannelData(ch)))\n  for (const chunk of decodedChunks) {\n    chunk.forEach((audioSamples, channelIndex) => {\n      channels[channelIndex].write(audioSamples)\n    })\n  }\n  return audioBuffer\n}\n\nclass ChannelDataWriter {\n  private offset = 0\n  constructor(private data: Float32Array) {}\n  write(audioSamples: Float32Array) {\n    // iOS Safari does not support `buf.copyToChannel(a, ch, track[ch])`, so we had to copy audio data sample-by-sample.\n    const { offset, data } = this\n    for (let i = 0; i < audioSamples.length; i++) {\n      data[i + offset] = audioSamples[i]\n    }\n    this.offset += audioSamples.length\n  }\n}\n","\n      import API from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/injectStylesIntoStyleTag.js\";\n      import domAPI from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleDomAPI.js\";\n      import insertFn from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertBySelector.js\";\n      import setAttributes from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/setAttributesWithoutAttributes.js\";\n      import insertStyleElement from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/insertStyleElement.js\";\n      import styleTagTransformFn from \"!../../../common/temp/node_modules/.pnpm/style-loader@3.3.1_webpack@5.75.0/node_modules/style-loader/dist/runtime/styleTagTransform.js\";\n      import content, * as namedExport from \"!!../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./Panel.scss\";\n      \n      \n\nvar options = {};\n\noptions.styleTagTransform = styleTagTransformFn;\noptions.setAttributes = setAttributes;\n\n      options.insert = insertFn.bind(null, \"head\");\n    \noptions.domAPI = domAPI;\noptions.insertStyleElement = insertStyleElement;\n\nvar update = API(content, options);\n\n\n\nexport * from \"!!../../../common/temp/node_modules/.pnpm/css-loader@6.7.2_webpack@5.75.0/node_modules/css-loader/dist/cjs.js??ruleSet[1].rules[5].use[1]!../../../common/temp/node_modules/.pnpm/postcss-loader@7.0.1_webpack@5.75.0/node_modules/postcss-loader/dist/cjs.js??ruleSet[1].rules[5].use[2]!../../../common/temp/node_modules/.pnpm/sass-loader@13.2.0_sass@1.56.1+webpack@5.75.0/node_modules/sass-loader/dist/cjs.js??ruleSet[1].rules[5].use[3]!./Panel.scss\";\n       export default content && content.locals ? content.locals : undefined;\n","import './Panel.scss'\nimport React from 'react'\nimport PropTypes from 'prop-types'\nimport c from 'classnames'\n\nexport default class Panel extends React.Component {\n  static propTypes = {\n    className: PropTypes.string,\n    title: PropTypes.string,\n    children: PropTypes.node,\n  }\n\n  render() {\n    return (\n      <div className={c('Panel', this.props.className)}>\n        <div className='Panelのtitle'>{this.props.title}</div>\n        <div className='Panelのcontent'>{this.props.children}</div>\n      </div>\n    )\n  }\n}\n","export default document.querySelector('#scene-root')\n","export default readBlob\n\n// Reads the blob as a specified type. The blob will not actually be read\n// unless the ``as()`` method is called.\n//\n// .. js:function:: as(type)\n//\n//    Starts reading the blob as ``type``. The ``type`` is a String such as\n//    \"arraybuffer\" or \"text\".\nexport function readBlob(blob) {\n  return {\n    as(type) {\n      return new Promise(function (resolve, reject) {\n        const reader = new FileReader()\n        reader.onload = function () {\n          resolve(reader.result)\n        }\n        reader.onerror = function () {\n          reject(new Error('Unable to read from Blob'))\n        }\n        switch (type) {\n          case 'arraybuffer':\n            reader.readAsArrayBuffer(blob)\n            break\n          case 'text':\n            reader.readAsText(blob)\n            break\n        }\n      })\n    },\n  }\n}\n","export default document.querySelector('#warp-root')!\n","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nvar __values = (this && this.__values) || function(o) {\n    var s = typeof Symbol === \"function\" && Symbol.iterator, m = s && o[s], i = 0;\n    if (m) return m.call(o);\n    if (o && typeof o.length === \"number\") return {\n        next: function () {\n            if (o && i >= o.length) o = void 0;\n            return { value: o && o[i++], done: !o };\n        }\n    };\n    throw new TypeError(s ? \"Object is not iterable.\" : \"Symbol.iterator is not defined.\");\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notechart = void 0;\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar invariant_1 = __importDefault(require(\"invariant\"));\n__exportStar(require(\"./types\"), exports);\n/**\n * A notechart holds every info about a single player's note chart that the\n * game will ever need.\n */\nvar Notechart = /** @class */ (function () {\n    function Notechart(data, playerOptions) {\n        if (playerOptions === void 0) { playerOptions = {}; }\n        var _this = this;\n        var bmsNotes = data.notes, timing = data.timing, keysounds = data.keysounds, songInfo = data.songInfo, positioning = data.positioning, spacing = data.spacing, barLines = data.barLines, images = data.images, expertJudgmentWindow = data.expertJudgmentWindow, _a = data.landmineNotes, landmineNotes = _a === void 0 ? [] : _a;\n        (0, invariant_1.default)(bmsNotes, 'Expected \"data.notes\"');\n        (0, invariant_1.default)(timing, 'Expected \"data.timing\"');\n        (0, invariant_1.default)(keysounds, 'Expected \"data.keysounds\"');\n        (0, invariant_1.default)(songInfo, 'Expected \"data.songInfo\"');\n        (0, invariant_1.default)(positioning, 'Expected \"data.positioning\"');\n        (0, invariant_1.default)(spacing, 'Expected \"data.spacing\"');\n        (0, invariant_1.default)(barLines, 'Expected \"data.barLines\"');\n        this.expertJudgmentWindow = expertJudgmentWindow;\n        bmsNotes = this._preTransform(bmsNotes, playerOptions);\n        this._timing = timing;\n        this._positioning = positioning;\n        this._spacing = spacing;\n        this._keysounds = keysounds;\n        this._duration = 0;\n        this._notes = this._generatePlayableNotesFromBMS(bmsNotes);\n        this._landmines = this._generatePlayableNotesFromBMS(landmineNotes);\n        this._autos = this._generateAutoKeysoundEventsFromBMS(bmsNotes);\n        this._barLines = this._generateBarLineEvents(barLines);\n        this._samples = this._generateKeysoundFiles(keysounds);\n        this._infos = new Map(this._notes.map(function (note) { return [note, _this._getNoteInfo(note)]; }));\n        this._songInfo = songInfo;\n        this._images = images;\n    }\n    Object.defineProperty(Notechart.prototype, \"notes\", {\n        /**\n         * An Array of note events.\n         */\n        get: function () {\n            return this._notes;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"landmines\", {\n        /**\n         * An Array of landmines events.\n         */\n        get: function () {\n            return this._landmines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"autos\", {\n        /**\n         * An Array of auto-keysound events.\n         */\n        get: function () {\n            return this._autos;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"samples\", {\n        /**\n         * An Array of all the sample files to use.\n         */\n        get: function () {\n            return this._samples;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"keysounds\", {\n        /**\n         * An Object containing the mapping from keysound ID to keysound filename.\n         */\n        get: function () {\n            return this._keysounds.all();\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"barLines\", {\n        /**\n         * An Object representing the bar line events.\n         */\n        get: function () {\n            return this._barLines;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"columns\", {\n        /**\n         * An Array of all column names in this notechart.\n         */\n        get: function () {\n            return ['SC', '1', '2', '3', '4', '5', '6', '7'];\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"duration\", {\n        /**\n         * Notechart's duration (time of last event)\n         */\n        get: function () {\n            return this._duration;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"songInfo\", {\n        /**\n         * Notechart's song info\n         */\n        get: function () {\n            return this._songInfo;\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"eyecatchImage\", {\n        /**\n         * Eyecatch image\n         */\n        get: function () {\n            return (this._images && this._images.eyecatch) || 'eyecatch_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    Object.defineProperty(Notechart.prototype, \"backgroundImage\", {\n        /**\n         * Background image\n         */\n        get: function () {\n            return (this._images && this._images.background) || 'back_image.png';\n        },\n        enumerable: false,\n        configurable: true\n    });\n    /**\n     * Returns the characteristic of the note as an Object.\n     */\n    Notechart.prototype.info = function (note) {\n        return this._infos.get(note);\n    };\n    /**\n     * Converts the beat number to in-song position (seconds)\n     */\n    Notechart.prototype.beatToSeconds = function (beat) {\n        return this._timing.beatToSeconds(beat);\n    };\n    /**\n     * Converts the beat number to in-game position.\n     */\n    Notechart.prototype.beatToPosition = function (beat) {\n        return this._positioning.position(beat);\n    };\n    /**\n     * Converts measure number to beat.\n     */\n    Notechart.prototype.measureToBeat = function (measure) {\n        return (this._barLines[measure] || this._barLines[this._barLines.length - 1]).beat;\n    };\n    /**\n     * Converts the in-song position to beat number.\n     */\n    Notechart.prototype.secondsToBeat = function (seconds) {\n        return this._timing.secondsToBeat(seconds);\n    };\n    /**\n     * Converts the in-song position to in-game position.\n     */\n    Notechart.prototype.secondsToPosition = function (seconds) {\n        return this.beatToPosition(this.secondsToBeat(seconds));\n    };\n    /**\n     * Finds BPM at the specified beat.\n     */\n    Notechart.prototype.bpmAtBeat = function (beat) {\n        return this._timing.bpmAtBeat(beat);\n    };\n    /**\n     * Finds the scrolling speed at the specified beat.\n     */\n    Notechart.prototype.scrollSpeedAtBeat = function (beat) {\n        return this._positioning.speed(beat);\n    };\n    /**\n     * Calculates the note spacing factor at the specified beat.\n     */\n    Notechart.prototype.spacingAtBeat = function (beat) {\n        return this._spacing.factor(beat);\n    };\n    /**\n     * Gets the keyMode from scratch\n     * @param scratch\n     * @returns {string}\n     */\n    Notechart.prototype.getKeyMode = function (scratch) {\n        var e_1, _a;\n        var usedColumns = {};\n        try {\n            for (var _b = __values(this.notes), _c = _b.next(); !_c.done; _c = _b.next()) {\n                var note = _c.value;\n                usedColumns[note.column] = true;\n            }\n        }\n        catch (e_1_1) { e_1 = { error: e_1_1 }; }\n        finally {\n            try {\n                if (_c && !_c.done && (_a = _b.return)) _a.call(_b);\n            }\n            finally { if (e_1) throw e_1.error; }\n        }\n        if (scratch === 'off' && !usedColumns['1'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'left' && !usedColumns['6'] && !usedColumns['7'])\n            return '5K';\n        if (scratch === 'right' && !usedColumns['1'] && !usedColumns['2'])\n            return '5K';\n        return '7K';\n    };\n    Notechart.prototype._preTransform = function (bmsNotes, playerOptions) {\n        var chain = lodash_1.default.chain(bmsNotes);\n        var keys = getKeys(bmsNotes);\n        if (playerOptions.scratch === 'off') {\n            chain = chain.map(function (note) {\n                if (note.column && note.column === 'SC') {\n                    return Object.assign({}, note, { column: null });\n                }\n                else {\n                    return note;\n                }\n            });\n        }\n        if (keys === '5K') {\n            var columnsToShift_1 = ['1', '2', '3', '4', '5', '6', '7'];\n            var shiftNote = function (amount) { return function (note) {\n                if (note.column) {\n                    var index = columnsToShift_1.indexOf(note.column);\n                    if (index > -1) {\n                        var newIndex = index + amount;\n                        (0, invariant_1.default)(newIndex < columnsToShift_1.length, 'Weird. Columns must not shift beyond available column');\n                        var newColumn = columnsToShift_1[newIndex];\n                        return Object.assign({}, note, { column: newColumn });\n                    }\n                }\n                return note;\n            }; };\n            if (playerOptions.scratch === 'off') {\n                chain = chain.map(shiftNote(1));\n            }\n            else if (playerOptions.scratch === 'right') {\n                chain = chain.map(shiftNote(2));\n            }\n        }\n        return chain.value();\n    };\n    Notechart.prototype._generatePlayableNotesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            _this._updateDuration(spec);\n            if (note.endBeat !== undefined) {\n                spec.end = _this._generateEvent(note.endBeat);\n                _this._updateDuration(spec.end);\n            }\n            else {\n                spec.end = undefined;\n            }\n            return spec;\n        });\n    };\n    Notechart.prototype._generateLandminesFromBMS = function (bmsNotes) {\n        var _this = this;\n        var nextId = 1;\n        return bmsNotes\n            .filter(function (note) { return note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.id = nextId++;\n            spec.column = note.column;\n            _this._updateDuration(spec);\n            return spec;\n        });\n    };\n    Notechart.prototype._updateDuration = function (event) {\n        if (event.time > this._duration)\n            this._duration = event.time;\n    };\n    Notechart.prototype._generateAutoKeysoundEventsFromBMS = function (bmsNotes) {\n        var _this = this;\n        return bmsNotes\n            .filter(function (note) { return !note.column; })\n            .map(function (note) {\n            var spec = _this._generateEvent(note.beat);\n            spec.keysound = note.keysound;\n            spec.keysoundStart = note.keysoundStart;\n            spec.keysoundEnd = note.keysoundEnd;\n            return spec;\n        });\n    };\n    Notechart.prototype._generateKeysoundFiles = function (keysounds) {\n        var e_2, _a, e_3, _b;\n        var set = new Set();\n        try {\n            for (var _c = __values([this.notes, this.autos]), _d = _c.next(); !_d.done; _d = _c.next()) {\n                var array = _d.value;\n                try {\n                    for (var array_1 = (e_3 = void 0, __values(array)), array_1_1 = array_1.next(); !array_1_1.done; array_1_1 = array_1.next()) {\n                        var event_ = array_1_1.value;\n                        var file = keysounds.get(event_.keysound);\n                        if (file)\n                            set.add(file);\n                    }\n                }\n                catch (e_3_1) { e_3 = { error: e_3_1 }; }\n                finally {\n                    try {\n                        if (array_1_1 && !array_1_1.done && (_b = array_1.return)) _b.call(array_1);\n                    }\n                    finally { if (e_3) throw e_3.error; }\n                }\n            }\n        }\n        catch (e_2_1) { e_2 = { error: e_2_1 }; }\n        finally {\n            try {\n                if (_d && !_d.done && (_a = _c.return)) _a.call(_c);\n            }\n            finally { if (e_2) throw e_2.error; }\n        }\n        return Array.from(set);\n    };\n    Notechart.prototype._generateBarLineEvents = function (beats) {\n        var _this = this;\n        return beats.map(function (beat) { return _this._generateEvent(beat); });\n    };\n    Notechart.prototype._generateEvent = function (beat) {\n        return {\n            beat: beat,\n            time: this.beatToSeconds(beat),\n            position: this.beatToPosition(beat),\n        };\n    };\n    Notechart.prototype._getNoteInfo = function (note) {\n        return { combos: note.end ? 2 : 1 };\n    };\n    return Notechart;\n}());\nexports.Notechart = Notechart;\nexports.default = Notechart;\nfunction getKeys(bmsNotes) {\n    var e_4, _a;\n    try {\n        for (var bmsNotes_1 = __values(bmsNotes), bmsNotes_1_1 = bmsNotes_1.next(); !bmsNotes_1_1.done; bmsNotes_1_1 = bmsNotes_1.next()) {\n            var note = bmsNotes_1_1.value;\n            if (note.column === '6' || note.column === '7') {\n                return '7K';\n            }\n        }\n    }\n    catch (e_4_1) { e_4 = { error: e_4_1 }; }\n    finally {\n        try {\n            if (bmsNotes_1_1 && !bmsNotes_1_1.done && (_a = bmsNotes_1.return)) _a.call(bmsNotes_1);\n        }\n        finally { if (e_4) throw e_4.error; }\n    }\n    return '5K';\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.fromBMSChart = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar lodash_1 = __importDefault(require(\"lodash\"));\nvar __1 = __importDefault(require(\"../\"));\n// Returns a new Notechart from a BMSChart.\nfunction fromBMSChart(bms, playerOptions) {\n    var notes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1,\n    }).all();\n    var landmineNotes = BMS.Notes.fromBMSChart(bms, {\n        mapping: playerOptions.double\n            ? BMS.Notes.CHANNEL_MAPPING.IIDX_DP_LANDMINE\n            : BMS.Notes.CHANNEL_MAPPING.IIDX_P1_LANDMINE,\n    }).all();\n    var timing = BMS.Timing.fromBMSChart(bms);\n    var keysounds = BMS.Keysounds.fromBMSChart(bms);\n    var songInfo = BMS.SongInfo.fromBMSChart(bms);\n    var positioning = BMS.Positioning.fromBMSChart(bms);\n    var spacing = BMS.Spacing.fromBMSChart(bms);\n    var data = {\n        notes: notes,\n        landmineNotes: landmineNotes,\n        timing: timing,\n        keysounds: keysounds,\n        songInfo: songInfo,\n        positioning: positioning,\n        spacing: spacing,\n        barLines: generateBarLinesFromBMS(notes, bms),\n        expertJudgmentWindow: getJudgmentWindowFromBMS(bms),\n    };\n    return new __1.default(data, playerOptions);\n}\nexports.fromBMSChart = fromBMSChart;\nfunction getJudgmentWindowFromBMS(bms) {\n    // http://hitkey.nekokan.dyndns.info/diary1501.php\n    var rank = +bms.headers.get('rank') || 2;\n    if (rank === 0)\n        return [8, 24]; // Very Hard\n    if (rank === 1)\n        return [15, 30]; // Hard\n    if (rank === 3)\n        return [21, 60]; // Easy\n    return [18, 40]; // Normal\n}\nfunction generateBarLinesFromBMS(bmsNotes, bms) {\n    var max = lodash_1.default.max(bmsNotes.map(function (note) { return note.endBeat || note.beat; })) || 0;\n    var barLines = [0];\n    var currentBeat = 0;\n    var currentMeasure = 0;\n    do {\n        currentBeat += bms.timeSignatures.getBeats(currentMeasure);\n        currentMeasure += 1;\n        barLines.push(currentBeat);\n    } while (currentBeat <= max);\n    return barLines;\n}\n//# sourceMappingURL=BMSNotechartLoader.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.load = void 0;\nvar bmson = __importStar(require(\"bmson\"));\nvar BMS = __importStar(require(\"bms\"));\nvar __1 = __importDefault(require(\"../\"));\nfunction load(source, playerOptions) {\n    var data = JSON.parse(source);\n    var songInfo = bmson.songInfoForBmson(data);\n    var score = bmson.musicalScoreForBmson(data, {\n        double: playerOptions.double,\n    });\n    var barLines = bmson.barLinesForBmson(data);\n    var stuff = {\n        notes: score.notes.all(),\n        timing: score.timing,\n        keysounds: score.keysounds,\n        songInfo: songInfo,\n        positioning: new BMS.Positioning([{ t: 0, x: 0, dx: 1, inclusive: true }]),\n        spacing: new BMS.Spacing([]),\n        barLines: barLines,\n        images: {\n            // HACK: Hardcoded here, probably should belong in bmson package\n            eyecatch: data.info.eyecatch_image,\n            background: data.info.back_image,\n        },\n        expertJudgmentWindow: getExpertJudgmentWindowForBmson(data),\n    };\n    return new __1.default(stuff, playerOptions);\n}\nexports.load = load;\nfunction getExpertJudgmentWindowForBmson(data) {\n    var judgeRank = (function () {\n        if (!data.info)\n            return 100;\n        if (!data.info.judge_rank)\n            return 100;\n        return +data.info.judge_rank || 100;\n    })() / 100;\n    return [18 * judgeRank, 40 * judgeRank];\n}\n//# sourceMappingURL=BmsonNotechartLoader.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __awaiter = (this && this.__awaiter) || function (thisArg, _arguments, P, generator) {\n    function adopt(value) { return value instanceof P ? value : new P(function (resolve) { resolve(value); }); }\n    return new (P || (P = Promise))(function (resolve, reject) {\n        function fulfilled(value) { try { step(generator.next(value)); } catch (e) { reject(e); } }\n        function rejected(value) { try { step(generator[\"throw\"](value)); } catch (e) { reject(e); } }\n        function step(result) { result.done ? resolve(result.value) : adopt(result.value).then(fulfilled, rejected); }\n        step((generator = generator.apply(thisArg, _arguments || [])).next());\n    });\n};\nvar __generator = (this && this.__generator) || function (thisArg, body) {\n    var _ = { label: 0, sent: function() { if (t[0] & 1) throw t[1]; return t[1]; }, trys: [], ops: [] }, f, y, t, g;\n    return g = { next: verb(0), \"throw\": verb(1), \"return\": verb(2) }, typeof Symbol === \"function\" && (g[Symbol.iterator] = function() { return this; }), g;\n    function verb(n) { return function (v) { return step([n, v]); }; }\n    function step(op) {\n        if (f) throw new TypeError(\"Generator is already executing.\");\n        while (g && (g = 0, op[0] && (_ = 0)), _) try {\n            if (f = 1, y && (t = op[0] & 2 ? y[\"return\"] : op[0] ? y[\"throw\"] || ((t = y[\"return\"]) && t.call(y), 0) : y.next) && !(t = t.call(y, op[1])).done) return t;\n            if (y = 0, t) op = [op[0] & 2, t.value];\n            switch (op[0]) {\n                case 0: case 1: t = op; break;\n                case 4: _.label++; return { value: op[1], done: false };\n                case 5: _.label++; y = op[1]; op = [0]; continue;\n                case 7: op = _.ops.pop(); _.trys.pop(); continue;\n                default:\n                    if (!(t = _.trys, t = t.length > 0 && t[t.length - 1]) && (op[0] === 6 || op[0] === 2)) { _ = 0; continue; }\n                    if (op[0] === 3 && (!t || (op[1] > t[0] && op[1] < t[3]))) { _.label = op[1]; break; }\n                    if (op[0] === 6 && _.label < t[1]) { _.label = t[1]; t = op; break; }\n                    if (t && _.label < t[2]) { _.label = t[2]; _.ops.push(op); break; }\n                    if (t[2]) _.ops.pop();\n                    _.trys.pop(); continue;\n            }\n            op = body.call(thisArg, _);\n        } catch (e) { op = [6, e]; y = 0; } finally { f = t = 0; }\n        if (op[0] & 5) throw op[1]; return { value: op[0] ? op[1] : void 0, done: true };\n    }\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.NotechartLoader = void 0;\nvar BMS = __importStar(require(\"bms\"));\nvar BMSNotechartLoader = __importStar(require(\"./BMSNotechartLoader\"));\nvar BmsonNotechartLoader = __importStar(require(\"./BmsonNotechartLoader\"));\nvar coerceToBuffer = function (bufferOrArrayBuffer) {\n    return Buffer.isBuffer(bufferOrArrayBuffer)\n        ? bufferOrArrayBuffer\n        : Buffer.from(new Uint8Array(bufferOrArrayBuffer));\n};\nvar NotechartLoader = /** @class */ (function () {\n    function NotechartLoader() {\n    }\n    NotechartLoader.prototype.load = function (arraybuffer, resource, options) {\n        if (resource.name.match(/\\.bmson$/i)) {\n            return this.loadBmson(arraybuffer, resource, options);\n        }\n        else {\n            return this.loadBMS(arraybuffer, resource, options);\n        }\n    };\n    NotechartLoader.prototype.loadBMS = function (arraybuffer, resource, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var buffer, readerOptions, source, compileResult, chart, notechart;\n            return __generator(this, function (_a) {\n                switch (_a.label) {\n                    case 0:\n                        buffer = coerceToBuffer(arraybuffer);\n                        readerOptions = BMS.Reader.getReaderOptionsFromFilename(resource.name);\n                        return [4 /*yield*/, BMS.Reader.readAsync(buffer, readerOptions)];\n                    case 1:\n                        source = _a.sent();\n                        compileResult = BMS.Compiler.compile(source);\n                        chart = compileResult.chart;\n                        notechart = BMSNotechartLoader.fromBMSChart(chart, options);\n                        return [2 /*return*/, notechart];\n                }\n            });\n        });\n    };\n    NotechartLoader.prototype.loadBmson = function (arraybuffer, resource, options) {\n        return __awaiter(this, void 0, void 0, function () {\n            var buffer, source;\n            return __generator(this, function (_a) {\n                buffer = coerceToBuffer(arraybuffer);\n                source = buffer.toString('utf-8');\n                return [2 /*return*/, BmsonNotechartLoader.load(source, options)];\n            });\n        });\n    };\n    return NotechartLoader;\n}());\nexports.NotechartLoader = NotechartLoader;\nexports.default = NotechartLoader;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map"],"names":["___CSS_LOADER_EXPORT___","push","module","id","AudioContext","latencyHint","options","styleTagTransform","setAttributes","insert","domAPI","insertStyleElement","sprites","x","width","highlight","PreviewLayout","constructor","keymap","nextX","column","name","noteColumn","sprite","this","columns","split","map","c","endsWith","slice","totalWidth","columnMapping","filter","PreviewCanvas","props","notesImage","useImage","landmineImage","canvasRef","layout","useMemo","height","viewport","notechartPreview","getViewport","previewState","currentTime","hiSpeed","maxCombo","getMaxCombo","comboInfo","getComboInfo","useEffect","ctx","current","getContext","fillStyle","fillRect","textAlign","font","barLine","visibleBarLines","y","Math","round","fillText","measureNumber","note","visibleNotes","gameEvent","long","endY","spriteYOffset","active","drawImage","noteHeight","image","type","deltaTime","comboTime","opacity","max","comboCount","ref","style","imageRendering","src","setImage","img","Image","onload","preview","measureInfo","getMeasureInfo","bpm","getCurrentBpm","scroll","getCurrentScroll","speed","getCurrentSpeed","format","n","toFixed","formatTime","s","toString","padStart","keyHints","className","description","scope","colSpan","duration","BarDots","measureEndBeat","measureSize","measureStartBeat","dotCount","dotSize","dots","filledDots","ceil","currentBeat","BarDot","key","length","fraction","fill","PreviewFileDropHandler","onDragOver","e","preventDefault","onDrop","async","items","dataTransfer","alert","item","kind","handleNullable","getAsFileSystemHandle","handle","requestPermission","mode","chartFiles","entries","test","filename","label","selectedChartFile","title","window","addEventListener","removeEventListener","createNullNotechartPreview","location","hostname","play","delegate","setTimeout","onFinish","stop","measureToSeconds","getMeasureJumpTarget","BemuseNotechartPreview","_notechart","_filename","_samplingMaster","_soundGroup","_samples","_sortedGameNotes","notes","position","_sortedGameLandmines","landmines","_sortedSoundEvents","autos","time","_comboPreviewer","ComboPreviewer","songInfo","beat","_secondsToBeat","beatToPosition","windowSize","spacingAtBeat","insideView","gameNote","end","visibleNote","gameLandmine","i","barLines","delta","currentMeasure","currentMeasureStart","bpmAtBeat","scrollSpeedAtBeat","measure","measureToBeat","beatToSeconds","direction","closestBarLine","b","abs","index","indexOf","target","_secondsToBeatCache","seconds","secondsToBeat","unmute","console","log","keysounds","player","BemuseNotechartPreviewPlayer","_keysounds","_delegate","_cursor","_sampleMap","Map","_startAudioTime","_startSongTime","_stopped","_playingSamples","sample","set","startTime","frame","_advance","requestAnimationFrame","nextEvent","keysoundStart","keysound","toLowerCase","get","delay","offset","_choke","instance","start","group","onTimeUpdate","playing","values","destroy","clear","_events","PREVIEWER_FS_HANDLE_KEYVAL_KEY","getSamplingMaster","samplingMaster","volume","pow","keysoundCache","keysoundCacheHandleId","loadPreview","loadOptions","message","data","directoryHandle","directory","handleId","permission","queryPermission","error","Error","ensureReadable","chartHandles","fileHandle","chartHandle","find","chartFilename","notechartLoader","arrayBuffer","getFile","notechart","load","scratch","double","numLoadedSamples","samples","has","getFileHandle","replace","catch","progress","concurrency","soundGroup","createNotechartPreview","previewStateReducer","state","action","nextState","loaded","speedUp","min","speedDown","pause","playPause","playFinish","home","updateTime","jumpToTime","jumpByMeasure","jumpBySeconds","rememberedMeasureNumber","PreviewKeyHandler","getLatestNotechartPreview","value","useRef","useCallback","useLatest","onKeyDown","dispatch","prompt","isNaN","ctrlKey","metaKey","onReload","div","useReducer","setNotechartPreview","useState","loading","setLoading","reload","setLoadingDebounced","then","focus","String","finally","playerRef","t","usePreviewPlayer","savedPreviewInfo","getSavedPreviewInfo","choices","tabIndex","href","rel","selectedChartFilename","setPreview","main","FADE_LENGTH","dummyAudioTag","document","createElement","needsVorbisDecoder","canPlayType","SoundGroup","_master","_gain","audioContext","createGain","gain","connect","destination","disconnect","Sample","audioBuffer","_buffer","PlayInstance","buffer","context","source","createBufferSource","onended","node","_source","TEST_node","startOffset","fadeIn","fadeOutAt","setValueAtTime","undefined","linearRampToValueAtTime","_startPlaying","_stoppedPlaying","onstop","bad","playbackRate","random","unmuteAudio","osc","createOscillator","frequency","resume","resumeContext","_audioContext","_groups","_instances","Set","_destination","_destroyed","decode","blobOrArrayBuffer","_coerceToArrayBuffer","_decodeAudio","blobOrArrayBufferOrAudioBuffer","numberOfChannels","Promise","resolve","ArrayBuffer","as","reject","byteLength","view","Uint8Array","decodeAudioData","add","delete","decoderPromise","limit","decodeOGG","stbvorbis","ns","default","eval","buffers","sampleRate","totalLength","eof","decodedChunks","createBuffer","channels","Array","_","ch","ChannelDataWriter","getChannelData","chunk","forEach","audioSamples","channelIndex","write","doDecodeOGG","render","children","propTypes","querySelector","blob","reader","FileReader","result","onerror","readAsArrayBuffer","readAsText","__createBinding","Object","create","o","m","k","k2","desc","getOwnPropertyDescriptor","__esModule","writable","configurable","enumerable","defineProperty","__exportStar","exports","p","prototype","hasOwnProperty","call","__values","Symbol","iterator","next","done","TypeError","__importDefault","mod","Notechart","lodash_1","invariant_1","playerOptions","_this","bmsNotes","timing","positioning","spacing","images","expertJudgmentWindow","_a","landmineNotes","_preTransform","_timing","_positioning","_spacing","_duration","_notes","_generatePlayableNotesFromBMS","_landmines","_autos","_generateAutoKeysoundEventsFromBMS","_barLines","_generateBarLineEvents","_generateKeysoundFiles","_infos","_getNoteInfo","_songInfo","_images","all","eyecatch","background","info","secondsToPosition","factor","getKeyMode","e_1","usedColumns","_b","_c","e_1_1","return","chain","keys","e_4","bmsNotes_1","bmsNotes_1_1","e_4_1","getKeys","assign","columnsToShift_1","shiftNote","amount","newIndex","newColumn","nextId","spec","_generateEvent","keysoundEnd","_updateDuration","endBeat","_generateLandminesFromBMS","event","e_2","e_3","_d","array","array_1","array_1_1","event_","file","e_3_1","e_2_1","from","beats","combos","__setModuleDefault","v","__importStar","fromBMSChart","BMS","__1","getJudgmentWindowFromBMS","bms","rank","headers","generateBarLinesFromBMS","timeSignatures","getBeats","Notes","mapping","CHANNEL_MAPPING","IIDX_DP","IIDX_P1","IIDX_DP_LANDMINE","IIDX_P1_LANDMINE","Timing","Keysounds","SongInfo","Positioning","Spacing","bmson","getExpertJudgmentWindowForBmson","judgeRank","judge_rank","JSON","parse","songInfoForBmson","score","musicalScoreForBmson","barLinesForBmson","stuff","dx","inclusive","eyecatch_image","back_image","__awaiter","thisArg","_arguments","P","generator","fulfilled","step","rejected","apply","__generator","body","f","g","sent","trys","ops","verb","op","pop","NotechartLoader","BMSNotechartLoader","BmsonNotechartLoader","coerceToBuffer","bufferOrArrayBuffer","Buffer","isBuffer","arraybuffer","resource","match","loadBmson","loadBMS","readerOptions","compileResult","chart","Reader","getReaderOptionsFromFilename","readAsync","Compiler","compile"],"sourceRoot":""}