(this.webpackJsonp=this.webpackJsonp||[]).push([[14],{102:function(e,t,n){"use strict";t.a=function(e){return{as:t=>new Promise((function(n,r){let s=new FileReader;switch(s.onload=function(){n(s.result)},s.onerror=function(){r(new Error("Unable to read from Blob"))},t){case"arraybuffer":s.readAsArrayBuffer(e);break;case"text":s.readAsText(e)}}))}}},1046:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));var r=n(85),s=n.n(r),a=n(27),o=n.n(a);function i(e){if(e instanceof s.a.Property)return e;if(e instanceof s.a.EventStream)throw new Error("Please convert Bacon.EventStream to Bacon.Property first.");if(e&&"object"==typeof e)return s.a.combineTemplate(e);throw new Error("Expected a Bacon.Property or a template.")}const c=e=>t=>{let n=i(e);return class extends o.a.Component{constructor(e){let t;super(e),this.handleValue=e=>{this._mounted&&this.setState({value:e})},this._unsubscribe=n.onValue(this.handleValue);n.onValue(e=>t=e)(),this.state={value:t}}componentWillUnmount(){this._mounted=!1,this._unsubscribe&&this._unsubscribe()}componentDidMount(){this._mounted=!0}render(){return o.a.createElement(t,{...this.state.value||{},...this.props})}}}},122:function(e,t,n){"use strict";var r=n(81);t.a=function(e,{getRetryDelay:t=(()=>1e3+4e3*Math.random())}={}){return{async as(n,s){let a=!1;for(let o=1;;o++)try{return await new Promise((t,o)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType=n,i.onload=()=>{200==+i.status?t(i.response):(403!=+i.status&&404!=+i.status||(a=!0),o(new Error(`Unable to download ${e}: HTTP ${i.status}`)))},i.onerror=()=>o(new Error("Unable to download "+e)),s&&(s.formatter=r.a,i.onprogress=e=>s.report(e.loaded,e.total)),i.send(null)})}catch(n){if(console.error(`Unable to download ${e} [attempt ${o}]`,n),o>=3||a)throw n;const r=t();await new Promise(e=>setTimeout(e,r))}}}}},1949:function(e,t,n){e.exports=n.p+"build/c3e8436ef4e3bcc1fbc987075279be07.ogg"},1950:function(e,t,n){e.exports=n.p+"build/aaeef09f2847a09d179f45cfe118d7e7.ogg"},1951:function(e,t,n){e.exports=n.p+"build/c1df64d6d6f13f3a38362aea7cc70a3f.ogg"},1952:function(e,t,n){e.exports=n.p+"build/e733dbfbb80f232b5704be73413ff476.ogg"},1953:function(e,t,n){var r=n(1954);"string"==typeof r&&(r=[[e.i,r,""]]);var s={hmr:!0,transform:void 0,insertInto:void 0};n(0)(r,s);r.locals&&(e.exports=r.locals)},1954:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "UTF-8";\n.ExperimentScene {\n  display: flex;\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  align-items: center;\n  justify-content: center;\n}\n.ExperimentSceneのbutton {\n  font: inherit;\n  background: #252423 linear-gradient(to bottom, #454443, #151413);\n  border: 1px solid #555453;\n  padding: 0.5ex 1.3ex;\n  color: #fff;\n  border-radius: 4px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\n  font-size: 18px;\n}\n.ExperimentSceneのbutton:hover {\n  border-color: #656463;\n}\n.ExperimentSceneのbutton:focus {\n  border-color: #8b8685;\n  outline: 0;\n}\n.ExperimentSceneのbutton:active {\n  background: #252423 linear-gradient(to top, #353433, #151413);\n  border-color: #454443;\n}\n.ExperimentSceneのmessage {\n  text-align: center;\n  font-size: 16px;\n}\n.ExperimentSceneのprogress {\n  width: 100px;\n  margin: 1em auto;\n  border: 1px solid #8b8685;\n  padding: 1px;\n}\n.ExperimentSceneのprogressBar {\n  height: 5px;\n  background: #8b8685;\n  transition: 0.5s transform linear;\n  transform-origin: left;\n}\n.ExperimentScene.is-finished .ExperimentSceneのwrapper {\n  animation: 3.243243243s experiment-scene--auto-synchro linear infinite;\n}\n.ExperimentScene.is-finished .ExperimentSceneのwrapperInner {\n  animation: 3s experiment-scene--spin linear infinite;\n  animation-delay: 13.378378377s;\n}\n\n@keyframes experiment-scene--auto-synchro {\n  0.00% {\n    transform: scale(1);\n  }\n  11.88% {\n    transform: scale(0.95);\n  }\n  13.13% {\n    transform: scale(1.05);\n  }\n  24.38% {\n    transform: scale(0.95);\n  }\n  25.63% {\n    transform: scale(1.05);\n  }\n  36.88% {\n    transform: scale(0.95);\n  }\n  38.13% {\n    transform: scale(1.05);\n  }\n  49.38% {\n    transform: scale(0.95);\n  }\n  50.63% {\n    transform: scale(1.05);\n  }\n  61.88% {\n    transform: scale(0.95);\n  }\n  63.13% {\n    transform: scale(1.05);\n  }\n  74.38% {\n    transform: scale(0.95);\n  }\n  75.63% {\n    transform: scale(1.05);\n  }\n  86.88% {\n    transform: scale(0.95);\n  }\n  88.13% {\n    transform: scale(1.05);\n  }\n  100.00% {\n    transform: scale(1);\n  }\n}\n@keyframes experiment-scene--spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  4% {\n    transform: rotate(1.99deg);\n  }\n  8% {\n    transform: rotate(3.85deg);\n  }\n  12% {\n    transform: rotate(5.48deg);\n  }\n  16% {\n    transform: rotate(6.75deg);\n  }\n  20% {\n    transform: rotate(7.61deg);\n  }\n  24% {\n    transform: rotate(7.98deg);\n  }\n  28% {\n    transform: rotate(7.86deg);\n  }\n  32% {\n    transform: rotate(7.24deg);\n  }\n  36% {\n    transform: rotate(6.16deg);\n  }\n  40% {\n    transform: rotate(4.7deg);\n  }\n  44% {\n    transform: rotate(2.94deg);\n  }\n  48% {\n    transform: rotate(1deg);\n  }\n  52% {\n    transform: rotate(-1deg);\n  }\n  56% {\n    transform: rotate(-2.94deg);\n  }\n  60% {\n    transform: rotate(-4.7deg);\n  }\n  64% {\n    transform: rotate(-6.16deg);\n  }\n  68% {\n    transform: rotate(-7.24deg);\n  }\n  72% {\n    transform: rotate(-7.86deg);\n  }\n  76% {\n    transform: rotate(-7.98deg);\n  }\n  80% {\n    transform: rotate(-7.61deg);\n  }\n  84% {\n    transform: rotate(-6.75deg);\n  }\n  88% {\n    transform: rotate(-5.48deg);\n  }\n  92% {\n    transform: rotate(-3.85deg);\n  }\n  96% {\n    transform: rotate(-1.99deg);\n  }\n  100% {\n    transform: rotate(0deg);\n  }\n}',""])},1988:function(e,t,n){"use strict";n.r(t),n.d(t,"main",(function(){return T}));var r=n(31),s=n.n(r),a=n(222),o=n(122),i=n(303);let c={"bgm.ogg":n(1949),"intro.ogg":n(1950),"kick.ogg":n(1951),"snare.ogg":n(1952)};async function l(){let e=new i.b(a.a),t=s.a.fromPairs(await Promise.all(["bgm","intro","kick","snare"].map(t=>(t=>Object(o.a)(c[t+".ogg"]).as("arraybuffer").then(t=>e.sample(t)))(t).then(e=>[t,e]))));return function(e,t){return function(n){e.unmute();let r=new u(a.a,-1),s=a.a.createBiquadFilter();s.type="lowpass",s.frequency.value=0,s.Q.value=10,s.connect(a.a.destination);let o={part2:null},i=function(e,t){let n=-1;return r=>{let s=Math.floor((r+.1)*e/60);for(;n<s;){n+=1,t(n,60*n/e-r)}}}(148,(e,r)=>{e%8!=7&&t.kick.play(r),null!==o.part2?(e-=o.part2.begin)%128==0&&t.bgm.play(r):(e%32==0&&t.intro.play(r,{node:s}),e%32==31&&!0===o.ok&&(t.snare.play(r),o.part2={begin:e+1},n.a()))});return setInterval(()=>i(r.t),33),{ok(){o.ok=!0},progress(e){s.frequency.value=2e4*e*e*e},getSample(){let e=Math.round(148*r.t/60),t=60*e/148;return[e,r.t-t]}}}}(e,t)}class u{constructor(e,t){this._context=e,this._start=e.currentTime,this._startTime=t}get t(){return this._context.currentTime-this._start+this._startTime}}var d=n(27),f=n.n(d),m=n(67),h=n.n(m),p=(n(1953),n(29)),g=n.n(p),b=n(58),y=n.n(b);class _ extends f.a.Component{constructor(){super(...arguments),this.renderContents=()=>this.props.loading?null:this.props.started?this.props.listening?this.renderCollection():this.renderMessage("Please listen to the beats…"):this.renderReady(),this.renderReady=()=>f.a.createElement("div",{className:"ExperimentSceneのready"},f.a.createElement("button",{className:"ExperimentSceneのbutton",onClick:this.props.onStart},"Start Calibration")),this.renderMessage=e=>f.a.createElement("div",{className:"ExperimentSceneのmessage"},e),this.renderCollection=()=>{var e;let t="scaleX("+(this.props.finished?1:(e=Math.min(1,this.props.numSamples/84),1-Math.pow(1-e,2)))+")",n={transform:t,WebkitTransform:t};return f.a.createElement("div",{className:"ExperimentSceneのcollection"},this.renderMessage(this.props.finished?"Your latency is "+this.props.latency+"ms. Please close this window.":"Please press the space bar when you hear the kick drum."),f.a.createElement("div",{className:"ExperimentSceneのprogress"},f.a.createElement("div",{className:"ExperimentSceneのprogressBar",style:n})))}}render(){return f.a.createElement("div",{className:y()("ExperimentScene",{"is-finished":this.props.finished})},f.a.createElement("div",{className:"ExperimentSceneのwrapper"},f.a.createElement("div",{className:"ExperimentSceneのwrapperInner"},this.renderContents())))}}_.propTypes={finished:g.a.bool,loading:g.a.bool,started:g.a.bool,listening:g.a.bool,onStart:g.a.func,numSamples:g.a.number,latency:g.a.number};var x=n(84),w=n.n(x),v=n(85),E=n.n(v),S=n(1046);function T(e){e.setStatus("Loading song");const t=new E.a.Bus,n=t.scan({loading:!0,started:!1,finished:!1,listening:!1,numSamples:0,latency:0},(e,t)=>s.a.assign({},e,t)),r=Object(S.a)(n)(_),a=f.a.createElement(r,{onStart:()=>{o(),i({type:"calibration-started"}),addEventListener("beforeunload",()=>{i({type:"calibration-closed"})})}});let o;function i(e){window.opener&&window.opener.postMessage(e,"*")}return h.a.render(a,w()("<div></div>").appendTo("body")[0]),l().then(e=>{let n=[];t.push({loading:!1}),o=()=>{t.push({started:!0});let r=e({a(){let e=Math.max(0,function(e){let t=e.map(e=>e[1]);t.sort((e,t)=>e-t);let n=0,r=0;for(let e=Math.floor(1*t.length/7);e<6*t.length/7;e++)n+=1,r+=t[e];return Math.round(r/n*1e3)}(n));t.push({finished:!0,latency:e}),i({latency:e})}}),s=()=>{n.push(r.getSample()),r.progress(Math.min(1,n.length/56)),n.length>=56&&r.ok(),t.push({numSamples:n.length})};setTimeout(()=>{t.push({listening:!0}),window.addEventListener("keydown",e=>{32===e.which&&(e.preventDefault(),s())}),window.addEventListener("touchstart",e=>{1===e.touches.length&&(e.preventDefault(),s())})},6675)}})}},222:function(e,t,n){"use strict";var r=n(346),s=n.n(r);t.a=s()({latencyHint:"interaction"})},303:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return f}));var r=n(222),s=n(102),a=n(337);const o=.001;let i=document.createElement("audio");const c=!i.canPlayType('audio/ogg; codecs="vorbis"');class l{constructor(e,{volume:t}={}){this._master=e,this._gain=this._master.audioContext.createGain(),null!=t&&(this._gain.gain.value=t),this._gain.connect(this._master.destination)}get destination(){return this._gain}destroy(){this._gain.disconnect(),this._gain=null}}class u{constructor(e,t){this._master=e,this._buffer=t}play(e,t){return new d(this._master,this._buffer,e,t)}destroy(){this._master=null,this._buffer=null}}class d{constructor(e,t,n,r={}){n=n||0,this._master=e;let s=e.audioContext,a=s.createBufferSource();a.buffer=t,a.onended=()=>this.stop();let i=s.createGain();a.connect(i);let c=r.node||r.group&&r.group.destination||e.destination;i.connect(c),this._source=a,this._gain=this.TEST_node=i;let l=n?Math.max(0,s.currentTime+n):0,u=r.start||0,d=u>0,f=!1;if(d&&i.gain.setValueAtTime(0,0),void 0!==r.end){let e=Math.max(r.end-u,0);a.start(l,u,e+o),f=s.currentTime+n+e}else a.start(l,u);d&&(i.gain.setValueAtTime(0,s.currentTime+n),i.gain.linearRampToValueAtTime(1,s.currentTime+n+o)),!1!==f&&(i.gain.setValueAtTime(1,f),i.gain.linearRampToValueAtTime(0,f+o)),this._master._startPlaying(this)}stop(){this._source&&(this._source.stop(0),this._source.disconnect(),this._gain.disconnect(),this._source=null,this._gain=null,this._master._stoppedPlaying(this),this.onstop&&this.onstop())}bad(){this._source&&(this._source.playbackRate.value=Math.random()<.5?Math.pow(2,1/24):Math.pow(2,-1/24))}destroy(){this.stop()}}function f(e=r.a){let t=e.createGain(),n=e.createOscillator();n.frequency.value=440,n.start(e.currentTime+.1),n.stop(e.currentTime+.1),t.connect(e.destination),t.disconnect();try{e.resume()}catch(e){console.error("[sampling-master] Cannot resume AudioContext",e)}}t.b=class{constructor(e){this._audioContext=e||r.a,this._samples=[],this._groups=[],this._instances=new Set,this._destination=this._audioContext.destination}unmute(){f(this._audioContext)}get audioContext(){return this._audioContext}get destination(){return this._destination}destroy(){if(!this._destroyed){this._destroyed=!0;for(let e of this._samples)e.destroy();for(let e of this._instances)e.destroy();this._samples=null,this._instances=null}}decode(e){return this._coerceToArrayBuffer(e).then(e=>this._decodeAudio(e))}sample(e){return(()=>e.numberOfChannels?Promise.resolve(e):this.decode(e))().then(e=>{if(this._destroyed)throw new Error("SamplingMaster already destroyed!");var t=new u(this,e);return this._samples.push(t),t})}group(e){const t=new l(this,e);return this._groups.push(t),t}_coerceToArrayBuffer(e){return e instanceof ArrayBuffer?Promise.resolve(e):Object(s.a)(e).as("arraybuffer")}_decodeAudio(e){return new Promise((t,n)=>{if(c&&e.byteLength>4){const n=new Uint8Array(e,0,4);if(79===n[0]&&103===n[1]&&103===n[2]&&83===n[3])return t(Object(a.a)(this.audioContext,e))}this.audioContext.decodeAudioData(e,(function(e){t(e)}),(function(e){n(new Error("Unable to decode audio: "+e))}))})}_startPlaying(e){this._instances.add(e)}_stoppedPlaying(e){this._instances.delete(e)}}},337:function(e,t,n){"use strict";n.d(t,"a",(function(){return o}));var r=n(221);let s;const a=n.n(r)()(1);async function o(e,t){const r=await(s||(s=n.e(13).then(n.t.bind(null,1038,7)).then(e=>e.default).then(e=>(0,eval)(e+";stbvorbis"))),s);return a(()=>function(e,t,n){return new Promise((r,s)=>{const a=[];let o,c=0;e.decode(n,(function(e){if(e.data&&(o=e.sampleRate,a.push(e.data),c+=e.data[0].length),e.error){const t=e.error instanceof Error?e.error:"stbvorbis.js Error: "+e.error;s(t)}e.eof&&r(async function(e,t,n,r){if(!n)throw new Error("stbvorbis.js Error: No length");if(!r)throw new Error("stbvorbis.js Error: No sample rate");const s=t[0].length,a=e.createBuffer(s,n,r),o=Array(a.numberOfChannels).fill(null).map((e,t)=>new i(a.getChannelData(t)));for(const e of t)e.forEach((e,t)=>{o[t].write(e)});return a}(t,a,c,o))}))})}(r,e,t))}class i{constructor(e){this.data=e,this.offset=0}write(e){const{offset:t,data:n}=this;for(var r=0;r<e.length;r++)n[r+t]=e[r];this.offset+=e.length}}},81:function(e,t,n){"use strict";n.d(t,"a",(function(){return o})),n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return c}));var r=n(386),s=n.n(r);let a=e=>t=>null!==t.progress?e(t):"",o=a(e=>s()(e.current)+" / "+s()(e.total)),i=a(e=>(e.current/e.total*100).toFixed(1)+"%"),c=a(e=>e.extra+"")}}]);
//# sourceMappingURL=sync-92fa36b8338a7aa4432f.js.map