(this.webpackJsonp=this.webpackJsonp||[]).push([[13],{106:function(e,t,n){"use strict";n.d(t,"a",(function(){return c}));n(585);var r=n(23),o=n.n(r),i=n(26),a=n.n(i),s=n(50),u=n.n(s);class c extends o.a.Component{render(){return o.a.createElement("div",{className:u()("Panel",this.props.className)},o.a.createElement("div",{className:"Panelのtitle"},this.props.title),o.a.createElement("div",{className:"Panelのcontent"},this.props.children))}}c.propTypes={className:a.a.string,title:a.a.string,children:a.a.node}},107:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.match=void 0,t.match=function(e){var t=!1;return{when:function(n,r){if(t)return this;var o=e.match(n);return o&&(t=!0,r(o)),this},else:function(e){if(t)return this;e()}}}},108:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BMSHeaders=void 0;var r=function(){function e(){this._data={},this._dataAll={}}return e.prototype.each=function(e){for(var t in this._data)e(t,this._data[t])},e.prototype.get=function(e){return this._data[e.toLowerCase()]},e.prototype.getAll=function(e){return this._dataAll[e.toLowerCase()]},e.prototype.set=function(e,t){var n=e.toLowerCase();this._data[n]=t,(this._dataAll[n]||(this._dataAll[n]=[])).push(t)},e}();t.BMSHeaders=r},109:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BMSObjects=void 0;var r=function(){function e(){this._objects=[]}return e.prototype.add=function(e){if("01"!==e.channel)for(var t=0;t<this._objects.length;t++){var n=this._objects[t];if(n.channel===e.channel&&n.measure===e.measure&&n.fraction===e.fraction)return void(this._objects[t]=e)}this._objects.push(e)},e.prototype.all=function(){return this._objects.slice()},e.prototype.allSorted=function(){var e=this.all();return e.sort((function(e,t){return e.measure+e.fraction-(t.measure+t.fraction)})),e},e}();t.BMSObjects=r},110:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.TimeSignatures=void 0;var r=function(){function e(){this._values={}}return e.prototype.set=function(e,t){this._values[e]=t},e.prototype.get=function(e){return this._values[e]||1},e.prototype.getBeats=function(e){return 4*this.get(e)},e.prototype.measureToBeat=function(e,t){for(var n=0,r=0;r<e;r++)n+=this.getBeats(r);return n+this.getBeats(e)*t},e}();t.TimeSignatures=r},1330:function(e,t,n){"use strict";n.d(t,"a",(function(){return i}));n(1331);var r=n(23),o=n.n(r);const i=e=>o.a.createElement("svg",{width:32,height:32,viewBox:"0 0 32 32",className:"BarDot"},e.fraction>0?e.fraction<.99?o.a.createElement("path",{fill:e.fill,d:s(16,16,16,0,360*e.fraction)}):o.a.createElement("circle",{cx:16,cy:16,r:16,fill:e.fill}):null);function a(e,t,n,r){const o=(r-90)*Math.PI/180;return{x:e+n*Math.cos(o),y:t+n*Math.sin(o)}}function s(e,t,n,r,o){const i=a(e,t,n,o),s=a(e,t,n,r),u=o-r<=180?"0":"1";return["M",i.x,i.y,"A",n,n,0,u,0,s.x,s.y,"L",e,t].join(" ")}},1331:function(e,t,n){var r=n(1332);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};n(0)(r,o);r.locals&&(e.exports=r.locals)},1332:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".BarDot {\n  width: 0.64em;\n  height: 0.64em;\n  vertical-align: middle;\n  margin-right: 0.25em;\n}",""])},1333:function(e,t,n){var r=n(1334);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};n(0)(r,o);r.locals&&(e.exports=r.locals)},1334:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "UTF-8";\n.AlertDialogのoverlay {\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  background: rgba(17, 17, 17, 0.5);\n  overflow: hidden;\n  z-index: 10000;\n}\n.AlertDialogのcontent {\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n  z-index: 10001;\n  display: flex;\n  flex-direction: column;\n  align-items: center;\n  justify-content: center;\n}\n.AlertDialogのcontent > * {\n  flex: none;\n}',""])},1335:function(e,t,n){var r=n(1336);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};n(0)(r,o);r.locals&&(e.exports=r.locals)},1336:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,".Button {\n  font: inherit;\n  background: #252423 linear-gradient(to bottom, #454443, #151413);\n  border: 1px solid #555453;\n  padding: 0.5ex 1.3ex;\n  color: #fff;\n  border-radius: 4px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\n}\n.Button:hover {\n  border-color: #656463;\n}\n.Button:focus {\n  border-color: #8b8685;\n  outline: 0;\n}\n.Button:active {\n  background: #252423 linear-gradient(to top, #353433, #151413);\n  border-color: #454443;\n}",""])},1337:function(e,t,n){var r=n(1338);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};n(0)(r,o);r.locals&&(e.exports=r.locals)},1338:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "UTF-8";\n.ComboBox {\n  width: 24em;\n  max-width: 80vw;\n}\n.ComboBoxのinput {\n  font: inherit;\n  background: #252423 linear-gradient(to bottom, #151413, #292827);\n  border: 1px solid #555453;\n  padding: 0.5ex 1.3ex;\n  color: #fff;\n  border-radius: 4px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\n  width: 100%;\n  box-sizing: border-box;\n}\n.ComboBoxのinput:hover {\n  border-color: #656463;\n}\n.ComboBoxのinput:focus {\n  border-color: #8b8685;\n  outline: 0;\n}\n.ComboBoxのinput:active {\n  border-color: #454443;\n}\n.ComboBoxのinput::selection {\n  background: #8b8685;\n  color: #8e8;\n}\n.ComboBoxのmenu {\n  list-style: none;\n  margin: 0;\n  padding: 0;\n  overflow: auto;\n  -webkit-overflow-scrolling: touch;\n  height: 8em;\n  margin-top: 0.5em;\n  background: #252423;\n  border: 1px solid #555453;\n  border-radius: 4px;\n}\n.ComboBoxのmenu > li[data-highlighted=true] {\n  background-color: #8b8685;\n  color: #fff;\n}\n.ComboBoxのmenu > li {\n  padding: 0.5ex 1.3ex;\n}',""])},156:function(e,t,n){"use strict";t.a=new AudioContext({latencyHint:"interactive"})},170:function(e,t,n){"use strict";n.d(t,"a",(function(){return a})),n.d(t,"c",(function(){return f}));var r=n(156),o=n(79),i=n(176);const a=.001,s=document.createElement("audio");const u=!s.canPlayType('audio/ogg; codecs="vorbis"');class c{constructor(e,{volume:t}={}){this._master=e,this._gain=this._master.audioContext.createGain(),null!=t&&(this._gain.gain.value=t),this._gain.connect(this._master.destination)}get destination(){return this._gain}destroy(){this._gain.disconnect(),this._gain=null}}class l{constructor(e,t){this._master=e,this._buffer=t}play(e,t){return new d(this._master,this._buffer,e,t)}destroy(){this._master=null,this._buffer=null}get duration(){return this._buffer.duration}}class d{constructor(e,t,n,r={}){n=n||0,this._master=e;const o=e.audioContext,i=o.createBufferSource();i.buffer=t,i.onended=()=>this.stop();const s=o.createGain();i.connect(s);const u=r.node||r.group&&r.group.destination||e.destination;s.connect(u),this._source=i,this._gain=this.TEST_node=s;const c=n?Math.max(0,o.currentTime+n):0,l=r.start||0,d=l>0;let f=!1;if(d&&s.gain.setValueAtTime(0,0),void 0!==r.end){const e=Math.max(r.end-l,0);i.start(c,l,e+a),f=o.currentTime+n+e}else i.start(c,l);d&&(s.gain.setValueAtTime(0,o.currentTime+n),s.gain.linearRampToValueAtTime(1,o.currentTime+n+a)),!1!==f&&(s.gain.setValueAtTime(1,f),s.gain.linearRampToValueAtTime(0,f+a)),this._master._startPlaying(this)}stop(){this._source&&(this._source.stop(0),this._source.disconnect(),this._gain.disconnect(),this._source=null,this._gain=null,this._master._stoppedPlaying(this),this.onstop&&this.onstop())}bad(){this._source&&(this._source.playbackRate.value=Math.random()<.5?Math.pow(2,1/24):Math.pow(2,-1/24))}destroy(){this.stop()}}function f(e=r.a){const t=e.createGain(),n=e.createOscillator();n.frequency.value=440,n.start(e.currentTime+.1),n.stop(e.currentTime+.1),t.connect(e.destination),t.disconnect(),async function(e){return e.resume()}(e).catch((e=>{console.error("[sampling-master] Cannot resume AudioContext",e)}))}t.b=class{constructor(e){this._audioContext=e||r.a,this._samples=[],this._groups=[],this._instances=new Set,this._destination=this._audioContext.destination}unmute(){f(this._audioContext)}get audioContext(){return this._audioContext}get destination(){return this._destination}get currentTime(){return this._audioContext.currentTime}destroy(){if(!this._destroyed){this._destroyed=!0;for(const e of this._samples)e.destroy();for(const e of this._instances)e.destroy();this._samples=null,this._instances=null}}decode(e){return this._coerceToArrayBuffer(e).then((e=>this._decodeAudio(e)))}sample(e){return(()=>e.numberOfChannels?Promise.resolve(e):this.decode(e))().then((e=>{if(this._destroyed)throw new Error("SamplingMaster already destroyed!");const t=new l(this,e);return this._samples.push(t),t}))}group(e){const t=new c(this,e);return this._groups.push(t),t}_coerceToArrayBuffer(e){return e instanceof ArrayBuffer?Promise.resolve(e):Object(o.a)(e).as("arraybuffer")}_decodeAudio(e){return new Promise(((t,n)=>{if(u&&e.byteLength>4){const n=new Uint8Array(e,0,4);if(79===n[0]&&103===n[1]&&103===n[2]&&83===n[3])return t(Object(i.a)(this.audioContext,e))}this.audioContext.decodeAudioData(e,(function(e){t(e)}),(function(e){n(new Error("Unable to decode audio: "+e))}))}))}_startPlaying(e){this._instances.add(e)}_stoppedPlaying(e){this._instances.delete(e)}}},176:function(e,t,n){"use strict";n.d(t,"a",(function(){return a}));var r=n(169);let o;const i=n.n(r)()(1);async function a(e,t){const r=await(o||(o=n.e(14).then(n.t.bind(null,553,7)).then((e=>e.default)).then((e=>(0,eval)(e+";stbvorbis")))),o);return i((()=>function(e,t,n){return new Promise(((r,o)=>{const i=[];let a,u=0;e.decode(n,(function(e){if(e.data&&(a=e.sampleRate,i.push(e.data),u+=e.data[0].length),e.error){const t=e.error instanceof Error?e.error:`stbvorbis.js Error: ${e.error}`;o(t)}e.eof&&r(async function(e,t,n,r){if(!n)throw new Error("stbvorbis.js Error: No length");if(!r)throw new Error("stbvorbis.js Error: No sample rate");const o=t[0].length,i=e.createBuffer(o,n,r),a=Array(i.numberOfChannels).fill(null).map(((e,t)=>new s(i.getChannelData(t))));for(const e of t)e.forEach(((e,t)=>{a[t].write(e)}));return i}(t,i,u,a))}))}))}(r,e,t)))}class s{constructor(e){this.data=e,this.offset=0}write(e){const{offset:t,data:n}=this;for(let r=0;r<e.length;r++)n[r+t]=e[r];this.offset+=e.length}}},179:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},i=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Notechart=void 0;var s=a(n(27)),u=a(n(55));o(n(292),t);var c=function(){function e(e,t){void 0===t&&(t={});var n=this,r=e.notes,o=e.timing,i=e.keysounds,a=e.songInfo,s=e.positioning,c=e.spacing,l=e.barLines,d=e.images,f=e.expertJudgmentWindow,h=e.landmineNotes,p=void 0===h?[]:h;(0,u.default)(r,'Expected "data.notes"'),(0,u.default)(o,'Expected "data.timing"'),(0,u.default)(i,'Expected "data.keysounds"'),(0,u.default)(a,'Expected "data.songInfo"'),(0,u.default)(s,'Expected "data.positioning"'),(0,u.default)(c,'Expected "data.spacing"'),(0,u.default)(l,'Expected "data.barLines"'),this.expertJudgmentWindow=f,r=this._preTransform(r,t),this._timing=o,this._positioning=s,this._spacing=c,this._keysounds=i,this._duration=0,this._notes=this._generatePlayableNotesFromBMS(r),this._landmines=this._generatePlayableNotesFromBMS(p),this._autos=this._generateAutoKeysoundEventsFromBMS(r),this._barLines=this._generateBarLineEvents(l),this._samples=this._generateKeysoundFiles(i),this._infos=new Map(this._notes.map((function(e){return[e,n._getNoteInfo(e)]}))),this._songInfo=a,this._images=d}return Object.defineProperty(e.prototype,"notes",{get:function(){return this._notes},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"landmines",{get:function(){return this._landmines},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"autos",{get:function(){return this._autos},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"samples",{get:function(){return this._samples},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"keysounds",{get:function(){return this._keysounds.all()},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"barLines",{get:function(){return this._barLines},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"columns",{get:function(){return["SC","1","2","3","4","5","6","7"]},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"duration",{get:function(){return this._duration},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"songInfo",{get:function(){return this._songInfo},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"eyecatchImage",{get:function(){return this._images&&this._images.eyecatch||"eyecatch_image.png"},enumerable:!1,configurable:!0}),Object.defineProperty(e.prototype,"backgroundImage",{get:function(){return this._images&&this._images.background||"back_image.png"},enumerable:!1,configurable:!0}),e.prototype.info=function(e){return this._infos.get(e)},e.prototype.beatToSeconds=function(e){return this._timing.beatToSeconds(e)},e.prototype.beatToPosition=function(e){return this._positioning.position(e)},e.prototype.measureToBeat=function(e){return(this._barLines[e]||this._barLines[this._barLines.length-1]).beat},e.prototype.secondsToBeat=function(e){return this._timing.secondsToBeat(e)},e.prototype.secondsToPosition=function(e){return this.beatToPosition(this.secondsToBeat(e))},e.prototype.bpmAtBeat=function(e){return this._timing.bpmAtBeat(e)},e.prototype.scrollSpeedAtBeat=function(e){return this._positioning.speed(e)},e.prototype.spacingAtBeat=function(e){return this._spacing.factor(e)},e.prototype.getKeyMode=function(e){var t,n,r={};try{for(var o=i(this.notes),a=o.next();!a.done;a=o.next()){r[a.value.column]=!0}}catch(e){t={error:e}}finally{try{a&&!a.done&&(n=o.return)&&n.call(o)}finally{if(t)throw t.error}}return("off"!==e||r[1]||r[7])&&("left"!==e||r[6]||r[7])&&("right"!==e||r[1]||r[2])?"7K":"5K"},e.prototype._preTransform=function(e,t){var n=s.default.chain(e),r=function(e){var t,n;try{for(var r=i(e),o=r.next();!o.done;o=r.next()){var a=o.value;if("6"===a.column||"7"===a.column)return"7K"}}catch(e){t={error:e}}finally{try{o&&!o.done&&(n=r.return)&&n.call(r)}finally{if(t)throw t.error}}return"5K"}(e);if("off"===t.scratch&&(n=n.map((function(e){return e.column&&"SC"===e.column?Object.assign({},e,{column:null}):e}))),"5K"===r){var o=["1","2","3","4","5","6","7"],a=function(e){return function(t){if(t.column){var n=o.indexOf(t.column);if(n>-1){var r=n+e;(0,u.default)(r<o.length,"Weird. Columns must not shift beyond available column");var i=o[r];return Object.assign({},t,{column:i})}}return t}};"off"===t.scratch?n=n.map(a(1)):"right"===t.scratch&&(n=n.map(a(2)))}return n.value()},e.prototype._generatePlayableNotesFromBMS=function(e){var t=this,n=1;return e.filter((function(e){return e.column})).map((function(e){var r=t._generateEvent(e.beat);return r.id=n++,r.column=e.column,r.keysound=e.keysound,r.keysoundStart=e.keysoundStart,r.keysoundEnd=e.keysoundEnd,t._updateDuration(r),void 0!==e.endBeat?(r.end=t._generateEvent(e.endBeat),t._updateDuration(r.end)):r.end=void 0,r}))},e.prototype._generateLandminesFromBMS=function(e){var t=this,n=1;return e.filter((function(e){return e.column})).map((function(e){var r=t._generateEvent(e.beat);return r.id=n++,r.column=e.column,t._updateDuration(r),r}))},e.prototype._updateDuration=function(e){e.time>this._duration&&(this._duration=e.time)},e.prototype._generateAutoKeysoundEventsFromBMS=function(e){var t=this;return e.filter((function(e){return!e.column})).map((function(e){var n=t._generateEvent(e.beat);return n.keysound=e.keysound,n.keysoundStart=e.keysoundStart,n.keysoundEnd=e.keysoundEnd,n}))},e.prototype._generateKeysoundFiles=function(e){var t,n,r,o,a=new Set;try{for(var s=i([this.notes,this.autos]),u=s.next();!u.done;u=s.next()){var c=u.value;try{for(var l=(r=void 0,i(c)),d=l.next();!d.done;d=l.next()){var f=d.value,h=e.get(f.keysound);h&&a.add(h)}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{u&&!u.done&&(n=s.return)&&n.call(s)}finally{if(t)throw t.error}}return Array.from(a)},e.prototype._generateBarLineEvents=function(e){var t=this;return e.map((function(e){return t._generateEvent(e)}))},e.prototype._generateEvent=function(e){return{beat:e,time:this.beatToSeconds(e),position:this.beatToPosition(e)}},e.prototype._getNoteInfo=function(e){return{combos:e.end?2:1}},e}();t.Notechart=c,t.default=c},1809:function(e,t,n){var r=n(1810);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};n(0)(r,o);r.locals&&(e.exports=r.locals)},1810:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "UTF-8";\n.BemusePreviewer {\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  font-size: 18px;\n}\n.BemusePreviewerのheader {\n  position: absolute;\n  top: 0;\n  right: 0;\n  height: 50px;\n  left: 0;\n  background-color: #e34e7a;\n  color: #fff;\n  display: flex;\n  align-items: center;\n  padding: 0 1em;\n}\n.BemusePreviewerのheader > h1 {\n  margin: 0;\n  font-size: 20px;\n  font-weight: normal;\n}\n.BemusePreviewerのheader > h1 strong {\n  font-weight: 600;\n}\n.BemusePreviewerのheader > h1 a {\n  color: inherit;\n  text-decoration: none;\n}\n.BemusePreviewerのmain {\n  position: absolute;\n  top: 50px;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  display: flex;\n  align-items: flex-start;\n}\n.BemusePreviewerのloading {\n  position: absolute;\n  top: 50px;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  background: rgba(0, 0, 0, 0.5333333333);\n  color: #fff;\n  text-align: left;\n  padding: 2em;\n}',""])},1811:function(e,t,n){var r=n(1812);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};n(0)(r,o);r.locals&&(e.exports=r.locals)},1812:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "UTF-8";\n.PreviewInfo {\n  padding: 1em;\n}\n.PreviewInfo > h2 {\n  margin: 0 0 0em;\n}\n.PreviewInfoのkeyHints {\n  color: #8b8685;\n  font-size: 12px;\n  line-height: 2;\n}\n.PreviewInfoのkeyHints > kbd {\n  font-family: inherit;\n  padding: 0.1em 0.2em;\n  background: #222;\n  border: 1px solid #333;\n  border-radius: 4px;\n  box-shadow: 0 3px 0 #333;\n  display: inline-block;\n  line-height: 1;\n}\n.PreviewInfo td {\n  text-align: right;\n  font-family: Menlo, Consolas, monospace;\n}\n.PreviewInfo th {\n  text-align: left;\n}',""])},1829:function(e,t,n){"use strict";n.r(t),n.d(t,"main",(function(){return H}));var r=n(23),o=n.n(r),i=n(99),a=n(49),s=n.n(a),u=(n(1809),n(27)),c=n.n(u);const l={x:0,width:61},d={x:62,width:34,highlight:!0},f={x:97,width:26},h={x:159,width:26};class p{constructor(e){let t=0;const n=(e,n)=>{const r=t;return t+=e+1,{x:r,width:e,column:n}},r=(e,t)=>({...n(e.width,t),sprite:e});this.columns=e.split(" ").map((e=>"-"===e?n(72,null):e.endsWith("s")?r(l,e.slice(0,-1)):e.endsWith("b")?r(f,e.slice(0,-1)):e.endsWith("g")?r(h,e.slice(0,-1)):r(d,e))),this.totalWidth=t,this.columnMapping=c.a.fromPairs(this.columns.filter((e=>null!=e.column)).map((e=>[e.column,e])))}}const m=e=>{const t="SCs 1 2b 3 4g 5 6b 7 - 8 9b 10 11g 12 13b 14 SC2s",n=g("/skins/default/Note/DX/Note.png"),i=g("/skins/default/Note/DX/Landmine.png"),a=o.a.useRef(null),s=Object(r.useMemo)((()=>new p(t)),[t]),u=s.totalWidth+1,c=468,l=Object(r.useMemo)((()=>e.notechartPreview.getViewport(e.previewState.currentTime,e.previewState.hiSpeed)),[e.notechartPreview,e.previewState.currentTime,e.previewState.hiSpeed]),d=e.notechartPreview.getMaxCombo(),f=Object(r.useMemo)((()=>e.notechartPreview.getComboInfo(e.previewState.currentTime)),[e.notechartPreview,e.previewState.currentTime]);return Object(r.useEffect)((()=>{var t,r;const o=null===(t=a.current)||void 0===t?void 0:t.getContext("2d");if(o){o.fillStyle="#000",o.fillRect(0,0,u,c);for(const e of s.columns)o.fillStyle="#555",o.fillRect(e.x,0,1,c),(null===(r=e.sprite)||void 0===r?void 0:r.highlight)&&(o.fillStyle="#111",o.fillRect(e.x+1,0,e.width,c));o.fillStyle="#555",o.fillRect(s.totalWidth,0,1,c),o.textAlign="center",o.font="bold 18px sans-serif";for(const e of l.visibleBarLines){const t=Math.round(c-e.y*c);o.fillRect(0,t-1,s.totalWidth,1),o.fillText("#"+e.measureNumber,s.totalWidth/2,t-4)}if(n&&i)for(const e of l.visibleNotes){const t=s.columnMapping[e.gameEvent.column];if(null==t?void 0:t.sprite){const r=Math.round(c-e.y*c);if(e.long){const i=Math.round(c-e.long.endY*c),a=e.long.active?100:0;o.drawImage(n,t.sprite.x,104+a,t.width,8,t.x+1,r-8,t.width,8),o.drawImage(n,t.sprite.x,12+a,t.width,8,t.x+1,i-12,t.width,8);const s=r-i-4;s>0&&o.drawImage(n,t.sprite.x,22+a,t.width,64,t.x+1,i-4,t.width,s)}else{const a="landmine"===e.type?i:n;o.drawImage(a,t.sprite.x,0,t.width,12,t.x+1,r-12,t.width,12)}}}if(f){const t=e.previewState.currentTime-f.comboTime,n=Math.max(0,1-t);n>0&&(o.fillStyle="rgba(255, 255, 255, "+n+")",o.font="bold 36px sans-serif",o.textAlign="center",o.fillText(`${f.comboCount} / ${d}`,s.totalWidth/2,404-n**8*8))}}}),[u,c,s,l,n,d,f,e.previewState.currentTime]),o.a.createElement("canvas",{ref:a,width:u,height:c,style:{imageRendering:"pixelated"}})};function g(e){const[t,n]=o.a.useState(null);return Object(r.useEffect)((()=>{const t=new Image;return t.src=e,t.onload=()=>n(t),()=>{t.onload=null}}),[e]),t}n(1811);var v=n(1330);const b=e=>{const t=e.notechartPreview,n=Object(r.useMemo)((()=>e.notechartPreview.getMeasureInfo(e.previewState.currentTime)),[e.notechartPreview,e.previewState.currentTime]),i=Object(r.useMemo)((()=>e.notechartPreview.getCurrentBpm(e.previewState.currentTime)),[e.notechartPreview,e.previewState.currentTime]),a=Object(r.useMemo)((()=>e.notechartPreview.getCurrentScroll(e.previewState.currentTime)),[e.notechartPreview,e.previewState.currentTime]),s=Object(r.useMemo)((()=>e.notechartPreview.getCurrentSpeed(e.previewState.currentTime)),[e.notechartPreview,e.previewState.currentTime]),u=e.previewState.hiSpeed,c=e=>e.toFixed(2),l=e=>`${~~(e/60)}:${(~~e%60).toString().padStart(2,"0")}`,d=Object(r.useMemo)((()=>o.a.createElement("p",{className:"PreviewInfoのkeyHints"},o.a.createElement("kbd",null,"Space")," Play/Pause",o.a.createElement("br",null),o.a.createElement("kbd",null,"Up/Down/Left/Right/,/.")," Seek",o.a.createElement("br",null),o.a.createElement("kbd",null,"G")," Go To Measure",o.a.createElement("br",null),o.a.createElement("kbd",null,"1/2")," Hi-Speed",o.a.createElement("br",null),o.a.createElement("kbd",null,"R")," Reload Chart")),[]);return o.a.createElement("div",{className:"PreviewInfo"},o.a.createElement("h2",null,t.name),o.a.createElement("p",null,t.description),o.a.createElement("table",null,o.a.createElement("col",{width:80}),o.a.createElement("col",{width:120}),o.a.createElement("col",{width:80}),o.a.createElement("tbody",null,o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},"Time"),o.a.createElement("td",{colSpan:2},l(e.previewState.currentTime)," /"," ",l(e.notechartPreview.duration))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},"Measure"),o.a.createElement("td",{colSpan:2},o.a.createElement(y,{measureInfo:n})," #",n.measureNumber)),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},"#BPM"),o.a.createElement("td",null),o.a.createElement("td",null,c(i))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},"#SCROLL"),o.a.createElement("td",null,c(a),"x →"),o.a.createElement("td",null,c(i*a))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},"#SPEED"),o.a.createElement("td",null,c(s),"x →"),o.a.createElement("td",null,c(i*a*s))),o.a.createElement("tr",null,o.a.createElement("th",{scope:"row"},"HI-SPEED"),o.a.createElement("td",null,c(u),"x →"),o.a.createElement("td",null,c(i*a*s*u))))),d)},y=e=>{const{measureInfo:t}=e;if(!t.measureEndBeat)return null;const n=t.measureEndBeat-t.measureStartBeat;if(!n)return null;let r=n,i=1;for(;r>=8;)i*=2,r/=2;for(;r<=2;)i/=2,r*=2;const a=[];let s=Math.ceil((t.currentBeat-t.measureStartBeat)/i);for(;r>0;)a.push(o.a.createElement(v.a,{key:a.length,fraction:r>1?1:r,fill:s>0?"#e34e7a":"#333"})),r--,s--;return o.a.createElement(o.a.Fragment,null,a)};var _=n(554);const w=e=>(Object(r.useEffect)((()=>{const t=e=>{e.preventDefault()},n=async t=>{t.preventDefault();const n=t.dataTransfer.items;if(1!==n.length)return void alert("Please drop only one folder.");const r=n[0];if("file"!==r.kind)return void alert("Please drop only a folder here.");if(!("getAsFileSystemHandle"in r))return void alert("Unsupported browser (sorry).");const o=await r.getAsFileSystemHandle();if(!o||"directory"!==o.kind)return void alert("Please drop folder, not a file here.");const i=o;await i.requestPermission({mode:"read"});const a=[];for await(const[e]of i.entries())/\.(bms|bme|bml|bmson)$/i.test(e)&&a.push({filename:e,label:e});if(0===a.length)return void alert("No BMS/bmson files found in folder.");const s=await Object(_.c)(a,{title:"Select a chart file"});e.onDrop(i,s.filename)};return window.addEventListener("dragover",t),window.addEventListener("drop",n),()=>{window.removeEventListener("dragover",t),window.removeEventListener("drop",n)}}),[e.onDrop]),null);var S=n(608),x=n.n(S),B=n(555),P=n.n(B),E=n(492),M=n.n(E),j=n(170),O=n(479);function T(){return{duration:.99,name:"No BMS/bmson loaded",description:"Drop a folder with BMS/bmson files into this window to preview it."+("bemuse.ninja"!==location.hostname?" [NOTE: Do not bookmark this URL because it is a preview and this URL will stop working in the future.]":""),getViewport:()=>({visibleBarLines:[],visibleNotes:[]}),getMeasureInfo:()=>({currentBeat:0,measureNumber:0,measureStartBeat:0}),getCurrentBpm:()=>0,getCurrentScroll:()=>0,getCurrentSpeed:()=>0,play:e=>(setTimeout((()=>{e.onFinish()})),{stop:()=>{}}),measureToSeconds:()=>0,getMeasureJumpTarget:()=>0,getComboInfo:()=>null,getMaxCombo:()=>0}}class C{constructor(e,t,n,r,o){this._notechart=e,this._filename=t,this._samplingMaster=n,this._soundGroup=r,this._samples=o,this._sortedGameNotes=c.a.sortBy(this._notechart.notes,(e=>e.position)),this._sortedGameLandmines=c.a.sortBy(this._notechart.landmines,(e=>e.position)),this._sortedSoundEvents=c.a.sortBy([...this._notechart.notes,...this._notechart.autos],(e=>e.time)),this._comboPreviewer=new k(this._notechart.notes)}get duration(){return this._notechart.duration}get name(){return this._filename}get description(){return this._notechart.songInfo.title}getViewport(e,t){const n=this._secondsToBeat(e),r=this._notechart.beatToPosition(n),o=4/this._notechart.spacingAtBeat(n)/t,i=[],a=t=>t.end?!(e>t.end.time)&&(!(t.position>r+1.5*o)&&!(t.end.position<r-.5*o)):!(e>t.time)&&(!(t.position>r+1.5*o)&&!(t.position<r-.5*o));for(const t of this._sortedGameNotes){if(!a(t))continue;const n={gameEvent:t,y:(t.position-r)/o,type:"note"};if(t.end){const i=(t.end.position-r)/o,a=e>=t.time&&e<t.end.time;n.long={endY:i,active:a}}i.push(n)}for(const e of this._sortedGameLandmines){if(!a(e))continue;const t={gameEvent:e,y:(e.position-r)/o,type:"landmine"};i.push(t)}const s=[];for(const[e,t]of this._notechart.barLines.entries()){if(t.position>r+1.5*o)continue;if(t.position<r-.5*o)continue;const n=t.position-r;s.push({y:n/o,measureNumber:e})}return{visibleNotes:i,visibleBarLines:s}}getMeasureInfo(e){var t;const n=this._secondsToBeat(e);let r=0,o=0;for(const[e,t]of this._notechart.barLines.entries()){if(n<t.beat)break;r=e,o=t.beat}return{currentBeat:n,measureNumber:r,measureStartBeat:o,measureEndBeat:null===(t=this._notechart.barLines[r+1])||void 0===t?void 0:t.beat}}getCurrentBpm(e){return this._notechart.bpmAtBeat(this._secondsToBeat(e))}getCurrentScroll(e){return this._notechart.scrollSpeedAtBeat(this._secondsToBeat(e))}getCurrentSpeed(e){return this._notechart.spacingAtBeat(this._secondsToBeat(e))}measureToSeconds(e){const t=this._notechart.measureToBeat(e);return this._notechart.beatToSeconds(t)}getMeasureJumpTarget(e,t){const n=this._secondsToBeat(e),r=c.a.minBy(this._notechart.barLines,(e=>Math.abs(e.beat-n)));if(!r)return e;const o=this._notechart.barLines.indexOf(r),i=this._notechart.barLines[o+t];return i?i.time:e}getComboInfo(e){return this._comboPreviewer.getComboInfo(e)}getMaxCombo(){return this._comboPreviewer.getMaxCombo()}_secondsToBeat(e){return this._secondsToBeatCache&&this._secondsToBeatCache.seconds===e||(this._secondsToBeatCache={seconds:e,beat:this._notechart.secondsToBeat(e)}),this._secondsToBeatCache.beat}play(e){this._samplingMaster.unmute(),console.log(this._sortedSoundEvents),console.log(this._notechart.keysounds);const t=new N(this._samplingMaster,this._soundGroup,this._sortedSoundEvents,this._notechart.keysounds,this._samples,e);return t.play(),t}}class N{constructor(e,t,n,r,o,i){this._samplingMaster=e,this._soundGroup=t,this._sortedSoundEvents=n,this._keysounds=r,this._delegate=i,this._cursor=0,this._sampleMap=new Map,this._startAudioTime=0,this._startSongTime=0,this._stopped=!1,this._playingSamples=new Map;for(const{filename:e,sample:t}of o)t&&this._sampleMap.set(e,t)}play(){this._startAudioTime=this._samplingMaster.currentTime,this._startSongTime=this._delegate.startTime;const e=()=>{this._stopped||(this._advance(),requestAnimationFrame(e))};requestAnimationFrame(e)}_advance(){const e=this._samplingMaster.currentTime-this._startAudioTime+this._startSongTime;for(;this._cursor<this._sortedSoundEvents.length;this._cursor++){const t=this._sortedSoundEvents[this._cursor];if(t.time>e+.1)break;if(t.keysoundStart)continue;const n=t.keysound,r=this._keysounds[n.toLowerCase()];if(!r)continue;const o=this._sampleMap.get(r);if(!o)continue;let i=0,a=0;if(t.time>e?i=t.time-e:t.time<e&&(a=e-t.time),a>=o.duration)continue;this._choke(n,i);const s=o.play(i,{start:a,group:this._soundGroup});this._playingSamples.set(n,s)}this._delegate.onTimeUpdate(e)}_choke(e,t){const n=this._playingSamples.get(e);n&&setTimeout((()=>{n.stop()}),1e3*t)}stop(){this._stopped=!0;for(const e of this._playingSamples.values())e.destroy();this._playingSamples.clear()}}class k{constructor(e){this._events=c.a.sortBy(c.a.flatMap(e,(e=>e.end?[e.time,e.end.time]:[e.time])),c.a.identity)}getComboInfo(e){const t=c.a.sortedLastIndex(this._events,e);if(0===t)return null;return{comboCount:t,comboTime:this._events[t-1]}}getMaxCombo(){return this._events.length}}const I="previewer-fs-handle",D=c.a.once((()=>{const e=new j.b,t=Math.pow(10,-.41),n=e.group({volume:t});return{samplingMaster:e,group:n}})),A=new Map;let F="";async function L(e){const t=e.log||(e=>console.log(`[PreviewLoader] ${e}`));t("Loading directory handle from IndexedDB");const n=await Object(O.b)(I),r=n.directory,o=n.handleId;t("Obtaining permission to read directory"),await async function(e){let t=await e.queryPermission({mode:"read"});try{"prompt"===t&&(t=await e.requestPermission({mode:"read"}))}catch(n){await Object(_.b)("File system access required","Please allow access to the filesystem."),t=await e.requestPermission({mode:"read"})}if("granted"!==t)throw new Error("Permission denied.")}(r),t("Scanning charts");const i=[];for await(const[e,t]of r)"file"===t.kind&&/\.(bms|bme|bml|bmson)$/i.test(e)&&i.push({name:e,handle:t});console.log(r);const a=i.find((e=>e.name===n.chartFilename))||i[0];if(!a)throw new Error("No chart found.");t("Loading chart "+a.name);const s=new x.a,u=await(await a.handle.getFile()).arrayBuffer(),c=await s.load(u,{name:a.name},{scratch:"left",double:!0});t("Loading samples");const{samplingMaster:l,group:d}=D();let f=0;F!==o&&(A.clear(),F=o);const h=await M()(c.samples,(async e=>{if(A.has(e)){const t=A.get(e)||null;return{filename:e,sample:t}}const n=async e=>{const t=await r.getFileHandle(e);return(await t.getFile()).arrayBuffer()};try{const r=await n(e.replace(/\.\w+$/,".ogg")).catch((()=>n(e))),o=await l.sample(r),i=`${++f}/${c.samples.length}`;return t(`Loaded ${e} [${i}]: ${o.duration}s`),A.set(e,o),{filename:e,sample:o}}catch(n){return console.error(n),t(`Failed to load ${e}: ${n}`),{filename:e,sample:null}}}),{concurrency:64});console.log(h),t("Loading preview");const p=function(e,t,n,r,o){return new C(e,t,n,r,o)}(c,a.name,l,d,h);return console.log(p),p}function R(e,t){let n=e;return t.loaded&&(n={...e,playing:!1}),t.speedUp&&(n={...e,hiSpeed:+Math.min(e.hiSpeed+.25,99).toFixed(2)}),t.speedDown&&(n={...e,hiSpeed:+Math.max(e.hiSpeed-.25,.25).toFixed(2)}),t.play&&(n={...e,playing:!0}),t.pause&&(n={...e,playing:!1}),t.playPause&&(n={...e,playing:!e.playing}),t.playFinish&&(n={...e,playing:!1}),t.home&&(n={...e,playing:!1,currentTime:0}),t.updateTime&&(n={...e,currentTime:t.updateTime.time}),t.jumpToTime&&(n={...e,currentTime:t.jumpToTime.time,playing:!1}),t.jumpByMeasure&&(n={...e,currentTime:t.jumpByMeasure.preview.getMeasureJumpTarget(e.currentTime,t.jumpByMeasure.direction),playing:!1}),t.jumpBySeconds&&(n={...e,currentTime:Math.max(0,e.currentTime+t.jumpBySeconds.direction),playing:!1}),n}let $=null;const K=e=>{const t=function(e){const t=Object(r.useRef)(e);return Object(r.useEffect)((()=>{t.current=e}),[e]),Object(r.useCallback)((()=>t.current),[])}(e.notechartPreview);return Object(r.useEffect)((()=>{const n=n=>{if(!Object(_.a)()){if(console.log(n.key),"2"===n.key&&(e.dispatch({speedUp:!0}),n.preventDefault()),"1"===n.key&&(e.dispatch({speedDown:!0}),n.preventDefault())," "===n.key&&(e.dispatch({playPause:!0}),n.preventDefault()),"Home"===n.key&&(e.dispatch({home:!0}),n.preventDefault()),"g"===n.key){e.dispatch({pause:!0});const r=+(prompt("Measure number",$?`${$}`:"")||"");isNaN(r)||($=r,e.dispatch({jumpToTime:{time:t().measureToSeconds(r)}})),n.preventDefault()}"r"!==n.key||n.ctrlKey||n.metaKey||(e.onReload(),n.preventDefault()),"ArrowDown"===n.key&&(e.dispatch({jumpByMeasure:{direction:-1,preview:t()}}),n.preventDefault()),"ArrowUp"===n.key&&(e.dispatch({jumpByMeasure:{direction:1,preview:t()}}),n.preventDefault()),"ArrowLeft"===n.key&&(e.dispatch({jumpBySeconds:{direction:-5}}),n.preventDefault()),"ArrowRight"===n.key&&(e.dispatch({jumpBySeconds:{direction:5}}),n.preventDefault()),","===n.key&&(e.dispatch({jumpBySeconds:{direction:-.1}}),n.preventDefault()),"."===n.key&&(e.dispatch({jumpBySeconds:{direction:.1}}),n.preventDefault())}};return window.addEventListener("keydown",n),()=>{window.removeEventListener("keydown",n)}}),[e.dispatch]),null},U=()=>{const e=Object(r.useRef)(null),[t,n]=Object(r.useReducer)(R,{currentTime:0,hiSpeed:1,playing:!1}),[i,a]=Object(r.useState)(T),[s,u]=Object(r.useState)(null),l=()=>{u("Loading...");const t=c.a.throttle(u,100);L({log:e=>{t((t=>null!=t?e:t))}}).then((t=>{a(t),n({loaded:!0}),e.current&&e.current.focus()})).catch((e=>{console.error(e),Object(_.b)("Error loading preview",String(e))})).finally((()=>t(null)))};!function(e,t,n){const o=Object(r.useRef)(null);Object(r.useEffect)((()=>{e.playing&&null===o.current?o.current=n.play({startTime:e.currentTime,onFinish:()=>{t({playFinish:!0})},onTimeUpdate:e=>{t({updateTime:{time:e}})}}):e.playing||null===o.current||(o.current.stop(),o.current=null)}),[e])}(t,n,i),Object(r.useEffect)((()=>{(async()=>{const e=await async function(){const e=await Object(O.b)(I),t=null==e?void 0:e.chartFilename;return t?{chartFilename:t}:null}();if(e){const t=[{label:`Load ${e.chartFilename}`,action:()=>{l()}},{label:"Do not load",action:()=>{}}];(await Object(_.c)(t,{title:"Load a recent song?"})).action()}})()}),[]);return o.a.createElement("div",{className:"BemusePreviewer",tabIndex:0,ref:e},o.a.createElement("div",{className:"BemusePreviewerのheader"},o.a.createElement("h1",null,o.a.createElement("a",{href:"https://bemuse.ninja/project/docs/previewer.html",target:"_blank",rel:"noreferrer"},o.a.createElement("strong",null,"Bemuse"),"’s BMS/bmson previewer"))),o.a.createElement("div",{className:"BemusePreviewerのmain"},o.a.createElement(m,{notechartPreview:i,previewState:t}),o.a.createElement(b,{notechartPreview:i,previewState:t}),o.a.createElement(w,{onDrop:async(e,t)=>{await async function(e,t){await Object(O.c)(I,{directory:e,chartFilename:t,handleId:P.a.generate()})}(e,t),l()}}),o.a.createElement(K,{notechartPreview:i,dispatch:n,onReload:()=>{l()}})),null!=s?o.a.createElement("div",{className:"BemusePreviewerのloading"},s):null)};function H(){s.a.render(o.a.createElement(U,null),i.a)}},234:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getReaderOptionsFromFilename=t.readAsync=t.read=void 0;var r=n(537);t.read=function(e){throw new Error("Synchronous read unsupported in browser!")},t.readAsync=function(){for(var e=[],t=0;t<arguments.length;t++)e[t]=arguments[t];var n=e[0],o=e[1],i=o&&o.forceEncoding||r.detect(n);return new Promise((function(e,t){var r=new FileReader;r.onload=function(){e(r.result)},r.onerror=function(){t(new Error("cannot read it"))},r.readAsText(new Blob([n]),i)}))};var o=n(235);Object.defineProperty(t,"getReaderOptionsFromFilename",{enumerable:!0,get:function(){return o.getReaderOptionsFromFilename}})},235:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.getReaderOptionsFromFilename=void 0,t.getReaderOptionsFromFilename=function(e){var t;return e.match(/\.sjis\.\w+$/i)&&(t="Shift-JIS"),e.match(/\.euc_kr\.\w+$/i)&&(t="EUC-KR"),e.match(/\.utf8\.\w+$/i)&&(t="UTF-8"),{forceEncoding:t}}},236:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.compile=void 0;var r=n(107),o=n(39),i={bms:{random:/^#RANDOM\s+(\d+)$/i,if:/^#IF\s+(\d+)$/i,endif:/^#ENDIF$/i,timeSignature:/^#(\d\d\d)02:(\S*)$/,channel:/^#(?:EXT\s+#)?(\d\d\d)(\S\S):(\S*)$/,header:/^#(\w+)(?:\s+(\S.*))?$/},dtx:{random:/^#RANDOM\s+(\d+)$/i,if:/^#IF\s+(\d+)$/i,endif:/^#ENDIF$/i,timeSignature:/^#(\d\d\d)02:\s*(\S*)$/,channel:/^#(?:EXT\s+#)?(\d\d\d)(\S\S):\s*(\S*)$/,header:/^#(\w+):(?:\s+(\S.*))?$/}};t.compile=function(e,t){t=t||{};var n=new o.BMSChart,a=t.rng||function(e){return 1+Math.floor(Math.random()*e)},s=t.format&&i[t.format]||i.bms,u=[],c=[!1],l={headerSentences:0,channelSentences:0,controlSentences:0,skippedSentences:0,malformedSentences:0,chart:n,warnings:[]};return function(e,t){e.split(/\r\n|\r|\n/).map((function(e){return e.trim()})).forEach((function(e,n){t(e,n+1)}))}(e,(function(e,t){var o=!0;if("#"===e.charAt(0)&&((0,r.match)(e).when(s.random,(function(e){l.controlSentences+=1,u.push(a(+e[1]))})).when(s.if,(function(e){l.controlSentences+=1,c.push(u[u.length-1]!==+e[1])})).when(s.endif,(function(e){l.controlSentences+=1,c.pop()})).else((function(){o=!1})),!o)){var i=c[c.length-1];(0,r.match)(e).when(s.timeSignature,(function(e){l.channelSentences+=1,i||n.timeSignatures.set(+e[1],+e[2])})).when(s.channel,(function(e){l.channelSentences+=1,i||function(e,t,r,o){var i=Math.floor(r.length/2);if(0===i)return;for(var a=0;a<i;a++){var s=r.substr(2*a,2),u=a/i;"00"!==s&&n.objects.add({measure:e,fraction:u,value:s,channel:t,lineNumber:o})}}(+e[1],e[2],e[3],t)})).when(s.header,(function(e){l.headerSentences+=1,i||n.headers.set(e[1],e[2])})).else((function(){!function(e,t){l.warnings.push({lineNumber:e,message:t})}(t,"Invalid command")}))}})),l}},237:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},238:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Segment=void 0;var o=r(n(178));t.Segment=(0,o.default)({t:"number",x:"number",dx:"number"})},239:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Notes=void 0;var s=n(240),u=a(n(55)),c=i(n(241)),l=n(39),d=function(){function e(e){e.forEach(s.Note),this._notes=e}return e.prototype.count=function(){return this._notes.length},e.prototype.all=function(){return this._notes.slice()},e.fromBMSChart=function(t,n){l.BMSChart;var r=(n=n||{}).mapping||e.CHANNEL_MAPPING.IIDX_P1;return new f(t,{mapping:r}).build()},e.CHANNEL_MAPPING=c,e}();t.Notes=d;var f=function(){function e(e,t){this._chart=e,(0,u.default)(t.mapping,"Expected options.mapping"),(0,u.default)("object"==typeof t.mapping,"options.mapping must be object"),this._mapping=t.mapping,this._notes=[],this._activeLN={},this._lastNote={},this._lnObj=(this._chart.headers.get("lnobj")||"").toLowerCase(),this._channelMapping=this._mapping,this._objects=this._chart.objects.allSorted()}return e.prototype.build=function(){var e=this;return this._objects.forEach((function(t){e._handle(t)})),new d(this._notes)},e.prototype._handle=function(e){if("01"===e.channel)this._handleNormalNote(e);else switch(e.channel.charAt(0).toUpperCase()){case"1":case"2":case"D":case"E":this._handleNormalNote(e);break;case"5":case"6":this._handleLongNote(e)}},e.prototype._handleNormalNote=function(e){var t=this._normalizeChannel(e.channel),n=this._getBeat(e);if(e.value.toLowerCase()===this._lnObj)this._lastNote[t]&&(this._lastNote[t].endBeat=n);else{var r={beat:n,endBeat:void 0,keysound:e.value,column:this._getColumn(t)};this._lastNote[t]=r,this._notes.push(r)}},e.prototype._handleLongNote=function(e){var t=this._normalizeChannel(e.channel),n=this._getBeat(e);if(this._activeLN[t]){var r=this._activeLN[t];r.endBeat=n,this._notes.push(r),delete this._activeLN[t]}else this._activeLN[t]={beat:n,keysound:e.value,column:this._getColumn(t)}},e.prototype._getBeat=function(e){return this._chart.measureToBeat(e.measure,e.fraction)},e.prototype._getColumn=function(e){return this._channelMapping[e]},e.prototype._normalizeChannel=function(e){return e.replace(/^5/,"1").replace(/^6/,"2")},e}()},240:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.Note=void 0;var o=r(n(178));t.Note=(0,o.default)({beat:"number",endBeat:o.default.maybe("number"),column:o.default.maybe("string"),keysound:"string"})},241:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.IIDX_DP_LANDMINE=t.IIDX_P1_LANDMINE=t.IIDX_DP=t.IIDX_P1=void 0,t.IIDX_P1={11:"1",12:"2",13:"3",14:"4",15:"5",18:"6",19:"7",16:"SC"},t.IIDX_DP={11:"1",12:"2",13:"3",14:"4",15:"5",18:"6",19:"7",16:"SC",21:"8",22:"9",23:"10",24:"11",25:"12",28:"13",29:"14",26:"SC2"},t.IIDX_P1_LANDMINE={D1:"1",D2:"2",D3:"3",D4:"4",D5:"5",D8:"6",D9:"7",D6:"SC"},t.IIDX_DP_LANDMINE={D1:"1",D2:"2",D3:"3",D4:"4",D5:"5",D8:"6",D9:"7",D6:"SC",E1:"8",E2:"9",E3:"10",E4:"11",E5:"12",E8:"13",E9:"14",E6:"SC2"}},242:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Timing=void 0;var r=n(60),o=n(80),i=n(39),a={bpm:1,stop:2},s=function(){function e(e,t){var n={bpm:e,beat:0,seconds:0},i=[];i.push({t:0,x:0,dx:n.bpm/60,bpm:n.bpm,inclusive:!0}),(t=t.slice()).sort((function(e,t){return e.beat-t.beat||a[e.type]-a[t.type]})),t.forEach((function(e){var t=e.beat,r=n.seconds+60*(t-n.beat)/n.bpm;switch(e.type){case"bpm":n.bpm=e.bpm,i.push({t:r,x:t,dx:n.bpm/60,bpm:n.bpm,inclusive:!0});break;case"stop":i.push({t:r,x:t,dx:0,bpm:n.bpm,inclusive:!0}),r+=60*(e.stopBeats||0)/n.bpm,i.push({t:r,x:t,dx:n.bpm/60,bpm:n.bpm,inclusive:!1});break;default:throw new Error("Unrecognized segment object!")}n.beat=t,n.seconds=r})),this._speedcore=new r.Speedcore(i),this._eventBeats=(0,o.uniq)((0,o.map)(t,(function(e){return e.beat})))}return e.prototype.beatToSeconds=function(e){return this._speedcore.t(e)},e.prototype.secondsToBeat=function(e){return this._speedcore.x(e)},e.prototype.bpmAtBeat=function(e){return this._speedcore.segmentAtX(e).bpm},e.prototype.getEventBeats=function(){return this._eventBeats},e.fromBMSChart=function(t){i.BMSChart;var n=[];return t.objects.all().forEach((function(e){var r,o=t.measureToBeat(e.measure,e.fraction);if("03"===e.channel)r=parseInt(e.value,16),n.push({type:"bpm",beat:o,bpm:r});else if("08"===e.channel)r=+t.headers.get("bpm"+e.value),isNaN(r)||n.push({type:"bpm",beat:o,bpm:r});else if("09"===e.channel){var i=+t.headers.get("stop"+e.value)/48;n.push({type:"stop",beat:o,stopBeats:i})}})),new e(+t.headers.get("bpm")||60,n)},e}();t.Timing=s},243:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.SongInfo=void 0;var r=n(107),o=n(80),i=n(39),a=function(){function e(e){this.title="NO TITLE",this.artist="NO ARTIST",this.genre="NO GENRE",this.subtitles=[],this.subartists=[],this.difficulty=0,this.level=0,e&&(0,o.assign)(this,e)}return e.fromBMSChart=function(t){i.BMSChart;var n={},o=t.headers.get("title"),a=t.headers.get("artist"),s=t.headers.get("genre"),u=+t.headers.get("difficulty")||0,c=+t.headers.get("playlevel")||0,l=t.headers.getAll("subtitle"),d=t.headers.getAll("subartist");if("string"==typeof o&&!l){var f=function(e){o=e[1],l=[e[2]]};(0,r.match)(o).when(/^(.*\S)\s*-(.+?)-$/,f).when(/^(.*\S)\s*～(.+?)～$/,f).when(/^(.*\S)\s*\((.+?)\)$/,f).when(/^(.*\S)\s*\[(.+?)\]$/,f).when(/^(.*\S)\s*<(.+?)>$/,f)}return o&&(n.title=o),a&&(n.artist=a),s&&(n.genre=s),l&&(n.subtitles=l),d&&(n.subartists=d),u&&(n.difficulty=u),c&&(n.level=c),new e(n)},e}();t.SongInfo=a},244:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Keysounds=void 0;var r=n(80),o=n(39),i=function(){function e(e){this._map=e}return e.prototype.get=function(e){return this._map[e.toLowerCase()]},e.prototype.files=function(){return(0,r.uniq)((0,r.values)(this._map))},e.prototype.all=function(){return this._map},e.fromBMSChart=function(t){o.BMSChart;var n={};return t.headers.each((function(e,t){var r=e.match(/^wav(\S\S)$/i);r&&(n[r[1].toLowerCase()]=t)})),new e(n)},e}();t.Keysounds=i},245:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Positioning=void 0;var r=n(60),o=n(39),i=function(){function e(e){this._speedcore=new r.Speedcore(e)}return e.prototype.speed=function(e){return this._speedcore.dx(e)},e.prototype.position=function(e){return this._speedcore.x(e)},e.fromBMSChart=function(t){o.BMSChart;var n=[],r=0;return n.push({t:0,x:r,dx:1,inclusive:!0}),t.objects.allSorted().forEach((function(e){if("SC"===e.channel){var o=t.measureToBeat(e.measure,e.fraction),i=+t.headers.get("scroll"+e.value);if(isNaN(i))return;var a=n[n.length-1];r+=(o-a.t)*a.dx,0===o&&1===n.length?n[0].dx=i:n.push({t:o,x:r,dx:i,inclusive:!0})}})),new e(n)},e}();t.Positioning=i},246:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Spacing=void 0;var r=n(60),o=n(39),i=function(){function e(e){e.length>0&&(this._speedcore=new r.Speedcore(e))}return e.prototype.factor=function(e){return this._speedcore?this._speedcore.x(e):1},e.fromBMSChart=function(t){o.BMSChart;var n=[];return t.objects.allSorted().forEach((function(e){if("SP"===e.channel){var r=t.measureToBeat(e.measure,e.fraction),o=+t.headers.get("speed"+e.value);if(isNaN(o))return;if(n.length>0){var i=n[n.length-1];i.dx=(o-i.x)/(r-i.t)}n.push({t:r,x:o,dx:0,inclusive:!0})}})),n.length>0&&n.unshift({t:0,x:n[0].x,dx:0,inclusive:!0}),new e(n)},e}();t.Spacing=i},291:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.fromBMSChart=void 0;var s=i(n(85)),u=a(n(27)),c=a(n(179));function l(e){var t=+e.headers.get("rank")||2;return 0===t?[8,24]:1===t?[15,30]:3===t?[21,60]:[18,40]}function d(e,t){var n=u.default.max(e.map((function(e){return e.endBeat||e.beat})))||0,r=[0],o=0,i=0;do{o+=t.timeSignatures.getBeats(i),i+=1,r.push(o)}while(o<=n);return r}t.fromBMSChart=function(e,t){var n=s.Notes.fromBMSChart(e,{mapping:t.double?s.Notes.CHANNEL_MAPPING.IIDX_DP:s.Notes.CHANNEL_MAPPING.IIDX_P1}).all(),r={notes:n,landmineNotes:s.Notes.fromBMSChart(e,{mapping:t.double?s.Notes.CHANNEL_MAPPING.IIDX_DP_LANDMINE:s.Notes.CHANNEL_MAPPING.IIDX_P1_LANDMINE}).all(),timing:s.Timing.fromBMSChart(e),keysounds:s.Keysounds.fromBMSChart(e),songInfo:s.SongInfo.fromBMSChart(e),positioning:s.Positioning.fromBMSChart(e),spacing:s.Spacing.fromBMSChart(e),barLines:d(n,e),expertJudgmentWindow:l(e)};return new c.default(r,t)}},292:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},320:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},s=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},u=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t._slicesForNotesAndTiming=t.beatForLoc=t.timingInfoForBmson=t.barLinesForBmson=void 0;var c=u(n(27)),l=i(n(321));function d(e){return e/240}t.barLinesForBmson=function(e){var t=e.lines;return(0,c.default)(t).map((function(e){return d(e.y)})).sortBy().value()},t.timingInfoForBmson=function(e){return{initialBPM:e.info.initBPM,actions:s(s([],a((e.bpmNotes||[]).map((function(e){var t=e.y,n=e.v;return{type:"bpm",beat:d(t),bpm:n}}))),!1),a((e.stopNotes||[]).map((function(e){var t=e.y,n=e.v;return{type:"stop",beat:d(t),stopBeats:d(Math.floor(n))}}))),!1)}},t.beatForLoc=d,t._slicesForNotesAndTiming=function(e,t){return l.slicesForNotesAndTiming(e,t,{beatForPulse:d})}},321:function(e,t,n){"use strict";var r=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},o=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},i=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.slicesForNotesAndTiming=void 0;var s=a(n(27));t.slicesForNotesAndTiming=function(e,t,n){var a,u,c,l,d=n.beatForPulse,f=new Set,h=new Set,p=new Set;try{for(var m=r(e),g=m.next();!g.done;g=m.next()){var v=g.value,b=v.x,y=v.y,_=v.c;f.add(y),b&&h.add(y),_||p.add(y)}}catch(e){a={error:e}}finally{try{g&&!g.done&&(u=m.return)&&u.call(m)}finally{if(a)throw a.error}}var w,S,x=new Map,B=null,P=!0;try{for(var E=r(s.default.sortBy(i([],o(f),!1))),M=E.next();!M.done;M=E.next()){y=M.value;var j=t.beatToSeconds(d(y));if(null===B||p.has(y)?B=0:B+=j-w,P||h.has(y)||p.has(y)){S&&!p.has(y)&&(S.keysoundEnd=B);var O={keysoundStart:B,keysoundEnd:void 0};x.set(y,O),S=O}P=h.has(y),w=j}}catch(e){c={error:e}}finally{try{M&&!M.done&&(l=E.return)&&l.call(E)}finally{if(c)throw c.error}}return x}},39:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.BMSChart=void 0;var r=n(108),o=n(109),i=n(110),a=function(){function e(){this.headers=new r.BMSHeaders,this.objects=new o.BMSObjects,this.timeSignatures=new i.TimeSignatures}return e.prototype.measureToBeat=function(e,t){return this.timeSignatures.measureToBeat(e,t)},e}();t.BMSChart=a},496:function(e,t){},534:function(e,t,n){"use strict";t.a=document.querySelector("#warp-root")},554:function(e,t,n){"use strict";n.d(t,"b",(function(){return g})),n.d(t,"c",(function(){return v})),n.d(t,"a",(function(){return _}));n(1333);var r=n(23),o=n.n(r),i=n(49),a=n.n(i),s=n(534),u=n(106);n(1335);var c=Object(r.forwardRef)((({children:e,onClick:t},n)=>o.a.createElement("button",{className:"Button",onClick:t,ref:n},e)));var l=({children:e,padding:t,gap:n})=>o.a.createElement("div",{style:{display:"flex",flexDirection:"column",padding:t,gap:n}},e),d=n(1342),f=(n(1337),n(1349)),h=n(1339),p=n.n(h);function m(e){const[t,n]=Object(r.useState)(e.items),{isOpen:i,getLabelProps:a,getMenuProps:s,getInputProps:u,getComboboxProps:c,highlightedIndex:l,getItemProps:d,setHighlightedIndex:h}=Object(f.a)({items:t,initialHighlightedIndex:0,isOpen:!0,onInputValueChange:({inputValue:t})=>{const r=t?p.a.go(t,e.items,{key:"label"}).map((e=>e.obj)):e.items;n(r)},onHighlightedIndexChange:({highlightedIndex:e})=>{-1===e&&t.length>0&&h(0)},onSelectedItemChange:({selectedItem:t,type:n})=>{!t||n!==f.a.stateChangeTypes.InputKeyDownEnter&&n!==f.a.stateChangeTypes.ItemClick||e.onSelect(t)},itemToString:e=>(null==e?void 0:e.label)||""});return o.a.createElement("div",{className:"ComboBox"},o.a.createElement("label",{hidden:!0,...a()},"Choose an element:"),o.a.createElement("div",{...c(),className:"ComboBoxのsearch"},o.a.createElement("input",{...u(),className:"ComboBoxのinput"})),o.a.createElement("ul",{...s(),className:"ComboBoxのmenu"},i&&t.map(((e,t)=>o.a.createElement("li",{"data-highlighted":l===t,key:`${e.label}${t}`,...d({item:e,index:t})},e.label)))))}async function g(e,t){await y(new Promise((n=>{const r=document.createElement("div");s.a.appendChild(r);const i=o.a.createElement(d.e,{open:!0},o.a.createElement(d.d,{className:"AlertDialogのoverlay"}),o.a.createElement(d.b,{className:"AlertDialogのcontent"},o.a.createElement(u.a,{title:o.a.createElement(d.f,null,e)},o.a.createElement(l,{padding:"1em",gap:"0.75em"},o.a.createElement(d.c,null,t),o.a.createElement("div",{style:{textAlign:"right"}},o.a.createElement(d.a,{asChild:!0},o.a.createElement(c,{onClick:()=>{s.a.removeChild(r),a.a.unmountComponentAtNode(r),n()},ref:e=>e&&e.focus()},"OK")))))));a.a.render(i,r)})))}async function v(e,t){return y(new Promise((n=>{const r=document.createElement("div");s.a.appendChild(r);const i=o.a.createElement(d.e,{open:!0},o.a.createElement(d.d,{className:"AlertDialogのoverlay"}),o.a.createElement(d.b,{className:"AlertDialogのcontent"},o.a.createElement(u.a,{title:o.a.createElement(d.f,null,t.title)},o.a.createElement(l,{padding:"1em",gap:"0.75em"},o.a.createElement(m,{items:e,onSelect:e=>{s.a.removeChild(r),a.a.unmountComponentAtNode(r),n(e)}})))));a.a.render(i,r)})))}const b=new Set;function y(e){return b.add(e),Promise.resolve(e).finally((()=>{b.delete(e)})),e}function _(){return b.size>0}},585:function(e,t,n){var r=n(586);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:undefined,insertInto:void 0};n(0)(r,o);r.locals&&(e.exports=r.locals)},586:function(e,t,n){(e.exports=n(1)(!1)).push([e.i,'@charset "UTF-8";\n.Panel {\n  border: 1px solid #151413;\n  border-radius: 4px 4px 0 0;\n  box-shadow: 0 2px 20px rgba(0, 0, 0, 0.3);\n  background: #353433;\n}\n.Panelのtitle {\n  background: #252423 linear-gradient(to bottom, #353433 0%, #252423 50%, #151413 50%, #252423 100%);\n  border-bottom: 0;\n  text-align: center;\n  color: #8b8685;\n  padding: 0.5ex 1em;\n}\n.Panelのtitle > h2 {\n  margin: 0;\n  font: inherit;\n}',""])},60:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0}),t.Speedcore=void 0;var r=n(238),o=function(){function e(e){e.forEach(r.Segment),this._segments=e}return e.prototype._reached=function(e,t,n){if(e>=this._segments.length)return!1;var r=this._segments[e],o=t(r);return r.inclusive?n>=o:n>o},e.prototype._segmentAt=function(e,t){for(var n=0;n<this._segments.length;n++)if(!this._reached(n+1,e,t))return this._segments[n];throw new Error("Unable to find a segment matching a criteria (this should never happen)!")},e.prototype.segmentAtX=function(e){return this._segmentAt(a,e)},e.prototype.segmentAtT=function(e){return this._segmentAt(i,e)},e.prototype.t=function(e){var t=this.segmentAtX(e);return t.t+(e-t.x)/(t.dx||1)},e.prototype.x=function(e){var t=this.segmentAtT(e);return t.x+(e-t.t)*t.dx},e.prototype.dx=function(e){return this.segmentAtT(e).dx},e}();t.Speedcore=o;var i=function(e){return e.t},a=function(e){return e.x}},608:function(e,t,n){"use strict";(function(e){var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__awaiter||function(e,t,n,r){return new(n||(n=Promise))((function(o,i){function a(e){try{u(r.next(e))}catch(e){i(e)}}function s(e){try{u(r.throw(e))}catch(e){i(e)}}function u(e){var t;e.done?o(e.value):(t=e.value,t instanceof n?t:new n((function(e){e(t)}))).then(a,s)}u((r=r.apply(e,t||[])).next())}))},s=this&&this.__generator||function(e,t){var n,r,o,i,a={label:0,sent:function(){if(1&o[0])throw o[1];return o[1]},trys:[],ops:[]};return i={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(i[Symbol.iterator]=function(){return this}),i;function s(i){return function(s){return function(i){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,r&&(o=2&i[0]?r.return:i[0]?r.throw||((o=r.return)&&o.call(r),0):r.next)&&!(o=o.call(r,i[1])).done)return o;switch(r=0,o&&(i=[2&i[0],o.value]),i[0]){case 0:case 1:o=i;break;case 4:return a.label++,{value:i[1],done:!1};case 5:a.label++,r=i[1],i=[0];continue;case 7:i=a.ops.pop(),a.trys.pop();continue;default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==i[0]&&2!==i[0])){a=0;continue}if(3===i[0]&&(!o||i[1]>o[0]&&i[1]<o[3])){a.label=i[1];break}if(6===i[0]&&a.label<o[1]){a.label=o[1],o=i;break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(i);break}o[2]&&a.ops.pop(),a.trys.pop();continue}i=t.call(e,a)}catch(e){i=[6,e],r=0}finally{n=o=0}if(5&i[0])throw i[1];return{value:i[0]?i[1]:void 0,done:!0}}([i,s])}}};Object.defineProperty(t,"__esModule",{value:!0}),t.NotechartLoader=void 0;var u=i(n(85)),c=i(n(291)),l=i(n(610)),d=function(t){return e.isBuffer(t)?t:e.from(new Uint8Array(t))},f=function(){function e(){}return e.prototype.load=function(e,t,n){return t.name.match(/\.bmson$/i)?this.loadBmson(e,t,n):this.loadBMS(e,t,n)},e.prototype.loadBMS=function(e,t,n){return a(this,void 0,void 0,(function(){var r,o,i,a,l;return s(this,(function(s){switch(s.label){case 0:return r=d(e),o=u.Reader.getReaderOptionsFromFilename(t.name),[4,u.Reader.readAsync(r,o)];case 1:return i=s.sent(),a=u.Compiler.compile(i),l=a.chart,[2,c.fromBMSChart(l,n)]}}))}))},e.prototype.loadBmson=function(e,t,n){return a(this,void 0,void 0,(function(){var t,r;return s(this,(function(o){return t=d(e),r=t.toString("utf-8"),[2,l.load(r,n)]}))}))},e}();t.NotechartLoader=f,t.default=f}).call(this,n(37).Buffer)},610:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.load=void 0;var s=i(n(611)),u=i(n(85)),c=a(n(179));function l(e){var t=(e.info&&e.info.judge_rank&&+e.info.judge_rank||100)/100;return[18*t,40*t]}t.load=function(e,t){var n=JSON.parse(e),r=s.songInfoForBmson(n),o=s.musicalScoreForBmson(n,{double:t.double}),i=s.barLinesForBmson(n),a={notes:o.notes.all(),timing:o.timing,keysounds:o.keysounds,songInfo:r,positioning:new u.Positioning([{t:0,x:0,dx:1,inclusive:!0}]),spacing:new u.Spacing([]),barLines:i,images:{eyecatch:n.info.eyecatch_image,background:n.info.back_image},expertJudgmentWindow:l(n)};return new c.default(a,t)}},611:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)},s=this&&this.__read||function(e,t){var n="function"==typeof Symbol&&e[Symbol.iterator];if(!n)return e;var r,o,i=n.call(e),a=[];try{for(;(void 0===t||t-- >0)&&!(r=i.next()).done;)a.push(r.value)}catch(e){o={error:e}}finally{try{r&&!r.done&&(n=i.return)&&n.call(i)}finally{if(o)throw o.error}}return a},u=this&&this.__spreadArray||function(e,t,n){if(n||2===arguments.length)for(var r,o=0,i=t.length;o<i;o++)!r&&o in t||(r||(r=Array.prototype.slice.call(t,0,o)),r[o]=t[o]);return e.concat(r||Array.prototype.slice.call(t))},c=this&&this.__values||function(e){var t="function"==typeof Symbol&&Symbol.iterator,n=t&&e[t],r=0;if(n)return n.call(e);if(e&&"number"==typeof e.length)return{next:function(){return e&&r>=e.length&&(e=void 0),{value:e&&e[r++],done:!e}}};throw new TypeError(t?"Object is not iterable.":"Symbol.iterator is not defined.")},l=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.keysForBmson=t.hasScratch=t.beatForPulseForBmson=t._slicesForNotesAndTiming=t.musicalScoreForBmson=t.timingInfoForBmson=t.barLinesForBmson=t.songInfoForBmson=void 0;var d=l(n(27)),f=i(n(85)),h=i(n(320)),p=i(n(321));function m(e){if(!e.version)return h.timingInfoForBmson(e);var t=b(e);return{initialBPM:e.info.init_bpm,actions:u(u([],s((e.bpm_events||[]).map((function(e){var n=e.y,r=e.bpm;return{type:"bpm",beat:t(n),bpm:r}}))),!1),s((e.stop_events||[]).map((function(e){var n=e.y,r=e.duration;return{type:"stop",beat:t(n),stopBeats:t(Math.floor(r))}}))),!1)}}function g(e){return e.version?e.sound_channels:e.soundChannel}a(n(612),t),t.songInfoForBmson=function(e){var t=e.info,n={};return t.title&&(n.title=t.title),t.artist&&(n.artist=t.artist),t.genre&&(n.genre=t.genre),t.level&&(n.level=t.level),n.subtitles=function(){if(!e.version)return["Warning: legacy bmson"];var n=[];t.chart_name&&"string"==typeof t.chart_name&&n.push(t.chart_name);t.subtitle&&"string"==typeof t.subtitle&&n.push.apply(n,u([],s(t.subtitle.split("\n")),!1));return n}(),t.subartists&&(n.subartists=t.subartists),new f.SongInfo(n)},t.barLinesForBmson=function(e){if(!e.version)return h.barLinesForBmson(e);var t=b(e),n=e.lines;return(0,d.default)(n).map((function(e){var n=e.y;return t(n)})).sortBy().value()},t.timingInfoForBmson=m,t.musicalScoreForBmson=function(e,t){void 0===t&&(t={});var n=function(e){var t=m(e),n=t.initialBPM,r=t.actions;return new f.Timing(n,r)}(e),r=function(e,t,n){var r,o,i,a,s=1,u=b(e),l=[],f={},h=g(e);if(h)try{for(var m=c(h),v=m.next();!v.done;v=m.next()){var _=v.value,w=_.name,S=_.notes,x=d.default.sortBy(S,"y"),B=s++,P=d.default.padStart(""+B,4,"0"),E=p.slicesForNotesAndTiming(S,t,{beatForPulse:u});f[P]=w;try{for(var M=(i=void 0,c(x)),j=M.next();!j.done;j=M.next()){var O=j.value,T=O.x,C=O.y,N=O.l,k={column:y(T,n),beat:u(C),keysound:P,endBeat:void 0};N>0&&(k.endBeat=u(C+N));var I=E.get(C);I&&(Object.assign(k,I),l.push(k))}}catch(e){i={error:e}}finally{try{j&&!j.done&&(a=M.return)&&a.call(M)}finally{if(i)throw i.error}}}}catch(e){r={error:e}}finally{try{v&&!v.done&&(o=m.return)&&o.call(m)}finally{if(r)throw r.error}}return{notes:l,keysounds:f}}(e,n,t),o=r.notes,i=r.keysounds;return{timing:n,notes:new f.Notes(o),keysounds:new f.Keysounds(i)}};var v=n(320);function b(e){if(!e.version)return h.beatForLoc;var t=e.info&&e.info.resolution||240;return function(e){return e/t}}function y(e,t){switch(e){case 1:return"1";case 2:return"2";case 3:return"3";case 4:return"4";case 5:return"5";case 6:return"6";case 7:return"7";case 8:return"SC"}if(t.double)switch(e){case 9:return"8";case 10:return"9";case 11:return"10";case 12:return"11";case 13:return"12";case 14:return"13";case 15:return"14";case 16:return"SC2"}}Object.defineProperty(t,"_slicesForNotesAndTiming",{enumerable:!0,get:function(){return v._slicesForNotesAndTiming}}),t.beatForPulseForBmson=b,t.hasScratch=function(e){var t,n,r,o,i=g(e);if(i)try{for(var a=c(i),s=a.next();!s.done;s=a.next()){var u=s.value.notes;try{for(var l=(r=void 0,c(u)),d=l.next();!d.done;d=l.next()){var f=d.value.x;if(8===f||18===f)return!0}}catch(e){r={error:e}}finally{try{d&&!d.done&&(o=l.return)&&o.call(l)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{s&&!s.done&&(n=a.return)&&n.call(a)}finally{if(t)throw t.error}}return!1},t.keysForBmson=function(e){var t,n,r,o,i=g(e),a=!1,s=!1,u=!1;if(i)try{for(var l=c(i),d=l.next();!d.done;d=l.next()){var f=d.value.notes;try{for(var h=(r=void 0,c(f)),p=h.next();!p.done;p=h.next()){var m=p.value.x;a=!0,m>=11&&m<=20&&(s=!0),6!==m&&7!==m&&16!==m&&17!==m||(u=!0)}}catch(e){r={error:e}}finally{try{p&&!p.done&&(o=h.return)&&o.call(h)}finally{if(r)throw r.error}}}}catch(e){t={error:e}}finally{try{d&&!d.done&&(n=l.return)&&n.call(l)}finally{if(t)throw t.error}}return a?s?u?"14K":"10K":u?"7K":"5K":"empty"}},612:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0})},79:function(e,t,n){"use strict";t.a=function(e){return{as:t=>new Promise((function(n,r){const o=new FileReader;switch(o.onload=function(){n(o.result)},o.onerror=function(){r(new Error("Unable to read from Blob"))},t){case"arraybuffer":o.readAsArrayBuffer(e);break;case"text":o.readAsText(e)}}))}}},80:function(e,t,n){"use strict";var r=this&&this.__importDefault||function(e){return e&&e.__esModule?e:{default:e}};Object.defineProperty(t,"__esModule",{value:!0}),t.assign=t.values=t.map=t.uniq=void 0;var o=r(n(538));t.uniq=o.default;var i=r(n(539));t.map=i.default;var a=r(n(540));t.values=a.default;var s=r(n(541));t.assign=s.default},85:function(e,t,n){"use strict";var r=this&&this.__createBinding||(Object.create?function(e,t,n,r){void 0===r&&(r=n);var o=Object.getOwnPropertyDescriptor(t,n);o&&!("get"in o?!t.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return t[n]}}),Object.defineProperty(e,r,o)}:function(e,t,n,r){void 0===r&&(r=n),e[r]=t[n]}),o=this&&this.__setModuleDefault||(Object.create?function(e,t){Object.defineProperty(e,"default",{enumerable:!0,value:t})}:function(e,t){e.default=t}),i=this&&this.__importStar||function(e){if(e&&e.__esModule)return e;var t={};if(null!=e)for(var n in e)"default"!==n&&Object.prototype.hasOwnProperty.call(e,n)&&r(t,e,n);return o(t,e),t},a=this&&this.__exportStar||function(e,t){for(var n in e)"default"===n||Object.prototype.hasOwnProperty.call(t,n)||r(t,e,n)};Object.defineProperty(t,"__esModule",{value:!0}),t.Compiler=t.Reader=void 0;var s=i(n(234));t.Reader=s;var u=i(n(236));t.Compiler=u,a(n(237),t),a(n(39),t),a(n(108),t),a(n(109),t),a(n(60),t),a(n(110),t),a(n(239),t),a(n(242),t),a(n(243),t),a(n(244),t),a(n(245),t),a(n(246),t)},99:function(e,t,n){"use strict";t.a=document.querySelector("#scene-root")}}]);
//# sourceMappingURL=previewer-a591c62a242a814f9b89.js.map