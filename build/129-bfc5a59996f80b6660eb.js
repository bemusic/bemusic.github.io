"use strict";(this.webpackChunk=this.webpackChunk||[]).push([[129],{68609:function(n,e,t){var i=t(95970),o=t.n(i),s=t(50146),a=t.n(s),r=t(93548),c=t.n(r),l=new URL(t(65319),t.b),A=a()(o()),u=c()(l)
A.push([n.id,'@charset "UTF-8";\n.LoadingScene {\n  background: url('+u+") center no-repeat;\n  background-size: cover;\n}\n.LoadingSceneのinfo {\n  position: absolute;\n  top: 40%;\n  left: 0;\n  right: 0;\n  transform: translateY(-50%);\n}\n.LoadingScene .LoadingSceneSongInfo {\n  animation: loading-scene--loading-scene-song-info--animation 1s ease;\n}\n.LoadingScene .LoadingSceneProgress {\n  position: absolute;\n  bottom: 10px;\n  left: 10px;\n}\n.LoadingSceneのimage {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n}\n.LoadingSceneのimage img {\n  width: 100%;\n  height: 100%;\n  display: block;\n  object-fit: cover;\n  animation: loading-scene--eyecatch-fade 0.8s;\n}\n.LoadingSceneのflash {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  opacity: 0;\n  pointer-events: none;\n  background: white;\n  animation: loading-scene--flash-animation 0.8s ease-out;\n}\n.LoadingSceneのcover {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  opacity: 0;\n  pointer-events: none;\n  background: black;\n}\n.Scene.is-exiting .LoadingSceneのinfo {\n  animation: loading-scene--info-exit 0.3s linear;\n}\n.Scene.is-exiting .LoadingSceneのflash {\n  animation: loading-scene--flash-exit 0.3s ease;\n}\n.Scene.is-exiting .LoadingSceneのcover {\n  animation: loading-scene--cover-exit 0.3s linear;\n  opacity: 1;\n}\n\n@keyframes loading-scene--eyecatch-fade {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n@keyframes loading-scene--loading-scene-song-info--animation {\n  0% {\n    transform: scale(1.5, 0.02);\n  }\n  100% {\n    transform: scale(1, 1);\n  }\n}\n@keyframes loading-scene--info-exit {\n  0% {\n    transform: translateY(-50%) scale(1, 1);\n  }\n  100% {\n    transform: translateY(-50%) scale(2, 2);\n  }\n}\n@keyframes loading-scene--cover-exit {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n@keyframes loading-scene--flash-animation {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n@keyframes loading-scene--flash-exit {\n  0% {\n    opacity: 0.5;\n  }\n  100% {\n    opacity: 0;\n  }\n}","",{version:3,sources:["webpack://./game/ui/LoadingScene.scss","webpack://./ui/common.scss"],names:[],mappings:"AAAA,gBAAgB;AAEhB;EC+CE,oEAAA;EACA,sBAAA;AD9CF;AACE;EACE,kBAAA;EACA,QAAA;EACA,OAAA;EACA,QAAA;EACA,2BAAA;AACJ;AAEE;EACE,oEAAA;AAAJ;AAGE;EACE,kBAAA;EACA,YAAA;EACA,UAAA;AADJ;AAIE;EACE,kBAAA;EACA,MAAA;EACA,QAAA;EACA,SAAA;EACA,OAAA;AAFJ;AAKE;EACE,WAAA;EACA,YAAA;EACA,cAAA;EACA,iBAAA;EACA,4CAAA;AAHJ;AAME;EACE,kBAAA;EACA,MAAA;EACA,QAAA;EACA,SAAA;EACA,OAAA;EACA,UAAA;EACA,oBAAA;EAEA,iBAAA;EACA,uDAAA;AALJ;AAQE;EACE,kBAAA;EACA,MAAA;EACA,QAAA;EACA,SAAA;EACA,OAAA;EACA,UAAA;EACA,oBAAA;EAEA,iBAAA;AAPJ;AAWI;EACE,+CAAA;AATN;AAWI;EACE,8CAAA;AATN;AAWI;EACE,gDAAA;EACA,UAAA;AATN;;AAcA;EACE;IACE,UAAA;EAXF;EAaA;IACE,UAAA;EAXF;AACF;AAcA;EACE;IACE,2BAAA;EAZF;EAcA;IACE,sBAAA;EAZF;AACF;AAeA;EACE;IACE,uCAAA;EAbF;EAeA;IACE,uCAAA;EAbF;AACF;AAgBA;EACE;IACE,UAAA;EAdF;EAgBA;IACE,UAAA;EAdF;AACF;AAiBA;EACE;IACE,UAAA;EAfF;EAiBA;IACE,UAAA;EAfF;AACF;AAkBA;EACE;IACE,YAAA;EAhBF;EAkBA;IACE,UAAA;EAhBF;AACF",sourcesContent:["@import '~bemuse/ui/common';\n\n.LoadingScene {\n  @include main-bg;\n\n  &のinfo {\n    position: absolute;\n    top: 40%;\n    left: 0;\n    right: 0;\n    transform: translateY(-50%);\n  }\n\n  .LoadingSceneSongInfo {\n    animation: loading-scene--loading-scene-song-info--animation 1s ease;\n  }\n\n  .LoadingSceneProgress {\n    position: absolute;\n    bottom: 10px;\n    left: 10px;\n  }\n\n  &のimage {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n  }\n\n  &のimage img {\n    width: 100%;\n    height: 100%;\n    display: block;\n    object-fit: cover;\n    animation: loading-scene--eyecatch-fade 0.8s;\n  }\n\n  &のflash {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    opacity: 0;\n    pointer-events: none;\n\n    background: white;\n    animation: loading-scene--flash-animation 0.8s ease-out;\n  }\n\n  &のcover {\n    position: absolute;\n    top: 0;\n    right: 0;\n    bottom: 0;\n    left: 0;\n    opacity: 0;\n    pointer-events: none;\n\n    background: black;\n  }\n\n  .Scene.is-exiting & {\n    &のinfo {\n      animation: loading-scene--info-exit 0.3s linear;\n    }\n    &のflash {\n      animation: loading-scene--flash-exit 0.3s ease;\n    }\n    &のcover {\n      animation: loading-scene--cover-exit 0.3s linear;\n      opacity: 1;\n    }\n  }\n}\n\n@keyframes loading-scene--eyecatch-fade {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n@keyframes loading-scene--loading-scene-song-info--animation {\n  0% {\n    transform: scale(1.5, 0.02);\n  }\n  100% {\n    transform: scale(1, 1);\n  }\n}\n\n@keyframes loading-scene--info-exit {\n  0% {\n    transform: translateY(-50%) scale(1, 1);\n  }\n  100% {\n    transform: translateY(-50%) scale(2, 2);\n  }\n}\n\n@keyframes loading-scene--cover-exit {\n  0% {\n    opacity: 0;\n  }\n  100% {\n    opacity: 1;\n  }\n}\n\n@keyframes loading-scene--flash-animation {\n  0% {\n    opacity: 1;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n\n@keyframes loading-scene--flash-exit {\n  0% {\n    opacity: 0.5;\n  }\n  100% {\n    opacity: 0;\n  }\n}\n","// The common library for user interface.\n// This file must not emit any CSS code! It can only contain variable,\n// mixin, or silent class declarations.\n\n$ui-font: 'Source Sans Pro', 'Segoe UI', 'Helvetica Neue', sans-serif;\n$link-color: #039;\n\n@mixin full-screen {\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n}\n\n@mixin full-screen-fixed {\n  position: fixed;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n}\n\n@mixin centered {\n  position: absolute;\n  top: 50%;\n  left: 50%;\n  transform: translate(-50%, -50%);\n}\n\n@mixin scrolling-y {\n  overflow-x: hidden;\n  overflow-y: auto;\n  -webkit-overflow-scrolling: touch;\n}\n\n@mixin scrolling-x {\n  overflow-x: auto;\n  overflow-y: hidden;\n  -webkit-overflow-scrolling: touch;\n}\n\n@mixin center-content {\n  display: flex;\n  justify-content: center;\n  align-items: center;\n}\n\n@mixin scene-background($url) {\n  background: $url center no-repeat;\n  background-size: cover;\n}\n\n@mixin main-bg {\n  @include scene-background(url(~bemuse/ui/images/bg/a.jpg));\n}\n\n@mixin soft-shadow {\n  box-shadow: 0 0.1vh 3vh rgba(#000, 0.1);\n}\n\n@mixin button {\n  font: inherit;\n  background: #252423 linear-gradient(to bottom, #454443, #151413);\n  border: 1px solid #555453;\n  padding: 0.5ex 1.3ex;\n  color: #fff;\n  border-radius: 4px;\n  box-shadow: 0 1px 3px rgba(#000, 0.5);\n  &:hover {\n    border-color: #656463;\n  }\n  &:focus {\n    border-color: #8b8685;\n    outline: 0;\n  }\n  &:active {\n    background: #252423 linear-gradient(to top, #353433, #151413);\n    border-color: #454443;\n  }\n}\n\n@mixin input {\n  font: inherit;\n  background: #252423 linear-gradient(to bottom, #151413, #292827);\n  border: 1px solid #555453;\n  padding: 0.5ex 1.3ex;\n  color: #fff;\n  border-radius: 4px;\n  box-shadow: 0 1px 3px rgba(#000, 0.5);\n  &:hover {\n    border-color: #656463;\n  }\n  &:focus {\n    border-color: #8b8685;\n    outline: 0;\n  }\n  &:active {\n    border-color: #454443;\n  }\n  &::selection {\n    background: #8b8685;\n    color: #8e8;\n  }\n}\n\n@mixin input-button-zindex($nominal) {\n  position: relative;\n  z-index: $nominal;\n  &:hover {\n    z-index: 30;\n  }\n  &:focus {\n    z-index: 40;\n  }\n  &:active {\n    z-index: 10;\n  }\n}\n"],sourceRoot:""}]),e.Z=A},68572:function(n,e,t){var i=t(95970),o=t.n(i),s=t(50146),a=t.n(s)()(o())
a.push([n.id,'@charset "UTF-8";\n.LoadingSceneProgress {\n  color: #333;\n  font-size: 11px;\n}\n.LoadingSceneProgress .LoadingSceneProgressBar {\n  display: inline-block;\n  vertical-align: middle;\n  width: 48px;\n  margin-right: 4px;\n  position: relative;\n  top: -1px;\n}\n.LoadingSceneProgressのextra {\n  font-size: 83%;\n  opacity: 0.7;\n}',"",{version:3,sources:["webpack://./game/ui/LoadingSceneProgress.scss"],names:[],mappings:"AAAA,gBAAgB;AAAhB;EACE,WAAA;EACA,eAAA;AAEF;AADE;EACE,qBAAA;EACA,sBAAA;EACA,WAAA;EACA,iBAAA;EACA,kBAAA;EACA,SAAA;AAGJ;AADE;EACE,cAAA;EACA,YAAA;AAGJ",sourcesContent:[".LoadingSceneProgress {\n  color: #333;\n  font-size: 11px;\n  .LoadingSceneProgressBar {\n    display: inline-block;\n    vertical-align: middle;\n    width: 48px;\n    margin-right: 4px;\n    position: relative;\n    top: -1px;\n  }\n  &のextra {\n    font-size: 83%;\n    opacity: 0.7;\n  }\n}\n"],sourceRoot:""}]),e.Z=a},34138:function(n,e,t){var i=t(95970),o=t.n(i),s=t(50146),a=t.n(s)()(o())
a.push([n.id,'@charset "UTF-8";\n.LoadingSceneProgressBar {\n  border: 1px solid rgba(0, 0, 0, 0.6);\n  padding: 1px;\n}\n.LoadingSceneProgressBarのbar {\n  height: 8px;\n  background: rgba(0, 0, 0, 0.6);\n  width: 0%;\n}',"",{version:3,sources:["webpack://./game/ui/LoadingSceneProgressBar.scss"],names:[],mappings:"AAAA,gBAAgB;AAAhB;EACE,oCAAA;EACA,YAAA;AAEF;AADE;EACE,WAAA;EACA,8BAAA;EACA,SAAA;AAGJ",sourcesContent:[".LoadingSceneProgressBar {\n  border: 1px solid rgba(#000, 0.6);\n  padding: 1px;\n  &のbar {\n    height: 8px;\n    background: rgba(#000, 0.6);\n    width: 0%;\n  }\n}\n"],sourceRoot:""}]),e.Z=a},8643:function(n,e,t){var i=t(95970),o=t.n(i),s=t(50146),a=t.n(s)()(o())
a.push([n.id,'@charset "UTF-8";\n.LoadingSceneSongInfo {\n  background: rgba(255, 255, 255, 0.96);\n  color: #191817;\n  text-align: center;\n  padding: 25px 0px;\n  box-shadow: 0 2px 18px rgba(0, 0, 0, 0.2);\n}\n.LoadingSceneSongInfoのgenre {\n  font-size: 1.2rem;\n}\n.LoadingSceneSongInfoのtitle {\n  font-size: 3.2rem;\n  font-weight: bold;\n}\n.LoadingSceneSongInfoのsubtitle {\n  font-size: 2.4rem;\n}\n.LoadingSceneSongInfoのartist {\n  font-size: 1.6rem;\n  margin-top: 0.8ex;\n}\n.LoadingSceneSongInfoのsubartist {\n  font-size: 1rem;\n}',"",{version:3,sources:["webpack://./game/ui/LoadingSceneSongInfo.scss"],names:[],mappings:"AAAA,gBAAgB;AAAhB;EACE,qCAAA;EACA,cAAA;EACA,kBAAA;EACA,iBAAA;EACA,yCAAA;AAEF;AAAE;EACE,iBAAA;AAEJ;AAAE;EACE,iBAAA;EACA,iBAAA;AAEJ;AAAE;EACE,iBAAA;AAEJ;AAAE;EACE,iBAAA;EACA,iBAAA;AAEJ;AAAE;EACE,eAAA;AAEJ",sourcesContent:[".LoadingSceneSongInfo {\n  background: rgba(#fff, 0.96);\n  color: #191817;\n  text-align: center;\n  padding: 25px 0px;\n  box-shadow: 0 2px 18px rgba(#000, 0.2);\n\n  &のgenre {\n    font-size: 1.2rem;\n  }\n  &のtitle {\n    font-size: 3.2rem;\n    font-weight: bold;\n  }\n  &のsubtitle {\n    font-size: 2.4rem;\n  }\n  &のartist {\n    font-size: 1.6rem;\n    margin-top: 0.8ex;\n  }\n  &のsubartist {\n    font-size: 1rem;\n  }\n}\n"],sourceRoot:""}]),e.Z=a},58113:function(n,e,t){t.d(e,{Z:function(){return s}})
var i=t(38044),o=t.n(i)
function s(n){return function(e){const t=()=>!1
return o()(window).on("touchstart",t),function(n,e){const{view:t,wrapper:i}=n,{width:s,height:a}=t
function r(){e.removeEventListener("touchstart",r),e.addEventListener("contextmenu",(n=>{n.preventDefault()}))}function c(){const n=Math.min(window.innerWidth/s,window.innerHeight/a)
t.style.width=Math.round(s*n)+"px",t.style.height=Math.round(a*n)+"px",i.style.width=Math.round(s*n)+"px",i.style.height=Math.round(a*n)+"px"
const e=(window.innerHeight-a*n)/2
i.style.marginTop=Math.round(e)+"px"}e.appendChild(i),e.addEventListener("touchstart",r),c(),o()(window).on("resize",c)}(n,e),{teardown(){o()(window).off("touchstart",t)}}}}},95414:function(n,e,t){t.r(e),t.d(e,{load:function(){return I}})
var i=t(41559),o=t.n(i),s=t(57050),a=t(26230),r=t(10426),c=t(55481),l=t(65e3),A=t(62270)
var u=t(7194),d=t(75349)
var p=class{constructor({game:n,samples:e,master:t}){const i=n.options.soundVolume
this._master=t,this._context=t.audioContext,this._players=new Map(n.players.map((n=>[n,new d.Z({player:n,samples:e,master:t,volume:i})])))}destroy(){this._master.destroy()}unmute(){this._master.unmute()}get context(){return this._context}update(n,e){for(const[t,i]of this._players)i.update(n,e.player(t))}},h=t(31647),m=t(80342)
var g=class{constructor(n){n.unmute(),this._context=n.context,this._offset=[],this._sum=0,this.update()}update(){const n=(0,m.Z)()/1e3,e=n-this._context.currentTime
for(this._offset.push(e),this._sum+=e;this._offset.length>60;)this._sum-=this._offset.shift()
this.time=n-this._sum/this._offset.length}},f=t(88371),b=t(47991)
var E=class{constructor(n,e){this._clock=n,this._input=e,this._now=m.Z.synchronized(),this._lastRecordedTimeSinceStart=0,this.startTime=null,this._pauseAtTimerValue=1/0,this._unpausedTimeSinceStart=0,this._unpausedTimerValue=0,this.readyFraction=0,this.gettingStarted=!1}get started(){return null!==this.startTime}update(){this._checkStartGame(),this.time=this._calculateTime()}_checkStartGame(){this.started||(this._input.get("start").value&&(this.gettingStarted=!0),this.gettingStarted&&!this._input.get("start").value&&(this.startTime=this._clock.time+this._getWait()),this.started||(this.readyFraction=1-this._getWait()))}_getWait(){const n=this._now()/1e3
return Math.ceil(n)-n}_calculateTime(){let n=null===this.startTime?0:this._clock.time-this.startTime
if(n<0&&(n=0),n<1)return(Math.pow(n,6)-1)/6-1/30
{const e=n-31/30
this._lastRecordedTimeSinceStart=e
const t=this._unpausedTimerValue+(e-this._unpausedTimeSinceStart)
return Math.min(t,this._pauseAtTimerValue)}}pauseAt(n){this._unpausedTimerValue+(this._lastRecordedTimeSinceStart-this._unpausedTimeSinceStart)>=this._pauseAtTimerValue&&(this._unpausedTimerValue=this._pauseAtTimerValue,this._unpausedTimeSinceStart=this._lastRecordedTimeSinceStart),this._pauseAtTimerValue=n}},y=t(7611)
class _{constructor(){this.input=[0,0],this.last=0,this.output=0}combine(...n){for(let e=0;e<2;++e)n[e]&&this.input[e]<=0?(this.input[e]=1,this.last=e):!n[e]&&this.input[e]>0?this.input[e]=-1:this.input[e]%2!=0&&(this.input[e]+=1)
return 1!==this.input[0]&&1!==this.input[1]||(this.output=0===this.last?1:-1),this.input[this.last]<=0&&(this.output=0),this.output}}var v=function(n){const e=new y.FB(window,{exclusive:!0,continuous:n.players[0].options.input.continuous,sensitivity:n.players[0].options.input.sensitivity}),t=n.players[0].options.input.keyboard,i=new _,o=Object.values(t).indexOf("gamepad.0.button.8")<0,s=Object.values(t).indexOf("gamepad.0.button.9")<0
return{name:"GameKBPlugin",get(){const n=e.update(),a={p1_1:n[t[1]||"83"],p1_2:n[t[2]||"68"],p1_3:n[t[3]||"70"],p1_4:n[t[4]||"32"],p1_5:n[t[5]||"74"],p1_6:n[t[6]||"75"],p1_7:n[t[7]||"76"],p1_SC:i.combine(n[t.SC||"65"],n[t.SC2||"16"]),p1_speedup:n[38],p1_speeddown:n[40],start:n[13]||s&&n["gamepad.0.button.9"],select:n[18]||o&&n["gamepad.0.button.8"]}
return(a.start||a.select)&&((a.p1_1||a.p1_3||a.p1_5||a.p1_7)&&(a.p1_speeddown=!0),(a.p1_2||a.p1_4||a.p1_6)&&(a.p1_speedup=!0)),a},destroy(){e.dispose()}}},S=t(57317),x=t(92129)
var C=class{constructor({game:n,display:e,audio:t}){this._audioInputLatency=n.options.audioInputLatency,this._game=n,this._display=e,this._audio=t,this._clock=new g(this._audio),this._input=new f.Z,this._timer=new E(this._clock,this._input),this._state=new b.Z(n),this._promise=new Promise((n=>this._resolvePromise=n)),this._display.setEscapeHandler((()=>this._quitGame())),this._display.setReplayHandler((()=>this._replayGame())),this.initializeBenchmark(),this.initializeTestModeHooks()}get game(){return this._game}get display(){return this._display}get audio(){return this._audio}get promise(){return this._promise}get state(){return this._state}get latestGameTime(){return this._latestGameTime}start(){this._handleEscape(),this._display.start(),this._input.use(new v(this._game)),this._input.use(new S.Z(this._display.context))
let n=!1
const e=()=>{n||(this._update(),requestAnimationFrame(e))}
requestAnimationFrame(e),this._endGameLoop=()=>n=!0}_handleEscape(){const n=n=>{27===n.keyCode?(n.preventDefault(),n.stopPropagation(),this._quitGame()):112===n.keyCode&&(n.preventDefault(),n.stopPropagation(),this._replayGame())}
window.addEventListener("keydown",n,!0),this._promise.finally((function(){window.removeEventListener("keydown",n,!0)}))}_quitGame(){this._resolvePromise({finished:!1,replay:!1})}_replayGame(){this._resolvePromise({finished:!1,replay:!0})}destroy(){this._endGameLoop(),this._audio.destroy(),this._input.destroy(),this._display.destroy()}_update(){this._clock.update(),this._input.update(),this._timer.update()
const n=this._timer.time,e=this._audioInputLatency
this._latestGameTime=n,this._state.update(n-e,this._input,this._timer),this._audio.update(n,this._state),this._display.update(n-e,this._state),this._state.finished&&this._resolvePromise&&(this._resolvePromise({finished:!0}),this._resolvePromise=null)}initializeBenchmark(){x.Z.enabled&&(x.Z.benchmark("update",this,"_update"),x.Z.benchmark("input_update",this._input,"update"),x.Z.benchmark("state_update",this._state,"update"),x.Z.benchmark("audio_update",this._audio,"update"),x.Z.benchmark("display_update",this._display,"update"),x.Z.benchmark("display_compute",this._display,"_getData"),x.Z.benchmark("display_push",this._display._context._instance,"push"),x.Z.benchmark("display_render",this._display._context._renderer,"render"))}initializeTestModeHooks(){h.isTestModeEnabled()&&h.setGameLifecycleHandler({pauseAt:n=>(this._timer.pauseAt(n),new Promise((e=>{const t=setInterval((()=>{this._timer.time>=n&&(clearInterval(t),e())}))}))),unpause:()=>{this._timer.pauseAt(1/0)},getScore:()=>{const n=this._state
return n.player(n.game.players[0]).stats.score}})}},w=t(81368),k=t(26215)
var L=function(n,e){return n.file(e).then((n=>n.read())).then((n=>new Blob([n]))).then((n=>URL.createObjectURL(n))).then((n=>new Promise(((e,t)=>{const i=new Image
i.onload=()=>e(i),i.onerror=t,i.src=n}))))},B=t(68930)
function I(n){const e=n.assets,i=n.bms,d=n.songId
return function(n){const e={},t={},i=[]
function o(n,t,o,r){const c=new s.Z
t&&i.push({text:t,progress:c}),e[n]=function(){return Promise.all(o.map(a)).then((n=>r(...n.concat([c]))))}}function a(n){return t[n]||(t[n]=e[n]())}function r(){return i.map((n=>({text:n.text,progress:n.progress.progress,progressText:n.progress.toString()})))}o.bar=function(n,e){i.push({text:n,progress:e})}
const c=n(o,a),u=new l.Z(r()),d=(0,A.throttle)((function(){u.value=r()}),16)
for(const n of i)n.progress.watch(d)
return{tasks:u,promise:c,get:a}}((function(l,A){l("Scintillator","Loading game engine",[],(function(n){return(0,a.UP)(n,Promise.all([t.e(849),t.e(236)]).then(t.bind(t,8050)))})),l("Skin","Loading skin",["Scintillator"],(function(e,t){return e.load(e.getSkinUrl({displayMode:n.displayMode}),t)})),l("SkinContext",null,["Scintillator","Skin"],(function(n,e){return new n.Context(e,{touchEventTarget:window})})),e.progress&&(e.progress.current&&l.bar("Loading package",e.progress.current),e.progress.all&&l.bar("Loading song packages",e.progress.all)),l("Notechart","Loading "+n.bms.name,[],(async e=>{const t=new(o()),s=await i.read(e)
return t.load(s,n.bms,n.options.players[0])})),l("EyecatchImage",null,["Notechart"],(function(t){if(n.eyecatchImageUrl){const[t,i]=(0,B.V)(e,n.eyecatchImageUrl)
return L(t,i)}return L(e,t.eyecatchImage)})),l("BackgroundImage",null,["Notechart"],(function(t){if(n.backImageUrl){const[t,i]=(0,B.V)(e,n.backImageUrl)
return L(t,i)}return L(e,t.backgroundImage)}))
const h=new s.Z,m=new s.Z
return l.bar("Loading audio",h),l.bar("Decoding audio",m),l("SamplingMaster",null,[],(async()=>new r.ZP)),l("Video",n.videoUrl?"Loading video":null,["Notechart"],(async function(t,i){if(!n.videoUrl)return Promise.resolve(null)
let o=n.videoUrl
if(!o.includes("://")){const[n,t]=(0,B.V)(e,o),i=await n.file(t)
o=await i.resolveUrl()}return new Promise(((e,t)=>{const s=document.createElement("video")
if(!s.canPlayType("video/webm"))return e(null)
function a(){s.buffered&&s.buffered.length&&s.duration&&i.report(s.buffered.end(0)-s.buffered.start(0),s.duration)}function r(){s.removeEventListener("progress",a,!0),s.removeEventListener("canplaythrough",c,!0),s.removeEventListener("error",l,!0),s.removeEventListener("abort",l,!0)}function c(){r()
const t=s.duration||100
i.report(t,t),e({element:s,offset:n.videoOffset})}function l(){r(),console.warn("Cannot load video... Just skip it!"),e(null)}s.src=o,s.preload="auto",s.addEventListener("progress",a,!0),s.addEventListener("canplaythrough",c,!0),s.addEventListener("error",l,!0),s.addEventListener("abort",l,!0),s.load()}))})),l("Game",null,["Notechart"],(async e=>new u.Z([e],n.options))),l("GameDisplay",null,["Game","SkinContext","Video"],(async(n,e,t)=>new w.Z({game:n,context:e,backgroundImagePromise:A("BackgroundImage"),video:t}))),l("Samples",null,["SamplingMaster","Game"],(function(n,t){c.Z.receiveSongId(d)
return new k.Z(e,n).loadFiles(t.samples,h,m)})),l("GameAudio",null,["Game","Samples","SamplingMaster"],(async(n,e,t)=>new p({game:n,samples:e,master:t}))),l("GameController",null,["Game","GameDisplay","GameAudio"],(async(n,e,t)=>new C({game:n,display:e,audio:t}))),A("GameController")}))}},33813:function(n,e,t){t.d(e,{Z:function(){return M}})
var i=t(87672),o=t.n(i),s=t(95541),a=t.n(s),r=t(24324),c=t.n(r),l=t(26419),A=t.n(l),u=t(15669),d=t.n(u),p=t(95076),h=t.n(p),m=t(68609),g={}
g.styleTagTransform=h(),g.setAttributes=A(),g.insert=c().bind(null,"head"),g.domAPI=a(),g.insertStyleElement=d()
o()(m.Z,g),m.Z&&m.Z.locals&&m.Z.locals
var f=t(87094),b=t.n(f),E=t(63929),y=t(95280),_=t(21260),v=t(26826),S=t.n(v),x=t(68572),C={}
C.styleTagTransform=h(),C.setAttributes=A(),C.insert=c().bind(null,"head"),C.domAPI=a(),C.insertStyleElement=d()
o()(x.Z,C),x.Z&&x.Z.locals&&x.Z.locals
var w=t(34138),k={}
k.styleTagTransform=h(),k.setAttributes=A(),k.insert=c().bind(null,"head"),k.domAPI=a(),k.insertStyleElement=d()
o()(w.Z,k),w.Z&&w.Z.locals&&w.Z.locals
class L extends E.Component{render(){return E.createElement("div",{className:"LoadingSceneProgressBar"},E.createElement("div",{className:"LoadingSceneProgressBarのbar",style:{width:this.props.width}}))}}L.propTypes={width:b().oneOfType([b().string,b().number]).isRequired}
class B extends E.Component{constructor(){super(...arguments),this.renderItem=({text:n,progressText:e,progress:t})=>{const i=Math.round(100*t||0).toString()+"%",o=e?` (${e})`:""
return E.createElement("div",{key:n,className:"LoadingSceneProgressのitem"},E.createElement(L,{width:i}),n,E.createElement("span",{className:"LoadingSceneProgressのextra"},o))}}render(){return E.createElement("div",{className:"LoadingSceneProgress"},this.props.tasks.value.map((n=>this.renderItem(n))))}componentDidMount(){this._unsubscribe=this.props.tasks.watch((()=>this.forceUpdate()))}componentWillUnmount(){this._unsubscribe()}}B.propTypes={tasks:b().object}
var I=t(8643),T={}
T.styleTagTransform=h(),T.setAttributes=A(),T.insert=c().bind(null,"head"),T.domAPI=a(),T.insertStyleElement=d()
o()(I.Z,T),I.Z&&I.Z.locals&&I.Z.locals
var P=t(14865)
class Z extends E.Component{render(){const n=this.props.song
return E.createElement("div",{className:"LoadingSceneSongInfo"},E.createElement("div",{className:"LoadingSceneSongInfoのgenre"},n.genre),E.createElement("div",{className:"LoadingSceneSongInfoのtitle"},n.title),(0,P.Xb)()?null:n.subtitles.map((n=>E.createElement("div",{key:n,className:"LoadingSceneSongInfoのsubtitle"},n))),E.createElement("div",{className:"LoadingSceneSongInfoのartist"},n.artist),n.subartists.map((n=>E.createElement("div",{key:n,className:"LoadingSceneSongInfoのsubartist"},n))))}}Z.propTypes={song:b().shape({title:b().string,artist:b().string,genre:b().string,subtitles:b().arrayOf(b().string),subartists:b().arrayOf(b().string),difficulty:b().number,level:b().number}).isRequired}
class M extends E.Component{render(){return E.createElement(_.Z,{className:"LoadingScene",ref:"scene"},E.createElement("div",{className:"LoadingSceneのimage",ref:"eyecatch"}),E.createElement("div",{className:"LoadingSceneのinfo"},E.createElement(Z,{song:this.props.song})),E.createElement(B,{tasks:this.props.tasks}),E.createElement("div",{className:"LoadingSceneのflash"}),E.createElement("div",{className:"LoadingSceneのcover"}))}componentDidMount(){this.props.eyecatchImagePromise&&this.props.eyecatchImagePromise.then((n=>{y.findDOMNode(this.refs.eyecatch).appendChild(n)})),this.props.registerTeardownCallback((()=>(y.findDOMNode(this.refs.scene).classList.add("is-exiting"),S()(500))))}}M.propTypes={song:b().shape({title:b().string,artist:b().string,genre:b().string,subtitles:b().arrayOf(b().string),subartists:b().arrayOf(b().string),difficulty:b().number,level:b().number}),tasks:b().object,eyecatchImagePromise:b().object,registerTeardownCallback:b().func}},68930:function(n,e,t){t.d(e,{V:function(){return o}})
var i=t(96011)
function o(n,e){if(e.includes("://"))return[new i.CA(new URL(e)),e.split("/").slice(-1)[0]]
const t=e.split("/")
let o=n
for(;t.length>1;){const n=t.shift()
o=new s(o,n)}return[o,t[0]]}class s{constructor(n,e){this.base=n,this.dirName=e}async file(n){return this.base.file(`${this.dirName}/${n}`)}}},87293:function(n,e,t){var i=this&&this.__createBinding||(Object.create?function(n,e,t,i){void 0===i&&(i=t)
var o=Object.getOwnPropertyDescriptor(e,t)
o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,i,o)}:function(n,e,t,i){void 0===i&&(i=t),n[i]=e[t]}),o=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),s=this&&this.__importStar||function(n){if(n&&n.__esModule)return n
var e={}
if(null!=n)for(var t in n)"default"!==t&&Object.prototype.hasOwnProperty.call(n,t)&&i(e,n,t)
return o(e,n),e},a=this&&this.__importDefault||function(n){return n&&n.__esModule?n:{default:n}}
Object.defineProperty(e,"__esModule",{value:!0}),e.load=void 0
var r=s(t(64708)),c=s(t(35982)),l=a(t(96008))
function A(n){var e=(n.info&&n.info.judge_rank&&+n.info.judge_rank||100)/100
return[18*e,40*e]}e.load=function(n,e){var t=JSON.parse(n),i=r.songInfoForBmson(t),o=r.musicalScoreForBmson(t,{double:e.double}),s=r.barLinesForBmson(t),a={notes:o.notes.all(),timing:o.timing,keysounds:o.keysounds,songInfo:i,positioning:new c.Positioning([{t:0,x:0,dx:1,inclusive:!0}]),spacing:new c.Spacing([]),barLines:s,images:{eyecatch:t.info.eyecatch_image,background:t.info.back_image},expertJudgmentWindow:A(t)}
return new l.default(a,e)}},41559:function(n,e,t){var i=t(795).Buffer,o=this&&this.__createBinding||(Object.create?function(n,e,t,i){void 0===i&&(i=t)
var o=Object.getOwnPropertyDescriptor(e,t)
o&&!("get"in o?!e.__esModule:o.writable||o.configurable)||(o={enumerable:!0,get:function(){return e[t]}}),Object.defineProperty(n,i,o)}:function(n,e,t,i){void 0===i&&(i=t),n[i]=e[t]}),s=this&&this.__setModuleDefault||(Object.create?function(n,e){Object.defineProperty(n,"default",{enumerable:!0,value:e})}:function(n,e){n.default=e}),a=this&&this.__importStar||function(n){if(n&&n.__esModule)return n
var e={}
if(null!=n)for(var t in n)"default"!==t&&Object.prototype.hasOwnProperty.call(n,t)&&o(e,n,t)
return s(e,n),e},r=this&&this.__awaiter||function(n,e,t,i){return new(t||(t=Promise))((function(o,s){function a(n){try{c(i.next(n))}catch(n){s(n)}}function r(n){try{c(i.throw(n))}catch(n){s(n)}}function c(n){var e
n.done?o(n.value):(e=n.value,e instanceof t?e:new t((function(n){n(e)}))).then(a,r)}c((i=i.apply(n,e||[])).next())}))},c=this&&this.__generator||function(n,e){var t,i,o,s,a={label:0,sent:function(){if(1&o[0])throw o[1]
return o[1]},trys:[],ops:[]}
return s={next:r(0),throw:r(1),return:r(2)},"function"==typeof Symbol&&(s[Symbol.iterator]=function(){return this}),s
function r(r){return function(c){return function(r){if(t)throw new TypeError("Generator is already executing.")
for(;s&&(s=0,r[0]&&(a=0)),a;)try{if(t=1,i&&(o=2&r[0]?i.return:r[0]?i.throw||((o=i.return)&&o.call(i),0):i.next)&&!(o=o.call(i,r[1])).done)return o
switch(i=0,o&&(r=[2&r[0],o.value]),r[0]){case 0:case 1:o=r
break
case 4:return a.label++,{value:r[1],done:!1}
case 5:a.label++,i=r[1],r=[0]
continue
case 7:r=a.ops.pop(),a.trys.pop()
continue
default:if(!(o=a.trys,(o=o.length>0&&o[o.length-1])||6!==r[0]&&2!==r[0])){a=0
continue}if(3===r[0]&&(!o||r[1]>o[0]&&r[1]<o[3])){a.label=r[1]
break}if(6===r[0]&&a.label<o[1]){a.label=o[1],o=r
break}if(o&&a.label<o[2]){a.label=o[2],a.ops.push(r)
break}o[2]&&a.ops.pop(),a.trys.pop()
continue}r=e.call(n,a)}catch(n){r=[6,n],i=0}finally{t=o=0}if(5&r[0])throw r[1]
return{value:r[0]?r[1]:void 0,done:!0}}([r,c])}}}
Object.defineProperty(e,"__esModule",{value:!0}),e.NotechartLoader=void 0
var l=a(t(35982)),A=a(t(88339)),u=a(t(87293)),d=function(n){return i.isBuffer(n)?n:i.from(new Uint8Array(n))},p=function(){function n(){}return n.prototype.load=function(n,e,t){return e.name.match(/\.bmson$/i)?this.loadBmson(n,e,t):this.loadBMS(n,e,t)},n.prototype.loadBMS=function(n,e,t){return r(this,void 0,void 0,(function(){var i,o,s,a,r
return c(this,(function(c){switch(c.label){case 0:return i=d(n),o=l.Reader.getReaderOptionsFromFilename(e.name),[4,l.Reader.readAsync(i,o)]
case 1:return s=c.sent(),a=l.Compiler.compile(s),r=a.chart,[2,A.fromBMSChart(r,t)]}}))}))},n.prototype.loadBmson=function(n,e,t){return r(this,void 0,void 0,(function(){var e,i
return c(this,(function(o){return e=d(n),i=e.toString("utf-8"),[2,u.load(i,t)]}))}))},n}()
e.NotechartLoader=p,e.default=p},65319:function(n,e,t){n.exports=t.p+"build/assets/a-603b4275d603bc93dac1.jpg"}}])

//# sourceMappingURL=129-bfc5a59996f80b6660eb.js.map