{"version":3,"sources":["file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/index.ts","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/util/match.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/bms/headers.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/bms/objects.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/time-signatures/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/delay@5.0.0/node_modules/delay/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/Progress.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/observable.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/callbacks.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/audio-context/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/bytes@3.1.2/node_modules/bytes/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/addUnprefixed.ts","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/throat@2.0.2/node_modules/throat/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/sampling-master/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/resource-logging.ts","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/libarchive.js@1.3.0/node_modules/libarchive.js/src/compressed-file.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/libarchive.js@1.3.0/node_modules/libarchive.js/src/libarchive.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/unarchiver.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/custom-song-resources.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/sampling-master/ogg.ts","file:///home/runner/work/bemuse/bemuse/bemuse/src/coming-soon/demo/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/coming-soon/demo/style.scss?f244","file:///home/runner/work/bemuse/bemuse/bemuse/src/coming-soon/demo/style.scss","file:///home/runner/work/bemuse/bemuse/bemuse/src/coming-soon/demo/template.jade","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/reader/index.web.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/reader/getReaderOptionsFromFilename.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/compiler/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/reader/types.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/speedcore/segment.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/notes/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/notes/note.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/notes/channels.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/timing/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/song-info/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/keysounds/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/positioning/index.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/spacing/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/webpack@4.46.0/node_modules/webpack/buildin/global.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/bms/chart.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/resources/dnd-resources.ts","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/speedcore/index.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/formatters.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/read-blob.js","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/util/lodash.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/progress/utils.ts","file:///home/runner/work/bemuse/bemuse/packages/bms/lib/index.js","file:///home/runner/work/bemuse/bemuse/common/temp/node_modules/.pnpm/webpack@4.46.0/node_modules/webpack/buildin/module.js","file:///home/runner/work/bemuse/bemuse/bemuse/src/utils/download.js"],"names":["Object","defineProperty","exports","value","match","text","matched","when","pattern","callback","this","else","BMSHeaders","_data","_dataAll","prototype","each","i","get","name","toLowerCase","getAll","set","key","push","BMSObjects","_objects","add","object","channel","length","test","measure","fraction","all","slice","allSorted","list","sort","a","b","TimeSignatures","_values","getBeats","measureToBeat","sum","createAbortError","error","Error","createDelay","clearTimeout","defaultClear","setTimeout","willResolve","ms","signal","aborted","Promise","reject","timeoutId","settle","rejectFn","clear","signalListener","delayPromise","resolve","removeEventListener","addEventListener","once","createWithTimers","clearAndSet","delay","range","minimum","maximum","options","Math","floor","random","randomInteger","module","default","Progress","current","undefined","total","_observable","report","extra","notify","watch","f","progress","toString","formatter","constructor","_callbacks","_value","call","init","_nextId","args","callbacks","id","AudioContext","latencyHint","parse","format","formatThousandsRegExp","formatDecimalsRegExp","map","kb","mb","gb","tb","pow","pb","parseRegExp","Number","isFinite","mag","abs","thousandsSeparator","unitSeparator","decimalPlaces","fixedDecimals","Boolean","unit","str","toFixed","replace","split","s","join","val","isNaN","floatValue","results","exec","parseFloat","parseInt","addUnprefixed","prefix","parts","Delayed","fn","self","PromiseArgument","throat","size","queue","run","result","apply","then","release","next","shift","temp","arguments","FADE_LENGTH","dummyAudioTag","document","createElement","needsVorbisDecoder","canPlayType","SoundGroup","samplingMaster","volume","_master","_gain","audioContext","createGain","gain","connect","destination","destroy","disconnect","Sample","audioBuffer","_buffer","play","PlayInstance","duration","buffer","context","source","createBufferSource","onended","stop","node","group","_source","TEST_node","startTime","max","currentTime","startOffset","start","fadeIn","fadeOutAt","setValueAtTime","end","linearRampToValueAtTime","_startPlaying","_stoppedPlaying","onstop","bad","playbackRate","unmuteAudio","ctx","osc","createOscillator","frequency","async","resume","resumeContext","catch","e","console","_audioContext","_samples","_groups","_instances","Set","_destination","unmute","_destroyed","sample","instance","decode","blobOrArrayBuffer","_coerceToArrayBuffer","arrayBuffer","_decodeAudio","blobOrArrayBufferOrAudioBuffer","numberOfChannels","ArrayBuffer","as","byteLength","view","Uint8Array","decodeAudioData","delete","ResourceLogging","loggingFunction","log","setLoggingFunction","forEach","CompressedFile","path","archiveRef","_name","_size","_path","_archiveRef","extract","extractSingleFile","static","_options","workerUrl","file","warn","open","_worker","Worker","_workerMsg","bind","_content","_processed","_file","_postMessage","type","msg","hasEncryptedData","status","usePassword","archivePassword","passphrase","getFilesObject","entry","target","prop","_getProp","fileName","_cloneContent","getFilesArray","obj","_objectToArray","File","fileData","extractFiles","extractCallback","terminate","o","keys","files","pop","cur","prev","part","postMessage","_msgHandler","data","ARCHIVE_REGEXP","DROPBOX_REGEXP","provider","_logging","_files","getFiles","fileEntry","out","archive","extracted","traverse","tree","unarchive","unarchiveIfNeeded","fileList","read","resolveUrl","URL","createObjectURL","downloadFileEntryFromURL","url","lastTime","Date","now","download","decoderPromise","limit","decodeOGG","stbvorbis","ns","src","eval","buffers","sampleRate","totalLength","eof","decodedChunks","createBuffer","channels","Array","fill","_","ch","ChannelDataWriter","getChannelData","chunk","audioSamples","channelIndex","write","doDecodeOGG","offset","main","element","on","handler","el","appendTo","find","hide","preventDefault","loader","master","$log","$play","$sampler","bmsFile","filter","loadedFile","arraybuffer","Buffer","from","readAsync","chart","compile","timing","fromBMSChart","notes","info","JSON","stringify","loadedSamples","loadSamples","waitForPlay","show","t","_notes","_chart","samples","promises","completed","note","keysound","blob","loadKeysound","headers","span","scrollTop","scrollHeight","addClass","beatToSeconds","beat","go","originalEvent","ui","off","content","transform","locals","pug_html","getReaderOptionsFromFilename","chardet","_i","charset","forceEncoding","detect","reader","FileReader","onload","onerror","readAsText","Blob","getReaderOptionsFromFilename_1","enumerable","filename","match_1","chart_1","matchers","bms","if","endif","timeSignature","header","dtx","BMSChart","rng","matcher","randomStack","skipStack","headerSentences","channelSentences","controlSentences","skippedSentences","malformedSentences","warnings","line","trim","index","eachLine","lineNumber","flow","charAt","m","skipped","timeSignatures","string","items","substr","objects","handleChannelSentence","message","__importDefault","mod","__esModule","Segment","data_structure_1","x","dx","__createBinding","create","k","k2","desc","getOwnPropertyDescriptor","writable","configurable","__setModuleDefault","v","__importStar","hasOwnProperty","Notes","note_1","invariant_1","ChannelMapping","Note","count","mapping","CHANNEL_MAPPING","IIDX_P1","BMSNoteBuilder","build","_mapping","_activeLN","_lastNote","_lnObj","_channelMapping","_this","_handle","_handleNormalNote","toUpperCase","_handleLongNote","_normalizeChannel","_getBeat","endBeat","column","_getColumn","maybe","IIDX_DP_LANDMINE","IIDX_P1_LANDMINE","IIDX_DP","D1","D2","D3","D4","D5","D8","D9","D6","E1","E2","E3","E4","E5","E8","E9","E6","Timing","speedcore_1","lodash_1","precedence","bpm","initialBPM","actions","state","seconds","segments","inclusive","action","stopBeats","_speedcore","Speedcore","_eventBeats","uniq","secondsToBeat","bpmAtBeat","segmentAtX","getEventBeats","SongInfo","title","artist","genre","subtitles","subartists","difficulty","level","assign","extractSubtitle","Keysounds","_map","values","Positioning","speed","position","previous","Spacing","factor","unshift","g","Function","window","headers_1","objects_1","time_signatures_1","DndResources","event","super","dataTransfer","types","indexOf","getData","startsWith","item","readItem","addFile","webkitGetAsEntry","readEntry","getAsFile","isFile","readFile","isDirectory","readDirectory","dir","entries","createReader","readMore","readEntries","getFilesFromEvent","segment_1","_segments","_reached","targetFn","segment","_segmentAt","X","segmentAtT","T","wrap","BYTES_FORMATTER","PERCENTAGE_FORMATTER","EXTRA_FORMATTER","readAsArrayBuffer","lodash_uniq_1","lodash_map_1","lodash_values_1","lodash_assign_1","fixed","loaded","atomic","promise","hasByteLength","wrapPromise","ret","to","simultaneous","unsubscribe","update","__exportStar","p","Compiler","Reader","webpackPolyfill","deprecate","paths","children","l","getRetryDelay","shouldGiveUp","xh","XMLHttpRequest","responseType","response","onprogress","send","waitMs"],"mappings":"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","file":"build/comingSoonDemo-1b3bef2cc3171f23c6af.js","sourcesContent":["// !! avoid external dependencies since this is used in boot script!\n\nimport { Progress } from './Progress'\nexport default Progress\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.match = void 0;\nfunction match(text) {\n    var matched = false;\n    return {\n        when: function (pattern, callback) {\n            if (matched)\n                return this;\n            var match = text.match(pattern);\n            if (match) {\n                matched = true;\n                callback(match);\n            }\n            return this;\n        },\n        else: function (callback) {\n            if (matched)\n                return this;\n            callback();\n        },\n    };\n}\nexports.match = match;\n//# sourceMappingURL=match.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSHeaders = void 0;\n/**\n * A BMSHeader holds the header information in a BMS file, such as\n * `#TITLE`, `#ARTIST`, or `#BPM`.\n *\n * You get retrieve a header using the `get()` method:\n *\n * ```js\n * chart.headers.get('title')\n * ```\n *\n * For some header fields that may contain multiple values, such as `#SUBTITLE`,\n * you can get them all using `getAll()`:\n *\n * ```js\n * chart.headers.getAll()\n * ```\n */\nvar BMSHeaders = /** @class */ (function () {\n    function BMSHeaders() {\n        this._data = {};\n        this._dataAll = {};\n    }\n    /**\n     * Iterates through each header field using a callback function.\n     * @param callback will be called for each header field\n     */\n    BMSHeaders.prototype.each = function (callback) {\n        for (var i in this._data) {\n            callback(i, this._data[i]);\n        }\n    };\n    /**\n     * Retrieves the header fields latest value.\n     * @param name fields name\n     * @return the fields latest value\n     */\n    BMSHeaders.prototype.get = function (name) {\n        return this._data[name.toLowerCase()];\n    };\n    /**\n     * Retrieves the header fields values.\n     * This is useful when a header field is specified multiple times.\n     * @param name fields name\n     */\n    BMSHeaders.prototype.getAll = function (name) {\n        return this._dataAll[name.toLowerCase()];\n    };\n    /**\n     * Sets the header fields value.\n     * @param name fields name\n     * @param value fields value\n     */\n    BMSHeaders.prototype.set = function (name, value) {\n        var key = name.toLowerCase();\n        this._data[key] = value;\n        (this._dataAll[key] || (this._dataAll[key] = [])).push(value);\n    };\n    return BMSHeaders;\n}());\nexports.BMSHeaders = BMSHeaders;\n//# sourceMappingURL=headers.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSObjects = void 0;\n/**\n * BMSObjects holds a collection of objects inside a BMS notechart.\n */\nvar BMSObjects = /** @class */ (function () {\n    function BMSObjects() {\n        this._objects = [];\n    }\n    /**\n     * Adds a new object to this collection.\n     * If an object already exists on the same channel and position,\n     * the object is replaced (except for autokeysound tracks).\n     * @param object the object to add\n     */\n    BMSObjects.prototype.add = function (object) {\n        if (object.channel !== '01') {\n            for (var i = 0; i < this._objects.length; i++) {\n                var test = this._objects[i];\n                if (test.channel === object.channel &&\n                    test.measure === object.measure &&\n                    test.fraction === object.fraction) {\n                    this._objects[i] = object;\n                    return;\n                }\n            }\n        }\n        this._objects.push(object);\n    };\n    /**\n     * Returns an array of all objects.\n     */\n    BMSObjects.prototype.all = function () {\n        return this._objects.slice();\n    };\n    /**\n     * Returns a sorted array of all objects.\n     */\n    BMSObjects.prototype.allSorted = function () {\n        var list = this.all();\n        list.sort(function (a, b) {\n            return a.measure + a.fraction - (b.measure + b.fraction);\n        });\n        return list;\n    };\n    return BMSObjects;\n}());\nexports.BMSObjects = BMSObjects;\n//# sourceMappingURL=objects.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.TimeSignatures = void 0;\n/**\n * A TimeSignatures is a collection of time signature values\n * index by measure number.\n *\n * The measure number starts from 0.\n * By default, each measure has a measure size of 1\n * (which represents the common 4/4 time signature)\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #00102:0.75\n * #00103:1.25\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can access the {TimeSignatures} object:\n *\n * ```js\n * var timeSignatures = bmsChart.timeSignatures\n * ```\n *\n * Note that you can also use the constructor\n * to create a {TimeSignatures} from scratch.\n *\n * One of the most useful use case of this class\n * is to convert the measure and fraction into beat number.\n *\n * ```js\n * timeSignatures.measureToBeat(0, 0.000) // =>  0.0\n * timeSignatures.measureToBeat(0, 0.500) // =>  2.0\n * timeSignatures.measureToBeat(1, 0.000) // =>  4.0\n * timeSignatures.measureToBeat(1, 0.500) // =>  5.5\n * timeSignatures.measureToBeat(2, 0.000) // =>  7.0\n * timeSignatures.measureToBeat(2, 0.500) // =>  9.5\n * timeSignatures.measureToBeat(3, 0.000) // => 12.0\n * ```\n */\nvar TimeSignatures = /** @class */ (function () {\n    function TimeSignatures() {\n        this._values = {};\n    }\n    /**\n     * Sets the size of a specified measure.\n     * @param measure the measure number, starting from 0\n     * @param value the measure size.\n     *  For example, a size of 1.0 represents a common 4/4 time signature,\n     *  whereas a size of 0.75 represents the 3/4 or 6/8 time signature.\n     */\n    TimeSignatures.prototype.set = function (measure, value) {\n        this._values[measure] = value;\n    };\n    /**\n     * Retrieves the size of a specified measure.\n     * @param measure representing the measure number.\n     * @returns the size of the measure.\n     *  By default, a measure has a size of 1.\n     */\n    TimeSignatures.prototype.get = function (measure) {\n        return this._values[measure] || 1;\n    };\n    /**\n     * Retrieves the number of beats in a specified measure.\n     *\n     * Since one beat is equivalent to a quarter note in 4/4 time signature,\n     * this is equivalent to `(timeSignatures.get(measure) * 4)`.\n     * @param measure representing the measure number.\n     * @returns the size of the measure in beats.\n     */\n    TimeSignatures.prototype.getBeats = function (measure) {\n        return this.get(measure) * 4;\n    };\n    /**\n     * Converts a measure number and a fraction inside that measure\n     * into the beat number.\n     *\n     * @param measure the measure number.\n     * @param fraction the fraction of a measure,\n     * @returns the number of beats since measure 0.\n     */\n    TimeSignatures.prototype.measureToBeat = function (measure, fraction) {\n        var sum = 0;\n        for (var i = 0; i < measure; i++)\n            sum += this.getBeats(i);\n        return sum + this.getBeats(measure) * fraction;\n    };\n    return TimeSignatures;\n}());\nexports.TimeSignatures = TimeSignatures;\n//# sourceMappingURL=index.js.map","'use strict';\n\n// From https://github.com/sindresorhus/random-int/blob/c37741b56f76b9160b0b63dae4e9c64875128146/index.js#L13-L15\nconst randomInteger = (minimum, maximum) => Math.floor((Math.random() * (maximum - minimum + 1)) + minimum);\n\nconst createAbortError = () => {\n\tconst error = new Error('Delay aborted');\n\terror.name = 'AbortError';\n\treturn error;\n};\n\nconst createDelay = ({clearTimeout: defaultClear, setTimeout: set, willResolve}) => (ms, {value, signal} = {}) => {\n\tif (signal && signal.aborted) {\n\t\treturn Promise.reject(createAbortError());\n\t}\n\n\tlet timeoutId;\n\tlet settle;\n\tlet rejectFn;\n\tconst clear = defaultClear || clearTimeout;\n\n\tconst signalListener = () => {\n\t\tclear(timeoutId);\n\t\trejectFn(createAbortError());\n\t};\n\n\tconst cleanup = () => {\n\t\tif (signal) {\n\t\t\tsignal.removeEventListener('abort', signalListener);\n\t\t}\n\t};\n\n\tconst delayPromise = new Promise((resolve, reject) => {\n\t\tsettle = () => {\n\t\t\tcleanup();\n\t\t\tif (willResolve) {\n\t\t\t\tresolve(value);\n\t\t\t} else {\n\t\t\t\treject(value);\n\t\t\t}\n\t\t};\n\n\t\trejectFn = reject;\n\t\ttimeoutId = (set || setTimeout)(settle, ms);\n\t});\n\n\tif (signal) {\n\t\tsignal.addEventListener('abort', signalListener, {once: true});\n\t}\n\n\tdelayPromise.clear = () => {\n\t\tclear(timeoutId);\n\t\ttimeoutId = null;\n\t\tsettle();\n\t};\n\n\treturn delayPromise;\n};\n\nconst createWithTimers = clearAndSet => {\n\tconst delay = createDelay({...clearAndSet, willResolve: true});\n\tdelay.reject = createDelay({...clearAndSet, willResolve: false});\n\tdelay.range = (minimum, maximum, options) => delay(randomInteger(minimum, maximum), options);\n\treturn delay;\n};\n\nconst delay = createWithTimers();\ndelay.createWithTimers = createWithTimers;\n\nmodule.exports = delay;\n// TODO: Remove this for the next major release\nmodule.exports.default = delay;\n","import Observable from 'bemuse/utils/observable'\n\ninterface IProgressFormatter {\n  (progress: Progress): string\n}\n\n/**\n * The Progress class represents the progress of an asynchronous operation.\n * It is inspired by C#'s IProgress interface.\n *\n * See: http://blogs.msdn.com/b/dotnet/archive/2012/06/06/async-in-4-5-enabling-progress-and-cancellation-in-async-apis.aspx\n */\nexport class Progress {\n  /** The current progress (out of `Progress#total`). */\n  public current: number | undefined = undefined\n  /** Total progress value */\n  public total: number | undefined = undefined\n  /** Some arbitrary information associated with this Progress. */\n  public extra: any\n  /**\n   * The formatter of this progress. This formatter will be used to compute\n   * the text representation of this progress (`Progress#toString`).\n   */\n  public formatter?: IProgressFormatter\n  private _observable = new Observable<void>()\n  /**\n   * Updates the progress.\n   */\n  report(current: number, total: number, extra?: any) {\n    this.current = current\n    this.total = total\n    this.extra = extra\n    this._observable.notify()\n  }\n\n  /**\n   * Attaches a progress listener function to this progress.\n   * The function `f` will be called immediately and synchronously upon watching,\n   * and will be called when the progress value is updated.\n   * @param f\n   * @returns a function that, when called, unsubscribes this listener.\n   */\n  watch(f: (progress: Progress) => void) {\n    f(this)\n    return this._observable.watch(() => f(this))\n  }\n\n  /**\n   * The current progress as a fraction (out of 1).\n   */\n  get progress() {\n    if (this.total && this.current !== undefined && this.current !== null) {\n      return this.current / this.total\n    } else {\n      return null\n    }\n  }\n\n  /**\n   * Returns a string representation of this progress instance.\n   * This method is used for displaying the progress as a text.\n   */\n  toString() {\n    if (this.formatter !== undefined) {\n      return this.formatter(this)\n    } else if (this.progress !== null) {\n      return this.current + ' / ' + this.total\n    } else {\n      return ''\n    }\n  }\n}\n","// !! avoid external dependencies since this is used in boot script!\n\nimport Callbacks from 'bemuse/utils/callbacks'\n\nexport class Observable<T> {\n  private _callbacks = new Callbacks<[T]>()\n  private _value?: T\n  constructor(value?: T) {\n    this._value = value\n  }\n\n  get value() {\n    return this._value\n  }\n\n  set value(value) {\n    this._value = value\n    this.notify(value!)\n  }\n\n  notify(value: T) {\n    this._callbacks.call(value)\n  }\n\n  watch(f: (value: T) => void) {\n    if (this._value !== undefined) f(this._value)\n    return this._callbacks.add(f)\n  }\n}\n\nexport default Observable\n","// !! avoid external dependencies since this is used in boot script!\n\ntype CallbackEffect<T extends any[]> = (...args: T) => void\n\n/**\n * A utility class to hold a collection of callbacks.\n */\nexport class Callbacks<T extends any[]> {\n  private _callbacks: { [id: number]: CallbackEffect<T> } = {}\n  private _nextId = 1\n  constructor(init?: CallbackEffect<T>[] | CallbackEffect<T>) {\n    if (typeof init === 'function') {\n      this.add(init)\n    } else if (typeof init === 'object' && init && init.length) {\n      for (let i = 0; i < init.length; i++) this.add(init[i])\n    }\n  }\n\n  /**\n   * Calls all the callbacks.\n   */\n  call(...args: T) {\n    const callbacks = this._callbacks\n    for (const id in callbacks) {\n      callbacks[id](...args)\n    }\n  }\n\n  /**\n   * Adds a `callback` Function to this Callbacks collection.\n   * Returns a function that, when invoked, removes the inserted `callback` from the collection.\n   */\n  add(callback: CallbackEffect<T>) {\n    const id = this._nextId++\n    this._callbacks[id] = callback\n    return () => delete this._callbacks[id]\n  }\n}\n\nexport default Callbacks\n","export default new AudioContext({\n  latencyHint: 'interactive',\n})\n","/*!\n * bytes\n * Copyright(c) 2012-2014 TJ Holowaychuk\n * Copyright(c) 2015 Jed Watson\n * MIT Licensed\n */\n\n'use strict';\n\n/**\n * Module exports.\n * @public\n */\n\nmodule.exports = bytes;\nmodule.exports.format = format;\nmodule.exports.parse = parse;\n\n/**\n * Module variables.\n * @private\n */\n\nvar formatThousandsRegExp = /\\B(?=(\\d{3})+(?!\\d))/g;\n\nvar formatDecimalsRegExp = /(?:\\.0*|(\\.[^0]+)0+)$/;\n\nvar map = {\n  b:  1,\n  kb: 1 << 10,\n  mb: 1 << 20,\n  gb: 1 << 30,\n  tb: Math.pow(1024, 4),\n  pb: Math.pow(1024, 5),\n};\n\nvar parseRegExp = /^((-|\\+)?(\\d+(?:\\.\\d+)?)) *(kb|mb|gb|tb|pb)$/i;\n\n/**\n * Convert the given value in bytes into a string or parse to string to an integer in bytes.\n *\n * @param {string|number} value\n * @param {{\n *  case: [string],\n *  decimalPlaces: [number]\n *  fixedDecimals: [boolean]\n *  thousandsSeparator: [string]\n *  unitSeparator: [string]\n *  }} [options] bytes options.\n *\n * @returns {string|number|null}\n */\n\nfunction bytes(value, options) {\n  if (typeof value === 'string') {\n    return parse(value);\n  }\n\n  if (typeof value === 'number') {\n    return format(value, options);\n  }\n\n  return null;\n}\n\n/**\n * Format the given value in bytes into a string.\n *\n * If the value is negative, it is kept as such. If it is a float,\n * it is rounded.\n *\n * @param {number} value\n * @param {object} [options]\n * @param {number} [options.decimalPlaces=2]\n * @param {number} [options.fixedDecimals=false]\n * @param {string} [options.thousandsSeparator=]\n * @param {string} [options.unit=]\n * @param {string} [options.unitSeparator=]\n *\n * @returns {string|null}\n * @public\n */\n\nfunction format(value, options) {\n  if (!Number.isFinite(value)) {\n    return null;\n  }\n\n  var mag = Math.abs(value);\n  var thousandsSeparator = (options && options.thousandsSeparator) || '';\n  var unitSeparator = (options && options.unitSeparator) || '';\n  var decimalPlaces = (options && options.decimalPlaces !== undefined) ? options.decimalPlaces : 2;\n  var fixedDecimals = Boolean(options && options.fixedDecimals);\n  var unit = (options && options.unit) || '';\n\n  if (!unit || !map[unit.toLowerCase()]) {\n    if (mag >= map.pb) {\n      unit = 'PB';\n    } else if (mag >= map.tb) {\n      unit = 'TB';\n    } else if (mag >= map.gb) {\n      unit = 'GB';\n    } else if (mag >= map.mb) {\n      unit = 'MB';\n    } else if (mag >= map.kb) {\n      unit = 'KB';\n    } else {\n      unit = 'B';\n    }\n  }\n\n  var val = value / map[unit.toLowerCase()];\n  var str = val.toFixed(decimalPlaces);\n\n  if (!fixedDecimals) {\n    str = str.replace(formatDecimalsRegExp, '$1');\n  }\n\n  if (thousandsSeparator) {\n    str = str.split('.').map(function (s, i) {\n      return i === 0\n        ? s.replace(formatThousandsRegExp, thousandsSeparator)\n        : s\n    }).join('.');\n  }\n\n  return str + unitSeparator + unit;\n}\n\n/**\n * Parse the string value into an integer in bytes.\n *\n * If no unit is given, it is assumed the value is in bytes.\n *\n * @param {number|string} val\n *\n * @returns {number|null}\n * @public\n */\n\nfunction parse(val) {\n  if (typeof val === 'number' && !isNaN(val)) {\n    return val;\n  }\n\n  if (typeof val !== 'string') {\n    return null;\n  }\n\n  // Test if the string passed is valid\n  var results = parseRegExp.exec(val);\n  var floatValue;\n  var unit = 'b';\n\n  if (!results) {\n    // Nothing could be extracted from the given string\n    floatValue = parseInt(val, 10);\n    unit = 'b'\n  } else {\n    // Retrieve the value and the unit\n    floatValue = parseFloat(results[1]);\n    unit = results[4].toLowerCase();\n  }\n\n  if (isNaN(floatValue)) {\n    return null;\n  }\n\n  return Math.floor(map[unit] * floatValue);\n}\n","export function addUnprefixed(\n  prefix: string,\n  name: string,\n  callback: (path: string) => void\n) {\n  if (name.match(/\\.(?:bms|bme|bml|bmson)/i)) {\n    callback(name)\n    return\n  }\n  const parts = (prefix + name).split('/')\n  for (let i = 0; i < parts.length; i++) {\n    callback(parts.slice(i).join('/'))\n  }\n}\n","'use strict'\n\nmodule.exports = function (PromiseArgument) {\n  var Promise;\n  function throat(size, fn) {\n    var queue = []\n    function run(fn, self, args) {\n      if (size) {\n        size--\n        var result = new Promise(function (resolve) {\n          resolve(fn.apply(self, args))\n        })\n        result.then(release, release)\n        return result\n      } else {\n        return new Promise(function (resolve) {\n          queue.push(new Delayed(resolve, fn, self, args))\n        })\n      }\n    }\n    function release() {\n      size++\n      if (queue.length) {\n        var next = queue.shift()\n        next.resolve(run(next.fn, next.self, next.args))\n      }\n    }\n    if (typeof size === 'function' && typeof fn === 'number') {\n      var temp = fn;\n      fn = size;\n      size = temp;\n    }\n    if (typeof fn === 'function') {\n      return function () {\n        var args = [];\n        for (var i = 0; i < arguments.length; i++) {\n          args.push(arguments[i]);\n        }\n        return run(fn, this, args)\n      }\n    } else {\n      return function (fn) {\n        var args = [];\n        for (var i = 1; i < arguments.length; i++) {\n          args.push(arguments[i]);\n        }\n        return run(fn, this, args)\n      }\n    }\n  }\n  if (typeof arguments[0] === 'number' || typeof arguments[1] === 'number') {\n    Promise = module.exports.Promise;\n    if (typeof Promise !== 'function') {\n      throw new Error('You must provide a Promise polyfill for this library to work in older environments');\n    }\n    return throat(arguments[0], arguments[1]);\n  } else {\n    Promise = PromiseArgument;\n    return throat;\n  }\n}\n\n/* istanbul ignore next */\nif (typeof Promise === 'function') {\n  module.exports.Promise = Promise;\n}\n\nfunction Delayed(resolve, fn, self, args) {\n  this.resolve = resolve\n  this.fn = fn\n  this.self = self || null\n  this.args = args\n}\n","import defaultAudioContext from 'bemuse/audio-context'\nimport readBlob from 'bemuse/utils/read-blob'\nimport { decodeOGG } from './ogg'\n\nexport const FADE_LENGTH = 0.001\n\nconst dummyAudioTag = document.createElement('audio')\n// Checks whether an audio format is supported.\nexport function canPlay(type) {\n  // We have a Vorbis audio decoder!\n  if (type === 'audio/ogg; codecs=\"vorbis\"') return true\n  return dummyAudioTag.canPlayType(type) === 'probably'\n}\n\nconst needsVorbisDecoder = !dummyAudioTag.canPlayType(\n  'audio/ogg; codecs=\"vorbis\"'\n)\n\n// The sampling master is a wrapper class around Web Audio API\n// that takes care of:\n//\n// - Decoding audio from an ArrayBuffer or Blob (resulting in a \"Sample\").\n// - Playing the `Sample` and managing its lifecycle.\nexport class SamplingMaster {\n  constructor(audioContext) {\n    this._audioContext = audioContext || defaultAudioContext\n    this._samples = []\n    this._groups = []\n    this._instances = new Set()\n    this._destination = this._audioContext.destination\n  }\n\n  // Connects a dummy node to the audio, thereby unmuting the audio system on\n  // iOS devices (which keeps the audio muted until a user interacts with the\n  // page).\n  unmute() {\n    unmuteAudio(this._audioContext)\n  }\n\n  // The underlying AudioContext.\n  get audioContext() {\n    return this._audioContext\n  }\n\n  // The audio destination.\n  get destination() {\n    return this._destination\n  }\n\n  // The current time\n  // See: https://webaudio.github.io/web-audio-api/#dom-baseaudiocontext-currenttime\n  get currentTime() {\n    return this._audioContext.currentTime\n  }\n\n  // Destroys this SamplingMaster, make it unusable.\n  destroy() {\n    if (this._destroyed) return\n    this._destroyed = true\n    for (const sample of this._samples) sample.destroy()\n    for (const instance of this._instances) instance.destroy()\n    this._samples = null\n    this._instances = null\n  }\n\n  // Decodes the audio data from a Blob or an ArrayBuffer.\n  // Returns an AudioBuffer which can be re-used in other sampling masters.\n  decode(blobOrArrayBuffer) {\n    return this._coerceToArrayBuffer(blobOrArrayBuffer).then((arrayBuffer) =>\n      this._decodeAudio(arrayBuffer)\n    )\n  }\n\n  // Creates a `Sample` from a Blob or an ArrayBuffer or an AudioBuffer.\n  sample(blobOrArrayBufferOrAudioBuffer) {\n    const audioBufferPromise = (() => {\n      if (blobOrArrayBufferOrAudioBuffer.numberOfChannels) {\n        return Promise.resolve(blobOrArrayBufferOrAudioBuffer)\n      } else {\n        return this.decode(blobOrArrayBufferOrAudioBuffer)\n      }\n    })()\n    return audioBufferPromise.then((audioBuffer) => {\n      if (this._destroyed) throw new Error('SamplingMaster already destroyed!')\n      const sample = new Sample(this, audioBuffer)\n      this._samples.push(sample)\n      return sample\n    })\n  }\n\n  group(options) {\n    const group = new SoundGroup(this, options)\n    this._groups.push(group)\n    return group\n  }\n\n  _coerceToArrayBuffer(blobOrArrayBuffer) {\n    if (blobOrArrayBuffer instanceof ArrayBuffer) {\n      return Promise.resolve(blobOrArrayBuffer)\n    } else {\n      return readBlob(blobOrArrayBuffer).as('arraybuffer')\n    }\n  }\n\n  _decodeAudio(arrayBuffer) {\n    return new Promise((resolve, reject) => {\n      if (needsVorbisDecoder && arrayBuffer.byteLength > 4) {\n        const view = new Uint8Array(arrayBuffer, 0, 4)\n        if (\n          view[0] === 0x4f &&\n          view[1] === 0x67 &&\n          view[2] === 0x67 &&\n          view[3] === 0x53\n        ) {\n          return resolve(decodeOGG(this.audioContext, arrayBuffer))\n        }\n      }\n      this.audioContext.decodeAudioData(\n        arrayBuffer,\n        function decodeAudioDataSuccess(audioBuffer) {\n          resolve(audioBuffer)\n        },\n        function decodeAudioDataFailure(e) {\n          reject(new Error('Unable to decode audio: ' + e))\n        }\n      )\n    })\n  }\n\n  _startPlaying(instance) {\n    this._instances.add(instance)\n  }\n\n  _stoppedPlaying(instance) {\n    this._instances.delete(instance)\n  }\n}\n\n// Sound group\nexport class SoundGroup {\n  constructor(samplingMaster, { volume } = {}) {\n    this._master = samplingMaster\n    this._gain = this._master.audioContext.createGain()\n    if (volume != null) this._gain.gain.value = volume\n    this._gain.connect(this._master.destination)\n  }\n\n  get destination() {\n    return this._gain\n  }\n\n  destroy() {\n    this._gain.disconnect()\n    this._gain = null\n  }\n}\n\n// The Sample is created by and belongs to the `SamplingMaster`.\n//\n// You don't invoke this constructor directly; it is invoked by\n// `SamplingMaster#create`.\nexport class Sample {\n  constructor(samplingMaster, /** @type {AudioBuffer} */ audioBuffer) {\n    this._master = samplingMaster\n    this._buffer = audioBuffer\n  }\n\n  // Plays the sample and returns the new PlayInstance.\n  play(delay, options) {\n    return new PlayInstance(this._master, this._buffer, delay, options)\n  }\n\n  // Destroys this sample, thereby making it unusable.\n  destroy() {\n    this._master = null\n    this._buffer = null\n  }\n\n  get duration() {\n    return this._buffer.duration\n  }\n}\n\n// When a `Sample` is played, a PlayInstance is created.\n// A PlayInstance may not be reused; after the sound finishes playing,\n// you have to invoke `Sample#play` again.\n//\n// You don't invoke this constructor directly; it is invoked by `Sample#play`.\nexport class PlayInstance {\n  constructor(samplingMaster, buffer, delay, options = {}) {\n    delay = delay || 0\n    this._master = samplingMaster\n\n    // Connect all the stuff...\n    const context = samplingMaster.audioContext\n    const source = context.createBufferSource()\n    source.buffer = buffer\n    source.onended = () => this.stop()\n    const gain = context.createGain()\n    source.connect(gain)\n    const destination =\n      options.node ||\n      (options.group && options.group.destination) ||\n      samplingMaster.destination\n    gain.connect(destination)\n    this._source = source\n    this._gain = this.TEST_node = gain\n\n    // Start the sound.\n    const startTime = !delay ? 0 : Math.max(0, context.currentTime + delay)\n    const startOffset = options.start || 0\n    const fadeIn = startOffset > 0\n    let fadeOutAt = false\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, 0)\n    }\n    if (options.end !== undefined) {\n      const duration = Math.max(options.end - startOffset, 0)\n      source.start(startTime, startOffset, duration + FADE_LENGTH)\n      fadeOutAt = context.currentTime + delay + duration\n    } else {\n      source.start(startTime, startOffset)\n    }\n    if (fadeIn) {\n      gain.gain.setValueAtTime(0, context.currentTime + delay)\n      gain.gain.linearRampToValueAtTime(\n        1,\n        context.currentTime + delay + FADE_LENGTH\n      )\n    }\n    if (fadeOutAt !== false) {\n      gain.gain.setValueAtTime(1, fadeOutAt)\n      gain.gain.linearRampToValueAtTime(0, fadeOutAt + FADE_LENGTH)\n    }\n    this._master._startPlaying(this)\n  }\n\n  // Stops the sample and disconnects the underlying Web Audio nodes.\n  stop() {\n    if (!this._source) return\n    this._source.stop(0)\n    this._source.disconnect()\n    this._gain.disconnect()\n    this._source = null\n    this._gain = null\n    this._master._stoppedPlaying(this)\n    if (this.onstop) this.onstop()\n  }\n\n  // Makes this PlayInstance sound off-pitch, as a result of badly hitting\n  // a note.\n  bad() {\n    if (!this._source) return\n    this._source.playbackRate.value =\n      Math.random() < 0.5 ? Math.pow(2, 1 / 24) : Math.pow(2, -1 / 24)\n  }\n\n  // Destroys this PlayInstance.\n  destroy() {\n    this.stop()\n  }\n}\n\nexport default SamplingMaster\n\n/**\n * Enables Web Audio on iOS. By default, on iOS, audio is disabled.\n * This function must be called before audio will start working. It must be\n * called as a response to some user interaction (e.g. touchstart).\n *\n * Also, theres now Chrome autoplay policy taking effect.\n * https://developers.google.com/web/updates/2017/09/autoplay-policy-changes\n *\n * @param {AudioContext} ctx The AudioContext to be unmuted.\n */\nexport function unmuteAudio(ctx = defaultAudioContext) {\n  // Perform some strange magic to unmute the audio on iOS devices.\n  // This code doesnt make sense at all, you know.\n  const gain = ctx.createGain()\n  const osc = ctx.createOscillator()\n  osc.frequency.value = 440\n  osc.start(ctx.currentTime + 0.1)\n  osc.stop(ctx.currentTime + 0.1)\n  gain.connect(ctx.destination)\n  gain.disconnect()\n\n  resumeContext(ctx).catch((e) => {\n    console.error('[sampling-master] Cannot resume AudioContext', e)\n  })\n}\n\nasync function resumeContext(ctx) {\n  return ctx.resume()\n}\n","import { LoggingFunction } from './types'\n\nexport default class ResourceLogging {\n  private buffer: string[] | null = []\n  private loggingFunction: LoggingFunction = (text) => {\n    if (this.buffer) this.buffer.push(text)\n  }\n\n  public log: LoggingFunction = (text) => {\n    this.loggingFunction(text)\n  }\n\n  setLoggingFunction = (fn: LoggingFunction) => {\n    this.loggingFunction = fn\n    if (this.buffer) {\n      this.buffer.forEach((text) => fn(text))\n      this.buffer = null\n    }\n  }\n}\n","\r\n/**\r\n * Represents compressed file before extraction\r\n */\r\nexport class CompressedFile{\r\n\r\n    constructor(name,size,path,archiveRef){\r\n        this._name = name;\r\n        this._size = size;\r\n        this._path = path;\r\n        this._archiveRef = archiveRef;\r\n    }\r\n\r\n    /**\r\n     * file name\r\n     */\r\n    get name(){\r\n        return this._name;\r\n    }\r\n    /**\r\n     * file size\r\n     */\r\n    get size(){\r\n        return this._size;\r\n    }\r\n\r\n    /**\r\n     * Extract file from archive\r\n     * @returns {Promise<File>} extracted file\r\n     */\r\n    extract(){\r\n        return this._archiveRef.extractSingleFile(this._path);\r\n    }\r\n\r\n}","import { CompressedFile } from \"./compressed-file.js\";\r\n\r\n\r\nexport class Archive{\r\n\r\n    /**\r\n     * Initialize libarchivejs\r\n     * @param {Object} options \r\n     */\r\n    static init(options = {}){\r\n        Archive._options = {\r\n            workerUrl: '../dist/worker-bundle.js',\r\n            ...options\r\n        };\r\n        return Archive._options;\r\n    }\r\n\r\n    /**\r\n     * Creates new archive instance from browser native File object\r\n     * @param {File} file\r\n     * @param {object} options\r\n     * @returns {Archive}\r\n     */\r\n    static open(file, options = null){\r\n        options =   options || \r\n                    Archive._options || \r\n                    Archive.init() && console.warn('Automatically initializing using options: ', Archive._options);\r\n        const arch = new Archive(file,options);\r\n        return arch.open();\r\n    }\r\n\r\n    /**\r\n     * Create new archive\r\n     * @param {File} file \r\n     * @param {Object} options \r\n     */\r\n    constructor(file,options){\r\n        this._worker = new Worker(options.workerUrl);\r\n        this._worker.addEventListener('message', this._workerMsg.bind(this));\r\n        this._callbacks = [];\r\n        this._content = {};\r\n        this._processed = 0;\r\n        this._file = file;\r\n    }\r\n\r\n    /**\r\n     * Prepares file for reading\r\n     * @returns {Promise<Archive>} archive instance\r\n     */\r\n    async open(){\r\n        await this._postMessage({type: 'HELLO'},(resolve,reject,msg) => {\r\n            if( msg.type === 'READY' ){\r\n                resolve();\r\n            }\r\n        });\r\n        return await this._postMessage({type: 'OPEN', file: this._file}, (resolve,reject,msg) => {\r\n            if(msg.type === 'OPENED'){\r\n                resolve(this);\r\n            }\r\n        });\r\n    }\r\n\r\n    /**\r\n     * detect if archive has encrypted data\r\n     * @returns {boolean|null} null if could not be determined\r\n     */\r\n    hasEncryptedData(){\r\n        return this._postMessage({type: 'CHECK_ENCRYPTION'}, \r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'ENCRYPTION_STATUS' ){\r\n                    resolve(msg.status);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * set password to be used when reading archive\r\n     */\r\n    usePassword(archivePassword){\r\n        return this._postMessage({type: 'SET_PASSPHRASE', passphrase: archivePassword},\r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'PASSPHRASE_STATUS' ){\r\n                    resolve(msg.status);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns object containing directory structure and file information \r\n     * @returns {Promise<object>}\r\n     */\r\n    getFilesObject(){\r\n        if( this._processed > 0 ){\r\n            return Promise.resolve().then( () => this._content );\r\n        }\r\n        return this._postMessage({type: 'LIST_FILES'}, (resolve,reject,msg) => {\r\n            if( msg.type === 'ENTRY' ){\r\n                const entry = msg.entry;\r\n                const [ target, prop ] = this._getProp(this._content,entry.path);\r\n                if( entry.type === 'FILE' ){\r\n                    target[prop] = new CompressedFile(entry.fileName,entry.size,entry.path,this);                    \r\n                }\r\n                return true;\r\n            }else if( msg.type === 'END' ){\r\n                this._processed = 1;\r\n                resolve(this._cloneContent(this._content));\r\n            }\r\n        });\r\n    }\r\n\r\n    getFilesArray(){\r\n        return this.getFilesObject().then( (obj) => {\r\n            return this._objectToArray(obj);\r\n        });\r\n    }\r\n\r\n    extractSingleFile(target){\r\n        return this._postMessage({type: 'EXTRACT_SINGLE_FILE', target: target}, \r\n            (resolve,reject,msg) => {\r\n                if( msg.type === 'FILE' ){\r\n                    const file = new File([msg.entry.fileData], msg.entry.fileName, {\r\n                        type: 'application/octet-stream'\r\n                    });\r\n                    resolve(file);\r\n                }\r\n            }\r\n        );\r\n    }\r\n\r\n    /**\r\n     * Returns object containing directory structure and extracted File objects \r\n     * @param {Function} extractCallback\r\n     * \r\n     */\r\n    extractFiles(extractCallback){\r\n        if( this._processed > 1 ){\r\n            return Promise.resolve().then( () => this._content );\r\n        }\r\n        return this._postMessage({type: 'EXTRACT_FILES'}, (resolve,reject,msg) => {\r\n            if( msg.type === 'ENTRY' ){\r\n                const [ target, prop ] = this._getProp(this._content,msg.entry.path);\r\n                if( msg.entry.type === 'FILE' ){\r\n                    target[prop] = new File([msg.entry.fileData], msg.entry.fileName, {\r\n                        type: 'application/octet-stream'\r\n                    });\r\n                    if (extractCallback !== undefined) {\r\n                        setTimeout(extractCallback.bind(null,{\r\n                            file: target[prop],\r\n                            path: msg.entry.path,\r\n                        }));\r\n                    }\r\n                }\r\n                return true;\r\n            }else if( msg.type === 'END' ){\r\n                this._processed = 2;\r\n                this._worker.terminate();\r\n                resolve(this._cloneContent(this._content));\r\n            }\r\n        });\r\n    }\r\n\r\n    _cloneContent(obj){\r\n        if( obj instanceof File || obj instanceof CompressedFile || obj === null ) return obj;\r\n        const o = {};\r\n        for( const prop of Object.keys(obj) ){\r\n            o[prop] = this._cloneContent(obj[prop]);\r\n        }\r\n        return o;\r\n    }\r\n\r\n    _objectToArray(obj,path = ''){\r\n        const files = [];\r\n        for( const key of Object.keys(obj) ){\r\n            if( obj[key] instanceof File || obj[key] instanceof CompressedFile || obj[key] === null ){\r\n                files.push({\r\n                    file: obj[key] || key,\r\n                    path: path\r\n                });\r\n            }else{\r\n                files.push( ...this._objectToArray(obj[key],`${path}${key}/`) );\r\n            }\r\n        }\r\n        return files;\r\n    }\r\n\r\n    _getProp(obj,path){\r\n        const parts = path.split('/');\r\n        if( parts[parts.length -1] === '' ) parts.pop();\r\n        let cur = obj, prev = null;\r\n        for( const part of parts ){\r\n            cur[part] = cur[part] || {};\r\n            prev = cur;\r\n            cur = cur[part];\r\n        }\r\n        return [ prev, parts[parts.length-1] ];\r\n    }\r\n\r\n    _postMessage(msg,callback){\r\n        this._worker.postMessage(msg);\r\n        return new Promise((resolve,reject) => {\r\n            this._callbacks.push( this._msgHandler.bind(this,callback,resolve,reject) );\r\n        });\r\n    }\r\n\r\n    _msgHandler(callback,resolve,reject,msg){\r\n        if( msg.type === 'BUSY' ){\r\n            reject('worker is busy');\r\n        }else if( msg.type === 'ERROR' ){\r\n            reject(msg.error);\r\n        }else{\r\n            return callback(resolve,reject,msg);\r\n        }\r\n    }\r\n\r\n    _workerMsg({data: msg}){\r\n        const callback = this._callbacks[this._callbacks.length -1];\r\n        const next = callback(msg);\r\n        if( !next ){\r\n            this._callbacks.pop();\r\n        }\r\n    }\r\n\r\n}","import { Archive } from 'libarchive.js/main.js'\nimport { addUnprefixed } from './addUnprefixed'\nimport { FileEntry } from './types'\n\nArchive.init({\n  workerUrl: '/vendor/libarchive.js-1.3.0/dist/worker-bundle.js',\n})\n\nexport async function unarchive(file: File): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const archive = await Archive.open(file)\n  const extracted = await archive.extractFiles()\n  const traverse = (tree: any, prefix = '') => {\n    for (const key of Object.keys(tree)) {\n      if (tree[key] instanceof File) {\n        addUnprefixed(prefix, key, (name) => {\n          out.push({ name, file: tree[key] })\n        })\n      } else if (tree[key] && typeof tree[key] === 'object') {\n        traverse(tree[key], prefix + key + '/')\n      }\n    }\n  }\n  traverse(extracted)\n  return out\n}\n","import * as ProgressUtils from 'bemuse/progress/utils'\nimport {\n  FileEntry,\n  LoggingFunction,\n  IResource,\n  ICustomSongResources,\n} from './types'\nimport ResourceLogging from './resource-logging'\nimport { unarchive } from './unarchiver'\nimport readBlob from 'bemuse/utils/read-blob'\nimport Progress from 'bemuse/progress'\nimport download from 'bemuse/utils/download'\n\nexport const ARCHIVE_REGEXP = /\\.(?:zip|rar|7z|tar(?:\\.(?:gz|bz2))?)/i\n\n// http://nekokan.dyndns.info/tool/DropboxReplacer/index.html\nconst DROPBOX_REGEXP =\n  /https?:\\/\\/(?:(?:www|dl)\\.dropbox\\.com|dl\\.dropboxusercontent\\.com)\\/(sh?)\\/([^?]*)(.*)?$/\n\n/**\n * A resource provider for custom songs.\n * It may retrieve the files from, e.g., a drag and drop event or an `?archive` flag.\n */\nexport interface CustomResourceProvider {\n  getFiles(loggingFunction: LoggingFunction): PromiseLike<FileEntry[]>\n}\n\n/**\n * An IResources for songs provided by a CustomResourceProvider.\n */\nexport class CustomSongResources implements ICustomSongResources {\n  private _logging = new ResourceLogging()\n  private _files: PromiseLike<FileEntry[]>\n  public setLoggingFunction = this._logging.setLoggingFunction\n\n  constructor(provider: CustomResourceProvider) {\n    this._files = Promise.resolve(provider.getFiles(this._logging.log)).then(\n      (files) => unarchiveIfNeeded(files, this._logging.log)\n    )\n  }\n\n  file(name: string) {\n    return this._files.then(function (files) {\n      for (const file of files) {\n        if (file.name.toLowerCase() === name.toLowerCase()) {\n          return new FileResource(file.file)\n        }\n      }\n      throw new Error('unable to find ' + name)\n    })\n  }\n\n  get fileList(): Promise<string[]> {\n    return Promise.resolve(this._files).then((a) => a.map((f) => f.name))\n  }\n}\n\nexport class FileResource implements IResource {\n  constructor(private _file: File) {}\n  read(progress: Progress) {\n    return ProgressUtils.atomic(\n      progress,\n      readBlob(this._file).as('arraybuffer')\n    )\n  }\n\n  resolveUrl() {\n    return Promise.resolve(URL.createObjectURL(this._file))\n  }\n\n  get name() {\n    return this._file.name\n  }\n}\n\n/**\n * If only 1 FileEntry is present and it is an archive file, extract it.\n */\nexport async function unarchiveIfNeeded(\n  files: FileEntry[],\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  if (files.length !== 1) return files\n  const fileEntry = files[0]\n  if (!fileEntry.name.match(ARCHIVE_REGEXP)) {\n    return files\n  }\n  log('Archive file detected! Now unarchiving')\n  return unarchive(fileEntry.file)\n}\n\n/**\n * Downloads a URL as a FileEntry.\n */\nexport async function downloadFileEntryFromURL(\n  url: string,\n  log: LoggingFunction\n): Promise<FileEntry> {\n  const name = url\n    .replace(/[?#].*/, '')\n    .split('/')\n    .pop()!\n\n  // Try Dropbox URL replacement\n  const match = url.match(DROPBOX_REGEXP)\n  if (match) {\n    url = `https://dl.dropboxusercontent.com/${match[1]}/${match[2]}`\n  }\n\n  const progress = new Progress()\n  let lastTime = 0\n  progress.watch(() => {\n    if (Date.now() < lastTime + 5e3) return\n    log(`Downloading: ${progress}`)\n    lastTime = Date.now()\n  })\n  const blob = await download(url).as('blob', progress)\n  return { name, file: blob }\n}\n","import throat from 'throat'\n\ntype OGGDecodeEvent = {\n  data?: Float32Array[]\n  sampleRate: number\n  error?: any\n  eof?: boolean\n}\n\ntype OGGDecoder = {\n  decode(arrayBuffer: ArrayBuffer, callback: (e: OGGDecodeEvent) => void): void\n}\n\nlet decoderPromise: Promise<OGGDecoder>\n\nconst limit = throat(1)\n\nfunction getDecoder() {\n  if (!decoderPromise) {\n    decoderPromise = import(\n      // @ts-ignore\n      /* webpackChunkName: 'stbvorbis' */ 'raw-loader!./vendor/stbvorbis/stbvorbis-e6da5fe-NDEBUG.js'\n    )\n      .then((ns) => ns.default)\n      .then((src) => {\n        // eslint-disable-next-line no-eval\n        return (0, eval)(src + ';stbvorbis')\n      })\n  }\n  return decoderPromise\n}\n\n/**\n * Decodes an OGG file using stbvorbis.js.\n */\nexport async function decodeOGG(\n  audioContext: AudioContext,\n  arrayBuffer: ArrayBuffer\n) {\n  const stbvorbis = await getDecoder()\n  return limit(() => doDecodeOGG(stbvorbis, audioContext, arrayBuffer))\n}\n\nfunction doDecodeOGG(\n  stbvorbis: OGGDecoder,\n  audioContext: AudioContext,\n  arrayBuffer: ArrayBuffer\n) {\n  return new Promise<AudioBuffer>((resolve, reject) => {\n    const buffers: Float32Array[][] = []\n    let totalLength = 0\n    let sampleRate: number\n    stbvorbis.decode(arrayBuffer, function (e) {\n      if (e.data) {\n        sampleRate = e.sampleRate\n        buffers.push(e.data)\n        totalLength += e.data[0].length\n      }\n      if (e.error) {\n        const error =\n          e.error instanceof Error ? e.error : `stbvorbis.js Error: ${e.error}`\n        reject(error)\n      }\n      if (e.eof) {\n        resolve(createBuffer(audioContext, buffers, totalLength, sampleRate))\n      }\n    })\n  })\n}\n\nasync function createBuffer(\n  audioContext: AudioContext,\n  decodedChunks: Float32Array[][],\n  length: number,\n  sampleRate: number\n) {\n  if (!length) throw new Error(`stbvorbis.js Error: No length`)\n  if (!sampleRate) throw new Error(`stbvorbis.js Error: No sample rate`)\n  const numberOfChannels = decodedChunks[0].length\n  const audioBuffer = audioContext.createBuffer(\n    numberOfChannels,\n    length,\n    sampleRate\n  )\n  const channels: ChannelDataWriter[] = Array(audioBuffer.numberOfChannels)\n    .fill(null)\n    .map((_, ch) => new ChannelDataWriter(audioBuffer.getChannelData(ch)))\n  for (const chunk of decodedChunks) {\n    chunk.forEach((audioSamples, channelIndex) => {\n      channels[channelIndex].write(audioSamples)\n    })\n  }\n  return audioBuffer\n}\n\nclass ChannelDataWriter {\n  private offset = 0\n  constructor(private data: Float32Array) {}\n  write(audioSamples: Float32Array) {\n    // iOS Safari does not support `buf.copyToChannel(a, ch, track[ch])`, so we had to copy audio data sample-by-sample.\n    const { offset, data } = this\n    for (let i = 0; i < audioSamples.length; i++) {\n      data[i + offset] = audioSamples[i]\n    }\n    this.offset += audioSamples.length\n  }\n}\n","import './style.scss'\n\nimport $ from 'jquery'\nimport DndResources from 'bemuse/resources/dnd-resources'\nimport SamplingMaster from 'bemuse/sampling-master'\nimport ctx from 'bemuse/audio-context'\nimport { Compiler, Notes, Reader, SongInfo, Timing } from 'bms'\n\nimport template from './template.jade'\n\nexport function main(element) {\n  $(element).text('Technical Demo!').on('click', handler)\n\n  function handler() {\n    ui()\n    $(element).off('click', handler)\n    $(element).hide()\n    return false\n  }\n\n  function ui() {\n    const el = $(template()).appendTo('body')\n    el.find('.js-play').hide()\n    el.on('dragover', () => false).on('drop', (e) => {\n      e.preventDefault()\n      const dndLoader = new DndResources(e.originalEvent)\n      go(dndLoader, el)\n      return false\n    })\n  }\n}\n\nasync function go(loader, element) {\n  const master = new SamplingMaster(ctx)\n  const $log = element.find('.js-log')\n  const $play = element.find('.js-play').hide()\n  const $sampler = element.find('.js-sampler')\n\n  log('Loading file list')\n  const list = await loader.fileList\n  const bmsFile = list.filter((f) => f.match(/\\.(?:bms|bme|bml|pms)$/i))[0]\n  log('Loading ' + bmsFile)\n\n  const loadedFile = await loader.file(bmsFile)\n  const arraybuffer = await loadedFile.read()\n  const buffer = Buffer.from(new Uint8Array(arraybuffer))\n  const text = await Reader.readAsync(buffer)\n  const chart = Compiler.compile(text).chart\n  const timing = Timing.fromBMSChart(chart)\n  const notes = Notes.fromBMSChart(chart)\n  const info = SongInfo.fromBMSChart(chart)\n  $('<pre wrap></pre>').text(JSON.stringify(info, null, 2)).appendTo($sampler)\n  log('Loading samples')\n  const loadedSamples = await loadSamples(notes, chart)\n  log('Click the button to play!')\n  await waitForPlay()\n  void (function () {\n    master.unmute()\n    for (const note of notes.all()) {\n      setTimeout(() => {\n        const sample = loadedSamples[note.keysound]\n        if (!sample) {\n          console.log('warn: unknown sample ' + note.keysound)\n          return\n        }\n        const span = $('<span></span>')\n          .text('[' + note.keysound + '] ')\n          .appendTo($sampler)\n        const instance = sample.play()\n        $sampler[0].scrollTop = $sampler[0].scrollHeight\n        instance.onstop = function () {\n          span.addClass('is-off')\n        }\n      }, timing.beatToSeconds(note.beat) * 1000)\n    }\n    return false\n  })()\n\n  function waitForPlay() {\n    return new Promise(function (resolve) {\n      $play.show()\n      $play.on('click', () => {\n        resolve()\n        $play.hide()\n      })\n    })\n  }\n\n  function log(t) {\n    $log.text(t)\n  }\n\n  function loadSamples(_notes, _chart) {\n    const samples = {}\n    const promises = []\n    let completed = 0\n\n    for (const note of _notes.all()) {\n      const keysound = note.keysound\n      if (!(keysound in samples)) {\n        samples[keysound] = null\n        promises.push(async () => {\n          try {\n            const blob = await loadKeysound(\n              _chart.headers.get('wav' + keysound)\n            )\n            const sample = await master.sample(blob)\n            samples[keysound] = sample\n            log('[loaded ' + ++completed + '/' + promises.length + ' samples]')\n          } catch (e) {\n            console.error('Unable to load ' + keysound + ': ' + e)\n          }\n        })\n      }\n    }\n\n    return Promise.all(promises).then(() => samples)\n  }\n\n  function loadKeysound(name) {\n    if (typeof name !== 'string') return Promise.reject(new Error('Empty name'))\n    return loader\n      .file(name)\n      .catch(() => loader.file(name.replace(/\\.\\w+$/, '.ogg')))\n      .catch(() => loader.file(name.replace(/\\.\\w+$/, '.mp3')))\n      .catch(() => loader.file(name.replace(/\\.\\w+$/, '.wav')))\n      .then((file) => file.read())\n  }\n}\n","\nvar content = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./style.scss\");\n\nif(typeof content === 'string') content = [[module.id, content, '']];\n\nvar transform;\nvar insertInto;\n\n\n\nvar options = {\"hmr\":true}\n\noptions.transform = transform\noptions.insertInto = undefined;\n\nvar update = require(\"!../../../../common/temp/node_modules/.pnpm/style-loader@0.23.1/node_modules/style-loader/lib/addStyles.js\")(content, options);\n\nif(content.locals) module.exports = content.locals;\n\nif(module.hot) {\n\tmodule.hot.accept(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./style.scss\", function() {\n\t\tvar newContent = require(\"!!../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/index.js??ref--9-1!../../../../common/temp/node_modules/.pnpm/postcss-loader@3.0.0/node_modules/postcss-loader/src/index.js??postcss!../../../../common/temp/node_modules/.pnpm/sass-loader@10.3.1_sass@1.56.0+webpack@4.46.0/node_modules/sass-loader/dist/cjs.js??ref--9-3!./style.scss\");\n\n\t\tif(typeof newContent === 'string') newContent = [[module.id, newContent, '']];\n\n\t\tvar locals = (function(a, b) {\n\t\t\tvar key, idx = 0;\n\n\t\t\tfor(key in a) {\n\t\t\t\tif(!b || a[key] !== b[key]) return false;\n\t\t\t\tidx++;\n\t\t\t}\n\n\t\t\tfor(key in b) idx--;\n\n\t\t\treturn idx === 0;\n\t\t}(content.locals, newContent.locals));\n\n\t\tif(!locals) throw new Error('Aborting CSS HMR due to changed css-modules locals.');\n\n\t\tupdate(newContent);\n\t});\n\n\tmodule.hot.dispose(function() { update(); });\n}","exports = module.exports = require(\"../../../../common/temp/node_modules/.pnpm/css-loader@1.0.1_webpack@4.46.0/node_modules/css-loader/lib/css-base.js\")(false);\n// imports\n\n\n// module\nexports.push([module.id, \".jukebox--overlay {\\n  position: fixed;\\n  top: 0;\\n  right: 0;\\n  bottom: 0;\\n  left: 0;\\n  background: rgba(139, 134, 133, 0.5);\\n}\\n.jukebox--inner {\\n  position: absolute;\\n  top: 50%;\\n  left: 50%;\\n  -webkit-transform: translate(-50%, -50%);\\n          transform: translate(-50%, -50%);\\n  border: 2px solid #8b8685;\\n  background: #252423;\\n  padding: 12px;\\n}\\n.jukebox--sampler {\\n  background: #090807;\\n  padding: 9px;\\n  border: 1px solid #8b8685;\\n  margin-top: 10px;\\n  height: 192px;\\n  width: 40em;\\n  overflow: auto;\\n}\\n.jukebox--sampler span {\\n  font-size: 12px;\\n  opacity: 1;\\n  transition: 0.5s opacity;\\n}\\n.jukebox--sampler span.is-off {\\n  color: #8b8685;\\n  opacity: 0;\\n}\\n.jukebox h1 {\\n  margin: 0 0 20px;\\n  font: 30px Helvetica Neue, Helvetica, sans-serif;\\n}\\n.jukebox p {\\n  margin: 10px 0 0;\\n}\\n.jukebox .jukebox--status {\\n  color: #8b8685;\\n  font-style: italic;\\n  margin-bottom: 20px;\\n}\\n.jukebox button {\\n  display: block;\\n  box-sizing: border-box;\\n  width: 100%;\\n  background: #090807;\\n  color: #7f3;\\n  cursor: pointer;\\n  border: 1px solid #8b8685;\\n  padding: 8px;\\n  font: bold 15px verdana, sans-serif;\\n  margin-top: 18px;\\n}\", \"\"]);\n\n// exports\n","var pug = require(\"!../../../../common/temp/node_modules/.pnpm/pug@2.0.4/node_modules/pug-runtime/index.js\");\n\nfunction template(locals) {var pug_html = \"\", pug_mixins = {}, pug_interp;pug_html = pug_html + \"\\u003Cdiv class=\\\"jukebox\\\"\\u003E\\u003Cdiv class=\\\"jukebox--overlay\\\"\\u003E\\u003C\\u002Fdiv\\u003E\\u003Cdiv class=\\\"jukebox--inner\\\"\\u003E\\u003Ch1\\u003EBMS Jukebox\\u003C\\u002Fh1\\u003E\\u003Cp class=\\\"jukebox--status js-log\\\"\\u003EWaiting for BMS file...\\u003C\\u002Fp\\u003E\\u003Cp\\u003EGoogle Chrome: Drag a BMS folder into this box.\\u003C\\u002Fp\\u003E\\u003Cp\\u003EFirefox, Safari: Select all files (BMS+sounds) and drag into this box.\\u003C\\u002Fp\\u003E\\u003Cbutton class=\\\"js-play\\\"\\u003EClick Here to Play\\u003C\\u002Fbutton\\u003E\\u003Cdiv class=\\\"js-sampler jukebox--sampler\\\"\\u003E\\u003C\\u002Fdiv\\u003E\\u003C\\u002Fdiv\\u003E\\u003C\\u002Fdiv\\u003E\";;return pug_html;};\nmodule.exports = template;","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getReaderOptionsFromFilename = exports.readAsync = exports.read = void 0;\nvar chardet = require(\"bemuse-chardet/bemuse-chardet\");\nfunction read(buffer) {\n    throw new Error('Synchronous read unsupported in browser!');\n}\nexports.read = read;\nfunction readAsync() {\n    var args = [];\n    for (var _i = 0; _i < arguments.length; _i++) {\n        args[_i] = arguments[_i];\n    }\n    var buffer = args[0];\n    var options = args[1];\n    var charset = (options && options.forceEncoding) || chardet.detect(buffer);\n    return new Promise(function (resolve, reject) {\n        var reader = new FileReader();\n        reader.onload = function () {\n            resolve(reader.result);\n        };\n        reader.onerror = function () {\n            reject(new Error('cannot read it'));\n        };\n        reader.readAsText(new Blob([buffer]), charset);\n    });\n}\nexports.readAsync = readAsync;\nvar getReaderOptionsFromFilename_1 = require(\"./getReaderOptionsFromFilename\");\nObject.defineProperty(exports, \"getReaderOptionsFromFilename\", { enumerable: true, get: function () { return getReaderOptionsFromFilename_1.getReaderOptionsFromFilename; } });\n//# sourceMappingURL=index.web.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.getReaderOptionsFromFilename = void 0;\n/**\n * Given the filename, returns the reader options.\n * @param {string} filename\n */\nfunction getReaderOptionsFromFilename(filename) {\n    var forceEncoding;\n    if (filename.match(/\\.sjis\\.\\w+$/i)) {\n        forceEncoding = 'Shift-JIS';\n    }\n    if (filename.match(/\\.euc_kr\\.\\w+$/i)) {\n        forceEncoding = 'EUC-KR';\n    }\n    if (filename.match(/\\.utf8\\.\\w+$/i)) {\n        forceEncoding = 'UTF-8';\n    }\n    return { forceEncoding: forceEncoding };\n}\nexports.getReaderOptionsFromFilename = getReaderOptionsFromFilename;\n//# sourceMappingURL=getReaderOptionsFromFilename.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.compile = void 0;\n// Public: A module that takes a string representing the BMS notechart,\n// parses it, and compiles into a {BMSChart}.\n/* module */\nvar match_1 = require(\"../util/match\");\nvar chart_1 = require(\"../bms/chart\");\nvar matchers = {\n    bms: {\n        random: /^#RANDOM\\s+(\\d+)$/i,\n        if: /^#IF\\s+(\\d+)$/i,\n        endif: /^#ENDIF$/i,\n        timeSignature: /^#(\\d\\d\\d)02:(\\S*)$/,\n        channel: /^#(?:EXT\\s+#)?(\\d\\d\\d)(\\S\\S):(\\S*)$/,\n        header: /^#(\\w+)(?:\\s+(\\S.*))?$/,\n    },\n    dtx: {\n        random: /^#RANDOM\\s+(\\d+)$/i,\n        if: /^#IF\\s+(\\d+)$/i,\n        endif: /^#ENDIF$/i,\n        timeSignature: /^#(\\d\\d\\d)02:\\s*(\\S*)$/,\n        channel: /^#(?:EXT\\s+#)?(\\d\\d\\d)(\\S\\S):\\s*(\\S*)$/,\n        header: /^#(\\w+):(?:\\s+(\\S.*))?$/,\n    },\n};\n/**\n * Reads the string representing the BMS notechart, parses it,\n * and compiles into a {BMSChart}.\n * @param text the BMS notechart\n * @param options additional parser options\n */\nfunction compile(text, options) {\n    options = options || {};\n    var chart = new chart_1.BMSChart();\n    var rng = options.rng ||\n        function (max) {\n            return 1 + Math.floor(Math.random() * max);\n        };\n    var matcher = (options.format && matchers[options.format]) || matchers.bms;\n    var randomStack = [];\n    var skipStack = [false];\n    var result = {\n        headerSentences: 0,\n        channelSentences: 0,\n        controlSentences: 0,\n        skippedSentences: 0,\n        malformedSentences: 0,\n        /**\n         * The resulting chart\n         */\n        chart: chart,\n        /**\n         * Warnings found during compilation\n         */\n        warnings: [],\n    };\n    eachLine(text, function (text, lineNumber) {\n        var flow = true;\n        if (text.charAt(0) !== '#')\n            return;\n        (0, match_1.match)(text)\n            .when(matcher.random, function (m) {\n            result.controlSentences += 1;\n            randomStack.push(rng(+m[1]));\n        })\n            .when(matcher.if, function (m) {\n            result.controlSentences += 1;\n            skipStack.push(randomStack[randomStack.length - 1] !== +m[1]);\n        })\n            .when(matcher.endif, function (m) {\n            result.controlSentences += 1;\n            skipStack.pop();\n        })\n            .else(function () {\n            flow = false;\n        });\n        if (flow)\n            return;\n        var skipped = skipStack[skipStack.length - 1];\n        (0, match_1.match)(text)\n            .when(matcher.timeSignature, function (m) {\n            result.channelSentences += 1;\n            if (!skipped)\n                chart.timeSignatures.set(+m[1], +m[2]);\n        })\n            .when(matcher.channel, function (m) {\n            result.channelSentences += 1;\n            if (!skipped)\n                handleChannelSentence(+m[1], m[2], m[3], lineNumber);\n        })\n            .when(matcher.header, function (m) {\n            result.headerSentences += 1;\n            if (!skipped)\n                chart.headers.set(m[1], m[2]);\n        })\n            .else(function () {\n            warn(lineNumber, 'Invalid command');\n        });\n    });\n    return result;\n    function handleChannelSentence(measure, channel, string, lineNumber) {\n        var items = Math.floor(string.length / 2);\n        if (items === 0)\n            return;\n        for (var i = 0; i < items; i++) {\n            var value = string.substr(i * 2, 2);\n            var fraction = i / items;\n            if (value === '00')\n                continue;\n            chart.objects.add({\n                measure: measure,\n                fraction: fraction,\n                value: value,\n                channel: channel,\n                lineNumber: lineNumber,\n            });\n        }\n    }\n    function warn(lineNumber, message) {\n        result.warnings.push({\n            lineNumber: lineNumber,\n            message: message,\n        });\n    }\n}\nexports.compile = compile;\nfunction eachLine(text, callback) {\n    text\n        .split(/\\r\\n|\\r|\\n/)\n        .map(function (line) {\n        return line.trim();\n    })\n        .forEach(function (line, index) {\n        callback(line, index + 1);\n    });\n}\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\n//# sourceMappingURL=types.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Segment = void 0;\nvar data_structure_1 = __importDefault(require(\"data-structure\"));\nexports.Segment = (0, data_structure_1.default)({\n    t: 'number',\n    x: 'number',\n    dx: 'number',\n});\n//# sourceMappingURL=segment.js.map","\"use strict\";\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Notes = void 0;\nvar note_1 = require(\"./note\");\nvar invariant_1 = __importDefault(require(\"invariant\"));\nvar ChannelMapping = __importStar(require(\"./channels\"));\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A Notes holds the {Note} objects in the game.\n * A note object may or may not be playable.\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #00111:AA\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {Notes} using `fromBMSChart()`:\n *\n * ```js\n * var notes = Notes.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can get all notes using `.all()` method\n *\n * ```js\n * notes.all()\n * ```\n */\nvar Notes = /** @class */ (function () {\n    /**\n     * @param {BMSNote[]} notes An array of Note objects\n     */\n    function Notes(notes) {\n        notes.forEach(note_1.Note);\n        this._notes = notes;\n    }\n    /**\n     * Returns the number of notes in this object,\n     * counting both playable and non-playable notes.\n     */\n    Notes.prototype.count = function () {\n        return this._notes.length;\n    };\n    /**\n     * Returns an Array of all notes.\n     */\n    Notes.prototype.all = function () {\n        return this._notes.slice();\n    };\n    /**\n     * Creates a Notes object from a BMSChart.\n     * @param chart the chart to process\n     * @param options options\n     */\n    Notes.fromBMSChart = function (chart, options) {\n        void chart_1.BMSChart;\n        options = options || {};\n        var mapping = options.mapping || Notes.CHANNEL_MAPPING.IIDX_P1;\n        var builder = new BMSNoteBuilder(chart, { mapping: mapping });\n        return builder.build();\n    };\n    Notes.CHANNEL_MAPPING = ChannelMapping;\n    return Notes;\n}());\nexports.Notes = Notes;\nvar BMSNoteBuilder = /** @class */ (function () {\n    function BMSNoteBuilder(chart, options) {\n        this._chart = chart;\n        (0, invariant_1.default)(options.mapping, 'Expected options.mapping');\n        (0, invariant_1.default)(typeof options.mapping === 'object', 'options.mapping must be object');\n        this._mapping = options.mapping;\n        this._notes = [];\n        this._activeLN = {};\n        this._lastNote = {};\n        this._lnObj = (this._chart.headers.get('lnobj') || '').toLowerCase();\n        this._channelMapping = this._mapping;\n        this._objects = this._chart.objects.allSorted();\n    }\n    BMSNoteBuilder.prototype.build = function () {\n        var _this = this;\n        this._objects.forEach(function (object) {\n            _this._handle(object);\n        });\n        return new Notes(this._notes);\n    };\n    BMSNoteBuilder.prototype._handle = function (object) {\n        if (object.channel === '01') {\n            this._handleNormalNote(object);\n        }\n        else {\n            switch (object.channel.charAt(0).toUpperCase()) {\n                case '1':\n                case '2':\n                case 'D':\n                case 'E':\n                    this._handleNormalNote(object);\n                    break;\n                case '5':\n                case '6':\n                    this._handleLongNote(object);\n                    break;\n            }\n        }\n    };\n    BMSNoteBuilder.prototype._handleNormalNote = function (object) {\n        var channel = this._normalizeChannel(object.channel);\n        var beat = this._getBeat(object);\n        if (object.value.toLowerCase() === this._lnObj) {\n            if (this._lastNote[channel]) {\n                this._lastNote[channel].endBeat = beat;\n            }\n        }\n        else {\n            var note = {\n                beat: beat,\n                endBeat: undefined,\n                keysound: object.value,\n                column: this._getColumn(channel),\n            };\n            this._lastNote[channel] = note;\n            this._notes.push(note);\n        }\n    };\n    BMSNoteBuilder.prototype._handleLongNote = function (object) {\n        var channel = this._normalizeChannel(object.channel);\n        var beat = this._getBeat(object);\n        if (this._activeLN[channel]) {\n            var note = this._activeLN[channel];\n            note.endBeat = beat;\n            this._notes.push(note);\n            delete this._activeLN[channel];\n        }\n        else {\n            this._activeLN[channel] = {\n                beat: beat,\n                keysound: object.value,\n                column: this._getColumn(channel),\n            };\n        }\n    };\n    BMSNoteBuilder.prototype._getBeat = function (object) {\n        return this._chart.measureToBeat(object.measure, object.fraction);\n    };\n    BMSNoteBuilder.prototype._getColumn = function (channel) {\n        return this._channelMapping[channel];\n    };\n    BMSNoteBuilder.prototype._normalizeChannel = function (channel) {\n        return channel.replace(/^5/, '1').replace(/^6/, '2');\n    };\n    return BMSNoteBuilder;\n}());\n//# sourceMappingURL=index.js.map","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Note = void 0;\nvar data_structure_1 = __importDefault(require(\"data-structure\"));\nexports.Note = (0, data_structure_1.default)({\n    beat: 'number',\n    endBeat: data_structure_1.default.maybe('number'),\n    column: data_structure_1.default.maybe('string'),\n    keysound: 'string',\n});\n//# sourceMappingURL=note.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.IIDX_DP_LANDMINE = exports.IIDX_P1_LANDMINE = exports.IIDX_DP = exports.IIDX_P1 = void 0;\nexports.IIDX_P1 = {\n    '11': '1',\n    '12': '2',\n    '13': '3',\n    '14': '4',\n    '15': '5',\n    '18': '6',\n    '19': '7',\n    '16': 'SC',\n};\nexports.IIDX_DP = {\n    '11': '1',\n    '12': '2',\n    '13': '3',\n    '14': '4',\n    '15': '5',\n    '18': '6',\n    '19': '7',\n    '16': 'SC',\n    '21': '8',\n    '22': '9',\n    '23': '10',\n    '24': '11',\n    '25': '12',\n    '28': '13',\n    '29': '14',\n    '26': 'SC2',\n};\nexports.IIDX_P1_LANDMINE = {\n    D1: '1',\n    D2: '2',\n    D3: '3',\n    D4: '4',\n    D5: '5',\n    D8: '6',\n    D9: '7',\n    D6: 'SC',\n};\nexports.IIDX_DP_LANDMINE = {\n    D1: '1',\n    D2: '2',\n    D3: '3',\n    D4: '4',\n    D5: '5',\n    D8: '6',\n    D9: '7',\n    D6: 'SC',\n    E1: '8',\n    E2: '9',\n    E3: '10',\n    E4: '11',\n    E5: '12',\n    E8: '13',\n    E9: '14',\n    E6: 'SC2',\n};\n//# sourceMappingURL=channels.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Timing = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\nvar precedence = { bpm: 1, stop: 2 };\n/**\n * A Timing represents the timing information of a musical score.\n * A Timing object provides facilities to synchronize between\n * metric time (seconds) and musical time (beats).\n *\n * A Timing are created from a series of actions:\n *\n * - BPM changes.\n * - STOP action.\n */\nvar Timing = /** @class */ (function () {\n    /**\n     * Constructs a Timing with an initial BPM and specified actions.\n     *\n     * Generally, you would use `Timing.fromBMSChart` to create an instance\n     * from a BMSChart, but the constructor may also be used in other situations\n     * unrelated to the BMS file format. (e.g. bmson package)\n     */\n    function Timing(initialBPM, actions) {\n        var state = { bpm: initialBPM, beat: 0, seconds: 0 };\n        var segments = [];\n        segments.push({\n            t: 0,\n            x: 0,\n            dx: state.bpm / 60,\n            bpm: state.bpm,\n            inclusive: true,\n        });\n        actions = actions.slice();\n        actions.sort(function (a, b) {\n            return a.beat - b.beat || precedence[a.type] - precedence[b.type];\n        });\n        actions.forEach(function (action) {\n            var beat = action.beat;\n            var seconds = state.seconds + ((beat - state.beat) * 60) / state.bpm;\n            switch (action.type) {\n                case 'bpm':\n                    state.bpm = action.bpm;\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: state.bpm / 60,\n                        bpm: state.bpm,\n                        inclusive: true,\n                    });\n                    break;\n                case 'stop':\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: 0,\n                        bpm: state.bpm,\n                        inclusive: true,\n                    });\n                    seconds += ((action.stopBeats || 0) * 60) / state.bpm;\n                    segments.push({\n                        t: seconds,\n                        x: beat,\n                        dx: state.bpm / 60,\n                        bpm: state.bpm,\n                        inclusive: false,\n                    });\n                    break;\n                default:\n                    throw new Error('Unrecognized segment object!');\n            }\n            state.beat = beat;\n            state.seconds = seconds;\n        });\n        this._speedcore = new speedcore_1.Speedcore(segments);\n        this._eventBeats = (0, lodash_1.uniq)((0, lodash_1.map)(actions, function (action) { return action.beat; }));\n    }\n    /**\n     * Convert the given beat into seconds.\n     * @param {number} beat\n     */\n    Timing.prototype.beatToSeconds = function (beat) {\n        return this._speedcore.t(beat);\n    };\n    /**\n     * Convert the given second into beats.\n     * @param {number} seconds\n     */\n    Timing.prototype.secondsToBeat = function (seconds) {\n        return this._speedcore.x(seconds);\n    };\n    /**\n     * Returns the BPM at the specified beat.\n     * @param {number} beat\n     */\n    Timing.prototype.bpmAtBeat = function (beat) {\n        return this._speedcore.segmentAtX(beat).bpm;\n    };\n    /**\n     * Returns an array representing the beats where there are events.\n     */\n    Timing.prototype.getEventBeats = function () {\n        return this._eventBeats;\n    };\n    /**\n     * Creates a Timing instance from a BMSChart.\n     * @param {BMSChart} chart\n     */\n    Timing.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var actions = [];\n        chart.objects.all().forEach(function (object) {\n            var bpm;\n            var beat = chart.measureToBeat(object.measure, object.fraction);\n            if (object.channel === '03') {\n                bpm = parseInt(object.value, 16);\n                actions.push({ type: 'bpm', beat: beat, bpm: bpm });\n            }\n            else if (object.channel === '08') {\n                bpm = +chart.headers.get('bpm' + object.value);\n                if (!isNaN(bpm))\n                    actions.push({ type: 'bpm', beat: beat, bpm: bpm });\n            }\n            else if (object.channel === '09') {\n                var stopBeats = +chart.headers.get('stop' + object.value) / 48;\n                actions.push({ type: 'stop', beat: beat, stopBeats: stopBeats });\n            }\n        });\n        return new Timing(+chart.headers.get('bpm') || 60, actions);\n    };\n    return Timing;\n}());\nexports.Timing = Timing;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.SongInfo = void 0;\nvar match_1 = require(\"../util/match\");\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A SongInfo represents the song info, such as title, artist, genre.\n *\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #TITLE Exargon [HYPER]\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {SongInfo} using `fromBMSChart()`:\n *\n * ```js\n * var info = SongInfo.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can query the song information by accessing its properties.\n *\n * ```js\n * info.title     // => 'Exargon'\n * info.subtitles // => ['HYPER']\n * ```\n */\nvar SongInfo = /** @class */ (function () {\n    /**\n     * Constructs a SongInfo with given data\n     * @param info the properties to set on this new instance\n     */\n    function SongInfo(info) {\n        /** the song title */\n        this.title = 'NO TITLE';\n        /** the song artist */\n        this.artist = 'NO ARTIST';\n        /** the song genre */\n        this.genre = 'NO GENRE';\n        /**\n         * the song's subtitles, one line per element.\n         * The subtitle may be used to represent the difficulty name,\n         * such as NORMAL, HYPER, ANOTHER.\n         * @type {string[]}\n         */\n        this.subtitles = [];\n        /**\n         * the song's other artists, one artist per element.\n         * @type {string[]}\n         */\n        this.subartists = [];\n        /**\n         * the difficulty.\n         * Meaning of the number is same as BMS's [`#DIFFICULTY`](http:*hitkey.nekokan.dyndns.info/cmds.htm#DIFFICULTY) header.\n         *\n         * | difficulty | meaning  |\n         * | ----------:|:--------:|\n         * |          1 | BEGINNER |\n         * |          2 | NORMAL   |\n         * |          3 | HYPER    |\n         * |          4 | ANOTHER  |\n         * |          5 | INSANE   |\n         */\n        this.difficulty = 0;\n        /**\n         * the level of the song.\n         * When converted from a BMS chart, this is the value of `#PLAYLEVEL` header.\n         */\n        this.level = 0;\n        if (info)\n            (0, lodash_1.assign)(this, info);\n    }\n    /**\n     * Constructs a new {SongInfo} object from a {BMSChart}.\n     * @param chart A {BMSChart} to construct a {SongInfo} from\n     */\n    SongInfo.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var info = {};\n        var title = chart.headers.get('title');\n        var artist = chart.headers.get('artist');\n        var genre = chart.headers.get('genre');\n        var difficulty = +chart.headers.get('difficulty') || 0;\n        var level = +chart.headers.get('playlevel') || 0;\n        var subtitles = chart.headers.getAll('subtitle');\n        var subartists = chart.headers.getAll('subartist');\n        if (typeof title === 'string' && !subtitles) {\n            var extractSubtitle = function (m) {\n                title = m[1];\n                subtitles = [m[2]];\n            };\n            (0, match_1.match)(title)\n                .when(/^(.*\\S)\\s*-(.+?)-$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*(.+?)$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*\\((.+?)\\)$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*\\[(.+?)\\]$/, extractSubtitle)\n                .when(/^(.*\\S)\\s*<(.+?)>$/, extractSubtitle);\n        }\n        if (title)\n            info.title = title;\n        if (artist)\n            info.artist = artist;\n        if (genre)\n            info.genre = genre;\n        if (subtitles)\n            info.subtitles = subtitles;\n        if (subartists)\n            info.subartists = subartists;\n        if (difficulty)\n            info.difficulty = difficulty;\n        if (level)\n            info.level = level;\n        return new SongInfo(info);\n    };\n    return SongInfo;\n}());\nexports.SongInfo = SongInfo;\n//# sourceMappingURL=index.js.map","\"use strict\";\n// Public: A module that exposes {Keysounds}\n/* module */\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Keysounds = void 0;\nvar lodash_1 = require(\"../util/lodash\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A simple mapping between keysounds ID and the file name.\n * ## Example\n *\n * If you have a BMS like this:\n *\n * ```\n * #WAVAA cat.wav\n * ```\n *\n * Having parsed it using a {Compiler} into a {BMSChart},\n * you can create a {Keysounds} using `fromBMSChart()`:\n *\n * ```js\n * var keysounds = Keysounds.fromBMSChart(bmsChart)\n * ```\n *\n * Then you can retrieve the filename using `.get()`:\n *\n * ```js\n * keysounds.get('aa') // => 'cat.wav'\n * ```\n */\nvar Keysounds = /** @class */ (function () {\n    function Keysounds(map) {\n        this._map = map;\n    }\n    /**\n     * Returns the keysound file at the specified ID.\n     * @param id the two-character keysound ID\n     * @returns the sound filename\n     */\n    Keysounds.prototype.get = function (id) {\n        return this._map[id.toLowerCase()];\n    };\n    /**\n     * Returns an array of unique filenames in this Keysounds object.\n     * @returns filenames array\n     */\n    Keysounds.prototype.files = function () {\n        return (0, lodash_1.uniq)((0, lodash_1.values)(this._map));\n    };\n    /**\n     * Returns a mapping from keysound ID to keysound filename.\n     *\n     * **Warning:** This method returns the internal data structure used\n     * in this Keysounds object. Do not mutate!\n     */\n    Keysounds.prototype.all = function () {\n        return this._map;\n    };\n    /**\n     * Constructs a new {Keysounds} object from a {BMSChart}.\n     * @param chart\n     */\n    Keysounds.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var map = {};\n        chart.headers.each(function (name, value) {\n            var match = name.match(/^wav(\\S\\S)$/i);\n            if (!match)\n                return;\n            map[match[1].toLowerCase()] = value;\n        });\n        return new Keysounds(map);\n    };\n    return Keysounds;\n}());\nexports.Keysounds = Keysounds;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Positioning = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * A Positioning represents the relation between song beats and\n * display position, and provides a way to convert between them.\n *\n * In some rhythm games, the amount of scrolling per beat may be different.\n * StepManias `#SCROLL` segments is an example.\n */\nvar Positioning = /** @class */ (function () {\n    /**\n     * Constructs a Positioning from the given `segments`.\n     * @param segments\n     */\n    function Positioning(segments) {\n        this._speedcore = new speedcore_1.Speedcore(segments);\n    }\n    /**\n     * Returns the scrolling speed at specified beat.\n     * @param beat the beat number\n     */\n    Positioning.prototype.speed = function (beat) {\n        return this._speedcore.dx(beat);\n    };\n    /**\n     * Returns the total elapsed scrolling amount at specified beat.\n     * @param beat the beat number\n     */\n    Positioning.prototype.position = function (beat) {\n        return this._speedcore.x(beat);\n    };\n    /**\n     * Creates a {Positioning} object from the {BMSChart}.\n     * @param {BMSChart} chart A {BMSChart} to construct a {Positioning} from\n     */\n    Positioning.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var segments = [];\n        var x = 0;\n        segments.push({\n            t: 0,\n            x: x,\n            dx: 1,\n            inclusive: true,\n        });\n        chart.objects.allSorted().forEach(function (object) {\n            if (object.channel === 'SC') {\n                var beat = chart.measureToBeat(object.measure, object.fraction);\n                var dx = +chart.headers.get('scroll' + object.value);\n                if (isNaN(dx))\n                    return;\n                var previous = segments[segments.length - 1];\n                x += (beat - previous.t) * previous.dx;\n                if (beat === 0 && segments.length === 1) {\n                    segments[0].dx = dx;\n                }\n                else {\n                    segments.push({\n                        t: beat,\n                        x: x,\n                        dx: dx,\n                        inclusive: true,\n                    });\n                }\n            }\n        });\n        return new Positioning(segments);\n    };\n    return Positioning;\n}());\nexports.Positioning = Positioning;\n//# sourceMappingURL=index.js.map","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Spacing = void 0;\nvar speedcore_1 = require(\"../speedcore\");\nvar chart_1 = require(\"../bms/chart\");\n/**\n * Public: A Spacing represents the relation between song beats and\n * notes spacing.\n *\n * In some rhythm games, such as Pump It Up!,\n * the speed (note spacing factor) may be adjusted by the notechart.\n * StepManias `#SPEED` segments is an example.\n */\nvar Spacing = /** @class */ (function () {\n    /**\n     * Constructs a Spacing from the given `segments`.\n     */\n    function Spacing(segments) {\n        if (segments.length > 0) {\n            this._speedcore = new speedcore_1.Speedcore(segments);\n        }\n    }\n    /**\n     * Returns the note spacing factor at the specified beat.\n     * @param beat the beat\n     */\n    Spacing.prototype.factor = function (beat) {\n        if (this._speedcore) {\n            return this._speedcore.x(beat);\n        }\n        else {\n            return 1;\n        }\n    };\n    /**\n     * Creates a {Spacing} object from the {BMSChart}.\n     *\n     * ## `#SPEED` and `#xxxSP`\n     *\n     * Speed is defined as keyframes. These keyframes will be linearly interpolated.\n     *\n     * ```\n     * #SPEED01 1.0\n     * #SPEED02 2.0\n     *\n     * #001SP:01010202\n     * ```\n     *\n     * In this example, the note spacing factor will gradually change\n     * from 1.0x at beat 1 to 2.0x at beat 2.\n     *\n     * Returns a {Spacing} object\n     *\n     * @param {BMSChart} chart the chart\n     */\n    Spacing.fromBMSChart = function (chart) {\n        void chart_1.BMSChart;\n        var segments = [];\n        chart.objects.allSorted().forEach(function (object) {\n            if (object.channel === 'SP') {\n                var beat = chart.measureToBeat(object.measure, object.fraction);\n                var factor = +chart.headers.get('speed' + object.value);\n                if (isNaN(factor))\n                    return;\n                if (segments.length > 0) {\n                    var previous = segments[segments.length - 1];\n                    previous.dx = (factor - previous.x) / (beat - previous.t);\n                }\n                segments.push({\n                    t: beat,\n                    x: factor,\n                    dx: 0,\n                    inclusive: true,\n                });\n            }\n        });\n        if (segments.length > 0) {\n            segments.unshift({\n                t: 0,\n                x: segments[0].x,\n                dx: 0,\n                inclusive: true,\n            });\n        }\n        return new Spacing(segments);\n    };\n    return Spacing;\n}());\nexports.Spacing = Spacing;\n//# sourceMappingURL=index.js.map","var g;\n\n// This works in non-strict mode\ng = (function() {\n\treturn this;\n})();\n\ntry {\n\t// This works if eval is allowed (see CSP)\n\tg = g || new Function(\"return this\")();\n} catch (e) {\n\t// This works if the window reference is available\n\tif (typeof window === \"object\") g = window;\n}\n\n// g can still be undefined, but nothing to do about it...\n// We return undefined, instead of nothing here, so it's\n// easier to handle this case. if(!global) { ...}\n\nmodule.exports = g;\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.BMSChart = void 0;\nvar headers_1 = require(\"./headers\");\nvar objects_1 = require(\"./objects\");\nvar time_signatures_1 = require(\"../time-signatures\");\n/**\n * A BMSChart holds information about a particular BMS notechart.\n * Note that a BMSChart does not contain any information about `#RANDOM`,\n * as they are already processed after compilation.\n *\n * There is not many useful things you can do with a BMSChart other than\n * accessing the header fields and objects inside it.\n *\n * To extract information from a BMSChart,\n * please look at the documentation of higher-level classes,\n * such as {Keysounds}, {Notes}, and {Timing}.\n */\nvar BMSChart = /** @class */ (function () {\n    function BMSChart() {\n        /**\n         * {BMSHeaders} representing the BMS-specific headers of this notechart\n         */\n        this.headers = new headers_1.BMSHeaders();\n        /**\n         * {BMSObjects} representing all objects of this notechart\n         */\n        this.objects = new objects_1.BMSObjects();\n        /**\n         * {TimeSignatures} representing the time signature information in this chart\n         */\n        this.timeSignatures = new time_signatures_1.TimeSignatures();\n    }\n    /**\n     * Public: Converts measure number and fraction into beat.\n     * A single beat is equivalent to a quarter note in common time signature.\n     *\n     * @param {number} measure representing the measure number, starting from 0\n     * @param {number} fraction representing the fraction inside that measure, from 0 to 1\n     */\n    BMSChart.prototype.measureToBeat = function (measure, fraction) {\n        return this.timeSignatures.measureToBeat(measure, fraction);\n    };\n    return BMSChart;\n}());\nexports.BMSChart = BMSChart;\n//# sourceMappingURL=chart.js.map","import {\n  ARCHIVE_REGEXP,\n  CustomSongResources,\n  downloadFileEntryFromURL,\n} from './custom-song-resources'\nimport { FileEntry, ICustomSongResources, LoggingFunction } from './types'\n\nimport { addUnprefixed } from './addUnprefixed'\n\n// TODO [#634]: Remove the `DndResources` class and have users of this class create a `CustomSongResources` directly.\n//\n// The original implementation of DndResources class has been extracted\n// into a CustomSongResources superclass in commit cc6a6e70586487ef476890f5a7911837186a7a32,\n// so that part of its logic can be re-used in other contexts, such as in commit ba9e15bab72fec17a144e40433cb3a4ffd31db5b.\n//\n// Now this `DndResources` class is really dumb and we want to prefer composition over inheritance.\n// This class should be removed.\nexport class DndResources\n  extends CustomSongResources\n  implements ICustomSongResources\n{\n  constructor(event: DragEvent) {\n    super({\n      getFiles: (log) => getFilesFromEvent(event, log),\n    })\n  }\n}\n\nexport default DndResources\n\nasync function getFilesFromEvent(\n  event: DragEvent,\n  log: LoggingFunction\n): Promise<FileEntry[]> {\n  const out: FileEntry[] = []\n  const dataTransfer = event.dataTransfer\n  if (!dataTransfer) {\n    throw new Error('Expect event.dataTransfer to be present')\n  }\n  if (dataTransfer.types.indexOf('text/uri-list') > -1) {\n    const url = dataTransfer\n      .getData('text/uri-list')\n      .split(/\\r\\n|\\r|\\n/)\n      .filter((t) => t && !t.startsWith('#'))[0]\n    if (ARCHIVE_REGEXP.test(url && url.replace(/[?#].*/, ''))) {\n      log('Link to archive file detected. Trying to download')\n      return [await downloadFileEntryFromURL(url, log)]\n    }\n  } else if (dataTransfer.items) {\n    for (const item of Array.from(dataTransfer.items)) {\n      await readItem(item)\n    }\n  } else if (dataTransfer.files) {\n    for (const file of Array.from(dataTransfer.files)) {\n      addFile(file)\n    }\n  }\n  return out\n\n  async function readItem(item: DataTransferItem) {\n    const entry = item.webkitGetAsEntry && item.webkitGetAsEntry()\n    if (entry) {\n      await readEntry(entry)\n    } else {\n      const file = item.getAsFile && item.getAsFile()\n      if (file) addFile(file)\n    }\n  }\n\n  function readEntry(entry: any, prefix = '') {\n    if (entry.isFile) {\n      return readFile(entry, prefix)\n    } else if (entry.isDirectory) {\n      return readDirectory(entry, prefix)\n    }\n  }\n\n  async function readFile(entry: any, prefix = '') {\n    const file = await new Promise<File>((resolve, reject) => {\n      entry.file(resolve, reject)\n    })\n    addFile(file, prefix)\n    return file\n  }\n\n  async function readDirectory(dir: any, prefix = '') {\n    const entries: any[] = []\n    const reader = dir.createReader()\n    const readMore = () =>\n      new Promise<any>((resolve, reject) => {\n        reader.readEntries(resolve, reject)\n      })\n    for (;;) {\n      const results = await readMore()\n      if (!results || results.length === 0) break\n      entries.push(...Array.from(results))\n    }\n    for (const entry of entries) {\n      await readEntry(entry, prefix + dir.name + '/')\n    }\n  }\n\n  function addFile(file: File, prefix = '') {\n    if (file) {\n      addUnprefixed(prefix, file.name, (name) => {\n        out.push({ name, file })\n      })\n    }\n  }\n}\n","\"use strict\";\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Speedcore = void 0;\nvar segment_1 = require(\"./segment\");\n/**\n * Speedcore is a small internally-used library.\n * A Speedcore represents a single dimensional keyframed linear motion\n * (as in equation x = f(t)), and is useful when working\n * with BPM changes ({Timing}), note spacing factor ({Spacing}), or scrolling\n * segments ({Positioning}).\n * A Speedcore is constructed from an array of Segments.\n *\n * A {Segment} is defined as `{ t, x, dx }`, such that:\n *\n * * speedcore.x(segment.t) = segment.x\n * * speedcore.t(segment.x) = segment.t\n * * speedcore.x(segment.t + dt) = segment.x + (segment.dx / dt)\n *\n *\n * ## Explanation\n *\n * One way to think of these segments is to think about tempo changes, where:\n *\n * * `t` is the elapsed time (in seconds) since song start.\n * * `x` is the elapsed beat since song start.\n * * `dx` is the amount of `x` increase per `t`. In this case, it has the\n *   unit of beats per second.\n *\n * For example, consider a song that starts at 140 BPM.\n * 32 beats later, the tempo changes to 160 BPM.\n * 128 beats later (at beat 160), the tempo reverts to 140 BPM.\n *\n * We can derive three segments:\n *\n * 1. At time 0, we are at beat 0, and moving at 2.333 beats per second.\n * 2. At 13.714s, we are at beat 32, moving at 2.667 beats per second.\n * 3. At 61.714s, we are at beat 160, moving at 2.333 beats per second.\n *\n * This maps out to this data structure:\n *\n * ```js\n * [ [0]: { t:  0.000,  x:   0,  dx: 2.333,  inclusive: true },\n *   [1]: { t: 13.714,  x:  32,  dx: 2.667,  inclusive: true },\n *   [2]: { t: 61.714,  x: 160,  dx: 2.333,  inclusive: true } ]\n * ```\n *\n * With this data, it is possible to find out the value of `x` at any given `t`.\n *\n * For example, to answer the question, what is the beat number at 30s?\n * First, we find the segment with maximum value of `t < 30`, and we get\n * the segment `[1]`.\n *\n * We calculate `segment.x + (t - segment.t) * segment.dx`.\n * The result beat number is (32 + (30 - 13.714) * 2.667) = 75.435.\n *\n * We can also perform the reverse calculation in a similar way, by reversing\n * the equation.\n *\n * Interestingly, we can use these segments to represent the effect of\n * both BPM changes and STOP segments in the same array.\n * For example, a 150-BPM song with a 2-beat stop in the 32nd beat\n * can be represented like this:\n *\n * ```js\n * [ [0]: { t:  0.0,  x:  0,  dx: 2.5,  inclusive: true  },\n *   [1]: { t: 12.8,  x: 32,  dx: 0,    inclusive: true  },\n *   [2]: { t: 13.6,  x: 32,  dx: 2.5,  inclusive: false } ]\n * ```\n */\nvar Speedcore = /** @class */ (function () {\n    /**\n     * Constructs a new `Speedcore` from given segments.\n     */\n    function Speedcore(segments) {\n        segments.forEach(segment_1.Segment);\n        this._segments = segments;\n    }\n    Speedcore.prototype._reached = function (index, targetFn, position) {\n        if (index >= this._segments.length)\n            return false;\n        var segment = this._segments[index];\n        var target = targetFn(segment);\n        return segment.inclusive ? position >= target : position > target;\n    };\n    Speedcore.prototype._segmentAt = function (targetFn, position) {\n        for (var i = 0; i < this._segments.length; i++) {\n            if (!this._reached(i + 1, targetFn, position))\n                return this._segments[i];\n        }\n        throw new Error('Unable to find a segment matching a criteria (this should never happen)!');\n    };\n    Speedcore.prototype.segmentAtX = function (x) {\n        return this._segmentAt(X, x);\n    };\n    Speedcore.prototype.segmentAtT = function (t) {\n        return this._segmentAt(T, t);\n    };\n    /**\n     * Calculates the _t_, given _x_.\n     */\n    Speedcore.prototype.t = function (x) {\n        var segment = this.segmentAtX(x);\n        return segment.t + (x - segment.x) / (segment.dx || 1);\n    };\n    /**\n     * Calculates the _x_, given _t_.\n     * @param {number} t\n     */\n    Speedcore.prototype.x = function (t) {\n        var segment = this.segmentAtT(t);\n        return segment.x + (t - segment.t) * segment.dx;\n    };\n    /**\n     * Finds the _dx_, given _t_.\n     * @param {number} t\n     */\n    Speedcore.prototype.dx = function (t) {\n        var segment = this.segmentAtT(t);\n        return segment.dx;\n    };\n    return Speedcore;\n}());\nexports.Speedcore = Speedcore;\nvar T = function (segment) { return segment.t; };\nvar X = function (segment) { return segment.x; };\n//# sourceMappingURL=index.js.map","import bytes from 'bytes'\n\nconst wrap = (f) => (progress) => progress.progress !== null ? f(progress) : ''\n\n// Formats the `Progress` as bytes (e.g. 1.23mb of 1.31mb).\nexport const BYTES_FORMATTER = wrap(\n  (progress) => bytes(progress.current) + ' / ' + bytes(progress.total)\n)\n\n// Formats the `Progress` as percentage.\nexport const PERCENTAGE_FORMATTER = wrap(\n  (progress) => ((progress.current / progress.total) * 100).toFixed(1) + '%'\n)\n\n// Formats the `Progress` simply by using the value of `Progress#extra`.\nexport const EXTRA_FORMATTER = wrap((progress) => progress.extra + '')\n","export default readBlob\n\n// Reads the blob as a specified type. The blob will not actually be read\n// unless the ``as()`` method is called.\n//\n// .. js:function:: as(type)\n//\n//    Starts reading the blob as ``type``. The ``type`` is a String such as\n//    \"arraybuffer\" or \"text\".\nexport function readBlob(blob) {\n  return {\n    as(type) {\n      return new Promise(function (resolve, reject) {\n        const reader = new FileReader()\n        reader.onload = function () {\n          resolve(reader.result)\n        }\n        reader.onerror = function () {\n          reject(new Error('Unable to read from Blob'))\n        }\n        switch (type) {\n          case 'arraybuffer':\n            reader.readAsArrayBuffer(blob)\n            break\n          case 'text':\n            reader.readAsText(blob)\n            break\n        }\n      })\n    },\n  }\n}\n","\"use strict\";\nvar __importDefault = (this && this.__importDefault) || function (mod) {\n    return (mod && mod.__esModule) ? mod : { \"default\": mod };\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.assign = exports.values = exports.map = exports.uniq = void 0;\n// A subset of lodash that we actually use.\nvar lodash_uniq_1 = __importDefault(require(\"lodash.uniq\"));\nexports.uniq = lodash_uniq_1.default;\nvar lodash_map_1 = __importDefault(require(\"lodash.map\"));\nexports.map = lodash_map_1.default;\nvar lodash_values_1 = __importDefault(require(\"lodash.values\"));\nexports.values = lodash_values_1.default;\nvar lodash_assign_1 = __importDefault(require(\"lodash.assign\"));\nexports.assign = lodash_assign_1.default;\n//# sourceMappingURL=lodash.js.map","import { BYTES_FORMATTER } from 'bemuse/progress/formatters'\nimport { Progress } from './Progress'\n\n/**\n * Returns a callback that, when called,\n * update the progress with increasing `current` value,\n * out of a fixed `total`.\n */\nexport function fixed(total: number, progress: Progress) {\n  if (!progress) return () => {}\n  let loaded = 0\n  progress.report(0, total)\n  return (extra: any) => progress.report(++loaded, total, extra)\n}\n\n/**\n * Updates the progress with the result of an atomic operation.\n */\nexport async function atomic<T>(\n  progress: Progress,\n  promise: PromiseLike<T>\n): Promise<T> {\n  if (!progress) return promise\n  const data = await Promise.resolve(promise)\n  if (hasByteLength(data)) {\n    progress.formatter = BYTES_FORMATTER\n    progress.report(data.byteLength, data.byteLength)\n  } else {\n    progress.report(1, 1)\n  }\n  return data\n}\nfunction hasByteLength(data: any): data is { byteLength: number } {\n  return data && data.byteLength\n}\n\n/**\n * Wraps an async function that may be called multiple times.\n * Each call adds to the total, and each async resolution adds to current.\n */\nexport function wrapPromise<A extends any[], R>(\n  progress: Progress,\n  f: (...args: A) => PromiseLike<R>\n): (...args: A) => PromiseLike<R> {\n  let current = 0\n  let total = 0\n  return async function (this: any, ...args: A) {\n    progress.report(current, ++total)\n    const ret = await f.apply(this, args)\n    progress.report(++current, total)\n    return ret\n  }\n}\n\nexport function bind(from: Progress, to: Progress) {\n  return from.watch(() => to.report(from.current!, from.total!, from.extra))\n}\n\n/**\n * Updates the `target` with progress data from multiple sources.\n */\nexport function simultaneous(target: Progress) {\n  const queue: Progress[] = []\n  let current: Progress | undefined\n  let unsubscribe: (() => void) | null = null\n  function update() {\n    if (current) {\n      target.report(current.current!, current.total!, current.extra)\n    }\n    if (queue.length > 0 && (!current || current.progress! >= 1)) {\n      bind(queue.shift()!)\n    }\n  }\n  function bind(progress: Progress) {\n    if (current === progress) {\n      return\n    }\n    if (unsubscribe) {\n      unsubscribe()\n      unsubscribe = null\n    }\n    current = progress\n    if (current) {\n      unsubscribe = current.watch(update)\n    }\n  }\n  return {\n    add(progress: Progress) {\n      queue.push(progress)\n      update()\n    },\n  }\n}\n","\"use strict\";\n/**\n * Public: The `bms` package is a library for working with rhythm game data.\n *\n * Although this librarys name suggests that it is for BMS file format,\n * almost every part can be used standalone.\n *\n * This package contains:\n *\n * - __Modules that reads and parses BMS files:__\n *\n *   - {Reader} reads the BMS file from a {Buffer}, detects the character set\n *     and decodes the buffer using that character set into a {String}.\n *   - {Compiler} reads the BMS source from a {String}, and converts into\n *     {BMSChart}, an internal representation of a BMS notechart.\n *\n * - __Classes for representing a BMS notechart.__\n *   These module stores the data as close to the BMS file format as possible.\n *\n *   Almost no musical interpretation is made.\n *   For example, a BPM change is simply represented using a\n *   BMSObject with `channel` = `03` or `08`.\n *\n *   - {BMSChart} is composed of {BMSHeaders}, {BMSObjects}, and {TimeSignatures}.\n *   - {BMSHeaders} represents the header sentences in a BMS file.\n *   - {BMSObjects} represents the objects in a BMS file.\n *   - {BMSObject} represents a single object.\n *\n * - __Classes that represent different aspects of a notechart.__\n *   Instance of these classes may be created from a {BMSChart},\n *   but they can be used in a standalone manner as well.\n *\n *   This makes this library very flexible,\n *   and able to accommodate different formats of notechart.\n *   For example, see the [bmson](https: *github.com/bemusic/bmson) package.\n *\n *   Its also possible to use these classes in context other than music gaming,\n *   for example, you can use these classes to help building a music player\n *   that requires precise synchronization between beats.\n *\n *   - {TimeSignatures} represents a collection of time signatures\n *     in a musical score, and lets you convert the measure number and fraction\n *     into beat number.\n *   - {Timing} represents the timing information in a musical score,\n *     and provides methods to convert between musical time (beats) and\n *     metric time (seconds).\n *   - {SongInfo} represents the basic song information,\n *     such as title, artist, and genre.\n *   - {Notes} represents the sound objects inside your notechart.\n *   - {Keysounds} represents a mapping between keysound ID and filename.\n *   - {Positioning} represents a mapping between beat and in-game position.\n *     Some rhythm game lets chart author control the amount of scrolling\n *     per beat. In StepMania 5, this is called the scroll segments.\n *   - {Spacing} represents a mapping between beat and note spacing.\n *     Some rhythm game lets chart author change the note spacing (HI-SPEED)\n *     dynamically. In StepMania 5, this is called the speed segments.\n *\n * - __Low-level utility classes:__\n *\n *   - {Speedcore} represents a linear animation.\n */\nvar __createBinding = (this && this.__createBinding) || (Object.create ? (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    var desc = Object.getOwnPropertyDescriptor(m, k);\n    if (!desc || (\"get\" in desc ? !m.__esModule : desc.writable || desc.configurable)) {\n      desc = { enumerable: true, get: function() { return m[k]; } };\n    }\n    Object.defineProperty(o, k2, desc);\n}) : (function(o, m, k, k2) {\n    if (k2 === undefined) k2 = k;\n    o[k2] = m[k];\n}));\nvar __setModuleDefault = (this && this.__setModuleDefault) || (Object.create ? (function(o, v) {\n    Object.defineProperty(o, \"default\", { enumerable: true, value: v });\n}) : function(o, v) {\n    o[\"default\"] = v;\n});\nvar __importStar = (this && this.__importStar) || function (mod) {\n    if (mod && mod.__esModule) return mod;\n    var result = {};\n    if (mod != null) for (var k in mod) if (k !== \"default\" && Object.prototype.hasOwnProperty.call(mod, k)) __createBinding(result, mod, k);\n    __setModuleDefault(result, mod);\n    return result;\n};\nvar __exportStar = (this && this.__exportStar) || function(m, exports) {\n    for (var p in m) if (p !== \"default\" && !Object.prototype.hasOwnProperty.call(exports, p)) __createBinding(exports, m, p);\n};\nObject.defineProperty(exports, \"__esModule\", { value: true });\nexports.Compiler = exports.Reader = void 0;\nvar Reader = __importStar(require(\"./reader\"));\nexports.Reader = Reader;\nvar Compiler = __importStar(require(\"./compiler\"));\nexports.Compiler = Compiler;\n__exportStar(require(\"./reader/types\"), exports);\n__exportStar(require(\"./bms/chart\"), exports);\n__exportStar(require(\"./bms/headers\"), exports);\n__exportStar(require(\"./bms/objects\"), exports);\n__exportStar(require(\"./speedcore\"), exports);\n__exportStar(require(\"./time-signatures\"), exports);\n__exportStar(require(\"./notes\"), exports);\n__exportStar(require(\"./timing\"), exports);\n__exportStar(require(\"./song-info\"), exports);\n__exportStar(require(\"./keysounds\"), exports);\n__exportStar(require(\"./positioning\"), exports);\n__exportStar(require(\"./spacing\"), exports);\n//# sourceMappingURL=index.js.map","module.exports = function(module) {\n\tif (!module.webpackPolyfill) {\n\t\tmodule.deprecate = function() {};\n\t\tmodule.paths = [];\n\t\t// module.parent = undefined by default\n\t\tif (!module.children) module.children = [];\n\t\tObject.defineProperty(module, \"loaded\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.l;\n\t\t\t}\n\t\t});\n\t\tObject.defineProperty(module, \"id\", {\n\t\t\tenumerable: true,\n\t\t\tget: function() {\n\t\t\t\treturn module.i;\n\t\t\t}\n\t\t});\n\t\tmodule.webpackPolyfill = 1;\n\t}\n\treturn module;\n};\n","import delay from 'delay'\nimport { BYTES_FORMATTER } from 'bemuse/progress/formatters'\n\n// Downloads the file from the URL.\n// The download will not actually be started unless the ``as()`` method\n// is called.\n//\n// .. js:function:: as(type)\n//\n//    Initiates the download as ``type``. The ``type`` is a string such as\n//    \"arraybuffer\" or \"blob\".\nexport function download(\n  url,\n  { getRetryDelay = () => 1000 + Math.random() * 4000 } = {}\n) {\n  return {\n    async as(type, progress) {\n      let shouldGiveUp = false\n      for (let i = 1; ; i++) {\n        try {\n          return await attempt()\n        } catch (error) {\n          console.error(`Unable to download ${url} [attempt ${i}]`, error)\n          if (i >= 3 || shouldGiveUp) throw error\n          const waitMs = getRetryDelay()\n          await delay(waitMs)\n        }\n      }\n      function attempt() {\n        return new Promise((resolve, reject) => {\n          const xh = new XMLHttpRequest()\n          xh.open('GET', url, true)\n          xh.responseType = type\n          xh.onload = () => {\n            if (+xh.status === 200) {\n              resolve(xh.response)\n            } else {\n              if (+xh.status === 403 || +xh.status === 404) {\n                shouldGiveUp = true\n              }\n              reject(new Error(`Unable to download ${url}: HTTP ${xh.status}`))\n            }\n          }\n          xh.onerror = () => reject(new Error(`Unable to download ${url}`))\n          if (progress) {\n            progress.formatter = BYTES_FORMATTER\n            xh.onprogress = (e) => progress.report(e.loaded, e.total)\n          }\n          xh.send(null)\n        })\n      }\n    },\n  }\n}\n\nexport default download\n"],"sourceRoot":""}