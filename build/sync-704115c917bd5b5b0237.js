(this.webpackJsonp=this.webpackJsonp||[]).push([[14],{102:function(e,n,t){"use strict";n.a=function(e){return{as:n=>new Promise((function(t,r){let o=new FileReader;switch(o.onload=function(){t(o.result)},o.onerror=function(){r(new Error("Unable to read from Blob"))},n){case"arraybuffer":o.readAsArrayBuffer(e);break;case"text":o.readAsText(e)}}))}}},1046:function(e,n,t){"use strict";t.d(n,"a",(function(){return c}));var r=t(85),o=t.n(r),a=t(27),s=t.n(a);function i(e){if(e instanceof o.a.Property)return e;if(e instanceof o.a.EventStream)throw new Error("Please convert Bacon.EventStream to Bacon.Property first.");if(e&&"object"==typeof e)return o.a.combineTemplate(e);throw new Error("Expected a Bacon.Property or a template.")}const c=e=>n=>{let t=i(e);return class extends s.a.Component{constructor(e){let n;super(e),this.handleValue=e=>{this._mounted&&this.setState({value:e})},this._unsubscribe=t.onValue(this.handleValue);t.onValue(e=>n=e)(),this.state={value:n}}componentWillUnmount(){this._mounted=!1,this._unsubscribe&&this._unsubscribe()}componentDidMount(){this._mounted=!0}render(){return s.a.createElement(n,Object.assign({},this.state.value||{},this.props))}}}},122:function(e,n,t){"use strict";var r=t(81),o=function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function s(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,i)}c((r=r.apply(e,n||[])).next())}))};n.a=function(e,{getRetryDelay:n=(()=>1e3+4e3*Math.random())}={}){return{as(t,a){return o(this,void 0,void 0,(function*(){let o=!1;for(let s=1;;s++)try{return yield new Promise((n,s)=>{var i=new XMLHttpRequest;i.open("GET",e,!0),i.responseType=t,i.onload=()=>{200==+i.status?n(i.response):(403!=+i.status&&404!=+i.status||(o=!0),s(new Error(`Unable to download ${e}: HTTP ${i.status}`)))},i.onerror=()=>s(new Error("Unable to download "+e)),a&&(a.formatter=r.a,i.onprogress=e=>a.report(e.loaded,e.total)),i.send(null)})}catch(t){if(console.error(`Unable to download ${e} [attempt ${s}]`,t),s>=3||o)throw t;const r=n();yield new Promise(e=>setTimeout(e,r))}}))}}}},1949:function(e,n,t){e.exports=t.p+"build/c3e8436ef4e3bcc1fbc987075279be07.ogg"},1950:function(e,n,t){e.exports=t.p+"build/aaeef09f2847a09d179f45cfe118d7e7.ogg"},1951:function(e,n,t){e.exports=t.p+"build/c1df64d6d6f13f3a38362aea7cc70a3f.ogg"},1952:function(e,n,t){e.exports=t.p+"build/e733dbfbb80f232b5704be73413ff476.ogg"},1953:function(e,n,t){var r=t(1954);"string"==typeof r&&(r=[[e.i,r,""]]);var o={hmr:!0,transform:void 0,insertInto:void 0};t(0)(r,o);r.locals&&(e.exports=r.locals)},1954:function(e,n,t){(e.exports=t(1)(!1)).push([e.i,'@charset "UTF-8";\n.ExperimentScene {\n  display: flex;\n  position: absolute;\n  top: 0;\n  right: 0;\n  bottom: 0;\n  left: 0;\n  align-items: center;\n  justify-content: center;\n}\n.ExperimentSceneのbutton {\n  font: inherit;\n  background: #252423 linear-gradient(to bottom, #454443, #151413);\n  border: 1px solid #555453;\n  padding: 0.5ex 1.3ex;\n  color: #fff;\n  border-radius: 4px;\n  box-shadow: 0 1px 3px rgba(0, 0, 0, 0.5);\n  font-size: 18px;\n}\n.ExperimentSceneのbutton:hover {\n  border-color: #656463;\n}\n.ExperimentSceneのbutton:focus {\n  border-color: #8b8685;\n  outline: 0;\n}\n.ExperimentSceneのbutton:active {\n  background: #252423 linear-gradient(to top, #353433, #151413);\n  border-color: #454443;\n}\n.ExperimentSceneのmessage {\n  text-align: center;\n  font-size: 16px;\n}\n.ExperimentSceneのprogress {\n  width: 100px;\n  margin: 1em auto;\n  border: 1px solid #8b8685;\n  padding: 1px;\n}\n.ExperimentSceneのprogressBar {\n  height: 5px;\n  background: #8b8685;\n  transition: 0.5s transform linear;\n  transform-origin: left;\n}\n.ExperimentScene.is-finished .ExperimentSceneのwrapper {\n  animation: 3.243243243s experiment-scene--auto-synchro linear infinite;\n}\n.ExperimentScene.is-finished .ExperimentSceneのwrapperInner {\n  animation: 3s experiment-scene--spin linear infinite;\n  animation-delay: 13.378378377s;\n}\n\n@keyframes experiment-scene--auto-synchro {\n  0.00% {\n    transform: scale(1);\n  }\n  11.88% {\n    transform: scale(0.95);\n  }\n  13.13% {\n    transform: scale(1.05);\n  }\n  24.38% {\n    transform: scale(0.95);\n  }\n  25.63% {\n    transform: scale(1.05);\n  }\n  36.88% {\n    transform: scale(0.95);\n  }\n  38.13% {\n    transform: scale(1.05);\n  }\n  49.38% {\n    transform: scale(0.95);\n  }\n  50.63% {\n    transform: scale(1.05);\n  }\n  61.88% {\n    transform: scale(0.95);\n  }\n  63.13% {\n    transform: scale(1.05);\n  }\n  74.38% {\n    transform: scale(0.95);\n  }\n  75.63% {\n    transform: scale(1.05);\n  }\n  86.88% {\n    transform: scale(0.95);\n  }\n  88.13% {\n    transform: scale(1.05);\n  }\n  100.00% {\n    transform: scale(1);\n  }\n}\n@keyframes experiment-scene--spin {\n  0% {\n    transform: rotate(0deg);\n  }\n  4% {\n    transform: rotate(1.99deg);\n  }\n  8% {\n    transform: rotate(3.85deg);\n  }\n  12% {\n    transform: rotate(5.48deg);\n  }\n  16% {\n    transform: rotate(6.75deg);\n  }\n  20% {\n    transform: rotate(7.61deg);\n  }\n  24% {\n    transform: rotate(7.98deg);\n  }\n  28% {\n    transform: rotate(7.86deg);\n  }\n  32% {\n    transform: rotate(7.24deg);\n  }\n  36% {\n    transform: rotate(6.16deg);\n  }\n  40% {\n    transform: rotate(4.7deg);\n  }\n  44% {\n    transform: rotate(2.94deg);\n  }\n  48% {\n    transform: rotate(1deg);\n  }\n  52% {\n    transform: rotate(-1deg);\n  }\n  56% {\n    transform: rotate(-2.94deg);\n  }\n  60% {\n    transform: rotate(-4.7deg);\n  }\n  64% {\n    transform: rotate(-6.16deg);\n  }\n  68% {\n    transform: rotate(-7.24deg);\n  }\n  72% {\n    transform: rotate(-7.86deg);\n  }\n  76% {\n    transform: rotate(-7.98deg);\n  }\n  80% {\n    transform: rotate(-7.61deg);\n  }\n  84% {\n    transform: rotate(-6.75deg);\n  }\n  88% {\n    transform: rotate(-5.48deg);\n  }\n  92% {\n    transform: rotate(-3.85deg);\n  }\n  96% {\n    transform: rotate(-1.99deg);\n  }\n  100% {\n    transform: rotate(0deg);\n  }\n}',""])},1988:function(e,n,t){"use strict";t.r(n),t.d(n,"main",(function(){return P}));var r=t(31),o=t.n(r),a=t(222),s=t(122),i=t(303),c=function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function s(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,i)}c((r=r.apply(e,n||[])).next())}))};let u={"bgm.ogg":t(1949),"intro.ogg":t(1950),"kick.ogg":t(1951),"snare.ogg":t(1952)};function l(){return c(this,void 0,void 0,(function*(){let e=new i.b(a.a),n=o.a.fromPairs(yield Promise.all(["bgm","intro","kick","snare"].map(n=>(n=>Object(s.a)(u[n+".ogg"]).as("arraybuffer").then(n=>e.sample(n)))(n).then(e=>[n,e]))));return function(e,n){return function(t){e.unmute();let r=new d(a.a,-1),o=a.a.createBiquadFilter();o.type="lowpass",o.frequency.value=0,o.Q.value=10,o.connect(a.a.destination);let s={part2:null},i=function(e,n){let t=-1;return r=>{let o=Math.floor((r+.1)*e/60);for(;t<o;){t+=1,n(t,60*t/e-r)}}}(148,(e,r)=>{e%8!=7&&n.kick.play(r),null!==s.part2?(e-=s.part2.begin)%128==0&&n.bgm.play(r):(e%32==0&&n.intro.play(r,{node:o}),e%32==31&&!0===s.ok&&(n.snare.play(r),s.part2={begin:e+1},t.a()))});return setInterval(()=>i(r.t),33),{ok(){s.ok=!0},progress(e){o.frequency.value=2e4*e*e*e},getSample(){let e=Math.round(148*r.t/60),n=60*e/148;return[e,r.t-n]}}}}(e,n)}))}class d{constructor(e,n){this._context=e,this._start=e.currentTime,this._startTime=n}get t(){return this._context.currentTime-this._start+this._startTime}}var f=t(27),h=t.n(f),m=t(67),p=t.n(m),g=(t(1953),t(29)),b=t.n(g),y=t(58),v=t.n(y);class x extends h.a.Component{constructor(){super(...arguments),this.renderContents=()=>this.props.loading?null:this.props.started?this.props.listening?this.renderCollection():this.renderMessage("Please listen to the beats…"):this.renderReady(),this.renderReady=()=>h.a.createElement("div",{className:"ExperimentSceneのready"},h.a.createElement("button",{className:"ExperimentSceneのbutton",onClick:this.props.onStart},"Start Calibration")),this.renderMessage=e=>h.a.createElement("div",{className:"ExperimentSceneのmessage"},e),this.renderCollection=()=>{var e;let n="scaleX("+(this.props.finished?1:(e=Math.min(1,this.props.numSamples/84),1-Math.pow(1-e,2)))+")",t={transform:n,WebkitTransform:n};return h.a.createElement("div",{className:"ExperimentSceneのcollection"},this.renderMessage(this.props.finished?"Your latency is "+this.props.latency+"ms. Please close this window.":"Please press the space bar when you hear the kick drum."),h.a.createElement("div",{className:"ExperimentSceneのprogress"},h.a.createElement("div",{className:"ExperimentSceneのprogressBar",style:t})))}}render(){return h.a.createElement("div",{className:v()("ExperimentScene",{"is-finished":this.props.finished})},h.a.createElement("div",{className:"ExperimentSceneのwrapper"},h.a.createElement("div",{className:"ExperimentSceneのwrapperInner"},this.renderContents())))}}x.propTypes={finished:b.a.bool,loading:b.a.bool,started:b.a.bool,listening:b.a.bool,onStart:b.a.func,numSamples:b.a.number,latency:b.a.number};var w=t(84),_=t.n(w),E=t(85),S=t.n(E),T=t(1046);function P(e){e.setStatus("Loading song");const n=new S.a.Bus,t=n.scan({loading:!0,started:!1,finished:!1,listening:!1,numSamples:0,latency:0},(e,n)=>o.a.assign({},e,n)),r=Object(T.a)(t)(x),a=h.a.createElement(r,{onStart:()=>{s(),i({type:"calibration-started"}),addEventListener("beforeunload",()=>{i({type:"calibration-closed"})})}});let s;function i(e){window.opener&&window.opener.postMessage(e,"*")}return p.a.render(a,_()("<div></div>").appendTo("body")[0]),l().then(e=>{let t=[];n.push({loading:!1}),s=()=>{n.push({started:!0});let r=e({a(){let e=Math.max(0,function(e){let n=e.map(e=>e[1]);n.sort((e,n)=>e-n);let t=0,r=0;for(let e=Math.floor(1*n.length/7);e<6*n.length/7;e++)t+=1,r+=n[e];return Math.round(r/t*1e3)}(t));n.push({finished:!0,latency:e}),i({latency:e})}}),o=()=>{t.push(r.getSample()),r.progress(Math.min(1,t.length/56)),t.length>=56&&r.ok(),n.push({numSamples:t.length})};setTimeout(()=>{n.push({listening:!0}),window.addEventListener("keydown",e=>{32===e.which&&(e.preventDefault(),o())}),window.addEventListener("touchstart",e=>{1===e.touches.length&&(e.preventDefault(),o())})},6675)}})}},222:function(e,n,t){"use strict";var r=t(346),o=t.n(r);n.a=o()({latencyHint:"interaction"})},303:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"c",(function(){return f}));var r=t(222),o=t(102),a=t(337);const s=.001;let i=document.createElement("audio");const c=!i.canPlayType('audio/ogg; codecs="vorbis"');class u{constructor(e,{volume:n}={}){this._master=e,this._gain=this._master.audioContext.createGain(),null!=n&&(this._gain.gain.value=n),this._gain.connect(this._master.destination)}get destination(){return this._gain}destroy(){this._gain.disconnect(),this._gain=null}}class l{constructor(e,n){this._master=e,this._buffer=n}play(e,n){return new d(this._master,this._buffer,e,n)}destroy(){this._master=null,this._buffer=null}}class d{constructor(e,n,t,r={}){t=t||0,this._master=e;let o=e.audioContext,a=o.createBufferSource();a.buffer=n,a.onended=()=>this.stop();let i=o.createGain();a.connect(i);let c=r.node||r.group&&r.group.destination||e.destination;i.connect(c),this._source=a,this._gain=this.TEST_node=i;let u=t?Math.max(0,o.currentTime+t):0,l=r.start||0,d=l>0,f=!1;if(d&&i.gain.setValueAtTime(0,0),void 0!==r.end){let e=Math.max(r.end-l,0);a.start(u,l,e+s),f=o.currentTime+t+e}else a.start(u,l);d&&(i.gain.setValueAtTime(0,o.currentTime+t),i.gain.linearRampToValueAtTime(1,o.currentTime+t+s)),!1!==f&&(i.gain.setValueAtTime(1,f),i.gain.linearRampToValueAtTime(0,f+s)),this._master._startPlaying(this)}stop(){this._source&&(this._source.stop(0),this._source.disconnect(),this._gain.disconnect(),this._source=null,this._gain=null,this._master._stoppedPlaying(this),this.onstop&&this.onstop())}bad(){this._source&&(this._source.playbackRate.value=Math.random()<.5?Math.pow(2,1/24):Math.pow(2,-1/24))}destroy(){this.stop()}}function f(e=r.a){let n=e.createGain(),t=e.createOscillator();t.frequency.value=440,t.start(e.currentTime+.1),t.stop(e.currentTime+.1),n.connect(e.destination),n.disconnect();try{e.resume()}catch(e){console.error("[sampling-master] Cannot resume AudioContext",e)}}n.b=class{constructor(e){this._audioContext=e||r.a,this._samples=[],this._groups=[],this._instances=new Set,this._destination=this._audioContext.destination}unmute(){f(this._audioContext)}get audioContext(){return this._audioContext}get destination(){return this._destination}destroy(){if(!this._destroyed){this._destroyed=!0;for(let e of this._samples)e.destroy();for(let e of this._instances)e.destroy();this._samples=null,this._instances=null}}decode(e){return this._coerceToArrayBuffer(e).then(e=>this._decodeAudio(e))}sample(e){return(()=>e.numberOfChannels?Promise.resolve(e):this.decode(e))().then(e=>{if(this._destroyed)throw new Error("SamplingMaster already destroyed!");var n=new l(this,e);return this._samples.push(n),n})}group(e){const n=new u(this,e);return this._groups.push(n),n}_coerceToArrayBuffer(e){return e instanceof ArrayBuffer?Promise.resolve(e):Object(o.a)(e).as("arraybuffer")}_decodeAudio(e){return new Promise((n,t)=>{if(c&&e.byteLength>4){const t=new Uint8Array(e,0,4);if(79===t[0]&&103===t[1]&&103===t[2]&&83===t[3])return n(Object(a.a)(this.audioContext,e))}this.audioContext.decodeAudioData(e,(function(e){n(e)}),(function(e){t(new Error("Unable to decode audio: "+e))}))})}_startPlaying(e){this._instances.add(e)}_stoppedPlaying(e){this._instances.delete(e)}}},337:function(e,n,t){"use strict";t.d(n,"a",(function(){return i}));var r=t(221),o=function(e,n,t,r){return new(t||(t=Promise))((function(o,a){function s(e){try{c(r.next(e))}catch(e){a(e)}}function i(e){try{c(r.throw(e))}catch(e){a(e)}}function c(e){var n;e.done?o(e.value):(n=e.value,n instanceof t?n:new t((function(e){e(n)}))).then(s,i)}c((r=r.apply(e,n||[])).next())}))};let a;const s=t.n(r)()(1);function i(e,n){return o(this,void 0,void 0,(function*(){const r=yield(a||(a=t.e(13).then(t.t.bind(null,1038,7)).then(e=>e.default).then(e=>(0,eval)(e+";stbvorbis"))),a);return s(()=>function(e,n,t){return new Promise((r,a)=>{const s=[];let i,u=0;e.decode(t,(function(e){if(e.data&&(i=e.sampleRate,s.push(e.data),u+=e.data[0].length),e.error){const n=e.error instanceof Error?e.error:"stbvorbis.js Error: "+e.error;a(n)}e.eof&&r(function(e,n,t,r){return o(this,void 0,void 0,(function*(){if(!t)throw new Error("stbvorbis.js Error: No length");if(!r)throw new Error("stbvorbis.js Error: No sample rate");const o=n[0].length,a=e.createBuffer(o,t,r),s=Array(a.numberOfChannels).fill(null).map((e,n)=>new c(a.getChannelData(n)));for(const e of n)e.forEach((e,n)=>{s[n].write(e)});return a}))}(n,s,u,i))}))})}(r,e,n))}))}class c{constructor(e){this.data=e,this.offset=0}write(e){const{offset:n,data:t}=this;for(var r=0;r<e.length;r++)t[r+n]=e[r];this.offset+=e.length}}},81:function(e,n,t){"use strict";t.d(n,"a",(function(){return s})),t.d(n,"c",(function(){return i})),t.d(n,"b",(function(){return c}));var r=t(386),o=t.n(r);let a=e=>n=>null!==n.progress?e(n):"",s=a(e=>o()(e.current)+" / "+o()(e.total)),i=a(e=>(e.current/e.total*100).toFixed(1)+"%"),c=a(e=>e.extra+"")}}]);
//# sourceMappingURL=sync-704115c917bd5b5b0237.js.map